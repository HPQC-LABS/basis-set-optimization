created virtual environment CPython3.10.2.final.0-64 in 1292ms
  creator CPython3Posix(dest=/localscratch/nike.62940555.0/ENV, clear=True, no_vcs_ignore=False, global=False)
  seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=/home/nike/.local/share/virtualenv)
    added seed packages: pip==23.0.1, setuptools==67.3.3, wheel==0.38.4+computecanada
  activators BashActivator,CShellActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Requirement already satisfied: pip in /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages (23.0.1)
Looking in links: /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic, /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic
Processing /home/nike/pyscf_ad/dist/pyscf-2.1.1+ad-cp310-cp310-linux_x86_64.whl
Processing /home/nike/pyscf_properties_ad/dist/pyscf_properties-0.1.0+ad-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/absl_py-1.4.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic/contourpy-1.0.7+computecanada-cp310-cp310-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/cycler-0.11.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/fonttools-4.39.0+computecanada-cp310-cp310-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/h5py-3.8.0+computecanada-cp310-cp310-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/jax-0.4.2+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic/jaxlib-0.4.2+cuda11.cudnn82.computecanada-cp310-cp310-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/jaxopt-0.6+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/kiwisolver-1.4.4+computecanada-cp310-cp310-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/matplotlib-3.7.0+computecanada-cp310-cp310-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic/numpy-1.24.2+computecanada-cp310-cp310-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/opt_einsum-3.3.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/packaging-23.0+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/avx2/Pillow-9.4.0+computecanada-cp310-cp310-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/pyparsing-3.0.9+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/pyscfad-0.1.2+computecanada-py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/python_dateutil-2.8.2+computecanada-py2.py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/gentoo/generic/scipy-1.10.1+computecanada-cp310-cp310-linux_x86_64.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/six-1.16.0+computecanada-py2.py3-none-any.whl
Processing /cvmfs/soft.computecanada.ca/custom/python/wheelhouse/generic/typing_extensions-4.5.0+computecanada-py3-none-any.whl
Installing collected packages: typing_extensions, six, pyparsing, Pillow, packaging, numpy, kiwisolver, fonttools, cycler, absl_py, scipy, python-dateutil, opt-einsum, h5py, contourpy, pyscf, matplotlib, jaxlib, pyscf-properties, jax, jaxopt, pyscfad
Successfully installed Pillow-9.4.0+computecanada absl_py-1.4.0+computecanada contourpy-1.0.7+computecanada cycler-0.11.0+computecanada fonttools-4.39.0+computecanada h5py-3.8.0+computecanada jax-0.4.2+computecanada jaxlib-0.4.2+cuda11.cudnn82.computecanada jaxopt-0.6+computecanada kiwisolver-1.4.4+computecanada matplotlib-3.7.0+computecanada numpy-1.24.2+computecanada opt-einsum-3.3.0+computecanada packaging-23.0+computecanada pyparsing-3.0.9+computecanada pyscf-2.1.1+ad pyscf-properties-0.1.0+ad pyscfad-0.1.2+computecanada python-dateutil-2.8.2+computecanada scipy-1.10.1+computecanada six-1.16.0+computecanada typing_extensions-4.5.0+computecanada

real	0m52.753s
user	0m46.421s
sys	0m1.927s
/project/6004934/nike/basis-set-optimization/018_Ar/./input.py:74: OptimizeWarning: Unknown solver options: maxfev
  res = optimize.minimize(
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:16 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558552        1
[INPUT] 0    0    [1    /1   ]  7617.52191563        1
[INPUT] 0    0    [1    /1   ]  3617.35086742        1
[INPUT] 0    0    [1    /1   ]  1597.82569303        1
[INPUT] 0    0    [1    /1   ]  382.851149473        1
[INPUT] 0    0    [1    /1   ]  108.121083403        1
[INPUT] 0    0    [1    /1   ]  34.8054690698        1
[INPUT] 0    0    [1    /1   ]  7.58522390534        1
[INPUT] 0    0    [1    /1   ]  2.58522390534        1
[INPUT] 0    0    [1    /1   ]  0.795313490558       1
[INPUT] 0    0    [1    /1   ]  0.295313490558       1
[INPUT] 0    0    [1    /1   ]  0.0595313490558      1
[INPUT] 1    0    [1    /1   ]  1362.78320627        1
[INPUT] 1    0    [1    /1   ]  664.745680987        1
[INPUT] 1    0    [1    /1   ]  300.961991574        1
[INPUT] 1    0    [1    /1   ]  314.042273999        1
[INPUT] 1    0    [1    /1   ]  61.6222358638        1
[INPUT] 1    0    [1    /1   ]  7.32989794841        1
[INPUT] 1    0    [1    /1   ]  20.2391201296        1
[INPUT] 1    0    [1    /1   ]  0.772070364573       1
[INPUT] 1    0    [1    /1   ]  2.80887843481        1
[INPUT] 1    0    [1    /1   ]  0.222573632039       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65585524854, 1.0]], [0, [7617.521915627052, 1.0]], [0, [3617.3508674245704, 1.0]], [0, [1597.8256930291025, 1.0]], [0, [382.85114947300525, 1.0]], [0, [108.1210834029935, 1.0]], [0, [34.80546906975482, 1.0]], [0, [7.585223905343421, 1.0]], [0, [2.5852239053434207, 1.0]], [0, [0.7953134905576748, 1.0]], [0, [0.29531349055767475, 1.0]], [0, [0.05953134905576747, 1.0]], [1, [1362.7832062666114, 1.0]], [1, [664.7456809871924, 1.0]], [1, [300.9619915744506, 1.0]], [1, [314.0422739991703, 1.0]], [1, [61.622235863813884, 1.0]], [1, [7.329897948406479, 1.0]], [1, [20.239120129550937, 1.0]], [1, [0.7720703645725635, 1.0]], [1, [2.8088784348099196, 1.0]], [1, [0.22257363203907735, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65585525]
bas 1, expnt(s) = [7617.52191563]
bas 2, expnt(s) = [3617.35086742]
bas 3, expnt(s) = [1597.82569303]
bas 4, expnt(s) = [382.85114947]
bas 5, expnt(s) = [108.1210834]
bas 6, expnt(s) = [34.80546907]
bas 7, expnt(s) = [7.58522391]
bas 8, expnt(s) = [2.58522391]
bas 9, expnt(s) = [0.79531349]
bas 10, expnt(s) = [0.29531349]
bas 11, expnt(s) = [0.05953135]
bas 12, expnt(s) = [1362.78320627]
bas 13, expnt(s) = [664.74568099]
bas 14, expnt(s) = [300.96199157]
bas 15, expnt(s) = [314.042274]
bas 16, expnt(s) = [61.62223586]
bas 17, expnt(s) = [7.32989795]
bas 18, expnt(s) = [20.23912013]
bas 19, expnt(s) = [0.77207036]
bas 20, expnt(s) = [2.80887843]
bas 21, expnt(s) = [0.22257363]
CPU time:         0.98
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752192e+03 2.06003837e+03
 3.61735087e+03 1.17844143e+03 1.59782569e+03 6.38501724e+02
 3.82851149e+02 2.18669137e+02 1.08121083e+02 8.47125619e+01
 3.48054691e+01 3.62035070e+01 7.58522391e+00 1.15475893e+01
 2.58522391e+00 5.15096557e+00 7.95313491e-01 2.12774112e+00
 2.95313491e-01 1.01210947e+00 5.95313491e-02 3.04490900e-01
 1.36278321e+03 2.41556016e+04 6.64745681e+02 9.84699683e+03
 3.00961992e+02 3.65699156e+03 3.14042274e+02 3.85673265e+03
 6.16222359e+01 5.03681741e+02 7.32989795e+00 3.51849390e+01
 2.02391201e+01 1.25234483e+02 7.72070365e-01 2.11132697e+00
 2.80887843e+00 1.06084167e+01 2.22573632e-01 4.45991451e-01]
ecpbas  = []
2023-03-19 09:21:16.483504: W external/org_tensorflow/tensorflow/tsl/platform/default/dso_loader.cc:67] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory
2023-03-19 09:21:16.483603: W external/org_tensorflow/tensorflow/compiler/xla/stream_executor/cuda/cuda_driver.cc:264] failed call to cuInit: UNKNOWN ERROR (303)
No GPU/TPU found, falling back to CPU. (Set TF_CPP_MIN_LOG_LEVEL=0 and rerun for more info.)
Set gradient conv threshold to 3.16228e-05
/localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscfad/gto/moleintor.py:74: UserWarning: AO symmetry is not supported. Setting aosym = s1.
  warnings.warn(msg)
Nelec from initial guess = 17.993469372240654
cond(S) = 104116.58447901596
E1 = -729.5109652370759  E_coul = 203.18162972645464
init E= -526.329335510621
    CPU time for initialize scf      0.21 sec, wall time      0.17 sec
/localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/jax/_src/numpy/lax_numpy.py:3493: UserWarning: 'kind' argument to argsort is ignored; only 'stable' sorts are supported.
  warnings.warn("'kind' argument to argsort is ignored; only 'stable' sorts "
  HOMO = -0.556057816749238  LUMO = 0.155805807449276
  mo_energy =
[-1.18324789e+02 -1.22008317e+01 -9.44648270e+00 -9.44648270e+00
 -9.44648270e+00 -1.23931041e+00 -5.56057817e-01 -5.56057817e-01
 -5.56057817e-01  1.55805807e-01  1.02917390e+00  1.02917390e+00
  1.02917390e+00  1.59817744e+00  7.32989525e+00  7.32989525e+00
  7.32989525e+00  1.14618050e+01  3.35004456e+01  3.35004456e+01
  3.35004456e+01  1.01480771e+02  1.29123261e+02  1.29123261e+02
  1.29123261e+02  4.83531380e+02  4.83531380e+02  4.83531380e+02
  5.81850251e+02  1.33542776e+03  1.33542776e+03  1.33542776e+03
  2.65065539e+03  3.02974223e+03  3.02974223e+03  3.02974223e+03
  6.65030033e+03  6.65030033e+03  6.65030033e+03  9.05662206e+03
  2.54125320e+04  7.61552433e+04]
E1 = -727.8054111573534  E_coul = 201.08145966949905
cycle= 1 E= -526.723951487854  delta_E= -0.395  |g|= 0.19  |ddm|= 0.321
    CPU time for cycle= 1      0.29 sec, wall time      0.29 sec
diis-norm(errvec)=0.547176
diis-c [-0.29940155  1.        ]
  HOMO = -0.590018845655192  LUMO = 0.153204895010077
  mo_energy =
[-1.18638598e+02 -1.23402042e+01 -9.59843487e+00 -9.59843487e+00
 -9.59843487e+00 -1.27759960e+00 -5.90018846e-01 -5.90018846e-01
 -5.90018846e-01  1.53204895e-01  1.00541849e+00  1.00541849e+00
  1.00541849e+00  1.56650996e+00  7.23893395e+00  7.23893395e+00
  7.23893395e+00  1.13603337e+01  3.33432357e+01  3.33432357e+01
  3.33432357e+01  1.01256234e+02  1.28889951e+02  1.28889951e+02
  1.28889951e+02  4.83218423e+02  4.83218423e+02  4.83218423e+02
  5.81499862e+02  1.33505860e+03  1.33505860e+03  1.33505860e+03
  2.65015176e+03  3.02930687e+03  3.02930687e+03  3.02930687e+03
  6.64975184e+03  6.64975184e+03  6.64975184e+03  9.05599829e+03
  2.54118144e+04  7.61544357e+04]
E1 = -728.3868146327327  E_coul = 201.6621098667577
cycle= 2 E= -526.724704765975  delta_E= -0.000753  |g|= 0.0385  |ddm|= 0.0573
    CPU time for cycle= 2      0.11 sec, wall time      0.11 sec
diis-norm(errvec)=0.0770968
diis-c [-0.00333849  0.08576407  0.91423593]
  HOMO = -0.580913016516124  LUMO = 0.154370526419604
  mo_energy =
[-1.18569858e+02 -1.23017684e+01 -9.55839523e+00 -9.55839523e+00
 -9.55839523e+00 -1.26669191e+00 -5.80913017e-01 -5.80913017e-01
 -5.80913017e-01  1.54370526e-01  1.01209686e+00  1.01209686e+00
  1.01209686e+00  1.57567885e+00  7.26277381e+00  7.26277381e+00
  7.26277381e+00  1.13884121e+01  3.33836693e+01  3.33836693e+01
  3.33836693e+01  1.01312347e+02  1.28946608e+02  1.28946608e+02
  1.28946608e+02  4.83286322e+02  4.83286322e+02  4.83286322e+02
  5.81570158e+02  1.33513062e+03  1.33513062e+03  1.33513062e+03
  2.65022713e+03  3.02938115e+03  3.02938115e+03  3.02938115e+03
  6.64982786e+03  6.64982786e+03  6.64982786e+03  9.05607513e+03
  2.54118918e+04  7.61545134e+04]
E1 = -728.2344497120655  E_coul = 201.50968388935132
cycle= 3 E= -526.724765822714  delta_E= -6.11e-05  |g|= 0.00625  |ddm|= 0.0156
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132306
diis-c [-9.64650257e-07 -1.36480698e-03  1.41365936e-01  8.59998871e-01]
  HOMO = -0.582410199193621  LUMO = 0.154195675767594
  mo_energy =
[-1.18579752e+02 -1.23075313e+01 -9.56453074e+00 -9.56453074e+00
 -9.56453074e+00 -1.26837063e+00 -5.82410199e-01 -5.82410199e-01
 -5.82410199e-01  1.54195676e-01  1.01101952e+00  1.01101952e+00
  1.01101952e+00  1.57426501e+00  7.25901011e+00  7.25901011e+00
  7.25901011e+00  1.13841477e+01  3.33775222e+01  3.33775222e+01
  3.33775222e+01  1.01304177e+02  1.28938307e+02  1.28938307e+02
  1.28938307e+02  4.83276541e+02  4.83276541e+02  4.83276541e+02
  5.81560021e+02  1.33512025e+03  1.33512025e+03  1.33512025e+03
  2.65021611e+03  3.02937039e+03  3.02937039e+03  3.02937039e+03
  6.64981669e+03  6.64981669e+03  6.64981669e+03  9.05606374e+03
  2.54118802e+04  7.61545017e+04]
E1 = -728.2570532744658  E_coul = 201.53228554784812
cycle= 4 E= -526.724767726618  delta_E= -1.9e-06  |g|= 0.00011  |ddm|= 0.00229
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000162364
diis-c [-9.63356445e-09  1.05591085e-04 -1.40038346e-02 -9.18588446e-02
  1.10575709e+00]
  HOMO = -0.582393875164633  LUMO = 0.154201756396009
  mo_energy =
[-1.18579717e+02 -1.23074646e+01 -9.56448136e+00 -9.56448136e+00
 -9.56448136e+00 -1.26832869e+00 -5.82393875e-01 -5.82393875e-01
 -5.82393875e-01  1.54201756e-01  1.01103330e+00  1.01103330e+00
  1.01103330e+00  1.57429811e+00  7.25905044e+00  7.25905044e+00
  7.25905044e+00  1.13842056e+01  3.33775694e+01  3.33775694e+01
  3.33775694e+01  1.01304227e+02  1.28938352e+02  1.28938352e+02
  1.28938352e+02  4.83276577e+02  4.83276577e+02  4.83276577e+02
  5.81560047e+02  1.33512027e+03  1.33512027e+03  1.33512027e+03
  2.65021611e+03  3.02937040e+03  3.02937040e+03  3.02937040e+03
  6.64981669e+03  6.64981669e+03  6.64981669e+03  9.05606372e+03
  2.54118802e+04  7.61545017e+04]
E1 = -728.2568149489776  E_coul = 201.53204722005037
cycle= 5 E= -526.724767728927  delta_E= -2.31e-09  |g|= 2.19e-05  |ddm|= 0.000138
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.07238e-05
diis-c [-1.70695475e-10  1.18119233e-05 -1.35010723e-03 -1.10594180e-02
  1.09339713e-02  1.00146374e+00]
  HOMO = -0.582403347699759  LUMO = 0.154201065217066
  mo_energy =
[-1.18579753e+02 -1.23074925e+01 -9.56451109e+00 -9.56451109e+00
 -9.56451109e+00 -1.26833684e+00 -5.82403348e-01 -5.82403348e-01
 -5.82403348e-01  1.54201065e-01  1.01102688e+00  1.01102688e+00
  1.01102688e+00  1.57429102e+00  7.25902989e+00  7.25902989e+00
  7.25902989e+00  1.13841839e+01  3.33775406e+01  3.33775406e+01
  3.33775406e+01  1.01304194e+02  1.28938318e+02  1.28938318e+02
  1.28938318e+02  4.83276541e+02  4.83276541e+02  4.83276541e+02
  5.81560011e+02  1.33512024e+03  1.33512024e+03  1.33512024e+03
  2.65021607e+03  3.02937036e+03  3.02937036e+03  3.02937036e+03
  6.64981665e+03  6.64981665e+03  6.64981665e+03  9.05606368e+03
  2.54118801e+04  7.61545016e+04]
E1 = -728.2569116716328  E_coul = 201.53214394263688
cycle= 6 E= -526.724767728996  delta_E= -6.86e-11  |g|= 2.1e-06  |ddm|= 1.74e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2569116716328  E_coul = 201.53214394263688
  HOMO = -0.582402829677236  LUMO = 0.154201196156738
  mo_energy =
[-1.18579750e+02 -1.23074905e+01 -9.56450898e+00 -9.56450898e+00
 -9.56450898e+00 -1.26833588e+00 -5.82402830e-01 -5.82402830e-01
 -5.82402830e-01  1.54201196e-01  1.01102730e+00  1.01102730e+00
  1.01102730e+00  1.57429178e+00  7.25903127e+00  7.25903127e+00
  7.25903127e+00  1.13841855e+01  3.33775427e+01  3.33775427e+01
  3.33775427e+01  1.01304197e+02  1.28938321e+02  1.28938321e+02
  1.28938321e+02  4.83276544e+02  4.83276544e+02  4.83276544e+02
  5.81560014e+02  1.33512024e+03  1.33512024e+03  1.33512024e+03
  2.65021607e+03  3.02937036e+03  3.02937036e+03  3.02937036e+03
  6.64981665e+03  6.64981665e+03  6.64981665e+03  9.05606369e+03
  2.54118801e+04  7.61545016e+04]
E1 = -728.2569030742509  E_coul = 201.53213534525477
Extra cycle  E= -526.724767728996  delta_E= -2.27e-13  |g|= 5.49e-07  |ddm|= 2.7e-06
    CPU time for scf_cycle      0.78 sec, wall time      0.74 sec
exp = [2.61826559e+04 7.61752192e+03 3.61735087e+03 1.59782569e+03
 3.82851149e+02 1.08121083e+02 3.48054691e+01 7.58522391e+00
 2.58522391e+00 7.95313491e-01 2.95313491e-01 5.95313491e-02
 1.36278321e+03 6.64745681e+02 3.00961992e+02 3.14042274e+02
 6.16222359e+01 7.32989795e+00 2.02391201e+01 7.72070365e-01
 2.80887843e+00 2.22573632e-01]
E = -526.7247677289961
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:17 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558552        1
[INPUT] 0    0    [1    /1   ]  7617.52191563        1
[INPUT] 0    0    [1    /1   ]  3617.35086742        1
[INPUT] 0    0    [1    /1   ]  1597.82569303        1
[INPUT] 0    0    [1    /1   ]  382.851149473        1
[INPUT] 0    0    [1    /1   ]  108.121083403        1
[INPUT] 0    0    [1    /1   ]  34.8054690698        1
[INPUT] 0    0    [1    /1   ]  7.58522390534        1
[INPUT] 0    0    [1    /1   ]  2.58522390534        1
[INPUT] 0    0    [1    /1   ]  0.795313490558       1
[INPUT] 0    0    [1    /1   ]  0.295313490558       1
[INPUT] 0    0    [1    /1   ]  0.0595313490558      1
[INPUT] 1    0    [1    /1   ]  1362.78320627        1
[INPUT] 1    0    [1    /1   ]  664.745680987        1
[INPUT] 1    0    [1    /1   ]  300.961991574        1
[INPUT] 1    0    [1    /1   ]  314.042273999        1
[INPUT] 1    0    [1    /1   ]  61.6222358638        1
[INPUT] 1    0    [1    /1   ]  7.32989794841        1
[INPUT] 1    0    [1    /1   ]  20.2391201296        1
[INPUT] 1    0    [1    /1   ]  0.772070364573       1
[INPUT] 1    0    [1    /1   ]  2.80887843481        1
[INPUT] 1    0    [1    /1   ]  0.222573632039       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65585524854, 1.0]], [0, [7617.521915627052, 1.0]], [0, [3617.3508674245704, 1.0]], [0, [1597.8256930291025, 1.0]], [0, [382.85114947300525, 1.0]], [0, [108.1210834029935, 1.0]], [0, [34.80546906975482, 1.0]], [0, [7.585223905343421, 1.0]], [0, [2.5852239053434207, 1.0]], [0, [0.7953134905576748, 1.0]], [0, [0.29531349055767475, 1.0]], [0, [0.05953134905576747, 1.0]], [1, [1362.7832062666114, 1.0]], [1, [664.7456809871924, 1.0]], [1, [300.9619915744506, 1.0]], [1, [314.0422739991703, 1.0]], [1, [61.622235863813884, 1.0]], [1, [7.329897948406479, 1.0]], [1, [20.239120129550937, 1.0]], [1, [0.7720703645725635, 1.0]], [1, [2.8088784348099196, 1.0]], [1, [0.22257363203907735, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65585525]
bas 1, expnt(s) = [7617.52191563]
bas 2, expnt(s) = [3617.35086742]
bas 3, expnt(s) = [1597.82569303]
bas 4, expnt(s) = [382.85114947]
bas 5, expnt(s) = [108.1210834]
bas 6, expnt(s) = [34.80546907]
bas 7, expnt(s) = [7.58522391]
bas 8, expnt(s) = [2.58522391]
bas 9, expnt(s) = [0.79531349]
bas 10, expnt(s) = [0.29531349]
bas 11, expnt(s) = [0.05953135]
bas 12, expnt(s) = [1362.78320627]
bas 13, expnt(s) = [664.74568099]
bas 14, expnt(s) = [300.96199157]
bas 15, expnt(s) = [314.042274]
bas 16, expnt(s) = [61.62223586]
bas 17, expnt(s) = [7.32989795]
bas 18, expnt(s) = [20.23912013]
bas 19, expnt(s) = [0.77207036]
bas 20, expnt(s) = [2.80887843]
bas 21, expnt(s) = [0.22257363]
CPU time:         2.09
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752192e+03 2.06003837e+03
 3.61735087e+03 1.17844143e+03 1.59782569e+03 6.38501724e+02
 3.82851149e+02 2.18669137e+02 1.08121083e+02 8.47125619e+01
 3.48054691e+01 3.62035070e+01 7.58522391e+00 1.15475893e+01
 2.58522391e+00 5.15096557e+00 7.95313491e-01 2.12774112e+00
 2.95313491e-01 1.01210947e+00 5.95313491e-02 3.04490900e-01
 1.36278321e+03 2.41556016e+04 6.64745681e+02 9.84699683e+03
 3.00961992e+02 3.65699156e+03 3.14042274e+02 3.85673265e+03
 6.16222359e+01 5.03681741e+02 7.32989795e+00 3.51849390e+01
 2.02391201e+01 1.25234483e+02 7.72070365e-01 2.11132697e+00
 2.80887843e+00 1.06084167e+01 2.22573632e-01 4.45991451e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993469372240654
cond(S) = 104116.58447901596
E1 = -729.5109652370759  E_coul = 203.18162972645464
init E= -526.329335510621
    CPU time for initialize scf      0.09 sec, wall time      0.05 sec
  HOMO = -0.556057816749238  LUMO = 0.155805807449276
  mo_energy =
[-1.18324789e+02 -1.22008317e+01 -9.44648270e+00 -9.44648270e+00
 -9.44648270e+00 -1.23931041e+00 -5.56057817e-01 -5.56057817e-01
 -5.56057817e-01  1.55805807e-01  1.02917390e+00  1.02917390e+00
  1.02917390e+00  1.59817744e+00  7.32989525e+00  7.32989525e+00
  7.32989525e+00  1.14618050e+01  3.35004456e+01  3.35004456e+01
  3.35004456e+01  1.01480771e+02  1.29123261e+02  1.29123261e+02
  1.29123261e+02  4.83531380e+02  4.83531380e+02  4.83531380e+02
  5.81850251e+02  1.33542776e+03  1.33542776e+03  1.33542776e+03
  2.65065539e+03  3.02974223e+03  3.02974223e+03  3.02974223e+03
  6.65030033e+03  6.65030033e+03  6.65030033e+03  9.05662206e+03
  2.54125320e+04  7.61552433e+04]
E1 = -727.8054111573534  E_coul = 201.08145966949905
cycle= 1 E= -526.723951487854  delta_E= -0.395  |g|= 0.19  |ddm|= 0.321
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547176
diis-c [-0.29940155  1.        ]
  HOMO = -0.590018845655192  LUMO = 0.153204895010077
  mo_energy =
[-1.18638598e+02 -1.23402042e+01 -9.59843487e+00 -9.59843487e+00
 -9.59843487e+00 -1.27759960e+00 -5.90018846e-01 -5.90018846e-01
 -5.90018846e-01  1.53204895e-01  1.00541849e+00  1.00541849e+00
  1.00541849e+00  1.56650996e+00  7.23893395e+00  7.23893395e+00
  7.23893395e+00  1.13603337e+01  3.33432357e+01  3.33432357e+01
  3.33432357e+01  1.01256234e+02  1.28889951e+02  1.28889951e+02
  1.28889951e+02  4.83218423e+02  4.83218423e+02  4.83218423e+02
  5.81499862e+02  1.33505860e+03  1.33505860e+03  1.33505860e+03
  2.65015176e+03  3.02930687e+03  3.02930687e+03  3.02930687e+03
  6.64975184e+03  6.64975184e+03  6.64975184e+03  9.05599829e+03
  2.54118144e+04  7.61544357e+04]
E1 = -728.3868146327327  E_coul = 201.6621098667577
cycle= 2 E= -526.724704765975  delta_E= -0.000753  |g|= 0.0385  |ddm|= 0.0573
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0770968
diis-c [-0.00333849  0.08576407  0.91423593]
  HOMO = -0.580913016516124  LUMO = 0.154370526419604
  mo_energy =
[-1.18569858e+02 -1.23017684e+01 -9.55839523e+00 -9.55839523e+00
 -9.55839523e+00 -1.26669191e+00 -5.80913017e-01 -5.80913017e-01
 -5.80913017e-01  1.54370526e-01  1.01209686e+00  1.01209686e+00
  1.01209686e+00  1.57567885e+00  7.26277381e+00  7.26277381e+00
  7.26277381e+00  1.13884121e+01  3.33836693e+01  3.33836693e+01
  3.33836693e+01  1.01312347e+02  1.28946608e+02  1.28946608e+02
  1.28946608e+02  4.83286322e+02  4.83286322e+02  4.83286322e+02
  5.81570158e+02  1.33513062e+03  1.33513062e+03  1.33513062e+03
  2.65022713e+03  3.02938115e+03  3.02938115e+03  3.02938115e+03
  6.64982786e+03  6.64982786e+03  6.64982786e+03  9.05607513e+03
  2.54118918e+04  7.61545134e+04]
E1 = -728.2344497120655  E_coul = 201.50968388935132
cycle= 3 E= -526.724765822714  delta_E= -6.11e-05  |g|= 0.00625  |ddm|= 0.0156
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132306
diis-c [-9.64650257e-07 -1.36480698e-03  1.41365936e-01  8.59998871e-01]
  HOMO = -0.582410199193621  LUMO = 0.154195675767594
  mo_energy =
[-1.18579752e+02 -1.23075313e+01 -9.56453074e+00 -9.56453074e+00
 -9.56453074e+00 -1.26837063e+00 -5.82410199e-01 -5.82410199e-01
 -5.82410199e-01  1.54195676e-01  1.01101952e+00  1.01101952e+00
  1.01101952e+00  1.57426501e+00  7.25901011e+00  7.25901011e+00
  7.25901011e+00  1.13841477e+01  3.33775222e+01  3.33775222e+01
  3.33775222e+01  1.01304177e+02  1.28938307e+02  1.28938307e+02
  1.28938307e+02  4.83276541e+02  4.83276541e+02  4.83276541e+02
  5.81560021e+02  1.33512025e+03  1.33512025e+03  1.33512025e+03
  2.65021611e+03  3.02937039e+03  3.02937039e+03  3.02937039e+03
  6.64981669e+03  6.64981669e+03  6.64981669e+03  9.05606374e+03
  2.54118802e+04  7.61545017e+04]
E1 = -728.2570532744658  E_coul = 201.53228554784812
cycle= 4 E= -526.724767726618  delta_E= -1.9e-06  |g|= 0.00011  |ddm|= 0.00229
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000162364
diis-c [-9.63356445e-09  1.05591085e-04 -1.40038346e-02 -9.18588446e-02
  1.10575709e+00]
  HOMO = -0.582393875164633  LUMO = 0.154201756396009
  mo_energy =
[-1.18579717e+02 -1.23074646e+01 -9.56448136e+00 -9.56448136e+00
 -9.56448136e+00 -1.26832869e+00 -5.82393875e-01 -5.82393875e-01
 -5.82393875e-01  1.54201756e-01  1.01103330e+00  1.01103330e+00
  1.01103330e+00  1.57429811e+00  7.25905044e+00  7.25905044e+00
  7.25905044e+00  1.13842056e+01  3.33775694e+01  3.33775694e+01
  3.33775694e+01  1.01304227e+02  1.28938352e+02  1.28938352e+02
  1.28938352e+02  4.83276577e+02  4.83276577e+02  4.83276577e+02
  5.81560047e+02  1.33512027e+03  1.33512027e+03  1.33512027e+03
  2.65021611e+03  3.02937040e+03  3.02937040e+03  3.02937040e+03
  6.64981669e+03  6.64981669e+03  6.64981669e+03  9.05606372e+03
  2.54118802e+04  7.61545017e+04]
E1 = -728.2568149489776  E_coul = 201.53204722005037
cycle= 5 E= -526.724767728927  delta_E= -2.31e-09  |g|= 2.19e-05  |ddm|= 0.000138
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.07238e-05
diis-c [-1.70695475e-10  1.18119233e-05 -1.35010723e-03 -1.10594180e-02
  1.09339713e-02  1.00146374e+00]
  HOMO = -0.582403347699759  LUMO = 0.154201065217066
  mo_energy =
[-1.18579753e+02 -1.23074925e+01 -9.56451109e+00 -9.56451109e+00
 -9.56451109e+00 -1.26833684e+00 -5.82403348e-01 -5.82403348e-01
 -5.82403348e-01  1.54201065e-01  1.01102688e+00  1.01102688e+00
  1.01102688e+00  1.57429102e+00  7.25902989e+00  7.25902989e+00
  7.25902989e+00  1.13841839e+01  3.33775406e+01  3.33775406e+01
  3.33775406e+01  1.01304194e+02  1.28938318e+02  1.28938318e+02
  1.28938318e+02  4.83276541e+02  4.83276541e+02  4.83276541e+02
  5.81560011e+02  1.33512024e+03  1.33512024e+03  1.33512024e+03
  2.65021607e+03  3.02937036e+03  3.02937036e+03  3.02937036e+03
  6.64981665e+03  6.64981665e+03  6.64981665e+03  9.05606368e+03
  2.54118801e+04  7.61545016e+04]
E1 = -728.2569116716328  E_coul = 201.53214394263688
cycle= 6 E= -526.724767728996  delta_E= -6.86e-11  |g|= 2.1e-06  |ddm|= 1.74e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2569116716328  E_coul = 201.53214394263688
  HOMO = -0.582402829677236  LUMO = 0.154201196156738
  mo_energy =
[-1.18579750e+02 -1.23074905e+01 -9.56450898e+00 -9.56450898e+00
 -9.56450898e+00 -1.26833588e+00 -5.82402830e-01 -5.82402830e-01
 -5.82402830e-01  1.54201196e-01  1.01102730e+00  1.01102730e+00
  1.01102730e+00  1.57429178e+00  7.25903127e+00  7.25903127e+00
  7.25903127e+00  1.13841855e+01  3.33775427e+01  3.33775427e+01
  3.33775427e+01  1.01304197e+02  1.28938321e+02  1.28938321e+02
  1.28938321e+02  4.83276544e+02  4.83276544e+02  4.83276544e+02
  5.81560014e+02  1.33512024e+03  1.33512024e+03  1.33512024e+03
  2.65021607e+03  3.02937036e+03  3.02937036e+03  3.02937036e+03
  6.64981665e+03  6.64981665e+03  6.64981665e+03  9.05606369e+03
  2.54118801e+04  7.61545016e+04]
E1 = -728.2569030742509  E_coul = 201.53213534525477
Extra cycle  E= -526.724767728996  delta_E= -2.27e-13  |g|= 5.49e-07  |ddm|= 2.7e-06
    CPU time for scf_cycle      0.31 sec, wall time      0.27 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 104116.58447901596
E1 = -728.2569030742509  E_coul = 201.53213534525477
init E= -526.724767728996
    CPU time for initialize scf      1.08 sec, wall time      0.57 sec
  HOMO = -0.582403015043799  LUMO = 0.154201186696928
  mo_energy =
[-1.18579751e+02 -1.23074911e+01 -9.56450965e+00 -9.56450965e+00
 -9.56450965e+00 -1.26833602e+00 -5.82403015e-01 -5.82403015e-01
 -5.82403015e-01  1.54201187e-01  1.01102717e+00  1.01102717e+00
  1.01102717e+00  1.57429166e+00  7.25903084e+00  7.25903084e+00
  7.25903084e+00  1.13841851e+01  3.33775420e+01  3.33775420e+01
  3.33775420e+01  1.01304196e+02  1.28938320e+02  1.28938320e+02
  1.28938320e+02  4.83276543e+02  4.83276543e+02  4.83276543e+02
  5.81560013e+02  1.33512024e+03  1.33512024e+03  1.33512024e+03
  2.65021607e+03  3.02937036e+03  3.02937036e+03  3.02937036e+03
  6.64981665e+03  6.64981665e+03  6.64981665e+03  9.05606368e+03
  2.54118801e+04  7.61545016e+04]
E1 = -728.2569052952263  E_coul = 201.53213756623003
cycle= 1 E= -526.724767728996  delta_E= -1.14e-13  |g|= 1.56e-07  |ddm|= 4.47e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2569052952263  E_coul = 201.53213756623003
  HOMO = -0.582402977270424  LUMO = 0.154201194259396
  mo_energy =
[-1.18579751e+02 -1.23074909e+01 -9.56450948e+00 -9.56450948e+00
 -9.56450948e+00 -1.26833596e+00 -5.82402977e-01 -5.82402977e-01
 -5.82402977e-01  1.54201194e-01  1.01102720e+00  1.01102720e+00
  1.01102720e+00  1.57429171e+00  7.25903095e+00  7.25903095e+00
  7.25903095e+00  1.13841852e+01  3.33775422e+01  3.33775422e+01
  3.33775422e+01  1.01304196e+02  1.28938320e+02  1.28938320e+02
  1.28938320e+02  4.83276543e+02  4.83276543e+02  4.83276543e+02
  5.81560013e+02  1.33512024e+03  1.33512024e+03  1.33512024e+03
  2.65021607e+03  3.02937036e+03  3.02937036e+03  3.02937036e+03
  6.64981665e+03  6.64981665e+03  6.64981665e+03  9.05606368e+03
  2.54118801e+04  7.61545016e+04]
E1 = -728.2569046256411  E_coul = 201.53213689664415
Extra cycle  E= -526.724767728997  delta_E= -7.96e-13  |g|= 4.14e-08  |ddm|= 1.33e-07
    CPU time for scf_cycle      2.07 sec, wall time      1.56 sec
exp = [2.61826559e+04 7.61752192e+03 3.61735087e+03 1.59782569e+03
 3.82851149e+02 1.08121083e+02 3.48054691e+01 7.58522391e+00
 2.58522391e+00 7.95313491e-01 2.95313491e-01 5.95313491e-02
 1.36278321e+03 6.64745681e+02 3.00961992e+02 3.14042274e+02
 6.16222359e+01 7.32989795e+00 2.02391201e+01 7.72070365e-01
 2.80887843e+00 2.22573632e-01]
grad_E = [-1.51747422e-06  3.30458946e-06 -1.58766633e-06  6.91835151e-05
 -2.83800507e-05 -4.09584498e-04 -2.00254597e-03  1.94567911e-02
 -5.26073345e-02 -1.96531200e-02  4.22025781e-02 -3.31979977e-02
 -5.03964665e-07  5.04443011e-06  2.38386049e-05  2.05532944e-05
 -3.88972943e-05 -1.37593839e-04  1.42830853e-04 -9.27501222e-03
  1.71881638e-04  2.56337523e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:25 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558568        1
[INPUT] 0    0    [1    /1   ]  7617.52191232        1
[INPUT] 0    0    [1    /1   ]  3617.35086901        1
[INPUT] 0    0    [1    /1   ]  1597.82562385        1
[INPUT] 0    0    [1    /1   ]  382.851177853        1
[INPUT] 0    0    [1    /1   ]  108.121492987        1
[INPUT] 0    0    [1    /1   ]  34.8074716157        1
[INPUT] 0    0    [1    /1   ]  7.56576711422        1
[INPUT] 0    0    [1    /1   ]  2.63783123982        1
[INPUT] 0    0    [1    /1   ]  0.814966610545       1
[INPUT] 0    0    [1    /1   ]  0.253110912449       1
[INPUT] 0    0    [1    /1   ]  0.0927293467688      1
[INPUT] 1    0    [1    /1   ]  1362.78320677        1
[INPUT] 1    0    [1    /1   ]  664.745675943        1
[INPUT] 1    0    [1    /1   ]  300.961967736        1
[INPUT] 1    0    [1    /1   ]  314.042253446        1
[INPUT] 1    0    [1    /1   ]  61.6222747611        1
[INPUT] 1    0    [1    /1   ]  7.33003554225        1
[INPUT] 1    0    [1    /1   ]  20.2389772987        1
[INPUT] 1    0    [1    /1   ]  0.781345376794       1
[INPUT] 1    0    [1    /1   ]  2.80870655317        1
[INPUT] 1    0    [1    /1   ]  0.196939879693       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655856766014, 1.0]], [0, [7617.521912322462, 1.0]], [0, [3617.3508690122367, 1.0]], [0, [1597.8256238455874, 1.0]], [0, [382.85117785305596, 1.0]], [0, [108.12149298749178, 1.0]], [0, [34.80747161572131, 1.0]], [0, [7.5657671142214085, 1.0]], [0, [2.637831239815344, 1.0]], [0, [0.8149666105452128, 1.0]], [0, [0.2531109124485412, 1.0]], [0, [0.09272934676879514, 1.0]], [1, [1362.783206770576, 1.0]], [1, [664.7456759427622, 1.0]], [1, [300.96196773584575, 1.0]], [1, [314.04225344587593, 1.0]], [1, [61.62227476110818, 1.0]], [1, [7.330035542245731, 1.0]], [1, [20.2389772986977, 1.0]], [1, [0.7813453767942704, 1.0]], [1, [2.808706553172339, 1.0]], [1, [0.19693987969269747, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65585677]
bas 1, expnt(s) = [7617.52191232]
bas 2, expnt(s) = [3617.35086901]
bas 3, expnt(s) = [1597.82562385]
bas 4, expnt(s) = [382.85117785]
bas 5, expnt(s) = [108.12149299]
bas 6, expnt(s) = [34.80747162]
bas 7, expnt(s) = [7.56576711]
bas 8, expnt(s) = [2.63783124]
bas 9, expnt(s) = [0.81496661]
bas 10, expnt(s) = [0.25311091]
bas 11, expnt(s) = [0.09272935]
bas 12, expnt(s) = [1362.78320677]
bas 13, expnt(s) = [664.74567594]
bas 14, expnt(s) = [300.96196774]
bas 15, expnt(s) = [314.04225345]
bas 16, expnt(s) = [61.62227476]
bas 17, expnt(s) = [7.33003554]
bas 18, expnt(s) = [20.2389773]
bas 19, expnt(s) = [0.78134538]
bas 20, expnt(s) = [2.80870655]
bas 21, expnt(s) = [0.19693988]
CPU time:        11.40
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752191e+03 2.06003836e+03
 3.61735087e+03 1.17844143e+03 1.59782562e+03 6.38501704e+02
 3.82851178e+02 2.18669149e+02 1.08121493e+02 8.47128026e+01
 3.48074716e+01 3.62050692e+01 7.56576711e+00 1.15253667e+01
 2.63783124e+00 5.22938094e+00 8.14966611e-01 2.16705476e+00
 2.53110912e-01 9.01567352e-01 9.27293468e-02 4.24549100e-01
 1.36278321e+03 2.41556017e+04 6.64745676e+02 9.84699673e+03
 3.00961968e+02 3.65699119e+03 3.14042253e+02 3.85673233e+03
 6.16222748e+01 5.03682138e+02 7.33003554e+00 3.51857646e+01
 2.02389773e+01 1.25233378e+02 7.81345377e-01 2.14307910e+00
 2.80870655e+00 1.06076053e+01 1.96939880e-01 3.82737907e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.98915646203205
cond(S) = 104386.48835769344
E1 = -729.453687383127  E_coul = 203.14670961083726
init E= -526.30697777229
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.557669041232979  LUMO = 0.215806493183166
  mo_energy =
[-1.18326153e+02 -1.22025179e+01 -9.44731452e+00 -9.44731452e+00
 -9.44731452e+00 -1.24242641e+00 -5.57669041e-01 -5.57669041e-01
 -5.57669041e-01  2.15806493e-01  9.30279771e-01  9.30279771e-01
  9.30279771e-01  1.65035693e+00  7.26551379e+00  7.26551379e+00
  7.26551379e+00  1.16246450e+01  3.34589525e+01  3.34589525e+01
  3.34589525e+01  1.01674971e+02  1.29093557e+02  1.29093557e+02
  1.29093557e+02  4.83508648e+02  4.83508648e+02  4.83508648e+02
  5.82008147e+02  1.33540816e+03  1.33540816e+03  1.33540816e+03
  2.65078973e+03  3.02972400e+03  3.02972400e+03  3.02972400e+03
  6.65028355e+03  6.65028355e+03  6.65028355e+03  9.05674427e+03
  2.54126473e+04  7.61553505e+04]
E1 = -727.3112583420736  E_coul = 200.5961583408861
cycle= 1 E= -526.715100001188  delta_E= -0.408  |g|= 0.199  |ddm|= 0.641
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.554519
diis-c [-0.30749178  1.        ]
  HOMO = -0.608384604502057  LUMO = 0.20845691185217
  mo_energy =
[-1.18672214e+02 -1.23727501e+01 -9.62993333e+00 -9.62993333e+00
 -9.62993333e+00 -1.30033300e+00 -6.08384605e-01 -6.08384605e-01
 -6.08384605e-01  2.08456912e-01  8.96703257e-01  8.96703257e-01
  8.96703257e-01  1.60355073e+00  7.14523947e+00  7.14523947e+00
  7.14523947e+00  1.14934686e+01  3.32711865e+01  3.32711865e+01
  3.32711865e+01  1.01419529e+02  1.28828610e+02  1.28828610e+02
  1.28828610e+02  4.83163644e+02  4.83163644e+02  4.83163644e+02
  5.81625339e+02  1.33500644e+03  1.33500644e+03  1.33500644e+03
  2.65025332e+03  3.02925593e+03  3.02925593e+03  3.02925593e+03
  6.64970217e+03  6.64970217e+03  6.64970217e+03  9.05608753e+03
  2.54118966e+04  7.61545098e+04]
E1 = -728.0561089435804  E_coul = 201.3399110961412
cycle= 2 E= -526.716197847439  delta_E= -0.0011  |g|= 0.0457  |ddm|= 0.0705
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0908744
diis-c [-0.00432923  0.1022059   0.8977941 ]
  HOMO = -0.596160002231036  LUMO = 0.210703833383797
  mo_energy =
[-1.18590102e+02 -1.23240557e+01 -9.57928952e+00 -9.57928952e+00
 -9.57928952e+00 -1.28572627e+00 -5.96160002e-01 -5.96160002e-01
 -5.96160002e-01  2.10703833e-01  9.05320019e-01  9.05320019e-01
  9.05320019e-01  1.61536577e+00  7.17637820e+00  7.17637820e+00
  7.17637820e+00  1.15296784e+01  3.33219678e+01  3.33219678e+01
  3.33219678e+01  1.01487715e+02  1.28897473e+02  1.28897473e+02
  1.28897473e+02  4.83244812e+02  4.83244812e+02  4.83244812e+02
  5.81709102e+02  1.33509210e+03  1.33509210e+03  1.33509210e+03
  2.65034264e+03  3.02934406e+03  3.02934406e+03  3.02934406e+03
  6.64979223e+03  6.64979223e+03  6.64979223e+03  9.05617851e+03
  2.54119882e+04  7.61546017e+04]
E1 = -727.8491470645546  E_coul = 201.1328429099606
cycle= 3 E= -526.716304154594  delta_E= -0.000106  |g|= 0.00758  |ddm|= 0.0211
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0156033
diis-c [-1.06672387e-06 -1.42838094e-03  1.41884396e-01  8.59543985e-01]
  HOMO = -0.598166134743283  LUMO = 0.210339227376996
  mo_energy =
[-1.18602011e+02 -1.23312961e+01 -9.58693841e+00 -9.58693841e+00
 -9.58693841e+00 -1.28804074e+00 -5.98166135e-01 -5.98166135e-01
 -5.98166135e-01  2.10339227e-01  9.03920165e-01  9.03920165e-01
  9.03920165e-01  1.61347948e+00  7.17149883e+00  7.17149883e+00
  7.17149883e+00  1.15241838e+01  3.33143129e+01  3.33143129e+01
  3.33143129e+01  1.01477749e+02  1.28887359e+02  1.28887359e+02
  1.28887359e+02  4.83233034e+02  4.83233034e+02  4.83233034e+02
  5.81696934e+02  1.33507966e+03  1.33507966e+03  1.33507966e+03
  2.65032951e+03  3.02933120e+03  3.02933120e+03  3.02933120e+03
  6.64977894e+03  6.64977894e+03  6.64977894e+03  9.05616498e+03
  2.54119745e+04  7.61545879e+04]
E1 = -727.8799026829649  E_coul = 201.16359521186928
cycle= 4 E= -526.716307471096  delta_E= -3.32e-06  |g|= 8.38e-05  |ddm|= 0.00312
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000123204
diis-c [-7.26521055e-09  5.78290110e-05 -8.48812962e-03 -5.51201773e-02
  1.06355048e+00]
  HOMO = -0.598147933710394  LUMO = 0.210345374729809
  mo_energy =
[-1.18601966e+02 -1.23312223e+01 -9.58687830e+00 -9.58687830e+00
 -9.58687830e+00 -1.28800580e+00 -5.98147934e-01 -5.98147934e-01
 -5.98147934e-01  2.10345375e-01  9.03933884e-01  9.03933884e-01
  9.03933884e-01  1.61350542e+00  7.17154323e+00  7.17154323e+00
  7.17154323e+00  1.15242431e+01  3.33143683e+01  3.33143683e+01
  3.33143683e+01  1.01477806e+02  1.28887412e+02  1.28887412e+02
  1.28887412e+02  4.83233078e+02  4.83233078e+02  4.83233078e+02
  5.81696971e+02  1.33507970e+03  1.33507970e+03  1.33507970e+03
  2.65032953e+03  3.02933123e+03  3.02933123e+03  3.02933123e+03
  6.64977895e+03  6.64977895e+03  6.64977895e+03  9.05616498e+03
  2.54119745e+04  7.61545878e+04]
E1 = -727.8796173481691  E_coul = 201.1633098761996
cycle= 5 E= -526.716307471969  delta_E= -8.74e-10  |g|= 2.13e-05  |ddm|= 9.11e-05
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
E1 = -727.8796173481691  E_coul = 201.1633098761996
  HOMO = -0.598158706215245  LUMO = 0.210343833782176
  mo_energy =
[-1.18602011e+02 -1.23312554e+01 -9.58691325e+00 -9.58691325e+00
 -9.58691325e+00 -1.28801655e+00 -5.98158706e-01 -5.98158706e-01
 -5.98158706e-01  2.10343834e-01  9.03926622e-01  9.03926622e-01
  9.03926622e-01  1.61349647e+00  7.17151913e+00  7.17151913e+00
  7.17151913e+00  1.15242172e+01  3.33143341e+01  3.33143341e+01
  3.33143341e+01  1.01477766e+02  1.28887371e+02  1.28887371e+02
  1.28887371e+02  4.83233034e+02  4.83233034e+02  4.83233034e+02
  5.81696926e+02  1.33507965e+03  1.33507965e+03  1.33507965e+03
  2.65032948e+03  3.02933118e+03  3.02933118e+03  3.02933118e+03
  6.64977891e+03  6.64977891e+03  6.64977891e+03  9.05616493e+03
  2.54119744e+04  7.61545878e+04]
E1 = -727.8797499950049  E_coul = 201.16344252298248
Extra cycle  E= -526.716307472022  delta_E= -5.3e-11  |g|= 7.49e-06  |ddm|= 1.71e-05
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
exp = [2.61826559e+04 7.61752191e+03 3.61735087e+03 1.59782562e+03
 3.82851178e+02 1.08121493e+02 3.48074716e+01 7.56576711e+00
 2.63783124e+00 8.14966611e-01 2.53110912e-01 9.27293468e-02
 1.36278321e+03 6.64745676e+02 3.00961968e+02 3.14042253e+02
 6.16222748e+01 7.33003554e+00 2.02389773e+01 7.81345377e-01
 2.80870655e+00 1.96939880e-01]
E = -526.7163074720224
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:25 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558556        1
[INPUT] 0    0    [1    /1   ]  7617.52191487        1
[INPUT] 0    0    [1    /1   ]  3617.35086779        1
[INPUT] 0    0    [1    /1   ]  1597.82567717        1
[INPUT] 0    0    [1    /1   ]  382.851155979        1
[INPUT] 0    0    [1    /1   ]  108.121177296        1
[INPUT] 0    0    [1    /1   ]  34.8059281323        1
[INPUT] 0    0    [1    /1   ]  7.58076364101        1
[INPUT] 0    0    [1    /1   ]  2.5972835824         1
[INPUT] 0    0    [1    /1   ]  0.799818761212       1
[INPUT] 0    0    [1    /1   ]  0.285638994254       1
[INPUT] 0    0    [1    /1   ]  0.0671416401933      1
[INPUT] 1    0    [1    /1   ]  1362.78320638        1
[INPUT] 1    0    [1    /1   ]  664.745679831        1
[INPUT] 1    0    [1    /1   ]  300.96198611         1
[INPUT] 1    0    [1    /1   ]  314.042269288        1
[INPUT] 1    0    [1    /1   ]  61.6222447806        1
[INPUT] 1    0    [1    /1   ]  7.32992949034        1
[INPUT] 1    0    [1    /1   ]  20.2390873871        1
[INPUT] 1    0    [1    /1   ]  0.774196563385       1
[INPUT] 1    0    [1    /1   ]  2.80883903276        1
[INPUT] 1    0    [1    /1   ]  0.21669736444        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655855596404, 1.0]], [0, [7617.52191486951, 1.0]], [0, [3617.350867788526, 1.0]], [0, [1597.8256771695108, 1.0]], [0, [382.8511559788328, 1.0]], [0, [108.12117729592356, 1.0]], [0, [34.80592813231495, 1.0]], [0, [7.580763641012995, 1.0]], [0, [2.5972835823987204, 1.0]], [0, [0.7998187612116223, 1.0]], [0, [0.2856389942539543, 1.0]], [0, [0.06714164019331524, 1.0]], [1, [1362.78320638214, 1.0]], [1, [664.7456798308099, 1.0]], [1, [300.9619861097017, 1.0]], [1, [314.0422692875441, 1.0]], [1, [61.6222447806087, 1.0]], [1, [7.329929490344173, 1.0]], [1, [20.239087387082975, 1.0]], [1, [0.7741965633849637, 1.0]], [1, [2.808839032755781, 1.0]], [1, [0.21669736444034818, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6558556]
bas 1, expnt(s) = [7617.52191487]
bas 2, expnt(s) = [3617.35086779]
bas 3, expnt(s) = [1597.82567717]
bas 4, expnt(s) = [382.85115598]
bas 5, expnt(s) = [108.1211773]
bas 6, expnt(s) = [34.80592813]
bas 7, expnt(s) = [7.58076364]
bas 8, expnt(s) = [2.59728358]
bas 9, expnt(s) = [0.79981876]
bas 10, expnt(s) = [0.28563899]
bas 11, expnt(s) = [0.06714164]
bas 12, expnt(s) = [1362.78320638]
bas 13, expnt(s) = [664.74567983]
bas 14, expnt(s) = [300.96198611]
bas 15, expnt(s) = [314.04226929]
bas 16, expnt(s) = [61.62224478]
bas 17, expnt(s) = [7.32992949]
bas 18, expnt(s) = [20.23908739]
bas 19, expnt(s) = [0.77419656]
bas 20, expnt(s) = [2.80883903]
bas 21, expnt(s) = [0.21669736]
CPU time:        11.70
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752191e+03 2.06003836e+03
 3.61735087e+03 1.17844143e+03 1.59782568e+03 6.38501720e+02
 3.82851156e+02 2.18669140e+02 1.08121177e+02 8.47126170e+01
 3.48059281e+01 3.62038651e+01 7.58076364e+00 1.15424962e+01
 2.59728358e+00 5.16897643e+00 7.99818761e-01 2.13677461e+00
 2.85638994e-01 9.87138626e-01 6.71416402e-02 3.33241426e-01
 1.36278321e+03 2.41556016e+04 6.64745680e+02 9.84699680e+03
 3.00961986e+02 3.65699147e+03 3.14042269e+02 3.85673258e+03
 6.16222448e+01 5.03681832e+02 7.32992949e+00 3.51851283e+01
 2.02390874e+01 1.25234230e+02 7.74196563e-01 2.11859743e+00
 2.80883903e+00 1.06082307e+01 2.16697364e-01 4.31321820e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99381373110458
cond(S) = 104179.46667314765
E1 = -729.5140610411553  E_coul = 203.18085182338552
init E= -526.33320921777
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556396500215935  LUMO = 0.172276712463336
  mo_energy =
[-1.18324715e+02 -1.22008232e+01 -9.44626474e+00 -9.44626474e+00
 -9.44626474e+00 -1.23995112e+00 -5.56396500e-01 -5.56396500e-01
 -5.56396500e-01  1.72276712e-01  1.00751568e+00  1.00751568e+00
  1.00751568e+00  1.61230719e+00  7.31534236e+00  7.31534236e+00
  7.31534236e+00  1.14993051e+01  3.34910780e+01  3.34910780e+01
  3.34910780e+01  1.01525054e+02  1.29116637e+02  1.29116637e+02
  1.29116637e+02  4.83526392e+02  4.83526392e+02  4.83526392e+02
  5.81886286e+02  1.33542351e+03  1.33542351e+03  1.33542351e+03
  2.65068610e+03  3.02973831e+03  3.02973831e+03  3.02973831e+03
  6.65029675e+03  6.65029675e+03  6.65029675e+03  9.05665003e+03
  2.54125584e+04  7.61552679e+04]
E1 = -727.6883914944162  E_coul = 200.96368269208799
cycle= 1 E= -526.724708802328  delta_E= -0.391  |g|= 0.192  |ddm|= 0.284
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.549083
diis-c [-0.30149199  1.        ]
  HOMO = -0.594666410152153  LUMO = 0.168432900204277
  mo_energy =
[-1.18647066e+02 -1.23482191e+01 -9.60621735e+00 -9.60621735e+00
 -9.60621735e+00 -1.28314833e+00 -5.94666410e-01 -5.94666410e-01
 -5.94666410e-01  1.68432900e-01  9.80919308e-01  9.80919308e-01
  9.80919308e-01  1.57664168e+00  7.21691982e+00  7.21691982e+00
  7.21691982e+00  1.13901825e+01  3.33259081e+01  3.33259081e+01
  3.33259081e+01  1.01292379e+02  1.28874999e+02  1.28874999e+02
  1.28874999e+02  4.83204949e+02  4.83204949e+02  4.83204949e+02
  5.81527306e+02  1.33504572e+03  1.33504572e+03  1.33504572e+03
  2.65017376e+03  3.02929426e+03  3.02929426e+03  3.02929426e+03
  6.64973952e+03  6.64973952e+03  6.64973952e+03  9.05601749e+03
  2.54118320e+04  7.61544515e+04]
E1 = -728.3073448326875  E_coul = 201.58181053615795
cycle= 2 E= -526.72553429653  delta_E= -0.000825  |g|= 0.0402  |ddm|= 0.06
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0803282
diis-c [-0.00356119  0.08967942  0.91032058]
  HOMO = -0.584850274068925  LUMO = 0.169832650698603
  mo_energy =
[-1.18575165e+02 -1.23073953e+01 -9.56370731e+00 -9.56370731e+00
 -9.56370731e+00 -1.27139827e+00 -5.84850274e-01 -5.84850274e-01
 -5.84850274e-01  1.69832651e-01  9.88056175e-01  9.88056175e-01
  9.88056175e-01  1.58642157e+00  7.24243778e+00  7.24243778e+00
  7.24243778e+00  1.14201362e+01  3.33687541e+01  3.33687541e+01
  3.33687541e+01  1.01351331e+02  1.28934526e+02  1.28934526e+02
  1.28934526e+02  4.83275983e+02  4.83275983e+02  4.83275983e+02
  5.81600787e+02  1.33512097e+03  1.33512097e+03  1.33512097e+03
  2.65025243e+03  3.02937182e+03  3.02937182e+03  3.02937182e+03
  6.64981887e+03  6.64981887e+03  6.64981887e+03  9.05609768e+03
  2.54119128e+04  7.61545325e+04]
E1 = -728.1432584610023  E_coul = 201.4176542960225
cycle= 3 E= -526.72560416498  delta_E= -6.99e-05  |g|= 0.00654  |ddm|= 0.0168
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0137647
diis-c [-9.67216381e-07 -1.37444595e-03  1.41317846e-01  8.60056600e-01]
  HOMO = -0.586454383963368  LUMO = 0.169620623916888
  mo_energy =
[-1.18585505e+02 -1.23134773e+01 -9.57017143e+00 -9.57017143e+00
 -9.57017143e+00 -1.27320613e+00 -5.86454384e-01 -5.86454384e-01
 -5.86454384e-01  1.69620624e-01  9.86910000e-01  9.86910000e-01
  9.86910000e-01  1.58491111e+00  7.23843681e+00  7.23843681e+00
  7.23843681e+00  1.14156095e+01  3.33622796e+01  3.33622796e+01
  3.33622796e+01  1.01342767e+02  1.28925827e+02  1.28925827e+02
  1.28925827e+02  4.83265760e+02  4.83265760e+02  4.83265760e+02
  5.81590199e+02  1.33511014e+03  1.33511014e+03  1.33511014e+03
  2.65024094e+03  3.02936059e+03  3.02936059e+03  3.02936059e+03
  6.64980723e+03  6.64980723e+03  6.64980723e+03  9.05608581e+03
  2.54119007e+04  7.61545203e+04]
E1 = -728.167502760634  E_coul = 201.44189643405716
cycle= 4 E= -526.725606326577  delta_E= -2.16e-06  |g|= 0.000107  |ddm|= 0.00245
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000160025
diis-c [-9.32174394e-09  9.96302591e-05 -1.32506448e-02 -8.71656680e-02
  1.10031668e+00]
  HOMO = -0.586439381920361  LUMO = 0.169626965174159
  mo_energy =
[-1.18585475e+02 -1.23134139e+01 -9.57012519e+00 -9.57012519e+00
 -9.57012519e+00 -1.27316665e+00 -5.86439382e-01 -5.86439382e-01
 -5.86439382e-01  1.69626965e-01  9.86922715e-01  9.86922715e-01
  9.86922715e-01  1.58494167e+00  7.23847429e+00  7.23847429e+00
  7.23847429e+00  1.14156639e+01  3.33623233e+01  3.33623233e+01
  3.33623233e+01  1.01342813e+02  1.28925867e+02  1.28925867e+02
  1.28925867e+02  4.83265791e+02  4.83265791e+02  4.83265791e+02
  5.81590221e+02  1.33511016e+03  1.33511016e+03  1.33511016e+03
  2.65024094e+03  3.02936060e+03  3.02936060e+03  3.02936060e+03
  6.64980722e+03  6.64980722e+03  6.64980722e+03  9.05608579e+03
  2.54119007e+04  7.61545203e+04]
E1 = -728.1672715259166  E_coul = 201.44166519724408
cycle= 5 E= -526.725606328672  delta_E= -2.1e-09  |g|= 2.17e-05  |ddm|= 0.000131
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.03611e-05
diis-c [-1.66355928e-10  1.10590104e-05 -1.25723810e-03 -1.03486405e-02
  5.84308581e-03  1.00575173e+00]
  HOMO = -0.586448734054201  LUMO = 0.16962620117064
  mo_energy =
[-1.18585511e+02 -1.23134414e+01 -9.57015450e+00 -9.57015450e+00
 -9.57015450e+00 -1.27317471e+00 -5.86448734e-01 -5.86448734e-01
 -5.86448734e-01  1.69626201e-01  9.86916421e-01  9.86916421e-01
  9.86916421e-01  1.58493470e+00  7.23845398e+00  7.23845398e+00
  7.23845398e+00  1.14156425e+01  3.33622949e+01  3.33622949e+01
  3.33622949e+01  1.01342780e+02  1.28925834e+02  1.28925834e+02
  1.28925834e+02  4.83265756e+02  4.83265756e+02  4.83265756e+02
  5.81590185e+02  1.33511012e+03  1.33511012e+03  1.33511012e+03
  2.65024090e+03  3.02936056e+03  3.02936056e+03  3.02936056e+03
  6.64980718e+03  6.64980718e+03  6.64980718e+03  9.05608575e+03
  2.54119006e+04  7.61545203e+04]
E1 = -728.1673692690324  E_coul = 201.44176294029222
cycle= 6 E= -526.72560632874  delta_E= -6.78e-11  |g|= 2.16e-06  |ddm|= 1.74e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.1673692690324  E_coul = 201.44176294029222
  HOMO = -0.586448162455666  LUMO = 0.169626356992685
  mo_energy =
[-1.18585507e+02 -1.23134393e+01 -9.57015227e+00 -9.57015227e+00
 -9.57015227e+00 -1.27317369e+00 -5.86448162e-01 -5.86448162e-01
 -5.86448162e-01  1.69626357e-01  9.86916872e-01  9.86916872e-01
  9.86916872e-01  1.58493551e+00  7.23845547e+00  7.23845547e+00
  7.23845547e+00  1.14156443e+01  3.33622971e+01  3.33622971e+01
  3.33622971e+01  1.01342783e+02  1.28925837e+02  1.28925837e+02
  1.28925837e+02  4.83265759e+02  4.83265759e+02  4.83265759e+02
  5.81590188e+02  1.33511012e+03  1.33511012e+03  1.33511012e+03
  2.65024090e+03  3.02936057e+03  3.02936057e+03  3.02936057e+03
  6.64980718e+03  6.64980718e+03  6.64980718e+03  9.05608576e+03
  2.54119006e+04  7.61545203e+04]
E1 = -728.1673600688625  E_coul = 201.44175374012073
Extra cycle  E= -526.725606328742  delta_E= -1.59e-12  |g|= 5.74e-07  |ddm|= 2.7e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.27 sec
exp = [2.61826559e+04 7.61752191e+03 3.61735087e+03 1.59782568e+03
 3.82851156e+02 1.08121177e+02 3.48059281e+01 7.58076364e+00
 2.59728358e+00 7.99818761e-01 2.85638994e-01 6.71416402e-02
 1.36278321e+03 6.64745680e+02 3.00961986e+02 3.14042269e+02
 6.16222448e+01 7.32992949e+00 2.02390874e+01 7.74196563e-01
 2.80883903e+00 2.16697364e-01]
E = -526.7256063287418
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:26 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558556        1
[INPUT] 0    0    [1    /1   ]  7617.52191487        1
[INPUT] 0    0    [1    /1   ]  3617.35086779        1
[INPUT] 0    0    [1    /1   ]  1597.82567717        1
[INPUT] 0    0    [1    /1   ]  382.851155979        1
[INPUT] 0    0    [1    /1   ]  108.121177296        1
[INPUT] 0    0    [1    /1   ]  34.8059281323        1
[INPUT] 0    0    [1    /1   ]  7.58076364101        1
[INPUT] 0    0    [1    /1   ]  2.5972835824         1
[INPUT] 0    0    [1    /1   ]  0.799818761212       1
[INPUT] 0    0    [1    /1   ]  0.285638994254       1
[INPUT] 0    0    [1    /1   ]  0.0671416401933      1
[INPUT] 1    0    [1    /1   ]  1362.78320638        1
[INPUT] 1    0    [1    /1   ]  664.745679831        1
[INPUT] 1    0    [1    /1   ]  300.96198611         1
[INPUT] 1    0    [1    /1   ]  314.042269288        1
[INPUT] 1    0    [1    /1   ]  61.6222447806        1
[INPUT] 1    0    [1    /1   ]  7.32992949034        1
[INPUT] 1    0    [1    /1   ]  20.2390873871        1
[INPUT] 1    0    [1    /1   ]  0.774196563385       1
[INPUT] 1    0    [1    /1   ]  2.80883903276        1
[INPUT] 1    0    [1    /1   ]  0.21669736444        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655855596404, 1.0]], [0, [7617.52191486951, 1.0]], [0, [3617.350867788526, 1.0]], [0, [1597.8256771695108, 1.0]], [0, [382.8511559788328, 1.0]], [0, [108.12117729592356, 1.0]], [0, [34.80592813231495, 1.0]], [0, [7.580763641012995, 1.0]], [0, [2.5972835823987204, 1.0]], [0, [0.7998187612116223, 1.0]], [0, [0.2856389942539543, 1.0]], [0, [0.06714164019331524, 1.0]], [1, [1362.78320638214, 1.0]], [1, [664.7456798308099, 1.0]], [1, [300.9619861097017, 1.0]], [1, [314.0422692875441, 1.0]], [1, [61.6222447806087, 1.0]], [1, [7.329929490344173, 1.0]], [1, [20.239087387082975, 1.0]], [1, [0.7741965633849637, 1.0]], [1, [2.808839032755781, 1.0]], [1, [0.21669736444034818, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6558556]
bas 1, expnt(s) = [7617.52191487]
bas 2, expnt(s) = [3617.35086779]
bas 3, expnt(s) = [1597.82567717]
bas 4, expnt(s) = [382.85115598]
bas 5, expnt(s) = [108.1211773]
bas 6, expnt(s) = [34.80592813]
bas 7, expnt(s) = [7.58076364]
bas 8, expnt(s) = [2.59728358]
bas 9, expnt(s) = [0.79981876]
bas 10, expnt(s) = [0.28563899]
bas 11, expnt(s) = [0.06714164]
bas 12, expnt(s) = [1362.78320638]
bas 13, expnt(s) = [664.74567983]
bas 14, expnt(s) = [300.96198611]
bas 15, expnt(s) = [314.04226929]
bas 16, expnt(s) = [61.62224478]
bas 17, expnt(s) = [7.32992949]
bas 18, expnt(s) = [20.23908739]
bas 19, expnt(s) = [0.77419656]
bas 20, expnt(s) = [2.80883903]
bas 21, expnt(s) = [0.21669736]
CPU time:        12.04
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752191e+03 2.06003836e+03
 3.61735087e+03 1.17844143e+03 1.59782568e+03 6.38501720e+02
 3.82851156e+02 2.18669140e+02 1.08121177e+02 8.47126170e+01
 3.48059281e+01 3.62038651e+01 7.58076364e+00 1.15424962e+01
 2.59728358e+00 5.16897643e+00 7.99818761e-01 2.13677461e+00
 2.85638994e-01 9.87138626e-01 6.71416402e-02 3.33241426e-01
 1.36278321e+03 2.41556016e+04 6.64745680e+02 9.84699680e+03
 3.00961986e+02 3.65699147e+03 3.14042269e+02 3.85673258e+03
 6.16222448e+01 5.03681832e+02 7.32992949e+00 3.51851283e+01
 2.02390874e+01 1.25234230e+02 7.74196563e-01 2.11859743e+00
 2.80883903e+00 1.06082307e+01 2.16697364e-01 4.31321820e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99381373110458
cond(S) = 104179.46667314765
E1 = -729.5140610411553  E_coul = 203.18085182338552
init E= -526.33320921777
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.556396500215935  LUMO = 0.172276712463336
  mo_energy =
[-1.18324715e+02 -1.22008232e+01 -9.44626474e+00 -9.44626474e+00
 -9.44626474e+00 -1.23995112e+00 -5.56396500e-01 -5.56396500e-01
 -5.56396500e-01  1.72276712e-01  1.00751568e+00  1.00751568e+00
  1.00751568e+00  1.61230719e+00  7.31534236e+00  7.31534236e+00
  7.31534236e+00  1.14993051e+01  3.34910780e+01  3.34910780e+01
  3.34910780e+01  1.01525054e+02  1.29116637e+02  1.29116637e+02
  1.29116637e+02  4.83526392e+02  4.83526392e+02  4.83526392e+02
  5.81886286e+02  1.33542351e+03  1.33542351e+03  1.33542351e+03
  2.65068610e+03  3.02973831e+03  3.02973831e+03  3.02973831e+03
  6.65029675e+03  6.65029675e+03  6.65029675e+03  9.05665003e+03
  2.54125584e+04  7.61552679e+04]
E1 = -727.6883914944162  E_coul = 200.96368269208799
cycle= 1 E= -526.724708802328  delta_E= -0.391  |g|= 0.192  |ddm|= 0.284
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.549083
diis-c [-0.30149199  1.        ]
  HOMO = -0.594666410152153  LUMO = 0.168432900204277
  mo_energy =
[-1.18647066e+02 -1.23482191e+01 -9.60621735e+00 -9.60621735e+00
 -9.60621735e+00 -1.28314833e+00 -5.94666410e-01 -5.94666410e-01
 -5.94666410e-01  1.68432900e-01  9.80919308e-01  9.80919308e-01
  9.80919308e-01  1.57664168e+00  7.21691982e+00  7.21691982e+00
  7.21691982e+00  1.13901825e+01  3.33259081e+01  3.33259081e+01
  3.33259081e+01  1.01292379e+02  1.28874999e+02  1.28874999e+02
  1.28874999e+02  4.83204949e+02  4.83204949e+02  4.83204949e+02
  5.81527306e+02  1.33504572e+03  1.33504572e+03  1.33504572e+03
  2.65017376e+03  3.02929426e+03  3.02929426e+03  3.02929426e+03
  6.64973952e+03  6.64973952e+03  6.64973952e+03  9.05601749e+03
  2.54118320e+04  7.61544515e+04]
E1 = -728.3073448326875  E_coul = 201.58181053615795
cycle= 2 E= -526.72553429653  delta_E= -0.000825  |g|= 0.0402  |ddm|= 0.06
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0803282
diis-c [-0.00356119  0.08967942  0.91032058]
  HOMO = -0.584850274068925  LUMO = 0.169832650698603
  mo_energy =
[-1.18575165e+02 -1.23073953e+01 -9.56370731e+00 -9.56370731e+00
 -9.56370731e+00 -1.27139827e+00 -5.84850274e-01 -5.84850274e-01
 -5.84850274e-01  1.69832651e-01  9.88056175e-01  9.88056175e-01
  9.88056175e-01  1.58642157e+00  7.24243778e+00  7.24243778e+00
  7.24243778e+00  1.14201362e+01  3.33687541e+01  3.33687541e+01
  3.33687541e+01  1.01351331e+02  1.28934526e+02  1.28934526e+02
  1.28934526e+02  4.83275983e+02  4.83275983e+02  4.83275983e+02
  5.81600787e+02  1.33512097e+03  1.33512097e+03  1.33512097e+03
  2.65025243e+03  3.02937182e+03  3.02937182e+03  3.02937182e+03
  6.64981887e+03  6.64981887e+03  6.64981887e+03  9.05609768e+03
  2.54119128e+04  7.61545325e+04]
E1 = -728.1432584610023  E_coul = 201.4176542960225
cycle= 3 E= -526.72560416498  delta_E= -6.99e-05  |g|= 0.00654  |ddm|= 0.0168
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0137647
diis-c [-9.67216381e-07 -1.37444595e-03  1.41317846e-01  8.60056600e-01]
  HOMO = -0.586454383963368  LUMO = 0.169620623916888
  mo_energy =
[-1.18585505e+02 -1.23134773e+01 -9.57017143e+00 -9.57017143e+00
 -9.57017143e+00 -1.27320613e+00 -5.86454384e-01 -5.86454384e-01
 -5.86454384e-01  1.69620624e-01  9.86910000e-01  9.86910000e-01
  9.86910000e-01  1.58491111e+00  7.23843681e+00  7.23843681e+00
  7.23843681e+00  1.14156095e+01  3.33622796e+01  3.33622796e+01
  3.33622796e+01  1.01342767e+02  1.28925827e+02  1.28925827e+02
  1.28925827e+02  4.83265760e+02  4.83265760e+02  4.83265760e+02
  5.81590199e+02  1.33511014e+03  1.33511014e+03  1.33511014e+03
  2.65024094e+03  3.02936059e+03  3.02936059e+03  3.02936059e+03
  6.64980723e+03  6.64980723e+03  6.64980723e+03  9.05608581e+03
  2.54119007e+04  7.61545203e+04]
E1 = -728.167502760634  E_coul = 201.44189643405716
cycle= 4 E= -526.725606326577  delta_E= -2.16e-06  |g|= 0.000107  |ddm|= 0.00245
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000160025
diis-c [-9.32174394e-09  9.96302591e-05 -1.32506448e-02 -8.71656680e-02
  1.10031668e+00]
  HOMO = -0.586439381920361  LUMO = 0.169626965174159
  mo_energy =
[-1.18585475e+02 -1.23134139e+01 -9.57012519e+00 -9.57012519e+00
 -9.57012519e+00 -1.27316665e+00 -5.86439382e-01 -5.86439382e-01
 -5.86439382e-01  1.69626965e-01  9.86922715e-01  9.86922715e-01
  9.86922715e-01  1.58494167e+00  7.23847429e+00  7.23847429e+00
  7.23847429e+00  1.14156639e+01  3.33623233e+01  3.33623233e+01
  3.33623233e+01  1.01342813e+02  1.28925867e+02  1.28925867e+02
  1.28925867e+02  4.83265791e+02  4.83265791e+02  4.83265791e+02
  5.81590221e+02  1.33511016e+03  1.33511016e+03  1.33511016e+03
  2.65024094e+03  3.02936060e+03  3.02936060e+03  3.02936060e+03
  6.64980722e+03  6.64980722e+03  6.64980722e+03  9.05608579e+03
  2.54119007e+04  7.61545203e+04]
E1 = -728.1672715259166  E_coul = 201.44166519724408
cycle= 5 E= -526.725606328672  delta_E= -2.1e-09  |g|= 2.17e-05  |ddm|= 0.000131
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.03611e-05
diis-c [-1.66355928e-10  1.10590104e-05 -1.25723810e-03 -1.03486405e-02
  5.84308581e-03  1.00575173e+00]
  HOMO = -0.586448734054201  LUMO = 0.16962620117064
  mo_energy =
[-1.18585511e+02 -1.23134414e+01 -9.57015450e+00 -9.57015450e+00
 -9.57015450e+00 -1.27317471e+00 -5.86448734e-01 -5.86448734e-01
 -5.86448734e-01  1.69626201e-01  9.86916421e-01  9.86916421e-01
  9.86916421e-01  1.58493470e+00  7.23845398e+00  7.23845398e+00
  7.23845398e+00  1.14156425e+01  3.33622949e+01  3.33622949e+01
  3.33622949e+01  1.01342780e+02  1.28925834e+02  1.28925834e+02
  1.28925834e+02  4.83265756e+02  4.83265756e+02  4.83265756e+02
  5.81590185e+02  1.33511012e+03  1.33511012e+03  1.33511012e+03
  2.65024090e+03  3.02936056e+03  3.02936056e+03  3.02936056e+03
  6.64980718e+03  6.64980718e+03  6.64980718e+03  9.05608575e+03
  2.54119006e+04  7.61545203e+04]
E1 = -728.1673692690324  E_coul = 201.44176294029222
cycle= 6 E= -526.72560632874  delta_E= -6.78e-11  |g|= 2.16e-06  |ddm|= 1.74e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.1673692690324  E_coul = 201.44176294029222
  HOMO = -0.586448162455666  LUMO = 0.169626356992685
  mo_energy =
[-1.18585507e+02 -1.23134393e+01 -9.57015227e+00 -9.57015227e+00
 -9.57015227e+00 -1.27317369e+00 -5.86448162e-01 -5.86448162e-01
 -5.86448162e-01  1.69626357e-01  9.86916872e-01  9.86916872e-01
  9.86916872e-01  1.58493551e+00  7.23845547e+00  7.23845547e+00
  7.23845547e+00  1.14156443e+01  3.33622971e+01  3.33622971e+01
  3.33622971e+01  1.01342783e+02  1.28925837e+02  1.28925837e+02
  1.28925837e+02  4.83265759e+02  4.83265759e+02  4.83265759e+02
  5.81590188e+02  1.33511012e+03  1.33511012e+03  1.33511012e+03
  2.65024090e+03  3.02936057e+03  3.02936057e+03  3.02936057e+03
  6.64980718e+03  6.64980718e+03  6.64980718e+03  9.05608576e+03
  2.54119006e+04  7.61545203e+04]
E1 = -728.1673600688625  E_coul = 201.44175374012073
Extra cycle  E= -526.725606328742  delta_E= -1.59e-12  |g|= 5.74e-07  |ddm|= 2.7e-06
    CPU time for scf_cycle      0.30 sec, wall time      0.27 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 104179.46667314765
E1 = -728.1673600688625  E_coul = 201.44175374012073
init E= -526.725606328742
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.58644836158537  LUMO = 0.169626344748589
  mo_energy =
[-1.18585508e+02 -1.23134399e+01 -9.57015298e+00 -9.57015298e+00
 -9.57015298e+00 -1.27317384e+00 -5.86448362e-01 -5.86448362e-01
 -5.86448362e-01  1.69626345e-01  9.86916739e-01  9.86916739e-01
  9.86916739e-01  1.58493537e+00  7.23845501e+00  7.23845501e+00
  7.23845501e+00  1.14156438e+01  3.33622964e+01  3.33622964e+01
  3.33622964e+01  1.01342782e+02  1.28925836e+02  1.28925836e+02
  1.28925836e+02  4.83265758e+02  4.83265758e+02  4.83265758e+02
  5.81590187e+02  1.33511012e+03  1.33511012e+03  1.33511012e+03
  2.65024090e+03  3.02936057e+03  3.02936057e+03  3.02936057e+03
  6.64980718e+03  6.64980718e+03  6.64980718e+03  9.05608575e+03
  2.54119006e+04  7.61545203e+04]
E1 = -728.1673625048712  E_coul = 201.4417561761303
cycle= 1 E= -526.725606328741  delta_E= 9.09e-13  |g|= 1.66e-07  |ddm|= 4.6e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.1673625048712  E_coul = 201.4417561761303
  HOMO = -0.586448319183461  LUMO = 0.169626353949772
  mo_energy =
[-1.18585508e+02 -1.23134397e+01 -9.57015280e+00 -9.57015280e+00
 -9.57015280e+00 -1.27317378e+00 -5.86448319e-01 -5.86448319e-01
 -5.86448319e-01  1.69626354e-01  9.86916771e-01  9.86916771e-01
  9.86916771e-01  1.58493543e+00  7.23845513e+00  7.23845513e+00
  7.23845513e+00  1.14156439e+01  3.33622965e+01  3.33622965e+01
  3.33622965e+01  1.01342782e+02  1.28925836e+02  1.28925836e+02
  1.28925836e+02  4.83265758e+02  4.83265758e+02  4.83265758e+02
  5.81590188e+02  1.33511012e+03  1.33511012e+03  1.33511012e+03
  2.65024090e+03  3.02936057e+03  3.02936057e+03  3.02936057e+03
  6.64980718e+03  6.64980718e+03  6.64980718e+03  9.05608575e+03
  2.54119006e+04  7.61545203e+04]
E1 = -728.1673617613634  E_coul = 201.44175543262267
Extra cycle  E= -526.725606328741  delta_E= 2.27e-13  |g|= 4.52e-08  |ddm|= 1.39e-07
    CPU time for scf_cycle      1.12 sec, wall time      0.63 sec
exp = [2.61826559e+04 7.61752191e+03 3.61735087e+03 1.59782568e+03
 3.82851156e+02 1.08121177e+02 3.48059281e+01 7.58076364e+00
 2.59728358e+00 7.99818761e-01 2.85638994e-01 6.71416402e-02
 1.36278321e+03 6.64745680e+02 3.00961986e+02 3.14042269e+02
 6.16222448e+01 7.32992949e+00 2.02390874e+01 7.74196563e-01
 2.80883903e+00 2.16697364e-01]
grad_E = [-1.51755924e-06  3.30570997e-06 -1.58689634e-06  6.92286946e-05
 -2.99674469e-05 -3.89488555e-04 -2.10512076e-03  1.81166697e-02
 -4.87855309e-02 -1.22006572e-02  1.31363917e-02 -1.62196692e-02
 -5.03546897e-07  5.05416124e-06  2.38990054e-05  2.06044236e-05
 -4.93972860e-05 -8.74868107e-04  2.52498150e-04  3.87919185e-02
  2.68020833e-04 -1.46654898e-01]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:30 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558629        1
[INPUT] 0    0    [1    /1   ]  7617.52189893        1
[INPUT] 0    0    [1    /1   ]  3617.35087544        1
[INPUT] 0    0    [1    /1   ]  1597.82534352        1
[INPUT] 0    0    [1    /1   ]  382.851294446        1
[INPUT] 0    0    [1    /1   ]  108.123131834        1
[INPUT] 0    0    [1    /1   ]  34.8156890324        1
[INPUT] 0    0    [1    /1   ]  7.48830880182        1
[INPUT] 0    0    [1    /1   ]  2.84706102484        1
[INPUT] 0    0    [1    /1   ]  0.88698870785        1
[INPUT] 0    0    [1    /1   ]  0.111770441113       1
[INPUT] 0    0    [1    /1   ]  0.20991358931        1
[INPUT] 1    0    [1    /1   ]  1362.78320881        1
[INPUT] 1    0    [1    /1   ]  664.745655497        1
[INPUT] 1    0    [1    /1   ]  300.961871098        1
[INPUT] 1    0    [1    /1   ]  314.042170127        1
[INPUT] 1    0    [1    /1   ]  61.6224430491        1
[INPUT] 1    0    [1    /1   ]  7.3313446298         1
[INPUT] 1    0    [1    /1   ]  20.2382868464        1
[INPUT] 1    0    [1    /1   ]  0.769916160849       1
[INPUT] 1    0    [1    /1   ]  2.80791220054        1
[INPUT] 1    0    [1    /1   ]  0.268740857678       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655862913787, 1.0]], [0, [7617.521898933559, 1.0]], [0, [3617.3508754435056, 1.0]], [0, [1597.8253435189042, 1.0]], [0, [382.85129444647504, 1.0]], [0, [108.1231318340368, 1.0]], [0, [34.81568903236994, 1.0]], [0, [7.488308801824714, 1.0]], [0, [2.8470610248445136, 1.0]], [0, [0.8869887078504417, 1.0]], [0, [0.11177044111278506, 1.0]], [0, [0.20991358930972864, 1.0]], [1, [1362.7832088118435, 1.0]], [1, [664.7456554965277, 1.0]], [1, [300.96187109780647, 1.0]], [1, [314.042170126946, 1.0]], [1, [61.62244304913112, 1.0]], [1, [7.331344629797643, 1.0]], [1, [20.238286846393365, 1.0]], [1, [0.7699161608492849, 1.0]], [1, [2.8079122005357022, 1.0]], [1, [0.26874085767803035, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65586291]
bas 1, expnt(s) = [7617.52189893]
bas 2, expnt(s) = [3617.35087544]
bas 3, expnt(s) = [1597.82534352]
bas 4, expnt(s) = [382.85129445]
bas 5, expnt(s) = [108.12313183]
bas 6, expnt(s) = [34.81568903]
bas 7, expnt(s) = [7.4883088]
bas 8, expnt(s) = [2.84706102]
bas 9, expnt(s) = [0.88698871]
bas 10, expnt(s) = [0.11177044]
bas 11, expnt(s) = [0.20991359]
bas 12, expnt(s) = [1362.78320881]
bas 13, expnt(s) = [664.7456555]
bas 14, expnt(s) = [300.9618711]
bas 15, expnt(s) = [314.04217013]
bas 16, expnt(s) = [61.62244305]
bas 17, expnt(s) = [7.33134463]
bas 18, expnt(s) = [20.23828685]
bas 19, expnt(s) = [0.76991616]
bas 20, expnt(s) = [2.8079122]
bas 21, expnt(s) = [0.26874086]
CPU time:        18.00
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752190e+03 2.06003836e+03
 3.61735088e+03 1.17844143e+03 1.59782534e+03 6.38501620e+02
 3.82851294e+02 2.18669199e+02 1.08123132e+02 8.47137656e+01
 3.48156890e+01 3.62114796e+01 7.48830880e+00 1.14367554e+01
 2.84706102e+00 5.53748555e+00 8.86988708e-01 2.30915770e+00
 1.11770441e-01 4.88382673e-01 2.09913589e-01 7.83511617e-01
 1.36278321e+03 2.41556017e+04 6.64745655e+02 9.84699635e+03
 3.00961871e+02 3.65698973e+03 3.14042170e+02 3.85673105e+03
 6.16224430e+01 5.03683858e+02 7.33134463e+00 3.51936197e+01
 2.02382868e+01 1.25228038e+02 7.69916161e-01 2.10396585e+00
 2.80791220e+00 1.06038554e+01 2.68740858e-01 5.64483843e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.973620508437882
cond(S) = 104600.02720027181
E1 = -729.3060063775093  E_coul = 203.08895642214657
init E= -526.217049955363
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.554553601034245  LUMO = 0.234443619892773
  mo_energy =
[-1.18333732e+02 -1.22101548e+01 -9.45328821e+00 -9.45328821e+00
 -9.45328821e+00 -1.23712714e+00 -5.54553601e-01 -5.54553601e-01
 -5.54553601e-01  2.34443620e-01  1.19454053e+00  1.19454053e+00
  1.19454053e+00  1.68456411e+00  7.50102850e+00  7.50102850e+00
  7.50102850e+00  1.23033928e+01  3.36226277e+01  3.36226277e+01
  3.36226277e+01  1.02501685e+02  1.29211895e+02  1.29211895e+02
  1.29211895e+02  4.83593029e+02  4.83593029e+02  4.83593029e+02
  5.82685674e+02  1.33548051e+03  1.33548051e+03  1.33548051e+03
  2.65136678e+03  3.02978937e+03  3.02978937e+03  3.02978937e+03
  6.65034199e+03  6.65034199e+03  6.65034199e+03  9.05726931e+03
  2.54131427e+04  7.61558111e+04]
E1 = -728.5307782448184  E_coul = 201.83271194256216
cycle= 1 E= -526.698066302256  delta_E= -0.481  |g|= 0.177  |ddm|= 1.24
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.527324
diis-c [-0.27807066  1.        ]
  HOMO = -0.561086978189352  LUMO = 0.241348248428573
  mo_energy =
[-1.18581439e+02 -1.22910549e+01 -9.54507039e+00 -9.54507039e+00
 -9.54507039e+00 -1.24200550e+00 -5.61086978e-01 -5.61086978e-01
 -5.61086978e-01  2.41348248e-01  1.19353208e+00  1.19353208e+00
  1.19353208e+00  1.68320471e+00  7.45902800e+00  7.45902800e+00
  7.45902800e+00  1.22483044e+01  3.35243661e+01  3.35243661e+01
  3.35243661e+01  1.02343582e+02  1.29042327e+02  1.29042327e+02
  1.29042327e+02  4.83346643e+02  4.83346643e+02  4.83346643e+02
  5.82400663e+02  1.33517690e+03  1.33517690e+03  1.33517690e+03
  2.65092856e+03  3.02941965e+03  3.02941965e+03  3.02941965e+03
  6.64985874e+03  6.64985874e+03  6.64985874e+03  9.05671054e+03
  2.54124897e+04  7.61550679e+04]
E1 = -728.8773474080404  E_coul = 202.17878454044538
cycle= 2 E= -526.698562867595  delta_E= -0.000497  |g|= 0.0277  |ddm|= 0.0555
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0553319
diis-c [-0.002008    0.05818391  0.94181609]
  HOMO = -0.556365394237742  LUMO = 0.242249812730798
  mo_energy =
[-1.18534368e+02 -1.22679365e+01 -9.52093813e+00 -9.52093813e+00
 -9.52093813e+00 -1.23575863e+00 -5.56365394e-01 -5.56365394e-01
 -5.56365394e-01  2.42249813e-01  1.19742724e+00  1.19742724e+00
  1.19742724e+00  1.68871640e+00  7.47237087e+00  7.47237087e+00
  7.47237087e+00  1.22650553e+01  3.35491833e+01  3.35491833e+01
  3.35491833e+01  1.02380647e+02  1.29079703e+02  1.29079703e+02
  1.29079703e+02  4.83393083e+02  4.83393083e+02  4.83393083e+02
  5.82449043e+02  1.33522667e+03  1.33522667e+03  1.33522667e+03
  2.65098094e+03  3.02947122e+03  3.02947122e+03  3.02947122e+03
  6.64991162e+03  6.64991162e+03  6.64991162e+03  9.05676401e+03
  2.54125436e+04  7.61551219e+04]
E1 = -728.7887228314509  E_coul = 202.0901337752573
cycle= 3 E= -526.698589056194  delta_E= -2.62e-05  |g|= 0.00461  |ddm|= 0.0133
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0100602
diis-c [-3.26382796e-06 -1.53936915e-03  1.45161912e-01  8.56377457e-01]
  HOMO = -0.557314316591356  LUMO = 0.242160213822683
  mo_energy =
[-1.18541574e+02 -1.22718657e+01 -9.52519162e+00 -9.52519162e+00
 -9.52519162e+00 -1.23663845e+00 -5.57314317e-01 -5.57314317e-01
 -5.57314317e-01  2.42160214e-01  1.19672003e+00  1.19672003e+00
  1.19672003e+00  1.68795789e+00  7.46990150e+00  7.46990150e+00
  7.46990150e+00  1.22621683e+01  3.35449217e+01  3.35449217e+01
  3.35449217e+01  1.02374826e+02  1.29073762e+02  1.29073762e+02
  1.29073762e+02  4.83385968e+02  4.83385968e+02  4.83385968e+02
  5.82441627e+02  1.33521906e+03  1.33521906e+03  1.33521906e+03
  2.65097277e+03  3.02946327e+03  3.02946327e+03  3.02946327e+03
  6.64990332e+03  6.64990332e+03  6.64990332e+03  9.05675551e+03
  2.54125349e+04  7.61551131e+04]
E1 = -728.8029707604411  E_coul = 202.10438066011073
cycle= 4 E= -526.69859010033  delta_E= -1.04e-06  |g|= 0.000311  |ddm|= 0.00173
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000361445
diis-c [-2.53739928e-08  2.09963639e-04 -2.96461557e-02 -1.81086580e-01
  1.21052277e+00]
  HOMO = -0.55728990524123  LUMO = 0.242181441030942
  mo_energy =
[-1.18541481e+02 -1.22717463e+01 -9.52510586e+00 -9.52510586e+00
 -9.52510586e+00 -1.23653190e+00 -5.57289905e-01 -5.57289905e-01
 -5.57289905e-01  2.42181441e-01  1.19674776e+00  1.19674776e+00
  1.19674776e+00  1.68804863e+00  7.46997066e+00  7.46997066e+00
  7.46997066e+00  1.22622780e+01  3.35450097e+01  3.35450097e+01
  3.35450097e+01  1.02374936e+02  1.29073860e+02  1.29073860e+02
  1.29073860e+02  4.83386062e+02  4.83386062e+02  4.83386062e+02
  5.82441706e+02  1.33521914e+03  1.33521914e+03  1.33521914e+03
  2.65097281e+03  3.02946333e+03  3.02946333e+03  3.02946333e+03
  6.64990334e+03  6.64990334e+03  6.64990334e+03  9.05675551e+03
  2.54125349e+04  7.61551131e+04]
E1 = -728.8025294754465  E_coul = 202.10393935291472
cycle= 5 E= -526.698590122532  delta_E= -2.22e-08  |g|= 3.44e-05  |ddm|= 0.000567
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=6.22585e-05
diis-c [-2.02772422e-10  2.08174535e-05 -2.58040072e-03 -2.10497485e-02
  7.76175668e-02  9.45991765e-01]
  HOMO = -0.557305580407474  LUMO = 0.242179682683432
  mo_energy =
[-1.18541541e+02 -1.22717932e+01 -9.52515506e+00 -9.52515506e+00
 -9.52515506e+00 -1.23654649e+00 -5.57305580e-01 -5.57305580e-01
 -5.57305580e-01  2.42179683e-01  1.19673615e+00  1.19673615e+00
  1.19673615e+00  1.68803564e+00  7.46993671e+00  7.46993671e+00
  7.46993671e+00  1.22622406e+01  3.35449619e+01  3.35449619e+01
  3.35449619e+01  1.02374881e+02  1.29073805e+02  1.29073805e+02
  1.29073805e+02  4.83386002e+02  4.83386002e+02  4.83386002e+02
  5.82441646e+02  1.33521908e+03  1.33521908e+03  1.33521908e+03
  2.65097275e+03  3.02946327e+03  3.02946327e+03  3.02946327e+03
  6.64990328e+03  6.64990328e+03  6.64990328e+03  9.05675545e+03
  2.54125348e+04  7.61551130e+04]
E1 = -728.8026706588174  E_coul = 202.10408053616283
cycle= 6 E= -526.698590122655  delta_E= -1.23e-10  |g|= 1.82e-06  |ddm|= 4.16e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.8026706588174  E_coul = 202.10408053616283
  HOMO = -0.557305498236571  LUMO = 0.242179695213396
  mo_energy =
[-1.18541539e+02 -1.22717921e+01 -9.52515379e+00 -9.52515379e+00
 -9.52515379e+00 -1.23654626e+00 -5.57305498e-01 -5.57305498e-01
 -5.57305498e-01  2.42179695e-01  1.19673619e+00  1.19673619e+00
  1.19673619e+00  1.68803572e+00  7.46993731e+00  7.46993731e+00
  7.46993731e+00  1.22622414e+01  3.35449632e+01  3.35449632e+01
  3.35449632e+01  1.02374882e+02  1.29073806e+02  1.29073806e+02
  1.29073806e+02  4.83386004e+02  4.83386004e+02  4.83386004e+02
  5.82441648e+02  1.33521908e+03  1.33521908e+03  1.33521908e+03
  2.65097275e+03  3.02946327e+03  3.02946327e+03  3.02946327e+03
  6.64990328e+03  6.64990328e+03  6.64990328e+03  9.05675545e+03
  2.54125348e+04  7.61551130e+04]
E1 = -728.8026646250901  E_coul = 202.10407450243463
Extra cycle  E= -526.698590122655  delta_E= -7.96e-13  |g|= 4.12e-07  |ddm|= 7.23e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826559e+04 7.61752190e+03 3.61735088e+03 1.59782534e+03
 3.82851294e+02 1.08123132e+02 3.48156890e+01 7.48830880e+00
 2.84706102e+00 8.86988708e-01 1.11770441e-01 2.09913589e-01
 1.36278321e+03 6.64745655e+02 3.00961871e+02 3.14042170e+02
 6.16224430e+01 7.33134463e+00 2.02382868e+01 7.69916161e-01
 2.80791220e+00 2.68740858e-01]
E = -526.6985901226554
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:31 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558574        1
[INPUT] 0    0    [1    /1   ]  7617.52191086        1
[INPUT] 0    0    [1    /1   ]  3617.35086971        1
[INPUT] 0    0    [1    /1   ]  1597.82559325        1
[INPUT] 0    0    [1    /1   ]  382.851190805        1
[INPUT] 0    0    [1    /1   ]  108.121668888        1
[INPUT] 0    0    [1    /1   ]  34.8083831285        1
[INPUT] 0    0    [1    /1   ]  7.55751001939        1
[INPUT] 0    0    [1    /1   ]  2.66010593099        1
[INPUT] 0    0    [1    /1   ]  0.821743162073       1
[INPUT] 0    0    [1    /1   ]  0.241908740843       1
[INPUT] 0    0    [1    /1   ]  0.103050684135       1
[INPUT] 1    0    [1    /1   ]  1362.78320699        1
[INPUT] 1    0    [1    /1   ]  664.74567371         1
[INPUT] 1    0    [1    /1   ]  300.961957183        1
[INPUT] 1    0    [1    /1   ]  314.042244347        1
[INPUT] 1    0    [1    /1   ]  61.6222946478        1
[INPUT] 1    0    [1    /1   ]  7.33028541674        1
[INPUT] 1    0    [1    /1   ]  20.2388860405        1
[INPUT] 1    0    [1    /1   ]  0.773119985222       1
[INPUT] 1    0    [1    /1   ]  2.80860592213        1
[INPUT] 1    0    [1    /1   ]  0.229786995121       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655857436825, 1.0]], [0, [7617.5219108614065, 1.0]], [0, [3617.3508697138554, 1.0]], [0, [1597.825593251946, 1.0]], [0, [382.8511908052863, 1.0]], [0, [108.12166888825264, 1.0]], [0, [34.80838312849001, 1.0]], [0, [7.557510019390597, 1.0]], [0, [2.660105930990084, 1.0]], [0, [0.8217431620734933, 1.0]], [0, [0.24190874084293607, 1.0]], [0, [0.1030506841351286, 1.0]], [1, [1362.7832069932426, 1.0]], [1, [664.7456737104143, 1.0]], [1, [300.96195718268046, 1.0]], [1, [314.04224434733493, 1.0]], [1, [61.62229464777889, 1.0]], [1, [7.330285416736808, 1.0]], [1, [20.238886040453064, 1.0]], [1, [0.7731199852217209, 1.0]], [1, [2.808605922126393, 1.0]], [1, [0.22978699512146739, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65585744]
bas 1, expnt(s) = [7617.52191086]
bas 2, expnt(s) = [3617.35086971]
bas 3, expnt(s) = [1597.82559325]
bas 4, expnt(s) = [382.85119081]
bas 5, expnt(s) = [108.12166889]
bas 6, expnt(s) = [34.80838313]
bas 7, expnt(s) = [7.55751002]
bas 8, expnt(s) = [2.66010593]
bas 9, expnt(s) = [0.82174316]
bas 10, expnt(s) = [0.24190874]
bas 11, expnt(s) = [0.10305068]
bas 12, expnt(s) = [1362.78320699]
bas 13, expnt(s) = [664.74567371]
bas 14, expnt(s) = [300.96195718]
bas 15, expnt(s) = [314.04224435]
bas 16, expnt(s) = [61.62229465]
bas 17, expnt(s) = [7.33028542]
bas 18, expnt(s) = [20.23888604]
bas 19, expnt(s) = [0.77311999]
bas 20, expnt(s) = [2.80860592]
bas 21, expnt(s) = [0.229787]
CPU time:        18.33
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752191e+03 2.06003836e+03
 3.61735087e+03 1.17844143e+03 1.59782559e+03 6.38501694e+02
 3.82851191e+02 2.18669155e+02 1.08121669e+02 8.47129059e+01
 3.48083831e+01 3.62057803e+01 7.55751002e+00 1.15159315e+01
 2.66010593e+00 5.26246503e+00 8.21743162e-01 2.18055527e+00
 2.41908741e-01 8.71472516e-01 1.03050684e-01 4.59518694e-01
 1.36278321e+03 2.41556017e+04 6.64745674e+02 9.84699669e+03
 3.00961957e+02 3.65699103e+03 3.14042244e+02 3.85673219e+03
 6.16222946e+01 5.03682342e+02 7.33028542e+00 3.51872639e+01
 2.02388860e+01 1.25232673e+02 7.73119985e-01 2.11491549e+00
 2.80860592e+00 1.06071302e+01 2.29786995e-01 4.64131666e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99186660846572
cond(S) = 104488.481902315
E1 = -729.5075178442872  E_coul = 203.17673691679212
init E= -526.330780927495
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.55590641634763  LUMO = 0.237085254016575
  mo_energy =
[-1.18326099e+02 -1.22024041e+01 -9.44691970e+00 -9.44691970e+00
 -9.44691970e+00 -1.23869071e+00 -5.55906416e-01 -5.55906416e-01
 -5.55906416e-01  2.37085254e-01  1.05754723e+00  1.05754723e+00
  1.05754723e+00  1.67331813e+00  7.36278892e+00  7.36278892e+00
  7.36278892e+00  1.17039437e+01  3.35242739e+01  3.35242739e+01
  3.35242739e+01  1.01765200e+02  1.29140840e+02  1.29140840e+02
  1.29140840e+02  4.83543407e+02  4.83543407e+02  4.83543407e+02
  5.82082039e+02  1.33543825e+03  1.33543825e+03  1.33543825e+03
  2.65085275e+03  3.02975157e+03  3.02975157e+03  3.02975157e+03
  6.65030858e+03  6.65030858e+03  6.65030858e+03  9.05680169e+03
  2.54127016e+04  7.61554010e+04]
E1 = -727.8961730414965  E_coul = 201.17058897972927
cycle= 1 E= -526.725584061767  delta_E= -0.395  |g|= 0.187  |ddm|= 0.448
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.543192
diis-c [-0.29505776  1.        ]
  HOMO = -0.587407381050987  LUMO = 0.234268948283158
  mo_energy =
[-1.18631907e+02 -1.23351600e+01 -9.59173412e+00 -9.59173412e+00
 -9.59173412e+00 -1.27348454e+00 -5.87407381e-01 -5.87407381e-01
 -5.87407381e-01  2.34268948e-01  1.03586697e+00  1.03586697e+00
  1.03586697e+00  1.64579580e+00  7.27665147e+00  7.27665147e+00
  7.27665147e+00  1.16059550e+01  3.33739221e+01  3.33739221e+01
  3.33739221e+01  1.01549343e+02  1.28915168e+02  1.28915168e+02
  1.28915168e+02  4.83238660e+02  4.83238660e+02  4.83238660e+02
  5.81739374e+02  1.33507680e+03  1.33507680e+03  1.33507680e+03
  2.65035673e+03  3.02932390e+03  3.02932390e+03  3.02932390e+03
  6.64976762e+03  6.64976762e+03  6.64976762e+03  9.05618537e+03
  2.54119913e+04  7.61546006e+04]
E1 = -728.448309593558  E_coul = 201.7220200189112
cycle= 2 E= -526.726289574647  delta_E= -0.000706  |g|= 0.0371  |ddm|= 0.0485
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0742293
diis-c [-0.0031678   0.08221337  0.91778663]
  HOMO = -0.578816510550769  LUMO = 0.235846821565142
  mo_energy =
[-1.18565929e+02 -1.22985696e+01 -9.55361020e+00 -9.55361020e+00
 -9.55361020e+00 -1.26306431e+00 -5.78816511e-01 -5.78816511e-01
 -5.78816511e-01  2.35846822e-01  1.04230014e+00  1.04230014e+00
  1.04230014e+00  1.65437087e+00  7.29922663e+00  7.29922663e+00
  7.29922663e+00  1.16327746e+01  3.34124593e+01  3.34124593e+01
  3.34124593e+01  1.01603066e+02  1.28969405e+02  1.28969405e+02
  1.28969405e+02  4.83303827e+02  4.83303827e+02  4.83303827e+02
  5.81806869e+02  1.33514598e+03  1.33514598e+03  1.33514598e+03
  2.65042915e+03  3.02939527e+03  3.02939527e+03  3.02939527e+03
  6.64984067e+03  6.64984067e+03  6.64984067e+03  9.05625920e+03
  2.54120656e+04  7.61546753e+04]
E1 = -728.304534607182  E_coul = 201.5781896888423
cycle= 3 E= -526.72634491834  delta_E= -5.53e-05  |g|= 0.00606  |ddm|= 0.0155
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0129241
diis-c [-1.36730113e-06 -1.39709590e-03  1.42825960e-01  8.58571136e-01]
  HOMO = -0.580240918842605  LUMO = 0.235633132518663
  mo_energy =
[-1.18575518e+02 -1.23041099e+01 -9.55952211e+00 -9.55952211e+00
 -9.55952211e+00 -1.26460628e+00 -5.80240919e-01 -5.80240919e-01
 -5.80240919e-01  2.35633133e-01  1.04127128e+00  1.04127128e+00
  1.04127128e+00  1.65310439e+00  7.29562686e+00  7.29562686e+00
  7.29562686e+00  1.16286679e+01  3.34065381e+01  3.34065381e+01
  3.34065381e+01  1.01595171e+02  1.28961377e+02  1.28961377e+02
  1.28961377e+02  4.83294350e+02  4.83294350e+02  4.83294350e+02
  5.81797041e+02  1.33513592e+03  1.33513592e+03  1.33513592e+03
  2.65041844e+03  3.02938482e+03  3.02938482e+03  3.02938482e+03
  6.64982982e+03  6.64982982e+03  6.64982982e+03  9.05624813e+03
  2.54120544e+04  7.61546639e+04]
E1 = -728.3260266731132  E_coul = 201.599679966711
cycle= 4 E= -526.726346706402  delta_E= -1.79e-06  |g|= 0.00017  |ddm|= 0.00208
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000227394
diis-c [-1.47507337e-08  1.59457329e-04 -2.07585034e-02 -1.33692019e-01
  1.15429107e+00]
  HOMO = -0.580226193310948  LUMO = 0.235646073412035
  mo_energy =
[-1.18575490e+02 -1.23040442e+01 -9.55947945e+00 -9.55947945e+00
 -9.55947945e+00 -1.26454934e+00 -5.80226193e-01 -5.80226193e-01
 -5.80226193e-01  2.35646073e-01  1.04128683e+00  1.04128683e+00
  1.04128683e+00  1.65314920e+00  7.29566450e+00  7.29566450e+00
  7.29566450e+00  1.16287286e+01  3.34065800e+01  3.34065800e+01
  3.34065800e+01  1.01595217e+02  1.28961415e+02  1.28961415e+02
  1.28961415e+02  4.83294379e+02  4.83294379e+02  4.83294379e+02
  5.81797058e+02  1.33513594e+03  1.33513594e+03  1.33513594e+03
  2.65041843e+03  3.02938482e+03  3.02938482e+03  3.02938482e+03
  6.64982980e+03  6.64982980e+03  6.64982980e+03  9.05624809e+03
  2.54120543e+04  7.61546638e+04]
E1 = -728.3257872199993  E_coul = 201.59944050741638
cycle= 5 E= -526.726346712583  delta_E= -6.18e-09  |g|= 2.45e-05  |ddm|= 0.000263
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.41016e-05
diis-c [-2.01734028e-10  1.35518228e-05 -1.50582689e-03 -1.21416845e-02
  7.30524817e-03  1.00632871e+00]
  HOMO = -0.580237167977653  LUMO = 0.235645032143322
  mo_energy =
[-1.18575531e+02 -1.23040764e+01 -9.55951360e+00 -9.55951360e+00
 -9.55951360e+00 -1.26455845e+00 -5.80237168e-01 -5.80237168e-01
 -5.80237168e-01  2.35645032e-01  1.04127934e+00  1.04127934e+00
  1.04127934e+00  1.65314142e+00  7.29564083e+00  7.29564083e+00
  7.29564083e+00  1.16287035e+01  3.34065469e+01  3.34065469e+01
  3.34065469e+01  1.01595180e+02  1.28961377e+02  1.28961377e+02
  1.28961377e+02  4.83294338e+02  4.83294338e+02  4.83294338e+02
  5.81797017e+02  1.33513589e+03  1.33513589e+03  1.33513589e+03
  2.65041838e+03  3.02938478e+03  3.02938478e+03  3.02938478e+03
  6.64982976e+03  6.64982976e+03  6.64982976e+03  9.05624805e+03
  2.54120543e+04  7.61546638e+04]
E1 = -728.325895287659  E_coul = 201.59954857498542
cycle= 6 E= -526.726346712674  delta_E= -9.07e-11  |g|= 2.32e-06  |ddm|= 2.43e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.325895287659  E_coul = 201.59954857498542
  HOMO = -0.58023643536075  LUMO = 0.235645218324037
  mo_energy =
[-1.18575527e+02 -1.23040736e+01 -9.55951061e+00 -9.55951061e+00
 -9.55951061e+00 -1.26455734e+00 -5.80236435e-01 -5.80236435e-01
 -5.80236435e-01  2.35645218e-01  1.04127990e+00  1.04127990e+00
  1.04127990e+00  1.65314227e+00  7.29564276e+00  7.29564276e+00
  7.29564276e+00  1.16287057e+01  3.34065499e+01  3.34065499e+01
  3.34065499e+01  1.01595183e+02  1.28961381e+02  1.28961381e+02
  1.28961381e+02  4.83294342e+02  4.83294342e+02  4.83294342e+02
  5.81797022e+02  1.33513590e+03  1.33513590e+03  1.33513590e+03
  2.65041839e+03  3.02938478e+03  3.02938478e+03  3.02938478e+03
  6.64982976e+03  6.64982976e+03  6.64982976e+03  9.05624806e+03
  2.54120543e+04  7.61546638e+04]
E1 = -728.3258835620665  E_coul = 201.59953684939248
Extra cycle  E= -526.726346712674  delta_E= -3.41e-13  |g|= 6.8e-07  |ddm|= 2.68e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826559e+04 7.61752191e+03 3.61735087e+03 1.59782559e+03
 3.82851191e+02 1.08121669e+02 3.48083831e+01 7.55751002e+00
 2.66010593e+00 8.21743162e-01 2.41908741e-01 1.03050684e-01
 1.36278321e+03 6.64745674e+02 3.00961957e+02 3.14042244e+02
 6.16222946e+01 7.33028542e+00 2.02388860e+01 7.73119985e-01
 2.80860592e+00 2.29786995e-01]
E = -526.726346712674
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:31 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558574        1
[INPUT] 0    0    [1    /1   ]  7617.52191086        1
[INPUT] 0    0    [1    /1   ]  3617.35086971        1
[INPUT] 0    0    [1    /1   ]  1597.82559325        1
[INPUT] 0    0    [1    /1   ]  382.851190805        1
[INPUT] 0    0    [1    /1   ]  108.121668888        1
[INPUT] 0    0    [1    /1   ]  34.8083831285        1
[INPUT] 0    0    [1    /1   ]  7.55751001939        1
[INPUT] 0    0    [1    /1   ]  2.66010593099        1
[INPUT] 0    0    [1    /1   ]  0.821743162073       1
[INPUT] 0    0    [1    /1   ]  0.241908740843       1
[INPUT] 0    0    [1    /1   ]  0.103050684135       1
[INPUT] 1    0    [1    /1   ]  1362.78320699        1
[INPUT] 1    0    [1    /1   ]  664.74567371         1
[INPUT] 1    0    [1    /1   ]  300.961957183        1
[INPUT] 1    0    [1    /1   ]  314.042244347        1
[INPUT] 1    0    [1    /1   ]  61.6222946478        1
[INPUT] 1    0    [1    /1   ]  7.33028541674        1
[INPUT] 1    0    [1    /1   ]  20.2388860405        1
[INPUT] 1    0    [1    /1   ]  0.773119985222       1
[INPUT] 1    0    [1    /1   ]  2.80860592213        1
[INPUT] 1    0    [1    /1   ]  0.229786995121       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655857436825, 1.0]], [0, [7617.5219108614065, 1.0]], [0, [3617.3508697138554, 1.0]], [0, [1597.825593251946, 1.0]], [0, [382.8511908052863, 1.0]], [0, [108.12166888825264, 1.0]], [0, [34.80838312849001, 1.0]], [0, [7.557510019390597, 1.0]], [0, [2.660105930990084, 1.0]], [0, [0.8217431620734933, 1.0]], [0, [0.24190874084293607, 1.0]], [0, [0.1030506841351286, 1.0]], [1, [1362.7832069932426, 1.0]], [1, [664.7456737104143, 1.0]], [1, [300.96195718268046, 1.0]], [1, [314.04224434733493, 1.0]], [1, [61.62229464777889, 1.0]], [1, [7.330285416736808, 1.0]], [1, [20.238886040453064, 1.0]], [1, [0.7731199852217209, 1.0]], [1, [2.808605922126393, 1.0]], [1, [0.22978699512146739, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65585744]
bas 1, expnt(s) = [7617.52191086]
bas 2, expnt(s) = [3617.35086971]
bas 3, expnt(s) = [1597.82559325]
bas 4, expnt(s) = [382.85119081]
bas 5, expnt(s) = [108.12166889]
bas 6, expnt(s) = [34.80838313]
bas 7, expnt(s) = [7.55751002]
bas 8, expnt(s) = [2.66010593]
bas 9, expnt(s) = [0.82174316]
bas 10, expnt(s) = [0.24190874]
bas 11, expnt(s) = [0.10305068]
bas 12, expnt(s) = [1362.78320699]
bas 13, expnt(s) = [664.74567371]
bas 14, expnt(s) = [300.96195718]
bas 15, expnt(s) = [314.04224435]
bas 16, expnt(s) = [61.62229465]
bas 17, expnt(s) = [7.33028542]
bas 18, expnt(s) = [20.23888604]
bas 19, expnt(s) = [0.77311999]
bas 20, expnt(s) = [2.80860592]
bas 21, expnt(s) = [0.229787]
CPU time:        18.66
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752191e+03 2.06003836e+03
 3.61735087e+03 1.17844143e+03 1.59782559e+03 6.38501694e+02
 3.82851191e+02 2.18669155e+02 1.08121669e+02 8.47129059e+01
 3.48083831e+01 3.62057803e+01 7.55751002e+00 1.15159315e+01
 2.66010593e+00 5.26246503e+00 8.21743162e-01 2.18055527e+00
 2.41908741e-01 8.71472516e-01 1.03050684e-01 4.59518694e-01
 1.36278321e+03 2.41556017e+04 6.64745674e+02 9.84699669e+03
 3.00961957e+02 3.65699103e+03 3.14042244e+02 3.85673219e+03
 6.16222946e+01 5.03682342e+02 7.33028542e+00 3.51872639e+01
 2.02388860e+01 1.25232673e+02 7.73119985e-01 2.11491549e+00
 2.80860592e+00 1.06071302e+01 2.29786995e-01 4.64131666e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99186660846572
cond(S) = 104488.481902315
E1 = -729.5075178442872  E_coul = 203.17673691679212
init E= -526.330780927495
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.55590641634763  LUMO = 0.237085254016575
  mo_energy =
[-1.18326099e+02 -1.22024041e+01 -9.44691970e+00 -9.44691970e+00
 -9.44691970e+00 -1.23869071e+00 -5.55906416e-01 -5.55906416e-01
 -5.55906416e-01  2.37085254e-01  1.05754723e+00  1.05754723e+00
  1.05754723e+00  1.67331813e+00  7.36278892e+00  7.36278892e+00
  7.36278892e+00  1.17039437e+01  3.35242739e+01  3.35242739e+01
  3.35242739e+01  1.01765200e+02  1.29140840e+02  1.29140840e+02
  1.29140840e+02  4.83543407e+02  4.83543407e+02  4.83543407e+02
  5.82082039e+02  1.33543825e+03  1.33543825e+03  1.33543825e+03
  2.65085275e+03  3.02975157e+03  3.02975157e+03  3.02975157e+03
  6.65030858e+03  6.65030858e+03  6.65030858e+03  9.05680169e+03
  2.54127016e+04  7.61554010e+04]
E1 = -727.8961730414965  E_coul = 201.17058897972927
cycle= 1 E= -526.725584061767  delta_E= -0.395  |g|= 0.187  |ddm|= 0.448
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.543192
diis-c [-0.29505776  1.        ]
  HOMO = -0.587407381050987  LUMO = 0.234268948283158
  mo_energy =
[-1.18631907e+02 -1.23351600e+01 -9.59173412e+00 -9.59173412e+00
 -9.59173412e+00 -1.27348454e+00 -5.87407381e-01 -5.87407381e-01
 -5.87407381e-01  2.34268948e-01  1.03586697e+00  1.03586697e+00
  1.03586697e+00  1.64579580e+00  7.27665147e+00  7.27665147e+00
  7.27665147e+00  1.16059550e+01  3.33739221e+01  3.33739221e+01
  3.33739221e+01  1.01549343e+02  1.28915168e+02  1.28915168e+02
  1.28915168e+02  4.83238660e+02  4.83238660e+02  4.83238660e+02
  5.81739374e+02  1.33507680e+03  1.33507680e+03  1.33507680e+03
  2.65035673e+03  3.02932390e+03  3.02932390e+03  3.02932390e+03
  6.64976762e+03  6.64976762e+03  6.64976762e+03  9.05618537e+03
  2.54119913e+04  7.61546006e+04]
E1 = -728.448309593558  E_coul = 201.7220200189112
cycle= 2 E= -526.726289574647  delta_E= -0.000706  |g|= 0.0371  |ddm|= 0.0485
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0742293
diis-c [-0.0031678   0.08221337  0.91778663]
  HOMO = -0.578816510550769  LUMO = 0.235846821565142
  mo_energy =
[-1.18565929e+02 -1.22985696e+01 -9.55361020e+00 -9.55361020e+00
 -9.55361020e+00 -1.26306431e+00 -5.78816511e-01 -5.78816511e-01
 -5.78816511e-01  2.35846822e-01  1.04230014e+00  1.04230014e+00
  1.04230014e+00  1.65437087e+00  7.29922663e+00  7.29922663e+00
  7.29922663e+00  1.16327746e+01  3.34124593e+01  3.34124593e+01
  3.34124593e+01  1.01603066e+02  1.28969405e+02  1.28969405e+02
  1.28969405e+02  4.83303827e+02  4.83303827e+02  4.83303827e+02
  5.81806869e+02  1.33514598e+03  1.33514598e+03  1.33514598e+03
  2.65042915e+03  3.02939527e+03  3.02939527e+03  3.02939527e+03
  6.64984067e+03  6.64984067e+03  6.64984067e+03  9.05625920e+03
  2.54120656e+04  7.61546753e+04]
E1 = -728.304534607182  E_coul = 201.5781896888423
cycle= 3 E= -526.72634491834  delta_E= -5.53e-05  |g|= 0.00606  |ddm|= 0.0155
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0129241
diis-c [-1.36730113e-06 -1.39709590e-03  1.42825960e-01  8.58571136e-01]
  HOMO = -0.580240918842605  LUMO = 0.235633132518663
  mo_energy =
[-1.18575518e+02 -1.23041099e+01 -9.55952211e+00 -9.55952211e+00
 -9.55952211e+00 -1.26460628e+00 -5.80240919e-01 -5.80240919e-01
 -5.80240919e-01  2.35633133e-01  1.04127128e+00  1.04127128e+00
  1.04127128e+00  1.65310439e+00  7.29562686e+00  7.29562686e+00
  7.29562686e+00  1.16286679e+01  3.34065381e+01  3.34065381e+01
  3.34065381e+01  1.01595171e+02  1.28961377e+02  1.28961377e+02
  1.28961377e+02  4.83294350e+02  4.83294350e+02  4.83294350e+02
  5.81797041e+02  1.33513592e+03  1.33513592e+03  1.33513592e+03
  2.65041844e+03  3.02938482e+03  3.02938482e+03  3.02938482e+03
  6.64982982e+03  6.64982982e+03  6.64982982e+03  9.05624813e+03
  2.54120544e+04  7.61546639e+04]
E1 = -728.3260266731132  E_coul = 201.599679966711
cycle= 4 E= -526.726346706402  delta_E= -1.79e-06  |g|= 0.00017  |ddm|= 0.00208
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000227394
diis-c [-1.47507337e-08  1.59457329e-04 -2.07585034e-02 -1.33692019e-01
  1.15429107e+00]
  HOMO = -0.580226193310948  LUMO = 0.235646073412035
  mo_energy =
[-1.18575490e+02 -1.23040442e+01 -9.55947945e+00 -9.55947945e+00
 -9.55947945e+00 -1.26454934e+00 -5.80226193e-01 -5.80226193e-01
 -5.80226193e-01  2.35646073e-01  1.04128683e+00  1.04128683e+00
  1.04128683e+00  1.65314920e+00  7.29566450e+00  7.29566450e+00
  7.29566450e+00  1.16287286e+01  3.34065800e+01  3.34065800e+01
  3.34065800e+01  1.01595217e+02  1.28961415e+02  1.28961415e+02
  1.28961415e+02  4.83294379e+02  4.83294379e+02  4.83294379e+02
  5.81797058e+02  1.33513594e+03  1.33513594e+03  1.33513594e+03
  2.65041843e+03  3.02938482e+03  3.02938482e+03  3.02938482e+03
  6.64982980e+03  6.64982980e+03  6.64982980e+03  9.05624809e+03
  2.54120543e+04  7.61546638e+04]
E1 = -728.3257872199993  E_coul = 201.59944050741638
cycle= 5 E= -526.726346712583  delta_E= -6.18e-09  |g|= 2.45e-05  |ddm|= 0.000263
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.41016e-05
diis-c [-2.01734028e-10  1.35518228e-05 -1.50582689e-03 -1.21416845e-02
  7.30524817e-03  1.00632871e+00]
  HOMO = -0.580237167977653  LUMO = 0.235645032143322
  mo_energy =
[-1.18575531e+02 -1.23040764e+01 -9.55951360e+00 -9.55951360e+00
 -9.55951360e+00 -1.26455845e+00 -5.80237168e-01 -5.80237168e-01
 -5.80237168e-01  2.35645032e-01  1.04127934e+00  1.04127934e+00
  1.04127934e+00  1.65314142e+00  7.29564083e+00  7.29564083e+00
  7.29564083e+00  1.16287035e+01  3.34065469e+01  3.34065469e+01
  3.34065469e+01  1.01595180e+02  1.28961377e+02  1.28961377e+02
  1.28961377e+02  4.83294338e+02  4.83294338e+02  4.83294338e+02
  5.81797017e+02  1.33513589e+03  1.33513589e+03  1.33513589e+03
  2.65041838e+03  3.02938478e+03  3.02938478e+03  3.02938478e+03
  6.64982976e+03  6.64982976e+03  6.64982976e+03  9.05624805e+03
  2.54120543e+04  7.61546638e+04]
E1 = -728.325895287659  E_coul = 201.59954857498542
cycle= 6 E= -526.726346712674  delta_E= -9.07e-11  |g|= 2.32e-06  |ddm|= 2.43e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.325895287659  E_coul = 201.59954857498542
  HOMO = -0.58023643536075  LUMO = 0.235645218324037
  mo_energy =
[-1.18575527e+02 -1.23040736e+01 -9.55951061e+00 -9.55951061e+00
 -9.55951061e+00 -1.26455734e+00 -5.80236435e-01 -5.80236435e-01
 -5.80236435e-01  2.35645218e-01  1.04127990e+00  1.04127990e+00
  1.04127990e+00  1.65314227e+00  7.29564276e+00  7.29564276e+00
  7.29564276e+00  1.16287057e+01  3.34065499e+01  3.34065499e+01
  3.34065499e+01  1.01595183e+02  1.28961381e+02  1.28961381e+02
  1.28961381e+02  4.83294342e+02  4.83294342e+02  4.83294342e+02
  5.81797022e+02  1.33513590e+03  1.33513590e+03  1.33513590e+03
  2.65041839e+03  3.02938478e+03  3.02938478e+03  3.02938478e+03
  6.64982976e+03  6.64982976e+03  6.64982976e+03  9.05624806e+03
  2.54120543e+04  7.61546638e+04]
E1 = -728.3258835620665  E_coul = 201.59953684939248
Extra cycle  E= -526.726346712674  delta_E= -3.41e-13  |g|= 6.8e-07  |ddm|= 2.68e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 104488.481902315
E1 = -728.3258835620665  E_coul = 201.59953684939248
init E= -526.726346712674
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.580236681169733  LUMO = 0.235645189429899
  mo_energy =
[-1.18575528e+02 -1.23040744e+01 -9.55951151e+00 -9.55951151e+00
 -9.55951151e+00 -1.26455757e+00 -5.80236681e-01 -5.80236681e-01
 -5.80236681e-01  2.35645189e-01  1.04127972e+00  1.04127972e+00
  1.04127972e+00  1.65314208e+00  7.29564219e+00  7.29564219e+00
  7.29564219e+00  1.16287050e+01  3.34065490e+01  3.34065490e+01
  3.34065490e+01  1.01595182e+02  1.28961380e+02  1.28961380e+02
  1.28961380e+02  4.83294341e+02  4.83294341e+02  4.83294341e+02
  5.81797020e+02  1.33513590e+03  1.33513590e+03  1.33513590e+03
  2.65041839e+03  3.02938478e+03  3.02938478e+03  3.02938478e+03
  6.64982976e+03  6.64982976e+03  6.64982976e+03  9.05624805e+03
  2.54120543e+04  7.61546638e+04]
E1 = -728.3258865958182  E_coul = 201.59953988314442
cycle= 1 E= -526.726346712674  delta_E= 1.14e-13  |g|= 1.97e-07  |ddm|= 5.56e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.3258865958182  E_coul = 201.59953988314442
  HOMO = -0.580236628796281  LUMO = 0.23564520131353
  mo_energy =
[-1.18575528e+02 -1.23040742e+01 -9.55951128e+00 -9.55951128e+00
 -9.55951128e+00 -1.26455749e+00 -5.80236629e-01 -5.80236629e-01
 -5.80236629e-01  2.35645201e-01  1.04127976e+00  1.04127976e+00
  1.04127976e+00  1.65314213e+00  7.29564233e+00  7.29564233e+00
  7.29564233e+00  1.16287052e+01  3.34065492e+01  3.34065492e+01
  3.34065492e+01  1.01595183e+02  1.28961380e+02  1.28961380e+02
  1.28961380e+02  4.83294341e+02  4.83294341e+02  4.83294341e+02
  5.81797021e+02  1.33513590e+03  1.33513590e+03  1.33513590e+03
  2.65041839e+03  3.02938478e+03  3.02938478e+03  3.02938478e+03
  6.64982976e+03  6.64982976e+03  6.64982976e+03  9.05624806e+03
  2.54120543e+04  7.61546638e+04]
E1 = -728.325885701862  E_coul = 201.5995389891885
Extra cycle  E= -526.726346712674  delta_E= 2.27e-13  |g|= 5.43e-08  |ddm|= 1.35e-07
    CPU time for scf_cycle      1.10 sec, wall time      0.61 sec
exp = [2.61826559e+04 7.61752191e+03 3.61735087e+03 1.59782559e+03
 3.82851191e+02 1.08121669e+02 3.48083831e+01 7.55751002e+00
 2.66010593e+00 8.21743162e-01 2.41908741e-01 1.03050684e-01
 1.36278321e+03 6.64745674e+02 3.00961957e+02 3.14042244e+02
 6.16222946e+01 7.33028542e+00 2.02388860e+01 7.73119985e-01
 2.80860592e+00 2.29786995e-01]
grad_E = [-1.51793095e-06  3.31111564e-06 -1.58290630e-06  6.94478987e-05
 -3.76568150e-05 -2.91278804e-04 -2.59426096e-03  1.20529654e-02
 -3.15707728e-02  2.26760967e-02 -8.67544275e-02 -1.08694585e-02
 -5.04917782e-07  5.02847537e-06  2.37399495e-05  2.04692932e-05
 -2.38286795e-05  7.24484670e-04 -5.74178102e-06 -5.50877600e-02
 -1.53819230e-04  1.92549821e-01]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:36 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558598        1
[INPUT] 0    0    [1    /1   ]  7617.52190569        1
[INPUT] 0    0    [1    /1   ]  3617.35087219        1
[INPUT] 0    0    [1    /1   ]  1597.82548486        1
[INPUT] 0    0    [1    /1   ]  382.851242226        1
[INPUT] 0    0    [1    /1   ]  108.122219787        1
[INPUT] 0    0    [1    /1   ]  34.8119648282        1
[INPUT] 0    0    [1    /1   ]  7.5327585277         1
[INPUT] 0    0    [1    /1   ]  2.72623715871        1
[INPUT] 0    0    [1    /1   ]  0.820194673817       1
[INPUT] 0    0    [1    /1   ]  0.27940728284        1
[INPUT] 0    0    [1    /1   ]  0.127385715299       1
[INPUT] 1    0    [1    /1   ]  1362.78320778        1
[INPUT] 1    0    [1    /1   ]  664.745665824        1
[INPUT] 1    0    [1    /1   ]  300.961919915        1
[INPUT] 1    0    [1    /1   ]  314.042212216        1
[INPUT] 1    0    [1    /1   ]  61.6223546238        1
[INPUT] 1    0    [1    /1   ]  7.33056219289        1
[INPUT] 1    0    [1    /1   ]  20.2386661268        1
[INPUT] 1    0    [1    /1   ]  0.777163788665       1
[INPUT] 1    0    [1    /1   ]  2.80846138641        1
[INPUT] 1    0    [1    /1   ]  0.225516169562       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.6558598103, 1.0]], [0, [7617.521905688521, 1.0]], [0, [3617.3508721931757, 1.0]], [0, [1597.825484857748, 1.0]], [0, [382.85124222588075, 1.0]], [0, [108.12221978738225, 1.0]], [0, [34.81196482824665, 1.0]], [0, [7.532758527698195, 1.0]], [0, [2.7262371587058367, 1.0]], [0, [0.820194673817358, 1.0]], [0, [0.2794072828400128, 1.0]], [0, [0.12738571529916576, 1.0]], [1, [1362.7832077816286, 1.0]], [1, [664.745665823633, 1.0]], [1, [300.96191991466475, 1.0]], [1, [314.04221221551, 1.0]], [1, [61.6223546238388, 1.0]], [1, [7.330562192891499, 1.0]], [1, [20.238666126796087, 1.0]], [1, [0.7771637886654779, 1.0]], [1, [2.808461386406191, 1.0]], [1, [0.2255161695621266, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65585981]
bas 1, expnt(s) = [7617.52190569]
bas 2, expnt(s) = [3617.35087219]
bas 3, expnt(s) = [1597.82548486]
bas 4, expnt(s) = [382.85124223]
bas 5, expnt(s) = [108.12221979]
bas 6, expnt(s) = [34.81196483]
bas 7, expnt(s) = [7.53275853]
bas 8, expnt(s) = [2.72623716]
bas 9, expnt(s) = [0.82019467]
bas 10, expnt(s) = [0.27940728]
bas 11, expnt(s) = [0.12738572]
bas 12, expnt(s) = [1362.78320778]
bas 13, expnt(s) = [664.74566582]
bas 14, expnt(s) = [300.96191991]
bas 15, expnt(s) = [314.04221222]
bas 16, expnt(s) = [61.62235462]
bas 17, expnt(s) = [7.33056219]
bas 18, expnt(s) = [20.23866613]
bas 19, expnt(s) = [0.77716379]
bas 20, expnt(s) = [2.80846139]
bas 21, expnt(s) = [0.22551617]
CPU time:        24.52
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752191e+03 2.06003836e+03
 3.61735087e+03 1.17844143e+03 1.59782548e+03 6.38501662e+02
 3.82851242e+02 2.18669177e+02 1.08122220e+02 8.47132296e+01
 3.48119648e+01 3.62085744e+01 7.53275853e+00 1.14876332e+01
 2.72623716e+00 5.36028337e+00 8.20194674e-01 2.17747277e+00
 2.79407283e-01 9.70942062e-01 1.27385715e-01 5.38710663e-01
 1.36278321e+03 2.41556017e+04 6.64745666e+02 9.84699654e+03
 3.00961920e+02 3.65699047e+03 3.14042212e+02 3.85673170e+03
 6.16223546e+01 5.03682954e+02 7.33056219e+00 3.51889247e+01
 2.02386661e+01 1.25230972e+02 7.77163789e-01 2.12875210e+00
 2.80846139e+00 1.06064479e+01 2.25516170e-01 4.53373885e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993224738789507
cond(S) = 105146.24107325177
E1 = -729.5217078427356  E_coul = 203.17926686421782
init E= -526.342440978518
    CPU time for initialize scf      0.08 sec, wall time      0.05 sec
  HOMO = -0.555877960481001  LUMO = 0.304460699709795
  mo_energy =
[-1.18326121e+02 -1.22032448e+01 -9.44677048e+00 -9.44677048e+00
 -9.44677048e+00 -1.23967177e+00 -5.55877960e-01 -5.55877960e-01
 -5.55877960e-01  3.04460700e-01  1.04484333e+00  1.04484333e+00
  1.04484333e+00  1.93245192e+00  7.36139225e+00  7.36139225e+00
  7.36139225e+00  1.21568863e+01  3.35262534e+01  3.35262534e+01
  3.35262534e+01  1.02206877e+02  1.29142819e+02  1.29142819e+02
  1.29142819e+02  4.83544706e+02  4.83544706e+02  4.83544706e+02
  5.82440218e+02  1.33543941e+03  1.33543941e+03  1.33543941e+03
  2.65115753e+03  3.02975251e+03  3.02975251e+03  3.02975251e+03
  6.65030935e+03  6.65030935e+03  6.65030935e+03  9.05707921e+03
  2.54129636e+04  7.61556449e+04]
E1 = -727.8346319452503  E_coul = 201.1041624547568
cycle= 1 E= -526.730469490494  delta_E= -0.388  |g|= 0.188  |ddm|= 0.331
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.545605
diis-c [-0.29768519  1.        ]
  HOMO = -0.589887572050381  LUMO = 0.298880730140513
  mo_energy =
[-1.18637521e+02 -1.23405297e+01 -9.59611011e+00 -9.59611011e+00
 -9.59611011e+00 -1.27761568e+00 -5.89887572e-01 -5.89887572e-01
 -5.89887572e-01  2.98880730e-01  1.02108618e+00  1.02108618e+00
  1.02108618e+00  1.90010653e+00  7.27117782e+00  7.27117782e+00
  7.27117782e+00  1.20548086e+01  3.33712473e+01  3.33712473e+01
  3.33712473e+01  1.01986249e+02  1.28912051e+02  1.28912051e+02
  1.28912051e+02  4.83234457e+02  4.83234457e+02  4.83234457e+02
  5.82091824e+02  1.33507213e+03  1.33507213e+03  1.33507213e+03
  2.65065538e+03  3.02931883e+03  3.02931883e+03  3.02931883e+03
  6.64976215e+03  6.64976215e+03  6.64976215e+03  9.05645653e+03
  2.54122468e+04  7.61548380e+04]
E1 = -728.4091107733825  E_coul = 201.6779039426347
cycle= 2 E= -526.731206830748  delta_E= -0.000737  |g|= 0.0381  |ddm|= 0.0515
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0762796
diis-c [-0.00329354  0.08476282  0.91523718]
  HOMO = -0.580891720403987  LUMO = 0.301021358300567
  mo_energy =
[-1.18569549e+02 -1.23025222e+01 -9.55649425e+00 -9.55649425e+00
 -9.55649425e+00 -1.26678268e+00 -5.80891720e-01 -5.80891720e-01
 -5.80891720e-01  3.01021358e-01  1.02778000e+00  1.02778000e+00
  1.02778000e+00  1.90947312e+00  7.29475174e+00  7.29475174e+00
  7.29475174e+00  1.20828071e+01  3.34112396e+01  3.34112396e+01
  3.34112396e+01  1.02041711e+02  1.28968072e+02  1.28968072e+02
  1.28968072e+02  4.83301602e+02  4.83301602e+02  4.83301602e+02
  5.82161329e+02  1.33514335e+03  1.33514335e+03  1.33514335e+03
  2.65072990e+03  3.02939229e+03  3.02939229e+03  3.02939229e+03
  6.64983733e+03  6.64983733e+03  6.64983733e+03  9.05653251e+03
  2.54123234e+04  7.61549148e+04]
E1 = -728.2586210554291  E_coul = 201.5273544473779
cycle= 3 E= -526.731266608051  delta_E= -5.98e-05  |g|= 0.00621  |ddm|= 0.0153
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0131722
diis-c [-1.06219743e-06 -1.36640616e-03  1.42093971e-01  8.59272435e-01]
  HOMO = -0.58237637467899  LUMO = 0.300713211008974
  mo_energy =
[-1.18579393e+02 -1.23082516e+01 -9.56259205e+00 -9.56259205e+00
 -9.56259205e+00 -1.26842315e+00 -5.82376375e-01 -5.82376375e-01
 -5.82376375e-01  3.00713211e-01  1.02670521e+00  1.02670521e+00
  1.02670521e+00  1.90804601e+00  7.29101535e+00  7.29101535e+00
  7.29101535e+00  1.20785312e+01  3.34051317e+01  3.34051317e+01
  3.34051317e+01  1.02033593e+02  1.28959816e+02  1.28959816e+02
  1.28959816e+02  4.83291872e+02  4.83291872e+02  4.83291872e+02
  5.82151246e+02  1.33513303e+03  1.33513303e+03  1.33513303e+03
  2.65071894e+03  3.02938158e+03  3.02938158e+03  3.02938158e+03
  6.64982622e+03  6.64982622e+03  6.64982622e+03  9.05652118e+03
  2.54123118e+04  7.61549031e+04]
E1 = -728.2810303850456  E_coul = 201.54976188174496
cycle= 4 E= -526.731268503301  delta_E= -1.9e-06  |g|= 0.000136  |ddm|= 0.0022
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000183354
diis-c [-1.16828842e-08  1.25890330e-04 -1.66673457e-02 -1.07977313e-01
  1.12451877e+00]
  HOMO = -0.582361049547077  LUMO = 0.300726742183789
  mo_energy =
[-1.18579360e+02 -1.23081857e+01 -9.56254532e+00 -9.56254532e+00
 -9.56254532e+00 -1.26837468e+00 -5.82361050e-01 -5.82361050e-01
 -5.82361050e-01  3.00726742e-01  1.02671984e+00  1.02671984e+00
  1.02671984e+00  1.90808346e+00  7.29105433e+00  7.29105433e+00
  7.29105433e+00  1.20785892e+01  3.34051768e+01  3.34051768e+01
  3.34051768e+01  1.02033642e+02  1.28959859e+02  1.28959859e+02
  1.28959859e+02  4.83291906e+02  4.83291906e+02  4.83291906e+02
  5.82151270e+02  1.33513305e+03  1.33513305e+03  1.33513305e+03
  2.65071893e+03  3.02938159e+03  3.02938159e+03  3.02938159e+03
  6.64982621e+03  6.64982621e+03  6.64982621e+03  9.05652116e+03
  2.54123118e+04  7.61549031e+04]
E1 = -728.2807854203752  E_coul = 201.54951691322077
cycle= 5 E= -526.731268507154  delta_E= -3.85e-09  |g|= 2.36e-05  |ddm|= 0.000196
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.28585e-05
diis-c [-1.87342717e-10  1.29824698e-05 -1.45466971e-03 -1.17313914e-02
  3.68544874e-04  1.01280453e+00]
  HOMO = -0.582371251855464  LUMO = 0.30072549359706
  mo_energy =
[-1.18579398e+02 -1.23082156e+01 -9.56257712e+00 -9.56257712e+00
 -9.56257712e+00 -1.26838301e+00 -5.82371252e-01 -5.82371252e-01
 -5.82371252e-01  3.00725494e-01  1.02671292e+00  1.02671292e+00
  1.02671292e+00  1.90807572e+00  7.29103233e+00  7.29103233e+00
  7.29103233e+00  1.20785659e+01  3.34051460e+01  3.34051460e+01
  3.34051460e+01  1.02033607e+02  1.28959823e+02  1.28959823e+02
  1.28959823e+02  4.83291868e+02  4.83291868e+02  4.83291868e+02
  5.82151231e+02  1.33513301e+03  1.33513301e+03  1.33513301e+03
  2.65071889e+03  3.02938155e+03  3.02938155e+03  3.02938155e+03
  6.64982617e+03  6.64982617e+03  6.64982617e+03  9.05652111e+03
  2.54123118e+04  7.61549030e+04]
E1 = -728.2808868093347  E_coul = 201.54961830209322
cycle= 6 E= -526.731268507241  delta_E= -8.7e-11  |g|= 2.25e-06  |ddm|= 2.46e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2808868093347  E_coul = 201.54961830209322
  HOMO = -0.582370614340602  LUMO = 0.300725741726543
  mo_energy =
[-1.18579395e+02 -1.23082131e+01 -9.56257453e+00 -9.56257453e+00
 -9.56257453e+00 -1.26838194e+00 -5.82370614e-01 -5.82370614e-01
 -5.82370614e-01  3.00725742e-01  1.02671341e+00  1.02671341e+00
  1.02671341e+00  1.90807656e+00  7.29103402e+00  7.29103402e+00
  7.29103402e+00  1.20785679e+01  3.34051486e+01  3.34051486e+01
  3.34051486e+01  1.02033610e+02  1.28959826e+02  1.28959826e+02
  1.28959826e+02  4.83291871e+02  4.83291871e+02  4.83291871e+02
  5.82151235e+02  1.33513302e+03  1.33513302e+03  1.33513302e+03
  2.65071890e+03  3.02938156e+03  3.02938156e+03  3.02938156e+03
  6.64982617e+03  6.64982617e+03  6.64982617e+03  9.05652112e+03
  2.54123118e+04  7.61549030e+04]
E1 = -728.280876316407  E_coul = 201.54960780916537
Extra cycle  E= -526.731268507242  delta_E= -1.14e-13  |g|= 6.29e-07  |ddm|= 2.83e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826559e+04 7.61752191e+03 3.61735087e+03 1.59782548e+03
 3.82851242e+02 1.08122220e+02 3.48119648e+01 7.53275853e+00
 2.72623716e+00 8.20194674e-01 2.79407283e-01 1.27385715e-01
 1.36278321e+03 6.64745666e+02 3.00961920e+02 3.14042212e+02
 6.16223546e+01 7.33056219e+00 2.02386661e+01 7.77163789e-01
 2.80846139e+00 2.25516170e-01]
E = -526.7312685072416
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:36 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558598        1
[INPUT] 0    0    [1    /1   ]  7617.52190569        1
[INPUT] 0    0    [1    /1   ]  3617.35087219        1
[INPUT] 0    0    [1    /1   ]  1597.82548486        1
[INPUT] 0    0    [1    /1   ]  382.851242226        1
[INPUT] 0    0    [1    /1   ]  108.122219787        1
[INPUT] 0    0    [1    /1   ]  34.8119648282        1
[INPUT] 0    0    [1    /1   ]  7.5327585277         1
[INPUT] 0    0    [1    /1   ]  2.72623715871        1
[INPUT] 0    0    [1    /1   ]  0.820194673817       1
[INPUT] 0    0    [1    /1   ]  0.27940728284        1
[INPUT] 0    0    [1    /1   ]  0.127385715299       1
[INPUT] 1    0    [1    /1   ]  1362.78320778        1
[INPUT] 1    0    [1    /1   ]  664.745665824        1
[INPUT] 1    0    [1    /1   ]  300.961919915        1
[INPUT] 1    0    [1    /1   ]  314.042212216        1
[INPUT] 1    0    [1    /1   ]  61.6223546238        1
[INPUT] 1    0    [1    /1   ]  7.33056219289        1
[INPUT] 1    0    [1    /1   ]  20.2386661268        1
[INPUT] 1    0    [1    /1   ]  0.777163788665       1
[INPUT] 1    0    [1    /1   ]  2.80846138641        1
[INPUT] 1    0    [1    /1   ]  0.225516169562       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.6558598103, 1.0]], [0, [7617.521905688521, 1.0]], [0, [3617.3508721931757, 1.0]], [0, [1597.825484857748, 1.0]], [0, [382.85124222588075, 1.0]], [0, [108.12221978738225, 1.0]], [0, [34.81196482824665, 1.0]], [0, [7.532758527698195, 1.0]], [0, [2.7262371587058367, 1.0]], [0, [0.820194673817358, 1.0]], [0, [0.2794072828400128, 1.0]], [0, [0.12738571529916576, 1.0]], [1, [1362.7832077816286, 1.0]], [1, [664.745665823633, 1.0]], [1, [300.96191991466475, 1.0]], [1, [314.04221221551, 1.0]], [1, [61.6223546238388, 1.0]], [1, [7.330562192891499, 1.0]], [1, [20.238666126796087, 1.0]], [1, [0.7771637886654779, 1.0]], [1, [2.808461386406191, 1.0]], [1, [0.2255161695621266, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65585981]
bas 1, expnt(s) = [7617.52190569]
bas 2, expnt(s) = [3617.35087219]
bas 3, expnt(s) = [1597.82548486]
bas 4, expnt(s) = [382.85124223]
bas 5, expnt(s) = [108.12221979]
bas 6, expnt(s) = [34.81196483]
bas 7, expnt(s) = [7.53275853]
bas 8, expnt(s) = [2.72623716]
bas 9, expnt(s) = [0.82019467]
bas 10, expnt(s) = [0.27940728]
bas 11, expnt(s) = [0.12738572]
bas 12, expnt(s) = [1362.78320778]
bas 13, expnt(s) = [664.74566582]
bas 14, expnt(s) = [300.96191991]
bas 15, expnt(s) = [314.04221222]
bas 16, expnt(s) = [61.62235462]
bas 17, expnt(s) = [7.33056219]
bas 18, expnt(s) = [20.23866613]
bas 19, expnt(s) = [0.77716379]
bas 20, expnt(s) = [2.80846139]
bas 21, expnt(s) = [0.22551617]
CPU time:        24.85
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752191e+03 2.06003836e+03
 3.61735087e+03 1.17844143e+03 1.59782548e+03 6.38501662e+02
 3.82851242e+02 2.18669177e+02 1.08122220e+02 8.47132296e+01
 3.48119648e+01 3.62085744e+01 7.53275853e+00 1.14876332e+01
 2.72623716e+00 5.36028337e+00 8.20194674e-01 2.17747277e+00
 2.79407283e-01 9.70942062e-01 1.27385715e-01 5.38710663e-01
 1.36278321e+03 2.41556017e+04 6.64745666e+02 9.84699654e+03
 3.00961920e+02 3.65699047e+03 3.14042212e+02 3.85673170e+03
 6.16223546e+01 5.03682954e+02 7.33056219e+00 3.51889247e+01
 2.02386661e+01 1.25230972e+02 7.77163789e-01 2.12875210e+00
 2.80846139e+00 1.06064479e+01 2.25516170e-01 4.53373885e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993224738789507
cond(S) = 105146.24107325177
E1 = -729.5217078427356  E_coul = 203.17926686421782
init E= -526.342440978518
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555877960481001  LUMO = 0.304460699709795
  mo_energy =
[-1.18326121e+02 -1.22032448e+01 -9.44677048e+00 -9.44677048e+00
 -9.44677048e+00 -1.23967177e+00 -5.55877960e-01 -5.55877960e-01
 -5.55877960e-01  3.04460700e-01  1.04484333e+00  1.04484333e+00
  1.04484333e+00  1.93245192e+00  7.36139225e+00  7.36139225e+00
  7.36139225e+00  1.21568863e+01  3.35262534e+01  3.35262534e+01
  3.35262534e+01  1.02206877e+02  1.29142819e+02  1.29142819e+02
  1.29142819e+02  4.83544706e+02  4.83544706e+02  4.83544706e+02
  5.82440218e+02  1.33543941e+03  1.33543941e+03  1.33543941e+03
  2.65115753e+03  3.02975251e+03  3.02975251e+03  3.02975251e+03
  6.65030935e+03  6.65030935e+03  6.65030935e+03  9.05707921e+03
  2.54129636e+04  7.61556449e+04]
E1 = -727.8346319452503  E_coul = 201.1041624547568
cycle= 1 E= -526.730469490494  delta_E= -0.388  |g|= 0.188  |ddm|= 0.331
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.545605
diis-c [-0.29768519  1.        ]
  HOMO = -0.589887572050381  LUMO = 0.298880730140513
  mo_energy =
[-1.18637521e+02 -1.23405297e+01 -9.59611011e+00 -9.59611011e+00
 -9.59611011e+00 -1.27761568e+00 -5.89887572e-01 -5.89887572e-01
 -5.89887572e-01  2.98880730e-01  1.02108618e+00  1.02108618e+00
  1.02108618e+00  1.90010653e+00  7.27117782e+00  7.27117782e+00
  7.27117782e+00  1.20548086e+01  3.33712473e+01  3.33712473e+01
  3.33712473e+01  1.01986249e+02  1.28912051e+02  1.28912051e+02
  1.28912051e+02  4.83234457e+02  4.83234457e+02  4.83234457e+02
  5.82091824e+02  1.33507213e+03  1.33507213e+03  1.33507213e+03
  2.65065538e+03  3.02931883e+03  3.02931883e+03  3.02931883e+03
  6.64976215e+03  6.64976215e+03  6.64976215e+03  9.05645653e+03
  2.54122468e+04  7.61548380e+04]
E1 = -728.4091107733825  E_coul = 201.6779039426347
cycle= 2 E= -526.731206830748  delta_E= -0.000737  |g|= 0.0381  |ddm|= 0.0515
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0762796
diis-c [-0.00329354  0.08476282  0.91523718]
  HOMO = -0.580891720403987  LUMO = 0.301021358300567
  mo_energy =
[-1.18569549e+02 -1.23025222e+01 -9.55649425e+00 -9.55649425e+00
 -9.55649425e+00 -1.26678268e+00 -5.80891720e-01 -5.80891720e-01
 -5.80891720e-01  3.01021358e-01  1.02778000e+00  1.02778000e+00
  1.02778000e+00  1.90947312e+00  7.29475174e+00  7.29475174e+00
  7.29475174e+00  1.20828071e+01  3.34112396e+01  3.34112396e+01
  3.34112396e+01  1.02041711e+02  1.28968072e+02  1.28968072e+02
  1.28968072e+02  4.83301602e+02  4.83301602e+02  4.83301602e+02
  5.82161329e+02  1.33514335e+03  1.33514335e+03  1.33514335e+03
  2.65072990e+03  3.02939229e+03  3.02939229e+03  3.02939229e+03
  6.64983733e+03  6.64983733e+03  6.64983733e+03  9.05653251e+03
  2.54123234e+04  7.61549148e+04]
E1 = -728.2586210554291  E_coul = 201.5273544473779
cycle= 3 E= -526.731266608051  delta_E= -5.98e-05  |g|= 0.00621  |ddm|= 0.0153
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0131722
diis-c [-1.06219743e-06 -1.36640616e-03  1.42093971e-01  8.59272435e-01]
  HOMO = -0.58237637467899  LUMO = 0.300713211008974
  mo_energy =
[-1.18579393e+02 -1.23082516e+01 -9.56259205e+00 -9.56259205e+00
 -9.56259205e+00 -1.26842315e+00 -5.82376375e-01 -5.82376375e-01
 -5.82376375e-01  3.00713211e-01  1.02670521e+00  1.02670521e+00
  1.02670521e+00  1.90804601e+00  7.29101535e+00  7.29101535e+00
  7.29101535e+00  1.20785312e+01  3.34051317e+01  3.34051317e+01
  3.34051317e+01  1.02033593e+02  1.28959816e+02  1.28959816e+02
  1.28959816e+02  4.83291872e+02  4.83291872e+02  4.83291872e+02
  5.82151246e+02  1.33513303e+03  1.33513303e+03  1.33513303e+03
  2.65071894e+03  3.02938158e+03  3.02938158e+03  3.02938158e+03
  6.64982622e+03  6.64982622e+03  6.64982622e+03  9.05652118e+03
  2.54123118e+04  7.61549031e+04]
E1 = -728.2810303850456  E_coul = 201.54976188174496
cycle= 4 E= -526.731268503301  delta_E= -1.9e-06  |g|= 0.000136  |ddm|= 0.0022
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000183354
diis-c [-1.16828842e-08  1.25890330e-04 -1.66673457e-02 -1.07977313e-01
  1.12451877e+00]
  HOMO = -0.582361049547077  LUMO = 0.300726742183789
  mo_energy =
[-1.18579360e+02 -1.23081857e+01 -9.56254532e+00 -9.56254532e+00
 -9.56254532e+00 -1.26837468e+00 -5.82361050e-01 -5.82361050e-01
 -5.82361050e-01  3.00726742e-01  1.02671984e+00  1.02671984e+00
  1.02671984e+00  1.90808346e+00  7.29105433e+00  7.29105433e+00
  7.29105433e+00  1.20785892e+01  3.34051768e+01  3.34051768e+01
  3.34051768e+01  1.02033642e+02  1.28959859e+02  1.28959859e+02
  1.28959859e+02  4.83291906e+02  4.83291906e+02  4.83291906e+02
  5.82151270e+02  1.33513305e+03  1.33513305e+03  1.33513305e+03
  2.65071893e+03  3.02938159e+03  3.02938159e+03  3.02938159e+03
  6.64982621e+03  6.64982621e+03  6.64982621e+03  9.05652116e+03
  2.54123118e+04  7.61549031e+04]
E1 = -728.2807854203752  E_coul = 201.54951691322077
cycle= 5 E= -526.731268507154  delta_E= -3.85e-09  |g|= 2.36e-05  |ddm|= 0.000196
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.28585e-05
diis-c [-1.87342717e-10  1.29824698e-05 -1.45466971e-03 -1.17313914e-02
  3.68544874e-04  1.01280453e+00]
  HOMO = -0.582371251855464  LUMO = 0.30072549359706
  mo_energy =
[-1.18579398e+02 -1.23082156e+01 -9.56257712e+00 -9.56257712e+00
 -9.56257712e+00 -1.26838301e+00 -5.82371252e-01 -5.82371252e-01
 -5.82371252e-01  3.00725494e-01  1.02671292e+00  1.02671292e+00
  1.02671292e+00  1.90807572e+00  7.29103233e+00  7.29103233e+00
  7.29103233e+00  1.20785659e+01  3.34051460e+01  3.34051460e+01
  3.34051460e+01  1.02033607e+02  1.28959823e+02  1.28959823e+02
  1.28959823e+02  4.83291868e+02  4.83291868e+02  4.83291868e+02
  5.82151231e+02  1.33513301e+03  1.33513301e+03  1.33513301e+03
  2.65071889e+03  3.02938155e+03  3.02938155e+03  3.02938155e+03
  6.64982617e+03  6.64982617e+03  6.64982617e+03  9.05652111e+03
  2.54123118e+04  7.61549030e+04]
E1 = -728.2808868093347  E_coul = 201.54961830209322
cycle= 6 E= -526.731268507241  delta_E= -8.7e-11  |g|= 2.25e-06  |ddm|= 2.46e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2808868093347  E_coul = 201.54961830209322
  HOMO = -0.582370614340602  LUMO = 0.300725741726543
  mo_energy =
[-1.18579395e+02 -1.23082131e+01 -9.56257453e+00 -9.56257453e+00
 -9.56257453e+00 -1.26838194e+00 -5.82370614e-01 -5.82370614e-01
 -5.82370614e-01  3.00725742e-01  1.02671341e+00  1.02671341e+00
  1.02671341e+00  1.90807656e+00  7.29103402e+00  7.29103402e+00
  7.29103402e+00  1.20785679e+01  3.34051486e+01  3.34051486e+01
  3.34051486e+01  1.02033610e+02  1.28959826e+02  1.28959826e+02
  1.28959826e+02  4.83291871e+02  4.83291871e+02  4.83291871e+02
  5.82151235e+02  1.33513302e+03  1.33513302e+03  1.33513302e+03
  2.65071890e+03  3.02938156e+03  3.02938156e+03  3.02938156e+03
  6.64982617e+03  6.64982617e+03  6.64982617e+03  9.05652112e+03
  2.54123118e+04  7.61549030e+04]
E1 = -728.280876316407  E_coul = 201.54960780916537
Extra cycle  E= -526.731268507242  delta_E= -1.14e-13  |g|= 6.29e-07  |ddm|= 2.83e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 105146.24107325177
E1 = -728.280876316407  E_coul = 201.54960780916537
init E= -526.731268507242
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.582370838759434  LUMO = 0.300725712498164
  mo_energy =
[-1.18579396e+02 -1.23082138e+01 -9.56257533e+00 -9.56257533e+00
 -9.56257533e+00 -1.26838213e+00 -5.82370839e-01 -5.82370839e-01
 -5.82370839e-01  3.00725712e-01  1.02671326e+00  1.02671326e+00
  1.02671326e+00  1.90807638e+00  7.29103351e+00  7.29103351e+00
  7.29103351e+00  1.20785673e+01  3.34051478e+01  3.34051478e+01
  3.34051478e+01  1.02033609e+02  1.28959825e+02  1.28959825e+02
  1.28959825e+02  4.83291870e+02  4.83291870e+02  4.83291870e+02
  5.82151233e+02  1.33513301e+03  1.33513301e+03  1.33513301e+03
  2.65071890e+03  3.02938156e+03  3.02938156e+03  3.02938156e+03
  6.64982617e+03  6.64982617e+03  6.64982617e+03  9.05652112e+03
  2.54123118e+04  7.61549030e+04]
E1 = -728.2808790250391  E_coul = 201.54961051779745
cycle= 1 E= -526.731268507242  delta_E= -1.14e-13  |g|= 1.82e-07  |ddm|= 5.81e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2808790250391  E_coul = 201.54961051779745
  HOMO = -0.582370792433875  LUMO = 0.300725727729854
  mo_energy =
[-1.18579396e+02 -1.23082136e+01 -9.56257513e+00 -9.56257513e+00
 -9.56257513e+00 -1.26838206e+00 -5.82370792e-01 -5.82370792e-01
 -5.82370792e-01  3.00725728e-01  1.02671330e+00  1.02671330e+00
  1.02671330e+00  1.90807644e+00  7.29103363e+00  7.29103363e+00
  7.29103363e+00  1.20785675e+01  3.34051480e+01  3.34051480e+01
  3.34051480e+01  1.02033609e+02  1.28959825e+02  1.28959825e+02
  1.28959825e+02  4.83291870e+02  4.83291870e+02  4.83291870e+02
  5.82151234e+02  1.33513301e+03  1.33513301e+03  1.33513301e+03
  2.65071890e+03  3.02938156e+03  3.02938156e+03  3.02938156e+03
  6.64982617e+03  6.64982617e+03  6.64982617e+03  9.05652112e+03
  2.54123118e+04  7.61549030e+04]
E1 = -728.2808782101865  E_coul = 201.54960970294434
Extra cycle  E= -526.731268507242  delta_E= -5.68e-13  |g|= 4.95e-08  |ddm|= 1.42e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826559e+04 7.61752191e+03 3.61735087e+03 1.59782548e+03
 3.82851242e+02 1.08122220e+02 3.48119648e+01 7.53275853e+00
 2.72623716e+00 8.20194674e-01 2.79407283e-01 1.27385715e-01
 1.36278321e+03 6.64745666e+02 3.00961920e+02 3.14042212e+02
 6.16223546e+01 7.33056219e+00 2.02386661e+01 7.77163789e-01
 2.80846139e+00 2.25516170e-01]
grad_E = [-1.51825626e-06  3.31584242e-06 -1.57930670e-06  6.96390632e-05
 -4.42991172e-05 -2.06144977e-04 -3.00050139e-03  8.01128127e-03
 -2.43937864e-02  7.77943468e-03 -3.17586418e-02  4.00016852e-03
 -5.04935114e-07  5.03292705e-06  2.37681777e-05  2.04927239e-05
 -3.06769331e-05  1.20001557e-04  6.80553378e-05 -1.53343793e-02
 -4.04561772e-04  6.28319048e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:41 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558644        1
[INPUT] 0    0    [1    /1   ]  7617.52189575        1
[INPUT] 0    0    [1    /1   ]  3617.35087694        1
[INPUT] 0    0    [1    /1   ]  1597.82527638        1
[INPUT] 0    0    [1    /1   ]  382.851358053        1
[INPUT] 0    0    [1    /1   ]  108.123057022        1
[INPUT] 0    0    [1    /1   ]  34.8198983133        1
[INPUT] 0    0    [1    /1   ]  7.49655087491        1
[INPUT] 0    0    [1    /1   ]  2.82913879197        1
[INPUT] 0    0    [1    /1   ]  0.823705821016       1
[INPUT] 0    0    [1    /1   ]  0.30873099198        1
[INPUT] 0    0    [1    /1   ]  0.144950675589       1
[INPUT] 1    0    [1    /1   ]  1362.7832093         1
[INPUT] 1    0    [1    /1   ]  664.7456507          1
[INPUT] 1    0    [1    /1   ]  300.961848464        1
[INPUT] 1    0    [1    /1   ]  314.042150612        1
[INPUT] 1    0    [1    /1   ]  61.6224648154        1
[INPUT] 1    0    [1    /1   ]  7.33110715864        1
[INPUT] 1    0    [1    /1   ]  20.2382853142        1
[INPUT] 1    0    [1    /1   ]  0.776713968289       1
[INPUT] 1    0    [1    /1   ]  2.80893598463        1
[INPUT] 1    0    [1    /1   ]  0.221096386364       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655864365224, 1.0]], [0, [7617.521895750918, 1.0]], [0, [3617.350876941151, 1.0]], [0, [1597.8252763846026, 1.0]], [0, [382.85135805257516, 1.0]], [0, [108.12305702173971, 1.0]], [0, [34.819898313301884, 1.0]], [0, [7.496550874914947, 1.0]], [0, [2.82913879197126, 1.0]], [0, [0.8237058210159834, 1.0]], [0, [0.3087309919802701, 1.0]], [0, [0.14495067558863364, 1.0]], [1, [1362.783209295301, 1.0]], [1, [664.7456507002904, 1.0]], [1, [300.9618484636667, 1.0]], [1, [314.0421506120157, 1.0]], [1, [61.62246481536771, 1.0]], [1, [7.331107158642465, 1.0]], [1, [20.238285314245825, 1.0]], [1, [0.7767139682888284, 1.0]], [1, [2.8089359846343194, 1.0]], [1, [0.22109638636411583, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65586437]
bas 1, expnt(s) = [7617.52189575]
bas 2, expnt(s) = [3617.35087694]
bas 3, expnt(s) = [1597.82527638]
bas 4, expnt(s) = [382.85135805]
bas 5, expnt(s) = [108.12305702]
bas 6, expnt(s) = [34.81989831]
bas 7, expnt(s) = [7.49655087]
bas 8, expnt(s) = [2.82913879]
bas 9, expnt(s) = [0.82370582]
bas 10, expnt(s) = [0.30873099]
bas 11, expnt(s) = [0.14495068]
bas 12, expnt(s) = [1362.7832093]
bas 13, expnt(s) = [664.7456507]
bas 14, expnt(s) = [300.96184846]
bas 15, expnt(s) = [314.04215061]
bas 16, expnt(s) = [61.62246482]
bas 17, expnt(s) = [7.33110716]
bas 18, expnt(s) = [20.23828531]
bas 19, expnt(s) = [0.77671397]
bas 20, expnt(s) = [2.80893598]
bas 21, expnt(s) = [0.22109639]
CPU time:        30.56
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752190e+03 2.06003836e+03
 3.61735088e+03 1.17844143e+03 1.59782528e+03 6.38501600e+02
 3.82851358e+02 2.18669226e+02 1.08123057e+02 8.47137216e+01
 3.48198983e+01 3.62147631e+01 7.49655087e+00 1.14461951e+01
 2.82913879e+00 5.51132110e+00 8.23705821e-01 2.18446015e+00
 3.08730992e-01 1.04640594e+00 1.44950676e-01 5.93512961e-01
 1.36278321e+03 2.41556017e+04 6.64745651e+02 9.84699626e+03
 3.00961848e+02 3.65698938e+03 3.14042151e+02 3.85673075e+03
 6.16224648e+01 5.03684080e+02 7.33110716e+00 3.51921947e+01
 2.02382853e+01 1.25228026e+02 7.76713968e-01 2.12721206e+00
 2.80893598e+00 1.06086884e+01 2.21096386e-01 4.42294408e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99383407951375
cond(S) = 105703.98001449365
E1 = -729.5208217842745  E_coul = 203.17559800293637
init E= -526.345223781338
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.556023399579852  LUMO = 0.355863935699229
  mo_energy =
[-1.18326770e+02 -1.22042343e+01 -9.44701063e+00 -9.44701063e+00
 -9.44701063e+00 -1.24012639e+00 -5.56023400e-01 -5.56023400e-01
 -5.56023400e-01  3.55863936e-01  1.02721929e+00  1.02721929e+00
  1.02721929e+00  2.13517732e+00  7.34344711e+00  7.34344711e+00
  7.34344711e+00  1.26409908e+01  3.35141476e+01  3.35141476e+01
  3.35141476e+01  1.02735106e+02  1.29134346e+02  1.29134346e+02
  1.29134346e+02  4.83537870e+02  4.83537870e+02  4.83537870e+02
  5.82879591e+02  1.33543354e+03  1.33543354e+03  1.33543354e+03
  2.65153381e+03  3.02974682e+03  3.02974682e+03  3.02974682e+03
  6.65030394e+03  6.65030394e+03  6.65030394e+03  9.05742213e+03
  2.54132874e+04  7.61559462e+04]
E1 = -727.7705406985547  E_coul = 201.0374189041769
cycle= 1 E= -526.733121794378  delta_E= -0.388  |g|= 0.189  |ddm|= 0.288
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547305
diis-c [-0.2995427  1.       ]
  HOMO = -0.592469760703926  LUMO = 0.347865524661227
  mo_energy =
[-1.18643146e+02 -1.23456823e+01 -9.60035210e+00 -9.60035210e+00
 -9.60035210e+00 -1.28109249e+00 -5.92469761e-01 -5.92469761e-01
 -5.92469761e-01  3.47865525e-01  1.00179610e+00  1.00179610e+00
  1.00179610e+00  2.09841573e+00  7.24929813e+00  7.24929813e+00
  7.24929813e+00  1.25343733e+01  3.33549426e+01  3.33549426e+01
  3.33549426e+01  1.02510560e+02  1.28899050e+02  1.28899050e+02
  1.28899050e+02  4.83222804e+02  4.83222804e+02  4.83222804e+02
  5.82526013e+02  1.33506094e+03  1.33506094e+03  1.33506094e+03
  2.65102603e+03  3.02930767e+03  3.02930767e+03  3.02930767e+03
  6.64975101e+03  6.64975101e+03  6.64975101e+03  9.05679357e+03
  2.54125646e+04  7.61551331e+04]
E1 = -728.3662992507784  E_coul = 201.6324038355165
cycle= 2 E= -526.733895415262  delta_E= -0.000774  |g|= 0.039  |ddm|= 0.0541
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0780937
diis-c [-0.00341076  0.08698413  0.91301587]
  HOMO = -0.583072786440116  LUMO = 0.350491411738986
  mo_energy =
[-1.18573354e+02 -1.23063281e+01 -9.55931740e+00 -9.55931740e+00
 -9.55931740e+00 -1.26981833e+00 -5.83072786e-01 -5.83072786e-01
 -5.83072786e-01  3.50491412e-01  1.00871833e+00  1.00871833e+00
  1.00871833e+00  2.10858727e+00  7.27383397e+00  7.27383397e+00
  7.27383397e+00  1.25636099e+01  3.33963185e+01  3.33963185e+01
  3.33963185e+01  1.02567630e+02  1.28956721e+02  1.28956721e+02
  1.28956721e+02  4.83291755e+02  4.83291755e+02  4.83291755e+02
  5.82597350e+02  1.33513403e+03  1.33513403e+03  1.33513403e+03
  2.65110247e+03  3.02938302e+03  3.02938302e+03  3.02938302e+03
  6.64982812e+03  6.64982812e+03  6.64982812e+03  9.05687150e+03
  2.54126431e+04  7.61552119e+04]
E1 = -728.2091805551198  E_coul = 201.47522069315738
cycle= 3 E= -526.733959861962  delta_E= -6.44e-05  |g|= 0.00637  |ddm|= 0.0155
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0134273
diis-c [-9.03987891e-07 -1.34777912e-03  1.41754137e-01  8.59593642e-01]
  HOMO = -0.584620289205644  LUMO = 0.350100247988696
  mo_energy =
[-1.18583457e+02 -1.23122505e+01 -9.56560610e+00 -9.56560610e+00
 -9.56560610e+00 -1.27154936e+00 -5.84620289e-01 -5.84620289e-01
 -5.84620289e-01  3.50100248e-01  1.00760406e+00  1.00760406e+00
  1.00760406e+00  2.10701255e+00  7.26995801e+00  7.26995801e+00
  7.26995801e+00  1.25591467e+01  3.33900191e+01  3.33900191e+01
  3.33900191e+01  1.02559285e+02  1.28948233e+02  1.28948233e+02
  1.28948233e+02  4.83281769e+02  4.83281769e+02  4.83281769e+02
  5.82587007e+02  1.33512344e+03  1.33512344e+03  1.33512344e+03
  2.65109124e+03  3.02937205e+03  3.02937205e+03  3.02937205e+03
  6.64981674e+03  6.64981674e+03  6.64981674e+03  9.05685990e+03
  2.54126313e+04  7.61552000e+04]
E1 = -728.2325591633454  E_coul = 201.49859727310337
cycle= 4 E= -526.733961890242  delta_E= -2.03e-06  |g|= 0.000116  |ddm|= 0.0023
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000154076
diis-c [-9.55932991e-09  1.01470519e-04 -1.37516974e-02 -8.91687810e-02
  1.10281901e+00]
  HOMO = -0.584604020883504  LUMO = 0.350114093688227
  mo_energy =
[-1.18583418e+02 -1.23121831e+01 -9.56555497e+00 -9.56555497e+00
 -9.56555497e+00 -1.27150507e+00 -5.84604021e-01 -5.84604021e-01
 -5.84604021e-01  3.50114094e-01  1.00761857e+00  1.00761857e+00
  1.00761857e+00  2.10704710e+00  7.26999903e+00  7.26999903e+00
  7.26999903e+00  1.25592046e+01  3.33900681e+01  3.33900681e+01
  3.33900681e+01  1.02559337e+02  1.28948280e+02  1.28948280e+02
  1.28948280e+02  4.83281808e+02  4.83281808e+02  4.83281808e+02
  5.82587037e+02  1.33512347e+03  1.33512347e+03  1.33512347e+03
  2.65109124e+03  3.02937206e+03  3.02937206e+03  3.02937206e+03
  6.64981674e+03  6.64981674e+03  6.64981674e+03  9.05685989e+03
  2.54126313e+04  7.61552000e+04]
E1 = -728.2323054691209  E_coul = 201.49834357614023
cycle= 5 E= -526.733961892981  delta_E= -2.74e-09  |g|= 2.28e-05  |ddm|= 0.000166
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.18548e-05
diis-c [-1.67320154e-10  1.26327216e-05 -1.43411819e-03 -1.15343426e-02
 -5.93386352e-04  1.01354921e+00]
  HOMO = -0.584613637729171  LUMO = 0.350112677829187
  mo_energy =
[-1.18583455e+02 -1.23122111e+01 -9.56558503e+00 -9.56558503e+00
 -9.56558503e+00 -1.27151292e+00 -5.84613638e-01 -5.84613638e-01
 -5.84613638e-01  3.50112678e-01  1.00761210e+00  1.00761210e+00
  1.00761210e+00  2.10703934e+00  7.26997826e+00  7.26997826e+00
  7.26997826e+00  1.25591825e+01  3.33900389e+01  3.33900389e+01
  3.33900389e+01  1.02559304e+02  1.28948246e+02  1.28948246e+02
  1.28948246e+02  4.83281772e+02  4.83281772e+02  4.83281772e+02
  5.82587001e+02  1.33512343e+03  1.33512343e+03  1.33512343e+03
  2.65109121e+03  3.02937203e+03  3.02937203e+03  3.02937203e+03
  6.64981670e+03  6.64981670e+03  6.64981670e+03  9.05685985e+03
  2.54126312e+04  7.61551999e+04]
E1 = -728.2324027420939  E_coul = 201.4984408490349
cycle= 6 E= -526.733961893059  delta_E= -7.83e-11  |g|= 2.15e-06  |ddm|= 2.42e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2324027420939  E_coul = 201.4984408490349
  HOMO = -0.584613097920158  LUMO = 0.350112958993784
  mo_energy =
[-1.18583452e+02 -1.23122090e+01 -9.56558284e+00 -9.56558284e+00
 -9.56558284e+00 -1.27151193e+00 -5.84613098e-01 -5.84613098e-01
 -5.84613098e-01  3.50112959e-01  1.00761253e+00  1.00761253e+00
  1.00761253e+00  2.10704013e+00  7.26997970e+00  7.26997970e+00
  7.26997970e+00  1.25591842e+01  3.33900411e+01  3.33900411e+01
  3.33900411e+01  1.02559307e+02  1.28948249e+02  1.28948249e+02
  1.28948249e+02  4.83281775e+02  4.83281775e+02  4.83281775e+02
  5.82587004e+02  1.33512344e+03  1.33512344e+03  1.33512344e+03
  2.65109121e+03  3.02937203e+03  3.02937203e+03  3.02937203e+03
  6.64981670e+03  6.64981670e+03  6.64981670e+03  9.05685986e+03
  2.54126312e+04  7.61551999e+04]
E1 = -728.2323935921748  E_coul = 201.49843169911506
Extra cycle  E= -526.73396189306  delta_E= -7.96e-13  |g|= 5.73e-07  |ddm|= 2.88e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.27 sec
exp = [2.61826559e+04 7.61752190e+03 3.61735088e+03 1.59782528e+03
 3.82851358e+02 1.08123057e+02 3.48198983e+01 7.49655087e+00
 2.82913879e+00 8.23705821e-01 3.08730992e-01 1.44950676e-01
 1.36278321e+03 6.64745651e+02 3.00961848e+02 3.14042151e+02
 6.16224648e+01 7.33110716e+00 2.02382853e+01 7.76713968e-01
 2.80893598e+00 2.21096386e-01]
E = -526.7339618930598
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:41 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558644        1
[INPUT] 0    0    [1    /1   ]  7617.52189575        1
[INPUT] 0    0    [1    /1   ]  3617.35087694        1
[INPUT] 0    0    [1    /1   ]  1597.82527638        1
[INPUT] 0    0    [1    /1   ]  382.851358053        1
[INPUT] 0    0    [1    /1   ]  108.123057022        1
[INPUT] 0    0    [1    /1   ]  34.8198983133        1
[INPUT] 0    0    [1    /1   ]  7.49655087491        1
[INPUT] 0    0    [1    /1   ]  2.82913879197        1
[INPUT] 0    0    [1    /1   ]  0.823705821016       1
[INPUT] 0    0    [1    /1   ]  0.30873099198        1
[INPUT] 0    0    [1    /1   ]  0.144950675589       1
[INPUT] 1    0    [1    /1   ]  1362.7832093         1
[INPUT] 1    0    [1    /1   ]  664.7456507          1
[INPUT] 1    0    [1    /1   ]  300.961848464        1
[INPUT] 1    0    [1    /1   ]  314.042150612        1
[INPUT] 1    0    [1    /1   ]  61.6224648154        1
[INPUT] 1    0    [1    /1   ]  7.33110715864        1
[INPUT] 1    0    [1    /1   ]  20.2382853142        1
[INPUT] 1    0    [1    /1   ]  0.776713968289       1
[INPUT] 1    0    [1    /1   ]  2.80893598463        1
[INPUT] 1    0    [1    /1   ]  0.221096386364       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655864365224, 1.0]], [0, [7617.521895750918, 1.0]], [0, [3617.350876941151, 1.0]], [0, [1597.8252763846026, 1.0]], [0, [382.85135805257516, 1.0]], [0, [108.12305702173971, 1.0]], [0, [34.819898313301884, 1.0]], [0, [7.496550874914947, 1.0]], [0, [2.82913879197126, 1.0]], [0, [0.8237058210159834, 1.0]], [0, [0.3087309919802701, 1.0]], [0, [0.14495067558863364, 1.0]], [1, [1362.783209295301, 1.0]], [1, [664.7456507002904, 1.0]], [1, [300.9618484636667, 1.0]], [1, [314.0421506120157, 1.0]], [1, [61.62246481536771, 1.0]], [1, [7.331107158642465, 1.0]], [1, [20.238285314245825, 1.0]], [1, [0.7767139682888284, 1.0]], [1, [2.8089359846343194, 1.0]], [1, [0.22109638636411583, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65586437]
bas 1, expnt(s) = [7617.52189575]
bas 2, expnt(s) = [3617.35087694]
bas 3, expnt(s) = [1597.82527638]
bas 4, expnt(s) = [382.85135805]
bas 5, expnt(s) = [108.12305702]
bas 6, expnt(s) = [34.81989831]
bas 7, expnt(s) = [7.49655087]
bas 8, expnt(s) = [2.82913879]
bas 9, expnt(s) = [0.82370582]
bas 10, expnt(s) = [0.30873099]
bas 11, expnt(s) = [0.14495068]
bas 12, expnt(s) = [1362.7832093]
bas 13, expnt(s) = [664.7456507]
bas 14, expnt(s) = [300.96184846]
bas 15, expnt(s) = [314.04215061]
bas 16, expnt(s) = [61.62246482]
bas 17, expnt(s) = [7.33110716]
bas 18, expnt(s) = [20.23828531]
bas 19, expnt(s) = [0.77671397]
bas 20, expnt(s) = [2.80893598]
bas 21, expnt(s) = [0.22109639]
CPU time:        30.90
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752190e+03 2.06003836e+03
 3.61735088e+03 1.17844143e+03 1.59782528e+03 6.38501600e+02
 3.82851358e+02 2.18669226e+02 1.08123057e+02 8.47137216e+01
 3.48198983e+01 3.62147631e+01 7.49655087e+00 1.14461951e+01
 2.82913879e+00 5.51132110e+00 8.23705821e-01 2.18446015e+00
 3.08730992e-01 1.04640594e+00 1.44950676e-01 5.93512961e-01
 1.36278321e+03 2.41556017e+04 6.64745651e+02 9.84699626e+03
 3.00961848e+02 3.65698938e+03 3.14042151e+02 3.85673075e+03
 6.16224648e+01 5.03684080e+02 7.33110716e+00 3.51921947e+01
 2.02382853e+01 1.25228026e+02 7.76713968e-01 2.12721206e+00
 2.80893598e+00 1.06086884e+01 2.21096386e-01 4.42294408e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99383407951375
cond(S) = 105703.98001449365
E1 = -729.5208217842745  E_coul = 203.17559800293637
init E= -526.345223781338
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556023399579852  LUMO = 0.355863935699229
  mo_energy =
[-1.18326770e+02 -1.22042343e+01 -9.44701063e+00 -9.44701063e+00
 -9.44701063e+00 -1.24012639e+00 -5.56023400e-01 -5.56023400e-01
 -5.56023400e-01  3.55863936e-01  1.02721929e+00  1.02721929e+00
  1.02721929e+00  2.13517732e+00  7.34344711e+00  7.34344711e+00
  7.34344711e+00  1.26409908e+01  3.35141476e+01  3.35141476e+01
  3.35141476e+01  1.02735106e+02  1.29134346e+02  1.29134346e+02
  1.29134346e+02  4.83537870e+02  4.83537870e+02  4.83537870e+02
  5.82879591e+02  1.33543354e+03  1.33543354e+03  1.33543354e+03
  2.65153381e+03  3.02974682e+03  3.02974682e+03  3.02974682e+03
  6.65030394e+03  6.65030394e+03  6.65030394e+03  9.05742213e+03
  2.54132874e+04  7.61559462e+04]
E1 = -727.7705406985547  E_coul = 201.0374189041769
cycle= 1 E= -526.733121794378  delta_E= -0.388  |g|= 0.189  |ddm|= 0.288
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547305
diis-c [-0.2995427  1.       ]
  HOMO = -0.592469760703926  LUMO = 0.347865524661227
  mo_energy =
[-1.18643146e+02 -1.23456823e+01 -9.60035210e+00 -9.60035210e+00
 -9.60035210e+00 -1.28109249e+00 -5.92469761e-01 -5.92469761e-01
 -5.92469761e-01  3.47865525e-01  1.00179610e+00  1.00179610e+00
  1.00179610e+00  2.09841573e+00  7.24929813e+00  7.24929813e+00
  7.24929813e+00  1.25343733e+01  3.33549426e+01  3.33549426e+01
  3.33549426e+01  1.02510560e+02  1.28899050e+02  1.28899050e+02
  1.28899050e+02  4.83222804e+02  4.83222804e+02  4.83222804e+02
  5.82526013e+02  1.33506094e+03  1.33506094e+03  1.33506094e+03
  2.65102603e+03  3.02930767e+03  3.02930767e+03  3.02930767e+03
  6.64975101e+03  6.64975101e+03  6.64975101e+03  9.05679357e+03
  2.54125646e+04  7.61551331e+04]
E1 = -728.3662992507784  E_coul = 201.6324038355165
cycle= 2 E= -526.733895415262  delta_E= -0.000774  |g|= 0.039  |ddm|= 0.0541
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0780937
diis-c [-0.00341076  0.08698413  0.91301587]
  HOMO = -0.583072786440116  LUMO = 0.350491411738986
  mo_energy =
[-1.18573354e+02 -1.23063281e+01 -9.55931740e+00 -9.55931740e+00
 -9.55931740e+00 -1.26981833e+00 -5.83072786e-01 -5.83072786e-01
 -5.83072786e-01  3.50491412e-01  1.00871833e+00  1.00871833e+00
  1.00871833e+00  2.10858727e+00  7.27383397e+00  7.27383397e+00
  7.27383397e+00  1.25636099e+01  3.33963185e+01  3.33963185e+01
  3.33963185e+01  1.02567630e+02  1.28956721e+02  1.28956721e+02
  1.28956721e+02  4.83291755e+02  4.83291755e+02  4.83291755e+02
  5.82597350e+02  1.33513403e+03  1.33513403e+03  1.33513403e+03
  2.65110247e+03  3.02938302e+03  3.02938302e+03  3.02938302e+03
  6.64982812e+03  6.64982812e+03  6.64982812e+03  9.05687150e+03
  2.54126431e+04  7.61552119e+04]
E1 = -728.2091805551198  E_coul = 201.47522069315738
cycle= 3 E= -526.733959861962  delta_E= -6.44e-05  |g|= 0.00637  |ddm|= 0.0155
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0134273
diis-c [-9.03987891e-07 -1.34777912e-03  1.41754137e-01  8.59593642e-01]
  HOMO = -0.584620289205644  LUMO = 0.350100247988696
  mo_energy =
[-1.18583457e+02 -1.23122505e+01 -9.56560610e+00 -9.56560610e+00
 -9.56560610e+00 -1.27154936e+00 -5.84620289e-01 -5.84620289e-01
 -5.84620289e-01  3.50100248e-01  1.00760406e+00  1.00760406e+00
  1.00760406e+00  2.10701255e+00  7.26995801e+00  7.26995801e+00
  7.26995801e+00  1.25591467e+01  3.33900191e+01  3.33900191e+01
  3.33900191e+01  1.02559285e+02  1.28948233e+02  1.28948233e+02
  1.28948233e+02  4.83281769e+02  4.83281769e+02  4.83281769e+02
  5.82587007e+02  1.33512344e+03  1.33512344e+03  1.33512344e+03
  2.65109124e+03  3.02937205e+03  3.02937205e+03  3.02937205e+03
  6.64981674e+03  6.64981674e+03  6.64981674e+03  9.05685990e+03
  2.54126313e+04  7.61552000e+04]
E1 = -728.2325591633454  E_coul = 201.49859727310337
cycle= 4 E= -526.733961890242  delta_E= -2.03e-06  |g|= 0.000116  |ddm|= 0.0023
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000154076
diis-c [-9.55932991e-09  1.01470519e-04 -1.37516974e-02 -8.91687810e-02
  1.10281901e+00]
  HOMO = -0.584604020883504  LUMO = 0.350114093688227
  mo_energy =
[-1.18583418e+02 -1.23121831e+01 -9.56555497e+00 -9.56555497e+00
 -9.56555497e+00 -1.27150507e+00 -5.84604021e-01 -5.84604021e-01
 -5.84604021e-01  3.50114094e-01  1.00761857e+00  1.00761857e+00
  1.00761857e+00  2.10704710e+00  7.26999903e+00  7.26999903e+00
  7.26999903e+00  1.25592046e+01  3.33900681e+01  3.33900681e+01
  3.33900681e+01  1.02559337e+02  1.28948280e+02  1.28948280e+02
  1.28948280e+02  4.83281808e+02  4.83281808e+02  4.83281808e+02
  5.82587037e+02  1.33512347e+03  1.33512347e+03  1.33512347e+03
  2.65109124e+03  3.02937206e+03  3.02937206e+03  3.02937206e+03
  6.64981674e+03  6.64981674e+03  6.64981674e+03  9.05685989e+03
  2.54126313e+04  7.61552000e+04]
E1 = -728.2323054691209  E_coul = 201.49834357614023
cycle= 5 E= -526.733961892981  delta_E= -2.74e-09  |g|= 2.28e-05  |ddm|= 0.000166
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.18548e-05
diis-c [-1.67320154e-10  1.26327216e-05 -1.43411819e-03 -1.15343426e-02
 -5.93386352e-04  1.01354921e+00]
  HOMO = -0.584613637729171  LUMO = 0.350112677829187
  mo_energy =
[-1.18583455e+02 -1.23122111e+01 -9.56558503e+00 -9.56558503e+00
 -9.56558503e+00 -1.27151292e+00 -5.84613638e-01 -5.84613638e-01
 -5.84613638e-01  3.50112678e-01  1.00761210e+00  1.00761210e+00
  1.00761210e+00  2.10703934e+00  7.26997826e+00  7.26997826e+00
  7.26997826e+00  1.25591825e+01  3.33900389e+01  3.33900389e+01
  3.33900389e+01  1.02559304e+02  1.28948246e+02  1.28948246e+02
  1.28948246e+02  4.83281772e+02  4.83281772e+02  4.83281772e+02
  5.82587001e+02  1.33512343e+03  1.33512343e+03  1.33512343e+03
  2.65109121e+03  3.02937203e+03  3.02937203e+03  3.02937203e+03
  6.64981670e+03  6.64981670e+03  6.64981670e+03  9.05685985e+03
  2.54126312e+04  7.61551999e+04]
E1 = -728.2324027420939  E_coul = 201.4984408490349
cycle= 6 E= -526.733961893059  delta_E= -7.83e-11  |g|= 2.15e-06  |ddm|= 2.42e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2324027420939  E_coul = 201.4984408490349
  HOMO = -0.584613097920158  LUMO = 0.350112958993784
  mo_energy =
[-1.18583452e+02 -1.23122090e+01 -9.56558284e+00 -9.56558284e+00
 -9.56558284e+00 -1.27151193e+00 -5.84613098e-01 -5.84613098e-01
 -5.84613098e-01  3.50112959e-01  1.00761253e+00  1.00761253e+00
  1.00761253e+00  2.10704013e+00  7.26997970e+00  7.26997970e+00
  7.26997970e+00  1.25591842e+01  3.33900411e+01  3.33900411e+01
  3.33900411e+01  1.02559307e+02  1.28948249e+02  1.28948249e+02
  1.28948249e+02  4.83281775e+02  4.83281775e+02  4.83281775e+02
  5.82587004e+02  1.33512344e+03  1.33512344e+03  1.33512344e+03
  2.65109121e+03  3.02937203e+03  3.02937203e+03  3.02937203e+03
  6.64981670e+03  6.64981670e+03  6.64981670e+03  9.05685986e+03
  2.54126312e+04  7.61551999e+04]
E1 = -728.2323935921748  E_coul = 201.49843169911506
Extra cycle  E= -526.73396189306  delta_E= -7.96e-13  |g|= 5.73e-07  |ddm|= 2.88e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 105703.98001449365
E1 = -728.2323935921748  E_coul = 201.49843169911506
init E= -526.73396189306
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.584613297557695  LUMO = 0.350112933268857
  mo_energy =
[-1.18583453e+02 -1.23122096e+01 -9.56558354e+00 -9.56558354e+00
 -9.56558354e+00 -1.27151208e+00 -5.84613298e-01 -5.84613298e-01
 -5.84613298e-01  3.50112933e-01  1.00761240e+00  1.00761240e+00
  1.00761240e+00  2.10703997e+00  7.26997925e+00  7.26997925e+00
  7.26997925e+00  1.25591837e+01  3.33900404e+01  3.33900404e+01
  3.33900404e+01  1.02559306e+02  1.28948248e+02  1.28948248e+02
  1.28948248e+02  4.83281774e+02  4.83281774e+02  4.83281774e+02
  5.82587003e+02  1.33512344e+03  1.33512344e+03  1.33512344e+03
  2.65109121e+03  3.02937203e+03  3.02937203e+03  3.02937203e+03
  6.64981670e+03  6.64981670e+03  6.64981670e+03  9.05685986e+03
  2.54126312e+04  7.61551999e+04]
E1 = -728.232395951442  E_coul = 201.49843405838118
cycle= 1 E= -526.733961893061  delta_E= -9.09e-13  |g|= 1.64e-07  |ddm|= 5.98e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.232395951442  E_coul = 201.49843405838118
  HOMO = -0.584613257474958  LUMO = 0.350112950167139
  mo_energy =
[-1.18583453e+02 -1.23122095e+01 -9.56558337e+00 -9.56558337e+00
 -9.56558337e+00 -1.27151202e+00 -5.84613257e-01 -5.84613257e-01
 -5.84613257e-01  3.50112950e-01  1.00761243e+00  1.00761243e+00
  1.00761243e+00  2.10704002e+00  7.26997936e+00  7.26997936e+00
  7.26997936e+00  1.25591838e+01  3.33900406e+01  3.33900406e+01
  3.33900406e+01  1.02559306e+02  1.28948248e+02  1.28948248e+02
  1.28948248e+02  4.83281774e+02  4.83281774e+02  4.83281774e+02
  5.82587003e+02  1.33512344e+03  1.33512344e+03  1.33512344e+03
  2.65109121e+03  3.02937203e+03  3.02937203e+03  3.02937203e+03
  6.64981670e+03  6.64981670e+03  6.64981670e+03  9.05685986e+03
  2.54126312e+04  7.61551999e+04]
E1 = -728.2323952275249  E_coul = 201.498433334465
Extra cycle  E= -526.73396189306  delta_E= 9.09e-13  |g|= 4.42e-08  |ddm|= 1.42e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826559e+04 7.61752190e+03 3.61735088e+03 1.59782528e+03
 3.82851358e+02 1.08123057e+02 3.48198983e+01 7.49655087e+00
 2.82913879e+00 8.23705821e-01 3.08730992e-01 1.44950676e-01
 1.36278321e+03 6.64745651e+02 3.00961848e+02 3.14042151e+02
 6.16224648e+01 7.33110716e+00 2.02382853e+01 7.76713968e-01
 2.80893598e+00 2.21096386e-01]
grad_E = [-1.51867423e-06  3.32208640e-06 -1.57414598e-06  6.98909706e-05
 -5.29594804e-05 -8.99470942e-05 -3.56011056e-03  2.27397712e-03
 -1.23885845e-02  5.60327686e-03 -1.80738122e-02  7.33965736e-03
 -5.05032124e-07  5.03401470e-06  2.37756520e-05  2.04987046e-05
 -3.37213236e-05 -2.74002708e-04  1.10999398e-04  1.41715766e-02
 -2.69041565e-04 -4.83188579e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:45 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558695        1
[INPUT] 0    0    [1    /1   ]  7617.52188448        1
[INPUT] 0    0    [1    /1   ]  3617.35088231        1
[INPUT] 0    0    [1    /1   ]  1597.82503972        1
[INPUT] 0    0    [1    /1   ]  382.85150867         1
[INPUT] 0    0    [1    /1   ]  108.123747453        1
[INPUT] 0    0    [1    /1   ]  34.8301284014        1
[INPUT] 0    0    [1    /1   ]  7.46864398285        1
[INPUT] 0    0    [1    /1   ]  2.91699314147        1
[INPUT] 0    0    [1    /1   ]  0.822958930499       1
[INPUT] 0    0    [1    /1   ]  0.336174841133       1
[INPUT] 0    0    [1    /1   ]  0.15847833005        1
[INPUT] 1    0    [1    /1   ]  1362.78321101        1
[INPUT] 1    0    [1    /1   ]  664.745633585        1
[INPUT] 1    0    [1    /1   ]  300.961767619        1
[INPUT] 1    0    [1    /1   ]  314.042080909        1
[INPUT] 1    0    [1    /1   ]  61.6225811621        1
[INPUT] 1    0    [1    /1   ]  7.33156017461        1
[INPUT] 1    0    [1    /1   ]  20.2379189941        1
[INPUT] 1    0    [1    /1   ]  0.775696374042       1
[INPUT] 1    0    [1    /1   ]  2.80956006923        1
[INPUT] 1    0    [1    /1   ]  0.221468711696       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65586952468, 1.0]], [0, [7617.5218844825, 1.0]], [0, [3617.350882307035, 1.0]], [0, [1597.8250397226527, 1.0]], [0, [382.85150867009696, 1.0]], [0, [108.12374745345397, 1.0]], [0, [34.83012840140355, 1.0]], [0, [7.46864398284682, 1.0]], [0, [2.916993141472939, 1.0]], [0, [0.8229589304987561, 1.0]], [0, [0.3361748411331081, 1.0]], [0, [0.1584783300500278, 1.0]], [1, [1362.7832110105103, 1.0]], [1, [664.7456335851242, 1.0]], [1, [300.9617676187628, 1.0]], [1, [314.0420809090843, 1.0]], [1, [61.62258116214883, 1.0]], [1, [7.331560174614912, 1.0]], [1, [20.237918994141655, 1.0]], [1, [0.7756963740416862, 1.0]], [1, [2.8095600692303724, 1.0]], [1, [0.22146871169613586, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65586952]
bas 1, expnt(s) = [7617.52188448]
bas 2, expnt(s) = [3617.35088231]
bas 3, expnt(s) = [1597.82503972]
bas 4, expnt(s) = [382.85150867]
bas 5, expnt(s) = [108.12374745]
bas 6, expnt(s) = [34.8301284]
bas 7, expnt(s) = [7.46864398]
bas 8, expnt(s) = [2.91699314]
bas 9, expnt(s) = [0.82295893]
bas 10, expnt(s) = [0.33617484]
bas 11, expnt(s) = [0.15847833]
bas 12, expnt(s) = [1362.78321101]
bas 13, expnt(s) = [664.74563359]
bas 14, expnt(s) = [300.96176762]
bas 15, expnt(s) = [314.04208091]
bas 16, expnt(s) = [61.62258116]
bas 17, expnt(s) = [7.33156017]
bas 18, expnt(s) = [20.23791899]
bas 19, expnt(s) = [0.77569637]
bas 20, expnt(s) = [2.80956007]
bas 21, expnt(s) = [0.22146871]
CPU time:        36.58
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752188e+03 2.06003836e+03
 3.61735088e+03 1.17844143e+03 1.59782504e+03 6.38501529e+02
 3.82851509e+02 2.18669291e+02 1.08123747e+02 8.47141273e+01
 3.48301284e+01 3.62227427e+01 7.46864398e+00 1.14142227e+01
 2.91699314e+00 5.63918809e+00 8.22958930e-01 2.18297442e+00
 3.36174841e-01 1.11542129e+00 1.58478330e-01 6.34588853e-01
 1.36278321e+03 2.41556017e+04 6.64745634e+02 9.84699595e+03
 3.00961768e+02 3.65698816e+03 3.14042081e+02 3.85672968e+03
 6.16225812e+01 5.03685269e+02 7.33156017e+00 3.51949131e+01
 2.02379190e+01 1.25225193e+02 7.75696374e-01 2.12372898e+00
 2.80956007e+00 1.06116348e+01 2.21468712e-01 4.43225631e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99391902283795
cond(S) = 106184.36976071773
E1 = -729.5162366426059  E_coul = 203.17243272032576
init E= -526.34380392228
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.555950547450049  LUMO = 0.399733845100756
  mo_energy =
[-1.18327446e+02 -1.22047406e+01 -9.44735706e+00 -9.44735706e+00
 -9.44735706e+00 -1.24022797e+00 -5.55950547e-01 -5.55950547e-01
 -5.55950547e-01  3.99733845e-01  1.02794139e+00  1.02794139e+00
  1.02794139e+00  2.30172544e+00  7.34221911e+00  7.34221911e+00
  7.34221911e+00  1.30407451e+01  3.35142003e+01  3.35142003e+01
  3.35142003e+01  1.03193194e+02  1.29134720e+02  1.29134720e+02
  1.29134720e+02  4.83537682e+02  4.83537682e+02  4.83537682e+02
  5.83271181e+02  1.33543333e+03  1.33543333e+03  1.33543333e+03
  2.65187131e+03  3.02974632e+03  3.02974632e+03  3.02974632e+03
  6.65030325e+03  6.65030325e+03  6.65030325e+03  9.05773004e+03
  2.54135782e+04  7.61562168e+04]
E1 = -727.7856558938528  E_coul = 201.05144487101072
cycle= 1 E= -526.734211022842  delta_E= -0.39  |g|= 0.189  |ddm|= 0.289
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547249
diis-c [-0.29948192  1.        ]
  HOMO = -0.591961544409718  LUMO = 0.390694822317977
  mo_energy =
[-1.18642707e+02 -1.23448898e+01 -9.59923564e+00 -9.59923564e+00
 -9.59923564e+00 -1.28072113e+00 -5.91961544e-01 -5.91961544e-01
 -5.91961544e-01  3.90694822e-01  1.00282467e+00  1.00282467e+00
  1.00282467e+00  2.26399816e+00  7.24910292e+00  7.24910292e+00
  7.24910292e+00  1.29346401e+01  3.33562785e+01  3.33562785e+01
  3.33562785e+01  1.02970401e+02  1.28900719e+02  1.28900719e+02
  1.28900719e+02  4.83223842e+02  4.83223842e+02  4.83223842e+02
  5.82918565e+02  1.33506163e+03  1.33506163e+03  1.33506163e+03
  2.65136422e+03  3.02930796e+03  3.02930796e+03  3.02930796e+03
  6.64975091e+03  6.64975091e+03  6.64975091e+03  9.05710198e+03
  2.54128557e+04  7.61554040e+04]
E1 = -728.376397410089  E_coul = 201.64142378636126
cycle= 2 E= -526.734973623728  delta_E= -0.000763  |g|= 0.0388  |ddm|= 0.0539
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0775958
diis-c [-0.00337427  0.08637846  0.91362154]
  HOMO = -0.582658359527078  LUMO = 0.39360484302497
  mo_energy =
[-1.18573350e+02 -1.23058586e+01 -9.55851883e+00 -9.55851883e+00
 -9.55851883e+00 -1.26956349e+00 -5.82658360e-01 -5.82658360e-01
 -5.82658360e-01  3.93604843e-01  1.00967425e+00  1.00967425e+00
  1.00967425e+00  2.27441542e+00  7.27342586e+00  7.27342586e+00
  7.27342586e+00  1.29637810e+01  3.33973404e+01  3.33973404e+01
  3.33973404e+01  1.03027074e+02  1.28958003e+02  1.28958003e+02
  1.28958003e+02  4.83292366e+02  4.83292366e+02  4.83292366e+02
  5.82989461e+02  1.33513427e+03  1.33513427e+03  1.33513427e+03
  2.65144021e+03  3.02938286e+03  3.02938286e+03  3.02938286e+03
  6.64982757e+03  6.64982757e+03  6.64982757e+03  9.05717946e+03
  2.54129338e+04  7.61554824e+04]
E1 = -728.2207327801075  E_coul = 201.48569587457098
cycle= 3 E= -526.735036905537  delta_E= -6.33e-05  |g|= 0.00634  |ddm|= 0.0151
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.013338
diis-c [-8.54053614e-07 -1.33576155e-03  1.41747247e-01  8.59588514e-01]
  HOMO = -0.584195896481939  LUMO = 0.393168384009859
  mo_energy =
[-1.18583404e+02 -1.23117510e+01 -9.56477267e+00 -9.56477267e+00
 -9.56477267e+00 -1.27128490e+00 -5.84195896e-01 -5.84195896e-01
 -5.84195896e-01  3.93168384e-01  1.00856755e+00  1.00856755e+00
  1.00856755e+00  2.27279219e+00  7.26957367e+00  7.26957367e+00
  7.26957367e+00  1.29593175e+01  3.33910754e+01  3.33910754e+01
  3.33910754e+01  1.03018773e+02  1.28949557e+02  1.28949557e+02
  1.28949557e+02  4.83282428e+02  4.83282428e+02  4.83282428e+02
  5.82979168e+02  1.33512373e+03  1.33512373e+03  1.33512373e+03
  2.65142903e+03  3.02937194e+03  3.02937194e+03  3.02937194e+03
  6.64981625e+03  6.64981625e+03  6.64981625e+03  9.05716792e+03
  2.54129220e+04  7.61554705e+04]
E1 = -728.2439409738058  E_coul = 201.50890207010355
cycle= 4 E= -526.735038903702  delta_E= -2e-06  |g|= 0.000113  |ddm|= 0.00229
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000144967
diis-c [-8.96875763e-09  9.57121951e-05 -1.31069341e-02 -8.47380663e-02
  1.09774929e+00]
  HOMO = -0.584178954110275  LUMO = 0.393183628258729
  mo_energy =
[-1.18583361e+02 -1.23116815e+01 -9.56471857e+00 -9.56471857e+00
 -9.56471857e+00 -1.27124051e+00 -5.84178954e-01 -5.84178954e-01
 -5.84178954e-01  3.93183628e-01  1.00858246e+00  1.00858246e+00
  1.00858246e+00  2.27282722e+00  7.26961655e+00  7.26961655e+00
  7.26961655e+00  1.29593768e+01  3.33911272e+01  3.33911272e+01
  3.33911272e+01  1.03018829e+02  1.28949608e+02  1.28949608e+02
  1.28949608e+02  4.83282471e+02  4.83282471e+02  4.83282471e+02
  5.82979203e+02  1.33512377e+03  1.33512377e+03  1.33512377e+03
  2.65142904e+03  3.02937196e+03  3.02937196e+03  3.02937196e+03
  6.64981625e+03  6.64981625e+03  6.64981625e+03  9.05716791e+03
  2.54129220e+04  7.61554705e+04]
E1 = -728.2436777540588  E_coul = 201.5086388477264
cycle= 5 E= -526.735038906332  delta_E= -2.63e-09  |g|= 2.28e-05  |ddm|= 0.000164
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.19205e-05
diis-c [-1.61072219e-10  1.30589007e-05 -1.49405617e-03 -1.19363724e-02
  1.24485698e-03  1.01217251e+00]
  HOMO = -0.584188477735345  LUMO = 0.393182055685191
  mo_energy =
[-1.18583397e+02 -1.23117092e+01 -9.56474833e+00 -9.56474833e+00
 -9.56474833e+00 -1.27124823e+00 -5.84188478e-01 -5.84188478e-01
 -5.84188478e-01  3.93182056e-01  1.00857607e+00  1.00857607e+00
  1.00857607e+00  2.27281921e+00  7.26959599e+00  7.26959599e+00
  7.26959599e+00  1.29593549e+01  3.33910983e+01  3.33910983e+01
  3.33910983e+01  1.03018796e+02  1.28949574e+02  1.28949574e+02
  1.28949574e+02  4.83282435e+02  4.83282435e+02  4.83282435e+02
  5.82979166e+02  1.33512373e+03  1.33512373e+03  1.33512373e+03
  2.65142900e+03  3.02937192e+03  3.02937192e+03  3.02937192e+03
  6.64981621e+03  6.64981621e+03  6.64981621e+03  9.05716787e+03
  2.54129220e+04  7.61554705e+04]
E1 = -728.2437736695089  E_coul = 201.50873476309758
cycle= 6 E= -526.735038906411  delta_E= -7.89e-11  |g|= 2.09e-06  |ddm|= 2.46e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2437736695089  E_coul = 201.50873476309758
  HOMO = -0.584187998775158  LUMO = 0.393182352664711
  mo_energy =
[-1.18583394e+02 -1.23117073e+01 -9.56474635e+00 -9.56474635e+00
 -9.56474635e+00 -1.27124730e+00 -5.84187999e-01 -5.84187999e-01
 -5.84187999e-01  3.93182353e-01  1.00857645e+00  1.00857645e+00
  1.00857645e+00  2.27281996e+00  7.26959729e+00  7.26959729e+00
  7.26959729e+00  1.29593564e+01  3.33911003e+01  3.33911003e+01
  3.33911003e+01  1.03018799e+02  1.28949577e+02  1.28949577e+02
  1.28949577e+02  4.83282438e+02  4.83282438e+02  4.83282438e+02
  5.82979169e+02  1.33512373e+03  1.33512373e+03  1.33512373e+03
  2.65142901e+03  3.02937193e+03  3.02937193e+03  3.02937193e+03
  6.64981622e+03  6.64981622e+03  6.64981622e+03  9.05716788e+03
  2.54129220e+04  7.61554705e+04]
E1 = -728.2437652962972  E_coul = 201.50872638988423
Extra cycle  E= -526.735038906413  delta_E= -1.59e-12  |g|= 5.42e-07  |ddm|= 2.84e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826559e+04 7.61752188e+03 3.61735088e+03 1.59782504e+03
 3.82851509e+02 1.08123747e+02 3.48301284e+01 7.46864398e+00
 2.91699314e+00 8.22958930e-01 3.36174841e-01 1.58478330e-01
 1.36278321e+03 6.64745634e+02 3.00961768e+02 3.14042081e+02
 6.16225812e+01 7.33156017e+00 2.02379190e+01 7.75696374e-01
 2.80956007e+00 2.21468712e-01]
E = -526.7350389064129
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:46 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558695        1
[INPUT] 0    0    [1    /1   ]  7617.52188448        1
[INPUT] 0    0    [1    /1   ]  3617.35088231        1
[INPUT] 0    0    [1    /1   ]  1597.82503972        1
[INPUT] 0    0    [1    /1   ]  382.85150867         1
[INPUT] 0    0    [1    /1   ]  108.123747453        1
[INPUT] 0    0    [1    /1   ]  34.8301284014        1
[INPUT] 0    0    [1    /1   ]  7.46864398285        1
[INPUT] 0    0    [1    /1   ]  2.91699314147        1
[INPUT] 0    0    [1    /1   ]  0.822958930499       1
[INPUT] 0    0    [1    /1   ]  0.336174841133       1
[INPUT] 0    0    [1    /1   ]  0.15847833005        1
[INPUT] 1    0    [1    /1   ]  1362.78321101        1
[INPUT] 1    0    [1    /1   ]  664.745633585        1
[INPUT] 1    0    [1    /1   ]  300.961767619        1
[INPUT] 1    0    [1    /1   ]  314.042080909        1
[INPUT] 1    0    [1    /1   ]  61.6225811621        1
[INPUT] 1    0    [1    /1   ]  7.33156017461        1
[INPUT] 1    0    [1    /1   ]  20.2379189941        1
[INPUT] 1    0    [1    /1   ]  0.775696374042       1
[INPUT] 1    0    [1    /1   ]  2.80956006923        1
[INPUT] 1    0    [1    /1   ]  0.221468711696       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65586952468, 1.0]], [0, [7617.5218844825, 1.0]], [0, [3617.350882307035, 1.0]], [0, [1597.8250397226527, 1.0]], [0, [382.85150867009696, 1.0]], [0, [108.12374745345397, 1.0]], [0, [34.83012840140355, 1.0]], [0, [7.46864398284682, 1.0]], [0, [2.916993141472939, 1.0]], [0, [0.8229589304987561, 1.0]], [0, [0.3361748411331081, 1.0]], [0, [0.1584783300500278, 1.0]], [1, [1362.7832110105103, 1.0]], [1, [664.7456335851242, 1.0]], [1, [300.9617676187628, 1.0]], [1, [314.0420809090843, 1.0]], [1, [61.62258116214883, 1.0]], [1, [7.331560174614912, 1.0]], [1, [20.237918994141655, 1.0]], [1, [0.7756963740416862, 1.0]], [1, [2.8095600692303724, 1.0]], [1, [0.22146871169613586, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65586952]
bas 1, expnt(s) = [7617.52188448]
bas 2, expnt(s) = [3617.35088231]
bas 3, expnt(s) = [1597.82503972]
bas 4, expnt(s) = [382.85150867]
bas 5, expnt(s) = [108.12374745]
bas 6, expnt(s) = [34.8301284]
bas 7, expnt(s) = [7.46864398]
bas 8, expnt(s) = [2.91699314]
bas 9, expnt(s) = [0.82295893]
bas 10, expnt(s) = [0.33617484]
bas 11, expnt(s) = [0.15847833]
bas 12, expnt(s) = [1362.78321101]
bas 13, expnt(s) = [664.74563359]
bas 14, expnt(s) = [300.96176762]
bas 15, expnt(s) = [314.04208091]
bas 16, expnt(s) = [61.62258116]
bas 17, expnt(s) = [7.33156017]
bas 18, expnt(s) = [20.23791899]
bas 19, expnt(s) = [0.77569637]
bas 20, expnt(s) = [2.80956007]
bas 21, expnt(s) = [0.22146871]
CPU time:        36.92
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752188e+03 2.06003836e+03
 3.61735088e+03 1.17844143e+03 1.59782504e+03 6.38501529e+02
 3.82851509e+02 2.18669291e+02 1.08123747e+02 8.47141273e+01
 3.48301284e+01 3.62227427e+01 7.46864398e+00 1.14142227e+01
 2.91699314e+00 5.63918809e+00 8.22958930e-01 2.18297442e+00
 3.36174841e-01 1.11542129e+00 1.58478330e-01 6.34588853e-01
 1.36278321e+03 2.41556017e+04 6.64745634e+02 9.84699595e+03
 3.00961768e+02 3.65698816e+03 3.14042081e+02 3.85672968e+03
 6.16225812e+01 5.03685269e+02 7.33156017e+00 3.51949131e+01
 2.02379190e+01 1.25225193e+02 7.75696374e-01 2.12372898e+00
 2.80956007e+00 1.06116348e+01 2.21468712e-01 4.43225631e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99391902283795
cond(S) = 106184.36976071773
E1 = -729.5162366426059  E_coul = 203.17243272032576
init E= -526.34380392228
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555950547450049  LUMO = 0.399733845100756
  mo_energy =
[-1.18327446e+02 -1.22047406e+01 -9.44735706e+00 -9.44735706e+00
 -9.44735706e+00 -1.24022797e+00 -5.55950547e-01 -5.55950547e-01
 -5.55950547e-01  3.99733845e-01  1.02794139e+00  1.02794139e+00
  1.02794139e+00  2.30172544e+00  7.34221911e+00  7.34221911e+00
  7.34221911e+00  1.30407451e+01  3.35142003e+01  3.35142003e+01
  3.35142003e+01  1.03193194e+02  1.29134720e+02  1.29134720e+02
  1.29134720e+02  4.83537682e+02  4.83537682e+02  4.83537682e+02
  5.83271181e+02  1.33543333e+03  1.33543333e+03  1.33543333e+03
  2.65187131e+03  3.02974632e+03  3.02974632e+03  3.02974632e+03
  6.65030325e+03  6.65030325e+03  6.65030325e+03  9.05773004e+03
  2.54135782e+04  7.61562168e+04]
E1 = -727.7856558938528  E_coul = 201.05144487101072
cycle= 1 E= -526.734211022842  delta_E= -0.39  |g|= 0.189  |ddm|= 0.289
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547249
diis-c [-0.29948192  1.        ]
  HOMO = -0.591961544409718  LUMO = 0.390694822317977
  mo_energy =
[-1.18642707e+02 -1.23448898e+01 -9.59923564e+00 -9.59923564e+00
 -9.59923564e+00 -1.28072113e+00 -5.91961544e-01 -5.91961544e-01
 -5.91961544e-01  3.90694822e-01  1.00282467e+00  1.00282467e+00
  1.00282467e+00  2.26399816e+00  7.24910292e+00  7.24910292e+00
  7.24910292e+00  1.29346401e+01  3.33562785e+01  3.33562785e+01
  3.33562785e+01  1.02970401e+02  1.28900719e+02  1.28900719e+02
  1.28900719e+02  4.83223842e+02  4.83223842e+02  4.83223842e+02
  5.82918565e+02  1.33506163e+03  1.33506163e+03  1.33506163e+03
  2.65136422e+03  3.02930796e+03  3.02930796e+03  3.02930796e+03
  6.64975091e+03  6.64975091e+03  6.64975091e+03  9.05710198e+03
  2.54128557e+04  7.61554040e+04]
E1 = -728.376397410089  E_coul = 201.64142378636126
cycle= 2 E= -526.734973623728  delta_E= -0.000763  |g|= 0.0388  |ddm|= 0.0539
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0775958
diis-c [-0.00337427  0.08637846  0.91362154]
  HOMO = -0.582658359527078  LUMO = 0.39360484302497
  mo_energy =
[-1.18573350e+02 -1.23058586e+01 -9.55851883e+00 -9.55851883e+00
 -9.55851883e+00 -1.26956349e+00 -5.82658360e-01 -5.82658360e-01
 -5.82658360e-01  3.93604843e-01  1.00967425e+00  1.00967425e+00
  1.00967425e+00  2.27441542e+00  7.27342586e+00  7.27342586e+00
  7.27342586e+00  1.29637810e+01  3.33973404e+01  3.33973404e+01
  3.33973404e+01  1.03027074e+02  1.28958003e+02  1.28958003e+02
  1.28958003e+02  4.83292366e+02  4.83292366e+02  4.83292366e+02
  5.82989461e+02  1.33513427e+03  1.33513427e+03  1.33513427e+03
  2.65144021e+03  3.02938286e+03  3.02938286e+03  3.02938286e+03
  6.64982757e+03  6.64982757e+03  6.64982757e+03  9.05717946e+03
  2.54129338e+04  7.61554824e+04]
E1 = -728.2207327801075  E_coul = 201.48569587457098
cycle= 3 E= -526.735036905537  delta_E= -6.33e-05  |g|= 0.00634  |ddm|= 0.0151
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.013338
diis-c [-8.54053614e-07 -1.33576155e-03  1.41747247e-01  8.59588514e-01]
  HOMO = -0.584195896481939  LUMO = 0.393168384009859
  mo_energy =
[-1.18583404e+02 -1.23117510e+01 -9.56477267e+00 -9.56477267e+00
 -9.56477267e+00 -1.27128490e+00 -5.84195896e-01 -5.84195896e-01
 -5.84195896e-01  3.93168384e-01  1.00856755e+00  1.00856755e+00
  1.00856755e+00  2.27279219e+00  7.26957367e+00  7.26957367e+00
  7.26957367e+00  1.29593175e+01  3.33910754e+01  3.33910754e+01
  3.33910754e+01  1.03018773e+02  1.28949557e+02  1.28949557e+02
  1.28949557e+02  4.83282428e+02  4.83282428e+02  4.83282428e+02
  5.82979168e+02  1.33512373e+03  1.33512373e+03  1.33512373e+03
  2.65142903e+03  3.02937194e+03  3.02937194e+03  3.02937194e+03
  6.64981625e+03  6.64981625e+03  6.64981625e+03  9.05716792e+03
  2.54129220e+04  7.61554705e+04]
E1 = -728.2439409738058  E_coul = 201.50890207010355
cycle= 4 E= -526.735038903702  delta_E= -2e-06  |g|= 0.000113  |ddm|= 0.00229
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000144967
diis-c [-8.96875763e-09  9.57121951e-05 -1.31069341e-02 -8.47380663e-02
  1.09774929e+00]
  HOMO = -0.584178954110275  LUMO = 0.393183628258729
  mo_energy =
[-1.18583361e+02 -1.23116815e+01 -9.56471857e+00 -9.56471857e+00
 -9.56471857e+00 -1.27124051e+00 -5.84178954e-01 -5.84178954e-01
 -5.84178954e-01  3.93183628e-01  1.00858246e+00  1.00858246e+00
  1.00858246e+00  2.27282722e+00  7.26961655e+00  7.26961655e+00
  7.26961655e+00  1.29593768e+01  3.33911272e+01  3.33911272e+01
  3.33911272e+01  1.03018829e+02  1.28949608e+02  1.28949608e+02
  1.28949608e+02  4.83282471e+02  4.83282471e+02  4.83282471e+02
  5.82979203e+02  1.33512377e+03  1.33512377e+03  1.33512377e+03
  2.65142904e+03  3.02937196e+03  3.02937196e+03  3.02937196e+03
  6.64981625e+03  6.64981625e+03  6.64981625e+03  9.05716791e+03
  2.54129220e+04  7.61554705e+04]
E1 = -728.2436777540588  E_coul = 201.5086388477264
cycle= 5 E= -526.735038906332  delta_E= -2.63e-09  |g|= 2.28e-05  |ddm|= 0.000164
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.19205e-05
diis-c [-1.61072219e-10  1.30589007e-05 -1.49405617e-03 -1.19363724e-02
  1.24485698e-03  1.01217251e+00]
  HOMO = -0.584188477735345  LUMO = 0.393182055685191
  mo_energy =
[-1.18583397e+02 -1.23117092e+01 -9.56474833e+00 -9.56474833e+00
 -9.56474833e+00 -1.27124823e+00 -5.84188478e-01 -5.84188478e-01
 -5.84188478e-01  3.93182056e-01  1.00857607e+00  1.00857607e+00
  1.00857607e+00  2.27281921e+00  7.26959599e+00  7.26959599e+00
  7.26959599e+00  1.29593549e+01  3.33910983e+01  3.33910983e+01
  3.33910983e+01  1.03018796e+02  1.28949574e+02  1.28949574e+02
  1.28949574e+02  4.83282435e+02  4.83282435e+02  4.83282435e+02
  5.82979166e+02  1.33512373e+03  1.33512373e+03  1.33512373e+03
  2.65142900e+03  3.02937192e+03  3.02937192e+03  3.02937192e+03
  6.64981621e+03  6.64981621e+03  6.64981621e+03  9.05716787e+03
  2.54129220e+04  7.61554705e+04]
E1 = -728.2437736695089  E_coul = 201.50873476309758
cycle= 6 E= -526.735038906411  delta_E= -7.89e-11  |g|= 2.09e-06  |ddm|= 2.46e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2437736695089  E_coul = 201.50873476309758
  HOMO = -0.584187998775158  LUMO = 0.393182352664711
  mo_energy =
[-1.18583394e+02 -1.23117073e+01 -9.56474635e+00 -9.56474635e+00
 -9.56474635e+00 -1.27124730e+00 -5.84187999e-01 -5.84187999e-01
 -5.84187999e-01  3.93182353e-01  1.00857645e+00  1.00857645e+00
  1.00857645e+00  2.27281996e+00  7.26959729e+00  7.26959729e+00
  7.26959729e+00  1.29593564e+01  3.33911003e+01  3.33911003e+01
  3.33911003e+01  1.03018799e+02  1.28949577e+02  1.28949577e+02
  1.28949577e+02  4.83282438e+02  4.83282438e+02  4.83282438e+02
  5.82979169e+02  1.33512373e+03  1.33512373e+03  1.33512373e+03
  2.65142901e+03  3.02937193e+03  3.02937193e+03  3.02937193e+03
  6.64981622e+03  6.64981622e+03  6.64981622e+03  9.05716788e+03
  2.54129220e+04  7.61554705e+04]
E1 = -728.2437652962972  E_coul = 201.50872638988423
Extra cycle  E= -526.735038906413  delta_E= -1.59e-12  |g|= 5.42e-07  |ddm|= 2.84e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 106184.36976071773
E1 = -728.2437652962972  E_coul = 201.50872638988423
init E= -526.735038906413
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.584188182993343  LUMO = 0.393182328664625
  mo_energy =
[-1.18583395e+02 -1.23117079e+01 -9.56474700e+00 -9.56474700e+00
 -9.56474700e+00 -1.27124744e+00 -5.84188183e-01 -5.84188183e-01
 -5.84188183e-01  3.93182329e-01  1.00857633e+00  1.00857633e+00
  1.00857633e+00  2.27281981e+00  7.26959687e+00  7.26959687e+00
  7.26959687e+00  1.29593560e+01  3.33910996e+01  3.33910996e+01
  3.33910996e+01  1.03018798e+02  1.28949576e+02  1.28949576e+02
  1.28949576e+02  4.83282437e+02  4.83282437e+02  4.83282437e+02
  5.82979168e+02  1.33512373e+03  1.33512373e+03  1.33512373e+03
  2.65142901e+03  3.02937193e+03  3.02937193e+03  3.02937193e+03
  6.64981622e+03  6.64981622e+03  6.64981622e+03  9.05716788e+03
  2.54129220e+04  7.61554705e+04]
E1 = -728.2437674320738  E_coul = 201.50872852566036
cycle= 1 E= -526.735038906413  delta_E= -5.68e-13  |g|= 1.53e-07  |ddm|= 5.96e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2437674320738  E_coul = 201.50872852566036
  HOMO = -0.584188147177748  LUMO = 0.393182346312276
  mo_energy =
[-1.18583395e+02 -1.23117077e+01 -9.56474684e+00 -9.56474684e+00
 -9.56474684e+00 -1.27124738e+00 -5.84188147e-01 -5.84188147e-01
 -5.84188147e-01  3.93182346e-01  1.00857636e+00  1.00857636e+00
  1.00857636e+00  2.27281986e+00  7.26959697e+00  7.26959697e+00
  7.26959697e+00  1.29593561e+01  3.33910998e+01  3.33910998e+01
  3.33910998e+01  1.03018798e+02  1.28949576e+02  1.28949576e+02
  1.28949576e+02  4.83282437e+02  4.83282437e+02  4.83282437e+02
  5.82979168e+02  1.33512373e+03  1.33512373e+03  1.33512373e+03
  2.65142901e+03  3.02937193e+03  3.02937193e+03  3.02937193e+03
  6.64981622e+03  6.64981622e+03  6.64981622e+03  9.05716788e+03
  2.54129220e+04  7.61554705e+04]
E1 = -728.2437667733137  E_coul = 201.50872786690113
Extra cycle  E= -526.735038906413  delta_E= 9.09e-13  |g|= 4.06e-08  |ddm|= 1.38e-07
    CPU time for scf_cycle      1.13 sec, wall time      0.65 sec
exp = [2.61826559e+04 7.61752188e+03 3.61735088e+03 1.59782504e+03
 3.82851509e+02 1.08123747e+02 3.48301284e+01 7.46864398e+00
 2.91699314e+00 8.22958930e-01 3.36174841e-01 1.58478330e-01
 1.36278321e+03 6.64745634e+02 3.00961768e+02 3.14042081e+02
 6.16225812e+01 7.33156017e+00 2.02379190e+01 7.75696374e-01
 2.80956007e+00 2.21468712e-01]
grad_E = [-1.51892174e-06  3.32617666e-06 -1.57034209e-06  7.00563565e-05
 -5.86197582e-05 -8.26215676e-06 -3.96242847e-03 -1.72719606e-03
 -4.06800419e-03  3.66583637e-03 -1.14893825e-02  8.00206871e-03
 -5.05370637e-07  5.02910485e-06  2.37457044e-05  2.04730734e-05
 -2.99355000e-05 -1.60974930e-04  8.17367052e-05  8.78900183e-03
 -2.05718735e-04 -3.10399602e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:51 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.655874         1
[INPUT] 0    0    [1    /1   ]  7617.52187471        1
[INPUT] 0    0    [1    /1   ]  3617.35088694        1
[INPUT] 0    0    [1    /1   ]  1597.82483419        1
[INPUT] 0    0    [1    /1   ]  382.851658282        1
[INPUT] 0    0    [1    /1   ]  108.124082859        1
[INPUT] 0    0    [1    /1   ]  34.840272085         1
[INPUT] 0    0    [1    /1   ]  7.45776676332        1
[INPUT] 0    0    [1    /1   ]  2.96425067048        1
[INPUT] 0    0    [1    /1   ]  0.820176390639       1
[INPUT] 0    0    [1    /1   ]  0.356232460628       1
[INPUT] 0    0    [1    /1   ]  0.15731859214        1
[INPUT] 1    0    [1    /1   ]  1362.7832125         1
[INPUT] 1    0    [1    /1   ]  664.745618774        1
[INPUT] 1    0    [1    /1   ]  300.961697672        1
[INPUT] 1    0    [1    /1   ]  314.042020602        1
[INPUT] 1    0    [1    /1   ]  61.6226735215        1
[INPUT] 1    0    [1    /1   ]  7.33181669361        1
[INPUT] 1    0    [1    /1   ]  20.2376634017        1
[INPUT] 1    0    [1    /1   ]  0.774855972784       1
[INPUT] 1    0    [1    /1   ]  2.81015115377        1
[INPUT] 1    0    [1    /1   ]  0.221835226517       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655873994325, 1.0]], [0, [7617.521874708833, 1.0]], [0, [3617.3508869428615, 1.0]], [0, [1597.8248341866554, 1.0]], [0, [382.85165828236575, 1.0]], [0, [108.1240828586388, 1.0]], [0, [34.84027208495688, 1.0]], [0, [7.457766763318459, 1.0]], [0, [2.9642506704813267, 1.0]], [0, [0.8201763906390469, 1.0]], [0, [0.3562324606277654, 1.0]], [0, [0.15731859214026483, 1.0]], [1, [1362.7832124970887, 1.0]], [1, [664.7456187735492, 1.0]], [1, [300.96169767183244, 1.0]], [1, [314.0420206019793, 1.0]], [1, [61.62267352147439, 1.0]], [1, [7.331816693614771, 1.0]], [1, [20.23766340174636, 1.0]], [1, [0.7748559727837181, 1.0]], [1, [2.810151153769137, 1.0]], [1, [0.22183522651670873, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65587399]
bas 1, expnt(s) = [7617.52187471]
bas 2, expnt(s) = [3617.35088694]
bas 3, expnt(s) = [1597.82483419]
bas 4, expnt(s) = [382.85165828]
bas 5, expnt(s) = [108.12408286]
bas 6, expnt(s) = [34.84027208]
bas 7, expnt(s) = [7.45776676]
bas 8, expnt(s) = [2.96425067]
bas 9, expnt(s) = [0.82017639]
bas 10, expnt(s) = [0.35623246]
bas 11, expnt(s) = [0.15731859]
bas 12, expnt(s) = [1362.7832125]
bas 13, expnt(s) = [664.74561877]
bas 14, expnt(s) = [300.96169767]
bas 15, expnt(s) = [314.0420206]
bas 16, expnt(s) = [61.62267352]
bas 17, expnt(s) = [7.33181669]
bas 18, expnt(s) = [20.2376634]
bas 19, expnt(s) = [0.77485597]
bas 20, expnt(s) = [2.81015115]
bas 21, expnt(s) = [0.22183523]
CPU time:        42.85
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752187e+03 2.06003836e+03
 3.61735089e+03 1.17844143e+03 1.59782483e+03 6.38501467e+02
 3.82851658e+02 2.18669355e+02 1.08124083e+02 8.47143244e+01
 3.48402721e+01 3.62306543e+01 7.45776676e+00 1.14017528e+01
 2.96425067e+00 5.70756964e+00 8.20176391e-01 2.17743637e+00
 3.56232461e-01 1.16497107e+00 1.57318592e-01 6.31102736e-01
 1.36278321e+03 2.41556018e+04 6.64745619e+02 9.84699567e+03
 3.00961698e+02 3.65698709e+03 3.14042021e+02 3.85672876e+03
 6.16226735e+01 5.03686213e+02 7.33181669e+00 3.51964523e+01
 2.02376634e+01 1.25223216e+02 7.74855973e-01 2.12085327e+00
 2.81015115e+00 1.06144255e+01 2.21835227e-01 4.44142704e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993960616615894
cond(S) = 106327.36740408785
E1 = -729.5129555161133  E_coul = 203.17031327983926
init E= -526.342642236274
    CPU time for initialize scf      0.08 sec, wall time      0.05 sec
  HOMO = -0.555913673336496  LUMO = 0.40909797194964
  mo_energy =
[-1.18327814e+02 -1.22049377e+01 -9.44758527e+00 -9.44758527e+00
 -9.44758527e+00 -1.24029726e+00 -5.55913673e-01 -5.55913673e-01
 -5.55913673e-01  4.09097972e-01  1.02873492e+00  1.02873492e+00
  1.02873492e+00  2.36534553e+00  7.34143143e+00  7.34143143e+00
  7.34143143e+00  1.32317951e+01  3.35145493e+01  3.35145493e+01
  3.35145493e+01  1.03442849e+02  1.29135208e+02  1.29135208e+02
  1.29135208e+02  4.83537837e+02  4.83537837e+02  4.83537837e+02
  5.83497740e+02  1.33543338e+03  1.33543338e+03  1.33543338e+03
  2.65206932e+03  3.02974614e+03  3.02974614e+03  3.02974614e+03
  6.65030290e+03  6.65030290e+03  6.65030290e+03  9.05791108e+03
  2.54137492e+04  7.61563759e+04]
E1 = -727.7952858590883  E_coul = 201.0607410049122
cycle= 1 E= -526.734544854176  delta_E= -0.392  |g|= 0.189  |ddm|= 0.29
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547302
diis-c [-0.29953977  1.        ]
  HOMO = -0.591584763852395  LUMO = 0.399850545365043
  mo_energy =
[-1.18642360e+02 -1.23442485e+01 -9.59856389e+00 -9.59856389e+00
 -9.59856389e+00 -1.28036827e+00 -5.91584764e-01 -5.91584764e-01
 -5.91584764e-01  3.99850545e-01  1.00384401e+00  1.00384401e+00
  1.00384401e+00  2.32724822e+00  7.24906841e+00  7.24906841e+00
  7.24906841e+00  1.31261538e+01  3.33574435e+01  3.33574435e+01
  3.33574435e+01  1.03221044e+02  1.28902019e+02  1.28902019e+02
  1.28902019e+02  4.83224761e+02  4.83224761e+02  4.83224761e+02
  5.83145775e+02  1.33506229e+03  1.33506229e+03  1.33506229e+03
  2.65156274e+03  3.02930834e+03  3.02930834e+03  3.02930834e+03
  6.64975104e+03  6.64975104e+03  6.64975104e+03  9.05728345e+03
  2.54130271e+04  7.61555635e+04]
E1 = -728.3820277144209  E_coul = 201.64672748757062
cycle= 2 E= -526.73530022685  delta_E= -0.000755  |g|= 0.0386  |ddm|= 0.0545
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0772631
diis-c [-0.00334948  0.08596778  0.91403222]
  HOMO = -0.582363901891766  LUMO = 0.402819763824832
  mo_energy =
[-1.18573330e+02 -1.23054749e+01 -9.55810588e+00 -9.55810588e+00
 -9.55810588e+00 -1.26930722e+00 -5.82363902e-01 -5.82363902e-01
 -5.82363902e-01  4.02819764e-01  1.01063101e+00  1.01063101e+00
  1.01063101e+00  2.33775756e+00  7.27321327e+00  7.27321327e+00
  7.27321327e+00  1.31551833e+01  3.33982521e+01  3.33982521e+01
  3.33982521e+01  1.03277417e+02  1.28959004e+02  1.28959004e+02
  1.28959004e+02  4.83292962e+02  4.83292962e+02  4.83292962e+02
  5.83216340e+02  1.33513460e+03  1.33513460e+03  1.33513460e+03
  2.65163838e+03  3.02938291e+03  3.02938291e+03  3.02938291e+03
  6.64982735e+03  6.64982735e+03  6.64982735e+03  9.05736058e+03
  2.54131048e+04  7.61556415e+04]
E1 = -728.2274511920881  E_coul = 201.4920885331172
cycle= 3 E= -526.735362658971  delta_E= -6.24e-05  |g|= 0.00631  |ddm|= 0.0149
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132743
diis-c [-8.47457041e-07 -1.33101854e-03  1.41681957e-01  8.59649062e-01]
  HOMO = -0.583895672193845  LUMO = 0.402372318874967
  mo_energy =
[-1.18583346e+02 -1.23113436e+01 -9.56433358e+00 -9.56433358e+00
 -9.56433358e+00 -1.27102008e+00 -5.83895672e-01 -5.83895672e-01
 -5.83895672e-01  4.02372319e-01  1.00952876e+00  1.00952876e+00
  1.00952876e+00  2.33611105e+00  7.26937819e+00  7.26937819e+00
  7.26937819e+00  1.31507244e+01  3.33920129e+01  3.33920129e+01
  3.33920129e+01  1.03269150e+02  1.28950592e+02  1.28950592e+02
  1.28950592e+02  4.83283062e+02  4.83283062e+02  4.83283062e+02
  5.83206086e+02  1.33512411e+03  1.33512411e+03  1.33512411e+03
  2.65162725e+03  3.02937203e+03  3.02937203e+03  3.02937203e+03
  6.64981607e+03  6.64981607e+03  6.64981607e+03  9.05734908e+03
  2.54130931e+04  7.61556297e+04]
E1 = -728.2505118620797  E_coul = 201.5151472273665
cycle= 4 E= -526.735364634713  delta_E= -1.98e-06  |g|= 0.000114  |ddm|= 0.0023
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000143373
diis-c [-9.09012465e-09  9.62096772e-05 -1.31798529e-02 -8.49253465e-02
  1.09800899e+00]
  HOMO = -0.583878813259501  LUMO = 0.402388039292609
  mo_energy =
[-1.18583300e+02 -1.23112727e+01 -9.56427789e+00 -9.56427789e+00
 -9.56427789e+00 -1.27097530e+00 -5.83878813e-01 -5.83878813e-01
 -5.83878813e-01  4.02388039e-01  1.00954360e+00  1.00954360e+00
  1.00954360e+00  2.33614640e+00  7.26942187e+00  7.26942187e+00
  7.26942187e+00  1.31507846e+01  3.33920663e+01  3.33920663e+01
  3.33920663e+01  1.03269208e+02  1.28950645e+02  1.28950645e+02
  1.28950645e+02  4.83283107e+02  4.83283107e+02  4.83283107e+02
  5.83206124e+02  1.33512414e+03  1.33512414e+03  1.33512414e+03
  2.65162726e+03  3.02937205e+03  3.02937205e+03  3.02937205e+03
  6.64981608e+03  6.64981608e+03  6.64981608e+03  9.05734908e+03
  2.54130931e+04  7.61556297e+04]
E1 = -728.2502386212051  E_coul = 201.51487398373806
cycle= 5 E= -526.735364637467  delta_E= -2.75e-09  |g|= 2.3e-05  |ddm|= 0.000163
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.22949e-05
diis-c [-1.65109973e-10  1.34305330e-05 -1.53524643e-03 -1.22252879e-02
  6.79710133e-04  1.01306739e+00]
  HOMO = -0.583888479801983  LUMO = 0.402386396981699
  mo_energy =
[-1.18583337e+02 -1.23113008e+01 -9.56430797e+00 -9.56430797e+00
 -9.56430797e+00 -1.27098310e+00 -5.83888480e-01 -5.83888480e-01
 -5.83888480e-01  4.02386397e-01  1.00953711e+00  1.00953711e+00
  1.00953711e+00  2.33613809e+00  7.26940107e+00  7.26940107e+00
  7.26940107e+00  1.31507623e+01  3.33920371e+01  3.33920371e+01
  3.33920371e+01  1.03269175e+02  1.28950611e+02  1.28950611e+02
  1.28950611e+02  4.83283071e+02  4.83283071e+02  4.83283071e+02
  5.83206087e+02  1.33512411e+03  1.33512411e+03  1.33512411e+03
  2.65162722e+03  3.02937201e+03  3.02937201e+03  3.02937201e+03
  6.64981604e+03  6.64981604e+03  6.64981604e+03  9.05734904e+03
  2.54130931e+04  7.61556296e+04]
E1 = -728.2503350070199  E_coul = 201.51497036947072
cycle= 6 E= -526.735364637549  delta_E= -8.22e-11  |g|= 2.09e-06  |ddm|= 2.45e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2503350070199  E_coul = 201.51497036947072
  HOMO = -0.583887999288898  LUMO = 0.40238670221641
  mo_energy =
[-1.18583334e+02 -1.23112988e+01 -9.56430598e+00 -9.56430598e+00
 -9.56430598e+00 -1.27098217e+00 -5.83887999e-01 -5.83887999e-01
 -5.83887999e-01  4.02386702e-01  1.00953750e+00  1.00953750e+00
  1.00953750e+00  2.33613885e+00  7.26940237e+00  7.26940237e+00
  7.26940237e+00  1.31507638e+01  3.33920391e+01  3.33920391e+01
  3.33920391e+01  1.03269177e+02  1.28950613e+02  1.28950613e+02
  1.28950613e+02  4.83283074e+02  4.83283074e+02  4.83283074e+02
  5.83206090e+02  1.33512411e+03  1.33512411e+03  1.33512411e+03
  2.65162723e+03  3.02937201e+03  3.02937201e+03  3.02937201e+03
  6.64981604e+03  6.64981604e+03  6.64981604e+03  9.05734904e+03
  2.54130931e+04  7.61556296e+04]
E1 = -728.250326643231  E_coul = 201.5149620056799
Extra cycle  E= -526.735364637551  delta_E= -1.93e-12  |g|= 5.41e-07  |ddm|= 2.64e-06
    CPU time for scf_cycle      0.30 sec, wall time      0.27 sec
exp = [2.61826559e+04 7.61752187e+03 3.61735089e+03 1.59782483e+03
 3.82851658e+02 1.08124083e+02 3.48402721e+01 7.45776676e+00
 2.96425067e+00 8.20176391e-01 3.56232461e-01 1.57318592e-01
 1.36278321e+03 6.64745619e+02 3.00961698e+02 3.14042021e+02
 6.16226735e+01 7.33181669e+00 2.02376634e+01 7.74855973e-01
 2.81015115e+00 2.21835227e-01]
E = -526.7353646375511
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:51 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.655874         1
[INPUT] 0    0    [1    /1   ]  7617.52187471        1
[INPUT] 0    0    [1    /1   ]  3617.35088694        1
[INPUT] 0    0    [1    /1   ]  1597.82483419        1
[INPUT] 0    0    [1    /1   ]  382.851658282        1
[INPUT] 0    0    [1    /1   ]  108.124082859        1
[INPUT] 0    0    [1    /1   ]  34.840272085         1
[INPUT] 0    0    [1    /1   ]  7.45776676332        1
[INPUT] 0    0    [1    /1   ]  2.96425067048        1
[INPUT] 0    0    [1    /1   ]  0.820176390639       1
[INPUT] 0    0    [1    /1   ]  0.356232460628       1
[INPUT] 0    0    [1    /1   ]  0.15731859214        1
[INPUT] 1    0    [1    /1   ]  1362.7832125         1
[INPUT] 1    0    [1    /1   ]  664.745618774        1
[INPUT] 1    0    [1    /1   ]  300.961697672        1
[INPUT] 1    0    [1    /1   ]  314.042020602        1
[INPUT] 1    0    [1    /1   ]  61.6226735215        1
[INPUT] 1    0    [1    /1   ]  7.33181669361        1
[INPUT] 1    0    [1    /1   ]  20.2376634017        1
[INPUT] 1    0    [1    /1   ]  0.774855972784       1
[INPUT] 1    0    [1    /1   ]  2.81015115377        1
[INPUT] 1    0    [1    /1   ]  0.221835226517       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655873994325, 1.0]], [0, [7617.521874708833, 1.0]], [0, [3617.3508869428615, 1.0]], [0, [1597.8248341866554, 1.0]], [0, [382.85165828236575, 1.0]], [0, [108.1240828586388, 1.0]], [0, [34.84027208495688, 1.0]], [0, [7.457766763318459, 1.0]], [0, [2.9642506704813267, 1.0]], [0, [0.8201763906390469, 1.0]], [0, [0.3562324606277654, 1.0]], [0, [0.15731859214026483, 1.0]], [1, [1362.7832124970887, 1.0]], [1, [664.7456187735492, 1.0]], [1, [300.96169767183244, 1.0]], [1, [314.0420206019793, 1.0]], [1, [61.62267352147439, 1.0]], [1, [7.331816693614771, 1.0]], [1, [20.23766340174636, 1.0]], [1, [0.7748559727837181, 1.0]], [1, [2.810151153769137, 1.0]], [1, [0.22183522651670873, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65587399]
bas 1, expnt(s) = [7617.52187471]
bas 2, expnt(s) = [3617.35088694]
bas 3, expnt(s) = [1597.82483419]
bas 4, expnt(s) = [382.85165828]
bas 5, expnt(s) = [108.12408286]
bas 6, expnt(s) = [34.84027208]
bas 7, expnt(s) = [7.45776676]
bas 8, expnt(s) = [2.96425067]
bas 9, expnt(s) = [0.82017639]
bas 10, expnt(s) = [0.35623246]
bas 11, expnt(s) = [0.15731859]
bas 12, expnt(s) = [1362.7832125]
bas 13, expnt(s) = [664.74561877]
bas 14, expnt(s) = [300.96169767]
bas 15, expnt(s) = [314.0420206]
bas 16, expnt(s) = [61.62267352]
bas 17, expnt(s) = [7.33181669]
bas 18, expnt(s) = [20.2376634]
bas 19, expnt(s) = [0.77485597]
bas 20, expnt(s) = [2.81015115]
bas 21, expnt(s) = [0.22183523]
CPU time:        43.19
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752187e+03 2.06003836e+03
 3.61735089e+03 1.17844143e+03 1.59782483e+03 6.38501467e+02
 3.82851658e+02 2.18669355e+02 1.08124083e+02 8.47143244e+01
 3.48402721e+01 3.62306543e+01 7.45776676e+00 1.14017528e+01
 2.96425067e+00 5.70756964e+00 8.20176391e-01 2.17743637e+00
 3.56232461e-01 1.16497107e+00 1.57318592e-01 6.31102736e-01
 1.36278321e+03 2.41556018e+04 6.64745619e+02 9.84699567e+03
 3.00961698e+02 3.65698709e+03 3.14042021e+02 3.85672876e+03
 6.16226735e+01 5.03686213e+02 7.33181669e+00 3.51964523e+01
 2.02376634e+01 1.25223216e+02 7.74855973e-01 2.12085327e+00
 2.81015115e+00 1.06144255e+01 2.21835227e-01 4.44142704e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993960616615894
cond(S) = 106327.36740408785
E1 = -729.5129555161133  E_coul = 203.17031327983926
init E= -526.342642236274
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555913673336496  LUMO = 0.40909797194964
  mo_energy =
[-1.18327814e+02 -1.22049377e+01 -9.44758527e+00 -9.44758527e+00
 -9.44758527e+00 -1.24029726e+00 -5.55913673e-01 -5.55913673e-01
 -5.55913673e-01  4.09097972e-01  1.02873492e+00  1.02873492e+00
  1.02873492e+00  2.36534553e+00  7.34143143e+00  7.34143143e+00
  7.34143143e+00  1.32317951e+01  3.35145493e+01  3.35145493e+01
  3.35145493e+01  1.03442849e+02  1.29135208e+02  1.29135208e+02
  1.29135208e+02  4.83537837e+02  4.83537837e+02  4.83537837e+02
  5.83497740e+02  1.33543338e+03  1.33543338e+03  1.33543338e+03
  2.65206932e+03  3.02974614e+03  3.02974614e+03  3.02974614e+03
  6.65030290e+03  6.65030290e+03  6.65030290e+03  9.05791108e+03
  2.54137492e+04  7.61563759e+04]
E1 = -727.7952858590883  E_coul = 201.0607410049122
cycle= 1 E= -526.734544854176  delta_E= -0.392  |g|= 0.189  |ddm|= 0.29
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547302
diis-c [-0.29953977  1.        ]
  HOMO = -0.591584763852395  LUMO = 0.399850545365043
  mo_energy =
[-1.18642360e+02 -1.23442485e+01 -9.59856389e+00 -9.59856389e+00
 -9.59856389e+00 -1.28036827e+00 -5.91584764e-01 -5.91584764e-01
 -5.91584764e-01  3.99850545e-01  1.00384401e+00  1.00384401e+00
  1.00384401e+00  2.32724822e+00  7.24906841e+00  7.24906841e+00
  7.24906841e+00  1.31261538e+01  3.33574435e+01  3.33574435e+01
  3.33574435e+01  1.03221044e+02  1.28902019e+02  1.28902019e+02
  1.28902019e+02  4.83224761e+02  4.83224761e+02  4.83224761e+02
  5.83145775e+02  1.33506229e+03  1.33506229e+03  1.33506229e+03
  2.65156274e+03  3.02930834e+03  3.02930834e+03  3.02930834e+03
  6.64975104e+03  6.64975104e+03  6.64975104e+03  9.05728345e+03
  2.54130271e+04  7.61555635e+04]
E1 = -728.3820277144209  E_coul = 201.64672748757062
cycle= 2 E= -526.73530022685  delta_E= -0.000755  |g|= 0.0386  |ddm|= 0.0545
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0772631
diis-c [-0.00334948  0.08596778  0.91403222]
  HOMO = -0.582363901891766  LUMO = 0.402819763824832
  mo_energy =
[-1.18573330e+02 -1.23054749e+01 -9.55810588e+00 -9.55810588e+00
 -9.55810588e+00 -1.26930722e+00 -5.82363902e-01 -5.82363902e-01
 -5.82363902e-01  4.02819764e-01  1.01063101e+00  1.01063101e+00
  1.01063101e+00  2.33775756e+00  7.27321327e+00  7.27321327e+00
  7.27321327e+00  1.31551833e+01  3.33982521e+01  3.33982521e+01
  3.33982521e+01  1.03277417e+02  1.28959004e+02  1.28959004e+02
  1.28959004e+02  4.83292962e+02  4.83292962e+02  4.83292962e+02
  5.83216340e+02  1.33513460e+03  1.33513460e+03  1.33513460e+03
  2.65163838e+03  3.02938291e+03  3.02938291e+03  3.02938291e+03
  6.64982735e+03  6.64982735e+03  6.64982735e+03  9.05736058e+03
  2.54131048e+04  7.61556415e+04]
E1 = -728.2274511920881  E_coul = 201.4920885331172
cycle= 3 E= -526.735362658971  delta_E= -6.24e-05  |g|= 0.00631  |ddm|= 0.0149
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132743
diis-c [-8.47457041e-07 -1.33101854e-03  1.41681957e-01  8.59649062e-01]
  HOMO = -0.583895672193845  LUMO = 0.402372318874967
  mo_energy =
[-1.18583346e+02 -1.23113436e+01 -9.56433358e+00 -9.56433358e+00
 -9.56433358e+00 -1.27102008e+00 -5.83895672e-01 -5.83895672e-01
 -5.83895672e-01  4.02372319e-01  1.00952876e+00  1.00952876e+00
  1.00952876e+00  2.33611105e+00  7.26937819e+00  7.26937819e+00
  7.26937819e+00  1.31507244e+01  3.33920129e+01  3.33920129e+01
  3.33920129e+01  1.03269150e+02  1.28950592e+02  1.28950592e+02
  1.28950592e+02  4.83283062e+02  4.83283062e+02  4.83283062e+02
  5.83206086e+02  1.33512411e+03  1.33512411e+03  1.33512411e+03
  2.65162725e+03  3.02937203e+03  3.02937203e+03  3.02937203e+03
  6.64981607e+03  6.64981607e+03  6.64981607e+03  9.05734908e+03
  2.54130931e+04  7.61556297e+04]
E1 = -728.2505118620797  E_coul = 201.5151472273665
cycle= 4 E= -526.735364634713  delta_E= -1.98e-06  |g|= 0.000114  |ddm|= 0.0023
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000143373
diis-c [-9.09012465e-09  9.62096772e-05 -1.31798529e-02 -8.49253465e-02
  1.09800899e+00]
  HOMO = -0.583878813259501  LUMO = 0.402388039292609
  mo_energy =
[-1.18583300e+02 -1.23112727e+01 -9.56427789e+00 -9.56427789e+00
 -9.56427789e+00 -1.27097530e+00 -5.83878813e-01 -5.83878813e-01
 -5.83878813e-01  4.02388039e-01  1.00954360e+00  1.00954360e+00
  1.00954360e+00  2.33614640e+00  7.26942187e+00  7.26942187e+00
  7.26942187e+00  1.31507846e+01  3.33920663e+01  3.33920663e+01
  3.33920663e+01  1.03269208e+02  1.28950645e+02  1.28950645e+02
  1.28950645e+02  4.83283107e+02  4.83283107e+02  4.83283107e+02
  5.83206124e+02  1.33512414e+03  1.33512414e+03  1.33512414e+03
  2.65162726e+03  3.02937205e+03  3.02937205e+03  3.02937205e+03
  6.64981608e+03  6.64981608e+03  6.64981608e+03  9.05734908e+03
  2.54130931e+04  7.61556297e+04]
E1 = -728.2502386212051  E_coul = 201.51487398373806
cycle= 5 E= -526.735364637467  delta_E= -2.75e-09  |g|= 2.3e-05  |ddm|= 0.000163
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.22949e-05
diis-c [-1.65109973e-10  1.34305330e-05 -1.53524643e-03 -1.22252879e-02
  6.79710133e-04  1.01306739e+00]
  HOMO = -0.583888479801983  LUMO = 0.402386396981699
  mo_energy =
[-1.18583337e+02 -1.23113008e+01 -9.56430797e+00 -9.56430797e+00
 -9.56430797e+00 -1.27098310e+00 -5.83888480e-01 -5.83888480e-01
 -5.83888480e-01  4.02386397e-01  1.00953711e+00  1.00953711e+00
  1.00953711e+00  2.33613809e+00  7.26940107e+00  7.26940107e+00
  7.26940107e+00  1.31507623e+01  3.33920371e+01  3.33920371e+01
  3.33920371e+01  1.03269175e+02  1.28950611e+02  1.28950611e+02
  1.28950611e+02  4.83283071e+02  4.83283071e+02  4.83283071e+02
  5.83206087e+02  1.33512411e+03  1.33512411e+03  1.33512411e+03
  2.65162722e+03  3.02937201e+03  3.02937201e+03  3.02937201e+03
  6.64981604e+03  6.64981604e+03  6.64981604e+03  9.05734904e+03
  2.54130931e+04  7.61556296e+04]
E1 = -728.2503350070199  E_coul = 201.51497036947072
cycle= 6 E= -526.735364637549  delta_E= -8.22e-11  |g|= 2.09e-06  |ddm|= 2.45e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2503350070199  E_coul = 201.51497036947072
  HOMO = -0.583887999288898  LUMO = 0.40238670221641
  mo_energy =
[-1.18583334e+02 -1.23112988e+01 -9.56430598e+00 -9.56430598e+00
 -9.56430598e+00 -1.27098217e+00 -5.83887999e-01 -5.83887999e-01
 -5.83887999e-01  4.02386702e-01  1.00953750e+00  1.00953750e+00
  1.00953750e+00  2.33613885e+00  7.26940237e+00  7.26940237e+00
  7.26940237e+00  1.31507638e+01  3.33920391e+01  3.33920391e+01
  3.33920391e+01  1.03269177e+02  1.28950613e+02  1.28950613e+02
  1.28950613e+02  4.83283074e+02  4.83283074e+02  4.83283074e+02
  5.83206090e+02  1.33512411e+03  1.33512411e+03  1.33512411e+03
  2.65162723e+03  3.02937201e+03  3.02937201e+03  3.02937201e+03
  6.64981604e+03  6.64981604e+03  6.64981604e+03  9.05734904e+03
  2.54130931e+04  7.61556296e+04]
E1 = -728.250326643231  E_coul = 201.5149620056799
Extra cycle  E= -526.735364637551  delta_E= -1.93e-12  |g|= 5.41e-07  |ddm|= 2.64e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 106327.36740408785
E1 = -728.250326643231  E_coul = 201.5149620056799
init E= -526.735364637551
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583888182900611  LUMO = 0.402386677495787
  mo_energy =
[-1.18583335e+02 -1.23112994e+01 -9.56430663e+00 -9.56430663e+00
 -9.56430663e+00 -1.27098230e+00 -5.83888183e-01 -5.83888183e-01
 -5.83888183e-01  4.02386677e-01  1.00953738e+00  1.00953738e+00
  1.00953738e+00  2.33613870e+00  7.26940196e+00  7.26940196e+00
  7.26940196e+00  1.31507634e+01  3.33920385e+01  3.33920385e+01
  3.33920385e+01  1.03269177e+02  1.28950612e+02  1.28950612e+02
  1.28950612e+02  4.83283073e+02  4.83283073e+02  4.83283073e+02
  5.83206089e+02  1.33512411e+03  1.33512411e+03  1.33512411e+03
  2.65162723e+03  3.02937201e+03  3.02937201e+03  3.02937201e+03
  6.64981604e+03  6.64981604e+03  6.64981604e+03  9.05734904e+03
  2.54130931e+04  7.61556296e+04]
E1 = -728.250328776348  E_coul = 201.51496413879718
cycle= 1 E= -526.735364637551  delta_E= 2.27e-13  |g|= 1.53e-07  |ddm|= 5.62e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.250328776348  E_coul = 201.51496413879718
  HOMO = -0.583888147136051  LUMO = 0.402386695590313
  mo_energy =
[-1.18583335e+02 -1.23112993e+01 -9.56430647e+00 -9.56430647e+00
 -9.56430647e+00 -1.27098225e+00 -5.83888147e-01 -5.83888147e-01
 -5.83888147e-01  4.02386696e-01  1.00953741e+00  1.00953741e+00
  1.00953741e+00  2.33613875e+00  7.26940206e+00  7.26940206e+00
  7.26940206e+00  1.31507635e+01  3.33920386e+01  3.33920386e+01
  3.33920386e+01  1.03269177e+02  1.28950613e+02  1.28950613e+02
  1.28950613e+02  4.83283073e+02  4.83283073e+02  4.83283073e+02
  5.83206089e+02  1.33512411e+03  1.33512411e+03  1.33512411e+03
  2.65162723e+03  3.02937201e+03  3.02937201e+03  3.02937201e+03
  6.64981604e+03  6.64981604e+03  6.64981604e+03  9.05734904e+03
  2.54130931e+04  7.61556296e+04]
E1 = -728.250328119769  E_coul = 201.5149634822178
Extra cycle  E= -526.735364637551  delta_E= -3.41e-13  |g|= 4.05e-08  |ddm|= 1.3e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826559e+04 7.61752187e+03 3.61735089e+03 1.59782483e+03
 3.82851658e+02 1.08124083e+02 3.48402721e+01 7.45776676e+00
 2.96425067e+00 8.20176391e-01 3.56232461e-01 1.57318592e-01
 1.36278321e+03 6.64745619e+02 3.00961698e+02 3.14042021e+02
 6.16226735e+01 7.33181669e+00 2.02376634e+01 7.74855973e-01
 2.81015115e+00 2.21835227e-01]
grad_E = [-1.51893737e-06  3.32701665e-06 -1.56907425e-06  7.00913445e-05
 -5.98611610e-05  1.79518424e-05 -4.11890287e-03 -3.43526453e-03
 -7.03054126e-04  1.27798571e-03 -5.94837533e-03  3.99343779e-03
 -5.05521521e-07  5.02668808e-06  2.37309486e-05  2.04604799e-05
 -2.79647691e-05 -9.71724243e-05  6.75278900e-05  3.81785928e-03
 -1.12302593e-04 -1.45439837e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:55 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.655878         1
[INPUT] 0    0    [1    /1   ]  7617.52186586        1
[INPUT] 0    0    [1    /1   ]  3617.35089113        1
[INPUT] 0    0    [1    /1   ]  1597.82464802        1
[INPUT] 0    0    [1    /1   ]  382.85180563         1
[INPUT] 0    0    [1    /1   ]  108.124208065        1
[INPUT] 0    0    [1    /1   ]  34.8503557142        1
[INPUT] 0    0    [1    /1   ]  7.45762895575        1
[INPUT] 0    0    [1    /1   ]  2.98622289244        1
[INPUT] 0    0    [1    /1   ]  0.818327184721       1
[INPUT] 0    0    [1    /1   ]  0.369207782811       1
[INPUT] 0    0    [1    /1   ]  0.153121355705       1
[INPUT] 1    0    [1    /1   ]  1362.78321384        1
[INPUT] 1    0    [1    /1   ]  664.745605391        1
[INPUT] 1    0    [1    /1   ]  300.961634487        1
[INPUT] 1    0    [1    /1   ]  314.041966125        1
[INPUT] 1    0    [1    /1   ]  61.6227512085        1
[INPUT] 1    0    [1    /1   ]  7.33198562793        1
[INPUT] 1    0    [1    /1   ]  20.2374704906        1
[INPUT] 1    0    [1    /1   ]  0.774549724417       1
[INPUT] 1    0    [1    /1   ]  2.81058294416        1
[INPUT] 1    0    [1    /1   ]  0.222229137063       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65587803572, 1.0]], [0, [7617.521865864124, 1.0]], [0, [3617.3508911259732, 1.0]], [0, [1597.8246480181722, 1.0]], [0, [382.8518056299767, 1.0]], [0, [108.12420806513344, 1.0]], [0, [34.850355714208234, 1.0]], [0, [7.45762895574776, 1.0]], [0, [2.986222892441274, 1.0]], [0, [0.8183271847207032, 1.0]], [0, [0.36920778281054056, 1.0]], [0, [0.15312135570499644, 1.0]], [1, [1362.783213841748, 1.0]], [1, [664.7456053914467, 1.0]], [1, [300.9616344871882, 1.0]], [1, [314.04196612505416, 1.0]], [1, [61.622751208477794, 1.0]], [1, [7.331985627926191, 1.0]], [1, [20.2374704906011, 1.0]], [1, [0.7745497244168347, 1.0]], [1, [2.810582944163179, 1.0]], [1, [0.22222913706335742, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65587804]
bas 1, expnt(s) = [7617.52186586]
bas 2, expnt(s) = [3617.35089113]
bas 3, expnt(s) = [1597.82464802]
bas 4, expnt(s) = [382.85180563]
bas 5, expnt(s) = [108.12420807]
bas 6, expnt(s) = [34.85035571]
bas 7, expnt(s) = [7.45762896]
bas 8, expnt(s) = [2.98622289]
bas 9, expnt(s) = [0.81832718]
bas 10, expnt(s) = [0.36920778]
bas 11, expnt(s) = [0.15312136]
bas 12, expnt(s) = [1362.78321384]
bas 13, expnt(s) = [664.74560539]
bas 14, expnt(s) = [300.96163449]
bas 15, expnt(s) = [314.04196613]
bas 16, expnt(s) = [61.62275121]
bas 17, expnt(s) = [7.33198563]
bas 18, expnt(s) = [20.23747049]
bas 19, expnt(s) = [0.77454972]
bas 20, expnt(s) = [2.81058294]
bas 21, expnt(s) = [0.22222914]
CPU time:        48.92
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752187e+03 2.06003835e+03
 3.61735089e+03 1.17844143e+03 1.59782465e+03 6.38501411e+02
 3.82851806e+02 2.18669418e+02 1.08124208e+02 8.47143980e+01
 3.48503557e+01 3.62385186e+01 7.45762896e+00 1.14015948e+01
 2.98622289e+00 5.73927044e+00 8.18327185e-01 2.17375332e+00
 3.69207783e-01 1.19665280e+00 1.53121356e-01 6.18431850e-01
 1.36278321e+03 2.41556018e+04 6.64745605e+02 9.84699543e+03
 3.00961634e+02 3.65698613e+03 3.14041966e+02 3.85672792e+03
 6.16227512e+01 5.03687006e+02 7.33198563e+00 3.51974661e+01
 2.02374705e+01 1.25221724e+02 7.74549724e-01 2.11980554e+00
 2.81058294e+00 1.06164642e+01 2.22229137e-01 4.45128747e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993948273971863
cond(S) = 106349.47436032939
E1 = -729.5112267552614  E_coul = 203.16902666507514
init E= -526.342200090186
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.555894678919578  LUMO = 0.407205260769975
  mo_energy =
[-1.18327995e+02 -1.22050629e+01 -9.44772326e+00 -9.44772326e+00
 -9.44772326e+00 -1.24031478e+00 -5.55894679e-01 -5.55894679e-01
 -5.55894679e-01  4.07205261e-01  1.03004433e+00  1.03004433e+00
  1.03004433e+00  2.38835323e+00  7.34247318e+00  7.34247318e+00
  7.34247318e+00  1.33225037e+01  3.35162716e+01  3.35162716e+01
  3.35162716e+01  1.03586998e+02  1.29136647e+02  1.29136647e+02
  1.29136647e+02  4.83538842e+02  4.83538842e+02  4.83538842e+02
  5.83640631e+02  1.33543414e+03  1.33543414e+03  1.33543414e+03
  2.65219655e+03  3.02974666e+03  3.02974666e+03  3.02974666e+03
  6.65030322e+03  6.65030322e+03  6.65030322e+03  9.05802775e+03
  2.54138594e+04  7.61564785e+04]
E1 = -727.8029300146426  E_coul = 201.0682786684497
cycle= 1 E= -526.734651346193  delta_E= -0.392  |g|= 0.189  |ddm|= 0.291
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547331
diis-c [-0.29957117  1.        ]
  HOMO = -0.591273516270685  LUMO = 0.398031785149729
  mo_energy =
[-1.18641962e+02 -1.23437398e+01 -9.59805511e+00 -9.59805511e+00
 -9.59805511e+00 -1.28001530e+00 -5.91273516e-01 -5.91273516e-01
 -5.91273516e-01  3.98031785e-01  1.00533184e+00  1.00533184e+00
  1.00533184e+00  2.35017388e+00  7.25071465e+00  7.25071465e+00
  7.25071465e+00  1.32173189e+01  3.33597787e+01  3.33597787e+01
  3.33597787e+01  1.03365844e+02  1.28904078e+02  1.28904078e+02
  1.28904078e+02  4.83226360e+02  4.83226360e+02  4.83226360e+02
  5.83289230e+02  1.33506361e+03  1.33506361e+03  1.33506361e+03
  2.65169047e+03  3.02930939e+03  3.02930939e+03  3.02930939e+03
  6.64975185e+03  6.64975185e+03  6.64975185e+03  9.05740059e+03
  2.54131378e+04  7.61556665e+04]
E1 = -728.3862973865836  E_coul = 201.6508960895924
cycle= 2 E= -526.735401296991  delta_E= -0.00075  |g|= 0.0384  |ddm|= 0.0554
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0770129
diis-c [-0.00333113  0.08565674  0.91434326]
  HOMO = -0.582125368100915  LUMO = 0.400985034544015
  mo_energy =
[-1.18573201e+02 -1.23051830e+01 -9.55781784e+00 -9.55781784e+00
 -9.55781784e+00 -1.26903778e+00 -5.82125368e-01 -5.82125368e-01
 -5.82125368e-01  4.00985035e-01  1.01206777e+00  1.01206777e+00
  1.01206777e+00  2.36070269e+00  7.27470568e+00  7.27470568e+00
  7.27470568e+00  1.32462270e+01  3.34003717e+01  3.34003717e+01
  3.34003717e+01  1.03421971e+02  1.28960814e+02  1.28960814e+02
  1.28960814e+02  4.83294294e+02  4.83294294e+02  4.83294294e+02
  5.83359523e+02  1.33513564e+03  1.33513564e+03  1.33513564e+03
  2.65176584e+03  3.02938368e+03  3.02938368e+03  3.02938368e+03
  6.64982788e+03  6.64982788e+03  6.64982788e+03  9.05747744e+03
  2.54132152e+04  7.61557442e+04]
E1 = -728.2326061307081  E_coul = 201.49714307979352
cycle= 3 E= -526.735463050915  delta_E= -6.18e-05  |g|= 0.00628  |ddm|= 0.0148
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132254
diis-c [-8.54957908e-07 -1.32916197e-03  1.41612954e-01  8.59716208e-01]
  HOMO = -0.583652909415146  LUMO = 0.400538193859518
  mo_energy =
[-1.18583185e+02 -1.23110314e+01 -9.56402399e+00 -9.56402399e+00
 -9.56402399e+00 -1.27074321e+00 -5.83652909e-01 -5.83652909e-01
 -5.83652909e-01  4.00538194e-01  1.01096813e+00  1.01096813e+00
  1.01096813e+00  2.35904528e+00  7.27088437e+00  7.27088437e+00
  7.27088437e+00  1.32417761e+01  3.33941539e+01  3.33941539e+01
  3.33941539e+01  1.03413731e+02  1.28952429e+02  1.28952429e+02
  1.28952429e+02  4.83284425e+02  4.83284425e+02  4.83284425e+02
  5.83349302e+02  1.33512518e+03  1.33512518e+03  1.33512518e+03
  2.65175474e+03  3.02937283e+03  3.02937283e+03  3.02937283e+03
  6.64981664e+03  6.64981664e+03  6.64981664e+03  9.05746597e+03
  2.54132036e+04  7.61557325e+04]
E1 = -728.2555407792689  E_coul = 201.52007577053377
cycle= 4 E= -526.735465008735  delta_E= -1.96e-06  |g|= 0.000115  |ddm|= 0.00232
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000144174
diis-c [-9.40850995e-09  9.83219953e-05 -1.34390894e-02 -8.63436781e-02
  1.09968445e+00]
  HOMO = -0.583636308047934  LUMO = 0.400554043424415
  mo_energy =
[-1.18583138e+02 -1.23109596e+01 -9.56396721e+00 -9.56396721e+00
 -9.56396721e+00 -1.27069802e+00 -5.83636308e-01 -5.83636308e-01
 -5.83636308e-01  4.00554043e-01  1.01098280e+00  1.01098280e+00
  1.01098280e+00  2.35908082e+00  7.27092851e+00  7.27092851e+00
  7.27092851e+00  1.32418370e+01  3.33942084e+01  3.33942084e+01
  3.33942084e+01  1.03413791e+02  1.28952484e+02  1.28952484e+02
  1.28952484e+02  4.83284473e+02  4.83284473e+02  4.83284473e+02
  5.83349342e+02  1.33512522e+03  1.33512522e+03  1.33512522e+03
  2.65175476e+03  3.02937286e+03  3.02937286e+03  3.02937286e+03
  6.64981665e+03  6.64981665e+03  6.64981665e+03  9.05746597e+03
  2.54132035e+04  7.61557324e+04]
E1 = -728.2552584087073  E_coul = 201.5197933970473
cycle= 5 E= -526.73546501166  delta_E= -2.92e-09  |g|= 2.34e-05  |ddm|= 0.000165
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.27292e-05
diis-c [-1.71166774e-10  1.37350638e-05 -1.56651538e-03 -1.24529628e-02
 -9.64573203e-05  1.01410220e+00]
  HOMO = -0.583646167251795  LUMO = 0.400552362489406
  mo_energy =
[-1.18583175e+02 -1.23109881e+01 -9.56399775e+00 -9.56399775e+00
 -9.56399775e+00 -1.27070595e+00 -5.83646167e-01 -5.83646167e-01
 -5.83646167e-01  4.00552362e-01  1.01097618e+00  1.01097618e+00
  1.01097618e+00  2.35907225e+00  7.27090737e+00  7.27090737e+00
  7.27090737e+00  1.32418143e+01  3.33941788e+01  3.33941788e+01
  3.33941788e+01  1.03413757e+02  1.28952449e+02  1.28952449e+02
  1.28952449e+02  4.83284436e+02  4.83284436e+02  4.83284436e+02
  5.83349304e+02  1.33512518e+03  1.33512518e+03  1.33512518e+03
  2.65175472e+03  3.02937282e+03  3.02937282e+03  3.02937282e+03
  6.64981661e+03  6.64981661e+03  6.64981661e+03  9.05746593e+03
  2.54132035e+04  7.61557324e+04]
E1 = -728.2553557734997  E_coul = 201.51989076175246
cycle= 6 E= -526.735465011747  delta_E= -8.73e-11  |g|= 2.11e-06  |ddm|= 2.45e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2553557734997  E_coul = 201.51989076175246
  HOMO = -0.583645670284531  LUMO = 0.400552672603629
  mo_energy =
[-1.18583172e+02 -1.23109861e+01 -9.56399571e+00 -9.56399571e+00
 -9.56399571e+00 -1.27070501e+00 -5.83645670e-01 -5.83645670e-01
 -5.83645670e-01  4.00552673e-01  1.01097658e+00  1.01097658e+00
  1.01097658e+00  2.35907304e+00  7.27090871e+00  7.27090871e+00
  7.27090871e+00  1.32418159e+01  3.33941808e+01  3.33941808e+01
  3.33941808e+01  1.03413760e+02  1.28952452e+02  1.28952452e+02
  1.28952452e+02  4.83284439e+02  4.83284439e+02  4.83284439e+02
  5.83349307e+02  1.33512519e+03  1.33512519e+03  1.33512519e+03
  2.65175472e+03  3.02937282e+03  3.02937282e+03  3.02937282e+03
  6.64981661e+03  6.64981661e+03  6.64981661e+03  9.05746594e+03
  2.54132035e+04  7.61557324e+04]
E1 = -728.2553472352076  E_coul = 201.51988222346034
Extra cycle  E= -526.735465011747  delta_E=    0  |g|= 5.49e-07  |ddm|= 2.5e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826559e+04 7.61752187e+03 3.61735089e+03 1.59782465e+03
 3.82851806e+02 1.08124208e+02 3.48503557e+01 7.45762896e+00
 2.98622289e+00 8.18327185e-01 3.69207783e-01 1.53121356e-01
 1.36278321e+03 6.64745605e+02 3.00961634e+02 3.14041966e+02
 6.16227512e+01 7.33198563e+00 2.02374705e+01 7.74549724e-01
 2.81058294e+00 2.22229137e-01]
E = -526.7354650117472
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:21:56 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.655878         1
[INPUT] 0    0    [1    /1   ]  7617.52186586        1
[INPUT] 0    0    [1    /1   ]  3617.35089113        1
[INPUT] 0    0    [1    /1   ]  1597.82464802        1
[INPUT] 0    0    [1    /1   ]  382.85180563         1
[INPUT] 0    0    [1    /1   ]  108.124208065        1
[INPUT] 0    0    [1    /1   ]  34.8503557142        1
[INPUT] 0    0    [1    /1   ]  7.45762895575        1
[INPUT] 0    0    [1    /1   ]  2.98622289244        1
[INPUT] 0    0    [1    /1   ]  0.818327184721       1
[INPUT] 0    0    [1    /1   ]  0.369207782811       1
[INPUT] 0    0    [1    /1   ]  0.153121355705       1
[INPUT] 1    0    [1    /1   ]  1362.78321384        1
[INPUT] 1    0    [1    /1   ]  664.745605391        1
[INPUT] 1    0    [1    /1   ]  300.961634487        1
[INPUT] 1    0    [1    /1   ]  314.041966125        1
[INPUT] 1    0    [1    /1   ]  61.6227512085        1
[INPUT] 1    0    [1    /1   ]  7.33198562793        1
[INPUT] 1    0    [1    /1   ]  20.2374704906        1
[INPUT] 1    0    [1    /1   ]  0.774549724417       1
[INPUT] 1    0    [1    /1   ]  2.81058294416        1
[INPUT] 1    0    [1    /1   ]  0.222229137063       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65587803572, 1.0]], [0, [7617.521865864124, 1.0]], [0, [3617.3508911259732, 1.0]], [0, [1597.8246480181722, 1.0]], [0, [382.8518056299767, 1.0]], [0, [108.12420806513344, 1.0]], [0, [34.850355714208234, 1.0]], [0, [7.45762895574776, 1.0]], [0, [2.986222892441274, 1.0]], [0, [0.8183271847207032, 1.0]], [0, [0.36920778281054056, 1.0]], [0, [0.15312135570499644, 1.0]], [1, [1362.783213841748, 1.0]], [1, [664.7456053914467, 1.0]], [1, [300.9616344871882, 1.0]], [1, [314.04196612505416, 1.0]], [1, [61.622751208477794, 1.0]], [1, [7.331985627926191, 1.0]], [1, [20.2374704906011, 1.0]], [1, [0.7745497244168347, 1.0]], [1, [2.810582944163179, 1.0]], [1, [0.22222913706335742, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65587804]
bas 1, expnt(s) = [7617.52186586]
bas 2, expnt(s) = [3617.35089113]
bas 3, expnt(s) = [1597.82464802]
bas 4, expnt(s) = [382.85180563]
bas 5, expnt(s) = [108.12420807]
bas 6, expnt(s) = [34.85035571]
bas 7, expnt(s) = [7.45762896]
bas 8, expnt(s) = [2.98622289]
bas 9, expnt(s) = [0.81832718]
bas 10, expnt(s) = [0.36920778]
bas 11, expnt(s) = [0.15312136]
bas 12, expnt(s) = [1362.78321384]
bas 13, expnt(s) = [664.74560539]
bas 14, expnt(s) = [300.96163449]
bas 15, expnt(s) = [314.04196613]
bas 16, expnt(s) = [61.62275121]
bas 17, expnt(s) = [7.33198563]
bas 18, expnt(s) = [20.23747049]
bas 19, expnt(s) = [0.77454972]
bas 20, expnt(s) = [2.81058294]
bas 21, expnt(s) = [0.22222914]
CPU time:        49.26
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752187e+03 2.06003835e+03
 3.61735089e+03 1.17844143e+03 1.59782465e+03 6.38501411e+02
 3.82851806e+02 2.18669418e+02 1.08124208e+02 8.47143980e+01
 3.48503557e+01 3.62385186e+01 7.45762896e+00 1.14015948e+01
 2.98622289e+00 5.73927044e+00 8.18327185e-01 2.17375332e+00
 3.69207783e-01 1.19665280e+00 1.53121356e-01 6.18431850e-01
 1.36278321e+03 2.41556018e+04 6.64745605e+02 9.84699543e+03
 3.00961634e+02 3.65698613e+03 3.14041966e+02 3.85672792e+03
 6.16227512e+01 5.03687006e+02 7.33198563e+00 3.51974661e+01
 2.02374705e+01 1.25221724e+02 7.74549724e-01 2.11980554e+00
 2.81058294e+00 1.06164642e+01 2.22229137e-01 4.45128747e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993948273971863
cond(S) = 106349.47436032939
E1 = -729.5112267552614  E_coul = 203.16902666507514
init E= -526.342200090186
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555894678919578  LUMO = 0.407205260769975
  mo_energy =
[-1.18327995e+02 -1.22050629e+01 -9.44772326e+00 -9.44772326e+00
 -9.44772326e+00 -1.24031478e+00 -5.55894679e-01 -5.55894679e-01
 -5.55894679e-01  4.07205261e-01  1.03004433e+00  1.03004433e+00
  1.03004433e+00  2.38835323e+00  7.34247318e+00  7.34247318e+00
  7.34247318e+00  1.33225037e+01  3.35162716e+01  3.35162716e+01
  3.35162716e+01  1.03586998e+02  1.29136647e+02  1.29136647e+02
  1.29136647e+02  4.83538842e+02  4.83538842e+02  4.83538842e+02
  5.83640631e+02  1.33543414e+03  1.33543414e+03  1.33543414e+03
  2.65219655e+03  3.02974666e+03  3.02974666e+03  3.02974666e+03
  6.65030322e+03  6.65030322e+03  6.65030322e+03  9.05802775e+03
  2.54138594e+04  7.61564785e+04]
E1 = -727.8029300146426  E_coul = 201.0682786684497
cycle= 1 E= -526.734651346193  delta_E= -0.392  |g|= 0.189  |ddm|= 0.291
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547331
diis-c [-0.29957117  1.        ]
  HOMO = -0.591273516270685  LUMO = 0.398031785149729
  mo_energy =
[-1.18641962e+02 -1.23437398e+01 -9.59805511e+00 -9.59805511e+00
 -9.59805511e+00 -1.28001530e+00 -5.91273516e-01 -5.91273516e-01
 -5.91273516e-01  3.98031785e-01  1.00533184e+00  1.00533184e+00
  1.00533184e+00  2.35017388e+00  7.25071465e+00  7.25071465e+00
  7.25071465e+00  1.32173189e+01  3.33597787e+01  3.33597787e+01
  3.33597787e+01  1.03365844e+02  1.28904078e+02  1.28904078e+02
  1.28904078e+02  4.83226360e+02  4.83226360e+02  4.83226360e+02
  5.83289230e+02  1.33506361e+03  1.33506361e+03  1.33506361e+03
  2.65169047e+03  3.02930939e+03  3.02930939e+03  3.02930939e+03
  6.64975185e+03  6.64975185e+03  6.64975185e+03  9.05740059e+03
  2.54131378e+04  7.61556665e+04]
E1 = -728.3862973865836  E_coul = 201.6508960895924
cycle= 2 E= -526.735401296991  delta_E= -0.00075  |g|= 0.0384  |ddm|= 0.0554
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0770129
diis-c [-0.00333113  0.08565674  0.91434326]
  HOMO = -0.582125368100915  LUMO = 0.400985034544015
  mo_energy =
[-1.18573201e+02 -1.23051830e+01 -9.55781784e+00 -9.55781784e+00
 -9.55781784e+00 -1.26903778e+00 -5.82125368e-01 -5.82125368e-01
 -5.82125368e-01  4.00985035e-01  1.01206777e+00  1.01206777e+00
  1.01206777e+00  2.36070269e+00  7.27470568e+00  7.27470568e+00
  7.27470568e+00  1.32462270e+01  3.34003717e+01  3.34003717e+01
  3.34003717e+01  1.03421971e+02  1.28960814e+02  1.28960814e+02
  1.28960814e+02  4.83294294e+02  4.83294294e+02  4.83294294e+02
  5.83359523e+02  1.33513564e+03  1.33513564e+03  1.33513564e+03
  2.65176584e+03  3.02938368e+03  3.02938368e+03  3.02938368e+03
  6.64982788e+03  6.64982788e+03  6.64982788e+03  9.05747744e+03
  2.54132152e+04  7.61557442e+04]
E1 = -728.2326061307081  E_coul = 201.49714307979352
cycle= 3 E= -526.735463050915  delta_E= -6.18e-05  |g|= 0.00628  |ddm|= 0.0148
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132254
diis-c [-8.54957908e-07 -1.32916197e-03  1.41612954e-01  8.59716208e-01]
  HOMO = -0.583652909415146  LUMO = 0.400538193859518
  mo_energy =
[-1.18583185e+02 -1.23110314e+01 -9.56402399e+00 -9.56402399e+00
 -9.56402399e+00 -1.27074321e+00 -5.83652909e-01 -5.83652909e-01
 -5.83652909e-01  4.00538194e-01  1.01096813e+00  1.01096813e+00
  1.01096813e+00  2.35904528e+00  7.27088437e+00  7.27088437e+00
  7.27088437e+00  1.32417761e+01  3.33941539e+01  3.33941539e+01
  3.33941539e+01  1.03413731e+02  1.28952429e+02  1.28952429e+02
  1.28952429e+02  4.83284425e+02  4.83284425e+02  4.83284425e+02
  5.83349302e+02  1.33512518e+03  1.33512518e+03  1.33512518e+03
  2.65175474e+03  3.02937283e+03  3.02937283e+03  3.02937283e+03
  6.64981664e+03  6.64981664e+03  6.64981664e+03  9.05746597e+03
  2.54132036e+04  7.61557325e+04]
E1 = -728.2555407792689  E_coul = 201.52007577053377
cycle= 4 E= -526.735465008735  delta_E= -1.96e-06  |g|= 0.000115  |ddm|= 0.00232
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000144174
diis-c [-9.40850995e-09  9.83219953e-05 -1.34390894e-02 -8.63436781e-02
  1.09968445e+00]
  HOMO = -0.583636308047934  LUMO = 0.400554043424415
  mo_energy =
[-1.18583138e+02 -1.23109596e+01 -9.56396721e+00 -9.56396721e+00
 -9.56396721e+00 -1.27069802e+00 -5.83636308e-01 -5.83636308e-01
 -5.83636308e-01  4.00554043e-01  1.01098280e+00  1.01098280e+00
  1.01098280e+00  2.35908082e+00  7.27092851e+00  7.27092851e+00
  7.27092851e+00  1.32418370e+01  3.33942084e+01  3.33942084e+01
  3.33942084e+01  1.03413791e+02  1.28952484e+02  1.28952484e+02
  1.28952484e+02  4.83284473e+02  4.83284473e+02  4.83284473e+02
  5.83349342e+02  1.33512522e+03  1.33512522e+03  1.33512522e+03
  2.65175476e+03  3.02937286e+03  3.02937286e+03  3.02937286e+03
  6.64981665e+03  6.64981665e+03  6.64981665e+03  9.05746597e+03
  2.54132035e+04  7.61557324e+04]
E1 = -728.2552584087073  E_coul = 201.5197933970473
cycle= 5 E= -526.73546501166  delta_E= -2.92e-09  |g|= 2.34e-05  |ddm|= 0.000165
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.27292e-05
diis-c [-1.71166774e-10  1.37350638e-05 -1.56651538e-03 -1.24529628e-02
 -9.64573203e-05  1.01410220e+00]
  HOMO = -0.583646167251795  LUMO = 0.400552362489406
  mo_energy =
[-1.18583175e+02 -1.23109881e+01 -9.56399775e+00 -9.56399775e+00
 -9.56399775e+00 -1.27070595e+00 -5.83646167e-01 -5.83646167e-01
 -5.83646167e-01  4.00552362e-01  1.01097618e+00  1.01097618e+00
  1.01097618e+00  2.35907225e+00  7.27090737e+00  7.27090737e+00
  7.27090737e+00  1.32418143e+01  3.33941788e+01  3.33941788e+01
  3.33941788e+01  1.03413757e+02  1.28952449e+02  1.28952449e+02
  1.28952449e+02  4.83284436e+02  4.83284436e+02  4.83284436e+02
  5.83349304e+02  1.33512518e+03  1.33512518e+03  1.33512518e+03
  2.65175472e+03  3.02937282e+03  3.02937282e+03  3.02937282e+03
  6.64981661e+03  6.64981661e+03  6.64981661e+03  9.05746593e+03
  2.54132035e+04  7.61557324e+04]
E1 = -728.2553557734997  E_coul = 201.51989076175246
cycle= 6 E= -526.735465011747  delta_E= -8.73e-11  |g|= 2.11e-06  |ddm|= 2.45e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2553557734997  E_coul = 201.51989076175246
  HOMO = -0.583645670284531  LUMO = 0.400552672603629
  mo_energy =
[-1.18583172e+02 -1.23109861e+01 -9.56399571e+00 -9.56399571e+00
 -9.56399571e+00 -1.27070501e+00 -5.83645670e-01 -5.83645670e-01
 -5.83645670e-01  4.00552673e-01  1.01097658e+00  1.01097658e+00
  1.01097658e+00  2.35907304e+00  7.27090871e+00  7.27090871e+00
  7.27090871e+00  1.32418159e+01  3.33941808e+01  3.33941808e+01
  3.33941808e+01  1.03413760e+02  1.28952452e+02  1.28952452e+02
  1.28952452e+02  4.83284439e+02  4.83284439e+02  4.83284439e+02
  5.83349307e+02  1.33512519e+03  1.33512519e+03  1.33512519e+03
  2.65175472e+03  3.02937282e+03  3.02937282e+03  3.02937282e+03
  6.64981661e+03  6.64981661e+03  6.64981661e+03  9.05746594e+03
  2.54132035e+04  7.61557324e+04]
E1 = -728.2553472352076  E_coul = 201.51988222346034
Extra cycle  E= -526.735465011747  delta_E=    0  |g|= 5.49e-07  |ddm|= 2.5e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 106349.47436032939
E1 = -728.2553472352076  E_coul = 201.51988222346034
init E= -526.735465011747
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583645856871924  LUMO = 0.400552646662811
  mo_energy =
[-1.18583173e+02 -1.23109867e+01 -9.56399637e+00 -9.56399637e+00
 -9.56399637e+00 -1.27070515e+00 -5.83645857e-01 -5.83645857e-01
 -5.83645857e-01  4.00552647e-01  1.01097645e+00  1.01097645e+00
  1.01097645e+00  2.35907288e+00  7.27090828e+00  7.27090828e+00
  7.27090828e+00  1.32418154e+01  3.33941801e+01  3.33941801e+01
  3.33941801e+01  1.03413759e+02  1.28952451e+02  1.28952451e+02
  1.28952451e+02  4.83284438e+02  4.83284438e+02  4.83284438e+02
  5.83349306e+02  1.33512519e+03  1.33512519e+03  1.33512519e+03
  2.65175472e+03  3.02937282e+03  3.02937282e+03  3.02937282e+03
  6.64981661e+03  6.64981661e+03  6.64981661e+03  9.05746594e+03
  2.54132035e+04  7.61557324e+04]
E1 = -728.2553494182268  E_coul = 201.5198844064799
cycle= 1 E= -526.735465011747  delta_E= 2.27e-13  |g|= 1.55e-07  |ddm|= 5.35e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2553494182268  E_coul = 201.5198844064799
  HOMO = -0.58364582016434  LUMO = 0.400552665036822
  mo_energy =
[-1.18583173e+02 -1.23109865e+01 -9.56399621e+00 -9.56399621e+00
 -9.56399621e+00 -1.27070509e+00 -5.83645820e-01 -5.83645820e-01
 -5.83645820e-01  4.00552665e-01  1.01097648e+00  1.01097648e+00
  1.01097648e+00  2.35907293e+00  7.27090838e+00  7.27090838e+00
  7.27090838e+00  1.32418155e+01  3.33941803e+01  3.33941803e+01
  3.33941803e+01  1.03413759e+02  1.28952451e+02  1.28952451e+02
  1.28952451e+02  4.83284438e+02  4.83284438e+02  4.83284438e+02
  5.83349306e+02  1.33512519e+03  1.33512519e+03  1.33512519e+03
  2.65175472e+03  3.02937282e+03  3.02937282e+03  3.02937282e+03
  6.64981661e+03  6.64981661e+03  6.64981661e+03  9.05746594e+03
  2.54132035e+04  7.61557324e+04]
E1 = -728.2553487485712  E_coul = 201.51988373682326
Extra cycle  E= -526.735465011748  delta_E= -9.09e-13  |g|= 4.13e-08  |ddm|= 1.24e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826559e+04 7.61752187e+03 3.61735089e+03 1.59782465e+03
 3.82851806e+02 1.08124208e+02 3.48503557e+01 7.45762896e+00
 2.98622289e+00 8.18327185e-01 3.69207783e-01 1.53121356e-01
 1.36278321e+03 6.64745605e+02 3.00961634e+02 3.14041966e+02
 6.16227512e+01 7.33198563e+00 2.02374705e+01 7.74549724e-01
 2.81058294e+00 2.22229137e-01]
grad_E = [-1.51882647e-06  3.32603906e-06 -1.56929721e-06  7.00535310e-05
 -5.86634132e-05  1.31870022e-05 -4.14238941e-03 -4.00523069e-03
  3.02120014e-04 -5.30201579e-04 -1.03216248e-03 -1.97393401e-03
 -5.05603686e-07  5.02533602e-06  2.37227048e-05  2.04534462e-05
 -2.68661001e-05 -6.11673966e-05  5.98845325e-05  1.59510756e-04
 -5.69468023e-05 -1.11784299e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:00 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558816        1
[INPUT] 0    0    [1    /1   ]  7617.52185795        1
[INPUT] 0    0    [1    /1   ]  3617.35089486        1
[INPUT] 0    0    [1    /1   ]  1597.82448143        1
[INPUT] 0    0    [1    /1   ]  382.851941625        1
[INPUT] 0    0    [1    /1   ]  108.12424289         1
[INPUT] 0    0    [1    /1   ]  34.8598238565        1
[INPUT] 0    0    [1    /1   ]  7.46270683063        1
[INPUT] 0    0    [1    /1   ]  2.99488605898        1
[INPUT] 0    0    [1    /1   ]  0.81820427855        1
[INPUT] 0    0    [1    /1   ]  0.375576662518       1
[INPUT] 0    0    [1    /1   ]  0.153712147365       1
[INPUT] 1    0    [1    /1   ]  1362.78321504        1
[INPUT] 1    0    [1    /1   ]  664.74559343         1
[INPUT] 1    0    [1    /1   ]  300.961578018        1
[INPUT] 1    0    [1    /1   ]  314.041917438        1
[INPUT] 1    0    [1    /1   ]  61.6228176203        1
[INPUT] 1    0    [1    /1   ]  7.33212858814        1
[INPUT] 1    0    [1    /1   ]  20.2373151143        1
[INPUT] 1    0    [1    /1   ]  0.774449583252       1
[INPUT] 1    0    [1    /1   ]  2.81084822023        1
[INPUT] 1    0    [1    /1   ]  0.222622501075       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655881649534, 1.0]], [0, [7617.521857952557, 1.0]], [0, [3617.3508948629524, 1.0]], [0, [1597.8244814328343, 1.0]], [0, [382.85194162528785, 1.0]], [0, [108.12424288958438, 1.0]], [0, [34.85982385647281, 1.0]], [0, [7.462706830627666, 1.0]], [0, [2.994886058977287, 1.0]], [0, [0.8182042785495386, 1.0]], [0, [0.375576662517505, 1.0]], [0, [0.15371214736456826, 1.0]], [1, [1362.7832150444783, 1.0]], [1, [664.7455934302494, 1.0]], [1, [300.96157801775007, 1.0]], [1, [314.04191743781047, 1.0]], [1, [61.62281762031098, 1.0]], [1, [7.3321285881417495, 1.0]], [1, [20.237315114250976, 1.0]], [1, [0.7744495832523719, 1.0]], [1, [2.810848220228133, 1.0]], [1, [0.22262250107536505, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65588165]
bas 1, expnt(s) = [7617.52185795]
bas 2, expnt(s) = [3617.35089486]
bas 3, expnt(s) = [1597.82448143]
bas 4, expnt(s) = [382.85194163]
bas 5, expnt(s) = [108.12424289]
bas 6, expnt(s) = [34.85982386]
bas 7, expnt(s) = [7.46270683]
bas 8, expnt(s) = [2.99488606]
bas 9, expnt(s) = [0.81820428]
bas 10, expnt(s) = [0.37557666]
bas 11, expnt(s) = [0.15371215]
bas 12, expnt(s) = [1362.78321504]
bas 13, expnt(s) = [664.74559343]
bas 14, expnt(s) = [300.96157802]
bas 15, expnt(s) = [314.04191744]
bas 16, expnt(s) = [61.62281762]
bas 17, expnt(s) = [7.33212859]
bas 18, expnt(s) = [20.23731511]
bas 19, expnt(s) = [0.77444958]
bas 20, expnt(s) = [2.81084822]
bas 21, expnt(s) = [0.2226225]
CPU time:        55.00
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752186e+03 2.06003835e+03
 3.61735089e+03 1.17844143e+03 1.59782448e+03 6.38501361e+02
 3.82851942e+02 2.18669476e+02 1.08124243e+02 8.47144185e+01
 3.48598239e+01 3.62459023e+01 7.46270683e+00 1.14074168e+01
 2.99488606e+00 5.75175333e+00 8.18204279e-01 2.17350845e+00
 3.75576663e-01 1.21210146e+00 1.53712147e-01 6.20220571e-01
 1.36278322e+03 2.41556018e+04 6.64745593e+02 9.84699520e+03
 3.00961578e+02 3.65698528e+03 3.14041917e+02 3.85672718e+03
 6.16228176e+01 5.03687685e+02 7.33212859e+00 3.51983239e+01
 2.02373151e+01 1.25220522e+02 7.74449583e-01 2.11946296e+00
 2.81084822e+00 1.06177168e+01 2.22622501e-01 4.46113858e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993916065255064
cond(S) = 106410.48635437754
E1 = -729.5107821630052  E_coul = 203.1686653241863
init E= -526.342116838819
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.555875136976126  LUMO = 0.41199527236656
  mo_energy =
[-1.18328061e+02 -1.22051238e+01 -9.44777145e+00 -9.44777145e+00
 -9.44777145e+00 -1.24030341e+00 -5.55875137e-01 -5.55875137e-01
 -5.55875137e-01  4.11995272e-01  1.03151313e+00  1.03151313e+00
  1.03151313e+00  2.41260947e+00  7.34408017e+00  7.34408017e+00
  7.34408017e+00  1.33834517e+01  3.35181922e+01  3.35181922e+01
  3.35181922e+01  1.03691892e+02  1.29138185e+02  1.29138185e+02
  1.29138185e+02  4.83539977e+02  4.83539977e+02  4.83539977e+02
  5.83750885e+02  1.33543503e+03  1.33543503e+03  1.33543503e+03
  2.65229581e+03  3.02974733e+03  3.02974733e+03  3.02974733e+03
  6.65030370e+03  6.65030370e+03  6.65030370e+03  9.05811893e+03
  2.54139456e+04  7.61565588e+04]
E1 = -727.8100878925659  E_coul = 201.07537374381374
cycle= 1 E= -526.734714148752  delta_E= -0.393  |g|= 0.189  |ddm|= 0.294
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547216
diis-c [-0.29944571  1.        ]
  HOMO = -0.590996940899753  LUMO = 0.402794451644366
  mo_energy =
[-1.18641477e+02 -1.23432848e+01 -9.59758014e+00 -9.59758014e+00
 -9.59758014e+00 -1.27969092e+00 -5.90996941e-01 -5.90996941e-01
 -5.90996941e-01  4.02794452e-01  1.00696802e+00  1.00696802e+00
  1.00696802e+00  2.37448766e+00  7.25279873e+00  7.25279873e+00
  7.25279873e+00  1.32786597e+01  3.33622145e+01  3.33622145e+01
  3.33622145e+01  1.03471272e+02  1.28906159e+02  1.28906159e+02
  1.28906159e+02  4.83228048e+02  4.83228048e+02  4.83228048e+02
  5.83400041e+02  1.33506505e+03  1.33506505e+03  1.33506505e+03
  2.65179029e+03  3.02931060e+03  3.02931060e+03  3.02931060e+03
  6.64975287e+03  6.64975287e+03  6.64975287e+03  9.05749231e+03
  2.54132245e+04  7.61557473e+04]
E1 = -728.3908713742794  E_coul = 201.65541177034137
cycle= 2 E= -526.735459603938  delta_E= -0.000745  |g|= 0.0383  |ddm|= 0.0556
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0767971
diis-c [-0.00331658  0.08539021  0.91460979]
  HOMO = -0.581900300150675  LUMO = 0.405768198692736
  mo_energy =
[-1.18572931e+02 -1.23048928e+01 -9.55751245e+00 -9.55751245e+00
 -9.55751245e+00 -1.26877230e+00 -5.81900300e-01 -5.81900300e-01
 -5.81900300e-01  4.05768199e-01  1.01367057e+00  1.01367057e+00
  1.01367057e+00  2.38501825e+00  7.27667427e+00  7.27667427e+00
  7.27667427e+00  1.33074630e+01  3.34026417e+01  3.34026417e+01
  3.34026417e+01  1.03527204e+02  1.28962699e+02  1.28962699e+02
  1.28962699e+02  4.83295767e+02  4.83295767e+02  4.83295767e+02
  5.83470116e+02  1.33513686e+03  1.33513686e+03  1.33513686e+03
  2.65186543e+03  3.02938467e+03  3.02938467e+03  3.02938467e+03
  6.64982868e+03  6.64982868e+03  6.64982868e+03  9.05756893e+03
  2.54133017e+04  7.61558248e+04]
E1 = -728.2379246747757  E_coul = 201.5024038656916
cycle= 3 E= -526.735520809084  delta_E= -6.12e-05  |g|= 0.00626  |ddm|= 0.0147
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0131899
diis-c [-8.58834573e-07 -1.32812740e-03  1.41618276e-01  8.59709852e-01]
  HOMO = -0.583422260803656  LUMO = 0.405318091280371
  mo_energy =
[-1.18582887e+02 -1.23107221e+01 -9.56369880e+00 -9.56369880e+00
 -9.56369880e+00 -1.27046984e+00 -5.83422261e-01 -5.83422261e-01
 -5.83422261e-01  4.05318091e-01  1.01257445e+00  1.01257445e+00
  1.01257445e+00  2.38335814e+00  7.27286665e+00  7.27286665e+00
  7.27286665e+00  1.33030236e+01  3.33964437e+01  3.33964437e+01
  3.33964437e+01  1.03518989e+02  1.28954339e+02  1.28954339e+02
  1.28954339e+02  4.83285926e+02  4.83285926e+02  4.83285926e+02
  5.83459923e+02  1.33512643e+03  1.33512643e+03  1.33512643e+03
  2.65185436e+03  3.02937385e+03  3.02937385e+03  3.02937385e+03
  6.64981746e+03  6.64981746e+03  6.64981746e+03  9.05755750e+03
  2.54132901e+04  7.61558130e+04]
E1 = -728.2607550415445  E_coul = 201.52523228969295
cycle= 4 E= -526.735522751851  delta_E= -1.94e-06  |g|= 0.000117  |ddm|= 0.00232
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000144933
diis-c [-9.51903478e-09  9.95054294e-05 -1.35855342e-02 -8.72120963e-02
  1.10069813e+00]
  HOMO = -0.583405747409153  LUMO = 0.4053342312647
  mo_energy =
[-1.18582840e+02 -1.23106499e+01 -9.56364175e+00 -9.56364175e+00
 -9.56364175e+00 -1.27042436e+00 -5.83405747e-01 -5.83405747e-01
 -5.83405747e-01  4.05334231e-01  1.01258909e+00  1.01258909e+00
  1.01258909e+00  2.38339388e+00  7.27291092e+00  7.27291092e+00
  7.27291092e+00  1.33030846e+01  3.33964984e+01  3.33964984e+01
  3.33964984e+01  1.03519049e+02  1.28954394e+02  1.28954394e+02
  1.28954394e+02  4.83285974e+02  4.83285974e+02  4.83285974e+02
  5.83459963e+02  1.33512647e+03  1.33512647e+03  1.33512647e+03
  2.65185437e+03  3.02937387e+03  3.02937387e+03  3.02937387e+03
  6.64981747e+03  6.64981747e+03  6.64981747e+03  9.05755750e+03
  2.54132901e+04  7.61558130e+04]
E1 = -728.2604700887888  E_coul = 201.5249473339217
cycle= 5 E= -526.735522754867  delta_E= -3.02e-09  |g|= 2.35e-05  |ddm|= 0.000167
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.29378e-05
diis-c [-1.73035407e-10  1.38833255e-05 -1.58348706e-03 -1.25762975e-02
 -2.15625839e-05  1.01416746e+00]
  HOMO = -0.583415676982593  LUMO = 0.405332519609295
  mo_energy =
[-1.18582877e+02 -1.23106786e+01 -9.56367248e+00 -9.56367248e+00
 -9.56367248e+00 -1.27043233e+00 -5.83415677e-01 -5.83415677e-01
 -5.83415677e-01  4.05332520e-01  1.01258242e+00  1.01258242e+00
  1.01258242e+00  2.38338520e+00  7.27288964e+00  7.27288964e+00
  7.27288964e+00  1.33030618e+01  3.33964686e+01  3.33964686e+01
  3.33964686e+01  1.03519015e+02  1.28954359e+02  1.28954359e+02
  1.28954359e+02  4.83285937e+02  4.83285937e+02  4.83285937e+02
  5.83459925e+02  1.33512643e+03  1.33512643e+03  1.33512643e+03
  2.65185433e+03  3.02937384e+03  3.02937384e+03  3.02937384e+03
  6.64981743e+03  6.64981743e+03  6.64981743e+03  9.05755746e+03
  2.54132900e+04  7.61558130e+04]
E1 = -728.2605677962327  E_coul = 201.52504504127924
cycle= 6 E= -526.735522754954  delta_E= -8.64e-11  |g|= 2.11e-06  |ddm|= 2.47e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2605677962327  E_coul = 201.52504504127924
  HOMO = -0.583415177673085  LUMO = 0.405332833384306
  mo_energy =
[-1.18582874e+02 -1.23106766e+01 -9.56367043e+00 -9.56367043e+00
 -9.56367043e+00 -1.27043139e+00 -5.83415178e-01 -5.83415178e-01
 -5.83415178e-01  4.05332833e-01  1.01258283e+00  1.01258283e+00
  1.01258283e+00  2.38338599e+00  7.27289098e+00  7.27289098e+00
  7.27289098e+00  1.33030634e+01  3.33964706e+01  3.33964706e+01
  3.33964706e+01  1.03519018e+02  1.28954362e+02  1.28954362e+02
  1.28954362e+02  4.83285940e+02  4.83285940e+02  4.83285940e+02
  5.83459928e+02  1.33512644e+03  1.33512644e+03  1.33512644e+03
  2.65185434e+03  3.02937384e+03  3.02937384e+03  3.02937384e+03
  6.64981744e+03  6.64981744e+03  6.64981744e+03  9.05755746e+03
  2.54132900e+04  7.61558130e+04]
E1 = -728.2605592395169  E_coul = 201.52503648456337
Extra cycle  E= -526.735522754954  delta_E=    0  |g|= 5.49e-07  |ddm|= 2.46e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826559e+04 7.61752186e+03 3.61735089e+03 1.59782448e+03
 3.82851942e+02 1.08124243e+02 3.48598239e+01 7.46270683e+00
 2.99488606e+00 8.18204279e-01 3.75576663e-01 1.53712147e-01
 1.36278322e+03 6.64745593e+02 3.00961578e+02 3.14041917e+02
 6.16228176e+01 7.33212859e+00 2.02373151e+01 7.74449583e-01
 2.81084822e+00 2.22622501e-01]
E = -526.7355227549535
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:01 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6558816        1
[INPUT] 0    0    [1    /1   ]  7617.52185795        1
[INPUT] 0    0    [1    /1   ]  3617.35089486        1
[INPUT] 0    0    [1    /1   ]  1597.82448143        1
[INPUT] 0    0    [1    /1   ]  382.851941625        1
[INPUT] 0    0    [1    /1   ]  108.12424289         1
[INPUT] 0    0    [1    /1   ]  34.8598238565        1
[INPUT] 0    0    [1    /1   ]  7.46270683063        1
[INPUT] 0    0    [1    /1   ]  2.99488605898        1
[INPUT] 0    0    [1    /1   ]  0.81820427855        1
[INPUT] 0    0    [1    /1   ]  0.375576662518       1
[INPUT] 0    0    [1    /1   ]  0.153712147365       1
[INPUT] 1    0    [1    /1   ]  1362.78321504        1
[INPUT] 1    0    [1    /1   ]  664.74559343         1
[INPUT] 1    0    [1    /1   ]  300.961578018        1
[INPUT] 1    0    [1    /1   ]  314.041917438        1
[INPUT] 1    0    [1    /1   ]  61.6228176203        1
[INPUT] 1    0    [1    /1   ]  7.33212858814        1
[INPUT] 1    0    [1    /1   ]  20.2373151143        1
[INPUT] 1    0    [1    /1   ]  0.774449583252       1
[INPUT] 1    0    [1    /1   ]  2.81084822023        1
[INPUT] 1    0    [1    /1   ]  0.222622501075       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.655881649534, 1.0]], [0, [7617.521857952557, 1.0]], [0, [3617.3508948629524, 1.0]], [0, [1597.8244814328343, 1.0]], [0, [382.85194162528785, 1.0]], [0, [108.12424288958438, 1.0]], [0, [34.85982385647281, 1.0]], [0, [7.462706830627666, 1.0]], [0, [2.994886058977287, 1.0]], [0, [0.8182042785495386, 1.0]], [0, [0.375576662517505, 1.0]], [0, [0.15371214736456826, 1.0]], [1, [1362.7832150444783, 1.0]], [1, [664.7455934302494, 1.0]], [1, [300.96157801775007, 1.0]], [1, [314.04191743781047, 1.0]], [1, [61.62281762031098, 1.0]], [1, [7.3321285881417495, 1.0]], [1, [20.237315114250976, 1.0]], [1, [0.7744495832523719, 1.0]], [1, [2.810848220228133, 1.0]], [1, [0.22262250107536505, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65588165]
bas 1, expnt(s) = [7617.52185795]
bas 2, expnt(s) = [3617.35089486]
bas 3, expnt(s) = [1597.82448143]
bas 4, expnt(s) = [382.85194163]
bas 5, expnt(s) = [108.12424289]
bas 6, expnt(s) = [34.85982386]
bas 7, expnt(s) = [7.46270683]
bas 8, expnt(s) = [2.99488606]
bas 9, expnt(s) = [0.81820428]
bas 10, expnt(s) = [0.37557666]
bas 11, expnt(s) = [0.15371215]
bas 12, expnt(s) = [1362.78321504]
bas 13, expnt(s) = [664.74559343]
bas 14, expnt(s) = [300.96157802]
bas 15, expnt(s) = [314.04191744]
bas 16, expnt(s) = [61.62281762]
bas 17, expnt(s) = [7.33212859]
bas 18, expnt(s) = [20.23731511]
bas 19, expnt(s) = [0.77444958]
bas 20, expnt(s) = [2.81084822]
bas 21, expnt(s) = [0.2226225]
CPU time:        55.34
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752186e+03 2.06003835e+03
 3.61735089e+03 1.17844143e+03 1.59782448e+03 6.38501361e+02
 3.82851942e+02 2.18669476e+02 1.08124243e+02 8.47144185e+01
 3.48598239e+01 3.62459023e+01 7.46270683e+00 1.14074168e+01
 2.99488606e+00 5.75175333e+00 8.18204279e-01 2.17350845e+00
 3.75576663e-01 1.21210146e+00 1.53712147e-01 6.20220571e-01
 1.36278322e+03 2.41556018e+04 6.64745593e+02 9.84699520e+03
 3.00961578e+02 3.65698528e+03 3.14041917e+02 3.85672718e+03
 6.16228176e+01 5.03687685e+02 7.33212859e+00 3.51983239e+01
 2.02373151e+01 1.25220522e+02 7.74449583e-01 2.11946296e+00
 2.81084822e+00 1.06177168e+01 2.22622501e-01 4.46113858e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993916065255064
cond(S) = 106410.48635437754
E1 = -729.5107821630052  E_coul = 203.1686653241863
init E= -526.342116838819
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555875136976126  LUMO = 0.41199527236656
  mo_energy =
[-1.18328061e+02 -1.22051238e+01 -9.44777145e+00 -9.44777145e+00
 -9.44777145e+00 -1.24030341e+00 -5.55875137e-01 -5.55875137e-01
 -5.55875137e-01  4.11995272e-01  1.03151313e+00  1.03151313e+00
  1.03151313e+00  2.41260947e+00  7.34408017e+00  7.34408017e+00
  7.34408017e+00  1.33834517e+01  3.35181922e+01  3.35181922e+01
  3.35181922e+01  1.03691892e+02  1.29138185e+02  1.29138185e+02
  1.29138185e+02  4.83539977e+02  4.83539977e+02  4.83539977e+02
  5.83750885e+02  1.33543503e+03  1.33543503e+03  1.33543503e+03
  2.65229581e+03  3.02974733e+03  3.02974733e+03  3.02974733e+03
  6.65030370e+03  6.65030370e+03  6.65030370e+03  9.05811893e+03
  2.54139456e+04  7.61565588e+04]
E1 = -727.8100878925659  E_coul = 201.07537374381374
cycle= 1 E= -526.734714148752  delta_E= -0.393  |g|= 0.189  |ddm|= 0.294
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547216
diis-c [-0.29944571  1.        ]
  HOMO = -0.590996940899753  LUMO = 0.402794451644366
  mo_energy =
[-1.18641477e+02 -1.23432848e+01 -9.59758014e+00 -9.59758014e+00
 -9.59758014e+00 -1.27969092e+00 -5.90996941e-01 -5.90996941e-01
 -5.90996941e-01  4.02794452e-01  1.00696802e+00  1.00696802e+00
  1.00696802e+00  2.37448766e+00  7.25279873e+00  7.25279873e+00
  7.25279873e+00  1.32786597e+01  3.33622145e+01  3.33622145e+01
  3.33622145e+01  1.03471272e+02  1.28906159e+02  1.28906159e+02
  1.28906159e+02  4.83228048e+02  4.83228048e+02  4.83228048e+02
  5.83400041e+02  1.33506505e+03  1.33506505e+03  1.33506505e+03
  2.65179029e+03  3.02931060e+03  3.02931060e+03  3.02931060e+03
  6.64975287e+03  6.64975287e+03  6.64975287e+03  9.05749231e+03
  2.54132245e+04  7.61557473e+04]
E1 = -728.3908713742794  E_coul = 201.65541177034137
cycle= 2 E= -526.735459603938  delta_E= -0.000745  |g|= 0.0383  |ddm|= 0.0556
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0767971
diis-c [-0.00331658  0.08539021  0.91460979]
  HOMO = -0.581900300150675  LUMO = 0.405768198692736
  mo_energy =
[-1.18572931e+02 -1.23048928e+01 -9.55751245e+00 -9.55751245e+00
 -9.55751245e+00 -1.26877230e+00 -5.81900300e-01 -5.81900300e-01
 -5.81900300e-01  4.05768199e-01  1.01367057e+00  1.01367057e+00
  1.01367057e+00  2.38501825e+00  7.27667427e+00  7.27667427e+00
  7.27667427e+00  1.33074630e+01  3.34026417e+01  3.34026417e+01
  3.34026417e+01  1.03527204e+02  1.28962699e+02  1.28962699e+02
  1.28962699e+02  4.83295767e+02  4.83295767e+02  4.83295767e+02
  5.83470116e+02  1.33513686e+03  1.33513686e+03  1.33513686e+03
  2.65186543e+03  3.02938467e+03  3.02938467e+03  3.02938467e+03
  6.64982868e+03  6.64982868e+03  6.64982868e+03  9.05756893e+03
  2.54133017e+04  7.61558248e+04]
E1 = -728.2379246747757  E_coul = 201.5024038656916
cycle= 3 E= -526.735520809084  delta_E= -6.12e-05  |g|= 0.00626  |ddm|= 0.0147
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0131899
diis-c [-8.58834573e-07 -1.32812740e-03  1.41618276e-01  8.59709852e-01]
  HOMO = -0.583422260803656  LUMO = 0.405318091280371
  mo_energy =
[-1.18582887e+02 -1.23107221e+01 -9.56369880e+00 -9.56369880e+00
 -9.56369880e+00 -1.27046984e+00 -5.83422261e-01 -5.83422261e-01
 -5.83422261e-01  4.05318091e-01  1.01257445e+00  1.01257445e+00
  1.01257445e+00  2.38335814e+00  7.27286665e+00  7.27286665e+00
  7.27286665e+00  1.33030236e+01  3.33964437e+01  3.33964437e+01
  3.33964437e+01  1.03518989e+02  1.28954339e+02  1.28954339e+02
  1.28954339e+02  4.83285926e+02  4.83285926e+02  4.83285926e+02
  5.83459923e+02  1.33512643e+03  1.33512643e+03  1.33512643e+03
  2.65185436e+03  3.02937385e+03  3.02937385e+03  3.02937385e+03
  6.64981746e+03  6.64981746e+03  6.64981746e+03  9.05755750e+03
  2.54132901e+04  7.61558130e+04]
E1 = -728.2607550415445  E_coul = 201.52523228969295
cycle= 4 E= -526.735522751851  delta_E= -1.94e-06  |g|= 0.000117  |ddm|= 0.00232
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000144933
diis-c [-9.51903478e-09  9.95054294e-05 -1.35855342e-02 -8.72120963e-02
  1.10069813e+00]
  HOMO = -0.583405747409153  LUMO = 0.4053342312647
  mo_energy =
[-1.18582840e+02 -1.23106499e+01 -9.56364175e+00 -9.56364175e+00
 -9.56364175e+00 -1.27042436e+00 -5.83405747e-01 -5.83405747e-01
 -5.83405747e-01  4.05334231e-01  1.01258909e+00  1.01258909e+00
  1.01258909e+00  2.38339388e+00  7.27291092e+00  7.27291092e+00
  7.27291092e+00  1.33030846e+01  3.33964984e+01  3.33964984e+01
  3.33964984e+01  1.03519049e+02  1.28954394e+02  1.28954394e+02
  1.28954394e+02  4.83285974e+02  4.83285974e+02  4.83285974e+02
  5.83459963e+02  1.33512647e+03  1.33512647e+03  1.33512647e+03
  2.65185437e+03  3.02937387e+03  3.02937387e+03  3.02937387e+03
  6.64981747e+03  6.64981747e+03  6.64981747e+03  9.05755750e+03
  2.54132901e+04  7.61558130e+04]
E1 = -728.2604700887888  E_coul = 201.5249473339217
cycle= 5 E= -526.735522754867  delta_E= -3.02e-09  |g|= 2.35e-05  |ddm|= 0.000167
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.29378e-05
diis-c [-1.73035407e-10  1.38833255e-05 -1.58348706e-03 -1.25762975e-02
 -2.15625839e-05  1.01416746e+00]
  HOMO = -0.583415676982593  LUMO = 0.405332519609295
  mo_energy =
[-1.18582877e+02 -1.23106786e+01 -9.56367248e+00 -9.56367248e+00
 -9.56367248e+00 -1.27043233e+00 -5.83415677e-01 -5.83415677e-01
 -5.83415677e-01  4.05332520e-01  1.01258242e+00  1.01258242e+00
  1.01258242e+00  2.38338520e+00  7.27288964e+00  7.27288964e+00
  7.27288964e+00  1.33030618e+01  3.33964686e+01  3.33964686e+01
  3.33964686e+01  1.03519015e+02  1.28954359e+02  1.28954359e+02
  1.28954359e+02  4.83285937e+02  4.83285937e+02  4.83285937e+02
  5.83459925e+02  1.33512643e+03  1.33512643e+03  1.33512643e+03
  2.65185433e+03  3.02937384e+03  3.02937384e+03  3.02937384e+03
  6.64981743e+03  6.64981743e+03  6.64981743e+03  9.05755746e+03
  2.54132900e+04  7.61558130e+04]
E1 = -728.2605677962327  E_coul = 201.52504504127924
cycle= 6 E= -526.735522754954  delta_E= -8.64e-11  |g|= 2.11e-06  |ddm|= 2.47e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2605677962327  E_coul = 201.52504504127924
  HOMO = -0.583415177673085  LUMO = 0.405332833384306
  mo_energy =
[-1.18582874e+02 -1.23106766e+01 -9.56367043e+00 -9.56367043e+00
 -9.56367043e+00 -1.27043139e+00 -5.83415178e-01 -5.83415178e-01
 -5.83415178e-01  4.05332833e-01  1.01258283e+00  1.01258283e+00
  1.01258283e+00  2.38338599e+00  7.27289098e+00  7.27289098e+00
  7.27289098e+00  1.33030634e+01  3.33964706e+01  3.33964706e+01
  3.33964706e+01  1.03519018e+02  1.28954362e+02  1.28954362e+02
  1.28954362e+02  4.83285940e+02  4.83285940e+02  4.83285940e+02
  5.83459928e+02  1.33512644e+03  1.33512644e+03  1.33512644e+03
  2.65185434e+03  3.02937384e+03  3.02937384e+03  3.02937384e+03
  6.64981744e+03  6.64981744e+03  6.64981744e+03  9.05755746e+03
  2.54132900e+04  7.61558130e+04]
E1 = -728.2605592395169  E_coul = 201.52503648456337
Extra cycle  E= -526.735522754954  delta_E=    0  |g|= 5.49e-07  |ddm|= 2.46e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 106410.48635437754
E1 = -728.2605592395169  E_coul = 201.52503648456337
init E= -526.735522754954
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583415364371543  LUMO = 0.405332806923491
  mo_energy =
[-1.18582875e+02 -1.23106772e+01 -9.56367109e+00 -9.56367109e+00
 -9.56367109e+00 -1.27043153e+00 -5.83415364e-01 -5.83415364e-01
 -5.83415364e-01  4.05332807e-01  1.01258270e+00  1.01258270e+00
  1.01258270e+00  2.38338583e+00  7.27289056e+00  7.27289056e+00
  7.27289056e+00  1.33030629e+01  3.33964700e+01  3.33964700e+01
  3.33964700e+01  1.03519017e+02  1.28954361e+02  1.28954361e+02
  1.28954361e+02  4.83285939e+02  4.83285939e+02  4.83285939e+02
  5.83459927e+02  1.33512643e+03  1.33512643e+03  1.33512643e+03
  2.65185434e+03  3.02937384e+03  3.02937384e+03  3.02937384e+03
  6.64981744e+03  6.64981744e+03  6.64981744e+03  9.05755746e+03
  2.54132900e+04  7.61558130e+04]
E1 = -728.2605614267443  E_coul = 201.52503867178996
cycle= 1 E= -526.735522754954  delta_E= -7.96e-13  |g|= 1.55e-07  |ddm|= 5.3e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2605614267443  E_coul = 201.52503867178996
  HOMO = -0.583415327599208  LUMO = 0.405332825497642
  mo_energy =
[-1.18582875e+02 -1.23106770e+01 -9.56367093e+00 -9.56367093e+00
 -9.56367093e+00 -1.27043147e+00 -5.83415328e-01 -5.83415328e-01
 -5.83415328e-01  4.05332825e-01  1.01258273e+00  1.01258273e+00
  1.01258273e+00  2.38338589e+00  7.27289066e+00  7.27289066e+00
  7.27289066e+00  1.33030630e+01  3.33964701e+01  3.33964701e+01
  3.33964701e+01  1.03519017e+02  1.28954361e+02  1.28954361e+02
  1.28954361e+02  4.83285939e+02  4.83285939e+02  4.83285939e+02
  5.83459927e+02  1.33512643e+03  1.33512643e+03  1.33512643e+03
  2.65185434e+03  3.02937384e+03  3.02937384e+03  3.02937384e+03
  6.64981744e+03  6.64981744e+03  6.64981744e+03  9.05755746e+03
  2.54132900e+04  7.61558130e+04]
E1 = -728.2605607568427  E_coul = 201.52503800188833
Extra cycle  E= -526.735522754954  delta_E=    0  |g|= 4.13e-08  |ddm|= 1.23e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826559e+04 7.61752186e+03 3.61735089e+03 1.59782448e+03
 3.82851942e+02 1.08124243e+02 3.48598239e+01 7.46270683e+00
 2.99488606e+00 8.18204279e-01 3.75576663e-01 1.53712147e-01
 1.36278322e+03 6.64745593e+02 3.00961578e+02 3.14041917e+02
 6.16228176e+01 7.33212859e+00 2.02373151e+01 7.74449583e-01
 2.81084822e+00 2.22622501e-01]
grad_E = [-1.51867292e-06  3.32437263e-06 -1.57014756e-06  6.99879884e-05
 -5.65366090e-05 -4.14854888e-06 -4.11027343e-03 -4.10397936e-03
  4.95310236e-04 -1.05980906e-03  4.65578354e-04 -3.96424243e-03
 -5.05675985e-07  5.02411899e-06  2.37152945e-05  2.04471196e-05
 -2.58778259e-05 -2.33922531e-05  5.21473316e-05 -2.88592573e-03
 -3.56608192e-05  1.00936148e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:05 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6559043        1
[INPUT] 0    0    [1    /1   ]  7617.52180841        1
[INPUT] 0    0    [1    /1   ]  3617.35091827        1
[INPUT] 0    0    [1    /1   ]  1597.82343821        1
[INPUT] 0    0    [1    /1   ]  382.852790286        1
[INPUT] 0    0    [1    /1   ]  108.124438695        1
[INPUT] 0    0    [1    /1   ]  34.9195119677        1
[INPUT] 0    0    [1    /1   ]  7.50078006173        1
[INPUT] 0    0    [1    /1   ]  3.03578917247        1
[INPUT] 0    0    [1    /1   ]  0.820046270694       1
[INPUT] 0    0    [1    /1   ]  0.407895261527       1
[INPUT] 0    0    [1    /1   ]  0.163687209503       1
[INPUT] 1    0    [1    /1   ]  1362.78322258        1
[INPUT] 1    0    [1    /1   ]  664.745518525        1
[INPUT] 1    0    [1    /1   ]  300.961224395        1
[INPUT] 1    0    [1    /1   ]  314.041612549        1
[INPUT] 1    0    [1    /1   ]  61.6232288033        1
[INPUT] 1    0    [1    /1   ]  7.33303782008        1
[INPUT] 1    0    [1    /1   ]  20.2363659572        1
[INPUT] 1    0    [1    /1   ]  0.774139317296       1
[INPUT] 1    0    [1    /1   ]  2.8122882663         1
[INPUT] 1    0    [1    /1   ]  0.224035829856       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65590428248, 1.0]], [0, [7617.52180840521, 1.0]], [0, [3617.3509182670473, 1.0]], [0, [1597.8234382149726, 1.0]], [0, [382.852790285673, 1.0]], [0, [108.12443869472061, 1.0]], [0, [34.9195119676645, 1.0]], [0, [7.500780061728103, 1.0]], [0, [3.035789172471647, 1.0]], [0, [0.82004627069426, 1.0]], [0, [0.4078952615267851, 1.0]], [0, [0.16368720950278437, 1.0]], [1, [1362.7832225777922, 1.0]], [1, [664.7455185247351, 1.0]], [1, [300.96122439493206, 1.0]], [1, [314.0416125485349, 1.0]], [1, [61.62322880328173, 1.0]], [1, [7.333037820083493, 1.0]], [1, [20.23636595723334, 1.0]], [1, [0.7741393172958722, 1.0]], [1, [2.812288266302765, 1.0]], [1, [0.22403582985595694, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65590428]
bas 1, expnt(s) = [7617.52180841]
bas 2, expnt(s) = [3617.35091827]
bas 3, expnt(s) = [1597.82343821]
bas 4, expnt(s) = [382.85279029]
bas 5, expnt(s) = [108.12443869]
bas 6, expnt(s) = [34.91951197]
bas 7, expnt(s) = [7.50078006]
bas 8, expnt(s) = [3.03578917]
bas 9, expnt(s) = [0.82004627]
bas 10, expnt(s) = [0.40789526]
bas 11, expnt(s) = [0.16368721]
bas 12, expnt(s) = [1362.78322258]
bas 13, expnt(s) = [664.74551852]
bas 14, expnt(s) = [300.96122439]
bas 15, expnt(s) = [314.04161255]
bas 16, expnt(s) = [61.6232288]
bas 17, expnt(s) = [7.33303782]
bas 18, expnt(s) = [20.23636596]
bas 19, expnt(s) = [0.77413932]
bas 20, expnt(s) = [2.81228827]
bas 21, expnt(s) = [0.22403583]
CPU time:        61.04
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752181e+03 2.06003834e+03
 3.61735092e+03 1.17844144e+03 1.59782344e+03 6.38501049e+02
 3.82852790e+02 2.18669840e+02 1.08124439e+02 8.47145335e+01
 3.49195120e+01 3.62924384e+01 7.50078006e+00 1.14510378e+01
 3.03578917e+00 5.81056990e+00 8.20046271e-01 2.17717728e+00
 4.07895262e-01 1.28951536e+00 1.63687210e-01 6.50168737e-01
 1.36278322e+03 2.41556020e+04 6.64745519e+02 9.84699382e+03
 3.00961224e+02 3.65697990e+03 3.14041613e+02 3.85672249e+03
 6.16232288e+01 5.03691886e+02 7.33303782e+00 3.52037800e+01
 2.02363660e+01 1.25213181e+02 7.74139317e-01 2.11840162e+00
 2.81228827e+00 1.06245168e+01 2.24035830e-01 4.49656880e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993773050519508
cond(S) = 106857.67494049705
E1 = -729.5095773219266  E_coul = 203.16755605753247
init E= -526.342021264394
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.555808459874393  LUMO = 0.452052970996078
  mo_energy =
[-1.18328299e+02 -1.22053731e+01 -9.44791787e+00 -9.44791787e+00
 -9.44791787e+00 -1.24026181e+00 -5.55808460e-01 -5.55808460e-01
 -5.55808460e-01  4.52052971e-01  1.03680976e+00  1.03680976e+00
  1.03680976e+00  2.56985275e+00  7.35101611e+00  7.35101611e+00
  7.35101611e+00  1.37428676e+01  3.35277164e+01  3.35277164e+01
  3.35277164e+01  1.04321602e+02  1.29145963e+02  1.29145963e+02
  1.29145963e+02  4.83545769e+02  4.83545769e+02  4.83545769e+02
  5.84421836e+02  1.33543944e+03  1.33543944e+03  1.33543944e+03
  2.65290145e+03  3.02975046e+03  3.02975046e+03  3.02975046e+03
  6.65030579e+03  6.65030579e+03  6.65030579e+03  9.05867549e+03
  2.54144717e+04  7.61570484e+04]
E1 = -727.8356779181064  E_coul = 201.10062488973043
cycle= 1 E= -526.735053028376  delta_E= -0.393  |g|= 0.188  |ddm|= 0.309
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.546628
diis-c [-0.29880246  1.        ]
  HOMO = -0.590030979893723  LUMO = 0.442262007383055
  mo_energy =
[-1.18639671e+02 -1.23417376e+01 -9.59588630e+00 -9.59588630e+00
 -9.59588630e+00 -1.27855492e+00 -5.90030980e-01 -5.90030980e-01
 -5.90030980e-01  4.42262007e-01  1.01286473e+00  1.01286473e+00
  1.01286473e+00  2.53153816e+00  7.26138245e+00  7.26138245e+00
  7.26138245e+00  1.36392313e+01  3.33735698e+01  3.33735698e+01
  3.33735698e+01  1.04102863e+02  1.28915905e+02  1.28915905e+02
  1.28915905e+02  4.83235886e+02  4.83235886e+02  4.83235886e+02
  5.84073092e+02  1.33507156e+03  1.33507156e+03  1.33507156e+03
  2.65239801e+03  3.02931582e+03  3.02931582e+03  3.02931582e+03
  6.64975704e+03  6.64975704e+03  6.64975704e+03  9.05805095e+03
  2.54137526e+04  7.61562390e+04]
E1 = -728.4074527827204  E_coul = 201.67167005936722
cycle= 2 E= -526.735782723353  delta_E= -0.00073  |g|= 0.0379  |ddm|= 0.0562
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0760116
diis-c [-0.00326588  0.08441007  0.91558993]
  HOMO = -0.581110699334791  LUMO = 0.445453057586622
  mo_energy =
[-1.18571889e+02 -1.23039182e+01 -9.55640872e+00 -9.55640872e+00
 -9.55640872e+00 -1.26783646e+00 -5.81110699e-01 -5.81110699e-01
 -5.81110699e-01  4.45453058e-01  1.01945464e+00  1.01945464e+00
  1.01945464e+00  2.54218495e+00  7.28486087e+00  7.28486087e+00
  7.28486087e+00  1.36677179e+01  3.34134198e+01  3.34134198e+01
  3.34134198e+01  1.04158117e+02  1.28971754e+02  1.28971754e+02
  1.28971754e+02  4.83302849e+02  4.83302849e+02  4.83302849e+02
  5.84142394e+02  1.33514260e+03  1.33514260e+03  1.33514260e+03
  2.65247235e+03  3.02938909e+03  3.02938909e+03  3.02938909e+03
  6.64983205e+03  6.64983205e+03  6.64983205e+03  9.05812676e+03
  2.54138290e+04  7.61563157e+04]
E1 = -728.2571295021215  E_coul = 201.52128747712302
cycle= 3 E= -526.735842024999  delta_E= -5.93e-05  |g|= 0.0062  |ddm|= 0.0144
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0130688
diis-c [-8.66150160e-07 -1.32309135e-03  1.41729785e-01  8.59593307e-01]
  HOMO = -0.582611915348231  LUMO = 0.44497016792205
  mo_energy =
[-1.18581748e+02 -1.23096797e+01 -9.56252497e+00 -9.56252497e+00
 -9.56252497e+00 -1.26950529e+00 -5.82611915e-01 -5.82611915e-01
 -5.82611915e-01  4.44970168e-01  1.01837186e+00  1.01837186e+00
  1.01837186e+00  2.54049934e+00  7.28110198e+00  7.28110198e+00
  7.28110198e+00  1.36633127e+01  3.34072915e+01  3.34072915e+01
  3.34072915e+01  1.04149986e+02  1.28963480e+02  1.28963480e+02
  1.28963480e+02  4.83293104e+02  4.83293104e+02  4.83293104e+02
  5.84132299e+02  1.33513226e+03  1.33513226e+03  1.33513226e+03
  2.65246138e+03  3.02937837e+03  3.02937837e+03  3.02937837e+03
  6.64982093e+03  6.64982093e+03  6.64982093e+03  9.05811543e+03
  2.54138175e+04  7.61563040e+04]
E1 = -728.2795998339235  E_coul = 201.54375591764378
cycle= 4 E= -526.73584391628  delta_E= -1.89e-06  |g|= 0.000121  |ddm|= 0.00231
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000146771
diis-c [-9.64290909e-09  1.02499403e-04 -1.39603448e-02 -8.94770445e-02
  1.10333489e+00]
  HOMO = -0.582595629763739  LUMO = 0.444988123742629
  mo_energy =
[-1.18581699e+02 -1.23096069e+01 -9.56246743e+00 -9.56246743e+00
 -9.56246743e+00 -1.26945881e+00 -5.82595630e-01 -5.82595630e-01
 -5.82595630e-01  4.44988124e-01  1.01838653e+00  1.01838653e+00
  1.01838653e+00  2.54053596e+00  7.28114653e+00  7.28114653e+00
  7.28114653e+00  1.36633744e+01  3.34073468e+01  3.34073468e+01
  3.34073468e+01  1.04150047e+02  1.28963536e+02  1.28963536e+02
  1.28963536e+02  4.83293153e+02  4.83293153e+02  4.83293153e+02
  5.84132340e+02  1.33513230e+03  1.33513230e+03  1.33513230e+03
  2.65246140e+03  3.02937840e+03  3.02937840e+03  3.02937840e+03
  6.64982094e+03  6.64982094e+03  6.64982094e+03  9.05811543e+03
  2.54138175e+04  7.61563040e+04]
E1 = -728.2793100271185  E_coul = 201.54346610754416
cycle= 5 E= -526.735843919574  delta_E= -3.29e-09  |g|= 2.39e-05  |ddm|= 0.000178
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.36093e-05
diis-c [-1.75310464e-10  1.43588661e-05 -1.64442519e-03 -1.30131975e-02
  1.23356551e-03  1.01340970e+00]
  HOMO = -0.582605706277861  LUMO = 0.444986238577411
  mo_energy =
[-1.18581737e+02 -1.23096359e+01 -9.56249858e+00 -9.56249858e+00
 -9.56249858e+00 -1.26946682e+00 -5.82605706e-01 -5.82605706e-01
 -5.82605706e-01  4.44986239e-01  1.01837977e+00  1.01837977e+00
  1.01837977e+00  2.54052686e+00  7.28112496e+00  7.28112496e+00
  7.28112496e+00  1.36633511e+01  3.34073166e+01  3.34073166e+01
  3.34073166e+01  1.04150013e+02  1.28963501e+02  1.28963501e+02
  1.28963501e+02  4.83293115e+02  4.83293115e+02  4.83293115e+02
  5.84132302e+02  1.33513227e+03  1.33513227e+03  1.33513227e+03
  2.65246136e+03  3.02937836e+03  3.02937836e+03  3.02937836e+03
  6.64982090e+03  6.64982090e+03  6.64982090e+03  9.05811539e+03
  2.54138174e+04  7.61563040e+04]
E1 = -728.27940843919  E_coul = 201.5435645195252
cycle= 6 E= -526.735843919665  delta_E= -9.05e-11  |g|= 2.09e-06  |ddm|= 2.58e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.27940843919  E_coul = 201.5435645195252
  HOMO = -0.582605216489937  LUMO = 0.44498657408357
  mo_energy =
[-1.18581735e+02 -1.23096339e+01 -9.56249657e+00 -9.56249657e+00
 -9.56249657e+00 -1.26946589e+00 -5.82605216e-01 -5.82605216e-01
 -5.82605216e-01  4.44986574e-01  1.01838016e+00  1.01838016e+00
  1.01838016e+00  2.54052765e+00  7.28112628e+00  7.28112628e+00
  7.28112628e+00  1.36633527e+01  3.34073186e+01  3.34073186e+01
  3.34073186e+01  1.04150015e+02  1.28963503e+02  1.28963503e+02
  1.28963503e+02  4.83293118e+02  4.83293118e+02  4.83293118e+02
  5.84132305e+02  1.33513227e+03  1.33513227e+03  1.33513227e+03
  2.65246136e+03  3.02937837e+03  3.02937837e+03  3.02937837e+03
  6.64982091e+03  6.64982091e+03  6.64982091e+03  9.05811540e+03
  2.54138175e+04  7.61563040e+04]
E1 = -728.2794000672669  E_coul = 201.54355614760087
Extra cycle  E= -526.735843919666  delta_E= -1.25e-12  |g|= 5.41e-07  |ddm|= 2.4e-06
    CPU time for scf_cycle      0.30 sec, wall time      0.27 sec
exp = [2.61826559e+04 7.61752181e+03 3.61735092e+03 1.59782344e+03
 3.82852790e+02 1.08124439e+02 3.49195120e+01 7.50078006e+00
 3.03578917e+00 8.20046271e-01 4.07895262e-01 1.63687210e-01
 1.36278322e+03 6.64745519e+02 3.00961224e+02 3.14041613e+02
 6.16232288e+01 7.33303782e+00 2.02363660e+01 7.74139317e-01
 2.81228827e+00 2.24035830e-01]
E = -526.7358439196661
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:05 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6559043        1
[INPUT] 0    0    [1    /1   ]  7617.52180841        1
[INPUT] 0    0    [1    /1   ]  3617.35091827        1
[INPUT] 0    0    [1    /1   ]  1597.82343821        1
[INPUT] 0    0    [1    /1   ]  382.852790286        1
[INPUT] 0    0    [1    /1   ]  108.124438695        1
[INPUT] 0    0    [1    /1   ]  34.9195119677        1
[INPUT] 0    0    [1    /1   ]  7.50078006173        1
[INPUT] 0    0    [1    /1   ]  3.03578917247        1
[INPUT] 0    0    [1    /1   ]  0.820046270694       1
[INPUT] 0    0    [1    /1   ]  0.407895261527       1
[INPUT] 0    0    [1    /1   ]  0.163687209503       1
[INPUT] 1    0    [1    /1   ]  1362.78322258        1
[INPUT] 1    0    [1    /1   ]  664.745518525        1
[INPUT] 1    0    [1    /1   ]  300.961224395        1
[INPUT] 1    0    [1    /1   ]  314.041612549        1
[INPUT] 1    0    [1    /1   ]  61.6232288033        1
[INPUT] 1    0    [1    /1   ]  7.33303782008        1
[INPUT] 1    0    [1    /1   ]  20.2363659572        1
[INPUT] 1    0    [1    /1   ]  0.774139317296       1
[INPUT] 1    0    [1    /1   ]  2.8122882663         1
[INPUT] 1    0    [1    /1   ]  0.224035829856       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65590428248, 1.0]], [0, [7617.52180840521, 1.0]], [0, [3617.3509182670473, 1.0]], [0, [1597.8234382149726, 1.0]], [0, [382.852790285673, 1.0]], [0, [108.12443869472061, 1.0]], [0, [34.9195119676645, 1.0]], [0, [7.500780061728103, 1.0]], [0, [3.035789172471647, 1.0]], [0, [0.82004627069426, 1.0]], [0, [0.4078952615267851, 1.0]], [0, [0.16368720950278437, 1.0]], [1, [1362.7832225777922, 1.0]], [1, [664.7455185247351, 1.0]], [1, [300.96122439493206, 1.0]], [1, [314.0416125485349, 1.0]], [1, [61.62322880328173, 1.0]], [1, [7.333037820083493, 1.0]], [1, [20.23636595723334, 1.0]], [1, [0.7741393172958722, 1.0]], [1, [2.812288266302765, 1.0]], [1, [0.22403582985595694, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65590428]
bas 1, expnt(s) = [7617.52180841]
bas 2, expnt(s) = [3617.35091827]
bas 3, expnt(s) = [1597.82343821]
bas 4, expnt(s) = [382.85279029]
bas 5, expnt(s) = [108.12443869]
bas 6, expnt(s) = [34.91951197]
bas 7, expnt(s) = [7.50078006]
bas 8, expnt(s) = [3.03578917]
bas 9, expnt(s) = [0.82004627]
bas 10, expnt(s) = [0.40789526]
bas 11, expnt(s) = [0.16368721]
bas 12, expnt(s) = [1362.78322258]
bas 13, expnt(s) = [664.74551852]
bas 14, expnt(s) = [300.96122439]
bas 15, expnt(s) = [314.04161255]
bas 16, expnt(s) = [61.6232288]
bas 17, expnt(s) = [7.33303782]
bas 18, expnt(s) = [20.23636596]
bas 19, expnt(s) = [0.77413932]
bas 20, expnt(s) = [2.81228827]
bas 21, expnt(s) = [0.22403583]
CPU time:        61.39
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826559e+04 5.20026287e+03 7.61752181e+03 2.06003834e+03
 3.61735092e+03 1.17844144e+03 1.59782344e+03 6.38501049e+02
 3.82852790e+02 2.18669840e+02 1.08124439e+02 8.47145335e+01
 3.49195120e+01 3.62924384e+01 7.50078006e+00 1.14510378e+01
 3.03578917e+00 5.81056990e+00 8.20046271e-01 2.17717728e+00
 4.07895262e-01 1.28951536e+00 1.63687210e-01 6.50168737e-01
 1.36278322e+03 2.41556020e+04 6.64745519e+02 9.84699382e+03
 3.00961224e+02 3.65697990e+03 3.14041613e+02 3.85672249e+03
 6.16232288e+01 5.03691886e+02 7.33303782e+00 3.52037800e+01
 2.02363660e+01 1.25213181e+02 7.74139317e-01 2.11840162e+00
 2.81228827e+00 1.06245168e+01 2.24035830e-01 4.49656880e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993773050519508
cond(S) = 106857.67494049705
E1 = -729.5095773219266  E_coul = 203.16755605753247
init E= -526.342021264394
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555808459874393  LUMO = 0.452052970996078
  mo_energy =
[-1.18328299e+02 -1.22053731e+01 -9.44791787e+00 -9.44791787e+00
 -9.44791787e+00 -1.24026181e+00 -5.55808460e-01 -5.55808460e-01
 -5.55808460e-01  4.52052971e-01  1.03680976e+00  1.03680976e+00
  1.03680976e+00  2.56985275e+00  7.35101611e+00  7.35101611e+00
  7.35101611e+00  1.37428676e+01  3.35277164e+01  3.35277164e+01
  3.35277164e+01  1.04321602e+02  1.29145963e+02  1.29145963e+02
  1.29145963e+02  4.83545769e+02  4.83545769e+02  4.83545769e+02
  5.84421836e+02  1.33543944e+03  1.33543944e+03  1.33543944e+03
  2.65290145e+03  3.02975046e+03  3.02975046e+03  3.02975046e+03
  6.65030579e+03  6.65030579e+03  6.65030579e+03  9.05867549e+03
  2.54144717e+04  7.61570484e+04]
E1 = -727.8356779181064  E_coul = 201.10062488973043
cycle= 1 E= -526.735053028376  delta_E= -0.393  |g|= 0.188  |ddm|= 0.309
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.546628
diis-c [-0.29880246  1.        ]
  HOMO = -0.590030979893723  LUMO = 0.442262007383055
  mo_energy =
[-1.18639671e+02 -1.23417376e+01 -9.59588630e+00 -9.59588630e+00
 -9.59588630e+00 -1.27855492e+00 -5.90030980e-01 -5.90030980e-01
 -5.90030980e-01  4.42262007e-01  1.01286473e+00  1.01286473e+00
  1.01286473e+00  2.53153816e+00  7.26138245e+00  7.26138245e+00
  7.26138245e+00  1.36392313e+01  3.33735698e+01  3.33735698e+01
  3.33735698e+01  1.04102863e+02  1.28915905e+02  1.28915905e+02
  1.28915905e+02  4.83235886e+02  4.83235886e+02  4.83235886e+02
  5.84073092e+02  1.33507156e+03  1.33507156e+03  1.33507156e+03
  2.65239801e+03  3.02931582e+03  3.02931582e+03  3.02931582e+03
  6.64975704e+03  6.64975704e+03  6.64975704e+03  9.05805095e+03
  2.54137526e+04  7.61562390e+04]
E1 = -728.4074527827204  E_coul = 201.67167005936722
cycle= 2 E= -526.735782723353  delta_E= -0.00073  |g|= 0.0379  |ddm|= 0.0562
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0760116
diis-c [-0.00326588  0.08441007  0.91558993]
  HOMO = -0.581110699334791  LUMO = 0.445453057586622
  mo_energy =
[-1.18571889e+02 -1.23039182e+01 -9.55640872e+00 -9.55640872e+00
 -9.55640872e+00 -1.26783646e+00 -5.81110699e-01 -5.81110699e-01
 -5.81110699e-01  4.45453058e-01  1.01945464e+00  1.01945464e+00
  1.01945464e+00  2.54218495e+00  7.28486087e+00  7.28486087e+00
  7.28486087e+00  1.36677179e+01  3.34134198e+01  3.34134198e+01
  3.34134198e+01  1.04158117e+02  1.28971754e+02  1.28971754e+02
  1.28971754e+02  4.83302849e+02  4.83302849e+02  4.83302849e+02
  5.84142394e+02  1.33514260e+03  1.33514260e+03  1.33514260e+03
  2.65247235e+03  3.02938909e+03  3.02938909e+03  3.02938909e+03
  6.64983205e+03  6.64983205e+03  6.64983205e+03  9.05812676e+03
  2.54138290e+04  7.61563157e+04]
E1 = -728.2571295021215  E_coul = 201.52128747712302
cycle= 3 E= -526.735842024999  delta_E= -5.93e-05  |g|= 0.0062  |ddm|= 0.0144
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0130688
diis-c [-8.66150160e-07 -1.32309135e-03  1.41729785e-01  8.59593307e-01]
  HOMO = -0.582611915348231  LUMO = 0.44497016792205
  mo_energy =
[-1.18581748e+02 -1.23096797e+01 -9.56252497e+00 -9.56252497e+00
 -9.56252497e+00 -1.26950529e+00 -5.82611915e-01 -5.82611915e-01
 -5.82611915e-01  4.44970168e-01  1.01837186e+00  1.01837186e+00
  1.01837186e+00  2.54049934e+00  7.28110198e+00  7.28110198e+00
  7.28110198e+00  1.36633127e+01  3.34072915e+01  3.34072915e+01
  3.34072915e+01  1.04149986e+02  1.28963480e+02  1.28963480e+02
  1.28963480e+02  4.83293104e+02  4.83293104e+02  4.83293104e+02
  5.84132299e+02  1.33513226e+03  1.33513226e+03  1.33513226e+03
  2.65246138e+03  3.02937837e+03  3.02937837e+03  3.02937837e+03
  6.64982093e+03  6.64982093e+03  6.64982093e+03  9.05811543e+03
  2.54138175e+04  7.61563040e+04]
E1 = -728.2795998339235  E_coul = 201.54375591764378
cycle= 4 E= -526.73584391628  delta_E= -1.89e-06  |g|= 0.000121  |ddm|= 0.00231
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000146771
diis-c [-9.64290909e-09  1.02499403e-04 -1.39603448e-02 -8.94770445e-02
  1.10333489e+00]
  HOMO = -0.582595629763739  LUMO = 0.444988123742629
  mo_energy =
[-1.18581699e+02 -1.23096069e+01 -9.56246743e+00 -9.56246743e+00
 -9.56246743e+00 -1.26945881e+00 -5.82595630e-01 -5.82595630e-01
 -5.82595630e-01  4.44988124e-01  1.01838653e+00  1.01838653e+00
  1.01838653e+00  2.54053596e+00  7.28114653e+00  7.28114653e+00
  7.28114653e+00  1.36633744e+01  3.34073468e+01  3.34073468e+01
  3.34073468e+01  1.04150047e+02  1.28963536e+02  1.28963536e+02
  1.28963536e+02  4.83293153e+02  4.83293153e+02  4.83293153e+02
  5.84132340e+02  1.33513230e+03  1.33513230e+03  1.33513230e+03
  2.65246140e+03  3.02937840e+03  3.02937840e+03  3.02937840e+03
  6.64982094e+03  6.64982094e+03  6.64982094e+03  9.05811543e+03
  2.54138175e+04  7.61563040e+04]
E1 = -728.2793100271185  E_coul = 201.54346610754416
cycle= 5 E= -526.735843919574  delta_E= -3.29e-09  |g|= 2.39e-05  |ddm|= 0.000178
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.36093e-05
diis-c [-1.75310464e-10  1.43588661e-05 -1.64442519e-03 -1.30131975e-02
  1.23356551e-03  1.01340970e+00]
  HOMO = -0.582605706277861  LUMO = 0.444986238577411
  mo_energy =
[-1.18581737e+02 -1.23096359e+01 -9.56249858e+00 -9.56249858e+00
 -9.56249858e+00 -1.26946682e+00 -5.82605706e-01 -5.82605706e-01
 -5.82605706e-01  4.44986239e-01  1.01837977e+00  1.01837977e+00
  1.01837977e+00  2.54052686e+00  7.28112496e+00  7.28112496e+00
  7.28112496e+00  1.36633511e+01  3.34073166e+01  3.34073166e+01
  3.34073166e+01  1.04150013e+02  1.28963501e+02  1.28963501e+02
  1.28963501e+02  4.83293115e+02  4.83293115e+02  4.83293115e+02
  5.84132302e+02  1.33513227e+03  1.33513227e+03  1.33513227e+03
  2.65246136e+03  3.02937836e+03  3.02937836e+03  3.02937836e+03
  6.64982090e+03  6.64982090e+03  6.64982090e+03  9.05811539e+03
  2.54138174e+04  7.61563040e+04]
E1 = -728.27940843919  E_coul = 201.5435645195252
cycle= 6 E= -526.735843919665  delta_E= -9.05e-11  |g|= 2.09e-06  |ddm|= 2.58e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.27940843919  E_coul = 201.5435645195252
  HOMO = -0.582605216489937  LUMO = 0.44498657408357
  mo_energy =
[-1.18581735e+02 -1.23096339e+01 -9.56249657e+00 -9.56249657e+00
 -9.56249657e+00 -1.26946589e+00 -5.82605216e-01 -5.82605216e-01
 -5.82605216e-01  4.44986574e-01  1.01838016e+00  1.01838016e+00
  1.01838016e+00  2.54052765e+00  7.28112628e+00  7.28112628e+00
  7.28112628e+00  1.36633527e+01  3.34073186e+01  3.34073186e+01
  3.34073186e+01  1.04150015e+02  1.28963503e+02  1.28963503e+02
  1.28963503e+02  4.83293118e+02  4.83293118e+02  4.83293118e+02
  5.84132305e+02  1.33513227e+03  1.33513227e+03  1.33513227e+03
  2.65246136e+03  3.02937837e+03  3.02937837e+03  3.02937837e+03
  6.64982091e+03  6.64982091e+03  6.64982091e+03  9.05811540e+03
  2.54138175e+04  7.61563040e+04]
E1 = -728.2794000672669  E_coul = 201.54355614760087
Extra cycle  E= -526.735843919666  delta_E= -1.25e-12  |g|= 5.41e-07  |ddm|= 2.4e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 106857.67494049705
E1 = -728.2794000672669  E_coul = 201.54355614760087
init E= -526.735843919666
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.582605398546559  LUMO = 0.444986546009129
  mo_energy =
[-1.18581735e+02 -1.23096346e+01 -9.56249721e+00 -9.56249721e+00
 -9.56249721e+00 -1.26946603e+00 -5.82605399e-01 -5.82605399e-01
 -5.82605399e-01  4.44986546e-01  1.01838004e+00  1.01838004e+00
  1.01838004e+00  2.54052749e+00  7.28112587e+00  7.28112587e+00
  7.28112587e+00  1.36633522e+01  3.34073179e+01  3.34073179e+01
  3.34073179e+01  1.04150014e+02  1.28963502e+02  1.28963502e+02
  1.28963502e+02  4.83293117e+02  4.83293117e+02  4.83293117e+02
  5.84132304e+02  1.33513227e+03  1.33513227e+03  1.33513227e+03
  2.65246136e+03  3.02937836e+03  3.02937836e+03  3.02937836e+03
  6.64982090e+03  6.64982090e+03  6.64982090e+03  9.05811539e+03
  2.54138175e+04  7.61563040e+04]
E1 = -728.2794022017881  E_coul = 201.54355828212286
cycle= 1 E= -526.735843919665  delta_E= 7.96e-13  |g|= 1.52e-07  |ddm|= 5.24e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2794022017881  E_coul = 201.54355828212286
  HOMO = -0.582605362771328  LUMO = 0.444986565740082
  mo_energy =
[-1.18581735e+02 -1.23096344e+01 -9.56249705e+00 -9.56249705e+00
 -9.56249705e+00 -1.26946597e+00 -5.82605363e-01 -5.82605363e-01
 -5.82605363e-01  4.44986566e-01  1.01838007e+00  1.01838007e+00
  1.01838007e+00  2.54052754e+00  7.28112597e+00  7.28112597e+00
  7.28112597e+00  1.36633524e+01  3.34073181e+01  3.34073181e+01
  3.34073181e+01  1.04150014e+02  1.28963502e+02  1.28963502e+02
  1.28963502e+02  4.83293118e+02  4.83293118e+02  4.83293118e+02
  5.84132304e+02  1.33513227e+03  1.33513227e+03  1.33513227e+03
  2.65246136e+03  3.02937836e+03  3.02937836e+03  3.02937836e+03
  6.64982090e+03  6.64982090e+03  6.64982090e+03  9.05811539e+03
  2.54138175e+04  7.61563040e+04]
E1 = -728.2794015508538  E_coul = 201.54355763118775
Extra cycle  E= -526.735843919666  delta_E= -6.82e-13  |g|= 4.03e-08  |ddm|= 1.19e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826559e+04 7.61752181e+03 3.61735092e+03 1.59782344e+03
 3.82852790e+02 1.08124439e+02 3.49195120e+01 7.50078006e+00
 3.03578917e+00 8.20046271e-01 4.07895262e-01 1.63687210e-01
 1.36278322e+03 6.64745519e+02 3.00961224e+02 3.14041613e+02
 6.16232288e+01 7.33303782e+00 2.02363660e+01 7.74139317e-01
 2.81228827e+00 2.24035830e-01]
grad_E = [-1.51766142e-06  3.31315063e-06 -1.57612471e-06  6.95457900e-05
 -4.21452104e-05 -1.26116726e-04 -3.85311346e-03 -4.27341172e-03
  1.07952984e-03 -2.18047400e-03  3.33608622e-03 -9.12054163e-03
 -5.06068057e-07  5.01786467e-06  2.36774310e-05  2.04147169e-05
 -2.12239097e-05  1.07755418e-04  1.86915486e-05 -1.36462539e-02
  7.94842517e-05  4.92802264e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:10 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6559769        1
[INPUT] 0    0    [1    /1   ]  7617.52164942        1
[INPUT] 0    0    [1    /1   ]  3617.35099339        1
[INPUT] 0    0    [1    /1   ]  1597.82009126        1
[INPUT] 0    0    [1    /1   ]  382.855481823        1
[INPUT] 0    0    [1    /1   ]  108.12529829         1
[INPUT] 0    0    [1    /1   ]  35.1108669088        1
[INPUT] 0    0    [1    /1   ]  7.62863741929        1
[INPUT] 0    0    [1    /1   ]  3.15426510222        1
[INPUT] 0    0    [1    /1   ]  0.828892995921       1
[INPUT] 0    0    [1    /1   ]  0.504914942008       1
[INPUT] 0    0    [1    /1   ]  0.201681454719       1
[INPUT] 1    0    [1    /1   ]  1362.78324676        1
[INPUT] 1    0    [1    /1   ]  664.745278149        1
[INPUT] 1    0    [1    /1   ]  300.960089619        1
[INPUT] 1    0    [1    /1   ]  314.040634158        1
[INPUT] 1    0    [1    /1   ]  61.6245393404        1
[INPUT] 1    0    [1    /1   ]  7.33601376627        1
[INPUT] 1    0    [1    /1   ]  20.2333625562        1
[INPUT] 1    0    [1    /1   ]  0.77379567521        1
[INPUT] 1    0    [1    /1   ]  2.81647003487        1
[INPUT] 1    0    [1    /1   ]  0.22627492144        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65597691503, 1.0]], [0, [7617.521649420383, 1.0]], [0, [3617.350993388563, 1.0]], [0, [1597.8200912554657, 1.0]], [0, [382.8554818228025, 1.0]], [0, [108.12529829046633, 1.0]], [0, [35.110866908751454, 1.0]], [0, [7.628637419287857, 1.0]], [0, [3.1542651022248283, 1.0]], [0, [0.8288929959207175, 1.0]], [0, [0.5049149420082861, 1.0]], [0, [0.2016814547191826, 1.0]], [1, [1362.7832467552707, 1.0]], [1, [664.7452781487682, 1.0]], [1, [300.9600896190158, 1.0]], [1, [314.04063415842927, 1.0]], [1, [61.62453934038713, 1.0]], [1, [7.336013766273909, 1.0]], [1, [20.23336255618372, 1.0]], [1, [0.7737956752100207, 1.0]], [1, [2.8164700348701635, 1.0]], [1, [0.22627492144002107, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65597692]
bas 1, expnt(s) = [7617.52164942]
bas 2, expnt(s) = [3617.35099339]
bas 3, expnt(s) = [1597.82009126]
bas 4, expnt(s) = [382.85548182]
bas 5, expnt(s) = [108.12529829]
bas 6, expnt(s) = [35.11086691]
bas 7, expnt(s) = [7.62863742]
bas 8, expnt(s) = [3.1542651]
bas 9, expnt(s) = [0.828893]
bas 10, expnt(s) = [0.50491494]
bas 11, expnt(s) = [0.20168145]
bas 12, expnt(s) = [1362.78324676]
bas 13, expnt(s) = [664.74527815]
bas 14, expnt(s) = [300.96008962]
bas 15, expnt(s) = [314.04063416]
bas 16, expnt(s) = [61.62453934]
bas 17, expnt(s) = [7.33601377]
bas 18, expnt(s) = [20.23336256]
bas 19, expnt(s) = [0.77379568]
bas 20, expnt(s) = [2.81647003]
bas 21, expnt(s) = [0.22627492]
CPU time:        67.14
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826560e+04 5.20026289e+03 7.61752165e+03 2.06003831e+03
 3.61735099e+03 1.17844146e+03 1.59782009e+03 6.38500046e+02
 3.82855482e+02 2.18670993e+02 1.08125298e+02 8.47150386e+01
 3.51108669e+01 3.64414953e+01 7.62863742e+00 1.15971228e+01
 3.15426510e+00 5.97982766e+00 8.28892996e-01 2.19476930e+00
 5.04914942e-01 1.51331275e+00 2.01681455e-01 7.60351660e-01
 1.36278325e+03 2.41556025e+04 6.64745278e+02 9.84698937e+03
 3.00960090e+02 3.65696267e+03 3.14040634e+02 3.85670748e+03
 6.16245393e+01 5.03705276e+02 7.33601377e+00 3.52216392e+01
 2.02333626e+01 1.25189952e+02 7.73795675e-01 2.11722623e+00
 2.81647003e+00 1.06442683e+01 2.26274921e-01 4.55281414e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993484308798656
cond(S) = 108365.88761053375
E1 = -729.5091953259017  E_coul = 203.16708348032626
init E= -526.342111845575
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.55567028623437  LUMO = 0.593279419592431
  mo_energy =
[-1.18328704e+02 -1.22057522e+01 -9.44802261e+00 -9.44802261e+00
 -9.44802261e+00 -1.24022408e+00 -5.55670286e-01 -5.55670286e-01
 -5.55670286e-01  5.93279420e-01  1.04531629e+00  1.04531629e+00
  1.04531629e+00  3.06927331e+00  7.36647621e+00  7.36647621e+00
  7.36647621e+00  1.48768623e+01  3.35528536e+01  3.35528536e+01
  3.35528536e+01  1.06319994e+02  1.29166986e+02  1.29166986e+02
  1.29166986e+02  4.83561499e+02  4.83561499e+02  4.83561499e+02
  5.86562693e+02  1.33545120e+03  1.33545120e+03  1.33545120e+03
  2.65483636e+03  3.02975834e+03  3.02975834e+03  3.02975834e+03
  6.65031054e+03  6.65031054e+03  6.65031054e+03  9.06045400e+03
  2.54161528e+04  7.61586132e+04]
E1 = -727.8814245657595  E_coul = 201.14543966705958
cycle= 1 E= -526.7359848987  delta_E= -0.394  |g|= 0.187  |ddm|= 0.342
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544905
diis-c [-0.29692174  1.        ]
  HOMO = -0.588405962722243  LUMO = 0.581135872676387
  mo_energy =
[-1.18636193e+02 -1.23391151e+01 -9.59280607e+00 -9.59280607e+00
 -9.59280607e+00 -1.27680935e+00 -5.88405963e-01 -5.88405963e-01
 -5.88405963e-01  5.81135873e-01  1.02243219e+00  1.02243219e+00
  1.02243219e+00  3.02930779e+00  7.27944091e+00  7.27944091e+00
  7.27944091e+00  1.47742323e+01  3.34019215e+01  3.34019215e+01
  3.34019215e+01  1.06104613e+02  1.28940519e+02  1.28940519e+02
  1.28940519e+02  4.83255512e+02  4.83255512e+02  4.83255512e+02
  5.86218022e+02  1.33508739e+03  1.33508739e+03  1.33508739e+03
  2.65433702e+03  3.02932774e+03  3.02932774e+03  3.02932774e+03
  6.64976587e+03  6.64976587e+03  6.64976587e+03  9.05983357e+03
  2.54154379e+04  7.61578080e+04]
E1 = -728.4394589315943  E_coul = 201.70277175418934
cycle= 2 E= -526.736687177405  delta_E= -0.000702  |g|= 0.0373  |ddm|= 0.0567
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0746479
diis-c [-0.00318688  0.08266717  0.91733283]
  HOMO = -0.579727573294866  LUMO = 0.585110506596826
  mo_energy =
[-1.18569647e+02 -1.23021646e+01 -9.55422360e+00 -9.55422360e+00
 -9.55422360e+00 -1.26637109e+00 -5.79727573e-01 -5.79727573e-01
 -5.79727573e-01  5.85110507e-01  1.02887321e+00  1.02887321e+00
  1.02887321e+00  3.04054798e+00  7.30234459e+00  7.30234459e+00
  7.30234459e+00  1.48024508e+01  3.34408931e+01  3.34408931e+01
  3.34408931e+01  1.06158798e+02  1.28995272e+02  1.28995272e+02
  1.28995272e+02  4.83321251e+02  4.83321251e+02  4.83321251e+02
  5.86286062e+02  1.33515716e+03  1.33515716e+03  1.33515716e+03
  2.65441006e+03  3.02939973e+03  3.02939973e+03  3.02939973e+03
  6.64983957e+03  6.64983957e+03  6.64983957e+03  9.05990807e+03
  2.54155130e+04  7.61578834e+04]
E1 = -728.2934523681419  E_coul = 201.55670893236004
cycle= 3 E= -526.736743435782  delta_E= -5.63e-05  |g|= 0.00611  |ddm|= 0.0141
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.012884
diis-c [-8.24016574e-07 -1.30810519e-03  1.42240198e-01  8.59067907e-01]
  HOMO = -0.581185523400814  LUMO = 0.584513433829909
  mo_energy =
[-1.18579349e+02 -1.23078095e+01 -9.56021880e+00 -9.56021880e+00
 -9.56021880e+00 -1.26799024e+00 -5.81185523e-01 -5.81185523e-01
 -5.81185523e-01  5.84513434e-01  1.02781934e+00  1.02781934e+00
  1.02781934e+00  3.03877025e+00  7.29867264e+00  7.29867264e+00
  7.29867264e+00  1.47980793e+01  3.34348849e+01  3.34348849e+01
  3.34348849e+01  1.06150804e+02  1.28987140e+02  1.28987140e+02
  1.28987140e+02  4.83311662e+02  4.83311662e+02  4.83311662e+02
  5.86276129e+02  1.33514699e+03  1.33514699e+03  1.33514699e+03
  2.65439926e+03  3.02938918e+03  3.02938918e+03  3.02938918e+03
  6.64982863e+03  6.64982863e+03  6.64982863e+03  9.05989691e+03
  2.54155016e+04  7.61578719e+04]
E1 = -728.3153757331872  E_coul = 201.5786304896682
cycle= 4 E= -526.736745243519  delta_E= -1.81e-06  |g|= 0.000122  |ddm|= 0.00232
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000141664
diis-c [-8.50565441e-09  9.87700371e-05 -1.35454240e-02 -8.69860901e-02
  1.10043274e+00]
  HOMO = -0.581168049421162  LUMO = 0.584536417522302
  mo_energy =
[-1.18579300e+02 -1.23077364e+01 -9.56016094e+00 -9.56016094e+00
 -9.56016094e+00 -1.26794280e+00 -5.81168049e-01 -5.81168049e-01
 -5.81168049e-01  5.84536418e-01  1.02783518e+00  1.02783518e+00
  1.02783518e+00  3.03880951e+00  7.29871812e+00  7.29871812e+00
  7.29871812e+00  1.47981417e+01  3.34349408e+01  3.34349408e+01
  3.34349408e+01  1.06150865e+02  1.28987197e+02  1.28987197e+02
  1.28987197e+02  4.83311712e+02  4.83311712e+02  4.83311712e+02
  5.86276171e+02  1.33514703e+03  1.33514703e+03  1.33514703e+03
  2.65439927e+03  3.02938921e+03  3.02938921e+03  3.02938921e+03
  6.64982864e+03  6.64982864e+03  6.64982864e+03  9.05989691e+03
  2.54155016e+04  7.61578719e+04]
E1 = -728.3150997417024  E_coul = 201.5783544950241
cycle= 5 E= -526.736745246678  delta_E= -3.16e-09  |g|= 2.37e-05  |ddm|= 0.000195
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.34968e-05
diis-c [-1.55959657e-10  1.45852784e-05 -1.70797639e-03 -1.34309014e-02
  7.59358497e-03  1.00753071e+00]
  HOMO = -0.581177674145392  LUMO = 0.584534126303475
  mo_energy =
[-1.18579337e+02 -1.23077645e+01 -9.56019117e+00 -9.56019117e+00
 -9.56019117e+00 -1.26795037e+00 -5.81177674e-01 -5.81177674e-01
 -5.81177674e-01  5.84534126e-01  1.02782874e+00  1.02782874e+00
  1.02782874e+00  3.03879998e+00  7.29869730e+00  7.29869730e+00
  7.29869730e+00  1.47981189e+01  3.34349115e+01  3.34349115e+01
  3.34349115e+01  1.06150832e+02  1.28987162e+02  1.28987162e+02
  1.28987162e+02  4.83311675e+02  4.83311675e+02  4.83311675e+02
  5.86276133e+02  1.33514699e+03  1.33514699e+03  1.33514699e+03
  2.65439923e+03  3.02938917e+03  3.02938917e+03  3.02938917e+03
  6.64982860e+03  6.64982860e+03  6.64982860e+03  9.05989687e+03
  2.54155016e+04  7.61578718e+04]
E1 = -728.3151955502444  E_coul = 201.5784503034801
cycle= 6 E= -526.736745246764  delta_E= -8.59e-11  |g|= 1.95e-06  |ddm|= 2.85e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3151955502444  E_coul = 201.5784503034801
  HOMO = -0.581177288295477  LUMO = 0.584534498133419
  mo_energy =
[-1.18579335e+02 -1.23077628e+01 -9.56018953e+00 -9.56018953e+00
 -9.56018953e+00 -1.26794956e+00 -5.81177288e-01 -5.81177288e-01
 -5.81177288e-01  5.84534498e-01  1.02782907e+00  1.02782907e+00
  1.02782907e+00  3.03880068e+00  7.29869837e+00  7.29869837e+00
  7.29869837e+00  1.47981202e+01  3.34349131e+01  3.34349131e+01
  3.34349131e+01  1.06150834e+02  1.28987165e+02  1.28987165e+02
  1.28987165e+02  4.83311677e+02  4.83311677e+02  4.83311677e+02
  5.86276136e+02  1.33514700e+03  1.33514700e+03  1.33514700e+03
  2.65439924e+03  3.02938917e+03  3.02938917e+03  3.02938917e+03
  6.64982860e+03  6.64982860e+03  6.64982860e+03  9.05989687e+03
  2.54155016e+04  7.61578718e+04]
E1 = -728.3151886435613  E_coul = 201.57844339679625
Extra cycle  E= -526.736745246765  delta_E= -7.96e-13  |g|= 4.8e-07  |ddm|= 2.62e-06
    CPU time for scf_cycle      0.30 sec, wall time      0.27 sec
exp = [2.61826560e+04 7.61752165e+03 3.61735099e+03 1.59782009e+03
 3.82855482e+02 1.08125298e+02 3.51108669e+01 7.62863742e+00
 3.15426510e+00 8.28892996e-01 5.04914942e-01 2.01681455e-01
 1.36278325e+03 6.64745278e+02 3.00960090e+02 3.14040634e+02
 6.16245393e+01 7.33601377e+00 2.02333626e+01 7.73795675e-01
 2.81647003e+00 2.26274921e-01]
E = -526.736745246765
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:10 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6559769        1
[INPUT] 0    0    [1    /1   ]  7617.52164942        1
[INPUT] 0    0    [1    /1   ]  3617.35099339        1
[INPUT] 0    0    [1    /1   ]  1597.82009126        1
[INPUT] 0    0    [1    /1   ]  382.855481823        1
[INPUT] 0    0    [1    /1   ]  108.12529829         1
[INPUT] 0    0    [1    /1   ]  35.1108669088        1
[INPUT] 0    0    [1    /1   ]  7.62863741929        1
[INPUT] 0    0    [1    /1   ]  3.15426510222        1
[INPUT] 0    0    [1    /1   ]  0.828892995921       1
[INPUT] 0    0    [1    /1   ]  0.504914942008       1
[INPUT] 0    0    [1    /1   ]  0.201681454719       1
[INPUT] 1    0    [1    /1   ]  1362.78324676        1
[INPUT] 1    0    [1    /1   ]  664.745278149        1
[INPUT] 1    0    [1    /1   ]  300.960089619        1
[INPUT] 1    0    [1    /1   ]  314.040634158        1
[INPUT] 1    0    [1    /1   ]  61.6245393404        1
[INPUT] 1    0    [1    /1   ]  7.33601376627        1
[INPUT] 1    0    [1    /1   ]  20.2333625562        1
[INPUT] 1    0    [1    /1   ]  0.77379567521        1
[INPUT] 1    0    [1    /1   ]  2.81647003487        1
[INPUT] 1    0    [1    /1   ]  0.22627492144        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65597691503, 1.0]], [0, [7617.521649420383, 1.0]], [0, [3617.350993388563, 1.0]], [0, [1597.8200912554657, 1.0]], [0, [382.8554818228025, 1.0]], [0, [108.12529829046633, 1.0]], [0, [35.110866908751454, 1.0]], [0, [7.628637419287857, 1.0]], [0, [3.1542651022248283, 1.0]], [0, [0.8288929959207175, 1.0]], [0, [0.5049149420082861, 1.0]], [0, [0.2016814547191826, 1.0]], [1, [1362.7832467552707, 1.0]], [1, [664.7452781487682, 1.0]], [1, [300.9600896190158, 1.0]], [1, [314.04063415842927, 1.0]], [1, [61.62453934038713, 1.0]], [1, [7.336013766273909, 1.0]], [1, [20.23336255618372, 1.0]], [1, [0.7737956752100207, 1.0]], [1, [2.8164700348701635, 1.0]], [1, [0.22627492144002107, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65597692]
bas 1, expnt(s) = [7617.52164942]
bas 2, expnt(s) = [3617.35099339]
bas 3, expnt(s) = [1597.82009126]
bas 4, expnt(s) = [382.85548182]
bas 5, expnt(s) = [108.12529829]
bas 6, expnt(s) = [35.11086691]
bas 7, expnt(s) = [7.62863742]
bas 8, expnt(s) = [3.1542651]
bas 9, expnt(s) = [0.828893]
bas 10, expnt(s) = [0.50491494]
bas 11, expnt(s) = [0.20168145]
bas 12, expnt(s) = [1362.78324676]
bas 13, expnt(s) = [664.74527815]
bas 14, expnt(s) = [300.96008962]
bas 15, expnt(s) = [314.04063416]
bas 16, expnt(s) = [61.62453934]
bas 17, expnt(s) = [7.33601377]
bas 18, expnt(s) = [20.23336256]
bas 19, expnt(s) = [0.77379568]
bas 20, expnt(s) = [2.81647003]
bas 21, expnt(s) = [0.22627492]
CPU time:        67.49
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826560e+04 5.20026289e+03 7.61752165e+03 2.06003831e+03
 3.61735099e+03 1.17844146e+03 1.59782009e+03 6.38500046e+02
 3.82855482e+02 2.18670993e+02 1.08125298e+02 8.47150386e+01
 3.51108669e+01 3.64414953e+01 7.62863742e+00 1.15971228e+01
 3.15426510e+00 5.97982766e+00 8.28892996e-01 2.19476930e+00
 5.04914942e-01 1.51331275e+00 2.01681455e-01 7.60351660e-01
 1.36278325e+03 2.41556025e+04 6.64745278e+02 9.84698937e+03
 3.00960090e+02 3.65696267e+03 3.14040634e+02 3.85670748e+03
 6.16245393e+01 5.03705276e+02 7.33601377e+00 3.52216392e+01
 2.02333626e+01 1.25189952e+02 7.73795675e-01 2.11722623e+00
 2.81647003e+00 1.06442683e+01 2.26274921e-01 4.55281414e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993484308798656
cond(S) = 108365.88761053375
E1 = -729.5091953259017  E_coul = 203.16708348032626
init E= -526.342111845575
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.55567028623437  LUMO = 0.593279419592431
  mo_energy =
[-1.18328704e+02 -1.22057522e+01 -9.44802261e+00 -9.44802261e+00
 -9.44802261e+00 -1.24022408e+00 -5.55670286e-01 -5.55670286e-01
 -5.55670286e-01  5.93279420e-01  1.04531629e+00  1.04531629e+00
  1.04531629e+00  3.06927331e+00  7.36647621e+00  7.36647621e+00
  7.36647621e+00  1.48768623e+01  3.35528536e+01  3.35528536e+01
  3.35528536e+01  1.06319994e+02  1.29166986e+02  1.29166986e+02
  1.29166986e+02  4.83561499e+02  4.83561499e+02  4.83561499e+02
  5.86562693e+02  1.33545120e+03  1.33545120e+03  1.33545120e+03
  2.65483636e+03  3.02975834e+03  3.02975834e+03  3.02975834e+03
  6.65031054e+03  6.65031054e+03  6.65031054e+03  9.06045400e+03
  2.54161528e+04  7.61586132e+04]
E1 = -727.8814245657595  E_coul = 201.14543966705958
cycle= 1 E= -526.7359848987  delta_E= -0.394  |g|= 0.187  |ddm|= 0.342
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544905
diis-c [-0.29692174  1.        ]
  HOMO = -0.588405962722243  LUMO = 0.581135872676387
  mo_energy =
[-1.18636193e+02 -1.23391151e+01 -9.59280607e+00 -9.59280607e+00
 -9.59280607e+00 -1.27680935e+00 -5.88405963e-01 -5.88405963e-01
 -5.88405963e-01  5.81135873e-01  1.02243219e+00  1.02243219e+00
  1.02243219e+00  3.02930779e+00  7.27944091e+00  7.27944091e+00
  7.27944091e+00  1.47742323e+01  3.34019215e+01  3.34019215e+01
  3.34019215e+01  1.06104613e+02  1.28940519e+02  1.28940519e+02
  1.28940519e+02  4.83255512e+02  4.83255512e+02  4.83255512e+02
  5.86218022e+02  1.33508739e+03  1.33508739e+03  1.33508739e+03
  2.65433702e+03  3.02932774e+03  3.02932774e+03  3.02932774e+03
  6.64976587e+03  6.64976587e+03  6.64976587e+03  9.05983357e+03
  2.54154379e+04  7.61578080e+04]
E1 = -728.4394589315943  E_coul = 201.70277175418934
cycle= 2 E= -526.736687177405  delta_E= -0.000702  |g|= 0.0373  |ddm|= 0.0567
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0746479
diis-c [-0.00318688  0.08266717  0.91733283]
  HOMO = -0.579727573294866  LUMO = 0.585110506596826
  mo_energy =
[-1.18569647e+02 -1.23021646e+01 -9.55422360e+00 -9.55422360e+00
 -9.55422360e+00 -1.26637109e+00 -5.79727573e-01 -5.79727573e-01
 -5.79727573e-01  5.85110507e-01  1.02887321e+00  1.02887321e+00
  1.02887321e+00  3.04054798e+00  7.30234459e+00  7.30234459e+00
  7.30234459e+00  1.48024508e+01  3.34408931e+01  3.34408931e+01
  3.34408931e+01  1.06158798e+02  1.28995272e+02  1.28995272e+02
  1.28995272e+02  4.83321251e+02  4.83321251e+02  4.83321251e+02
  5.86286062e+02  1.33515716e+03  1.33515716e+03  1.33515716e+03
  2.65441006e+03  3.02939973e+03  3.02939973e+03  3.02939973e+03
  6.64983957e+03  6.64983957e+03  6.64983957e+03  9.05990807e+03
  2.54155130e+04  7.61578834e+04]
E1 = -728.2934523681419  E_coul = 201.55670893236004
cycle= 3 E= -526.736743435782  delta_E= -5.63e-05  |g|= 0.00611  |ddm|= 0.0141
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.012884
diis-c [-8.24016574e-07 -1.30810519e-03  1.42240198e-01  8.59067907e-01]
  HOMO = -0.581185523400814  LUMO = 0.584513433829909
  mo_energy =
[-1.18579349e+02 -1.23078095e+01 -9.56021880e+00 -9.56021880e+00
 -9.56021880e+00 -1.26799024e+00 -5.81185523e-01 -5.81185523e-01
 -5.81185523e-01  5.84513434e-01  1.02781934e+00  1.02781934e+00
  1.02781934e+00  3.03877025e+00  7.29867264e+00  7.29867264e+00
  7.29867264e+00  1.47980793e+01  3.34348849e+01  3.34348849e+01
  3.34348849e+01  1.06150804e+02  1.28987140e+02  1.28987140e+02
  1.28987140e+02  4.83311662e+02  4.83311662e+02  4.83311662e+02
  5.86276129e+02  1.33514699e+03  1.33514699e+03  1.33514699e+03
  2.65439926e+03  3.02938918e+03  3.02938918e+03  3.02938918e+03
  6.64982863e+03  6.64982863e+03  6.64982863e+03  9.05989691e+03
  2.54155016e+04  7.61578719e+04]
E1 = -728.3153757331872  E_coul = 201.5786304896682
cycle= 4 E= -526.736745243519  delta_E= -1.81e-06  |g|= 0.000122  |ddm|= 0.00232
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000141664
diis-c [-8.50565441e-09  9.87700371e-05 -1.35454240e-02 -8.69860901e-02
  1.10043274e+00]
  HOMO = -0.581168049421162  LUMO = 0.584536417522302
  mo_energy =
[-1.18579300e+02 -1.23077364e+01 -9.56016094e+00 -9.56016094e+00
 -9.56016094e+00 -1.26794280e+00 -5.81168049e-01 -5.81168049e-01
 -5.81168049e-01  5.84536418e-01  1.02783518e+00  1.02783518e+00
  1.02783518e+00  3.03880951e+00  7.29871812e+00  7.29871812e+00
  7.29871812e+00  1.47981417e+01  3.34349408e+01  3.34349408e+01
  3.34349408e+01  1.06150865e+02  1.28987197e+02  1.28987197e+02
  1.28987197e+02  4.83311712e+02  4.83311712e+02  4.83311712e+02
  5.86276171e+02  1.33514703e+03  1.33514703e+03  1.33514703e+03
  2.65439927e+03  3.02938921e+03  3.02938921e+03  3.02938921e+03
  6.64982864e+03  6.64982864e+03  6.64982864e+03  9.05989691e+03
  2.54155016e+04  7.61578719e+04]
E1 = -728.3150997417024  E_coul = 201.5783544950241
cycle= 5 E= -526.736745246678  delta_E= -3.16e-09  |g|= 2.37e-05  |ddm|= 0.000195
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.34968e-05
diis-c [-1.55959657e-10  1.45852784e-05 -1.70797639e-03 -1.34309014e-02
  7.59358497e-03  1.00753071e+00]
  HOMO = -0.581177674145392  LUMO = 0.584534126303475
  mo_energy =
[-1.18579337e+02 -1.23077645e+01 -9.56019117e+00 -9.56019117e+00
 -9.56019117e+00 -1.26795037e+00 -5.81177674e-01 -5.81177674e-01
 -5.81177674e-01  5.84534126e-01  1.02782874e+00  1.02782874e+00
  1.02782874e+00  3.03879998e+00  7.29869730e+00  7.29869730e+00
  7.29869730e+00  1.47981189e+01  3.34349115e+01  3.34349115e+01
  3.34349115e+01  1.06150832e+02  1.28987162e+02  1.28987162e+02
  1.28987162e+02  4.83311675e+02  4.83311675e+02  4.83311675e+02
  5.86276133e+02  1.33514699e+03  1.33514699e+03  1.33514699e+03
  2.65439923e+03  3.02938917e+03  3.02938917e+03  3.02938917e+03
  6.64982860e+03  6.64982860e+03  6.64982860e+03  9.05989687e+03
  2.54155016e+04  7.61578718e+04]
E1 = -728.3151955502444  E_coul = 201.5784503034801
cycle= 6 E= -526.736745246764  delta_E= -8.59e-11  |g|= 1.95e-06  |ddm|= 2.85e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3151955502444  E_coul = 201.5784503034801
  HOMO = -0.581177288295477  LUMO = 0.584534498133419
  mo_energy =
[-1.18579335e+02 -1.23077628e+01 -9.56018953e+00 -9.56018953e+00
 -9.56018953e+00 -1.26794956e+00 -5.81177288e-01 -5.81177288e-01
 -5.81177288e-01  5.84534498e-01  1.02782907e+00  1.02782907e+00
  1.02782907e+00  3.03880068e+00  7.29869837e+00  7.29869837e+00
  7.29869837e+00  1.47981202e+01  3.34349131e+01  3.34349131e+01
  3.34349131e+01  1.06150834e+02  1.28987165e+02  1.28987165e+02
  1.28987165e+02  4.83311677e+02  4.83311677e+02  4.83311677e+02
  5.86276136e+02  1.33514700e+03  1.33514700e+03  1.33514700e+03
  2.65439924e+03  3.02938917e+03  3.02938917e+03  3.02938917e+03
  6.64982860e+03  6.64982860e+03  6.64982860e+03  9.05989687e+03
  2.54155016e+04  7.61578718e+04]
E1 = -728.3151886435613  E_coul = 201.57844339679625
Extra cycle  E= -526.736745246765  delta_E= -7.96e-13  |g|= 4.8e-07  |ddm|= 2.62e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 108365.88761053375
E1 = -728.3151886435613  E_coul = 201.57844339679625
init E= -526.736745246765
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.581177439830037  LUMO = 0.584534473502134
  mo_energy =
[-1.18579335e+02 -1.23077633e+01 -9.56019007e+00 -9.56019007e+00
 -9.56019007e+00 -1.26794967e+00 -5.81177440e-01 -5.81177440e-01
 -5.81177440e-01  5.84534474e-01  1.02782897e+00  1.02782897e+00
  1.02782897e+00  3.03880054e+00  7.29869803e+00  7.29869803e+00
  7.29869803e+00  1.47981199e+01  3.34349126e+01  3.34349126e+01
  3.34349126e+01  1.06150833e+02  1.28987164e+02  1.28987164e+02
  1.28987164e+02  4.83311677e+02  4.83311677e+02  4.83311677e+02
  5.86276135e+02  1.33514700e+03  1.33514700e+03  1.33514700e+03
  2.65439924e+03  3.02938917e+03  3.02938917e+03  3.02938917e+03
  6.64982860e+03  6.64982860e+03  6.64982860e+03  9.05989687e+03
  2.54155016e+04  7.61578718e+04]
E1 = -728.3151903784844  E_coul = 201.57844513171895
cycle= 1 E= -526.736745246766  delta_E= -4.55e-13  |g|= 1.31e-07  |ddm|= 5.85e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.3151903784844  E_coul = 201.57844513171895
  HOMO = -0.581177411342802  LUMO = 0.584534494871338
  mo_energy =
[-1.18579335e+02 -1.23077632e+01 -9.56018994e+00 -9.56018994e+00
 -9.56018994e+00 -1.26794962e+00 -5.81177411e-01 -5.81177411e-01
 -5.81177411e-01  5.84534495e-01  1.02782899e+00  1.02782899e+00
  1.02782899e+00  3.03880058e+00  7.29869811e+00  7.29869811e+00
  7.29869811e+00  1.47981200e+01  3.34349127e+01  3.34349127e+01
  3.34349127e+01  1.06150834e+02  1.28987164e+02  1.28987164e+02
  1.28987164e+02  4.83311677e+02  4.83311677e+02  4.83311677e+02
  5.86276135e+02  1.33514700e+03  1.33514700e+03  1.33514700e+03
  2.65439924e+03  3.02938917e+03  3.02938917e+03  3.02938917e+03
  6.64982860e+03  6.64982860e+03  6.64982860e+03  9.05989687e+03
  2.54155016e+04  7.61578718e+04]
E1 = -728.3151898499062  E_coul = 201.57844460314038
Extra cycle  E= -526.736745246766  delta_E= -3.41e-13  |g|= 3.36e-08  |ddm|= 1.22e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826560e+04 7.61752165e+03 3.61735099e+03 1.59782009e+03
 3.82855482e+02 1.08125298e+02 3.51108669e+01 7.62863742e+00
 3.15426510e+00 8.28892996e-01 5.04914942e-01 2.01681455e-01
 1.36278325e+03 6.64745278e+02 3.00960090e+02 3.14040634e+02
 6.16245393e+01 7.33601377e+00 2.02333626e+01 7.73795675e-01
 2.81647003e+00 2.26274921e-01]
grad_E = [-1.51446375e-06  3.27756295e-06 -1.59482806e-06  6.81418563e-05
  3.68659583e-06 -5.12851103e-04 -3.02847253e-03 -4.50183638e-03
  2.99829051e-03 -1.80901342e-03 -1.11205065e-04 -1.56026680e-03
 -5.07215823e-07  5.00041425e-06  2.35724029e-05  2.03246281e-05
 -9.40956740e-06  2.99117402e-04 -5.71596204e-05 -2.99972310e-02
  4.15697193e-04  1.06627351e-01]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:15 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.656185         1
[INPUT] 0    0    [1    /1   ]  7617.52119396        1
[INPUT] 0    0    [1    /1   ]  3617.35120867        1
[INPUT] 0    0    [1    /1   ]  1597.8105042         1
[INPUT] 0    0    [1    /1   ]  382.863099016        1
[INPUT] 0    0    [1    /1   ]  108.128440798        1
[INPUT] 0    0    [1    /1   ]  35.6585743878        1
[INPUT] 0    0    [1    /1   ]  8.01160589343        1
[INPUT] 0    0    [1    /1   ]  3.4545715124         1
[INPUT] 0    0    [1    /1   ]  0.854856072629       1
[INPUT] 0    0    [1    /1   ]  0.779277720286       1
[INPUT] 0    0    [1    /1   ]  0.279739580986       1
[INPUT] 1    0    [1    /1   ]  1362.78331603        1
[INPUT] 1    0    [1    /1   ]  664.744589452        1
[INPUT] 1    0    [1    /1   ]  300.956838457        1
[INPUT] 1    0    [1    /1   ]  314.037831045        1
[INPUT] 1    0    [1    /1   ]  61.6282645432        1
[INPUT] 1    0    [1    /1   ]  7.34457822904        1
[INPUT] 1    0    [1    /1   ]  20.2249167921        1
[INPUT] 1    0    [1    /1   ]  0.774637158936       1
[INPUT] 1    0    [1    /1   ]  2.82749826679        1
[INPUT] 1    0    [1    /1   ]  0.227129756846       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656185020922, 1.0]], [0, [7617.521193958335, 1.0]], [0, [3617.351208667313, 1.0]], [0, [1597.8105042007976, 1.0]], [0, [382.8630990161948, 1.0]], [0, [108.12844079826814, 1.0]], [0, [35.65857438776982, 1.0]], [0, [8.011605893427976, 1.0]], [0, [3.4545715123973952, 1.0]], [0, [0.8548560726294839, 1.0]], [0, [0.7792777202860213, 1.0]], [0, [0.27973958098582, 1.0]], [1, [1362.783316034302, 1.0]], [1, [664.7445894520673, 1.0]], [1, [300.956838456822, 1.0]], [1, [314.03783104504805, 1.0]], [1, [61.62826454317111, 1.0]], [1, [7.34457822904125, 1.0]], [1, [20.22491679210315, 1.0]], [1, [0.7746371589361725, 1.0]], [1, [2.8274982667880324, 1.0]], [1, [0.22712975684628212, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65618502]
bas 1, expnt(s) = [7617.52119396]
bas 2, expnt(s) = [3617.35120867]
bas 3, expnt(s) = [1597.8105042]
bas 4, expnt(s) = [382.86309902]
bas 5, expnt(s) = [108.1284408]
bas 6, expnt(s) = [35.65857439]
bas 7, expnt(s) = [8.01160589]
bas 8, expnt(s) = [3.45457151]
bas 9, expnt(s) = [0.85485607]
bas 10, expnt(s) = [0.77927772]
bas 11, expnt(s) = [0.27973958]
bas 12, expnt(s) = [1362.78331603]
bas 13, expnt(s) = [664.74458945]
bas 14, expnt(s) = [300.95683846]
bas 15, expnt(s) = [314.03783105]
bas 16, expnt(s) = [61.62826454]
bas 17, expnt(s) = [7.34457823]
bas 18, expnt(s) = [20.22491679]
bas 19, expnt(s) = [0.77463716]
bas 20, expnt(s) = [2.82749827]
bas 21, expnt(s) = [0.22712976]
CPU time:        73.33
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826562e+04 5.20026292e+03 7.61752119e+03 2.06003822e+03
 3.61735121e+03 1.17844151e+03 1.59781050e+03 6.38497172e+02
 3.82863099e+02 2.18674256e+02 1.08128441e+02 8.47168852e+01
 3.56585744e+01 3.68670176e+01 8.01160589e+00 1.20310826e+01
 3.45457151e+00 6.40192622e+00 8.54856073e-01 2.24612941e+00
 7.79277720e-01 2.09548337e+00 2.79739581e-01 9.71807987e-01
 1.36278332e+03 2.41556041e+04 6.64744589e+02 9.84697661e+03
 3.00956838e+02 3.65691329e+03 3.14037831e+02 3.85666444e+03
 6.16282645e+01 5.03743337e+02 7.34457823e+00 3.52730463e+01
 2.02249168e+01 1.25124635e+02 7.74637159e-01 2.12010466e+00
 2.82749827e+00 1.06963924e+01 2.27129757e-01 4.57432416e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99257064858433
cond(S) = 111621.3794805911
E1 = -729.5108223681915  E_coul = 203.17216736717575
init E= -526.338655001016
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555454109460306  LUMO = 0.92618121580995
  mo_energy =
[-1.18328825e+02 -1.22059488e+01 -9.44761148e+00 -9.44761148e+00
 -9.44761148e+00 -1.23910015e+00 -5.55454109e-01 -5.55454109e-01
 -5.55454109e-01  9.26181216e-01  1.04965519e+00  1.04965519e+00
  1.04965519e+00  4.27168053e+00  7.39488834e+00  7.39488834e+00
  7.39488834e+00  1.78584507e+01  3.36125661e+01  3.36125661e+01
  3.36125661e+01  1.11802409e+02  1.29218378e+02  1.29218378e+02
  1.29218378e+02  4.83600256e+02  4.83600256e+02  4.83600256e+02
  5.92538016e+02  1.33547956e+03  1.33547956e+03  1.33547956e+03
  2.66025830e+03  3.02977608e+03  3.02977608e+03  3.02977608e+03
  6.65031982e+03  6.65031982e+03  6.65031982e+03  9.06544087e+03
  2.54208672e+04  7.61630018e+04]
E1 = -727.9704616252062  E_coul = 201.23460117781127
cycle= 1 E= -526.735860447395  delta_E= -0.397  |g|= 0.184  |ddm|= 2.19
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.540287
diis-c [-0.29190951  1.        ]
  HOMO = -0.585464657032239  LUMO = 0.908863483452207
  mo_energy =
[-1.18628075e+02 -1.23338191e+01 -9.58631296e+00 -9.58631296e+00
 -9.58631296e+00 -1.27385090e+00 -5.85464657e-01 -5.85464657e-01
 -5.85464657e-01  9.08863483e-01  1.02875625e+00  1.02875625e+00
  1.02875625e+00  4.22706552e+00  7.31197068e+00  7.31197068e+00
  7.31197068e+00  1.77558747e+01  3.34678821e+01  3.34678821e+01
  3.34678821e+01  1.11593566e+02  1.28999186e+02  1.28999186e+02
  1.28999186e+02  4.83302511e+02  4.83302511e+02  4.83302511e+02
  5.92202136e+02  1.33512461e+03  1.33512461e+03  1.33512461e+03
  2.65976809e+03  3.02935437e+03  3.02935437e+03  3.02935437e+03
  6.64978429e+03  6.64978429e+03  6.64978429e+03  9.06482974e+03
  2.54201618e+04  7.61622061e+04]
E1 = -728.5105240959554  E_coul = 201.7740107018994
cycle= 2 E= -526.736513394056  delta_E= -0.000653  |g|= 0.0361  |ddm|= 0.132
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0726476
diis-c [-0.00309951  0.07990473  0.92009527]
  HOMO = -0.577001249666587  LUMO = 0.914452581102759
  mo_energy =
[-1.18563412e+02 -1.22980078e+01 -9.54888529e+00 -9.54888529e+00
 -9.54888529e+00 -1.26376112e+00 -5.77001250e-01 -5.77001250e-01
 -5.77001250e-01  9.14452581e-01  1.03503851e+00  1.03503851e+00
  1.03503851e+00  4.23995370e+00  7.33423259e+00  7.33423259e+00
  7.33423259e+00  1.77843284e+01  3.35057074e+01  3.35057074e+01
  3.35057074e+01  1.11646231e+02  1.29052344e+02  1.29052344e+02
  1.29052344e+02  4.83366389e+02  4.83366389e+02  4.83366389e+02
  5.92268242e+02  1.33519243e+03  1.33519243e+03  1.33519243e+03
  2.65983915e+03  3.02942439e+03  3.02942439e+03  3.02942439e+03
  6.64985601e+03  6.64985601e+03  6.64985601e+03  9.06490225e+03
  2.54202348e+04  7.61622795e+04]
E1 = -728.3707608666887  E_coul = 201.63419574480994
cycle= 3 E= -526.736565121879  delta_E= -5.17e-05  |g|= 0.00598  |ddm|= 0.0221
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.012605
diis-c [-5.46015071e-07 -1.26099742e-03  1.43179696e-01  8.58081301e-01]
  HOMO = -0.578374811035694  LUMO = 0.913596491765415
  mo_energy =
[-1.18572891e+02 -1.23034846e+01 -9.55469434e+00 -9.55469434e+00
 -9.55469434e+00 -1.26534194e+00 -5.78374811e-01 -5.78374811e-01
 -5.78374811e-01  9.13596492e-01  1.03403735e+00  1.03403735e+00
  1.03403735e+00  4.23793291e+00  7.33069493e+00  7.33069493e+00
  7.33069493e+00  1.77799308e+01  3.34998814e+01  3.34998814e+01
  3.34998814e+01  1.11638424e+02  1.29044419e+02  1.29044419e+02
  1.29044419e+02  4.83357021e+02  4.83357021e+02  4.83357021e+02
  5.92258544e+02  1.33518250e+03  1.33518250e+03  1.33518250e+03
  2.65982860e+03  3.02941408e+03  3.02941408e+03  3.02941408e+03
  6.64984532e+03  6.64984532e+03  6.64984532e+03  9.06489136e+03
  2.54202238e+04  7.61622683e+04]
E1 = -728.3921060216132  E_coul = 201.65553921712976
cycle= 4 E= -526.736566804483  delta_E= -1.68e-06  |g|= 7.4e-05  |ddm|= 0.00235
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=8.54944e-05
diis-c [-4.21195980e-09  4.94397971e-05 -7.59744628e-03 -4.83593636e-02
  1.05590737e+00]
  HOMO = -0.578348818135422  LUMO = 0.913622338739908
  mo_energy =
[-1.18572828e+02 -1.23034056e+01 -9.55462561e+00 -9.55462561e+00
 -9.55462561e+00 -1.26530110e+00 -5.78348818e-01 -5.78348818e-01
 -5.78348818e-01  9.13622339e-01  1.03405749e+00  1.03405749e+00
  1.03405749e+00  4.23797778e+00  7.33074955e+00  7.33074955e+00
  7.33074955e+00  1.77799991e+01  3.34999479e+01  3.34999479e+01
  3.34999479e+01  1.11638495e+02  1.29044487e+02  1.29044487e+02
  1.29044487e+02  4.83357085e+02  4.83357085e+02  4.83357085e+02
  5.92258601e+02  1.33518255e+03  1.33518255e+03  1.33518255e+03
  2.65982864e+03  3.02941413e+03  3.02941413e+03  3.02941413e+03
  6.64984536e+03  6.64984536e+03  6.64984536e+03  9.06489139e+03
  2.54202238e+04  7.61622683e+04]
E1 = -728.3918646763323  E_coul = 201.65529787121733
cycle= 5 E= -526.736566805115  delta_E= -6.32e-10  |g|= 1.74e-05  |ddm|= 0.000133
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
E1 = -728.3918646763323  E_coul = 201.65529787121733
  HOMO = -0.57835669153747  LUMO = 0.913618448952439
  mo_energy =
[-1.18572864e+02 -1.23034315e+01 -9.55465322e+00 -9.55465322e+00
 -9.55465322e+00 -1.26530879e+00 -5.78356692e-01 -5.78356692e-01
 -5.78356692e-01  9.13618449e-01  1.03405204e+00  1.03405204e+00
  1.03405204e+00  4.23796737e+00  7.33073116e+00  7.33073116e+00
  7.33073116e+00  1.77799776e+01  3.34999209e+01  3.34999209e+01
  3.34999209e+01  1.11638463e+02  1.29044454e+02  1.29044454e+02
  1.29044454e+02  4.83357049e+02  4.83357049e+02  4.83357049e+02
  5.92258564e+02  1.33518252e+03  1.33518252e+03  1.33518252e+03
  2.65982860e+03  3.02941409e+03  3.02941409e+03  3.02941409e+03
  6.64984532e+03  6.64984532e+03  6.64984532e+03  9.06489135e+03
  2.54202237e+04  7.61622683e+04]
E1 = -728.3919594778554  E_coul = 201.65539267271026
Extra cycle  E= -526.736566805145  delta_E= -3.01e-11  |g|= 5.64e-06  |ddm|= 7.69e-05
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
exp = [2.61826562e+04 7.61752119e+03 3.61735121e+03 1.59781050e+03
 3.82863099e+02 1.08128441e+02 3.56585744e+01 8.01160589e+00
 3.45457151e+00 8.54856073e-01 7.79277720e-01 2.79739581e-01
 1.36278332e+03 6.64744589e+02 3.00956838e+02 3.14037831e+02
 6.16282645e+01 7.34457823e+00 2.02249168e+01 7.74637159e-01
 2.82749827e+00 2.27129757e-01]
E = -526.7365668051451
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:15 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6560743        1
[INPUT] 0    0    [1    /1   ]  7617.52143626        1
[INPUT] 0    0    [1    /1   ]  3617.35109414        1
[INPUT] 0    0    [1    /1   ]  1597.81560442        1
[INPUT] 0    0    [1    /1   ]  382.85904674         1
[INPUT] 0    0    [1    /1   ]  108.126769013        1
[INPUT] 0    0    [1    /1   ]  35.3671990932        1
[INPUT] 0    0    [1    /1   ]  7.80787022018        1
[INPUT] 0    0    [1    /1   ]  3.29481128985        1
[INPUT] 0    0    [1    /1   ]  0.841043956829       1
[INPUT] 0    0    [1    /1   ]  0.633319269082       1
[INPUT] 0    0    [1    /1   ]  0.238213382406       1
[INPUT] 1    0    [1    /1   ]  1362.78327918        1
[INPUT] 1    0    [1    /1   ]  664.744955832        1
[INPUT] 1    0    [1    /1   ]  300.958568045        1
[INPUT] 1    0    [1    /1   ]  314.039322275        1
[INPUT] 1    0    [1    /1   ]  61.6262827699        1
[INPUT] 1    0    [1    /1   ]  7.34002201435        1
[INPUT] 1    0    [1    /1   ]  20.2294098602        1
[INPUT] 1    0    [1    /1   ]  0.774189497405       1
[INPUT] 1    0    [1    /1   ]  2.82163134978        1
[INPUT] 1    0    [1    /1   ]  0.226674992345       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65607431052, 1.0]], [0, [7617.521436259916, 1.0]], [0, [3617.3510941410163, 1.0]], [0, [1597.815604424887, 1.0]], [0, [382.8590467400185, 1.0]], [0, [108.12676901328868, 1.0]], [0, [35.36719909316053, 1.0]], [0, [7.807870220183855, 1.0]], [0, [3.294811289853208, 1.0]], [0, [0.8410439568290227, 1.0]], [0, [0.6333192690817833, 1.0]], [0, [0.23821338240559586, 1.0]], [1, [1362.7832791785004, 1.0]], [1, [664.7449558323192, 1.0]], [1, [300.9585680449294, 1.0]], [1, [314.0393222753463, 1.0]], [1, [61.62628276987014, 1.0]], [1, [7.340022014350742, 1.0]], [1, [20.229409860194146, 1.0]], [1, [0.774189497405138, 1.0]], [1, [2.821631349779983, 1.0]], [1, [0.22667499234536975, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65607431]
bas 1, expnt(s) = [7617.52143626]
bas 2, expnt(s) = [3617.35109414]
bas 3, expnt(s) = [1597.81560442]
bas 4, expnt(s) = [382.85904674]
bas 5, expnt(s) = [108.12676901]
bas 6, expnt(s) = [35.36719909]
bas 7, expnt(s) = [7.80787022]
bas 8, expnt(s) = [3.29481129]
bas 9, expnt(s) = [0.84104396]
bas 10, expnt(s) = [0.63331927]
bas 11, expnt(s) = [0.23821338]
bas 12, expnt(s) = [1362.78327918]
bas 13, expnt(s) = [664.74495583]
bas 14, expnt(s) = [300.95856804]
bas 15, expnt(s) = [314.03932228]
bas 16, expnt(s) = [61.62628277]
bas 17, expnt(s) = [7.34002201]
bas 18, expnt(s) = [20.22940986]
bas 19, expnt(s) = [0.7741895]
bas 20, expnt(s) = [2.82163135]
bas 21, expnt(s) = [0.22667499]
CPU time:        73.65
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826561e+04 5.20026290e+03 7.61752144e+03 2.06003827e+03
 3.61735109e+03 1.17844148e+03 1.59781560e+03 6.38498701e+02
 3.82859047e+02 2.18672520e+02 1.08126769e+02 8.47159028e+01
 3.53671991e+01 3.66408487e+01 7.80787022e+00 1.18008819e+01
 3.29481129e+00 6.17856946e+00 8.41043957e-01 2.21885563e+00
 6.33319269e-01 1.79362666e+00 2.38213382e-01 8.61468974e-01
 1.36278328e+03 2.41556033e+04 6.64744956e+02 9.84698340e+03
 3.00958568e+02 3.65693956e+03 3.14039322e+02 3.85668734e+03
 6.16262828e+01 5.03723089e+02 7.34002201e+00 3.52456964e+01
 2.02294099e+01 1.25159382e+02 7.74189497e-01 2.11857326e+00
 2.82163135e+00 1.06686565e+01 2.26674992e-01 4.56287850e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99328720360821
cond(S) = 109979.16586027398
E1 = -729.5119915309789  E_coul = 203.1691640571988
init E= -526.34282747378
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555581985478049  LUMO = 0.749768865364983
  mo_energy =
[-1.18328819e+02 -1.22059227e+01 -9.44785512e+00 -9.44785512e+00
 -9.44785512e+00 -1.24004765e+00 -5.55581985e-01 -5.55581985e-01
 -5.55581985e-01  7.49768865e-01  1.04733130e+00  1.04733130e+00
  1.04733130e+00  3.64216376e+00  7.37974143e+00  7.37974143e+00
  7.37974143e+00  1.62752676e+01  3.35808050e+01  3.35808050e+01
  3.35808050e+01  1.08886648e+02  1.29191006e+02  1.29191006e+02
  1.29191006e+02  4.83579636e+02  4.83579636e+02  4.83579636e+02
  5.89353660e+02  1.33546445e+03  1.33546445e+03  1.33546445e+03
  2.65736712e+03  3.02976663e+03  3.02976663e+03  3.02976663e+03
  6.65031487e+03  6.65031487e+03  6.65031487e+03  9.06278141e+03
  2.54183529e+04  7.61606613e+04]
E1 = -727.9097424246495  E_coul = 201.17295896914348
cycle= 1 E= -526.736783455506  delta_E= -0.394  |g|= 0.186  |ddm|= 0.356
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.543137
diis-c [-0.29499794  1.        ]
  HOMO = -0.587530552578343  LUMO = 0.734742280400259
  mo_energy =
[-1.18633602e+02 -1.23376897e+01 -9.59080799e+00 -9.59080799e+00
 -9.59080799e+00 -1.27607488e+00 -5.87530553e-01 -5.87530553e-01
 -5.87530553e-01  7.34742280e-01  1.02503368e+00  1.02503368e+00
  1.02503368e+00  3.59922909e+00  7.29387518e+00  7.29387518e+00
  7.29387518e+00  1.61717901e+01  3.34317914e+01  3.34317914e+01
  3.34317914e+01  1.08673219e+02  1.28966859e+02  1.28966859e+02
  1.28966859e+02  4.83276357e+02  4.83276357e+02  4.83276357e+02
  5.89011960e+02  1.33510363e+03  1.33510363e+03  1.33510363e+03
  2.65687085e+03  3.02933901e+03  3.02933901e+03  3.02933901e+03
  6.64977328e+03  6.64977328e+03  6.64977328e+03  9.06216412e+03
  2.54176413e+04  7.61598593e+04]
E1 = -728.4624546867409  E_coul = 201.72498589995817
cycle= 2 E= -526.737468786783  delta_E= -0.000685  |g|= 0.0369  |ddm|= 0.0578
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0739913
diis-c [-0.00316255  0.08173486  0.91826514]
  HOMO = -0.578907423432999  LUMO = 0.739576426393958
  mo_energy =
[-1.18567635e+02 -1.23010710e+01 -9.55256174e+00 -9.55256174e+00
 -9.55256174e+00 -1.26572886e+00 -5.78907423e-01 -5.78907423e-01
 -5.78907423e-01  7.39576426e-01  1.03143948e+00  1.03143948e+00
  1.03143948e+00  3.61137639e+00  7.31660629e+00  7.31660629e+00
  7.31660629e+00  1.62002921e+01  3.34704285e+01  3.34704285e+01
  3.34704285e+01  1.08726952e+02  1.29021129e+02  1.29021129e+02
  1.29021129e+02  4.83341524e+02  4.83341524e+02  4.83341524e+02
  5.89079399e+02  1.33517281e+03  1.33517281e+03  1.33517281e+03
  2.65694328e+03  3.02941039e+03  3.02941039e+03  3.02941039e+03
  6.64984637e+03  6.64984637e+03  6.64984637e+03  9.06223800e+03
  2.54177157e+04  7.61599341e+04]
E1 = -728.31846944927  E_coul = 201.58094587335006
cycle= 3 E= -526.73752357592  delta_E= -5.48e-05  |g|= 0.00607  |ddm|= 0.0147
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0128047
diis-c [-7.10304801e-07 -1.28890062e-03  1.42695766e-01  8.58593134e-01]
  HOMO = -0.580335101176018  LUMO = 0.738848698156228
  mo_energy =
[-1.18577268e+02 -1.23066598e+01 -9.55849533e+00 -9.55849533e+00
 -9.55849533e+00 -1.26733213e+00 -5.80335101e-01 -5.80335101e-01
 -5.80335101e-01  7.38848698e-01  1.03040518e+00  1.03040518e+00
  1.03040518e+00  3.60946577e+00  7.31297969e+00  7.31297969e+00
  7.31297969e+00  1.61958879e+01  3.34644805e+01  3.34644805e+01
  3.34644805e+01  1.08719017e+02  1.29013063e+02  1.29013063e+02
  1.29013063e+02  4.83332004e+02  4.83332004e+02  4.83332004e+02
  5.89069540e+02  1.33516271e+03  1.33516271e+03  1.33516271e+03
  2.65693256e+03  3.02939992e+03  3.02939992e+03  3.02939992e+03
  6.64983550e+03  6.64983550e+03  6.64983550e+03  9.06222693e+03
  2.54177044e+04  7.61599227e+04]
E1 = -728.340215194981  E_coul = 201.6026898534462
cycle= 4 E= -526.737525341535  delta_E= -1.77e-06  |g|= 0.000106  |ddm|= 0.00246
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000121433
diis-c [-6.45921830e-09  8.11358575e-05 -1.14346726e-02 -7.35304786e-02
  1.08488402e+00]
  HOMO = -0.580314485467705  LUMO = 0.738874621993507
  mo_energy =
[-1.18577215e+02 -1.23065855e+01 -9.55843476e+00 -9.55843476e+00
 -9.55843476e+00 -1.26728670e+00 -5.80314485e-01 -5.80314485e-01
 -5.80314485e-01  7.38874622e-01  1.03042285e+00  1.03042285e+00
  1.03042285e+00  3.60950757e+00  7.31302791e+00  7.31302791e+00
  7.31302791e+00  1.61959516e+01  3.34645390e+01  3.34645390e+01
  3.34645390e+01  1.08719080e+02  1.29013123e+02  1.29013123e+02
  1.29013123e+02  4.83332057e+02  4.83332057e+02  4.83332057e+02
  5.89069586e+02  1.33516275e+03  1.33516275e+03  1.33516275e+03
  2.65693259e+03  3.02939995e+03  3.02939995e+03  3.02939995e+03
  6.64983552e+03  6.64983552e+03  6.64983552e+03  9.06222694e+03
  2.54177045e+04  7.61599227e+04]
E1 = -728.3399615324172  E_coul = 201.60243618884098
cycle= 5 E= -526.737525343576  delta_E= -2.04e-09  |g|= 2.17e-05  |ddm|= 0.000212
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.07616e-05
diis-c [-1.15502586e-10  1.35682448e-05 -1.64663741e-03 -1.29112650e-02
  2.01403889e-02  9.94403945e-01]
  HOMO = -0.580322863869895  LUMO = 0.738872025621794
  mo_energy =
[-1.18577249e+02 -1.23066106e+01 -9.55846191e+00 -9.55846191e+00
 -9.55846191e+00 -1.26729348e+00 -5.80322864e-01 -5.80322864e-01
 -5.80322864e-01  7.38872026e-01  1.03041725e+00  1.03041725e+00
  1.03041725e+00  3.60949828e+00  7.31300939e+00  7.31300939e+00
  7.31300939e+00  1.61959310e+01  3.34645127e+01  3.34645127e+01
  3.34645127e+01  1.08719050e+02  1.29013092e+02  1.29013092e+02
  1.29013092e+02  4.83332024e+02  4.83332024e+02  4.83332024e+02
  5.89069552e+02  1.33516272e+03  1.33516272e+03  1.33516272e+03
  2.65693255e+03  3.02939991e+03  3.02939991e+03  3.02939991e+03
  6.64983548e+03  6.64983548e+03  6.64983548e+03  9.06222690e+03
  2.54177044e+04  7.61599226e+04]
E1 = -728.3400496118371  E_coul = 201.60252426819403
cycle= 6 E= -526.737525343643  delta_E= -6.68e-11  |g|= 1.76e-06  |ddm|= 3.64e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3400496118371  E_coul = 201.60252426819403
  HOMO = -0.580322657937188  LUMO = 0.738872377138532
  mo_energy =
[-1.18577247e+02 -1.23066096e+01 -9.55846094e+00 -9.55846094e+00
 -9.55846094e+00 -1.26729288e+00 -5.80322658e-01 -5.80322658e-01
 -5.80322658e-01  7.38872377e-01  1.03041745e+00  1.03041745e+00
  1.03041745e+00  3.60949878e+00  7.31301002e+00  7.31301002e+00
  7.31301002e+00  1.61959318e+01  3.34645137e+01  3.34645137e+01
  3.34645137e+01  1.08719051e+02  1.29013093e+02  1.29013093e+02
  1.29013093e+02  4.83332025e+02  4.83332025e+02  4.83332025e+02
  5.89069553e+02  1.33516272e+03  1.33516272e+03  1.33516272e+03
  2.65693255e+03  3.02939991e+03  3.02939991e+03  3.02939991e+03
  6.64983549e+03  6.64983549e+03  6.64983549e+03  9.06222690e+03
  2.54177044e+04  7.61599226e+04]
E1 = -728.3400452393992  E_coul = 201.60251989575644
Extra cycle  E= -526.737525343643  delta_E= 3.41e-13  |g|= 3.91e-07  |ddm|= 4.48e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826561e+04 7.61752144e+03 3.61735109e+03 1.59781560e+03
 3.82859047e+02 1.08126769e+02 3.53671991e+01 7.80787022e+00
 3.29481129e+00 8.41043957e-01 6.33319269e-01 2.38213382e-01
 1.36278328e+03 6.64744956e+02 3.00958568e+02 3.14039322e+02
 6.16262828e+01 7.34002201e+00 2.02294099e+01 7.74189497e-01
 2.82163135e+00 2.26674992e-01]
E = -526.7375253436427
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:16 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6560743        1
[INPUT] 0    0    [1    /1   ]  7617.52143626        1
[INPUT] 0    0    [1    /1   ]  3617.35109414        1
[INPUT] 0    0    [1    /1   ]  1597.81560442        1
[INPUT] 0    0    [1    /1   ]  382.85904674         1
[INPUT] 0    0    [1    /1   ]  108.126769013        1
[INPUT] 0    0    [1    /1   ]  35.3671990932        1
[INPUT] 0    0    [1    /1   ]  7.80787022018        1
[INPUT] 0    0    [1    /1   ]  3.29481128985        1
[INPUT] 0    0    [1    /1   ]  0.841043956829       1
[INPUT] 0    0    [1    /1   ]  0.633319269082       1
[INPUT] 0    0    [1    /1   ]  0.238213382406       1
[INPUT] 1    0    [1    /1   ]  1362.78327918        1
[INPUT] 1    0    [1    /1   ]  664.744955832        1
[INPUT] 1    0    [1    /1   ]  300.958568045        1
[INPUT] 1    0    [1    /1   ]  314.039322275        1
[INPUT] 1    0    [1    /1   ]  61.6262827699        1
[INPUT] 1    0    [1    /1   ]  7.34002201435        1
[INPUT] 1    0    [1    /1   ]  20.2294098602        1
[INPUT] 1    0    [1    /1   ]  0.774189497405       1
[INPUT] 1    0    [1    /1   ]  2.82163134978        1
[INPUT] 1    0    [1    /1   ]  0.226674992345       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65607431052, 1.0]], [0, [7617.521436259916, 1.0]], [0, [3617.3510941410163, 1.0]], [0, [1597.815604424887, 1.0]], [0, [382.8590467400185, 1.0]], [0, [108.12676901328868, 1.0]], [0, [35.36719909316053, 1.0]], [0, [7.807870220183855, 1.0]], [0, [3.294811289853208, 1.0]], [0, [0.8410439568290227, 1.0]], [0, [0.6333192690817833, 1.0]], [0, [0.23821338240559586, 1.0]], [1, [1362.7832791785004, 1.0]], [1, [664.7449558323192, 1.0]], [1, [300.9585680449294, 1.0]], [1, [314.0393222753463, 1.0]], [1, [61.62628276987014, 1.0]], [1, [7.340022014350742, 1.0]], [1, [20.229409860194146, 1.0]], [1, [0.774189497405138, 1.0]], [1, [2.821631349779983, 1.0]], [1, [0.22667499234536975, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65607431]
bas 1, expnt(s) = [7617.52143626]
bas 2, expnt(s) = [3617.35109414]
bas 3, expnt(s) = [1597.81560442]
bas 4, expnt(s) = [382.85904674]
bas 5, expnt(s) = [108.12676901]
bas 6, expnt(s) = [35.36719909]
bas 7, expnt(s) = [7.80787022]
bas 8, expnt(s) = [3.29481129]
bas 9, expnt(s) = [0.84104396]
bas 10, expnt(s) = [0.63331927]
bas 11, expnt(s) = [0.23821338]
bas 12, expnt(s) = [1362.78327918]
bas 13, expnt(s) = [664.74495583]
bas 14, expnt(s) = [300.95856804]
bas 15, expnt(s) = [314.03932228]
bas 16, expnt(s) = [61.62628277]
bas 17, expnt(s) = [7.34002201]
bas 18, expnt(s) = [20.22940986]
bas 19, expnt(s) = [0.7741895]
bas 20, expnt(s) = [2.82163135]
bas 21, expnt(s) = [0.22667499]
CPU time:        74.00
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826561e+04 5.20026290e+03 7.61752144e+03 2.06003827e+03
 3.61735109e+03 1.17844148e+03 1.59781560e+03 6.38498701e+02
 3.82859047e+02 2.18672520e+02 1.08126769e+02 8.47159028e+01
 3.53671991e+01 3.66408487e+01 7.80787022e+00 1.18008819e+01
 3.29481129e+00 6.17856946e+00 8.41043957e-01 2.21885563e+00
 6.33319269e-01 1.79362666e+00 2.38213382e-01 8.61468974e-01
 1.36278328e+03 2.41556033e+04 6.64744956e+02 9.84698340e+03
 3.00958568e+02 3.65693956e+03 3.14039322e+02 3.85668734e+03
 6.16262828e+01 5.03723089e+02 7.34002201e+00 3.52456964e+01
 2.02294099e+01 1.25159382e+02 7.74189497e-01 2.11857326e+00
 2.82163135e+00 1.06686565e+01 2.26674992e-01 4.56287850e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99328720360821
cond(S) = 109979.16586027398
E1 = -729.5119915309789  E_coul = 203.1691640571988
init E= -526.34282747378
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555581985478049  LUMO = 0.749768865364983
  mo_energy =
[-1.18328819e+02 -1.22059227e+01 -9.44785512e+00 -9.44785512e+00
 -9.44785512e+00 -1.24004765e+00 -5.55581985e-01 -5.55581985e-01
 -5.55581985e-01  7.49768865e-01  1.04733130e+00  1.04733130e+00
  1.04733130e+00  3.64216376e+00  7.37974143e+00  7.37974143e+00
  7.37974143e+00  1.62752676e+01  3.35808050e+01  3.35808050e+01
  3.35808050e+01  1.08886648e+02  1.29191006e+02  1.29191006e+02
  1.29191006e+02  4.83579636e+02  4.83579636e+02  4.83579636e+02
  5.89353660e+02  1.33546445e+03  1.33546445e+03  1.33546445e+03
  2.65736712e+03  3.02976663e+03  3.02976663e+03  3.02976663e+03
  6.65031487e+03  6.65031487e+03  6.65031487e+03  9.06278141e+03
  2.54183529e+04  7.61606613e+04]
E1 = -727.9097424246495  E_coul = 201.17295896914348
cycle= 1 E= -526.736783455506  delta_E= -0.394  |g|= 0.186  |ddm|= 0.356
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.543137
diis-c [-0.29499794  1.        ]
  HOMO = -0.587530552578343  LUMO = 0.734742280400259
  mo_energy =
[-1.18633602e+02 -1.23376897e+01 -9.59080799e+00 -9.59080799e+00
 -9.59080799e+00 -1.27607488e+00 -5.87530553e-01 -5.87530553e-01
 -5.87530553e-01  7.34742280e-01  1.02503368e+00  1.02503368e+00
  1.02503368e+00  3.59922909e+00  7.29387518e+00  7.29387518e+00
  7.29387518e+00  1.61717901e+01  3.34317914e+01  3.34317914e+01
  3.34317914e+01  1.08673219e+02  1.28966859e+02  1.28966859e+02
  1.28966859e+02  4.83276357e+02  4.83276357e+02  4.83276357e+02
  5.89011960e+02  1.33510363e+03  1.33510363e+03  1.33510363e+03
  2.65687085e+03  3.02933901e+03  3.02933901e+03  3.02933901e+03
  6.64977328e+03  6.64977328e+03  6.64977328e+03  9.06216412e+03
  2.54176413e+04  7.61598593e+04]
E1 = -728.4624546867409  E_coul = 201.72498589995817
cycle= 2 E= -526.737468786783  delta_E= -0.000685  |g|= 0.0369  |ddm|= 0.0578
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0739913
diis-c [-0.00316255  0.08173486  0.91826514]
  HOMO = -0.578907423432999  LUMO = 0.739576426393958
  mo_energy =
[-1.18567635e+02 -1.23010710e+01 -9.55256174e+00 -9.55256174e+00
 -9.55256174e+00 -1.26572886e+00 -5.78907423e-01 -5.78907423e-01
 -5.78907423e-01  7.39576426e-01  1.03143948e+00  1.03143948e+00
  1.03143948e+00  3.61137639e+00  7.31660629e+00  7.31660629e+00
  7.31660629e+00  1.62002921e+01  3.34704285e+01  3.34704285e+01
  3.34704285e+01  1.08726952e+02  1.29021129e+02  1.29021129e+02
  1.29021129e+02  4.83341524e+02  4.83341524e+02  4.83341524e+02
  5.89079399e+02  1.33517281e+03  1.33517281e+03  1.33517281e+03
  2.65694328e+03  3.02941039e+03  3.02941039e+03  3.02941039e+03
  6.64984637e+03  6.64984637e+03  6.64984637e+03  9.06223800e+03
  2.54177157e+04  7.61599341e+04]
E1 = -728.31846944927  E_coul = 201.58094587335006
cycle= 3 E= -526.73752357592  delta_E= -5.48e-05  |g|= 0.00607  |ddm|= 0.0147
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0128047
diis-c [-7.10304801e-07 -1.28890062e-03  1.42695766e-01  8.58593134e-01]
  HOMO = -0.580335101176018  LUMO = 0.738848698156228
  mo_energy =
[-1.18577268e+02 -1.23066598e+01 -9.55849533e+00 -9.55849533e+00
 -9.55849533e+00 -1.26733213e+00 -5.80335101e-01 -5.80335101e-01
 -5.80335101e-01  7.38848698e-01  1.03040518e+00  1.03040518e+00
  1.03040518e+00  3.60946577e+00  7.31297969e+00  7.31297969e+00
  7.31297969e+00  1.61958879e+01  3.34644805e+01  3.34644805e+01
  3.34644805e+01  1.08719017e+02  1.29013063e+02  1.29013063e+02
  1.29013063e+02  4.83332004e+02  4.83332004e+02  4.83332004e+02
  5.89069540e+02  1.33516271e+03  1.33516271e+03  1.33516271e+03
  2.65693256e+03  3.02939992e+03  3.02939992e+03  3.02939992e+03
  6.64983550e+03  6.64983550e+03  6.64983550e+03  9.06222693e+03
  2.54177044e+04  7.61599227e+04]
E1 = -728.340215194981  E_coul = 201.6026898534462
cycle= 4 E= -526.737525341535  delta_E= -1.77e-06  |g|= 0.000106  |ddm|= 0.00246
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000121433
diis-c [-6.45921830e-09  8.11358575e-05 -1.14346726e-02 -7.35304786e-02
  1.08488402e+00]
  HOMO = -0.580314485467705  LUMO = 0.738874621993507
  mo_energy =
[-1.18577215e+02 -1.23065855e+01 -9.55843476e+00 -9.55843476e+00
 -9.55843476e+00 -1.26728670e+00 -5.80314485e-01 -5.80314485e-01
 -5.80314485e-01  7.38874622e-01  1.03042285e+00  1.03042285e+00
  1.03042285e+00  3.60950757e+00  7.31302791e+00  7.31302791e+00
  7.31302791e+00  1.61959516e+01  3.34645390e+01  3.34645390e+01
  3.34645390e+01  1.08719080e+02  1.29013123e+02  1.29013123e+02
  1.29013123e+02  4.83332057e+02  4.83332057e+02  4.83332057e+02
  5.89069586e+02  1.33516275e+03  1.33516275e+03  1.33516275e+03
  2.65693259e+03  3.02939995e+03  3.02939995e+03  3.02939995e+03
  6.64983552e+03  6.64983552e+03  6.64983552e+03  9.06222694e+03
  2.54177045e+04  7.61599227e+04]
E1 = -728.3399615324172  E_coul = 201.60243618884098
cycle= 5 E= -526.737525343576  delta_E= -2.04e-09  |g|= 2.17e-05  |ddm|= 0.000212
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.07616e-05
diis-c [-1.15502586e-10  1.35682448e-05 -1.64663741e-03 -1.29112650e-02
  2.01403889e-02  9.94403945e-01]
  HOMO = -0.580322863869895  LUMO = 0.738872025621794
  mo_energy =
[-1.18577249e+02 -1.23066106e+01 -9.55846191e+00 -9.55846191e+00
 -9.55846191e+00 -1.26729348e+00 -5.80322864e-01 -5.80322864e-01
 -5.80322864e-01  7.38872026e-01  1.03041725e+00  1.03041725e+00
  1.03041725e+00  3.60949828e+00  7.31300939e+00  7.31300939e+00
  7.31300939e+00  1.61959310e+01  3.34645127e+01  3.34645127e+01
  3.34645127e+01  1.08719050e+02  1.29013092e+02  1.29013092e+02
  1.29013092e+02  4.83332024e+02  4.83332024e+02  4.83332024e+02
  5.89069552e+02  1.33516272e+03  1.33516272e+03  1.33516272e+03
  2.65693255e+03  3.02939991e+03  3.02939991e+03  3.02939991e+03
  6.64983548e+03  6.64983548e+03  6.64983548e+03  9.06222690e+03
  2.54177044e+04  7.61599226e+04]
E1 = -728.3400496118371  E_coul = 201.60252426819403
cycle= 6 E= -526.737525343643  delta_E= -6.68e-11  |g|= 1.76e-06  |ddm|= 3.64e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3400496118371  E_coul = 201.60252426819403
  HOMO = -0.580322657937188  LUMO = 0.738872377138532
  mo_energy =
[-1.18577247e+02 -1.23066096e+01 -9.55846094e+00 -9.55846094e+00
 -9.55846094e+00 -1.26729288e+00 -5.80322658e-01 -5.80322658e-01
 -5.80322658e-01  7.38872377e-01  1.03041745e+00  1.03041745e+00
  1.03041745e+00  3.60949878e+00  7.31301002e+00  7.31301002e+00
  7.31301002e+00  1.61959318e+01  3.34645137e+01  3.34645137e+01
  3.34645137e+01  1.08719051e+02  1.29013093e+02  1.29013093e+02
  1.29013093e+02  4.83332025e+02  4.83332025e+02  4.83332025e+02
  5.89069553e+02  1.33516272e+03  1.33516272e+03  1.33516272e+03
  2.65693255e+03  3.02939991e+03  3.02939991e+03  3.02939991e+03
  6.64983549e+03  6.64983549e+03  6.64983549e+03  9.06222690e+03
  2.54177044e+04  7.61599226e+04]
E1 = -728.3400452393992  E_coul = 201.60251989575644
Extra cycle  E= -526.737525343643  delta_E= 3.41e-13  |g|= 3.91e-07  |ddm|= 4.48e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 109979.16586027398
E1 = -728.3400452393992  E_coul = 201.60251989575644
init E= -526.737525343643
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.58032275840379  LUMO = 0.738872372319712
  mo_energy =
[-1.18577248e+02 -1.23066099e+01 -9.55846128e+00 -9.55846128e+00
 -9.55846128e+00 -1.26729292e+00 -5.80322758e-01 -5.80322758e-01
 -5.80322758e-01  7.38872372e-01  1.03041739e+00  1.03041739e+00
  1.03041739e+00  3.60949869e+00  7.31300980e+00  7.31300980e+00
  7.31300980e+00  1.61959316e+01  3.34645133e+01  3.34645133e+01
  3.34645133e+01  1.08719051e+02  1.29013093e+02  1.29013093e+02
  1.29013093e+02  4.83332025e+02  4.83332025e+02  4.83332025e+02
  5.89069553e+02  1.33516272e+03  1.33516272e+03  1.33516272e+03
  2.65693255e+03  3.02939991e+03  3.02939991e+03  3.02939991e+03
  6.64983549e+03  6.64983549e+03  6.64983549e+03  9.06222690e+03
  2.54177044e+04  7.61599226e+04]
E1 = -728.3400462978491  E_coul = 201.6025209542059
cycle= 1 E= -526.737525343643  delta_E= -5.68e-13  |g|= 9.83e-08  |ddm|= 9.53e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.3400462978491  E_coul = 201.6025209542059
  HOMO = -0.580322742032017  LUMO = 0.738872391393868
  mo_energy =
[-1.18577248e+02 -1.23066098e+01 -9.55846120e+00 -9.55846120e+00
 -9.55846120e+00 -1.26729289e+00 -5.80322742e-01 -5.80322742e-01
 -5.80322742e-01  7.38872391e-01  1.03041740e+00  1.03041740e+00
  1.03041740e+00  3.60949873e+00  7.31300985e+00  7.31300985e+00
  7.31300985e+00  1.61959317e+01  3.34645134e+01  3.34645134e+01
  3.34645134e+01  1.08719051e+02  1.29013093e+02  1.29013093e+02
  1.29013093e+02  4.83332025e+02  4.83332025e+02  4.83332025e+02
  5.89069553e+02  1.33516272e+03  1.33516272e+03  1.33516272e+03
  2.65693255e+03  3.02939991e+03  3.02939991e+03  3.02939991e+03
  6.64983549e+03  6.64983549e+03  6.64983549e+03  9.06222690e+03
  2.54177044e+04  7.61599226e+04]
E1 = -728.3400459686169  E_coul = 201.60252062497355
Extra cycle  E= -526.737525343643  delta_E= -1.14e-13  |g|= 2.32e-08  |ddm|= 1.83e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826561e+04 7.61752144e+03 3.61735109e+03 1.59781560e+03
 3.82859047e+02 1.08126769e+02 3.53671991e+01 7.80787022e+00
 3.29481129e+00 8.41043957e-01 6.33319269e-01 2.38213382e-01
 1.36278328e+03 6.64744956e+02 3.00958568e+02 3.14039322e+02
 6.16262828e+01 7.34002201e+00 2.02294099e+01 7.74189497e-01
 2.82163135e+00 2.26674992e-01]
grad_E = [-1.51026472e-06  3.23091829e-06 -1.61850349e-06  6.62990476e-05
  6.41569402e-05 -1.01685537e-03 -1.93925272e-03 -4.25340306e-03
  4.33540086e-03 -1.86467158e-03 -3.07591461e-03  2.33240018e-02
 -5.08596715e-07  4.98057546e-06  2.34539023e-05  2.02226811e-05
  2.32819458e-06  2.71398666e-04 -1.18248955e-04 -3.16017289e-02
  8.11579486e-04  1.10819014e-01]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:20 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6561672        1
[INPUT] 0    0    [1    /1   ]  7617.52123296        1
[INPUT] 0    0    [1    /1   ]  3617.35119028        1
[INPUT] 0    0    [1    /1   ]  1597.81132611        1
[INPUT] 0    0    [1    /1   ]  382.86237651         1
[INPUT] 0    0    [1    /1   ]  108.128621839        1
[INPUT] 0    0    [1    /1   ]  35.6118071512        1
[INPUT] 0    0    [1    /1   ]  7.99782824121        1
[INPUT] 0    0    [1    /1   ]  3.38548408773        1
[INPUT] 0    0    [1    /1   ]  0.854148205676       1
[INPUT] 0    0    [1    /1   ]  0.746292423145       1
[INPUT] 0    0    [1    /1   ]  0.241958140132       1
[INPUT] 1    0    [1    /1   ]  1362.78331011        1
[INPUT] 1    0    [1    /1   ]  664.744648382        1
[INPUT] 1    0    [1    /1   ]  300.957116709        1
[INPUT] 1    0    [1    /1   ]  314.038070951        1
[INPUT] 1    0    [1    /1   ]  61.6279176509        1
[INPUT] 1    0    [1    /1   ]  7.34383261763        1
[INPUT] 1    0    [1    /1   ]  20.2257971414        1
[INPUT] 1    0    [1    /1   ]  0.775548797375       1
[INPUT] 1    0    [1    /1   ]  2.82578538564        1
[INPUT] 1    0    [1    /1   ]  0.223906693237       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656167222325, 1.0]], [0, [7617.521232956825, 1.0]], [0, [3617.3511902834275, 1.0]], [0, [1597.8113261079009, 1.0]], [0, [382.8623765096954, 1.0]], [0, [108.1286218388437, 1.0]], [0, [35.61180715120555, 1.0]], [0, [7.997828241213102, 1.0]], [0, [3.385484087729676, 1.0]], [0, [0.8541482056761545, 1.0]], [0, [0.7462924231447774, 1.0]], [0, [0.24195814013201766, 1.0]], [1, [1362.7833101144063, 1.0]], [1, [664.7446483819002, 1.0]], [1, [300.9571167093431, 1.0]], [1, [314.0380709505295, 1.0]], [1, [61.62791765093953, 1.0]], [1, [7.343832617632895, 1.0]], [1, [20.2257971414142, 1.0]], [1, [0.7755487973752772, 1.0]], [1, [2.8257853856384783, 1.0]], [1, [0.22390669323685441, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65616722]
bas 1, expnt(s) = [7617.52123296]
bas 2, expnt(s) = [3617.35119028]
bas 3, expnt(s) = [1597.81132611]
bas 4, expnt(s) = [382.86237651]
bas 5, expnt(s) = [108.12862184]
bas 6, expnt(s) = [35.61180715]
bas 7, expnt(s) = [7.99782824]
bas 8, expnt(s) = [3.38548409]
bas 9, expnt(s) = [0.85414821]
bas 10, expnt(s) = [0.74629242]
bas 11, expnt(s) = [0.24195814]
bas 12, expnt(s) = [1362.78331011]
bas 13, expnt(s) = [664.74464838]
bas 14, expnt(s) = [300.95711671]
bas 15, expnt(s) = [314.03807095]
bas 16, expnt(s) = [61.62791765]
bas 17, expnt(s) = [7.34383262]
bas 18, expnt(s) = [20.22579714]
bas 19, expnt(s) = [0.7755488]
bas 20, expnt(s) = [2.82578539]
bas 21, expnt(s) = [0.22390669]
CPU time:        79.72
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826562e+04 5.20026291e+03 7.61752123e+03 2.06003823e+03
 3.61735119e+03 1.17844150e+03 1.59781133e+03 6.38497419e+02
 3.82862377e+02 2.18673946e+02 1.08128622e+02 8.47169916e+01
 3.56118072e+01 3.68307476e+01 7.99782824e+00 1.20155617e+01
 3.38548409e+00 6.30566083e+00 8.54148206e-01 2.24473433e+00
 7.46292423e-01 2.02860176e+00 2.41958140e-01 8.71605982e-01
 1.36278331e+03 2.41556039e+04 6.64744648e+02 9.84697771e+03
 3.00957117e+02 3.65691751e+03 3.14038071e+02 3.85666813e+03
 6.16279177e+01 5.03739793e+02 7.34383262e+00 3.52685703e+01
 2.02257971e+01 1.25131443e+02 7.75548797e-01 2.12322395e+00
 2.82578539e+00 1.06882933e+01 2.23906693e-01 4.49332920e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99361955142556
cond(S) = 110671.4290327011
E1 = -729.5169196950026  E_coul = 203.1703575970497
init E= -526.346562097953
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.555762677168247  LUMO = 0.815372398176974
  mo_energy =
[-1.18328586e+02 -1.22061581e+01 -9.44764232e+00 -9.44764232e+00
 -9.44764232e+00 -1.24016780e+00 -5.55762677e-01 -5.55762677e-01
 -5.55762677e-01  8.15372398e-01  1.03765387e+00  1.03765387e+00
  1.03765387e+00  4.00246795e+00  7.38225701e+00  7.38225701e+00
  7.38225701e+00  1.73249030e+01  3.35992834e+01  3.35992834e+01
  3.35992834e+01  1.11056560e+02  1.29207723e+02  1.29207723e+02
  1.29207723e+02  4.83592624e+02  4.83592624e+02  4.83592624e+02
  5.91802341e+02  1.33547331e+03  1.33547331e+03  1.33547331e+03
  2.65960439e+03  3.02977111e+03  3.02977111e+03  3.02977111e+03
  6.65031592e+03  6.65031592e+03  6.65031592e+03  9.06484131e+03
  2.54203005e+04  7.61624743e+04]
E1 = -727.859317253434  E_coul = 201.12141822718198
cycle= 1 E= -526.737899026252  delta_E= -0.391  |g|= 0.186  |ddm|= 0.525
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.543855
diis-c [-0.29577811  1.        ]
  HOMO = -0.589575672496032  LUMO = 0.797294090086077
  mo_energy =
[-1.18636908e+02 -1.23416669e+01 -9.59434353e+00 -9.59434353e+00
 -9.59434353e+00 -1.27839901e+00 -5.89575672e-01 -5.89575672e-01
 -5.89575672e-01  7.97294090e-01  1.01401779e+00  1.01401779e+00
  1.01401779e+00  3.95423551e+00  7.29308755e+00  7.29308755e+00
  7.29308755e+00  1.72162802e+01  3.34466714e+01  3.34466714e+01
  3.34466714e+01  1.10838898e+02  1.28979954e+02  1.28979954e+02
  1.28979954e+02  4.83285763e+02  4.83285763e+02  4.83285763e+02
  5.91457385e+02  1.33510925e+03  1.33510925e+03  1.33510925e+03
  2.65910489e+03  3.02934019e+03  3.02934019e+03  3.02934019e+03
  6.64977109e+03  6.64977109e+03  6.64977109e+03  9.06422083e+03
  2.54195857e+04  7.61616693e+04]
E1 = -728.4273143530988  E_coul = 201.68870221681343
cycle= 2 E= -526.738612136285  delta_E= -0.000713  |g|= 0.0376  |ddm|= 0.141
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0755011
diis-c [-0.00327622  0.08344099  0.91655901]
  HOMO = -0.580674341804428  LUMO = 0.802736151228953
  mo_energy =
[-1.18569616e+02 -1.23040642e+01 -9.55507774e+00 -9.55507774e+00
 -9.55507774e+00 -1.26772978e+00 -5.80674342e-01 -5.80674342e-01
 -5.80674342e-01  8.02736151e-01  1.02060409e+00  1.02060409e+00
  1.02060409e+00  3.96752710e+00  7.31652033e+00  7.31652033e+00
  7.31652033e+00  1.72460551e+01  3.34863060e+01  3.34863060e+01
  3.34863060e+01  1.10893856e+02  1.29035420e+02  1.29035420e+02
  1.29035420e+02  4.83352243e+02  4.83352243e+02  4.83352243e+02
  5.91526148e+02  1.33517978e+03  1.33517978e+03  1.33517978e+03
  2.65917872e+03  3.02941295e+03  3.02941295e+03  3.02941295e+03
  6.64984559e+03  6.64984559e+03  6.64984559e+03  9.06429613e+03
  2.54196616e+04  7.61617454e+04]
E1 = -728.2785884974226  E_coul = 201.53991827124355
cycle= 3 E= -526.738670226179  delta_E= -5.81e-05  |g|= 0.00619  |ddm|= 0.0186
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0130356
diis-c [-6.99346390e-07 -1.28786929e-03  1.42503560e-01  8.58784309e-01]
  HOMO = -0.582146922776963  LUMO = 0.801905340292199
  mo_energy =
[-1.18579439e+02 -1.23097879e+01 -9.56114936e+00 -9.56114936e+00
 -9.56114936e+00 -1.26939173e+00 -5.82146923e-01 -5.82146923e-01
 -5.82146923e-01  8.01905340e-01  1.01953922e+00  1.01953922e+00
  1.01953922e+00  3.96542955e+00  7.31279130e+00  7.31279130e+00
  7.31279130e+00  1.72414660e+01  3.34802197e+01  3.34802197e+01
  3.34802197e+01  1.10885745e+02  1.29027186e+02  1.29027186e+02
  1.29027186e+02  4.83342534e+02  4.83342534e+02  4.83342534e+02
  5.91516100e+02  1.33516948e+03  1.33516948e+03  1.33516948e+03
  2.65916780e+03  3.02940228e+03  3.02940228e+03  3.02940228e+03
  6.64983453e+03  6.64983453e+03  6.64983453e+03  9.06428486e+03
  2.54196501e+04  7.61617338e+04]
E1 = -728.3010111291695  E_coul = 201.56233904010048
cycle= 4 E= -526.738672089069  delta_E= -1.86e-06  |g|= 9.88e-05  |ddm|= 0.00515
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000114463
diis-c [-6.07712413e-09  7.64682525e-05 -1.08214812e-02 -6.93243086e-02
  1.08006932e+00]
  HOMO = -0.582126463355517  LUMO = 0.801931733085561
  mo_energy =
[-1.18579385e+02 -1.23097134e+01 -9.56108797e+00 -9.56108797e+00
 -9.56108797e+00 -1.26934822e+00 -5.82126463e-01 -5.82126463e-01
 -5.82126463e-01  8.01931733e-01  1.01955652e+00  1.01955652e+00
  1.01955652e+00  3.96547150e+00  7.31283945e+00  7.31283945e+00
  7.31283945e+00  1.72415296e+01  3.34802788e+01  3.34802788e+01
  3.34802788e+01  1.10885808e+02  1.29027246e+02  1.29027246e+02
  1.29027246e+02  4.83342588e+02  4.83342588e+02  4.83342588e+02
  5.91516147e+02  1.33516953e+03  1.33516953e+03  1.33516953e+03
  2.65916782e+03  3.02940231e+03  3.02940231e+03  3.02940231e+03
  6.64983455e+03  6.64983455e+03  6.64983455e+03  9.06428487e+03
  2.54196501e+04  7.61617338e+04]
E1 = -728.3007561625886  E_coul = 201.5620840717952
cycle= 5 E= -526.738672090793  delta_E= -1.72e-09  |g|= 2.1e-05  |ddm|= 0.000798
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96213e-05
diis-c [-1.05738839e-10  1.28698224e-05 -1.57639641e-03 -1.23698563e-02
  2.25598001e-02  9.91373583e-01]
  HOMO = -0.582134547863922  LUMO = 0.80192885670408
  mo_energy =
[-1.18579418e+02 -1.23097378e+01 -9.56111424e+00 -9.56111424e+00
 -9.56111424e+00 -1.26935490e+00 -5.82134548e-01 -5.82134548e-01
 -5.82134548e-01  8.01928857e-01  1.01955111e+00  1.01955111e+00
  1.01955111e+00  3.96546182e+00  7.31282149e+00  7.31282149e+00
  7.31282149e+00  1.72415093e+01  3.34802533e+01  3.34802533e+01
  3.34802533e+01  1.10885779e+02  1.29027216e+02  1.29027216e+02
  1.29027216e+02  4.83342556e+02  4.83342556e+02  4.83342556e+02
  5.91516114e+02  1.33516949e+03  1.33516949e+03  1.33516949e+03
  2.65916779e+03  3.02940228e+03  3.02940228e+03  3.02940228e+03
  6.64983451e+03  6.64983451e+03  6.64983451e+03  9.06428483e+03
  2.54196501e+04  7.61617338e+04]
E1 = -728.3008431046682  E_coul = 201.56217101381444
cycle= 6 E= -526.738672090854  delta_E= -6.03e-11  |g|= 1.72e-06  |ddm|= 0.000127
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3008431046682  E_coul = 201.56217101381444
  HOMO = -0.582134342925469  LUMO = 0.801929233637499
  mo_energy =
[-1.18579416e+02 -1.23097369e+01 -9.56111335e+00 -9.56111335e+00
 -9.56111335e+00 -1.26935431e+00 -5.82134343e-01 -5.82134343e-01
 -5.82134343e-01  8.01929234e-01  1.01955131e+00  1.01955131e+00
  1.01955131e+00  3.96546233e+00  7.31282208e+00  7.31282208e+00
  7.31282208e+00  1.72415101e+01  3.34802542e+01  3.34802542e+01
  3.34802542e+01  1.10885780e+02  1.29027217e+02  1.29027217e+02
  1.29027217e+02  4.83342557e+02  4.83342557e+02  4.83342557e+02
  5.91516115e+02  1.33516950e+03  1.33516950e+03  1.33516950e+03
  2.65916779e+03  3.02940228e+03  3.02940228e+03  3.02940228e+03
  6.64983452e+03  6.64983452e+03  6.64983452e+03  9.06428483e+03
  2.54196501e+04  7.61617338e+04]
E1 = -728.3008390986475  E_coul = 201.56216700779282
Extra cycle  E= -526.738672090855  delta_E= -1.02e-12  |g|= 3.76e-07  |ddm|= 1.59e-05
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826562e+04 7.61752123e+03 3.61735119e+03 1.59781133e+03
 3.82862377e+02 1.08128622e+02 3.56118072e+01 7.99782824e+00
 3.38548409e+00 8.54148206e-01 7.46292423e-01 2.41958140e-01
 1.36278331e+03 6.64744648e+02 3.00957117e+02 3.14038071e+02
 6.16279177e+01 7.34383262e+00 2.02257971e+01 7.75548797e-01
 2.82578539e+00 2.23906693e-01]
E = -526.7386720908547
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:21 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6561672        1
[INPUT] 0    0    [1    /1   ]  7617.52123296        1
[INPUT] 0    0    [1    /1   ]  3617.35119028        1
[INPUT] 0    0    [1    /1   ]  1597.81132611        1
[INPUT] 0    0    [1    /1   ]  382.86237651         1
[INPUT] 0    0    [1    /1   ]  108.128621839        1
[INPUT] 0    0    [1    /1   ]  35.6118071512        1
[INPUT] 0    0    [1    /1   ]  7.99782824121        1
[INPUT] 0    0    [1    /1   ]  3.38548408773        1
[INPUT] 0    0    [1    /1   ]  0.854148205676       1
[INPUT] 0    0    [1    /1   ]  0.746292423145       1
[INPUT] 0    0    [1    /1   ]  0.241958140132       1
[INPUT] 1    0    [1    /1   ]  1362.78331011        1
[INPUT] 1    0    [1    /1   ]  664.744648382        1
[INPUT] 1    0    [1    /1   ]  300.957116709        1
[INPUT] 1    0    [1    /1   ]  314.038070951        1
[INPUT] 1    0    [1    /1   ]  61.6279176509        1
[INPUT] 1    0    [1    /1   ]  7.34383261763        1
[INPUT] 1    0    [1    /1   ]  20.2257971414        1
[INPUT] 1    0    [1    /1   ]  0.775548797375       1
[INPUT] 1    0    [1    /1   ]  2.82578538564        1
[INPUT] 1    0    [1    /1   ]  0.223906693237       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656167222325, 1.0]], [0, [7617.521232956825, 1.0]], [0, [3617.3511902834275, 1.0]], [0, [1597.8113261079009, 1.0]], [0, [382.8623765096954, 1.0]], [0, [108.1286218388437, 1.0]], [0, [35.61180715120555, 1.0]], [0, [7.997828241213102, 1.0]], [0, [3.385484087729676, 1.0]], [0, [0.8541482056761545, 1.0]], [0, [0.7462924231447774, 1.0]], [0, [0.24195814013201766, 1.0]], [1, [1362.7833101144063, 1.0]], [1, [664.7446483819002, 1.0]], [1, [300.9571167093431, 1.0]], [1, [314.0380709505295, 1.0]], [1, [61.62791765093953, 1.0]], [1, [7.343832617632895, 1.0]], [1, [20.2257971414142, 1.0]], [1, [0.7755487973752772, 1.0]], [1, [2.8257853856384783, 1.0]], [1, [0.22390669323685441, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65616722]
bas 1, expnt(s) = [7617.52123296]
bas 2, expnt(s) = [3617.35119028]
bas 3, expnt(s) = [1597.81132611]
bas 4, expnt(s) = [382.86237651]
bas 5, expnt(s) = [108.12862184]
bas 6, expnt(s) = [35.61180715]
bas 7, expnt(s) = [7.99782824]
bas 8, expnt(s) = [3.38548409]
bas 9, expnt(s) = [0.85414821]
bas 10, expnt(s) = [0.74629242]
bas 11, expnt(s) = [0.24195814]
bas 12, expnt(s) = [1362.78331011]
bas 13, expnt(s) = [664.74464838]
bas 14, expnt(s) = [300.95711671]
bas 15, expnt(s) = [314.03807095]
bas 16, expnt(s) = [61.62791765]
bas 17, expnt(s) = [7.34383262]
bas 18, expnt(s) = [20.22579714]
bas 19, expnt(s) = [0.7755488]
bas 20, expnt(s) = [2.82578539]
bas 21, expnt(s) = [0.22390669]
CPU time:        80.07
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826562e+04 5.20026291e+03 7.61752123e+03 2.06003823e+03
 3.61735119e+03 1.17844150e+03 1.59781133e+03 6.38497419e+02
 3.82862377e+02 2.18673946e+02 1.08128622e+02 8.47169916e+01
 3.56118072e+01 3.68307476e+01 7.99782824e+00 1.20155617e+01
 3.38548409e+00 6.30566083e+00 8.54148206e-01 2.24473433e+00
 7.46292423e-01 2.02860176e+00 2.41958140e-01 8.71605982e-01
 1.36278331e+03 2.41556039e+04 6.64744648e+02 9.84697771e+03
 3.00957117e+02 3.65691751e+03 3.14038071e+02 3.85666813e+03
 6.16279177e+01 5.03739793e+02 7.34383262e+00 3.52685703e+01
 2.02257971e+01 1.25131443e+02 7.75548797e-01 2.12322395e+00
 2.82578539e+00 1.06882933e+01 2.23906693e-01 4.49332920e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99361955142556
cond(S) = 110671.4290327011
E1 = -729.5169196950026  E_coul = 203.1703575970497
init E= -526.346562097953
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555762677168247  LUMO = 0.815372398176974
  mo_energy =
[-1.18328586e+02 -1.22061581e+01 -9.44764232e+00 -9.44764232e+00
 -9.44764232e+00 -1.24016780e+00 -5.55762677e-01 -5.55762677e-01
 -5.55762677e-01  8.15372398e-01  1.03765387e+00  1.03765387e+00
  1.03765387e+00  4.00246795e+00  7.38225701e+00  7.38225701e+00
  7.38225701e+00  1.73249030e+01  3.35992834e+01  3.35992834e+01
  3.35992834e+01  1.11056560e+02  1.29207723e+02  1.29207723e+02
  1.29207723e+02  4.83592624e+02  4.83592624e+02  4.83592624e+02
  5.91802341e+02  1.33547331e+03  1.33547331e+03  1.33547331e+03
  2.65960439e+03  3.02977111e+03  3.02977111e+03  3.02977111e+03
  6.65031592e+03  6.65031592e+03  6.65031592e+03  9.06484131e+03
  2.54203005e+04  7.61624743e+04]
E1 = -727.859317253434  E_coul = 201.12141822718198
cycle= 1 E= -526.737899026252  delta_E= -0.391  |g|= 0.186  |ddm|= 0.525
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.543855
diis-c [-0.29577811  1.        ]
  HOMO = -0.589575672496032  LUMO = 0.797294090086077
  mo_energy =
[-1.18636908e+02 -1.23416669e+01 -9.59434353e+00 -9.59434353e+00
 -9.59434353e+00 -1.27839901e+00 -5.89575672e-01 -5.89575672e-01
 -5.89575672e-01  7.97294090e-01  1.01401779e+00  1.01401779e+00
  1.01401779e+00  3.95423551e+00  7.29308755e+00  7.29308755e+00
  7.29308755e+00  1.72162802e+01  3.34466714e+01  3.34466714e+01
  3.34466714e+01  1.10838898e+02  1.28979954e+02  1.28979954e+02
  1.28979954e+02  4.83285763e+02  4.83285763e+02  4.83285763e+02
  5.91457385e+02  1.33510925e+03  1.33510925e+03  1.33510925e+03
  2.65910489e+03  3.02934019e+03  3.02934019e+03  3.02934019e+03
  6.64977109e+03  6.64977109e+03  6.64977109e+03  9.06422083e+03
  2.54195857e+04  7.61616693e+04]
E1 = -728.4273143530988  E_coul = 201.68870221681343
cycle= 2 E= -526.738612136285  delta_E= -0.000713  |g|= 0.0376  |ddm|= 0.141
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0755011
diis-c [-0.00327622  0.08344099  0.91655901]
  HOMO = -0.580674341804428  LUMO = 0.802736151228953
  mo_energy =
[-1.18569616e+02 -1.23040642e+01 -9.55507774e+00 -9.55507774e+00
 -9.55507774e+00 -1.26772978e+00 -5.80674342e-01 -5.80674342e-01
 -5.80674342e-01  8.02736151e-01  1.02060409e+00  1.02060409e+00
  1.02060409e+00  3.96752710e+00  7.31652033e+00  7.31652033e+00
  7.31652033e+00  1.72460551e+01  3.34863060e+01  3.34863060e+01
  3.34863060e+01  1.10893856e+02  1.29035420e+02  1.29035420e+02
  1.29035420e+02  4.83352243e+02  4.83352243e+02  4.83352243e+02
  5.91526148e+02  1.33517978e+03  1.33517978e+03  1.33517978e+03
  2.65917872e+03  3.02941295e+03  3.02941295e+03  3.02941295e+03
  6.64984559e+03  6.64984559e+03  6.64984559e+03  9.06429613e+03
  2.54196616e+04  7.61617454e+04]
E1 = -728.2785884974226  E_coul = 201.53991827124355
cycle= 3 E= -526.738670226179  delta_E= -5.81e-05  |g|= 0.00619  |ddm|= 0.0186
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0130356
diis-c [-6.99346390e-07 -1.28786929e-03  1.42503560e-01  8.58784309e-01]
  HOMO = -0.582146922776963  LUMO = 0.801905340292199
  mo_energy =
[-1.18579439e+02 -1.23097879e+01 -9.56114936e+00 -9.56114936e+00
 -9.56114936e+00 -1.26939173e+00 -5.82146923e-01 -5.82146923e-01
 -5.82146923e-01  8.01905340e-01  1.01953922e+00  1.01953922e+00
  1.01953922e+00  3.96542955e+00  7.31279130e+00  7.31279130e+00
  7.31279130e+00  1.72414660e+01  3.34802197e+01  3.34802197e+01
  3.34802197e+01  1.10885745e+02  1.29027186e+02  1.29027186e+02
  1.29027186e+02  4.83342534e+02  4.83342534e+02  4.83342534e+02
  5.91516100e+02  1.33516948e+03  1.33516948e+03  1.33516948e+03
  2.65916780e+03  3.02940228e+03  3.02940228e+03  3.02940228e+03
  6.64983453e+03  6.64983453e+03  6.64983453e+03  9.06428486e+03
  2.54196501e+04  7.61617338e+04]
E1 = -728.3010111291695  E_coul = 201.56233904010048
cycle= 4 E= -526.738672089069  delta_E= -1.86e-06  |g|= 9.88e-05  |ddm|= 0.00515
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000114463
diis-c [-6.07712413e-09  7.64682525e-05 -1.08214812e-02 -6.93243086e-02
  1.08006932e+00]
  HOMO = -0.582126463355517  LUMO = 0.801931733085561
  mo_energy =
[-1.18579385e+02 -1.23097134e+01 -9.56108797e+00 -9.56108797e+00
 -9.56108797e+00 -1.26934822e+00 -5.82126463e-01 -5.82126463e-01
 -5.82126463e-01  8.01931733e-01  1.01955652e+00  1.01955652e+00
  1.01955652e+00  3.96547150e+00  7.31283945e+00  7.31283945e+00
  7.31283945e+00  1.72415296e+01  3.34802788e+01  3.34802788e+01
  3.34802788e+01  1.10885808e+02  1.29027246e+02  1.29027246e+02
  1.29027246e+02  4.83342588e+02  4.83342588e+02  4.83342588e+02
  5.91516147e+02  1.33516953e+03  1.33516953e+03  1.33516953e+03
  2.65916782e+03  3.02940231e+03  3.02940231e+03  3.02940231e+03
  6.64983455e+03  6.64983455e+03  6.64983455e+03  9.06428487e+03
  2.54196501e+04  7.61617338e+04]
E1 = -728.3007561625886  E_coul = 201.5620840717952
cycle= 5 E= -526.738672090793  delta_E= -1.72e-09  |g|= 2.1e-05  |ddm|= 0.000798
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96213e-05
diis-c [-1.05738839e-10  1.28698224e-05 -1.57639641e-03 -1.23698563e-02
  2.25598001e-02  9.91373583e-01]
  HOMO = -0.582134547863922  LUMO = 0.80192885670408
  mo_energy =
[-1.18579418e+02 -1.23097378e+01 -9.56111424e+00 -9.56111424e+00
 -9.56111424e+00 -1.26935490e+00 -5.82134548e-01 -5.82134548e-01
 -5.82134548e-01  8.01928857e-01  1.01955111e+00  1.01955111e+00
  1.01955111e+00  3.96546182e+00  7.31282149e+00  7.31282149e+00
  7.31282149e+00  1.72415093e+01  3.34802533e+01  3.34802533e+01
  3.34802533e+01  1.10885779e+02  1.29027216e+02  1.29027216e+02
  1.29027216e+02  4.83342556e+02  4.83342556e+02  4.83342556e+02
  5.91516114e+02  1.33516949e+03  1.33516949e+03  1.33516949e+03
  2.65916779e+03  3.02940228e+03  3.02940228e+03  3.02940228e+03
  6.64983451e+03  6.64983451e+03  6.64983451e+03  9.06428483e+03
  2.54196501e+04  7.61617338e+04]
E1 = -728.3008431046682  E_coul = 201.56217101381444
cycle= 6 E= -526.738672090854  delta_E= -6.03e-11  |g|= 1.72e-06  |ddm|= 0.000127
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3008431046682  E_coul = 201.56217101381444
  HOMO = -0.582134342925469  LUMO = 0.801929233637499
  mo_energy =
[-1.18579416e+02 -1.23097369e+01 -9.56111335e+00 -9.56111335e+00
 -9.56111335e+00 -1.26935431e+00 -5.82134343e-01 -5.82134343e-01
 -5.82134343e-01  8.01929234e-01  1.01955131e+00  1.01955131e+00
  1.01955131e+00  3.96546233e+00  7.31282208e+00  7.31282208e+00
  7.31282208e+00  1.72415101e+01  3.34802542e+01  3.34802542e+01
  3.34802542e+01  1.10885780e+02  1.29027217e+02  1.29027217e+02
  1.29027217e+02  4.83342557e+02  4.83342557e+02  4.83342557e+02
  5.91516115e+02  1.33516950e+03  1.33516950e+03  1.33516950e+03
  2.65916779e+03  3.02940228e+03  3.02940228e+03  3.02940228e+03
  6.64983452e+03  6.64983452e+03  6.64983452e+03  9.06428483e+03
  2.54196501e+04  7.61617338e+04]
E1 = -728.3008390986475  E_coul = 201.56216700779282
Extra cycle  E= -526.738672090855  delta_E= -1.02e-12  |g|= 3.76e-07  |ddm|= 1.59e-05
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 110671.4290327011
E1 = -728.3008390986475  E_coul = 201.56216700779282
init E= -526.738672090855
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.582134434740952  LUMO = 0.801929231351053
  mo_energy =
[-1.18579417e+02 -1.23097372e+01 -9.56111367e+00 -9.56111367e+00
 -9.56111367e+00 -1.26935434e+00 -5.82134435e-01 -5.82134435e-01
 -5.82134435e-01  8.01929231e-01  1.01955126e+00  1.01955126e+00
  1.01955126e+00  3.96546225e+00  7.31282188e+00  7.31282188e+00
  7.31282188e+00  1.72415099e+01  3.34802539e+01  3.34802539e+01
  3.34802539e+01  1.10885780e+02  1.29027217e+02  1.29027217e+02
  1.29027217e+02  4.83342557e+02  4.83342557e+02  4.83342557e+02
  5.91516114e+02  1.33516950e+03  1.33516950e+03  1.33516950e+03
  2.65916779e+03  3.02940228e+03  3.02940228e+03  3.02940228e+03
  6.64983452e+03  6.64983452e+03  6.64983452e+03  9.06428483e+03
  2.54196501e+04  7.61617338e+04]
E1 = -728.3008400911206  E_coul = 201.5621680002664
cycle= 1 E= -526.738672090854  delta_E= 5.68e-13  |g|= 9.38e-08  |ddm|= 3.41e-06
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.3008400911206  E_coul = 201.5621680002664
  HOMO = -0.582134419058573  LUMO = 0.801929251329996
  mo_energy =
[-1.18579417e+02 -1.23097371e+01 -9.56111359e+00 -9.56111359e+00
 -9.56111359e+00 -1.26935431e+00 -5.82134419e-01 -5.82134419e-01
 -5.82134419e-01  8.01929251e-01  1.01955127e+00  1.01955127e+00
  1.01955127e+00  3.96546228e+00  7.31282193e+00  7.31282193e+00
  7.31282193e+00  1.72415099e+01  3.34802540e+01  3.34802540e+01
  3.34802540e+01  1.10885780e+02  1.29027217e+02  1.29027217e+02
  1.29027217e+02  4.83342557e+02  4.83342557e+02  4.83342557e+02
  5.91516115e+02  1.33516950e+03  1.33516950e+03  1.33516950e+03
  2.65916779e+03  3.02940228e+03  3.02940228e+03  3.02940228e+03
  6.64983452e+03  6.64983452e+03  6.64983452e+03  9.06428483e+03
  2.54196501e+04  7.61617338e+04]
E1 = -728.3008397838248  E_coul = 201.56216769296975
Extra cycle  E= -526.738672090855  delta_E= -9.09e-13  |g|= 2.19e-08  |ddm|= 6.55e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61826562e+04 7.61752123e+03 3.61735119e+03 1.59781133e+03
 3.82862377e+02 1.08128622e+02 3.56118072e+01 7.99782824e+00
 3.38548409e+00 8.54148206e-01 7.46292423e-01 2.41958140e-01
 1.36278331e+03 6.64744648e+02 3.00957117e+02 3.14038071e+02
 6.16279177e+01 7.34383262e+00 2.02257971e+01 7.75548797e-01
 2.82578539e+00 2.23906693e-01]
grad_E = [-1.50616557e-06  3.18564373e-06 -1.64073151e-06  6.45079786e-05
  1.23345568e-04 -1.51175968e-03 -7.98071809e-04 -2.96931641e-03
  2.18698160e-03 -1.53354330e-03 -1.51628903e-03  1.73658621e-02
 -5.09796531e-07  4.96573031e-06  2.33659569e-05  2.01465981e-05
  9.08628487e-06 -5.30523999e-05 -1.35170977e-04 -9.87771370e-03
  1.06689090e-03  3.34842170e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:25 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6562653        1
[INPUT] 0    0    [1    /1   ]  7617.52101852        1
[INPUT] 0    0    [1    /1   ]  3617.35129187        1
[INPUT] 0    0    [1    /1   ]  1597.80681699        1
[INPUT] 0    0    [1    /1   ]  382.865650785        1
[INPUT] 0    0    [1    /1   ]  108.132536334        1
[INPUT] 0    0    [1    /1   ]  35.8660838234        1
[INPUT] 0    0    [1    /1   ]  8.20357071537        1
[INPUT] 0    0    [1    /1   ]  3.4652332999         1
[INPUT] 0    0    [1    /1   ]  0.868975660242       1
[INPUT] 0    0    [1    /1   ]  0.859615945427       1
[INPUT] 0    0    [1    /1   ]  0.238712735917       1
[INPUT] 1    0    [1    /1   ]  1362.78334278        1
[INPUT] 1    0    [1    /1   ]  664.744323904        1
[INPUT] 1    0    [1    /1   ]  300.955585104        1
[INPUT] 1    0    [1    /1   ]  314.036750417        1
[INPUT] 1    0    [1    /1   ]  61.6295922844        1
[INPUT] 1    0    [1    /1   ]  7.34796001809        1
[INPUT] 1    0    [1    /1   ]  20.2222581846        1
[INPUT] 1    0    [1    /1   ]  0.777095649235       1
[INPUT] 1    0    [1    /1   ]  2.8286786569         1
[INPUT] 1    0    [1    /1   ]  0.221629821529       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656265288893, 1.0]], [0, [7617.52101852325, 1.0]], [0, [3617.351291868535, 1.0]], [0, [1597.8068169884255, 1.0]], [0, [382.8656507849895, 1.0]], [0, [108.13253633354998, 1.0]], [0, [35.866083823419615, 1.0]], [0, [8.203570715372347, 1.0]], [0, [3.4652332999010143, 1.0]], [0, [0.868975660241894, 1.0]], [0, [0.8596159454274545, 1.0]], [0, [0.23871273591673697, 1.0]], [1, [1362.7833427785222, 1.0]], [1, [664.7443239039491, 1.0]], [1, [300.9555851035225, 1.0]], [1, [314.036750416801, 1.0]], [1, [61.62959228438081, 1.0]], [1, [7.34796001808581, 1.0]], [1, [20.222258184593482, 1.0]], [1, [0.7770956492348873, 1.0]], [1, [2.8286786569001063, 1.0]], [1, [0.2216298215293725, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65626529]
bas 1, expnt(s) = [7617.52101852]
bas 2, expnt(s) = [3617.35129187]
bas 3, expnt(s) = [1597.80681699]
bas 4, expnt(s) = [382.86565078]
bas 5, expnt(s) = [108.13253633]
bas 6, expnt(s) = [35.86608382]
bas 7, expnt(s) = [8.20357072]
bas 8, expnt(s) = [3.4652333]
bas 9, expnt(s) = [0.86897566]
bas 10, expnt(s) = [0.85961595]
bas 11, expnt(s) = [0.23871274]
bas 12, expnt(s) = [1362.78334278]
bas 13, expnt(s) = [664.7443239]
bas 14, expnt(s) = [300.9555851]
bas 15, expnt(s) = [314.03675042]
bas 16, expnt(s) = [61.62959228]
bas 17, expnt(s) = [7.34796002]
bas 18, expnt(s) = [20.22225818]
bas 19, expnt(s) = [0.77709565]
bas 20, expnt(s) = [2.82867866]
bas 21, expnt(s) = [0.22162982]
CPU time:        85.81
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826563e+04 5.20026293e+03 7.61752102e+03 2.06003818e+03
 3.61735129e+03 1.17844153e+03 1.59780682e+03 6.38496067e+02
 3.82865651e+02 2.18675349e+02 1.08132536e+02 8.47192918e+01
 3.58660838e+01 3.70278072e+01 8.20357072e+00 1.22466475e+01
 3.46523330e+00 6.41673913e+00 8.68975660e-01 2.27389671e+00
 8.59615945e-01 2.25550280e+00 2.38712736e-01 8.62823007e-01
 1.36278334e+03 2.41556047e+04 6.64744324e+02 9.84697170e+03
 3.00955585e+02 3.65689425e+03 3.14036750e+02 3.85664786e+03
 6.16295923e+01 5.03756904e+02 7.34796002e+00 3.52933492e+01
 2.02222582e+01 1.25104075e+02 7.77095649e-01 2.12851879e+00
 2.82867866e+00 1.07019744e+01 2.21629822e-01 4.43628704e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993791532534015
cond(S) = 1727791.9768459802
E1 = -729.5173052886914  E_coul = 203.16960903969604
init E= -526.347696248995
    CPU time for initialize scf      0.08 sec, wall time      0.05 sec
  HOMO = -0.555981539852265  LUMO = 0.856570566996108
  mo_energy =
[-1.18328375e+02 -1.22064787e+01 -9.44757061e+00 -9.44757061e+00
 -9.44757061e+00 -1.24028931e+00 -5.55981540e-01 -5.55981540e-01
 -5.55981540e-01  8.56570567e-01  1.02984755e+00  1.02984755e+00
  1.02984755e+00  4.32140172e+00  7.38523806e+00  7.38523806e+00
  7.38523806e+00  1.83379492e+01  3.36160938e+01  3.36160938e+01
  3.36160938e+01  1.13236842e+02  1.29223006e+02  1.29223006e+02
  1.29223006e+02  4.83604671e+02  4.83604671e+02  4.83604671e+02
  5.94300150e+02  1.33548121e+03  1.33548121e+03  1.33548121e+03
  2.66189548e+03  3.02977449e+03  3.02977449e+03  3.02977449e+03
  6.65031580e+03  6.65031580e+03  6.65031580e+03  9.06695201e+03
  2.54222963e+04  7.61643322e+04]
E1 = -727.8044095652758  E_coul = 201.06601805095568
cycle= 1 E= -526.73839151432  delta_E= -0.391  |g|= 0.188  |ddm|=  299
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.54507
diis-c [-0.29710109  1.        ]
  HOMO = -0.591710561127784  LUMO = 0.83580050279985
  mo_energy =
[-1.18640544e+02 -1.23458405e+01 -9.59819893e+00 -9.59819893e+00
 -9.59819893e+00 -1.28058769e+00 -5.91710561e-01 -5.91710561e-01
 -5.91710561e-01  8.35800503e-01  1.00485753e+00  1.00485753e+00
  1.00485753e+00  4.26789670e+00  7.29277422e+00  7.29277422e+00
  7.29277422e+00  1.82241142e+01  3.34596872e+01  3.34596872e+01
  3.34596872e+01  1.13014639e+02  1.28991382e+02  1.28991382e+02
  1.28991382e+02  4.83293902e+02  4.83293902e+02  4.83293902e+02
  5.93951624e+02  1.33511358e+03  1.33511358e+03  1.33511358e+03
  2.66139240e+03  3.02933993e+03  3.02933993e+03  3.02933993e+03
  6.64976738e+03  6.64976738e+03  6.64976738e+03  9.06632798e+03
  2.54215780e+04  7.61635237e+04]
E1 = -728.3872768140479  E_coul = 201.64814035506546
cycle= 2 E= -526.739136458982  delta_E= -0.000745  |g|= 0.0383  |ddm|= 30.3
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0770938
diis-c [-0.00339405  0.0852266   0.9147734 ]
  HOMO = -0.582559185521404  LUMO = 0.841758373166924
  mo_energy =
[-1.18571926e+02 -1.23072857e+01 -9.55795060e+00 -9.55795060e+00
 -9.55795060e+00 -1.26960899e+00 -5.82559186e-01 -5.82559186e-01
 -5.82559186e-01  8.41758373e-01  1.01161413e+00  1.01161413e+00
  1.01161413e+00  4.28230362e+00  7.31686712e+00  7.31686712e+00
  7.31686712e+00  1.82551487e+01  3.35002855e+01  3.35002855e+01
  3.35002855e+01  1.13070817e+02  1.29048032e+02  1.29048032e+02
  1.29048032e+02  4.83361695e+02  4.83361695e+02  4.83361695e+02
  5.94021713e+02  1.33518547e+03  1.33518547e+03  1.33518547e+03
  2.66146762e+03  3.02941408e+03  3.02941408e+03  3.02941408e+03
  6.64984329e+03  6.64984329e+03  6.64984329e+03  9.06640471e+03
  2.54216553e+04  7.61636013e+04]
E1 = -728.233737005864  E_coul = 201.49453893976698
cycle= 3 E= -526.739198066097  delta_E= -6.16e-05  |g|= 0.00631  |ddm|= 2.61
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132721
diis-c [-7.48442868e-07 -1.29413774e-03  1.42183269e-01  8.59110869e-01]
  HOMO = -0.584081440453347  LUMO = 0.84084083728888
  mo_energy =
[-1.18581937e+02 -1.23131439e+01 -9.56416174e+00 -9.56416174e+00
 -9.56416174e+00 -1.27132438e+00 -5.84081440e-01 -5.84081440e-01
 -5.84081440e-01  8.40840837e-01  1.01051564e+00  1.01051564e+00
  1.01051564e+00  4.28002020e+00  7.31303316e+00  7.31303316e+00
  7.31303316e+00  1.82503724e+01  3.34940597e+01  3.34940597e+01
  3.34940597e+01  1.13062531e+02  1.29039631e+02  1.29039631e+02
  1.29039631e+02  4.83351801e+02  4.83351801e+02  4.83351801e+02
  5.94011477e+02  1.33517499e+03  1.33517499e+03  1.33517499e+03
  2.66145650e+03  3.02940321e+03  3.02940321e+03  3.02940321e+03
  6.64983203e+03  6.64983203e+03  6.64983203e+03  9.06639322e+03
  2.54216437e+04  7.61635895e+04]
E1 = -728.2568173462874  E_coul = 201.51761731324675
cycle= 4 E= -526.739200033041  delta_E= -1.97e-06  |g|= 0.000102  |ddm|= 0.779
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000117378
diis-c [-6.50871971e-09  8.09386925e-05 -1.13219624e-02 -7.21771542e-02
  1.08341818e+00]
  HOMO = -0.58406190159964  LUMO = 0.840868640943419
  mo_energy =
[-1.18581882e+02 -1.23130685e+01 -9.56409969e+00 -9.56409969e+00
 -9.56409969e+00 -1.27128069e+00 -5.84061902e-01 -5.84061902e-01
 -5.84061902e-01  8.40868641e-01  1.01053242e+00  1.01053242e+00
  1.01053242e+00  4.28006300e+00  7.31308094e+00  7.31308094e+00
  7.31308094e+00  1.82504365e+01  3.34941193e+01  3.34941193e+01
  3.34941193e+01  1.13062596e+02  1.29039692e+02  1.29039692e+02
  1.29039692e+02  4.83351856e+02  4.83351856e+02  4.83351856e+02
  5.94011525e+02  1.33517503e+03  1.33517503e+03  1.33517503e+03
  2.66145653e+03  3.02940324e+03  3.02940324e+03  3.02940324e+03
  6.64983205e+03  6.64983205e+03  6.64983205e+03  9.06639324e+03
  2.54216437e+04  7.61635895e+04]
E1 = -728.2565523025183  E_coul = 201.51735226757336
cycle= 5 E= -526.739200034945  delta_E= -1.9e-09  |g|= 2.14e-05  |ddm|= 0.203
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.02058e-05
diis-c [-1.13086311e-10  1.28078317e-05 -1.56254903e-03 -1.22808865e-02
  1.91688836e-02  9.94661744e-01]
  HOMO = -0.584070219548463  LUMO = 0.84086546024098
  mo_energy =
[-1.18581915e+02 -1.23130934e+01 -9.56412658e+00 -9.56412658e+00
 -9.56412658e+00 -1.27128754e+00 -5.84070220e-01 -5.84070220e-01
 -5.84070220e-01  8.40865460e-01  1.01052687e+00  1.01052687e+00
  1.01052687e+00  4.28005244e+00  7.31306249e+00  7.31306249e+00
  7.31306249e+00  1.82504154e+01  3.34940932e+01  3.34940932e+01
  3.34940932e+01  1.13062566e+02  1.29039661e+02  1.29039661e+02
  1.29039661e+02  4.83351823e+02  4.83351823e+02  4.83351823e+02
  5.94011491e+02  1.33517500e+03  1.33517500e+03  1.33517500e+03
  2.66145649e+03  3.02940321e+03  3.02940321e+03  3.02940321e+03
  6.64983201e+03  6.64983201e+03  6.64983201e+03  9.06639320e+03
  2.54216436e+04  7.61635895e+04]
E1 = -728.2566423083491  E_coul = 201.51744227332549
cycle= 6 E= -526.739200035024  delta_E= -7.86e-11  |g|= 1.77e-06  |ddm|= 0.0257
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2566423083491  E_coul = 201.51744227332549
  HOMO = -0.584069942389207  LUMO = 0.840865902489791
  mo_energy =
[-1.18581913e+02 -1.23130923e+01 -9.56412549e+00 -9.56412549e+00
 -9.56412549e+00 -1.27128687e+00 -5.84069942e-01 -5.84069942e-01
 -5.84069942e-01  8.40865902e-01  1.01052712e+00  1.01052712e+00
  1.01052712e+00  4.28005306e+00  7.31306324e+00  7.31306324e+00
  7.31306324e+00  1.82504163e+01  3.34940943e+01  3.34940943e+01
  3.34940943e+01  1.13062567e+02  1.29039663e+02  1.29039663e+02
  1.29039663e+02  4.83351824e+02  4.83351824e+02  4.83351824e+02
  5.94011493e+02  1.33517500e+03  1.33517500e+03  1.33517500e+03
  2.66145650e+03  3.02940321e+03  3.02940321e+03  3.02940321e+03
  6.64983201e+03  6.64983201e+03  6.64983201e+03  9.06639320e+03
  2.54216436e+04  7.61635895e+04]
E1 = -728.2566376691805  E_coul = 201.51743763422488
Extra cycle  E= -526.739200034956  delta_E= 6.8e-11  |g|= 3.93e-07  |ddm|= 0.00292
    CPU time for scf_cycle      0.30 sec, wall time      0.27 sec
exp = [2.61826563e+04 7.61752102e+03 3.61735129e+03 1.59780682e+03
 3.82865651e+02 1.08132536e+02 3.58660838e+01 8.20357072e+00
 3.46523330e+00 8.68975660e-01 8.59615945e-01 2.38712736e-01
 1.36278334e+03 6.64744324e+02 3.00955585e+02 3.14036750e+02
 6.16295923e+01 7.34796002e+00 2.02222582e+01 7.77095649e-01
 2.82867866e+00 2.21629822e-01]
E = -526.7392000349556
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:25 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6562653        1
[INPUT] 0    0    [1    /1   ]  7617.52101852        1
[INPUT] 0    0    [1    /1   ]  3617.35129187        1
[INPUT] 0    0    [1    /1   ]  1597.80681699        1
[INPUT] 0    0    [1    /1   ]  382.865650785        1
[INPUT] 0    0    [1    /1   ]  108.132536334        1
[INPUT] 0    0    [1    /1   ]  35.8660838234        1
[INPUT] 0    0    [1    /1   ]  8.20357071537        1
[INPUT] 0    0    [1    /1   ]  3.4652332999         1
[INPUT] 0    0    [1    /1   ]  0.868975660242       1
[INPUT] 0    0    [1    /1   ]  0.859615945427       1
[INPUT] 0    0    [1    /1   ]  0.238712735917       1
[INPUT] 1    0    [1    /1   ]  1362.78334278        1
[INPUT] 1    0    [1    /1   ]  664.744323904        1
[INPUT] 1    0    [1    /1   ]  300.955585104        1
[INPUT] 1    0    [1    /1   ]  314.036750417        1
[INPUT] 1    0    [1    /1   ]  61.6295922844        1
[INPUT] 1    0    [1    /1   ]  7.34796001809        1
[INPUT] 1    0    [1    /1   ]  20.2222581846        1
[INPUT] 1    0    [1    /1   ]  0.777095649235       1
[INPUT] 1    0    [1    /1   ]  2.8286786569         1
[INPUT] 1    0    [1    /1   ]  0.221629821529       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656265288893, 1.0]], [0, [7617.52101852325, 1.0]], [0, [3617.351291868535, 1.0]], [0, [1597.8068169884255, 1.0]], [0, [382.8656507849895, 1.0]], [0, [108.13253633354998, 1.0]], [0, [35.866083823419615, 1.0]], [0, [8.203570715372347, 1.0]], [0, [3.4652332999010143, 1.0]], [0, [0.868975660241894, 1.0]], [0, [0.8596159454274545, 1.0]], [0, [0.23871273591673697, 1.0]], [1, [1362.7833427785222, 1.0]], [1, [664.7443239039491, 1.0]], [1, [300.9555851035225, 1.0]], [1, [314.036750416801, 1.0]], [1, [61.62959228438081, 1.0]], [1, [7.34796001808581, 1.0]], [1, [20.222258184593482, 1.0]], [1, [0.7770956492348873, 1.0]], [1, [2.8286786569001063, 1.0]], [1, [0.2216298215293725, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65626529]
bas 1, expnt(s) = [7617.52101852]
bas 2, expnt(s) = [3617.35129187]
bas 3, expnt(s) = [1597.80681699]
bas 4, expnt(s) = [382.86565078]
bas 5, expnt(s) = [108.13253633]
bas 6, expnt(s) = [35.86608382]
bas 7, expnt(s) = [8.20357072]
bas 8, expnt(s) = [3.4652333]
bas 9, expnt(s) = [0.86897566]
bas 10, expnt(s) = [0.85961595]
bas 11, expnt(s) = [0.23871274]
bas 12, expnt(s) = [1362.78334278]
bas 13, expnt(s) = [664.7443239]
bas 14, expnt(s) = [300.9555851]
bas 15, expnt(s) = [314.03675042]
bas 16, expnt(s) = [61.62959228]
bas 17, expnt(s) = [7.34796002]
bas 18, expnt(s) = [20.22225818]
bas 19, expnt(s) = [0.77709565]
bas 20, expnt(s) = [2.82867866]
bas 21, expnt(s) = [0.22162982]
CPU time:        86.18
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826563e+04 5.20026293e+03 7.61752102e+03 2.06003818e+03
 3.61735129e+03 1.17844153e+03 1.59780682e+03 6.38496067e+02
 3.82865651e+02 2.18675349e+02 1.08132536e+02 8.47192918e+01
 3.58660838e+01 3.70278072e+01 8.20357072e+00 1.22466475e+01
 3.46523330e+00 6.41673913e+00 8.68975660e-01 2.27389671e+00
 8.59615945e-01 2.25550280e+00 2.38712736e-01 8.62823007e-01
 1.36278334e+03 2.41556047e+04 6.64744324e+02 9.84697170e+03
 3.00955585e+02 3.65689425e+03 3.14036750e+02 3.85664786e+03
 6.16295923e+01 5.03756904e+02 7.34796002e+00 3.52933492e+01
 2.02222582e+01 1.25104075e+02 7.77095649e-01 2.12851879e+00
 2.82867866e+00 1.07019744e+01 2.21629822e-01 4.43628704e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993791532534015
cond(S) = 1727791.9768459802
E1 = -729.5173052886914  E_coul = 203.16960903969604
init E= -526.347696248995
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555981539852265  LUMO = 0.856570566996108
  mo_energy =
[-1.18328375e+02 -1.22064787e+01 -9.44757061e+00 -9.44757061e+00
 -9.44757061e+00 -1.24028931e+00 -5.55981540e-01 -5.55981540e-01
 -5.55981540e-01  8.56570567e-01  1.02984755e+00  1.02984755e+00
  1.02984755e+00  4.32140172e+00  7.38523806e+00  7.38523806e+00
  7.38523806e+00  1.83379492e+01  3.36160938e+01  3.36160938e+01
  3.36160938e+01  1.13236842e+02  1.29223006e+02  1.29223006e+02
  1.29223006e+02  4.83604671e+02  4.83604671e+02  4.83604671e+02
  5.94300150e+02  1.33548121e+03  1.33548121e+03  1.33548121e+03
  2.66189548e+03  3.02977449e+03  3.02977449e+03  3.02977449e+03
  6.65031580e+03  6.65031580e+03  6.65031580e+03  9.06695201e+03
  2.54222963e+04  7.61643322e+04]
E1 = -727.8044095652758  E_coul = 201.06601805095568
cycle= 1 E= -526.73839151432  delta_E= -0.391  |g|= 0.188  |ddm|=  299
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.54507
diis-c [-0.29710109  1.        ]
  HOMO = -0.591710561127784  LUMO = 0.83580050279985
  mo_energy =
[-1.18640544e+02 -1.23458405e+01 -9.59819893e+00 -9.59819893e+00
 -9.59819893e+00 -1.28058769e+00 -5.91710561e-01 -5.91710561e-01
 -5.91710561e-01  8.35800503e-01  1.00485753e+00  1.00485753e+00
  1.00485753e+00  4.26789670e+00  7.29277422e+00  7.29277422e+00
  7.29277422e+00  1.82241142e+01  3.34596872e+01  3.34596872e+01
  3.34596872e+01  1.13014639e+02  1.28991382e+02  1.28991382e+02
  1.28991382e+02  4.83293902e+02  4.83293902e+02  4.83293902e+02
  5.93951624e+02  1.33511358e+03  1.33511358e+03  1.33511358e+03
  2.66139240e+03  3.02933993e+03  3.02933993e+03  3.02933993e+03
  6.64976738e+03  6.64976738e+03  6.64976738e+03  9.06632798e+03
  2.54215780e+04  7.61635237e+04]
E1 = -728.3872768140479  E_coul = 201.64814035506546
cycle= 2 E= -526.739136458982  delta_E= -0.000745  |g|= 0.0383  |ddm|= 30.3
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0770938
diis-c [-0.00339405  0.0852266   0.9147734 ]
  HOMO = -0.582559185521404  LUMO = 0.841758373166924
  mo_energy =
[-1.18571926e+02 -1.23072857e+01 -9.55795060e+00 -9.55795060e+00
 -9.55795060e+00 -1.26960899e+00 -5.82559186e-01 -5.82559186e-01
 -5.82559186e-01  8.41758373e-01  1.01161413e+00  1.01161413e+00
  1.01161413e+00  4.28230362e+00  7.31686712e+00  7.31686712e+00
  7.31686712e+00  1.82551487e+01  3.35002855e+01  3.35002855e+01
  3.35002855e+01  1.13070817e+02  1.29048032e+02  1.29048032e+02
  1.29048032e+02  4.83361695e+02  4.83361695e+02  4.83361695e+02
  5.94021713e+02  1.33518547e+03  1.33518547e+03  1.33518547e+03
  2.66146762e+03  3.02941408e+03  3.02941408e+03  3.02941408e+03
  6.64984329e+03  6.64984329e+03  6.64984329e+03  9.06640471e+03
  2.54216553e+04  7.61636013e+04]
E1 = -728.233737005864  E_coul = 201.49453893976698
cycle= 3 E= -526.739198066097  delta_E= -6.16e-05  |g|= 0.00631  |ddm|= 2.61
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132721
diis-c [-7.48442868e-07 -1.29413774e-03  1.42183269e-01  8.59110869e-01]
  HOMO = -0.584081440453347  LUMO = 0.84084083728888
  mo_energy =
[-1.18581937e+02 -1.23131439e+01 -9.56416174e+00 -9.56416174e+00
 -9.56416174e+00 -1.27132438e+00 -5.84081440e-01 -5.84081440e-01
 -5.84081440e-01  8.40840837e-01  1.01051564e+00  1.01051564e+00
  1.01051564e+00  4.28002020e+00  7.31303316e+00  7.31303316e+00
  7.31303316e+00  1.82503724e+01  3.34940597e+01  3.34940597e+01
  3.34940597e+01  1.13062531e+02  1.29039631e+02  1.29039631e+02
  1.29039631e+02  4.83351801e+02  4.83351801e+02  4.83351801e+02
  5.94011477e+02  1.33517499e+03  1.33517499e+03  1.33517499e+03
  2.66145650e+03  3.02940321e+03  3.02940321e+03  3.02940321e+03
  6.64983203e+03  6.64983203e+03  6.64983203e+03  9.06639322e+03
  2.54216437e+04  7.61635895e+04]
E1 = -728.2568173462874  E_coul = 201.51761731324675
cycle= 4 E= -526.739200033041  delta_E= -1.97e-06  |g|= 0.000102  |ddm|= 0.779
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000117378
diis-c [-6.50871971e-09  8.09386925e-05 -1.13219624e-02 -7.21771542e-02
  1.08341818e+00]
  HOMO = -0.58406190159964  LUMO = 0.840868640943419
  mo_energy =
[-1.18581882e+02 -1.23130685e+01 -9.56409969e+00 -9.56409969e+00
 -9.56409969e+00 -1.27128069e+00 -5.84061902e-01 -5.84061902e-01
 -5.84061902e-01  8.40868641e-01  1.01053242e+00  1.01053242e+00
  1.01053242e+00  4.28006300e+00  7.31308094e+00  7.31308094e+00
  7.31308094e+00  1.82504365e+01  3.34941193e+01  3.34941193e+01
  3.34941193e+01  1.13062596e+02  1.29039692e+02  1.29039692e+02
  1.29039692e+02  4.83351856e+02  4.83351856e+02  4.83351856e+02
  5.94011525e+02  1.33517503e+03  1.33517503e+03  1.33517503e+03
  2.66145653e+03  3.02940324e+03  3.02940324e+03  3.02940324e+03
  6.64983205e+03  6.64983205e+03  6.64983205e+03  9.06639324e+03
  2.54216437e+04  7.61635895e+04]
E1 = -728.2565523025183  E_coul = 201.51735226757336
cycle= 5 E= -526.739200034945  delta_E= -1.9e-09  |g|= 2.14e-05  |ddm|= 0.203
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.02058e-05
diis-c [-1.13086311e-10  1.28078317e-05 -1.56254903e-03 -1.22808865e-02
  1.91688836e-02  9.94661744e-01]
  HOMO = -0.584070219548463  LUMO = 0.84086546024098
  mo_energy =
[-1.18581915e+02 -1.23130934e+01 -9.56412658e+00 -9.56412658e+00
 -9.56412658e+00 -1.27128754e+00 -5.84070220e-01 -5.84070220e-01
 -5.84070220e-01  8.40865460e-01  1.01052687e+00  1.01052687e+00
  1.01052687e+00  4.28005244e+00  7.31306249e+00  7.31306249e+00
  7.31306249e+00  1.82504154e+01  3.34940932e+01  3.34940932e+01
  3.34940932e+01  1.13062566e+02  1.29039661e+02  1.29039661e+02
  1.29039661e+02  4.83351823e+02  4.83351823e+02  4.83351823e+02
  5.94011491e+02  1.33517500e+03  1.33517500e+03  1.33517500e+03
  2.66145649e+03  3.02940321e+03  3.02940321e+03  3.02940321e+03
  6.64983201e+03  6.64983201e+03  6.64983201e+03  9.06639320e+03
  2.54216436e+04  7.61635895e+04]
E1 = -728.2566423083491  E_coul = 201.51744227332549
cycle= 6 E= -526.739200035024  delta_E= -7.86e-11  |g|= 1.77e-06  |ddm|= 0.0257
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2566423083491  E_coul = 201.51744227332549
  HOMO = -0.584069942389207  LUMO = 0.840865902489791
  mo_energy =
[-1.18581913e+02 -1.23130923e+01 -9.56412549e+00 -9.56412549e+00
 -9.56412549e+00 -1.27128687e+00 -5.84069942e-01 -5.84069942e-01
 -5.84069942e-01  8.40865902e-01  1.01052712e+00  1.01052712e+00
  1.01052712e+00  4.28005306e+00  7.31306324e+00  7.31306324e+00
  7.31306324e+00  1.82504163e+01  3.34940943e+01  3.34940943e+01
  3.34940943e+01  1.13062567e+02  1.29039663e+02  1.29039663e+02
  1.29039663e+02  4.83351824e+02  4.83351824e+02  4.83351824e+02
  5.94011493e+02  1.33517500e+03  1.33517500e+03  1.33517500e+03
  2.66145650e+03  3.02940321e+03  3.02940321e+03  3.02940321e+03
  6.64983201e+03  6.64983201e+03  6.64983201e+03  9.06639320e+03
  2.54216436e+04  7.61635895e+04]
E1 = -728.2566376691805  E_coul = 201.51743763422488
Extra cycle  E= -526.739200034956  delta_E= 6.8e-11  |g|= 3.93e-07  |ddm|= 0.00292
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 1727791.9768459802
E1 = -728.2566376691805  E_coul = 201.51743763422488
init E= -526.739200034956
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.584070045489527  LUMO = 0.840865895641769
  mo_energy =
[-1.18581914e+02 -1.23130927e+01 -9.56412585e+00 -9.56412585e+00
 -9.56412585e+00 -1.27128692e+00 -5.84070045e-01 -5.84070045e-01
 -5.84070045e-01  8.40865896e-01  1.01052706e+00  1.01052706e+00
  1.01052706e+00  4.28005298e+00  7.31306300e+00  7.31306300e+00
  7.31306300e+00  1.82504161e+01  3.34940939e+01  3.34940939e+01
  3.34940939e+01  1.13062567e+02  1.29039662e+02  1.29039662e+02
  1.29039662e+02  4.83351824e+02  4.83351824e+02  4.83351824e+02
  5.94011492e+02  1.33517500e+03  1.33517500e+03  1.33517500e+03
  2.66145650e+03  3.02940321e+03  3.02940321e+03  3.02940321e+03
  6.64983201e+03  6.64983201e+03  6.64983201e+03  9.06639320e+03
  2.54216436e+04  7.61635895e+04]
E1 = -728.2566388678239  E_coul = 201.5174388326804
cycle= 1 E= -526.739200035144  delta_E= -1.88e-10  |g|= 1.03e-07  |ddm|= 0.000647
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2566388678239  E_coul = 201.5174388326804
  HOMO = -0.584070025587842  LUMO = 0.840865907700547
  mo_energy =
[-1.18581914e+02 -1.23130926e+01 -9.56412577e+00 -9.56412577e+00
 -9.56412577e+00 -1.27128688e+00 -5.84070026e-01 -5.84070026e-01
 -5.84070026e-01  8.40865908e-01  1.01052708e+00  1.01052708e+00
  1.01052708e+00  4.28005294e+00  7.31306306e+00  7.31306306e+00
  7.31306306e+00  1.82504161e+01  3.34940940e+01  3.34940940e+01
  3.34940940e+01  1.13062567e+02  1.29039662e+02  1.29039662e+02
  1.29039662e+02  4.83351824e+02  4.83351824e+02  4.83351824e+02
  5.94011492e+02  1.33517500e+03  1.33517500e+03  1.33517500e+03
  2.66145650e+03  3.02940321e+03  3.02940321e+03  3.02940321e+03
  6.64983201e+03  6.64983201e+03  6.64983201e+03  9.06639320e+03
  2.54216436e+04  7.61635895e+04]
E1 = -728.2566385051165  E_coul = 201.5174384701223
Extra cycle  E= -526.739200034994  delta_E= 1.49e-10  |g|= 2.57e-08  |ddm|= 7.81e-05
    CPU time for scf_cycle      0.94 sec, wall time      0.46 sec
exp = [2.61826563e+04 7.61752102e+03 3.61735129e+03 1.59780682e+03
 3.82865651e+02 1.08132536e+02 3.58660838e+01 8.20357072e+00
 3.46523330e+00 8.68975660e-01 8.59615945e-01 2.38712736e-01
 1.36278334e+03 6.64744324e+02 3.00955585e+02 3.14036750e+02
 6.16295923e+01 7.34796002e+00 2.02222582e+01 7.77095649e-01
 2.82867866e+00 2.21629822e-01]
grad_E = [-1.50200579e-06  3.14028063e-06 -1.66171934e-06  6.27115166e-05
  1.83107452e-04 -2.00257116e-03  3.40062030e-04 -1.60347829e-03
 -7.57377150e-04  8.49475724e-04  9.37890765e-04 -6.88076595e-03
 -5.11431734e-07  4.94487929e-06  2.32409516e-05  2.00387889e-05
  2.09536996e-05 -1.33051407e-04 -2.05645696e-04  9.44573391e-03
  1.01364670e-03 -3.41396710e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:30 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.656345         1
[INPUT] 0    0    [1    /1   ]  7617.52084433        1
[INPUT] 0    0    [1    /1   ]  3617.35137449        1
[INPUT] 0    0    [1    /1   ]  1597.8031559         1
[INPUT] 0    0    [1    /1   ]  382.86818188         1
[INPUT] 0    0    [1    /1   ]  108.136871943        1
[INPUT] 0    0    [1    /1   ]  36.0696670591        1
[INPUT] 0    0    [1    /1   ]  8.3596278841         1
[INPUT] 0    0    [1    /1   ]  3.55255303754        1
[INPUT] 0    0    [1    /1   ]  0.878681594987       1
[INPUT] 0    0    [1    /1   ]  0.955830275989       1
[INPUT] 0    0    [1    /1   ]  0.253874723216       1
[INPUT] 1    0    [1    /1   ]  1362.78336933        1
[INPUT] 1    0    [1    /1   ]  664.744060204        1
[INPUT] 1    0    [1    /1   ]  300.954340427        1
[INPUT] 1    0    [1    /1   ]  314.03567727         1
[INPUT] 1    0    [1    /1   ]  61.6309317592        1
[INPUT] 1    0    [1    /1   ]  7.35120208859        1
[INPUT] 1    0    [1    /1   ]  20.2195158299        1
[INPUT] 1    0    [1    /1   ]  0.777797844212       1
[INPUT] 1    0    [1    /1   ]  2.83077613349        1
[INPUT] 1    0    [1    /1   ]  0.221867899284       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656344988573, 1.0]], [0, [7617.520844330832, 1.0]], [0, [3617.351374488524, 1.0]], [0, [1597.8031559044339, 1.0]], [0, [382.86818187954833, 1.0]], [0, [108.13687194289322, 1.0]], [0, [36.0696670590985, 1.0]], [0, [8.359627884098348, 1.0]], [0, [3.5525530375350645, 1.0]], [0, [0.8786815949871051, 1.0]], [0, [0.9558302759885109, 1.0]], [0, [0.2538747232155565, 1.0]], [1, [1362.7833693303573, 1.0]], [1, [664.7440602038359, 1.0]], [1, [300.95434042703386, 1.0]], [1, [314.03567726997426, 1.0]], [1, [61.63093175921511, 1.0]], [1, [7.351202088585871, 1.0]], [1, [20.219515829895464, 1.0]], [1, [0.7777978442122132, 1.0]], [1, [2.830776133489911, 1.0]], [1, [0.22186789928362513, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65634499]
bas 1, expnt(s) = [7617.52084433]
bas 2, expnt(s) = [3617.35137449]
bas 3, expnt(s) = [1597.8031559]
bas 4, expnt(s) = [382.86818188]
bas 5, expnt(s) = [108.13687194]
bas 6, expnt(s) = [36.06966706]
bas 7, expnt(s) = [8.35962788]
bas 8, expnt(s) = [3.55255304]
bas 9, expnt(s) = [0.87868159]
bas 10, expnt(s) = [0.95583028]
bas 11, expnt(s) = [0.25387472]
bas 12, expnt(s) = [1362.78336933]
bas 13, expnt(s) = [664.7440602]
bas 14, expnt(s) = [300.95434043]
bas 15, expnt(s) = [314.03567727]
bas 16, expnt(s) = [61.63093176]
bas 17, expnt(s) = [7.35120209]
bas 18, expnt(s) = [20.21951583]
bas 19, expnt(s) = [0.77779784]
bas 20, expnt(s) = [2.83077613]
bas 21, expnt(s) = [0.2218679]
CPU time:        91.99
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826563e+04 5.20026294e+03 7.61752084e+03 2.06003815e+03
 3.61735137e+03 1.17844155e+03 1.59780316e+03 6.38494970e+02
 3.82868182e+02 2.18676433e+02 1.08136872e+02 8.47218394e+01
 3.60696671e+01 3.71853287e+01 8.35962788e+00 1.24209620e+01
 3.55255304e+00 6.53763172e+00 8.78681595e-01 2.29291878e+00
 9.55830276e-01 2.44230901e+00 2.53874723e-01 9.03607072e-01
 1.36278337e+03 2.41556053e+04 6.64744060e+02 9.84696681e+03
 3.00954340e+02 3.65687535e+03 3.14035677e+02 3.85663138e+03
 6.16309318e+01 5.03770590e+02 7.35120209e+00 3.53128155e+01
 2.02195158e+01 1.25082869e+02 7.77797844e-01 2.13092327e+00
 2.83077613e+00 1.07118948e+01 2.21867899e-01 4.44224474e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99366720681383
cond(S) = 111835.65463440295
E1 = -729.5196725759407  E_coul = 203.17207006078905
init E= -526.347602515152
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555881257846422  LUMO = 0.937989539977092
  mo_energy =
[-1.18328196e+02 -1.22064422e+01 -9.44738626e+00 -9.44738626e+00
 -9.44738626e+00 -1.24015731e+00 -5.55881258e-01 -5.55881258e-01
 -5.55881258e-01  9.37989540e-01  1.03148853e+00  1.03148853e+00
  1.03148853e+00  4.66621187e+00  7.39358767e+00  7.39358767e+00
  7.39358767e+00  1.93015153e+01  3.36327735e+01  3.36327735e+01
  3.36327735e+01  1.15135833e+02  1.29237585e+02  1.29237585e+02
  1.29237585e+02  4.83615926e+02  4.83615926e+02  4.83615926e+02
  5.96433606e+02  1.33548899e+03  1.33548899e+03  1.33548899e+03
  2.66384695e+03  3.02977846e+03  3.02977846e+03  3.02977846e+03
  6.65031679e+03  6.65031679e+03  6.65031679e+03  9.06874912e+03
  2.54239955e+04  7.61659141e+04]
E1 = -727.8252633669954  E_coul = 201.08679318533365
cycle= 1 E= -526.738470181662  delta_E= -0.391  |g|= 0.187  |ddm|= 3.39
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544203
diis-c [-0.29615647  1.        ]
  HOMO = -0.591000102593221  LUMO = 0.915735295213034
  mo_energy =
[-1.18638525e+02 -1.23446210e+01 -9.59671516e+00 -9.59671516e+00
 -9.59671516e+00 -1.28005248e+00 -5.91000103e-01 -5.91000103e-01
 -5.91000103e-01  9.15735295e-01  1.00690907e+00  1.00690907e+00
  1.00690907e+00  4.61111110e+00  7.30201320e+00  7.30201320e+00
  7.30201320e+00  1.91871359e+01  3.34777224e+01  3.34777224e+01
  3.34777224e+01  1.14914902e+02  1.29007570e+02  1.29007570e+02
  1.29007570e+02  4.83306979e+02  4.83306979e+02  4.83306979e+02
  5.96087096e+02  1.33512339e+03  1.33512339e+03  1.33512339e+03
  2.66334596e+03  3.02934592e+03  3.02934592e+03  3.02934592e+03
  6.64977046e+03  6.64977046e+03  6.64977046e+03  9.06812722e+03
  2.54232794e+04  7.61651079e+04]
E1 = -728.4042002977197  E_coul = 201.66499771692472
cycle= 2 E= -526.739202580795  delta_E= -0.000732  |g|= 0.038  |ddm|= 0.221
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0767288
diis-c [-0.00338323  0.0846532   0.9153468 ]
  HOMO = -0.5818949825606  LUMO = 0.922110306473845
  mo_energy =
[-1.18570318e+02 -1.23063134e+01 -9.55671815e+00 -9.55671815e+00
 -9.55671815e+00 -1.26915058e+00 -5.81894983e-01 -5.81894983e-01
 -5.81894983e-01  9.22110306e-01  1.01363552e+00  1.01363552e+00
  1.01363552e+00  4.62604523e+00  7.32596817e+00  7.32596817e+00
  7.32596817e+00  1.92183674e+01  3.35180716e+01  3.35180716e+01
  3.35180716e+01  1.14970768e+02  1.29063872e+02  1.29063872e+02
  1.29063872e+02  4.83374366e+02  4.83374366e+02  4.83374366e+02
  5.96156759e+02  1.33519486e+03  1.33519486e+03  1.33519486e+03
  2.66342075e+03  3.02941964e+03  3.02941964e+03  3.02941964e+03
  6.64984594e+03  6.64984594e+03  6.64984594e+03  9.06820352e+03
  2.54233563e+04  7.61651850e+04]
E1 = -728.2520963131809  E_coul = 201.51283321792275
cycle= 3 E= -526.739263095258  delta_E= -6.05e-05  |g|= 0.00628  |ddm|= 0.0715
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.013218
diis-c [-6.85532281e-07 -1.28502434e-03  1.42326701e-01  8.58958324e-01]
  HOMO = -0.58339661946325  LUMO = 0.921125013349904
  mo_energy =
[-1.18580278e+02 -1.23121322e+01 -9.56288586e+00 -9.56288586e+00
 -9.56288586e+00 -1.27085752e+00 -5.83396619e-01 -5.83396619e-01
 -5.83396619e-01  9.21125013e-01  1.01254895e+00  1.01254895e+00
  1.01254895e+00  4.62368645e+00  7.32216606e+00  7.32216606e+00
  7.32216606e+00  1.92135670e+01  3.35118883e+01  3.35118883e+01
  3.35118883e+01  1.14962523e+02  1.29055519e+02  1.29055519e+02
  1.29055519e+02  4.83364522e+02  4.83364522e+02  4.83364522e+02
  5.96146577e+02  1.33518443e+03  1.33518443e+03  1.33518443e+03
  2.66340969e+03  3.02940882e+03  3.02940882e+03  3.02940882e+03
  6.64983474e+03  6.64983474e+03  6.64983474e+03  9.06819210e+03
  2.54233447e+04  7.61651733e+04]
E1 = -728.2750335952047  E_coul = 201.53576856489602
cycle= 4 E= -526.739265030309  delta_E= -1.94e-06  |g|= 8.94e-05  |ddm|= 0.00543
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000103647
diis-c [-5.44507472e-09  7.00416430e-05 -1.00098551e-02 -6.35767411e-02
  1.07351655e+00]
  HOMO = -0.583375199546035  LUMO = 0.92115293490006
  mo_energy =
[-1.18580220e+02 -1.23120559e+01 -9.56282161e+00 -9.56282161e+00
 -9.56282161e+00 -1.27081578e+00 -5.83375200e-01 -5.83375200e-01
 -5.83375200e-01  9.21152935e-01  1.01256659e+00  1.01256659e+00
  1.01256659e+00  4.62373072e+00  7.32221570e+00  7.32221570e+00
  7.32221570e+00  1.92136323e+01  3.35119500e+01  3.35119500e+01
  3.35119500e+01  1.14962589e+02  1.29055582e+02  1.29055582e+02
  1.29055582e+02  4.83364580e+02  4.83364580e+02  4.83364580e+02
  5.96146628e+02  1.33518448e+03  1.33518448e+03  1.33518448e+03
  2.66340972e+03  3.02940886e+03  3.02940886e+03  3.02940886e+03
  6.64983476e+03  6.64983476e+03  6.64983476e+03  9.06819212e+03
  2.54233447e+04  7.61651733e+04]
E1 = -728.2747770172618  E_coul = 201.53551198567902
cycle= 5 E= -526.739265031583  delta_E= -1.27e-09  |g|= 1.97e-05  |ddm|= 0.00281
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.77098e-05
diis-c [-8.51265560e-11  1.18959510e-05 -1.48986228e-03 -1.16911908e-02
  3.19782174e-02  9.81190940e-01]
  HOMO = -0.583382737608122  LUMO = 0.921149599506423
  mo_energy =
[-1.18580250e+02 -1.23120789e+01 -9.56284640e+00 -9.56284640e+00
 -9.56284640e+00 -1.27082227e+00 -5.83382738e-01 -5.83382738e-01
 -5.83382738e-01  9.21149600e-01  1.01256152e+00  1.01256152e+00
  1.01256152e+00  4.62372053e+00  7.32219876e+00  7.32219876e+00
  7.32219876e+00  1.92136126e+01  3.35119260e+01  3.35119260e+01
  3.35119260e+01  1.14962562e+02  1.29055554e+02  1.29055554e+02
  1.29055554e+02  4.83364550e+02  4.83364550e+02  4.83364550e+02
  5.96146597e+02  1.33518445e+03  1.33518445e+03  1.33518445e+03
  2.66340969e+03  3.02940883e+03  3.02940883e+03  3.02940883e+03
  6.64983473e+03  6.64983473e+03  6.64983473e+03  9.06819208e+03
  2.54233447e+04  7.61651733e+04]
E1 = -728.2748611050218  E_coul = 201.53559607339014
cycle= 6 E= -526.739265031632  delta_E= -4.89e-11  |g|= 1.61e-06  |ddm|= 0.000362
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2748611050218  E_coul = 201.53559607339014
  HOMO = -0.583382584244765  LUMO = 0.921149974583701
  mo_energy =
[-1.18580249e+02 -1.23120782e+01 -9.56284576e+00 -9.56284576e+00
 -9.56284576e+00 -1.27082176e+00 -5.83382584e-01 -5.83382584e-01
 -5.83382584e-01  9.21149975e-01  1.01256168e+00  1.01256168e+00
  1.01256168e+00  4.62372097e+00  7.32219920e+00  7.32219920e+00
  7.32219920e+00  1.92136132e+01  3.35119266e+01  3.35119266e+01
  3.35119266e+01  1.14962562e+02  1.29055555e+02  1.29055555e+02
  1.29055555e+02  4.83364551e+02  4.83364551e+02  4.83364551e+02
  5.96146598e+02  1.33518445e+03  1.33518445e+03  1.33518445e+03
  2.66340969e+03  3.02940883e+03  3.02940883e+03  3.02940883e+03
  6.64983473e+03  6.64983473e+03  6.64983473e+03  9.06819208e+03
  2.54233447e+04  7.61651733e+04]
E1 = -728.2748582025894  E_coul = 201.53559317095656
Extra cycle  E= -526.739265031633  delta_E= -1.14e-12  |g|= 3.35e-07  |ddm|= 5.77e-05
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826563e+04 7.61752084e+03 3.61735137e+03 1.59780316e+03
 3.82868182e+02 1.08136872e+02 3.60696671e+01 8.35962788e+00
 3.55255304e+00 8.78681595e-01 9.55830276e-01 2.53874723e-01
 1.36278337e+03 6.64744060e+02 3.00954340e+02 3.14035677e+02
 6.16309318e+01 7.35120209e+00 2.02195158e+01 7.77797844e-01
 2.83077613e+00 2.21867899e-01]
E = -526.7392650316328
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:30 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.656345         1
[INPUT] 0    0    [1    /1   ]  7617.52084433        1
[INPUT] 0    0    [1    /1   ]  3617.35137449        1
[INPUT] 0    0    [1    /1   ]  1597.8031559         1
[INPUT] 0    0    [1    /1   ]  382.86818188         1
[INPUT] 0    0    [1    /1   ]  108.136871943        1
[INPUT] 0    0    [1    /1   ]  36.0696670591        1
[INPUT] 0    0    [1    /1   ]  8.3596278841         1
[INPUT] 0    0    [1    /1   ]  3.55255303754        1
[INPUT] 0    0    [1    /1   ]  0.878681594987       1
[INPUT] 0    0    [1    /1   ]  0.955830275989       1
[INPUT] 0    0    [1    /1   ]  0.253874723216       1
[INPUT] 1    0    [1    /1   ]  1362.78336933        1
[INPUT] 1    0    [1    /1   ]  664.744060204        1
[INPUT] 1    0    [1    /1   ]  300.954340427        1
[INPUT] 1    0    [1    /1   ]  314.03567727         1
[INPUT] 1    0    [1    /1   ]  61.6309317592        1
[INPUT] 1    0    [1    /1   ]  7.35120208859        1
[INPUT] 1    0    [1    /1   ]  20.2195158299        1
[INPUT] 1    0    [1    /1   ]  0.777797844212       1
[INPUT] 1    0    [1    /1   ]  2.83077613349        1
[INPUT] 1    0    [1    /1   ]  0.221867899284       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656344988573, 1.0]], [0, [7617.520844330832, 1.0]], [0, [3617.351374488524, 1.0]], [0, [1597.8031559044339, 1.0]], [0, [382.86818187954833, 1.0]], [0, [108.13687194289322, 1.0]], [0, [36.0696670590985, 1.0]], [0, [8.359627884098348, 1.0]], [0, [3.5525530375350645, 1.0]], [0, [0.8786815949871051, 1.0]], [0, [0.9558302759885109, 1.0]], [0, [0.2538747232155565, 1.0]], [1, [1362.7833693303573, 1.0]], [1, [664.7440602038359, 1.0]], [1, [300.95434042703386, 1.0]], [1, [314.03567726997426, 1.0]], [1, [61.63093175921511, 1.0]], [1, [7.351202088585871, 1.0]], [1, [20.219515829895464, 1.0]], [1, [0.7777978442122132, 1.0]], [1, [2.830776133489911, 1.0]], [1, [0.22186789928362513, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65634499]
bas 1, expnt(s) = [7617.52084433]
bas 2, expnt(s) = [3617.35137449]
bas 3, expnt(s) = [1597.8031559]
bas 4, expnt(s) = [382.86818188]
bas 5, expnt(s) = [108.13687194]
bas 6, expnt(s) = [36.06966706]
bas 7, expnt(s) = [8.35962788]
bas 8, expnt(s) = [3.55255304]
bas 9, expnt(s) = [0.87868159]
bas 10, expnt(s) = [0.95583028]
bas 11, expnt(s) = [0.25387472]
bas 12, expnt(s) = [1362.78336933]
bas 13, expnt(s) = [664.7440602]
bas 14, expnt(s) = [300.95434043]
bas 15, expnt(s) = [314.03567727]
bas 16, expnt(s) = [61.63093176]
bas 17, expnt(s) = [7.35120209]
bas 18, expnt(s) = [20.21951583]
bas 19, expnt(s) = [0.77779784]
bas 20, expnt(s) = [2.83077613]
bas 21, expnt(s) = [0.2218679]
CPU time:        92.34
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826563e+04 5.20026294e+03 7.61752084e+03 2.06003815e+03
 3.61735137e+03 1.17844155e+03 1.59780316e+03 6.38494970e+02
 3.82868182e+02 2.18676433e+02 1.08136872e+02 8.47218394e+01
 3.60696671e+01 3.71853287e+01 8.35962788e+00 1.24209620e+01
 3.55255304e+00 6.53763172e+00 8.78681595e-01 2.29291878e+00
 9.55830276e-01 2.44230901e+00 2.53874723e-01 9.03607072e-01
 1.36278337e+03 2.41556053e+04 6.64744060e+02 9.84696681e+03
 3.00954340e+02 3.65687535e+03 3.14035677e+02 3.85663138e+03
 6.16309318e+01 5.03770590e+02 7.35120209e+00 3.53128155e+01
 2.02195158e+01 1.25082869e+02 7.77797844e-01 2.13092327e+00
 2.83077613e+00 1.07118948e+01 2.21867899e-01 4.44224474e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99366720681383
cond(S) = 111835.65463440295
E1 = -729.5196725759407  E_coul = 203.17207006078905
init E= -526.347602515152
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555881257846422  LUMO = 0.937989539977092
  mo_energy =
[-1.18328196e+02 -1.22064422e+01 -9.44738626e+00 -9.44738626e+00
 -9.44738626e+00 -1.24015731e+00 -5.55881258e-01 -5.55881258e-01
 -5.55881258e-01  9.37989540e-01  1.03148853e+00  1.03148853e+00
  1.03148853e+00  4.66621187e+00  7.39358767e+00  7.39358767e+00
  7.39358767e+00  1.93015153e+01  3.36327735e+01  3.36327735e+01
  3.36327735e+01  1.15135833e+02  1.29237585e+02  1.29237585e+02
  1.29237585e+02  4.83615926e+02  4.83615926e+02  4.83615926e+02
  5.96433606e+02  1.33548899e+03  1.33548899e+03  1.33548899e+03
  2.66384695e+03  3.02977846e+03  3.02977846e+03  3.02977846e+03
  6.65031679e+03  6.65031679e+03  6.65031679e+03  9.06874912e+03
  2.54239955e+04  7.61659141e+04]
E1 = -727.8252633669954  E_coul = 201.08679318533365
cycle= 1 E= -526.738470181662  delta_E= -0.391  |g|= 0.187  |ddm|= 3.39
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544203
diis-c [-0.29615647  1.        ]
  HOMO = -0.591000102593221  LUMO = 0.915735295213034
  mo_energy =
[-1.18638525e+02 -1.23446210e+01 -9.59671516e+00 -9.59671516e+00
 -9.59671516e+00 -1.28005248e+00 -5.91000103e-01 -5.91000103e-01
 -5.91000103e-01  9.15735295e-01  1.00690907e+00  1.00690907e+00
  1.00690907e+00  4.61111110e+00  7.30201320e+00  7.30201320e+00
  7.30201320e+00  1.91871359e+01  3.34777224e+01  3.34777224e+01
  3.34777224e+01  1.14914902e+02  1.29007570e+02  1.29007570e+02
  1.29007570e+02  4.83306979e+02  4.83306979e+02  4.83306979e+02
  5.96087096e+02  1.33512339e+03  1.33512339e+03  1.33512339e+03
  2.66334596e+03  3.02934592e+03  3.02934592e+03  3.02934592e+03
  6.64977046e+03  6.64977046e+03  6.64977046e+03  9.06812722e+03
  2.54232794e+04  7.61651079e+04]
E1 = -728.4042002977197  E_coul = 201.66499771692472
cycle= 2 E= -526.739202580795  delta_E= -0.000732  |g|= 0.038  |ddm|= 0.221
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0767288
diis-c [-0.00338323  0.0846532   0.9153468 ]
  HOMO = -0.5818949825606  LUMO = 0.922110306473845
  mo_energy =
[-1.18570318e+02 -1.23063134e+01 -9.55671815e+00 -9.55671815e+00
 -9.55671815e+00 -1.26915058e+00 -5.81894983e-01 -5.81894983e-01
 -5.81894983e-01  9.22110306e-01  1.01363552e+00  1.01363552e+00
  1.01363552e+00  4.62604523e+00  7.32596817e+00  7.32596817e+00
  7.32596817e+00  1.92183674e+01  3.35180716e+01  3.35180716e+01
  3.35180716e+01  1.14970768e+02  1.29063872e+02  1.29063872e+02
  1.29063872e+02  4.83374366e+02  4.83374366e+02  4.83374366e+02
  5.96156759e+02  1.33519486e+03  1.33519486e+03  1.33519486e+03
  2.66342075e+03  3.02941964e+03  3.02941964e+03  3.02941964e+03
  6.64984594e+03  6.64984594e+03  6.64984594e+03  9.06820352e+03
  2.54233563e+04  7.61651850e+04]
E1 = -728.2520963131809  E_coul = 201.51283321792275
cycle= 3 E= -526.739263095258  delta_E= -6.05e-05  |g|= 0.00628  |ddm|= 0.0715
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.013218
diis-c [-6.85532281e-07 -1.28502434e-03  1.42326701e-01  8.58958324e-01]
  HOMO = -0.58339661946325  LUMO = 0.921125013349904
  mo_energy =
[-1.18580278e+02 -1.23121322e+01 -9.56288586e+00 -9.56288586e+00
 -9.56288586e+00 -1.27085752e+00 -5.83396619e-01 -5.83396619e-01
 -5.83396619e-01  9.21125013e-01  1.01254895e+00  1.01254895e+00
  1.01254895e+00  4.62368645e+00  7.32216606e+00  7.32216606e+00
  7.32216606e+00  1.92135670e+01  3.35118883e+01  3.35118883e+01
  3.35118883e+01  1.14962523e+02  1.29055519e+02  1.29055519e+02
  1.29055519e+02  4.83364522e+02  4.83364522e+02  4.83364522e+02
  5.96146577e+02  1.33518443e+03  1.33518443e+03  1.33518443e+03
  2.66340969e+03  3.02940882e+03  3.02940882e+03  3.02940882e+03
  6.64983474e+03  6.64983474e+03  6.64983474e+03  9.06819210e+03
  2.54233447e+04  7.61651733e+04]
E1 = -728.2750335952047  E_coul = 201.53576856489602
cycle= 4 E= -526.739265030309  delta_E= -1.94e-06  |g|= 8.94e-05  |ddm|= 0.00543
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000103647
diis-c [-5.44507472e-09  7.00416430e-05 -1.00098551e-02 -6.35767411e-02
  1.07351655e+00]
  HOMO = -0.583375199546035  LUMO = 0.92115293490006
  mo_energy =
[-1.18580220e+02 -1.23120559e+01 -9.56282161e+00 -9.56282161e+00
 -9.56282161e+00 -1.27081578e+00 -5.83375200e-01 -5.83375200e-01
 -5.83375200e-01  9.21152935e-01  1.01256659e+00  1.01256659e+00
  1.01256659e+00  4.62373072e+00  7.32221570e+00  7.32221570e+00
  7.32221570e+00  1.92136323e+01  3.35119500e+01  3.35119500e+01
  3.35119500e+01  1.14962589e+02  1.29055582e+02  1.29055582e+02
  1.29055582e+02  4.83364580e+02  4.83364580e+02  4.83364580e+02
  5.96146628e+02  1.33518448e+03  1.33518448e+03  1.33518448e+03
  2.66340972e+03  3.02940886e+03  3.02940886e+03  3.02940886e+03
  6.64983476e+03  6.64983476e+03  6.64983476e+03  9.06819212e+03
  2.54233447e+04  7.61651733e+04]
E1 = -728.2747770172618  E_coul = 201.53551198567902
cycle= 5 E= -526.739265031583  delta_E= -1.27e-09  |g|= 1.97e-05  |ddm|= 0.00281
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.77098e-05
diis-c [-8.51265560e-11  1.18959510e-05 -1.48986228e-03 -1.16911908e-02
  3.19782174e-02  9.81190940e-01]
  HOMO = -0.583382737608122  LUMO = 0.921149599506423
  mo_energy =
[-1.18580250e+02 -1.23120789e+01 -9.56284640e+00 -9.56284640e+00
 -9.56284640e+00 -1.27082227e+00 -5.83382738e-01 -5.83382738e-01
 -5.83382738e-01  9.21149600e-01  1.01256152e+00  1.01256152e+00
  1.01256152e+00  4.62372053e+00  7.32219876e+00  7.32219876e+00
  7.32219876e+00  1.92136126e+01  3.35119260e+01  3.35119260e+01
  3.35119260e+01  1.14962562e+02  1.29055554e+02  1.29055554e+02
  1.29055554e+02  4.83364550e+02  4.83364550e+02  4.83364550e+02
  5.96146597e+02  1.33518445e+03  1.33518445e+03  1.33518445e+03
  2.66340969e+03  3.02940883e+03  3.02940883e+03  3.02940883e+03
  6.64983473e+03  6.64983473e+03  6.64983473e+03  9.06819208e+03
  2.54233447e+04  7.61651733e+04]
E1 = -728.2748611050218  E_coul = 201.53559607339014
cycle= 6 E= -526.739265031632  delta_E= -4.89e-11  |g|= 1.61e-06  |ddm|= 0.000362
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2748611050218  E_coul = 201.53559607339014
  HOMO = -0.583382584244765  LUMO = 0.921149974583701
  mo_energy =
[-1.18580249e+02 -1.23120782e+01 -9.56284576e+00 -9.56284576e+00
 -9.56284576e+00 -1.27082176e+00 -5.83382584e-01 -5.83382584e-01
 -5.83382584e-01  9.21149975e-01  1.01256168e+00  1.01256168e+00
  1.01256168e+00  4.62372097e+00  7.32219920e+00  7.32219920e+00
  7.32219920e+00  1.92136132e+01  3.35119266e+01  3.35119266e+01
  3.35119266e+01  1.14962562e+02  1.29055555e+02  1.29055555e+02
  1.29055555e+02  4.83364551e+02  4.83364551e+02  4.83364551e+02
  5.96146598e+02  1.33518445e+03  1.33518445e+03  1.33518445e+03
  2.66340969e+03  3.02940883e+03  3.02940883e+03  3.02940883e+03
  6.64983473e+03  6.64983473e+03  6.64983473e+03  9.06819208e+03
  2.54233447e+04  7.61651733e+04]
E1 = -728.2748582025894  E_coul = 201.53559317095656
Extra cycle  E= -526.739265031633  delta_E= -1.14e-12  |g|= 3.35e-07  |ddm|= 5.77e-05
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111835.65463440295
E1 = -728.2748582025894  E_coul = 201.53559317095656
init E= -526.739265031633
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583382651975265  LUMO = 0.921149982919253
  mo_energy =
[-1.18580250e+02 -1.23120784e+01 -9.56284600e+00 -9.56284600e+00
 -9.56284600e+00 -1.27082177e+00 -5.83382652e-01 -5.83382652e-01
 -5.83382652e-01  9.21149983e-01  1.01256164e+00  1.01256164e+00
  1.01256164e+00  4.62372090e+00  7.32219905e+00  7.32219905e+00
  7.32219905e+00  1.92136131e+01  3.35119264e+01  3.35119264e+01
  3.35119264e+01  1.14962562e+02  1.29055554e+02  1.29055554e+02
  1.29055554e+02  4.83364550e+02  4.83364550e+02  4.83364550e+02
  5.96146598e+02  1.33518445e+03  1.33518445e+03  1.33518445e+03
  2.66340969e+03  3.02940883e+03  3.02940883e+03  3.02940883e+03
  6.64983473e+03  6.64983473e+03  6.64983473e+03  9.06819208e+03
  2.54233447e+04  7.61651733e+04]
E1 = -728.2748589309556  E_coul = 201.53559389932246
cycle= 1 E= -526.739265031633  delta_E= -2.27e-13  |g|= 7.97e-08  |ddm|= 1.14e-05
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2748589309556  E_coul = 201.53559389932246
  HOMO = -0.583382640510574  LUMO = 0.92115000175268
  mo_energy =
[-1.18580250e+02 -1.23120783e+01 -9.56284594e+00 -9.56284594e+00
 -9.56284594e+00 -1.27082174e+00 -5.83382641e-01 -5.83382641e-01
 -5.83382641e-01  9.21150002e-01  1.01256165e+00  1.01256165e+00
  1.01256165e+00  4.62372093e+00  7.32219908e+00  7.32219908e+00
  7.32219908e+00  1.92136131e+01  3.35119264e+01  3.35119264e+01
  3.35119264e+01  1.14962562e+02  1.29055555e+02  1.29055555e+02
  1.29055555e+02  4.83364551e+02  4.83364551e+02  4.83364551e+02
  5.96146598e+02  1.33518445e+03  1.33518445e+03  1.33518445e+03
  2.66340969e+03  3.02940883e+03  3.02940883e+03  3.02940883e+03
  6.64983473e+03  6.64983473e+03  6.64983473e+03  9.06819208e+03
  2.54233447e+04  7.61651733e+04]
E1 = -728.2748587056391  E_coul = 201.53559367400447
Extra cycle  E= -526.739265031635  delta_E= -1.59e-12  |g|= 1.77e-08  |ddm|= 2.39e-06
    CPU time for scf_cycle      1.12 sec, wall time      0.64 sec
exp = [2.61826563e+04 7.61752084e+03 3.61735137e+03 1.59780316e+03
 3.82868182e+02 1.08136872e+02 3.60696671e+01 8.35962788e+00
 3.55255304e+00 8.78681595e-01 9.55830276e-01 2.53874723e-01
 1.36278337e+03 6.64744060e+02 3.00954340e+02 3.14035677e+02
 6.16309318e+01 7.35120209e+00 2.02195158e+01 7.77797844e-01
 2.83077613e+00 2.21867899e-01]
grad_E = [-1.49897129e-06  3.10757329e-06 -1.67575955e-06  6.14154361e-05
  2.26327128e-04 -2.34056707e-03  1.05669210e-03 -1.31640876e-03
 -8.48981289e-04 -1.73889491e-04 -4.05280425e-04  1.70888059e-02
 -5.12894036e-07  4.92428777e-06  2.31169500e-05  1.99322005e-05
  3.43988929e-05  6.18285189e-05 -3.02439149e-04  9.95875640e-03
  9.00438893e-04 -3.50713606e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:35 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6563367        1
[INPUT] 0    0    [1    /1   ]  7617.52086264        1
[INPUT] 0    0    [1    /1   ]  3617.35136601        1
[INPUT] 0    0    [1    /1   ]  1597.80354466        1
[INPUT] 0    0    [1    /1   ]  382.867640621        1
[INPUT] 0    0    [1    /1   ]  108.138696065        1
[INPUT] 0    0    [1    /1   ]  36.0437013349        1
[INPUT] 0    0    [1    /1   ]  8.34479674246        1
[INPUT] 0    0    [1    /1   ]  3.53595563701        1
[INPUT] 0    0    [1    /1   ]  0.877224693506       1
[INPUT] 0    0    [1    /1   ]  0.941660042266       1
[INPUT] 0    0    [1    /1   ]  0.24788023473        1
[INPUT] 1    0    [1    /1   ]  1362.78336658        1
[INPUT] 1    0    [1    /1   ]  664.7440877          1
[INPUT] 1    0    [1    /1   ]  300.954470342        1
[INPUT] 1    0    [1    /1   ]  314.03578928         1
[INPUT] 1    0    [1    /1   ]  61.6307290071        1
[INPUT] 1    0    [1    /1   ]  7.35064849108        1
[INPUT] 1    0    [1    /1   ]  20.2201799574        1
[INPUT] 1    0    [1    /1   ]  0.777441478173       1
[INPUT] 1    0    [1    /1   ]  2.82945596521        1
[INPUT] 1    0    [1    /1   ]  0.222271895918       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656336690106, 1.0]], [0, [7617.520862639214, 1.0]], [0, [3617.351366009695, 1.0]], [0, [1597.8035446560677, 1.0]], [0, [382.86764062088696, 1.0]], [0, [108.13869606459811, 1.0]], [0, [36.04370133493291, 1.0]], [0, [8.344796742457572, 1.0]], [0, [3.535955637012821, 1.0]], [0, [0.8772246935060584, 1.0]], [0, [0.9416600422659775, 1.0]], [0, [0.2478802347297998, 1.0]], [1, [1362.783366579703, 1.0]], [1, [664.744087699794, 1.0]], [1, [300.9544703418293, 1.0]], [1, [314.03578927992146, 1.0]], [1, [61.6307290070564, 1.0]], [1, [7.3506484910756695, 1.0]], [1, [20.22017995744717, 1.0]], [1, [0.7774414781729897, 1.0]], [1, [2.8294559652086266, 1.0]], [1, [0.22227189591774718, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65633669]
bas 1, expnt(s) = [7617.52086264]
bas 2, expnt(s) = [3617.35136601]
bas 3, expnt(s) = [1597.80354466]
bas 4, expnt(s) = [382.86764062]
bas 5, expnt(s) = [108.13869606]
bas 6, expnt(s) = [36.04370133]
bas 7, expnt(s) = [8.34479674]
bas 8, expnt(s) = [3.53595564]
bas 9, expnt(s) = [0.87722469]
bas 10, expnt(s) = [0.94166004]
bas 11, expnt(s) = [0.24788023]
bas 12, expnt(s) = [1362.78336658]
bas 13, expnt(s) = [664.7440877]
bas 14, expnt(s) = [300.95447034]
bas 15, expnt(s) = [314.03578928]
bas 16, expnt(s) = [61.63072901]
bas 17, expnt(s) = [7.35064849]
bas 18, expnt(s) = [20.22017996]
bas 19, expnt(s) = [0.77744148]
bas 20, expnt(s) = [2.82945597]
bas 21, expnt(s) = [0.2222719]
CPU time:        98.34
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826563e+04 5.20026294e+03 7.61752086e+03 2.06003815e+03
 3.61735137e+03 1.17844155e+03 1.59780354e+03 6.38495086e+02
 3.82867641e+02 2.18676201e+02 1.08138696e+02 8.47229113e+01
 3.60437013e+01 3.71652502e+01 8.34479674e+00 1.24044310e+01
 3.53595564e+00 6.51471063e+00 8.77224694e-01 2.29006685e+00
 9.41660042e-01 2.41510285e+00 2.47880235e-01 8.87557398e-01
 1.36278337e+03 2.41556052e+04 6.64744088e+02 9.84696732e+03
 3.00954470e+02 3.65687732e+03 3.14035789e+02 3.85663310e+03
 6.16307290e+01 5.03768518e+02 7.35064849e+00 3.53094914e+01
 2.02201800e+01 1.25088004e+02 7.77441478e-01 2.12970292e+00
 2.82945597e+00 1.07056506e+01 2.22271896e-01 4.45235808e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99369170331616
cond(S) = 111654.06396043024
E1 = -729.5186600123113  E_coul = 203.1711071915203
init E= -526.347552820791
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555902962394588  LUMO = 0.915336262949855
  mo_energy =
[-1.18328257e+02 -1.22065298e+01 -9.44747352e+00 -9.44747352e+00
 -9.44747352e+00 -1.24019281e+00 -5.55902962e-01 -5.55902962e-01
 -5.55902962e-01  9.15336263e-01  1.03272232e+00  1.03272232e+00
  1.03272232e+00  4.59730291e+00  7.39129286e+00  7.39129286e+00
  7.39129286e+00  1.91409308e+01  3.36270500e+01  3.36270500e+01
  3.36270500e+01  1.14864860e+02  1.29232670e+02  1.29232670e+02
  1.29232670e+02  4.83612343e+02  4.83612343e+02  4.83612343e+02
  5.96144781e+02  1.33548609e+03  1.33548609e+03  1.33548609e+03
  2.66358699e+03  3.02977612e+03  3.02977612e+03  3.02977612e+03
  6.65031493e+03  6.65031493e+03  6.65031493e+03  9.06851028e+03
  2.54237697e+04  7.61657039e+04]
E1 = -727.8231704178976  E_coul = 201.08462996602486
cycle= 1 E= -526.738540451873  delta_E= -0.391  |g|= 0.187  |ddm|=  6.8
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.54447
diis-c [-0.2964479  1.       ]
  HOMO = -0.591044675718021  LUMO = 0.893590270297869
  mo_energy =
[-1.18638827e+02 -1.23447834e+01 -9.59692728e+00 -9.59692728e+00
 -9.59692728e+00 -1.27993561e+00 -5.91044676e-01 -5.91044676e-01
 -5.91044676e-01  8.93590270e-01  1.00812932e+00  1.00812932e+00
  1.00812932e+00  4.54258477e+00  7.29977304e+00  7.29977304e+00
  7.29977304e+00  1.90267545e+01  3.34718644e+01  3.34718644e+01
  3.34718644e+01  1.14643743e+02  1.29002470e+02  1.29002470e+02
  1.29002470e+02  4.83303149e+02  4.83303149e+02  4.83303149e+02
  5.95798012e+02  1.33512023e+03  1.33512023e+03  1.33512023e+03
  2.66308572e+03  3.02934331e+03  3.02934331e+03  3.02934331e+03
  6.64976833e+03  6.64976833e+03  6.64976833e+03  9.06788808e+03
  2.54230533e+04  7.61648973e+04]
E1 = -728.4013072853859  E_coul = 201.66203327132143
cycle= 2 E= -526.739274014064  delta_E= -0.000734  |g|= 0.038  |ddm|= 0.494
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0767129
diis-c [-0.00337848  0.08464985  0.91535015]
  HOMO = -0.581969509886034  LUMO = 0.899849767920667
  mo_energy =
[-1.18570652e+02 -1.23065279e+01 -9.55698713e+00 -9.55698713e+00
 -9.55698713e+00 -1.26905429e+00 -5.81969510e-01 -5.81969510e-01
 -5.81969510e-01  8.99849768e-01  1.01483931e+00  1.01483931e+00
  1.01483931e+00  4.55739067e+00  7.32367303e+00  7.32367303e+00
  7.32367303e+00  1.90578864e+01  3.35121601e+01  3.35121601e+01
  3.35121601e+01  1.14699567e+02  1.29058732e+02  1.29058732e+02
  1.29058732e+02  4.83370502e+02  4.83370502e+02  4.83370502e+02
  5.95867644e+02  1.33519166e+03  1.33519166e+03  1.33519166e+03
  2.66316048e+03  3.02941700e+03  3.02941700e+03  3.02941700e+03
  6.64984377e+03  6.64984377e+03  6.64984377e+03  9.06796434e+03
  2.54231302e+04  7.61649745e+04]
E1 = -728.249350692539  E_coul = 201.51001622824592
cycle= 3 E= -526.739334464293  delta_E= -6.05e-05  |g|= 0.00628  |ddm|= 0.104
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132127
diis-c [-7.24508711e-07 -1.28921034e-03  1.42265857e-01  8.59023353e-01]
  HOMO = -0.583473139151175  LUMO = 0.898886011074381
  mo_energy =
[-1.18580604e+02 -1.23123416e+01 -9.56315147e+00 -9.56315147e+00
 -9.56315147e+00 -1.27075416e+00 -5.83473139e-01 -5.83473139e-01
 -5.83473139e-01  8.98886011e-01  1.01375220e+00  1.01375220e+00
  1.01375220e+00  4.55504886e+00  7.31987328e+00  7.31987328e+00
  7.31987328e+00  1.90530976e+01  3.35059806e+01  3.35059806e+01
  3.35059806e+01  1.14691329e+02  1.29050385e+02  1.29050385e+02
  1.29050385e+02  4.83360666e+02  4.83360666e+02  4.83360666e+02
  5.95857469e+02  1.33518124e+03  1.33518124e+03  1.33518124e+03
  2.66314942e+03  3.02940619e+03  3.02940619e+03  3.02940619e+03
  6.64983257e+03  6.64983257e+03  6.64983257e+03  9.06795293e+03
  2.54231186e+04  7.61649627e+04]
E1 = -728.2722371399337  E_coul = 201.5329007428266
cycle= 4 E= -526.739336397107  delta_E= -1.93e-06  |g|= 9.74e-05  |ddm|= 0.0115
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00011192
diis-c [-6.05570789e-09  7.74438970e-05 -1.09098719e-02 -6.93796320e-02
  1.08021206e+00]
  HOMO = -0.583452557924205  LUMO = 0.898914807657414
  mo_energy =
[-1.18580547e+02 -1.23122655e+01 -9.56308818e+00 -9.56308818e+00
 -9.56308818e+00 -1.27071092e+00 -5.83452558e-01 -5.83452558e-01
 -5.83452558e-01  8.98914808e-01  1.01376958e+00  1.01376958e+00
  1.01376958e+00  4.55509319e+00  7.31992216e+00  7.31992216e+00
  7.31992216e+00  1.90531627e+01  3.35060414e+01  3.35060414e+01
  3.35060414e+01  1.14691394e+02  1.29050447e+02  1.29050447e+02
  1.29050447e+02  4.83360723e+02  4.83360723e+02  4.83360723e+02
  5.95857519e+02  1.33518129e+03  1.33518129e+03  1.33518129e+03
  2.66314945e+03  3.02940623e+03  3.02940623e+03  3.02940623e+03
  6.64983259e+03  6.64983259e+03  6.64983259e+03  9.06795294e+03
  2.54231186e+04  7.61649627e+04]
E1 = -728.2719767944748  E_coul = 201.5326403957294
cycle= 5 E= -526.739336398745  delta_E= -1.64e-09  |g|= 2.06e-05  |ddm|= 0.0048
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.91459e-05
diis-c [-1.00388103e-10  1.24677524e-05 -1.54075868e-03 -1.20929605e-02
  2.49707786e-02  9.88650473e-01]
  HOMO = -0.583460510583264  LUMO = 0.898911483207816
  mo_energy =
[-1.18580579e+02 -1.23122896e+01 -9.56311415e+00 -9.56311415e+00
 -9.56311415e+00 -1.27071759e+00 -5.83460511e-01 -5.83460511e-01
 -5.83460511e-01  8.98911483e-01  1.01376426e+00  1.01376426e+00
  1.01376426e+00  4.55508262e+00  7.31990439e+00  7.31990439e+00
  7.31990439e+00  1.90531421e+01  3.35060162e+01  3.35060162e+01
  3.35060162e+01  1.14691365e+02  1.29050417e+02  1.29050417e+02
  1.29050417e+02  4.83360691e+02  4.83360691e+02  4.83360691e+02
  5.95857487e+02  1.33518126e+03  1.33518126e+03  1.33518126e+03
  2.66314942e+03  3.02940620e+03  3.02940620e+03  3.02940620e+03
  6.64983256e+03  6.64983256e+03  6.64983256e+03  9.06795291e+03
  2.54231185e+04  7.61649627e+04]
E1 = -728.2720642098357  E_coul = 201.5327278110349
cycle= 6 E= -526.739336398801  delta_E= -5.55e-11  |g|= 1.69e-06  |ddm|= 0.000594
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2720642098357  E_coul = 201.5327278110349
  HOMO = -0.583460288003797  LUMO = 0.898911905284903
  mo_energy =
[-1.18580578e+02 -1.23122887e+01 -9.56311326e+00 -9.56311326e+00
 -9.56311326e+00 -1.27071699e+00 -5.83460288e-01 -5.83460288e-01
 -5.83460288e-01  8.98911905e-01  1.01376447e+00  1.01376447e+00
  1.01376447e+00  4.55508317e+00  7.31990500e+00  7.31990500e+00
  7.31990500e+00  1.90531429e+01  3.35060171e+01  3.35060171e+01
  3.35060171e+01  1.14691366e+02  1.29050419e+02  1.29050419e+02
  1.29050419e+02  4.83360693e+02  4.83360693e+02  4.83360693e+02
  5.95857488e+02  1.33518126e+03  1.33518126e+03  1.33518126e+03
  2.66314942e+03  3.02940620e+03  3.02940620e+03  3.02940620e+03
  6.64983256e+03  6.64983256e+03  6.64983256e+03  9.06795291e+03
  2.54231185e+04  7.61649627e+04]
E1 = -728.2720603713075  E_coul = 201.53272397250413
Extra cycle  E= -526.739336398803  delta_E= -2.5e-12  |g|= 3.64e-07  |ddm|= 8.12e-05
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826563e+04 7.61752086e+03 3.61735137e+03 1.59780354e+03
 3.82867641e+02 1.08138696e+02 3.60437013e+01 8.34479674e+00
 3.53595564e+00 8.77224694e-01 9.41660042e-01 2.47880235e-01
 1.36278337e+03 6.64744088e+02 3.00954470e+02 3.14035789e+02
 6.16307290e+01 7.35064849e+00 2.02201800e+01 7.77441478e-01
 2.82945597e+00 2.22271896e-01]
E = -526.7393363988033
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:36 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6563367        1
[INPUT] 0    0    [1    /1   ]  7617.52086264        1
[INPUT] 0    0    [1    /1   ]  3617.35136601        1
[INPUT] 0    0    [1    /1   ]  1597.80354466        1
[INPUT] 0    0    [1    /1   ]  382.867640621        1
[INPUT] 0    0    [1    /1   ]  108.138696065        1
[INPUT] 0    0    [1    /1   ]  36.0437013349        1
[INPUT] 0    0    [1    /1   ]  8.34479674246        1
[INPUT] 0    0    [1    /1   ]  3.53595563701        1
[INPUT] 0    0    [1    /1   ]  0.877224693506       1
[INPUT] 0    0    [1    /1   ]  0.941660042266       1
[INPUT] 0    0    [1    /1   ]  0.24788023473        1
[INPUT] 1    0    [1    /1   ]  1362.78336658        1
[INPUT] 1    0    [1    /1   ]  664.7440877          1
[INPUT] 1    0    [1    /1   ]  300.954470342        1
[INPUT] 1    0    [1    /1   ]  314.03578928         1
[INPUT] 1    0    [1    /1   ]  61.6307290071        1
[INPUT] 1    0    [1    /1   ]  7.35064849108        1
[INPUT] 1    0    [1    /1   ]  20.2201799574        1
[INPUT] 1    0    [1    /1   ]  0.777441478173       1
[INPUT] 1    0    [1    /1   ]  2.82945596521        1
[INPUT] 1    0    [1    /1   ]  0.222271895918       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656336690106, 1.0]], [0, [7617.520862639214, 1.0]], [0, [3617.351366009695, 1.0]], [0, [1597.8035446560677, 1.0]], [0, [382.86764062088696, 1.0]], [0, [108.13869606459811, 1.0]], [0, [36.04370133493291, 1.0]], [0, [8.344796742457572, 1.0]], [0, [3.535955637012821, 1.0]], [0, [0.8772246935060584, 1.0]], [0, [0.9416600422659775, 1.0]], [0, [0.2478802347297998, 1.0]], [1, [1362.783366579703, 1.0]], [1, [664.744087699794, 1.0]], [1, [300.9544703418293, 1.0]], [1, [314.03578927992146, 1.0]], [1, [61.6307290070564, 1.0]], [1, [7.3506484910756695, 1.0]], [1, [20.22017995744717, 1.0]], [1, [0.7774414781729897, 1.0]], [1, [2.8294559652086266, 1.0]], [1, [0.22227189591774718, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65633669]
bas 1, expnt(s) = [7617.52086264]
bas 2, expnt(s) = [3617.35136601]
bas 3, expnt(s) = [1597.80354466]
bas 4, expnt(s) = [382.86764062]
bas 5, expnt(s) = [108.13869606]
bas 6, expnt(s) = [36.04370133]
bas 7, expnt(s) = [8.34479674]
bas 8, expnt(s) = [3.53595564]
bas 9, expnt(s) = [0.87722469]
bas 10, expnt(s) = [0.94166004]
bas 11, expnt(s) = [0.24788023]
bas 12, expnt(s) = [1362.78336658]
bas 13, expnt(s) = [664.7440877]
bas 14, expnt(s) = [300.95447034]
bas 15, expnt(s) = [314.03578928]
bas 16, expnt(s) = [61.63072901]
bas 17, expnt(s) = [7.35064849]
bas 18, expnt(s) = [20.22017996]
bas 19, expnt(s) = [0.77744148]
bas 20, expnt(s) = [2.82945597]
bas 21, expnt(s) = [0.2222719]
CPU time:        98.69
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826563e+04 5.20026294e+03 7.61752086e+03 2.06003815e+03
 3.61735137e+03 1.17844155e+03 1.59780354e+03 6.38495086e+02
 3.82867641e+02 2.18676201e+02 1.08138696e+02 8.47229113e+01
 3.60437013e+01 3.71652502e+01 8.34479674e+00 1.24044310e+01
 3.53595564e+00 6.51471063e+00 8.77224694e-01 2.29006685e+00
 9.41660042e-01 2.41510285e+00 2.47880235e-01 8.87557398e-01
 1.36278337e+03 2.41556052e+04 6.64744088e+02 9.84696732e+03
 3.00954470e+02 3.65687732e+03 3.14035789e+02 3.85663310e+03
 6.16307290e+01 5.03768518e+02 7.35064849e+00 3.53094914e+01
 2.02201800e+01 1.25088004e+02 7.77441478e-01 2.12970292e+00
 2.82945597e+00 1.07056506e+01 2.22271896e-01 4.45235808e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99369170331616
cond(S) = 111654.06396043024
E1 = -729.5186600123113  E_coul = 203.1711071915203
init E= -526.347552820791
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555902962394588  LUMO = 0.915336262949855
  mo_energy =
[-1.18328257e+02 -1.22065298e+01 -9.44747352e+00 -9.44747352e+00
 -9.44747352e+00 -1.24019281e+00 -5.55902962e-01 -5.55902962e-01
 -5.55902962e-01  9.15336263e-01  1.03272232e+00  1.03272232e+00
  1.03272232e+00  4.59730291e+00  7.39129286e+00  7.39129286e+00
  7.39129286e+00  1.91409308e+01  3.36270500e+01  3.36270500e+01
  3.36270500e+01  1.14864860e+02  1.29232670e+02  1.29232670e+02
  1.29232670e+02  4.83612343e+02  4.83612343e+02  4.83612343e+02
  5.96144781e+02  1.33548609e+03  1.33548609e+03  1.33548609e+03
  2.66358699e+03  3.02977612e+03  3.02977612e+03  3.02977612e+03
  6.65031493e+03  6.65031493e+03  6.65031493e+03  9.06851028e+03
  2.54237697e+04  7.61657039e+04]
E1 = -727.8231704178976  E_coul = 201.08462996602486
cycle= 1 E= -526.738540451873  delta_E= -0.391  |g|= 0.187  |ddm|=  6.8
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.54447
diis-c [-0.2964479  1.       ]
  HOMO = -0.591044675718021  LUMO = 0.893590270297869
  mo_energy =
[-1.18638827e+02 -1.23447834e+01 -9.59692728e+00 -9.59692728e+00
 -9.59692728e+00 -1.27993561e+00 -5.91044676e-01 -5.91044676e-01
 -5.91044676e-01  8.93590270e-01  1.00812932e+00  1.00812932e+00
  1.00812932e+00  4.54258477e+00  7.29977304e+00  7.29977304e+00
  7.29977304e+00  1.90267545e+01  3.34718644e+01  3.34718644e+01
  3.34718644e+01  1.14643743e+02  1.29002470e+02  1.29002470e+02
  1.29002470e+02  4.83303149e+02  4.83303149e+02  4.83303149e+02
  5.95798012e+02  1.33512023e+03  1.33512023e+03  1.33512023e+03
  2.66308572e+03  3.02934331e+03  3.02934331e+03  3.02934331e+03
  6.64976833e+03  6.64976833e+03  6.64976833e+03  9.06788808e+03
  2.54230533e+04  7.61648973e+04]
E1 = -728.4013072853859  E_coul = 201.66203327132143
cycle= 2 E= -526.739274014064  delta_E= -0.000734  |g|= 0.038  |ddm|= 0.494
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0767129
diis-c [-0.00337848  0.08464985  0.91535015]
  HOMO = -0.581969509886034  LUMO = 0.899849767920667
  mo_energy =
[-1.18570652e+02 -1.23065279e+01 -9.55698713e+00 -9.55698713e+00
 -9.55698713e+00 -1.26905429e+00 -5.81969510e-01 -5.81969510e-01
 -5.81969510e-01  8.99849768e-01  1.01483931e+00  1.01483931e+00
  1.01483931e+00  4.55739067e+00  7.32367303e+00  7.32367303e+00
  7.32367303e+00  1.90578864e+01  3.35121601e+01  3.35121601e+01
  3.35121601e+01  1.14699567e+02  1.29058732e+02  1.29058732e+02
  1.29058732e+02  4.83370502e+02  4.83370502e+02  4.83370502e+02
  5.95867644e+02  1.33519166e+03  1.33519166e+03  1.33519166e+03
  2.66316048e+03  3.02941700e+03  3.02941700e+03  3.02941700e+03
  6.64984377e+03  6.64984377e+03  6.64984377e+03  9.06796434e+03
  2.54231302e+04  7.61649745e+04]
E1 = -728.249350692539  E_coul = 201.51001622824592
cycle= 3 E= -526.739334464293  delta_E= -6.05e-05  |g|= 0.00628  |ddm|= 0.104
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132127
diis-c [-7.24508711e-07 -1.28921034e-03  1.42265857e-01  8.59023353e-01]
  HOMO = -0.583473139151175  LUMO = 0.898886011074381
  mo_energy =
[-1.18580604e+02 -1.23123416e+01 -9.56315147e+00 -9.56315147e+00
 -9.56315147e+00 -1.27075416e+00 -5.83473139e-01 -5.83473139e-01
 -5.83473139e-01  8.98886011e-01  1.01375220e+00  1.01375220e+00
  1.01375220e+00  4.55504886e+00  7.31987328e+00  7.31987328e+00
  7.31987328e+00  1.90530976e+01  3.35059806e+01  3.35059806e+01
  3.35059806e+01  1.14691329e+02  1.29050385e+02  1.29050385e+02
  1.29050385e+02  4.83360666e+02  4.83360666e+02  4.83360666e+02
  5.95857469e+02  1.33518124e+03  1.33518124e+03  1.33518124e+03
  2.66314942e+03  3.02940619e+03  3.02940619e+03  3.02940619e+03
  6.64983257e+03  6.64983257e+03  6.64983257e+03  9.06795293e+03
  2.54231186e+04  7.61649627e+04]
E1 = -728.2722371399337  E_coul = 201.5329007428266
cycle= 4 E= -526.739336397107  delta_E= -1.93e-06  |g|= 9.74e-05  |ddm|= 0.0115
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00011192
diis-c [-6.05570789e-09  7.74438970e-05 -1.09098719e-02 -6.93796320e-02
  1.08021206e+00]
  HOMO = -0.583452557924205  LUMO = 0.898914807657414
  mo_energy =
[-1.18580547e+02 -1.23122655e+01 -9.56308818e+00 -9.56308818e+00
 -9.56308818e+00 -1.27071092e+00 -5.83452558e-01 -5.83452558e-01
 -5.83452558e-01  8.98914808e-01  1.01376958e+00  1.01376958e+00
  1.01376958e+00  4.55509319e+00  7.31992216e+00  7.31992216e+00
  7.31992216e+00  1.90531627e+01  3.35060414e+01  3.35060414e+01
  3.35060414e+01  1.14691394e+02  1.29050447e+02  1.29050447e+02
  1.29050447e+02  4.83360723e+02  4.83360723e+02  4.83360723e+02
  5.95857519e+02  1.33518129e+03  1.33518129e+03  1.33518129e+03
  2.66314945e+03  3.02940623e+03  3.02940623e+03  3.02940623e+03
  6.64983259e+03  6.64983259e+03  6.64983259e+03  9.06795294e+03
  2.54231186e+04  7.61649627e+04]
E1 = -728.2719767944748  E_coul = 201.5326403957294
cycle= 5 E= -526.739336398745  delta_E= -1.64e-09  |g|= 2.06e-05  |ddm|= 0.0048
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.91459e-05
diis-c [-1.00388103e-10  1.24677524e-05 -1.54075868e-03 -1.20929605e-02
  2.49707786e-02  9.88650473e-01]
  HOMO = -0.583460510583264  LUMO = 0.898911483207816
  mo_energy =
[-1.18580579e+02 -1.23122896e+01 -9.56311415e+00 -9.56311415e+00
 -9.56311415e+00 -1.27071759e+00 -5.83460511e-01 -5.83460511e-01
 -5.83460511e-01  8.98911483e-01  1.01376426e+00  1.01376426e+00
  1.01376426e+00  4.55508262e+00  7.31990439e+00  7.31990439e+00
  7.31990439e+00  1.90531421e+01  3.35060162e+01  3.35060162e+01
  3.35060162e+01  1.14691365e+02  1.29050417e+02  1.29050417e+02
  1.29050417e+02  4.83360691e+02  4.83360691e+02  4.83360691e+02
  5.95857487e+02  1.33518126e+03  1.33518126e+03  1.33518126e+03
  2.66314942e+03  3.02940620e+03  3.02940620e+03  3.02940620e+03
  6.64983256e+03  6.64983256e+03  6.64983256e+03  9.06795291e+03
  2.54231185e+04  7.61649627e+04]
E1 = -728.2720642098357  E_coul = 201.5327278110349
cycle= 6 E= -526.739336398801  delta_E= -5.55e-11  |g|= 1.69e-06  |ddm|= 0.000594
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2720642098357  E_coul = 201.5327278110349
  HOMO = -0.583460288003797  LUMO = 0.898911905284903
  mo_energy =
[-1.18580578e+02 -1.23122887e+01 -9.56311326e+00 -9.56311326e+00
 -9.56311326e+00 -1.27071699e+00 -5.83460288e-01 -5.83460288e-01
 -5.83460288e-01  8.98911905e-01  1.01376447e+00  1.01376447e+00
  1.01376447e+00  4.55508317e+00  7.31990500e+00  7.31990500e+00
  7.31990500e+00  1.90531429e+01  3.35060171e+01  3.35060171e+01
  3.35060171e+01  1.14691366e+02  1.29050419e+02  1.29050419e+02
  1.29050419e+02  4.83360693e+02  4.83360693e+02  4.83360693e+02
  5.95857488e+02  1.33518126e+03  1.33518126e+03  1.33518126e+03
  2.66314942e+03  3.02940620e+03  3.02940620e+03  3.02940620e+03
  6.64983256e+03  6.64983256e+03  6.64983256e+03  9.06795291e+03
  2.54231185e+04  7.61649627e+04]
E1 = -728.2720603713075  E_coul = 201.53272397250413
Extra cycle  E= -526.739336398803  delta_E= -2.5e-12  |g|= 3.64e-07  |ddm|= 8.12e-05
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111654.06396043024
E1 = -728.2720603713075  E_coul = 201.53272397250413
init E= -526.739336398803
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583460374440607  LUMO = 0.898911902435048
  mo_energy =
[-1.18580578e+02 -1.23122889e+01 -9.56311357e+00 -9.56311357e+00
 -9.56311357e+00 -1.27071702e+00 -5.83460374e-01 -5.83460374e-01
 -5.83460374e-01  8.98911902e-01  1.01376441e+00  1.01376441e+00
  1.01376441e+00  4.55508308e+00  7.31990481e+00  7.31990481e+00
  7.31990481e+00  1.90531427e+01  3.35060168e+01  3.35060168e+01
  3.35060168e+01  1.14691366e+02  1.29050418e+02  1.29050418e+02
  1.29050418e+02  4.83360692e+02  4.83360692e+02  4.83360692e+02
  5.95857488e+02  1.33518126e+03  1.33518126e+03  1.33518126e+03
  2.66314942e+03  3.02940620e+03  3.02940620e+03  3.02940620e+03
  6.64983256e+03  6.64983256e+03  6.64983256e+03  9.06795291e+03
  2.54231185e+04  7.61649627e+04]
E1 = -728.2720613565027  E_coul = 201.5327249577002
cycle= 1 E= -526.739336398802  delta_E= 7.96e-13  |g|= 9.11e-08  |ddm|= 1.64e-05
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2720613565027  E_coul = 201.5327249577002
  HOMO = -0.583460358303721  LUMO = 0.898911924414111
  mo_energy =
[-1.18580578e+02 -1.23122889e+01 -9.56311349e+00 -9.56311349e+00
 -9.56311349e+00 -1.27071699e+00 -5.83460358e-01 -5.83460358e-01
 -5.83460358e-01  8.98911924e-01  1.01376443e+00  1.01376443e+00
  1.01376443e+00  4.55508312e+00  7.31990485e+00  7.31990485e+00
  7.31990485e+00  1.90531428e+01  3.35060168e+01  3.35060168e+01
  3.35060168e+01  1.14691366e+02  1.29050418e+02  1.29050418e+02
  1.29050418e+02  4.83360692e+02  4.83360692e+02  4.83360692e+02
  5.95857488e+02  1.33518126e+03  1.33518126e+03  1.33518126e+03
  2.66314942e+03  3.02940620e+03  3.02940620e+03  3.02940620e+03
  6.64983256e+03  6.64983256e+03  6.64983256e+03  9.06795291e+03
  2.54231185e+04  7.61649627e+04]
E1 = -728.2720610567227  E_coul = 201.53272465792088
Extra cycle  E= -526.739336398802  delta_E= 6.82e-13  |g|= 2.12e-08  |ddm|= 3.45e-06
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826563e+04 7.61752086e+03 3.61735137e+03 1.59780354e+03
 3.82867641e+02 1.08138696e+02 3.60437013e+01 8.34479674e+00
 3.53595564e+00 8.77224694e-01 9.41660042e-01 2.47880235e-01
 1.36278337e+03 6.64744088e+02 3.00954470e+02 3.14035789e+02
 6.16307290e+01 7.35064849e+00 2.02201800e+01 7.77441478e-01
 2.82945597e+00 2.22271896e-01]
grad_E = [-1.49935885e-06  3.11173845e-06 -1.67406713e-06  6.15800333e-05
  2.20929292e-04 -2.30216443e-03  9.92103506e-04 -1.20072735e-03
 -1.31771431e-03  7.95699538e-04  3.80933241e-04  3.35707540e-03
 -5.12869899e-07  4.92443835e-06  2.31172742e-05  1.99325914e-05
  3.52155224e-05  2.10341876e-04 -3.20875758e-04  5.91000222e-03
  7.16857604e-04 -2.07174461e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:40 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6563491        1
[INPUT] 0    0    [1    /1   ]  7617.52083582        1
[INPUT] 0    0    [1    /1   ]  3617.35137906        1
[INPUT] 0    0    [1    /1   ]  1597.8029875         1
[INPUT] 0    0    [1    /1   ]  382.867582902        1
[INPUT] 0    0    [1    /1   ]  108.14309729         1
[INPUT] 0    0    [1    /1   ]  36.0673267343        1
[INPUT] 0    0    [1    /1   ]  8.3671816939         1
[INPUT] 0    0    [1    /1   ]  3.54668554959        1
[INPUT] 0    0    [1    /1   ]  0.877303146371       1
[INPUT] 0    0    [1    /1   ]  0.952164350907       1
[INPUT] 0    0    [1    /1   ]  0.246707577223       1
[INPUT] 1    0    [1    /1   ]  1362.78337073        1
[INPUT] 1    0    [1    /1   ]  664.744046749        1
[INPUT] 1    0    [1    /1   ]  300.954277267        1
[INPUT] 1    0    [1    /1   ]  314.03562281         1
[INPUT] 1    0    [1    /1   ]  61.6308340302        1
[INPUT] 1    0    [1    /1   ]  7.35060782545        1
[INPUT] 1    0    [1    /1   ]  20.2203928468        1
[INPUT] 1    0    [1    /1   ]  0.777145874532       1
[INPUT] 1    0    [1    /1   ]  2.82840464091        1
[INPUT] 1    0    [1    /1   ]  0.222745004357       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65634908599, 1.0]], [0, [7617.520835824559, 1.0]], [0, [3617.3513790611887, 1.0]], [0, [1597.8029875039101, 1.0]], [0, [382.86758290245945, 1.0]], [0, [108.14309728982788, 1.0]], [0, [36.06732673428554, 1.0]], [0, [8.367181693896228, 1.0]], [0, [3.546685549590967, 1.0]], [0, [0.8773031463708654, 1.0]], [0, [0.9521643509066221, 1.0]], [0, [0.2467075772229765, 1.0]], [1, [1362.7833707319317, 1.0]], [1, [664.744046748875, 1.0]], [1, [300.95427726655913, 1.0]], [1, [314.0356228104265, 1.0]], [1, [61.63083403021797, 1.0]], [1, [7.35060782545481, 1.0]], [1, [20.220392846815397, 1.0]], [1, [0.7771458745324052, 1.0]], [1, [2.8284046409083503, 1.0]], [1, [0.22274500435696085, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65634909]
bas 1, expnt(s) = [7617.52083582]
bas 2, expnt(s) = [3617.35137906]
bas 3, expnt(s) = [1597.8029875]
bas 4, expnt(s) = [382.8675829]
bas 5, expnt(s) = [108.14309729]
bas 6, expnt(s) = [36.06732673]
bas 7, expnt(s) = [8.36718169]
bas 8, expnt(s) = [3.54668555]
bas 9, expnt(s) = [0.87730315]
bas 10, expnt(s) = [0.95216435]
bas 11, expnt(s) = [0.24670758]
bas 12, expnt(s) = [1362.78337073]
bas 13, expnt(s) = [664.74404675]
bas 14, expnt(s) = [300.95427727]
bas 15, expnt(s) = [314.03562281]
bas 16, expnt(s) = [61.63083403]
bas 17, expnt(s) = [7.35060783]
bas 18, expnt(s) = [20.22039285]
bas 19, expnt(s) = [0.77714587]
bas 20, expnt(s) = [2.82840464]
bas 21, expnt(s) = [0.222745]
CPU time:       104.44
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826563e+04 5.20026294e+03 7.61752084e+03 2.06003815e+03
 3.61735138e+03 1.17844155e+03 1.59780299e+03 6.38494919e+02
 3.82867583e+02 2.18676176e+02 1.08143097e+02 8.47254974e+01
 3.60673267e+01 3.71835191e+01 8.36718169e+00 1.24293788e+01
 3.54668555e+00 6.52953176e+00 8.77303146e-01 2.29022046e+00
 9.52164351e-01 2.43528034e+00 2.46707577e-01 8.84406428e-01
 1.36278337e+03 2.41556053e+04 6.64744047e+02 9.84696657e+03
 3.00954277e+02 3.65687439e+03 3.14035623e+02 3.85663055e+03
 6.16308340e+01 5.03769591e+02 7.35060783e+00 3.53092472e+01
 2.02203928e+01 1.25089650e+02 7.77145875e-01 2.12869076e+00
 2.82840464e+00 1.07006786e+01 2.22745004e-01 4.46420735e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993664171947657
cond(S) = 111662.56061505535
E1 = -729.5181744636836  E_coul = 203.17083703720158
init E= -526.347337426482
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.555888457607551  LUMO = 0.915680424391825
  mo_energy =
[-1.18328288e+02 -1.22065892e+01 -9.44751203e+00 -9.44751203e+00
 -9.44751203e+00 -1.24017266e+00 -5.55888458e-01 -5.55888458e-01
 -5.55888458e-01  9.15680424e-01  1.03431701e+00  1.03431701e+00
  1.03431701e+00  4.61965704e+00  7.39018410e+00  7.39018410e+00
  7.39018410e+00  1.92373231e+01  3.36236480e+01  3.36236480e+01
  3.36236480e+01  1.15086310e+02  1.29229830e+02  1.29229830e+02
  1.29229830e+02  4.83610446e+02  4.83610446e+02  4.83610446e+02
  5.96404974e+02  1.33548415e+03  1.33548415e+03  1.33548415e+03
  2.66382954e+03  3.02977384e+03  3.02977384e+03  3.02977384e+03
  6.65031245e+03  6.65031245e+03  6.65031245e+03  9.06873423e+03
  2.54239815e+04  7.61659010e+04]
E1 = -727.8293315930235  E_coul = 201.09075585991158
cycle= 1 E= -526.738575733112  delta_E= -0.391  |g|= 0.187  |ddm|= 5.81
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544414
diis-c [-0.29638622  1.        ]
  HOMO = -0.590800295026929  LUMO = 0.894099231701452
  mo_energy =
[-1.18638392e+02 -1.23444119e+01 -9.59653939e+00 -9.59653939e+00
 -9.59653939e+00 -1.27959030e+00 -5.90800295e-01 -5.90800295e-01
 -5.90800295e-01  8.94099232e-01  1.00988772e+00  1.00988772e+00
  1.00988772e+00  4.56504129e+00  7.29910523e+00  7.29910523e+00
  7.29910523e+00  1.91233714e+01  3.34688881e+01  3.34688881e+01
  3.34688881e+01  1.14865585e+02  1.29000083e+02  1.29000083e+02
  1.29000083e+02  4.83301711e+02  4.83301711e+02  4.83301711e+02
  5.96058686e+02  1.33511878e+03  1.33511878e+03  1.33511878e+03
  2.66332876e+03  3.02934151e+03  3.02934151e+03  3.02934151e+03
  6.64976632e+03  6.64976632e+03  6.64976632e+03  9.06811251e+03
  2.54232656e+04  7.61650949e+04]
E1 = -728.4050401717811  E_coul = 201.66573461280134
cycle= 2 E= -526.73930555898  delta_E= -0.00073  |g|= 0.038  |ddm|= 0.412
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0765285
diis-c [-0.00336629  0.08440749  0.91559251]
  HOMO = -0.581774808765829  LUMO = 0.900346315726793
  mo_energy =
[-1.18570417e+02 -1.23063116e+01 -9.55676053e+00 -9.55676053e+00
 -9.55676053e+00 -1.26876174e+00 -5.81774809e-01 -5.81774809e-01
 -5.81774809e-01  9.00346316e-01  1.01656597e+00  1.01656597e+00
  1.01656597e+00  4.57983620e+00  7.32288939e+00  7.32288939e+00
  7.32288939e+00  1.91544239e+01  3.35090268e+01  3.35090268e+01
  3.35090268e+01  1.14921233e+02  1.29056162e+02  1.29056162e+02
  1.29056162e+02  4.83368866e+02  4.83368866e+02  4.83368866e+02
  5.96128116e+02  1.33519001e+03  1.33519001e+03  1.33519001e+03
  2.66340330e+03  3.02941499e+03  3.02941499e+03  3.02941499e+03
  6.64984155e+03  6.64984155e+03  6.64984155e+03  9.06818856e+03
  2.54233422e+04  7.61651718e+04]
E1 = -728.2538000775797  E_coul = 201.51443456917713
cycle= 3 E= -526.739365508403  delta_E= -5.99e-05  |g|= 0.00626  |ddm|= 0.0869
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0131831
diis-c [-7.39622742e-07 -1.28992991e-03  1.42269378e-01  8.59020552e-01]
  HOMO = -0.583272831752047  LUMO = 0.899386568298468
  mo_energy =
[-1.18580341e+02 -1.23121054e+01 -9.56290496e+00 -9.56290495e+00
 -9.56290495e+00 -1.27045148e+00 -5.83272832e-01 -5.83272832e-01
 -5.83272832e-01  8.99386568e-01  1.01548297e+00  1.01548297e+00
  1.01548297e+00  4.57749503e+00  7.31910440e+00  7.31910440e+00
  7.31910440e+00  1.91496446e+01  3.35028671e+01  3.35028671e+01
  3.35028671e+01  1.14913018e+02  1.29047839e+02  1.29047839e+02
  1.29047839e+02  4.83359058e+02  4.83359058e+02  4.83359058e+02
  5.96117969e+02  1.33517961e+03  1.33517961e+03  1.33517961e+03
  2.66339227e+03  3.02940421e+03  3.02940421e+03  3.02940421e+03
  6.64983038e+03  6.64983038e+03  6.64983038e+03  9.06817717e+03
  2.54233306e+04  7.61651601e+04]
E1 = -728.2765789226786  E_coul = 201.5372114958302
cycle= 4 E= -526.739367426848  delta_E= -1.92e-06  |g|= 0.000101  |ddm|= 0.00952
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000115147
diis-c [-6.30364090e-09  8.06820554e-05 -1.13094272e-02 -7.19008175e-02
  1.08312956e+00]
  HOMO = -0.583252428725606  LUMO = 0.899416056209295
  mo_energy =
[-1.18580285e+02 -1.23120291e+01 -9.56284182e+00 -9.56284182e+00
 -9.56284182e+00 -1.27040749e+00 -5.83252429e-01 -5.83252429e-01
 -5.83252429e-01  8.99416056e-01  1.01550036e+00  1.01550036e+00
  1.01550036e+00  4.57753981e+00  7.31915320e+00  7.31915320e+00
  7.31915320e+00  1.91497098e+01  3.35029278e+01  3.35029278e+01
  3.35029278e+01  1.14913084e+02  1.29047901e+02  1.29047901e+02
  1.29047901e+02  4.83359115e+02  4.83359115e+02  4.83359115e+02
  5.96118019e+02  1.33517966e+03  1.33517966e+03  1.33517966e+03
  2.66339230e+03  3.02940425e+03  3.02940425e+03  3.02940425e+03
  6.64983040e+03  6.64983040e+03  6.64983040e+03  9.06817719e+03
  2.54233306e+04  7.61651601e+04]
E1 = -728.2763172627972  E_coul = 201.536949834158
cycle= 5 E= -526.739367428639  delta_E= -1.79e-09  |g|= 2.1e-05  |ddm|= 0.00395
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96531e-05
diis-c [-1.05291228e-10  1.26935123e-05 -1.56328725e-03 -1.22656753e-02
  2.29926488e-02  9.90823620e-01]
  HOMO = -0.583260521507559  LUMO = 0.899412706581363
  mo_energy =
[-1.18580317e+02 -1.23120536e+01 -9.56286820e+00 -9.56286820e+00
 -9.56286820e+00 -1.27041422e+00 -5.83260522e-01 -5.83260522e-01
 -5.83260522e-01  8.99412707e-01  1.01549495e+00  1.01549495e+00
  1.01549495e+00  4.57752904e+00  7.31913514e+00  7.31913514e+00
  7.31913514e+00  1.91496889e+01  3.35029022e+01  3.35029022e+01
  3.35029022e+01  1.14913055e+02  1.29047871e+02  1.29047871e+02
  1.29047871e+02  4.83359082e+02  4.83359082e+02  4.83359082e+02
  5.96117986e+02  1.33517963e+03  1.33517963e+03  1.33517963e+03
  2.66339227e+03  3.02940421e+03  3.02940421e+03  3.02940421e+03
  6.64983037e+03  6.64983037e+03  6.64983037e+03  9.06817715e+03
  2.54233306e+04  7.61651601e+04]
E1 = -728.276405813189  E_coul = 201.53703838448965
cycle= 6 E= -526.739367428699  delta_E= -6.01e-11  |g|= 1.71e-06  |ddm|= 0.000476
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.276405813189  E_coul = 201.53703838448965
  HOMO = -0.583260275570628  LUMO = 0.899413144511366
  mo_energy =
[-1.18580316e+02 -1.23120526e+01 -9.56286723e+00 -9.56286723e+00
 -9.56286723e+00 -1.27041359e+00 -5.83260276e-01 -5.83260276e-01
 -5.83260276e-01  8.99413145e-01  1.01549518e+00  1.01549518e+00
  1.01549518e+00  4.57752963e+00  7.31913581e+00  7.31913581e+00
  7.31913581e+00  1.91496898e+01  3.35029032e+01  3.35029032e+01
  3.35029032e+01  1.14913056e+02  1.29047873e+02  1.29047873e+02
  1.29047873e+02  4.83359084e+02  4.83359084e+02  4.83359084e+02
  5.96117987e+02  1.33517963e+03  1.33517963e+03  1.33517963e+03
  2.66339227e+03  3.02940421e+03  3.02940421e+03  3.02940421e+03
  6.64983037e+03  6.64983037e+03  6.64983037e+03  9.06817715e+03
  2.54233306e+04  7.61651601e+04]
E1 = -728.2764016776595  E_coul = 201.53703424895994
Extra cycle  E= -526.7393674287  delta_E= -2.27e-13  |g|= 3.72e-07  |ddm|= 6.25e-05
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826563e+04 7.61752084e+03 3.61735138e+03 1.59780299e+03
 3.82867583e+02 1.08143097e+02 3.60673267e+01 8.36718169e+00
 3.54668555e+00 8.77303146e-01 9.52164351e-01 2.46707577e-01
 1.36278337e+03 6.64744047e+02 3.00954277e+02 3.14035623e+02
 6.16308340e+01 7.35060783e+00 2.02203928e+01 7.77145875e-01
 2.82840464e+00 2.22745004e-01]
E = -526.7393674286996
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:40 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6563491        1
[INPUT] 0    0    [1    /1   ]  7617.52083582        1
[INPUT] 0    0    [1    /1   ]  3617.35137906        1
[INPUT] 0    0    [1    /1   ]  1597.8029875         1
[INPUT] 0    0    [1    /1   ]  382.867582902        1
[INPUT] 0    0    [1    /1   ]  108.14309729         1
[INPUT] 0    0    [1    /1   ]  36.0673267343        1
[INPUT] 0    0    [1    /1   ]  8.3671816939         1
[INPUT] 0    0    [1    /1   ]  3.54668554959        1
[INPUT] 0    0    [1    /1   ]  0.877303146371       1
[INPUT] 0    0    [1    /1   ]  0.952164350907       1
[INPUT] 0    0    [1    /1   ]  0.246707577223       1
[INPUT] 1    0    [1    /1   ]  1362.78337073        1
[INPUT] 1    0    [1    /1   ]  664.744046749        1
[INPUT] 1    0    [1    /1   ]  300.954277267        1
[INPUT] 1    0    [1    /1   ]  314.03562281         1
[INPUT] 1    0    [1    /1   ]  61.6308340302        1
[INPUT] 1    0    [1    /1   ]  7.35060782545        1
[INPUT] 1    0    [1    /1   ]  20.2203928468        1
[INPUT] 1    0    [1    /1   ]  0.777145874532       1
[INPUT] 1    0    [1    /1   ]  2.82840464091        1
[INPUT] 1    0    [1    /1   ]  0.222745004357       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65634908599, 1.0]], [0, [7617.520835824559, 1.0]], [0, [3617.3513790611887, 1.0]], [0, [1597.8029875039101, 1.0]], [0, [382.86758290245945, 1.0]], [0, [108.14309728982788, 1.0]], [0, [36.06732673428554, 1.0]], [0, [8.367181693896228, 1.0]], [0, [3.546685549590967, 1.0]], [0, [0.8773031463708654, 1.0]], [0, [0.9521643509066221, 1.0]], [0, [0.2467075772229765, 1.0]], [1, [1362.7833707319317, 1.0]], [1, [664.744046748875, 1.0]], [1, [300.95427726655913, 1.0]], [1, [314.0356228104265, 1.0]], [1, [61.63083403021797, 1.0]], [1, [7.35060782545481, 1.0]], [1, [20.220392846815397, 1.0]], [1, [0.7771458745324052, 1.0]], [1, [2.8284046409083503, 1.0]], [1, [0.22274500435696085, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65634909]
bas 1, expnt(s) = [7617.52083582]
bas 2, expnt(s) = [3617.35137906]
bas 3, expnt(s) = [1597.8029875]
bas 4, expnt(s) = [382.8675829]
bas 5, expnt(s) = [108.14309729]
bas 6, expnt(s) = [36.06732673]
bas 7, expnt(s) = [8.36718169]
bas 8, expnt(s) = [3.54668555]
bas 9, expnt(s) = [0.87730315]
bas 10, expnt(s) = [0.95216435]
bas 11, expnt(s) = [0.24670758]
bas 12, expnt(s) = [1362.78337073]
bas 13, expnt(s) = [664.74404675]
bas 14, expnt(s) = [300.95427727]
bas 15, expnt(s) = [314.03562281]
bas 16, expnt(s) = [61.63083403]
bas 17, expnt(s) = [7.35060783]
bas 18, expnt(s) = [20.22039285]
bas 19, expnt(s) = [0.77714587]
bas 20, expnt(s) = [2.82840464]
bas 21, expnt(s) = [0.222745]
CPU time:       104.80
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826563e+04 5.20026294e+03 7.61752084e+03 2.06003815e+03
 3.61735138e+03 1.17844155e+03 1.59780299e+03 6.38494919e+02
 3.82867583e+02 2.18676176e+02 1.08143097e+02 8.47254974e+01
 3.60673267e+01 3.71835191e+01 8.36718169e+00 1.24293788e+01
 3.54668555e+00 6.52953176e+00 8.77303146e-01 2.29022046e+00
 9.52164351e-01 2.43528034e+00 2.46707577e-01 8.84406428e-01
 1.36278337e+03 2.41556053e+04 6.64744047e+02 9.84696657e+03
 3.00954277e+02 3.65687439e+03 3.14035623e+02 3.85663055e+03
 6.16308340e+01 5.03769591e+02 7.35060783e+00 3.53092472e+01
 2.02203928e+01 1.25089650e+02 7.77145875e-01 2.12869076e+00
 2.82840464e+00 1.07006786e+01 2.22745004e-01 4.46420735e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993664171947657
cond(S) = 111662.56061505535
E1 = -729.5181744636836  E_coul = 203.17083703720158
init E= -526.347337426482
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555888457607551  LUMO = 0.915680424391825
  mo_energy =
[-1.18328288e+02 -1.22065892e+01 -9.44751203e+00 -9.44751203e+00
 -9.44751203e+00 -1.24017266e+00 -5.55888458e-01 -5.55888458e-01
 -5.55888458e-01  9.15680424e-01  1.03431701e+00  1.03431701e+00
  1.03431701e+00  4.61965704e+00  7.39018410e+00  7.39018410e+00
  7.39018410e+00  1.92373231e+01  3.36236480e+01  3.36236480e+01
  3.36236480e+01  1.15086310e+02  1.29229830e+02  1.29229830e+02
  1.29229830e+02  4.83610446e+02  4.83610446e+02  4.83610446e+02
  5.96404974e+02  1.33548415e+03  1.33548415e+03  1.33548415e+03
  2.66382954e+03  3.02977384e+03  3.02977384e+03  3.02977384e+03
  6.65031245e+03  6.65031245e+03  6.65031245e+03  9.06873423e+03
  2.54239815e+04  7.61659010e+04]
E1 = -727.8293315930235  E_coul = 201.09075585991158
cycle= 1 E= -526.738575733112  delta_E= -0.391  |g|= 0.187  |ddm|= 5.81
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544414
diis-c [-0.29638622  1.        ]
  HOMO = -0.590800295026929  LUMO = 0.894099231701452
  mo_energy =
[-1.18638392e+02 -1.23444119e+01 -9.59653939e+00 -9.59653939e+00
 -9.59653939e+00 -1.27959030e+00 -5.90800295e-01 -5.90800295e-01
 -5.90800295e-01  8.94099232e-01  1.00988772e+00  1.00988772e+00
  1.00988772e+00  4.56504129e+00  7.29910523e+00  7.29910523e+00
  7.29910523e+00  1.91233714e+01  3.34688881e+01  3.34688881e+01
  3.34688881e+01  1.14865585e+02  1.29000083e+02  1.29000083e+02
  1.29000083e+02  4.83301711e+02  4.83301711e+02  4.83301711e+02
  5.96058686e+02  1.33511878e+03  1.33511878e+03  1.33511878e+03
  2.66332876e+03  3.02934151e+03  3.02934151e+03  3.02934151e+03
  6.64976632e+03  6.64976632e+03  6.64976632e+03  9.06811251e+03
  2.54232656e+04  7.61650949e+04]
E1 = -728.4050401717811  E_coul = 201.66573461280134
cycle= 2 E= -526.73930555898  delta_E= -0.00073  |g|= 0.038  |ddm|= 0.412
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0765285
diis-c [-0.00336629  0.08440749  0.91559251]
  HOMO = -0.581774808765829  LUMO = 0.900346315726793
  mo_energy =
[-1.18570417e+02 -1.23063116e+01 -9.55676053e+00 -9.55676053e+00
 -9.55676053e+00 -1.26876174e+00 -5.81774809e-01 -5.81774809e-01
 -5.81774809e-01  9.00346316e-01  1.01656597e+00  1.01656597e+00
  1.01656597e+00  4.57983620e+00  7.32288939e+00  7.32288939e+00
  7.32288939e+00  1.91544239e+01  3.35090268e+01  3.35090268e+01
  3.35090268e+01  1.14921233e+02  1.29056162e+02  1.29056162e+02
  1.29056162e+02  4.83368866e+02  4.83368866e+02  4.83368866e+02
  5.96128116e+02  1.33519001e+03  1.33519001e+03  1.33519001e+03
  2.66340330e+03  3.02941499e+03  3.02941499e+03  3.02941499e+03
  6.64984155e+03  6.64984155e+03  6.64984155e+03  9.06818856e+03
  2.54233422e+04  7.61651718e+04]
E1 = -728.2538000775797  E_coul = 201.51443456917713
cycle= 3 E= -526.739365508403  delta_E= -5.99e-05  |g|= 0.00626  |ddm|= 0.0869
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0131831
diis-c [-7.39622742e-07 -1.28992991e-03  1.42269378e-01  8.59020552e-01]
  HOMO = -0.583272831752047  LUMO = 0.899386568298468
  mo_energy =
[-1.18580341e+02 -1.23121054e+01 -9.56290496e+00 -9.56290495e+00
 -9.56290495e+00 -1.27045148e+00 -5.83272832e-01 -5.83272832e-01
 -5.83272832e-01  8.99386568e-01  1.01548297e+00  1.01548297e+00
  1.01548297e+00  4.57749503e+00  7.31910440e+00  7.31910440e+00
  7.31910440e+00  1.91496446e+01  3.35028671e+01  3.35028671e+01
  3.35028671e+01  1.14913018e+02  1.29047839e+02  1.29047839e+02
  1.29047839e+02  4.83359058e+02  4.83359058e+02  4.83359058e+02
  5.96117969e+02  1.33517961e+03  1.33517961e+03  1.33517961e+03
  2.66339227e+03  3.02940421e+03  3.02940421e+03  3.02940421e+03
  6.64983038e+03  6.64983038e+03  6.64983038e+03  9.06817717e+03
  2.54233306e+04  7.61651601e+04]
E1 = -728.2765789226786  E_coul = 201.5372114958302
cycle= 4 E= -526.739367426848  delta_E= -1.92e-06  |g|= 0.000101  |ddm|= 0.00952
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000115147
diis-c [-6.30364090e-09  8.06820554e-05 -1.13094272e-02 -7.19008175e-02
  1.08312956e+00]
  HOMO = -0.583252428725606  LUMO = 0.899416056209295
  mo_energy =
[-1.18580285e+02 -1.23120291e+01 -9.56284182e+00 -9.56284182e+00
 -9.56284182e+00 -1.27040749e+00 -5.83252429e-01 -5.83252429e-01
 -5.83252429e-01  8.99416056e-01  1.01550036e+00  1.01550036e+00
  1.01550036e+00  4.57753981e+00  7.31915320e+00  7.31915320e+00
  7.31915320e+00  1.91497098e+01  3.35029278e+01  3.35029278e+01
  3.35029278e+01  1.14913084e+02  1.29047901e+02  1.29047901e+02
  1.29047901e+02  4.83359115e+02  4.83359115e+02  4.83359115e+02
  5.96118019e+02  1.33517966e+03  1.33517966e+03  1.33517966e+03
  2.66339230e+03  3.02940425e+03  3.02940425e+03  3.02940425e+03
  6.64983040e+03  6.64983040e+03  6.64983040e+03  9.06817719e+03
  2.54233306e+04  7.61651601e+04]
E1 = -728.2763172627972  E_coul = 201.536949834158
cycle= 5 E= -526.739367428639  delta_E= -1.79e-09  |g|= 2.1e-05  |ddm|= 0.00395
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96531e-05
diis-c [-1.05291228e-10  1.26935123e-05 -1.56328725e-03 -1.22656753e-02
  2.29926488e-02  9.90823620e-01]
  HOMO = -0.583260521507559  LUMO = 0.899412706581363
  mo_energy =
[-1.18580317e+02 -1.23120536e+01 -9.56286820e+00 -9.56286820e+00
 -9.56286820e+00 -1.27041422e+00 -5.83260522e-01 -5.83260522e-01
 -5.83260522e-01  8.99412707e-01  1.01549495e+00  1.01549495e+00
  1.01549495e+00  4.57752904e+00  7.31913514e+00  7.31913514e+00
  7.31913514e+00  1.91496889e+01  3.35029022e+01  3.35029022e+01
  3.35029022e+01  1.14913055e+02  1.29047871e+02  1.29047871e+02
  1.29047871e+02  4.83359082e+02  4.83359082e+02  4.83359082e+02
  5.96117986e+02  1.33517963e+03  1.33517963e+03  1.33517963e+03
  2.66339227e+03  3.02940421e+03  3.02940421e+03  3.02940421e+03
  6.64983037e+03  6.64983037e+03  6.64983037e+03  9.06817715e+03
  2.54233306e+04  7.61651601e+04]
E1 = -728.276405813189  E_coul = 201.53703838448965
cycle= 6 E= -526.739367428699  delta_E= -6.01e-11  |g|= 1.71e-06  |ddm|= 0.000476
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.276405813189  E_coul = 201.53703838448965
  HOMO = -0.583260275570628  LUMO = 0.899413144511366
  mo_energy =
[-1.18580316e+02 -1.23120526e+01 -9.56286723e+00 -9.56286723e+00
 -9.56286723e+00 -1.27041359e+00 -5.83260276e-01 -5.83260276e-01
 -5.83260276e-01  8.99413145e-01  1.01549518e+00  1.01549518e+00
  1.01549518e+00  4.57752963e+00  7.31913581e+00  7.31913581e+00
  7.31913581e+00  1.91496898e+01  3.35029032e+01  3.35029032e+01
  3.35029032e+01  1.14913056e+02  1.29047873e+02  1.29047873e+02
  1.29047873e+02  4.83359084e+02  4.83359084e+02  4.83359084e+02
  5.96117987e+02  1.33517963e+03  1.33517963e+03  1.33517963e+03
  2.66339227e+03  3.02940421e+03  3.02940421e+03  3.02940421e+03
  6.64983037e+03  6.64983037e+03  6.64983037e+03  9.06817715e+03
  2.54233306e+04  7.61651601e+04]
E1 = -728.2764016776595  E_coul = 201.53703424895994
Extra cycle  E= -526.7393674287  delta_E= -2.27e-13  |g|= 3.72e-07  |ddm|= 6.25e-05
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111662.56061505535
E1 = -728.2764016776595  E_coul = 201.53703424895994
init E= -526.7393674287
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583260367702931  LUMO = 0.899413137694392
  mo_energy =
[-1.18580316e+02 -1.23120529e+01 -9.56286756e+00 -9.56286756e+00
 -9.56286756e+00 -1.27041363e+00 -5.83260368e-01 -5.83260368e-01
 -5.83260368e-01  8.99413138e-01  1.01549512e+00  1.01549512e+00
  1.01549512e+00  4.57752953e+00  7.31913560e+00  7.31913560e+00
  7.31913560e+00  1.91496895e+01  3.35029029e+01  3.35029029e+01
  3.35029029e+01  1.14913056e+02  1.29047872e+02  1.29047872e+02
  1.29047872e+02  4.83359083e+02  4.83359083e+02  4.83359083e+02
  5.96117987e+02  1.33517963e+03  1.33517963e+03  1.33517963e+03
  2.66339227e+03  3.02940421e+03  3.02940421e+03  3.02940421e+03
  6.64983037e+03  6.64983037e+03  6.64983037e+03  9.06817715e+03
  2.54233306e+04  7.61651601e+04]
E1 = -728.2764027453825  E_coul = 201.5370353166834
cycle= 1 E= -526.739367428699  delta_E= 4.55e-13  |g|= 9.45e-08  |ddm|= 1.26e-05
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2764027453825  E_coul = 201.5370353166834
  HOMO = -0.583260350039209  LUMO = 0.899413160718247
  mo_energy =
[-1.18580316e+02 -1.23120528e+01 -9.56286748e+00 -9.56286748e+00
 -9.56286748e+00 -1.27041359e+00 -5.83260350e-01 -5.83260350e-01
 -5.83260350e-01  8.99413161e-01  1.01549514e+00  1.01549514e+00
  1.01549514e+00  4.57752957e+00  7.31913565e+00  7.31913565e+00
  7.31913565e+00  1.91496896e+01  3.35029030e+01  3.35029030e+01
  3.35029030e+01  1.14913056e+02  1.29047872e+02  1.29047872e+02
  1.29047872e+02  4.83359083e+02  4.83359083e+02  4.83359083e+02
  5.96117987e+02  1.33517963e+03  1.33517963e+03  1.33517963e+03
  2.66339227e+03  3.02940421e+03  3.02940421e+03  3.02940421e+03
  6.64983037e+03  6.64983037e+03  6.64983037e+03  9.06817715e+03
  2.54233306e+04  7.61651601e+04]
E1 = -728.2764024224795  E_coul = 201.53703499377824
Extra cycle  E= -526.739367428701  delta_E= -2.16e-12  |g|= 2.24e-08  |ddm|= 2.67e-06
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826563e+04 7.61752084e+03 3.61735138e+03 1.59780299e+03
 3.82867583e+02 1.08143097e+02 3.60673267e+01 8.36718169e+00
 3.54668555e+00 8.77303146e-01 9.52164351e-01 2.46707577e-01
 1.36278337e+03 6.64744047e+02 3.00954277e+02 3.14035623e+02
 6.16308340e+01 7.35060783e+00 2.02203928e+01 7.77145875e-01
 2.82840464e+00 2.22745004e-01]
grad_E = [-1.49907817e-06  3.10874028e-06 -1.67534132e-06  6.14605274e-05
  2.25038290e-04 -2.33637794e-03  1.07000408e-03 -1.12857566e-03
 -1.48980567e-03  1.21290548e-03  6.42477687e-04 -1.16318813e-03
 -5.13108544e-07  4.92078480e-06  2.30947340e-05  1.99133294e-05
  3.85253295e-05  4.03951549e-04 -3.57865715e-04  1.72153443e-03
  5.04785756e-04 -5.90347686e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:45 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6563775        1
[INPUT] 0    0    [1    /1   ]  7617.52077448        1
[INPUT] 0    0    [1    /1   ]  3617.351409          1
[INPUT] 0    0    [1    /1   ]  1597.80171449        1
[INPUT] 0    0    [1    /1   ]  382.867337725        1
[INPUT] 0    0    [1    /1   ]  108.154135653        1
[INPUT] 0    0    [1    /1   ]  36.1191680562        1
[INPUT] 0    0    [1    /1   ]  8.41414317937        1
[INPUT] 0    0    [1    /1   ]  3.5790838019         1
[INPUT] 0    0    [1    /1   ]  0.876402754006       1
[INPUT] 0    0    [1    /1   ]  0.977293992946       1
[INPUT] 0    0    [1    /1   ]  0.246395138295       1
[INPUT] 1    0    [1    /1   ]  1362.78338025        1
[INPUT] 1    0    [1    /1   ]  664.743952973        1
[INPUT] 1    0    [1    /1   ]  300.953835185        1
[INPUT] 1    0    [1    /1   ]  314.035241647        1
[INPUT] 1    0    [1    /1   ]  61.6310476382        1
[INPUT] 1    0    [1    /1   ]  7.35008091061        1
[INPUT] 1    0    [1    /1   ]  20.2210789213        1
[INPUT] 1    0    [1    /1   ]  0.776640218119       1
[INPUT] 1    0    [1    /1   ]  2.82624686039        1
[INPUT] 1    0    [1    /1   ]  0.223453111431       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656377476796, 1.0]], [0, [7617.520774478976, 1.0]], [0, [3617.351409003931, 1.0]], [0, [1597.8017144889607, 1.0]], [0, [382.8673377250976, 1.0]], [0, [108.15413565341413, 1.0]], [0, [36.11916805624218, 1.0]], [0, [8.414143179368796, 1.0]], [0, [3.579083801899248, 1.0]], [0, [0.8764027540059466, 1.0]], [0, [0.977293992945643, 1.0]], [0, [0.24639513829495363, 1.0]], [1, [1362.7833802474618, 1.0]], [1, [664.7439529727847, 1.0]], [1, [300.9538351850959, 1.0]], [1, [314.03524164715265, 1.0]], [1, [61.63104763818177, 1.0]], [1, [7.350080910609593, 1.0]], [1, [20.221078921290314, 1.0]], [1, [0.7766402181190779, 1.0]], [1, [2.8262468603901794, 1.0]], [1, [0.22345311143104454, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65637748]
bas 1, expnt(s) = [7617.52077448]
bas 2, expnt(s) = [3617.351409]
bas 3, expnt(s) = [1597.80171449]
bas 4, expnt(s) = [382.86733773]
bas 5, expnt(s) = [108.15413565]
bas 6, expnt(s) = [36.11916806]
bas 7, expnt(s) = [8.41414318]
bas 8, expnt(s) = [3.5790838]
bas 9, expnt(s) = [0.87640275]
bas 10, expnt(s) = [0.97729399]
bas 11, expnt(s) = [0.24639514]
bas 12, expnt(s) = [1362.78338025]
bas 13, expnt(s) = [664.74395297]
bas 14, expnt(s) = [300.95383519]
bas 15, expnt(s) = [314.03524165]
bas 16, expnt(s) = [61.63104764]
bas 17, expnt(s) = [7.35008091]
bas 18, expnt(s) = [20.22107892]
bas 19, expnt(s) = [0.77664022]
bas 20, expnt(s) = [2.82624686]
bas 21, expnt(s) = [0.22345311]
CPU time:       110.58
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826564e+04 5.20026295e+03 7.61752077e+03 2.06003813e+03
 3.61735141e+03 1.17844156e+03 1.59780171e+03 6.38494538e+02
 3.82867338e+02 2.18676071e+02 1.08154136e+02 8.47319834e+01
 3.61191681e+01 3.72235962e+01 8.41414318e+00 1.24816629e+01
 3.57908380e+00 6.57421533e+00 8.76402754e-01 2.28845736e+00
 9.77293993e-01 2.48332720e+00 2.46395138e-01 8.83566263e-01
 1.36278338e+03 2.41556055e+04 6.64743953e+02 9.84696483e+03
 3.00953835e+02 3.65686767e+03 3.14035242e+02 3.85662469e+03
 6.16310476e+01 5.03771774e+02 7.35008091e+00 3.53060834e+01
 2.02210789e+01 1.25094956e+02 7.76640218e-01 2.12695959e+00
 2.82624686e+00 1.06904752e+01 2.23453111e-01 4.48195406e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99360732006378
cond(S) = 111728.9658397982
E1 = -729.5174762402122  E_coul = 203.17051831639637
init E= -526.346957923816
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.555856057031361  LUMO = 0.922954812076677
  mo_energy =
[-1.18328352e+02 -1.22066697e+01 -9.44756409e+00 -9.44756409e+00
 -9.44756409e+00 -1.24013808e+00 -5.55856057e-01 -5.55856057e-01
 -5.55856057e-01  9.22954812e-01  1.03665207e+00  1.03665207e+00
  1.03665207e+00  4.68355332e+00  7.38718197e+00  7.38718197e+00
  7.38718197e+00  1.94852011e+01  3.36153870e+01  3.36153870e+01
  3.36153870e+01  1.15616220e+02  1.29222881e+02  1.29222881e+02
  1.29222881e+02  4.83605781e+02  4.83605781e+02  4.83605781e+02
  5.97016080e+02  1.33547947e+03  1.33547947e+03  1.33547947e+03
  2.66439783e+03  3.02976837e+03  3.02976837e+03  3.02976837e+03
  6.65030654e+03  6.65030654e+03  6.65030654e+03  9.06925874e+03
  2.54244774e+04  7.61663627e+04]
E1 = -727.8411141286224  E_coul = 201.10248360912362
cycle= 1 E= -526.738630519499  delta_E= -0.392  |g|= 0.187  |ddm|= 3.73
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544224
diis-c [-0.29617978  1.        ]
  HOMO = -0.590347621327083  LUMO = 0.901518577241662
  mo_energy =
[-1.18637532e+02 -1.23436816e+01 -9.59576536e+00 -9.59576536e+00
 -9.59576536e+00 -1.27901931e+00 -5.90347621e-01 -5.90347621e-01
 -5.90347621e-01  9.01518577e-01  1.01252688e+00  1.01252688e+00
  1.01252688e+00  4.62896827e+00  7.29689155e+00  7.29689155e+00
  7.29689155e+00  1.93715403e+01  3.34614514e+01  3.34614514e+01
  3.34614514e+01  1.15396286e+02  1.28994018e+02  1.28994018e+02
  1.28994018e+02  4.83297965e+02  4.83297965e+02  4.83297965e+02
  5.96670745e+02  1.33511505e+03  1.33511505e+03  1.33511505e+03
  2.66389800e+03  3.02933698e+03  3.02933698e+03  3.02933698e+03
  6.64976135e+03  6.64976135e+03  6.64976135e+03  9.06863796e+03
  2.54237625e+04  7.61655575e+04]
E1 = -728.412735268727  E_coul = 201.67338206449185
cycle= 2 E= -526.739353204235  delta_E= -0.000723  |g|= 0.0378  |ddm|= 0.252
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.076196
diis-c [-0.00334573  0.08396134  0.91603866]
  HOMO = -0.581400599324249  LUMO = 0.907778846164547
  mo_energy =
[-1.18569906e+02 -1.23058420e+01 -9.55625642e+00 -9.55625642e+00
 -9.55625642e+00 -1.26827767e+00 -5.81400599e-01 -5.81400599e-01
 -5.81400599e-01  9.07778846e-01  1.01915319e+00  1.01915319e+00
  1.01915319e+00  4.64379344e+00  7.32048422e+00  7.32048422e+00
  7.32048422e+00  1.94024977e+01  3.35013263e+01  3.35013263e+01
  3.35013263e+01  1.15451633e+02  1.29049781e+02  1.29049781e+02
  1.29049781e+02  4.83364774e+02  4.83364774e+02  4.83364774e+02
  5.96739820e+02  1.33518592e+03  1.33518592e+03  1.33518592e+03
  2.66397217e+03  3.02941010e+03  3.02941010e+03  3.02941010e+03
  6.64983622e+03  6.64983622e+03  6.64983622e+03  9.06871364e+03
  2.54238387e+04  7.61656341e+04]
E1 = -728.2627255976013  E_coul = 201.52331331557153
cycle= 3 E= -526.73941228203  delta_E= -5.91e-05  |g|= 0.00623  |ddm|= 0.059
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.013132
diis-c [-7.53250656e-07 -1.28970270e-03  1.42311776e-01  8.58977927e-01]
  HOMO = -0.582888033443671  LUMO = 0.906819717552595
  mo_energy =
[-1.18579783e+02 -1.23116023e+01 -9.56236678e+00 -9.56236678e+00
 -9.56236678e+00 -1.26995165e+00 -5.82888033e-01 -5.82888033e-01
 -5.82888033e-01  9.06819718e-01  1.01807784e+00  1.01807784e+00
  1.01807784e+00  4.64144658e+00  7.31672502e+00  7.31672502e+00
  7.31672502e+00  1.93977289e+01  3.34952006e+01  3.34952006e+01
  3.34952006e+01  1.15443458e+02  1.29041500e+02  1.29041500e+02
  1.29041500e+02  4.83355012e+02  4.83355012e+02  4.83355012e+02
  5.96729721e+02  1.33517557e+03  1.33517557e+03  1.33517557e+03
  2.66396120e+03  3.02939937e+03  3.02939937e+03  3.02939937e+03
  6.64982509e+03  6.64982509e+03  6.64982509e+03  9.06870230e+03
  2.54238272e+04  7.61656224e+04]
E1 = -728.2853313590352  E_coul = 201.54591718302262
cycle= 4 E= -526.739414176013  delta_E= -1.89e-06  |g|= 0.000104  |ddm|= 0.00592
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000118171
diis-c [-6.53977224e-09  8.40522278e-05 -1.17332044e-02 -7.45217622e-02
  1.08617091e+00]
  HOMO = -0.582867666589079  LUMO = 0.906850180222261
  mo_energy =
[-1.18579726e+02 -1.23115256e+01 -9.56230360e+00 -9.56230360e+00
 -9.56230360e+00 -1.26990678e+00 -5.82867667e-01 -5.82867667e-01
 -5.82867667e-01  9.06850180e-01  1.01809535e+00  1.01809535e+00
  1.01809535e+00  4.64149217e+00  7.31677392e+00  7.31677392e+00
  7.31677392e+00  1.93977945e+01  3.34952615e+01  3.34952615e+01
  3.34952615e+01  1.15443524e+02  1.29041563e+02  1.29041563e+02
  1.29041563e+02  4.83355069e+02  4.83355069e+02  4.83355069e+02
  5.96729771e+02  1.33517562e+03  1.33517562e+03  1.33517562e+03
  2.66396122e+03  3.02939941e+03  3.02939941e+03  3.02939941e+03
  6.64982512e+03  6.64982512e+03  6.64982512e+03  9.06870232e+03
  2.54238272e+04  7.61656224e+04]
E1 = -728.285068641421  E_coul = 201.54565446346135
cycle= 5 E= -526.73941417796  delta_E= -1.95e-09  |g|= 2.13e-05  |ddm|= 0.0025
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.00966e-05
diis-c [-1.09094989e-10  1.29278822e-05 -1.58924980e-03 -1.24567509e-02
  2.16129815e-02  9.92420091e-01]
  HOMO = -0.582875874073234  LUMO = 0.906846784680918
  mo_energy =
[-1.18579760e+02 -1.23115505e+01 -9.56233035e+00 -9.56233035e+00
 -9.56233035e+00 -1.26991355e+00 -5.82875874e-01 -5.82875874e-01
 -5.82875874e-01  9.06846785e-01  1.01808987e+00  1.01808987e+00
  1.01808987e+00  4.64148115e+00  7.31675562e+00  7.31675562e+00
  7.31675562e+00  1.93977733e+01  3.34952355e+01  3.34952355e+01
  3.34952355e+01  1.15443495e+02  1.29041532e+02  1.29041532e+02
  1.29041532e+02  4.83355036e+02  4.83355036e+02  4.83355036e+02
  5.96729737e+02  1.33517559e+03  1.33517559e+03  1.33517559e+03
  2.66396119e+03  3.02939937e+03  3.02939937e+03  3.02939937e+03
  6.64982508e+03  6.64982508e+03  6.64982508e+03  9.06870228e+03
  2.54238272e+04  7.61656224e+04]
E1 = -728.2851581230111  E_coul = 201.5457439449892
cycle= 6 E= -526.739414178022  delta_E= -6.22e-11  |g|= 1.72e-06  |ddm|= 0.000293
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2851581230111  E_coul = 201.5457439449892
  HOMO = -0.582875609658386  LUMO = 0.906847235877526
  mo_energy =
[-1.18579758e+02 -1.23115494e+01 -9.56232931e+00 -9.56232931e+00
 -9.56232931e+00 -1.26991291e+00 -5.82875610e-01 -5.82875610e-01
 -5.82875610e-01  9.06847236e-01  1.01809011e+00  1.01809011e+00
  1.01809011e+00  4.64148177e+00  7.31675633e+00  7.31675633e+00
  7.31675633e+00  1.93977742e+01  3.34952366e+01  3.34952366e+01
  3.34952366e+01  1.15443496e+02  1.29041533e+02  1.29041533e+02
  1.29041533e+02  4.83355038e+02  4.83355038e+02  4.83355038e+02
  5.96729738e+02  1.33517559e+03  1.33517559e+03  1.33517559e+03
  2.66396119e+03  3.02939938e+03  3.02939938e+03  3.02939938e+03
  6.64982508e+03  6.64982508e+03  6.64982508e+03  9.06870228e+03
  2.54238272e+04  7.61656224e+04]
E1 = -728.2851537636946  E_coul = 201.5457395856726
Extra cycle  E= -526.739414178022  delta_E=    0  |g|= 3.77e-07  |ddm|= 3.74e-05
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826564e+04 7.61752077e+03 3.61735141e+03 1.59780171e+03
 3.82867338e+02 1.08154136e+02 3.61191681e+01 8.41414318e+00
 3.57908380e+00 8.76402754e-01 9.77293993e-01 2.46395138e-01
 1.36278338e+03 6.64743953e+02 3.00953835e+02 3.14035242e+02
 6.16310476e+01 7.35008091e+00 2.02210789e+01 7.76640218e-01
 2.82624686e+00 2.23453111e-01]
E = -526.7394141780219
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:45 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6563775        1
[INPUT] 0    0    [1    /1   ]  7617.52077448        1
[INPUT] 0    0    [1    /1   ]  3617.351409          1
[INPUT] 0    0    [1    /1   ]  1597.80171449        1
[INPUT] 0    0    [1    /1   ]  382.867337725        1
[INPUT] 0    0    [1    /1   ]  108.154135653        1
[INPUT] 0    0    [1    /1   ]  36.1191680562        1
[INPUT] 0    0    [1    /1   ]  8.41414317937        1
[INPUT] 0    0    [1    /1   ]  3.5790838019         1
[INPUT] 0    0    [1    /1   ]  0.876402754006       1
[INPUT] 0    0    [1    /1   ]  0.977293992946       1
[INPUT] 0    0    [1    /1   ]  0.246395138295       1
[INPUT] 1    0    [1    /1   ]  1362.78338025        1
[INPUT] 1    0    [1    /1   ]  664.743952973        1
[INPUT] 1    0    [1    /1   ]  300.953835185        1
[INPUT] 1    0    [1    /1   ]  314.035241647        1
[INPUT] 1    0    [1    /1   ]  61.6310476382        1
[INPUT] 1    0    [1    /1   ]  7.35008091061        1
[INPUT] 1    0    [1    /1   ]  20.2210789213        1
[INPUT] 1    0    [1    /1   ]  0.776640218119       1
[INPUT] 1    0    [1    /1   ]  2.82624686039        1
[INPUT] 1    0    [1    /1   ]  0.223453111431       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656377476796, 1.0]], [0, [7617.520774478976, 1.0]], [0, [3617.351409003931, 1.0]], [0, [1597.8017144889607, 1.0]], [0, [382.8673377250976, 1.0]], [0, [108.15413565341413, 1.0]], [0, [36.11916805624218, 1.0]], [0, [8.414143179368796, 1.0]], [0, [3.579083801899248, 1.0]], [0, [0.8764027540059466, 1.0]], [0, [0.977293992945643, 1.0]], [0, [0.24639513829495363, 1.0]], [1, [1362.7833802474618, 1.0]], [1, [664.7439529727847, 1.0]], [1, [300.9538351850959, 1.0]], [1, [314.03524164715265, 1.0]], [1, [61.63104763818177, 1.0]], [1, [7.350080910609593, 1.0]], [1, [20.221078921290314, 1.0]], [1, [0.7766402181190779, 1.0]], [1, [2.8262468603901794, 1.0]], [1, [0.22345311143104454, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65637748]
bas 1, expnt(s) = [7617.52077448]
bas 2, expnt(s) = [3617.351409]
bas 3, expnt(s) = [1597.80171449]
bas 4, expnt(s) = [382.86733773]
bas 5, expnt(s) = [108.15413565]
bas 6, expnt(s) = [36.11916806]
bas 7, expnt(s) = [8.41414318]
bas 8, expnt(s) = [3.5790838]
bas 9, expnt(s) = [0.87640275]
bas 10, expnt(s) = [0.97729399]
bas 11, expnt(s) = [0.24639514]
bas 12, expnt(s) = [1362.78338025]
bas 13, expnt(s) = [664.74395297]
bas 14, expnt(s) = [300.95383519]
bas 15, expnt(s) = [314.03524165]
bas 16, expnt(s) = [61.63104764]
bas 17, expnt(s) = [7.35008091]
bas 18, expnt(s) = [20.22107892]
bas 19, expnt(s) = [0.77664022]
bas 20, expnt(s) = [2.82624686]
bas 21, expnt(s) = [0.22345311]
CPU time:       110.94
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826564e+04 5.20026295e+03 7.61752077e+03 2.06003813e+03
 3.61735141e+03 1.17844156e+03 1.59780171e+03 6.38494538e+02
 3.82867338e+02 2.18676071e+02 1.08154136e+02 8.47319834e+01
 3.61191681e+01 3.72235962e+01 8.41414318e+00 1.24816629e+01
 3.57908380e+00 6.57421533e+00 8.76402754e-01 2.28845736e+00
 9.77293993e-01 2.48332720e+00 2.46395138e-01 8.83566263e-01
 1.36278338e+03 2.41556055e+04 6.64743953e+02 9.84696483e+03
 3.00953835e+02 3.65686767e+03 3.14035242e+02 3.85662469e+03
 6.16310476e+01 5.03771774e+02 7.35008091e+00 3.53060834e+01
 2.02210789e+01 1.25094956e+02 7.76640218e-01 2.12695959e+00
 2.82624686e+00 1.06904752e+01 2.23453111e-01 4.48195406e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99360732006378
cond(S) = 111728.9658397982
E1 = -729.5174762402122  E_coul = 203.17051831639637
init E= -526.346957923816
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555856057031361  LUMO = 0.922954812076677
  mo_energy =
[-1.18328352e+02 -1.22066697e+01 -9.44756409e+00 -9.44756409e+00
 -9.44756409e+00 -1.24013808e+00 -5.55856057e-01 -5.55856057e-01
 -5.55856057e-01  9.22954812e-01  1.03665207e+00  1.03665207e+00
  1.03665207e+00  4.68355332e+00  7.38718197e+00  7.38718197e+00
  7.38718197e+00  1.94852011e+01  3.36153870e+01  3.36153870e+01
  3.36153870e+01  1.15616220e+02  1.29222881e+02  1.29222881e+02
  1.29222881e+02  4.83605781e+02  4.83605781e+02  4.83605781e+02
  5.97016080e+02  1.33547947e+03  1.33547947e+03  1.33547947e+03
  2.66439783e+03  3.02976837e+03  3.02976837e+03  3.02976837e+03
  6.65030654e+03  6.65030654e+03  6.65030654e+03  9.06925874e+03
  2.54244774e+04  7.61663627e+04]
E1 = -727.8411141286224  E_coul = 201.10248360912362
cycle= 1 E= -526.738630519499  delta_E= -0.392  |g|= 0.187  |ddm|= 3.73
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544224
diis-c [-0.29617978  1.        ]
  HOMO = -0.590347621327083  LUMO = 0.901518577241662
  mo_energy =
[-1.18637532e+02 -1.23436816e+01 -9.59576536e+00 -9.59576536e+00
 -9.59576536e+00 -1.27901931e+00 -5.90347621e-01 -5.90347621e-01
 -5.90347621e-01  9.01518577e-01  1.01252688e+00  1.01252688e+00
  1.01252688e+00  4.62896827e+00  7.29689155e+00  7.29689155e+00
  7.29689155e+00  1.93715403e+01  3.34614514e+01  3.34614514e+01
  3.34614514e+01  1.15396286e+02  1.28994018e+02  1.28994018e+02
  1.28994018e+02  4.83297965e+02  4.83297965e+02  4.83297965e+02
  5.96670745e+02  1.33511505e+03  1.33511505e+03  1.33511505e+03
  2.66389800e+03  3.02933698e+03  3.02933698e+03  3.02933698e+03
  6.64976135e+03  6.64976135e+03  6.64976135e+03  9.06863796e+03
  2.54237625e+04  7.61655575e+04]
E1 = -728.412735268727  E_coul = 201.67338206449185
cycle= 2 E= -526.739353204235  delta_E= -0.000723  |g|= 0.0378  |ddm|= 0.252
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.076196
diis-c [-0.00334573  0.08396134  0.91603866]
  HOMO = -0.581400599324249  LUMO = 0.907778846164547
  mo_energy =
[-1.18569906e+02 -1.23058420e+01 -9.55625642e+00 -9.55625642e+00
 -9.55625642e+00 -1.26827767e+00 -5.81400599e-01 -5.81400599e-01
 -5.81400599e-01  9.07778846e-01  1.01915319e+00  1.01915319e+00
  1.01915319e+00  4.64379344e+00  7.32048422e+00  7.32048422e+00
  7.32048422e+00  1.94024977e+01  3.35013263e+01  3.35013263e+01
  3.35013263e+01  1.15451633e+02  1.29049781e+02  1.29049781e+02
  1.29049781e+02  4.83364774e+02  4.83364774e+02  4.83364774e+02
  5.96739820e+02  1.33518592e+03  1.33518592e+03  1.33518592e+03
  2.66397217e+03  3.02941010e+03  3.02941010e+03  3.02941010e+03
  6.64983622e+03  6.64983622e+03  6.64983622e+03  9.06871364e+03
  2.54238387e+04  7.61656341e+04]
E1 = -728.2627255976013  E_coul = 201.52331331557153
cycle= 3 E= -526.73941228203  delta_E= -5.91e-05  |g|= 0.00623  |ddm|= 0.059
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.013132
diis-c [-7.53250656e-07 -1.28970270e-03  1.42311776e-01  8.58977927e-01]
  HOMO = -0.582888033443671  LUMO = 0.906819717552595
  mo_energy =
[-1.18579783e+02 -1.23116023e+01 -9.56236678e+00 -9.56236678e+00
 -9.56236678e+00 -1.26995165e+00 -5.82888033e-01 -5.82888033e-01
 -5.82888033e-01  9.06819718e-01  1.01807784e+00  1.01807784e+00
  1.01807784e+00  4.64144658e+00  7.31672502e+00  7.31672502e+00
  7.31672502e+00  1.93977289e+01  3.34952006e+01  3.34952006e+01
  3.34952006e+01  1.15443458e+02  1.29041500e+02  1.29041500e+02
  1.29041500e+02  4.83355012e+02  4.83355012e+02  4.83355012e+02
  5.96729721e+02  1.33517557e+03  1.33517557e+03  1.33517557e+03
  2.66396120e+03  3.02939937e+03  3.02939937e+03  3.02939937e+03
  6.64982509e+03  6.64982509e+03  6.64982509e+03  9.06870230e+03
  2.54238272e+04  7.61656224e+04]
E1 = -728.2853313590352  E_coul = 201.54591718302262
cycle= 4 E= -526.739414176013  delta_E= -1.89e-06  |g|= 0.000104  |ddm|= 0.00592
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000118171
diis-c [-6.53977224e-09  8.40522278e-05 -1.17332044e-02 -7.45217622e-02
  1.08617091e+00]
  HOMO = -0.582867666589079  LUMO = 0.906850180222261
  mo_energy =
[-1.18579726e+02 -1.23115256e+01 -9.56230360e+00 -9.56230360e+00
 -9.56230360e+00 -1.26990678e+00 -5.82867667e-01 -5.82867667e-01
 -5.82867667e-01  9.06850180e-01  1.01809535e+00  1.01809535e+00
  1.01809535e+00  4.64149217e+00  7.31677392e+00  7.31677392e+00
  7.31677392e+00  1.93977945e+01  3.34952615e+01  3.34952615e+01
  3.34952615e+01  1.15443524e+02  1.29041563e+02  1.29041563e+02
  1.29041563e+02  4.83355069e+02  4.83355069e+02  4.83355069e+02
  5.96729771e+02  1.33517562e+03  1.33517562e+03  1.33517562e+03
  2.66396122e+03  3.02939941e+03  3.02939941e+03  3.02939941e+03
  6.64982512e+03  6.64982512e+03  6.64982512e+03  9.06870232e+03
  2.54238272e+04  7.61656224e+04]
E1 = -728.285068641421  E_coul = 201.54565446346135
cycle= 5 E= -526.73941417796  delta_E= -1.95e-09  |g|= 2.13e-05  |ddm|= 0.0025
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.00966e-05
diis-c [-1.09094989e-10  1.29278822e-05 -1.58924980e-03 -1.24567509e-02
  2.16129815e-02  9.92420091e-01]
  HOMO = -0.582875874073234  LUMO = 0.906846784680918
  mo_energy =
[-1.18579760e+02 -1.23115505e+01 -9.56233035e+00 -9.56233035e+00
 -9.56233035e+00 -1.26991355e+00 -5.82875874e-01 -5.82875874e-01
 -5.82875874e-01  9.06846785e-01  1.01808987e+00  1.01808987e+00
  1.01808987e+00  4.64148115e+00  7.31675562e+00  7.31675562e+00
  7.31675562e+00  1.93977733e+01  3.34952355e+01  3.34952355e+01
  3.34952355e+01  1.15443495e+02  1.29041532e+02  1.29041532e+02
  1.29041532e+02  4.83355036e+02  4.83355036e+02  4.83355036e+02
  5.96729737e+02  1.33517559e+03  1.33517559e+03  1.33517559e+03
  2.66396119e+03  3.02939937e+03  3.02939937e+03  3.02939937e+03
  6.64982508e+03  6.64982508e+03  6.64982508e+03  9.06870228e+03
  2.54238272e+04  7.61656224e+04]
E1 = -728.2851581230111  E_coul = 201.5457439449892
cycle= 6 E= -526.739414178022  delta_E= -6.22e-11  |g|= 1.72e-06  |ddm|= 0.000293
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2851581230111  E_coul = 201.5457439449892
  HOMO = -0.582875609658386  LUMO = 0.906847235877526
  mo_energy =
[-1.18579758e+02 -1.23115494e+01 -9.56232931e+00 -9.56232931e+00
 -9.56232931e+00 -1.26991291e+00 -5.82875610e-01 -5.82875610e-01
 -5.82875610e-01  9.06847236e-01  1.01809011e+00  1.01809011e+00
  1.01809011e+00  4.64148177e+00  7.31675633e+00  7.31675633e+00
  7.31675633e+00  1.93977742e+01  3.34952366e+01  3.34952366e+01
  3.34952366e+01  1.15443496e+02  1.29041533e+02  1.29041533e+02
  1.29041533e+02  4.83355038e+02  4.83355038e+02  4.83355038e+02
  5.96729738e+02  1.33517559e+03  1.33517559e+03  1.33517559e+03
  2.66396119e+03  3.02939938e+03  3.02939938e+03  3.02939938e+03
  6.64982508e+03  6.64982508e+03  6.64982508e+03  9.06870228e+03
  2.54238272e+04  7.61656224e+04]
E1 = -728.2851537636946  E_coul = 201.5457395856726
Extra cycle  E= -526.739414178022  delta_E=    0  |g|= 3.77e-07  |ddm|= 3.74e-05
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111728.9658397982
E1 = -728.2851537636946  E_coul = 201.5457395856726
init E= -526.739414178022
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.582875705867427  LUMO = 0.90684722555589
  mo_energy =
[-1.18579759e+02 -1.23115497e+01 -9.56232965e+00 -9.56232965e+00
 -9.56232965e+00 -1.26991295e+00 -5.82875706e-01 -5.82875706e-01
 -5.82875706e-01  9.06847226e-01  1.01809005e+00  1.01809005e+00
  1.01809005e+00  4.64148166e+00  7.31675611e+00  7.31675611e+00
  7.31675611e+00  1.93977739e+01  3.34952362e+01  3.34952362e+01
  3.34952362e+01  1.15443495e+02  1.29041533e+02  1.29041533e+02
  1.29041533e+02  4.83355037e+02  4.83355037e+02  4.83355037e+02
  5.96729738e+02  1.33517559e+03  1.33517559e+03  1.33517559e+03
  2.66396119e+03  3.02939937e+03  3.02939937e+03  3.02939937e+03
  6.64982508e+03  6.64982508e+03  6.64982508e+03  9.06870228e+03
  2.54238272e+04  7.61656224e+04]
E1 = -728.2851548940786  E_coul = 201.5457407160569
cycle= 1 E= -526.739414178022  delta_E= 2.27e-13  |g|= 9.69e-08  |ddm|= 7.46e-06
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2851548940786  E_coul = 201.5457407160569
  HOMO = -0.582875687032316  LUMO = 0.906847249425358
  mo_energy =
[-1.18579758e+02 -1.23115496e+01 -9.56232957e+00 -9.56232957e+00
 -9.56232957e+00 -1.26991291e+00 -5.82875687e-01 -5.82875687e-01
 -5.82875687e-01  9.06847249e-01  1.01809007e+00  1.01809007e+00
  1.01809007e+00  4.64148170e+00  7.31675616e+00  7.31675616e+00
  7.31675616e+00  1.93977740e+01  3.34952363e+01  3.34952363e+01
  3.34952363e+01  1.15443496e+02  1.29041533e+02  1.29041533e+02
  1.29041533e+02  4.83355037e+02  4.83355037e+02  4.83355037e+02
  5.96729738e+02  1.33517559e+03  1.33517559e+03  1.33517559e+03
  2.66396119e+03  3.02939937e+03  3.02939937e+03  3.02939937e+03
  6.64982508e+03  6.64982508e+03  6.64982508e+03  9.06870228e+03
  2.54238272e+04  7.61656224e+04]
E1 = -728.285154554401  E_coul = 201.54574037637872
Extra cycle  E= -526.739414178022  delta_E= -5.68e-13  |g|= 2.32e-08  |ddm|= 1.6e-06
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826564e+04 7.61752077e+03 3.61735141e+03 1.59780171e+03
 3.82867338e+02 1.08154136e+02 3.61191681e+01 8.41414318e+00
 3.57908380e+00 8.76402754e-01 9.77293993e-01 2.46395138e-01
 1.36278338e+03 6.64743953e+02 3.00953835e+02 3.14035242e+02
 6.16310476e+01 7.35008091e+00 2.02210789e+01 7.76640218e-01
 2.82624686e+00 2.23453111e-01]
grad_E = [-1.49854135e-06  3.10303169e-06 -1.67769372e-06  6.12326692e-05
  2.32912391e-04 -2.40039627e-03  1.20113007e-03 -1.13298366e-03
 -1.37552782e-03  1.59501034e-03  7.38765364e-04 -4.75673055e-03
 -5.13358230e-07  4.91677735e-06  2.30698394e-05  1.98920864e-05
  4.25519848e-05  7.05836490e-04 -4.09039597e-04 -4.55535697e-03
  1.43178345e-04  1.61760696e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:50 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6564192        1
[INPUT] 0    0    [1    /1   ]  7617.52068442        1
[INPUT] 0    0    [1    /1   ]  3617.35145318        1
[INPUT] 0    0    [1    /1   ]  1597.79984994        1
[INPUT] 0    0    [1    /1   ]  382.866683315        1
[INPUT] 0    0    [1    /1   ]  108.172818964        1
[INPUT] 0    0    [1    /1   ]  36.1899802967        1
[INPUT] 0    0    [1    /1   ]  8.47865038532        1
[INPUT] 0    0    [1    /1   ]  3.63226179617        1
[INPUT] 0    0    [1    /1   ]  0.873307537984       1
[INPUT] 0    0    [1    /1   ]  1.01357769062        1
[INPUT] 0    0    [1    /1   ]  0.246902770846       1
[INPUT] 1    0    [1    /1   ]  1362.78339426        1
[INPUT] 1    0    [1    /1   ]  664.743815074        1
[INPUT] 1    0    [1    /1   ]  300.953185238        1
[INPUT] 1    0    [1    /1   ]  314.03468126         1
[INPUT] 1    0    [1    /1   ]  61.6312941602        1
[INPUT] 1    0    [1    /1   ]  7.34848506082        1
[INPUT] 1    0    [1    /1   ]  20.2225568445        1
[INPUT] 1    0    [1    /1   ]  0.776127662207       1
[INPUT] 1    0    [1    /1   ]  2.82312001636        1
[INPUT] 1    0    [1    /1   ]  0.224022741263       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656419237395, 1.0]], [0, [7617.520684424641, 1.0]], [0, [3617.3514531776077, 1.0]], [0, [1597.7998499408347, 1.0]], [0, [382.8666833149114, 1.0]], [0, [108.17281896448611, 1.0]], [0, [36.189980296665226, 1.0]], [0, [8.478650385319382, 1.0]], [0, [3.632261796165009, 1.0]], [0, [0.8733075379839961, 1.0]], [0, [1.0135776906203313, 1.0]], [0, [0.24690277084648943, 1.0]], [1, [1362.7833942584268, 1.0]], [1, [664.7438150741947, 1.0]], [1, [300.95318523784863, 1.0]], [1, [314.0346812602324, 1.0]], [1, [61.63129416020914, 1.0]], [1, [7.348485060820193, 1.0]], [1, [20.222556844453567, 1.0]], [1, [0.776127662206529, 1.0]], [1, [2.8231200163565195, 1.0]], [1, [0.2240227412630079, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65641924]
bas 1, expnt(s) = [7617.52068442]
bas 2, expnt(s) = [3617.35145318]
bas 3, expnt(s) = [1597.79984994]
bas 4, expnt(s) = [382.86668331]
bas 5, expnt(s) = [108.17281896]
bas 6, expnt(s) = [36.1899803]
bas 7, expnt(s) = [8.47865039]
bas 8, expnt(s) = [3.6322618]
bas 9, expnt(s) = [0.87330754]
bas 10, expnt(s) = [1.01357769]
bas 11, expnt(s) = [0.24690277]
bas 12, expnt(s) = [1362.78339426]
bas 13, expnt(s) = [664.74381507]
bas 14, expnt(s) = [300.95318524]
bas 15, expnt(s) = [314.03468126]
bas 16, expnt(s) = [61.63129416]
bas 17, expnt(s) = [7.34848506]
bas 18, expnt(s) = [20.22255684]
bas 19, expnt(s) = [0.77612766]
bas 20, expnt(s) = [2.82312002]
bas 21, expnt(s) = [0.22402274]
CPU time:       116.67
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826564e+04 5.20026295e+03 7.61752068e+03 2.06003812e+03
 3.61735145e+03 1.17844157e+03 1.59779985e+03 6.38493979e+02
 3.82866683e+02 2.18675791e+02 1.08172819e+02 8.47429611e+01
 3.61899803e+01 3.72783159e+01 8.47865039e+00 1.25533625e+01
 3.63226180e+00 6.64733983e+00 8.73307538e-01 2.28239302e+00
 1.01357769e+00 2.55215946e+00 2.46902771e-01 8.84931179e-01
 1.36278339e+03 2.41556058e+04 6.64743815e+02 9.84696228e+03
 3.00953185e+02 3.65685780e+03 3.14034681e+02 3.85661609e+03
 6.16312942e+01 5.03774292e+02 7.34848506e+00 3.52965016e+01
 2.02225568e+01 1.25106385e+02 7.76127662e-01 2.12520508e+00
 2.82312002e+00 1.06756928e+01 2.24022741e-01 4.49624043e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993551497635565
cond(S) = 111831.30652090022
E1 = -729.5167371433342  E_coul = 203.17017061847298
init E= -526.346566524861
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555826565112734  LUMO = 0.934930762929659
  mo_energy =
[-1.18328441e+02 -1.22067409e+01 -9.44761272e+00 -9.44761272e+00
 -9.44761272e+00 -1.24011354e+00 -5.55826565e-01 -5.55826565e-01
 -5.55826565e-01  9.34930763e-01  1.03842762e+00  1.03842762e+00
  1.03842762e+00  4.77685903e+00  7.38167218e+00  7.38167218e+00
  7.38167218e+00  1.98527087e+01  3.36012363e+01  3.36012363e+01
  3.36012363e+01  1.16385315e+02  1.29210841e+02  1.29210841e+02
  1.29210841e+02  4.83597644e+02  4.83597644e+02  4.83597644e+02
  5.97899082e+02  1.33547151e+03  1.33547151e+03  1.33547151e+03
  2.66522020e+03  3.02975934e+03  3.02975934e+03  3.02975934e+03
  6.65029694e+03  6.65029694e+03  6.65029694e+03  9.07001789e+03
  2.54251953e+04  7.61670309e+04]
E1 = -727.8521964792199  E_coul = 201.11349802388946
cycle= 1 E= -526.73869845533  delta_E= -0.392  |g|= 0.186  |ddm|=  2.2
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544016
diis-c [-0.29595332  1.        ]
  HOMO = -0.589935750843734  LUMO = 0.913484389463311
  mo_energy =
[-1.18636708e+02 -1.23429914e+01 -9.59501852e+00 -9.59501852e+00
 -9.59501852e+00 -1.27853060e+00 -5.89935751e-01 -5.89935751e-01
 -5.89935751e-01  9.13484389e-01  1.01458628e+00  1.01458628e+00
  1.01458628e+00  4.72200975e+00  7.29211353e+00  7.29211353e+00
  7.29211353e+00  1.97390566e+01  3.34480955e+01  3.34480955e+01
  3.34480955e+01  1.16166137e+02  1.28982835e+02  1.28982835e+02
  1.28982835e+02  4.83290739e+02  4.83290739e+02  4.83290739e+02
  5.97554686e+02  1.33510802e+03  1.33510802e+03  1.33510802e+03
  2.66472130e+03  3.02932887e+03  3.02932887e+03  3.02932887e+03
  6.64975267e+03  6.64975267e+03  6.64975267e+03  9.06939804e+03
  2.54244812e+04  7.61662266e+04]
E1 = -728.4202027545487  E_coul = 201.68078842324064
cycle= 2 E= -526.739414331308  delta_E= -0.000716  |g|= 0.0376  |ddm|= 0.144
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0758927
diis-c [-0.00332875  0.0835316   0.9164684 ]
  HOMO = -0.581055042999249  LUMO = 0.919792618108053
  mo_energy =
[-1.18569399e+02 -1.23053817e+01 -9.55574664e+00 -9.55574664e+00
 -9.55574664e+00 -1.26786418e+00 -5.81055043e-01 -5.81055043e-01
 -5.81055043e-01  9.19792618e-01  1.02116693e+00  1.02116693e+00
  1.02116693e+00  4.73694276e+00  7.31553563e+00  7.31553563e+00
  7.31553563e+00  1.97700030e+01  3.34877377e+01  3.34877377e+01
  3.34877377e+01  1.16221219e+02  1.29038316e+02  1.29038316e+02
  1.29038316e+02  4.83357235e+02  4.83357235e+02  4.83357235e+02
  5.97623438e+02  1.33517857e+03  1.33517857e+03  1.33517857e+03
  2.66479514e+03  3.02940166e+03  3.02940166e+03  3.02940166e+03
  6.64982720e+03  6.64982720e+03  6.64982720e+03  9.06947338e+03
  2.54245571e+04  7.61663029e+04]
E1 = -728.271282714247  E_coul = 201.53181008489503
cycle= 3 E= -526.739472629352  delta_E= -5.83e-05  |g|= 0.0062  |ddm|= 0.0396
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0130884
diis-c [-7.59377416e-07 -1.28853629e-03  1.42387371e-01  8.58901166e-01]
  HOMO = -0.582532807963648  LUMO = 0.91882792115859
  mo_energy =
[-1.18579237e+02 -1.23111135e+01 -9.56182764e+00 -9.56182764e+00
 -9.56182764e+00 -1.26952510e+00 -5.82532808e-01 -5.82532808e-01
 -5.82532808e-01  9.18827921e-01  1.02009867e+00  1.02009867e+00
  1.02009867e+00  4.73457819e+00  7.31179964e+00  7.31179964e+00
  7.31179964e+00  1.97652319e+01  3.34816413e+01  3.34816413e+01
  3.34816413e+01  1.16213076e+02  1.29030070e+02  1.29030070e+02
  1.29030070e+02  4.83347511e+02  4.83347511e+02  4.83347511e+02
  5.97613378e+02  1.33516826e+03  1.33516826e+03  1.33516826e+03
  2.66478421e+03  3.02939097e+03  3.02939097e+03  3.02939097e+03
  6.64981612e+03  6.64981612e+03  6.64981612e+03  9.06946209e+03
  2.54245456e+04  7.61662912e+04]
E1 = -728.2937450718257  E_coul = 201.5542705693896
cycle= 4 E= -526.739474502436  delta_E= -1.87e-06  |g|= 0.000106  |ddm|= 0.00367
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119558
diis-c [-6.65754460e-09  8.60754327e-05 -1.19971320e-02 -7.60751968e-02
  1.08798625e+00]
  HOMO = -0.582512319280649  LUMO = 0.918859263923788
  mo_energy =
[-1.18579180e+02 -1.23110364e+01 -9.56176418e+00 -9.56176418e+00
 -9.56176418e+00 -1.26947960e+00 -5.82512319e-01 -5.82512319e-01
 -5.82512319e-01  9.18859264e-01  1.02011636e+00  1.02011636e+00
  1.02011636e+00  4.73462469e+00  7.31184879e+00  7.31184879e+00
  7.31184879e+00  1.97652981e+01  3.34817025e+01  3.34817025e+01
  3.34817025e+01  1.16213142e+02  1.29030133e+02  1.29030133e+02
  1.29030133e+02  4.83347569e+02  4.83347569e+02  4.83347569e+02
  5.97613429e+02  1.33516831e+03  1.33516831e+03  1.33516831e+03
  2.66478424e+03  3.02939101e+03  3.02939101e+03  3.02939101e+03
  6.64981614e+03  6.64981614e+03  6.64981614e+03  9.06946210e+03
  2.54245456e+04  7.61662912e+04]
E1 = -728.2934817758464  E_coul = 201.55400727137808
cycle= 5 E= -526.739474504468  delta_E= -2.03e-09  |g|= 2.14e-05  |ddm|= 0.00149
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.02855e-05
diis-c [-1.10220862e-10  1.30751379e-05 -1.60832198e-03 -1.25860283e-02
  2.12422821e-02  9.92938993e-01]
  HOMO = -0.582520566273596  LUMO = 0.918855816191363
  mo_energy =
[-1.18579213e+02 -1.23110614e+01 -9.56179108e+00 -9.56179108e+00
 -9.56179108e+00 -1.26948639e+00 -5.82520566e-01 -5.82520566e-01
 -5.82520566e-01  9.18855816e-01  1.02011085e+00  1.02011085e+00
  1.02011085e+00  4.73461347e+00  7.31183040e+00  7.31183040e+00
  7.31183040e+00  1.97652766e+01  3.34816764e+01  3.34816764e+01
  3.34816764e+01  1.16213112e+02  1.29030102e+02  1.29030102e+02
  1.29030102e+02  4.83347536e+02  4.83347536e+02  4.83347536e+02
  5.97613395e+02  1.33516828e+03  1.33516828e+03  1.33516828e+03
  2.66478420e+03  3.02939097e+03  3.02939097e+03  3.02939097e+03
  6.64981611e+03  6.64981611e+03  6.64981611e+03  9.06946207e+03
  2.54245456e+04  7.61662912e+04]
E1 = -728.2935716024679  E_coul = 201.55409709793832
cycle= 6 E= -526.73947450453  delta_E= -6.12e-11  |g|= 1.71e-06  |ddm|= 0.000171
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2935716024679  E_coul = 201.55409709793832
  HOMO = -0.582520295338733  LUMO = 0.918856273962534
  mo_energy =
[-1.18579212e+02 -1.23110603e+01 -9.56179002e+00 -9.56179002e+00
 -9.56179002e+00 -1.26948573e+00 -5.82520295e-01 -5.82520295e-01
 -5.82520295e-01  9.18856274e-01  1.02011109e+00  1.02011109e+00
  1.02011109e+00  4.73461410e+00  7.31183112e+00  7.31183112e+00
  7.31183112e+00  1.97652776e+01  3.34816775e+01  3.34816775e+01
  3.34816775e+01  1.16213114e+02  1.29030104e+02  1.29030104e+02
  1.29030104e+02  4.83347538e+02  4.83347538e+02  4.83347538e+02
  5.97613397e+02  1.33516828e+03  1.33516828e+03  1.33516828e+03
  2.66478420e+03  3.02939098e+03  3.02939098e+03  3.02939098e+03
  6.64981611e+03  6.64981611e+03  6.64981611e+03  9.06946207e+03
  2.54245456e+04  7.61662912e+04]
E1 = -728.293567179787  E_coul = 201.5540926752559
Extra cycle  E= -526.739474504531  delta_E= -1.59e-12  |g|= 3.77e-07  |ddm|= 2.19e-05
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826564e+04 7.61752068e+03 3.61735145e+03 1.59779985e+03
 3.82866683e+02 1.08172819e+02 3.61899803e+01 8.47865039e+00
 3.63226180e+00 8.73307538e-01 1.01357769e+00 2.46902771e-01
 1.36278339e+03 6.64743815e+02 3.00953185e+02 3.14034681e+02
 6.16312942e+01 7.34848506e+00 2.02225568e+01 7.76127662e-01
 2.82312002e+00 2.24022741e-01]
E = -526.7394745045311
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:50 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6564192        1
[INPUT] 0    0    [1    /1   ]  7617.52068442        1
[INPUT] 0    0    [1    /1   ]  3617.35145318        1
[INPUT] 0    0    [1    /1   ]  1597.79984994        1
[INPUT] 0    0    [1    /1   ]  382.866683315        1
[INPUT] 0    0    [1    /1   ]  108.172818964        1
[INPUT] 0    0    [1    /1   ]  36.1899802967        1
[INPUT] 0    0    [1    /1   ]  8.47865038532        1
[INPUT] 0    0    [1    /1   ]  3.63226179617        1
[INPUT] 0    0    [1    /1   ]  0.873307537984       1
[INPUT] 0    0    [1    /1   ]  1.01357769062        1
[INPUT] 0    0    [1    /1   ]  0.246902770846       1
[INPUT] 1    0    [1    /1   ]  1362.78339426        1
[INPUT] 1    0    [1    /1   ]  664.743815074        1
[INPUT] 1    0    [1    /1   ]  300.953185238        1
[INPUT] 1    0    [1    /1   ]  314.03468126         1
[INPUT] 1    0    [1    /1   ]  61.6312941602        1
[INPUT] 1    0    [1    /1   ]  7.34848506082        1
[INPUT] 1    0    [1    /1   ]  20.2225568445        1
[INPUT] 1    0    [1    /1   ]  0.776127662207       1
[INPUT] 1    0    [1    /1   ]  2.82312001636        1
[INPUT] 1    0    [1    /1   ]  0.224022741263       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656419237395, 1.0]], [0, [7617.520684424641, 1.0]], [0, [3617.3514531776077, 1.0]], [0, [1597.7998499408347, 1.0]], [0, [382.8666833149114, 1.0]], [0, [108.17281896448611, 1.0]], [0, [36.189980296665226, 1.0]], [0, [8.478650385319382, 1.0]], [0, [3.632261796165009, 1.0]], [0, [0.8733075379839961, 1.0]], [0, [1.0135776906203313, 1.0]], [0, [0.24690277084648943, 1.0]], [1, [1362.7833942584268, 1.0]], [1, [664.7438150741947, 1.0]], [1, [300.95318523784863, 1.0]], [1, [314.0346812602324, 1.0]], [1, [61.63129416020914, 1.0]], [1, [7.348485060820193, 1.0]], [1, [20.222556844453567, 1.0]], [1, [0.776127662206529, 1.0]], [1, [2.8231200163565195, 1.0]], [1, [0.2240227412630079, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65641924]
bas 1, expnt(s) = [7617.52068442]
bas 2, expnt(s) = [3617.35145318]
bas 3, expnt(s) = [1597.79984994]
bas 4, expnt(s) = [382.86668331]
bas 5, expnt(s) = [108.17281896]
bas 6, expnt(s) = [36.1899803]
bas 7, expnt(s) = [8.47865039]
bas 8, expnt(s) = [3.6322618]
bas 9, expnt(s) = [0.87330754]
bas 10, expnt(s) = [1.01357769]
bas 11, expnt(s) = [0.24690277]
bas 12, expnt(s) = [1362.78339426]
bas 13, expnt(s) = [664.74381507]
bas 14, expnt(s) = [300.95318524]
bas 15, expnt(s) = [314.03468126]
bas 16, expnt(s) = [61.63129416]
bas 17, expnt(s) = [7.34848506]
bas 18, expnt(s) = [20.22255684]
bas 19, expnt(s) = [0.77612766]
bas 20, expnt(s) = [2.82312002]
bas 21, expnt(s) = [0.22402274]
CPU time:       117.03
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826564e+04 5.20026295e+03 7.61752068e+03 2.06003812e+03
 3.61735145e+03 1.17844157e+03 1.59779985e+03 6.38493979e+02
 3.82866683e+02 2.18675791e+02 1.08172819e+02 8.47429611e+01
 3.61899803e+01 3.72783159e+01 8.47865039e+00 1.25533625e+01
 3.63226180e+00 6.64733983e+00 8.73307538e-01 2.28239302e+00
 1.01357769e+00 2.55215946e+00 2.46902771e-01 8.84931179e-01
 1.36278339e+03 2.41556058e+04 6.64743815e+02 9.84696228e+03
 3.00953185e+02 3.65685780e+03 3.14034681e+02 3.85661609e+03
 6.16312942e+01 5.03774292e+02 7.34848506e+00 3.52965016e+01
 2.02225568e+01 1.25106385e+02 7.76127662e-01 2.12520508e+00
 2.82312002e+00 1.06756928e+01 2.24022741e-01 4.49624043e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993551497635565
cond(S) = 111831.30652090022
E1 = -729.5167371433342  E_coul = 203.17017061847298
init E= -526.346566524861
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555826565112734  LUMO = 0.934930762929659
  mo_energy =
[-1.18328441e+02 -1.22067409e+01 -9.44761272e+00 -9.44761272e+00
 -9.44761272e+00 -1.24011354e+00 -5.55826565e-01 -5.55826565e-01
 -5.55826565e-01  9.34930763e-01  1.03842762e+00  1.03842762e+00
  1.03842762e+00  4.77685903e+00  7.38167218e+00  7.38167218e+00
  7.38167218e+00  1.98527087e+01  3.36012363e+01  3.36012363e+01
  3.36012363e+01  1.16385315e+02  1.29210841e+02  1.29210841e+02
  1.29210841e+02  4.83597644e+02  4.83597644e+02  4.83597644e+02
  5.97899082e+02  1.33547151e+03  1.33547151e+03  1.33547151e+03
  2.66522020e+03  3.02975934e+03  3.02975934e+03  3.02975934e+03
  6.65029694e+03  6.65029694e+03  6.65029694e+03  9.07001789e+03
  2.54251953e+04  7.61670309e+04]
E1 = -727.8521964792199  E_coul = 201.11349802388946
cycle= 1 E= -526.73869845533  delta_E= -0.392  |g|= 0.186  |ddm|=  2.2
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544016
diis-c [-0.29595332  1.        ]
  HOMO = -0.589935750843734  LUMO = 0.913484389463311
  mo_energy =
[-1.18636708e+02 -1.23429914e+01 -9.59501852e+00 -9.59501852e+00
 -9.59501852e+00 -1.27853060e+00 -5.89935751e-01 -5.89935751e-01
 -5.89935751e-01  9.13484389e-01  1.01458628e+00  1.01458628e+00
  1.01458628e+00  4.72200975e+00  7.29211353e+00  7.29211353e+00
  7.29211353e+00  1.97390566e+01  3.34480955e+01  3.34480955e+01
  3.34480955e+01  1.16166137e+02  1.28982835e+02  1.28982835e+02
  1.28982835e+02  4.83290739e+02  4.83290739e+02  4.83290739e+02
  5.97554686e+02  1.33510802e+03  1.33510802e+03  1.33510802e+03
  2.66472130e+03  3.02932887e+03  3.02932887e+03  3.02932887e+03
  6.64975267e+03  6.64975267e+03  6.64975267e+03  9.06939804e+03
  2.54244812e+04  7.61662266e+04]
E1 = -728.4202027545487  E_coul = 201.68078842324064
cycle= 2 E= -526.739414331308  delta_E= -0.000716  |g|= 0.0376  |ddm|= 0.144
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0758927
diis-c [-0.00332875  0.0835316   0.9164684 ]
  HOMO = -0.581055042999249  LUMO = 0.919792618108053
  mo_energy =
[-1.18569399e+02 -1.23053817e+01 -9.55574664e+00 -9.55574664e+00
 -9.55574664e+00 -1.26786418e+00 -5.81055043e-01 -5.81055043e-01
 -5.81055043e-01  9.19792618e-01  1.02116693e+00  1.02116693e+00
  1.02116693e+00  4.73694276e+00  7.31553563e+00  7.31553563e+00
  7.31553563e+00  1.97700030e+01  3.34877377e+01  3.34877377e+01
  3.34877377e+01  1.16221219e+02  1.29038316e+02  1.29038316e+02
  1.29038316e+02  4.83357235e+02  4.83357235e+02  4.83357235e+02
  5.97623438e+02  1.33517857e+03  1.33517857e+03  1.33517857e+03
  2.66479514e+03  3.02940166e+03  3.02940166e+03  3.02940166e+03
  6.64982720e+03  6.64982720e+03  6.64982720e+03  9.06947338e+03
  2.54245571e+04  7.61663029e+04]
E1 = -728.271282714247  E_coul = 201.53181008489503
cycle= 3 E= -526.739472629352  delta_E= -5.83e-05  |g|= 0.0062  |ddm|= 0.0396
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0130884
diis-c [-7.59377416e-07 -1.28853629e-03  1.42387371e-01  8.58901166e-01]
  HOMO = -0.582532807963648  LUMO = 0.91882792115859
  mo_energy =
[-1.18579237e+02 -1.23111135e+01 -9.56182764e+00 -9.56182764e+00
 -9.56182764e+00 -1.26952510e+00 -5.82532808e-01 -5.82532808e-01
 -5.82532808e-01  9.18827921e-01  1.02009867e+00  1.02009867e+00
  1.02009867e+00  4.73457819e+00  7.31179964e+00  7.31179964e+00
  7.31179964e+00  1.97652319e+01  3.34816413e+01  3.34816413e+01
  3.34816413e+01  1.16213076e+02  1.29030070e+02  1.29030070e+02
  1.29030070e+02  4.83347511e+02  4.83347511e+02  4.83347511e+02
  5.97613378e+02  1.33516826e+03  1.33516826e+03  1.33516826e+03
  2.66478421e+03  3.02939097e+03  3.02939097e+03  3.02939097e+03
  6.64981612e+03  6.64981612e+03  6.64981612e+03  9.06946209e+03
  2.54245456e+04  7.61662912e+04]
E1 = -728.2937450718257  E_coul = 201.5542705693896
cycle= 4 E= -526.739474502436  delta_E= -1.87e-06  |g|= 0.000106  |ddm|= 0.00367
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119558
diis-c [-6.65754460e-09  8.60754327e-05 -1.19971320e-02 -7.60751968e-02
  1.08798625e+00]
  HOMO = -0.582512319280649  LUMO = 0.918859263923788
  mo_energy =
[-1.18579180e+02 -1.23110364e+01 -9.56176418e+00 -9.56176418e+00
 -9.56176418e+00 -1.26947960e+00 -5.82512319e-01 -5.82512319e-01
 -5.82512319e-01  9.18859264e-01  1.02011636e+00  1.02011636e+00
  1.02011636e+00  4.73462469e+00  7.31184879e+00  7.31184879e+00
  7.31184879e+00  1.97652981e+01  3.34817025e+01  3.34817025e+01
  3.34817025e+01  1.16213142e+02  1.29030133e+02  1.29030133e+02
  1.29030133e+02  4.83347569e+02  4.83347569e+02  4.83347569e+02
  5.97613429e+02  1.33516831e+03  1.33516831e+03  1.33516831e+03
  2.66478424e+03  3.02939101e+03  3.02939101e+03  3.02939101e+03
  6.64981614e+03  6.64981614e+03  6.64981614e+03  9.06946210e+03
  2.54245456e+04  7.61662912e+04]
E1 = -728.2934817758464  E_coul = 201.55400727137808
cycle= 5 E= -526.739474504468  delta_E= -2.03e-09  |g|= 2.14e-05  |ddm|= 0.00149
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.02855e-05
diis-c [-1.10220862e-10  1.30751379e-05 -1.60832198e-03 -1.25860283e-02
  2.12422821e-02  9.92938993e-01]
  HOMO = -0.582520566273596  LUMO = 0.918855816191363
  mo_energy =
[-1.18579213e+02 -1.23110614e+01 -9.56179108e+00 -9.56179108e+00
 -9.56179108e+00 -1.26948639e+00 -5.82520566e-01 -5.82520566e-01
 -5.82520566e-01  9.18855816e-01  1.02011085e+00  1.02011085e+00
  1.02011085e+00  4.73461347e+00  7.31183040e+00  7.31183040e+00
  7.31183040e+00  1.97652766e+01  3.34816764e+01  3.34816764e+01
  3.34816764e+01  1.16213112e+02  1.29030102e+02  1.29030102e+02
  1.29030102e+02  4.83347536e+02  4.83347536e+02  4.83347536e+02
  5.97613395e+02  1.33516828e+03  1.33516828e+03  1.33516828e+03
  2.66478420e+03  3.02939097e+03  3.02939097e+03  3.02939097e+03
  6.64981611e+03  6.64981611e+03  6.64981611e+03  9.06946207e+03
  2.54245456e+04  7.61662912e+04]
E1 = -728.2935716024679  E_coul = 201.55409709793832
cycle= 6 E= -526.73947450453  delta_E= -6.12e-11  |g|= 1.71e-06  |ddm|= 0.000171
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2935716024679  E_coul = 201.55409709793832
  HOMO = -0.582520295338733  LUMO = 0.918856273962534
  mo_energy =
[-1.18579212e+02 -1.23110603e+01 -9.56179002e+00 -9.56179002e+00
 -9.56179002e+00 -1.26948573e+00 -5.82520295e-01 -5.82520295e-01
 -5.82520295e-01  9.18856274e-01  1.02011109e+00  1.02011109e+00
  1.02011109e+00  4.73461410e+00  7.31183112e+00  7.31183112e+00
  7.31183112e+00  1.97652776e+01  3.34816775e+01  3.34816775e+01
  3.34816775e+01  1.16213114e+02  1.29030104e+02  1.29030104e+02
  1.29030104e+02  4.83347538e+02  4.83347538e+02  4.83347538e+02
  5.97613397e+02  1.33516828e+03  1.33516828e+03  1.33516828e+03
  2.66478420e+03  3.02939098e+03  3.02939098e+03  3.02939098e+03
  6.64981611e+03  6.64981611e+03  6.64981611e+03  9.06946207e+03
  2.54245456e+04  7.61662912e+04]
E1 = -728.293567179787  E_coul = 201.5540926752559
Extra cycle  E= -526.739474504531  delta_E= -1.59e-12  |g|= 3.77e-07  |ddm|= 2.19e-05
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111831.30652090022
E1 = -728.293567179787  E_coul = 201.5540926752559
init E= -526.739474504531
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.582520392444587  LUMO = 0.918856262001947
  mo_energy =
[-1.18579212e+02 -1.23110606e+01 -9.56179037e+00 -9.56179037e+00
 -9.56179037e+00 -1.26948578e+00 -5.82520392e-01 -5.82520392e-01
 -5.82520392e-01  9.18856262e-01  1.02011103e+00  1.02011103e+00
  1.02011103e+00  4.73461399e+00  7.31183090e+00  7.31183090e+00
  7.31183090e+00  1.97652773e+01  3.34816771e+01  3.34816771e+01
  3.34816771e+01  1.16213113e+02  1.29030103e+02  1.29030103e+02
  1.29030103e+02  4.83347537e+02  4.83347537e+02  4.83347537e+02
  5.97613396e+02  1.33516828e+03  1.33516828e+03  1.33516828e+03
  2.66478420e+03  3.02939098e+03  3.02939098e+03  3.02939098e+03
  6.64981611e+03  6.64981611e+03  6.64981611e+03  9.06946207e+03
  2.54245456e+04  7.61662912e+04]
E1 = -728.2935683290259  E_coul = 201.55409382449525
cycle= 1 E= -526.739474504531  delta_E= 4.55e-13  |g|= 9.72e-08  |ddm|= 4.29e-06
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2935683290259  E_coul = 201.55409382449525
  HOMO = -0.582520373231225  LUMO = 0.918856286283263
  mo_energy =
[-1.18579212e+02 -1.23110605e+01 -9.56179029e+00 -9.56179029e+00
 -9.56179029e+00 -1.26948574e+00 -5.82520373e-01 -5.82520373e-01
 -5.82520373e-01  9.18856286e-01  1.02011105e+00  1.02011105e+00
  1.02011105e+00  4.73461403e+00  7.31183095e+00  7.31183095e+00
  7.31183095e+00  1.97652774e+01  3.34816772e+01  3.34816772e+01
  3.34816772e+01  1.16213113e+02  1.29030103e+02  1.29030103e+02
  1.29030103e+02  4.83347537e+02  4.83347537e+02  4.83347537e+02
  5.97613396e+02  1.33516828e+03  1.33516828e+03  1.33516828e+03
  2.66478420e+03  3.02939098e+03  3.02939098e+03  3.02939098e+03
  6.64981611e+03  6.64981611e+03  6.64981611e+03  9.06946207e+03
  2.54245456e+04  7.61662912e+04]
E1 = -728.2935679851615  E_coul = 201.5540934806298
Extra cycle  E= -526.739474504532  delta_E= -1.02e-12  |g|= 2.33e-08  |ddm|= 9.37e-07
    CPU time for scf_cycle      1.11 sec, wall time      0.62 sec
exp = [2.61826564e+04 7.61752068e+03 3.61735145e+03 1.59779985e+03
 3.82866683e+02 1.08172819e+02 3.61899803e+01 8.47865039e+00
 3.63226180e+00 8.73307538e-01 1.01357769e+00 2.46902771e-01
 1.36278339e+03 6.64743815e+02 3.00953185e+02 3.14034681e+02
 6.16312942e+01 7.34848506e+00 2.02225568e+01 7.76127662e-01
 2.82312002e+00 2.24022741e-01]
grad_E = [-1.49793145e-06  3.09657622e-06 -1.68027545e-06  6.09740815e-05
  2.41980516e-04 -2.47374842e-03  1.33763285e-03 -1.25987364e-03
 -8.47118206e-04  1.78448528e-03  5.56587268e-04 -6.29279761e-03
 -5.13260502e-07  4.91772289e-06  2.30749958e-05  1.98966087e-05
  4.31234504e-05  9.66745740e-04 -4.36679287e-04 -9.68980666e-03
 -2.49029620e-04  3.42438757e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:55 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6564889        1
[INPUT] 0    0    [1    /1   ]  7617.52053462        1
[INPUT] 0    0    [1    /1   ]  3617.35152708        1
[INPUT] 0    0    [1    /1   ]  1597.7967564         1
[INPUT] 0    0    [1    /1   ]  382.865024146        1
[INPUT] 0    0    [1    /1   ]  108.208678845        1
[INPUT] 0    0    [1    /1   ]  36.2977817501        1
[INPUT] 0    0    [1    /1   ]  8.58092408444        1
[INPUT] 0    0    [1    /1   ]  3.7235860629         1
[INPUT] 0    0    [1    /1   ]  0.865132379866       1
[INPUT] 0    0    [1    /1   ]  1.07113089007        1
[INPUT] 0    0    [1    /1   ]  0.247966004801       1
[INPUT] 1    0    [1    /1   ]  1362.78341765        1
[INPUT] 1    0    [1    /1   ]  664.743585211        1
[INPUT] 1    0    [1    /1   ]  300.952102095        1
[INPUT] 1    0    [1    /1   ]  314.033747368        1
[INPUT] 1    0    [1    /1   ]  61.6315802211        1
[INPUT] 1    0    [1    /1   ]  7.34437605079        1
[INPUT] 1    0    [1    /1   ]  20.2258785828        1
[INPUT] 1    0    [1    /1   ]  0.775541758161       1
[INPUT] 1    0    [1    /1   ]  2.81785121274        1
[INPUT] 1    0    [1    /1   ]  0.224353187052       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656488868277, 1.0]], [0, [7617.520534617746, 1.0]], [0, [3617.351527083095, 1.0]], [0, [1597.7967564042497, 1.0]], [0, [382.8650241457491, 1.0]], [0, [108.20867884521877, 1.0]], [0, [36.29778175005507, 1.0]], [0, [8.580924084439484, 1.0]], [0, [3.7235860628972106, 1.0]], [0, [0.8651323798662041, 1.0]], [0, [1.071130890069049, 1.0]], [0, [0.24796600480085842, 1.0]], [1, [1362.7834176473755, 1.0]], [1, [664.7435852108592, 1.0]], [1, [300.9521020951681, 1.0]], [1, [314.0337473680394, 1.0]], [1, [61.63158022108822, 1.0]], [1, [7.344376050789422, 1.0]], [1, [20.22587858282622, 1.0]], [1, [0.7755417581611554, 1.0]], [1, [2.8178512127431192, 1.0]], [1, [0.22435318705164844, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65648887]
bas 1, expnt(s) = [7617.52053462]
bas 2, expnt(s) = [3617.35152708]
bas 3, expnt(s) = [1597.7967564]
bas 4, expnt(s) = [382.86502415]
bas 5, expnt(s) = [108.20867885]
bas 6, expnt(s) = [36.29778175]
bas 7, expnt(s) = [8.58092408]
bas 8, expnt(s) = [3.72358606]
bas 9, expnt(s) = [0.86513238]
bas 10, expnt(s) = [1.07113089]
bas 11, expnt(s) = [0.247966]
bas 12, expnt(s) = [1362.78341765]
bas 13, expnt(s) = [664.74358521]
bas 14, expnt(s) = [300.9521021]
bas 15, expnt(s) = [314.03374737]
bas 16, expnt(s) = [61.63158022]
bas 17, expnt(s) = [7.34437605]
bas 18, expnt(s) = [20.22587858]
bas 19, expnt(s) = [0.77554176]
bas 20, expnt(s) = [2.81785121]
bas 21, expnt(s) = [0.22435319]
CPU time:       122.94
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826565e+04 5.20026296e+03 7.61752053e+03 2.06003808e+03
 3.61735153e+03 1.17844159e+03 1.59779676e+03 6.38493052e+02
 3.82865024e+02 2.18675080e+02 1.08208679e+02 8.47640297e+01
 3.62977818e+01 3.73615674e+01 8.58092408e+00 1.26667608e+01
 3.72358606e+00 6.77229818e+00 8.65132380e-01 2.26634984e+00
 1.07113089e+00 2.66009369e+00 2.47966005e-01 8.87787719e-01
 1.36278342e+03 2.41556063e+04 6.64743585e+02 9.84695802e+03
 3.00952102e+02 3.65684135e+03 3.14033747e+02 3.85660176e+03
 6.16315802e+01 5.03777215e+02 7.34437605e+00 3.52718326e+01
 2.02258786e+01 1.25132072e+02 7.75541758e-01 2.12319986e+00
 2.81785121e+00 1.06507935e+01 2.24353187e-01 4.50453221e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99351374682847
cond(S) = 111970.68536364491
E1 = -729.515935538977  E_coul = 203.16974405949958
init E= -526.346191479478
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555808631659071  LUMO = 0.951938868672075
  mo_energy =
[-1.18328569e+02 -1.22067943e+01 -9.44765739e+00 -9.44765739e+00
 -9.44765739e+00 -1.24010548e+00 -5.55808632e-01 -5.55808632e-01
 -5.55808632e-01  9.51938869e-01  1.03918553e+00  1.03918553e+00
  1.03918553e+00  4.91782665e+00  7.37059013e+00  7.37059013e+00
  7.37059013e+00  2.04405171e+01  3.35737621e+01  3.35737621e+01
  3.35737621e+01  1.17614935e+02  1.29187230e+02  1.29187230e+02
  1.29187230e+02  4.83581621e+02  4.83581621e+02  4.83581621e+02
  5.99315078e+02  1.33545614e+03  1.33545614e+03  1.33545614e+03
  2.66654380e+03  3.02974235e+03  3.02974235e+03  3.02974235e+03
  6.65027918e+03  6.65027918e+03  6.65027918e+03  9.07124035e+03
  2.54263512e+04  7.61681068e+04]
E1 = -727.8610372523877  E_coul = 201.12223583691315
cycle= 1 E= -526.738801415475  delta_E= -0.393  |g|= 0.186  |ddm|=  1.2
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.543836
diis-c [-0.29575706  1.        ]
  HOMO = -0.589632683387581  LUMO = 0.930244606195478
  mo_energy =
[-1.18636035e+02 -1.23424403e+01 -9.59439975e+00 -9.59439975e+00
 -9.59439975e+00 -1.27819920e+00 -5.89632683e-01 -5.89632683e-01
 -5.89632683e-01  9.30244606e-01  1.01557012e+00  1.01557012e+00
  1.01557012e+00  4.86215007e+00  7.28162534e+00  7.28162534e+00
  7.28162534e+00  2.03262915e+01  3.34212896e+01  3.34212896e+01
  3.34212896e+01  1.17396345e+02  1.28959953e+02  1.28959953e+02
  1.28959953e+02  4.83275519e+02  4.83275519e+02  4.83275519e+02
  5.98971513e+02  1.33509347e+03  1.33509347e+03  1.33509347e+03
  2.66604572e+03  3.02931268e+03  3.02931268e+03  3.02931268e+03
  6.64973570e+03  6.64973570e+03  6.64973570e+03  9.07062130e+03
  2.54256379e+04  7.61673034e+04]
E1 = -728.4263821927005  E_coul = 201.6868706139888
cycle= 2 E= -526.739511578712  delta_E= -0.00071  |g|= 0.0375  |ddm|= 0.0817
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0756615
diis-c [-0.00331937  0.08315053  0.91684947]
  HOMO = -0.580796548985257  LUMO = 0.936650833953423
  mo_energy =
[-1.18568968e+02 -1.23049981e+01 -9.55529907e+00 -9.55529907e+00
 -9.55529907e+00 -1.26758531e+00 -5.80796549e-01 -5.80796549e-01
 -5.80796549e-01  9.36650834e-01  1.02211642e+00  1.02211642e+00
  1.02211642e+00  4.87733278e+00  7.30491545e+00  7.30491545e+00
  7.30491545e+00  2.03573906e+01  3.34607618e+01  3.34607618e+01
  3.34607618e+01  1.17451240e+02  1.29015223e+02  1.29015223e+02
  1.29015223e+02  4.83341776e+02  4.83341776e+02  4.83341776e+02
  5.99040014e+02  1.33516378e+03  1.33516378e+03  1.33516378e+03
  2.66611931e+03  3.02938522e+03  3.02938522e+03  3.02938522e+03
  6.64980998e+03  6.64980998e+03  6.64980998e+03  9.07069638e+03
  2.54257136e+04  7.61673794e+04]
E1 = -728.278253414565  E_coul = 201.53868412463103
cycle= 3 E= -526.739569289934  delta_E= -5.77e-05  |g|= 0.00619  |ddm|= 0.0269
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0130615
diis-c [-7.57178784e-07 -1.28629461e-03  1.42518859e-01  8.58767436e-01]
  HOMO = -0.582267272861677  LUMO = 0.935671651816164
  mo_energy =
[-1.18578783e+02 -1.23107117e+01 -9.56136092e+00 -9.56136092e+00
 -9.56136092e+00 -1.26923795e+00 -5.82267273e-01 -5.82267273e-01
 -5.82267273e-01  9.35671652e-01  1.02105373e+00  1.02105373e+00
  1.02105373e+00  4.87492806e+00  7.30119698e+00  7.30119698e+00
  7.30119698e+00  2.03525921e+01  3.34546847e+01  3.34546847e+01
  3.34546847e+01  1.17443115e+02  1.29006998e+02  1.29006998e+02
  1.29006998e+02  4.83332076e+02  4.83332076e+02  4.83332076e+02
  5.99029979e+02  1.33515349e+03  1.33515349e+03  1.33515349e+03
  2.66610840e+03  3.02937456e+03  3.02937456e+03  3.02937456e+03
  6.64979892e+03  6.64979892e+03  6.64979892e+03  9.07068511e+03
  2.54257021e+04  7.61673678e+04]
E1 = -728.3006284181907  E_coul = 201.56105726872943
cycle= 4 E= -526.739571149461  delta_E= -1.86e-06  |g|= 0.000106  |ddm|= 0.00258
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119101
diis-c [-6.64658684e-09  8.66522142e-05 -1.20893906e-02 -7.64559394e-02
  1.08845868e+00]
  HOMO = -0.582246517833503  LUMO = 0.93570377599331
  mo_energy =
[-1.18578724e+02 -1.23106342e+01 -9.56129696e+00 -9.56129696e+00
 -9.56129696e+00 -1.26919212e+00 -5.82246518e-01 -5.82246518e-01
 -5.82246518e-01  9.35703776e-01  1.02107162e+00  1.02107162e+00
  1.02107162e+00  4.87497563e+00  7.30124651e+00  7.30124651e+00
  7.30124651e+00  2.03526588e+01  3.34547464e+01  3.34547464e+01
  3.34547464e+01  1.17443182e+02  1.29007062e+02  1.29007062e+02
  1.29007062e+02  4.83332135e+02  4.83332135e+02  4.83332135e+02
  5.99030030e+02  1.33515354e+03  1.33515354e+03  1.33515354e+03
  2.66610843e+03  3.02937460e+03  3.02937460e+03  3.02937460e+03
  6.64979895e+03  6.64979895e+03  6.64979895e+03  9.07068513e+03
  2.54257021e+04  7.61673678e+04]
E1 = -728.3003648873974  E_coul = 201.5607937358991
cycle= 5 E= -526.739571151498  delta_E= -2.04e-09  |g|= 2.13e-05  |ddm|= 0.000833
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.02041e-05
diis-c [-1.08753232e-10  1.31339942e-05 -1.62062925e-03 -1.26482989e-02
  2.16369492e-02  9.92618845e-01]
  HOMO = -0.582254725836459  LUMO = 0.935700268230266
  mo_energy =
[-1.18578758e+02 -1.23106591e+01 -9.56132378e+00 -9.56132378e+00
 -9.56132378e+00 -1.26919888e+00 -5.82254726e-01 -5.82254726e-01
 -5.82254726e-01  9.35700268e-01  1.02106614e+00  1.02106614e+00
  1.02106614e+00  4.87496421e+00  7.30122821e+00  7.30122821e+00
  7.30122821e+00  2.03526373e+01  3.34547204e+01  3.34547204e+01
  3.34547204e+01  1.17443152e+02  1.29007032e+02  1.29007032e+02
  1.29007032e+02  4.83332102e+02  4.83332102e+02  4.83332102e+02
  5.99029997e+02  1.33515351e+03  1.33515351e+03  1.33515351e+03
  2.66610839e+03  3.02937456e+03  3.02937456e+03  3.02937456e+03
  6.64979891e+03  6.64979891e+03  6.64979891e+03  9.07068509e+03
  2.54257021e+04  7.61673677e+04]
E1 = -728.3004544536686  E_coul = 201.5608833021071
cycle= 6 E= -526.739571151562  delta_E= -6.32e-11  |g|= 1.7e-06  |ddm|= 9.36e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3004544536686  E_coul = 201.5608833021071
  HOMO = -0.582254459131126  LUMO = 0.935700727470469
  mo_energy =
[-1.18578756e+02 -1.23106580e+01 -9.56132274e+00 -9.56132274e+00
 -9.56132274e+00 -1.26919823e+00 -5.82254459e-01 -5.82254459e-01
 -5.82254459e-01  9.35700727e-01  1.02106638e+00  1.02106638e+00
  1.02106638e+00  4.87496485e+00  7.30122891e+00  7.30122891e+00
  7.30122891e+00  2.03526382e+01  3.34547214e+01  3.34547214e+01
  3.34547214e+01  1.17443153e+02  1.29007033e+02  1.29007033e+02
  1.29007033e+02  4.83332103e+02  4.83332103e+02  4.83332103e+02
  5.99029998e+02  1.33515351e+03  1.33515351e+03  1.33515351e+03
  2.66610839e+03  3.02937456e+03  3.02937456e+03  3.02937456e+03
  6.64979891e+03  6.64979891e+03  6.64979891e+03  9.07068510e+03
  2.54257021e+04  7.61673677e+04]
E1 = -728.3004501139723  E_coul = 201.56087896241056
Extra cycle  E= -526.739571151562  delta_E= -1.14e-13  |g|= 3.72e-07  |ddm|= 1.23e-05
    CPU time for scf_cycle      0.28 sec, wall time      0.26 sec
exp = [2.61826565e+04 7.61752053e+03 3.61735153e+03 1.59779676e+03
 3.82865024e+02 1.08208679e+02 3.62977818e+01 8.58092408e+00
 3.72358606e+00 8.65132380e-01 1.07113089e+00 2.47966005e-01
 1.36278342e+03 6.64743585e+02 3.00952102e+02 3.14033747e+02
 6.16315802e+01 7.34437605e+00 2.02258786e+01 7.75541758e-01
 2.81785121e+00 2.24353187e-01]
E = -526.7395711515617
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:22:55 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6564889        1
[INPUT] 0    0    [1    /1   ]  7617.52053462        1
[INPUT] 0    0    [1    /1   ]  3617.35152708        1
[INPUT] 0    0    [1    /1   ]  1597.7967564         1
[INPUT] 0    0    [1    /1   ]  382.865024146        1
[INPUT] 0    0    [1    /1   ]  108.208678845        1
[INPUT] 0    0    [1    /1   ]  36.2977817501        1
[INPUT] 0    0    [1    /1   ]  8.58092408444        1
[INPUT] 0    0    [1    /1   ]  3.7235860629         1
[INPUT] 0    0    [1    /1   ]  0.865132379866       1
[INPUT] 0    0    [1    /1   ]  1.07113089007        1
[INPUT] 0    0    [1    /1   ]  0.247966004801       1
[INPUT] 1    0    [1    /1   ]  1362.78341765        1
[INPUT] 1    0    [1    /1   ]  664.743585211        1
[INPUT] 1    0    [1    /1   ]  300.952102095        1
[INPUT] 1    0    [1    /1   ]  314.033747368        1
[INPUT] 1    0    [1    /1   ]  61.6315802211        1
[INPUT] 1    0    [1    /1   ]  7.34437605079        1
[INPUT] 1    0    [1    /1   ]  20.2258785828        1
[INPUT] 1    0    [1    /1   ]  0.775541758161       1
[INPUT] 1    0    [1    /1   ]  2.81785121274        1
[INPUT] 1    0    [1    /1   ]  0.224353187052       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656488868277, 1.0]], [0, [7617.520534617746, 1.0]], [0, [3617.351527083095, 1.0]], [0, [1597.7967564042497, 1.0]], [0, [382.8650241457491, 1.0]], [0, [108.20867884521877, 1.0]], [0, [36.29778175005507, 1.0]], [0, [8.580924084439484, 1.0]], [0, [3.7235860628972106, 1.0]], [0, [0.8651323798662041, 1.0]], [0, [1.071130890069049, 1.0]], [0, [0.24796600480085842, 1.0]], [1, [1362.7834176473755, 1.0]], [1, [664.7435852108592, 1.0]], [1, [300.9521020951681, 1.0]], [1, [314.0337473680394, 1.0]], [1, [61.63158022108822, 1.0]], [1, [7.344376050789422, 1.0]], [1, [20.22587858282622, 1.0]], [1, [0.7755417581611554, 1.0]], [1, [2.8178512127431192, 1.0]], [1, [0.22435318705164844, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65648887]
bas 1, expnt(s) = [7617.52053462]
bas 2, expnt(s) = [3617.35152708]
bas 3, expnt(s) = [1597.7967564]
bas 4, expnt(s) = [382.86502415]
bas 5, expnt(s) = [108.20867885]
bas 6, expnt(s) = [36.29778175]
bas 7, expnt(s) = [8.58092408]
bas 8, expnt(s) = [3.72358606]
bas 9, expnt(s) = [0.86513238]
bas 10, expnt(s) = [1.07113089]
bas 11, expnt(s) = [0.247966]
bas 12, expnt(s) = [1362.78341765]
bas 13, expnt(s) = [664.74358521]
bas 14, expnt(s) = [300.9521021]
bas 15, expnt(s) = [314.03374737]
bas 16, expnt(s) = [61.63158022]
bas 17, expnt(s) = [7.34437605]
bas 18, expnt(s) = [20.22587858]
bas 19, expnt(s) = [0.77554176]
bas 20, expnt(s) = [2.81785121]
bas 21, expnt(s) = [0.22435319]
CPU time:       123.30
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826565e+04 5.20026296e+03 7.61752053e+03 2.06003808e+03
 3.61735153e+03 1.17844159e+03 1.59779676e+03 6.38493052e+02
 3.82865024e+02 2.18675080e+02 1.08208679e+02 8.47640297e+01
 3.62977818e+01 3.73615674e+01 8.58092408e+00 1.26667608e+01
 3.72358606e+00 6.77229818e+00 8.65132380e-01 2.26634984e+00
 1.07113089e+00 2.66009369e+00 2.47966005e-01 8.87787719e-01
 1.36278342e+03 2.41556063e+04 6.64743585e+02 9.84695802e+03
 3.00952102e+02 3.65684135e+03 3.14033747e+02 3.85660176e+03
 6.16315802e+01 5.03777215e+02 7.34437605e+00 3.52718326e+01
 2.02258786e+01 1.25132072e+02 7.75541758e-01 2.12319986e+00
 2.81785121e+00 1.06507935e+01 2.24353187e-01 4.50453221e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99351374682847
cond(S) = 111970.68536364491
E1 = -729.515935538977  E_coul = 203.16974405949958
init E= -526.346191479478
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555808631659071  LUMO = 0.951938868672075
  mo_energy =
[-1.18328569e+02 -1.22067943e+01 -9.44765739e+00 -9.44765739e+00
 -9.44765739e+00 -1.24010548e+00 -5.55808632e-01 -5.55808632e-01
 -5.55808632e-01  9.51938869e-01  1.03918553e+00  1.03918553e+00
  1.03918553e+00  4.91782665e+00  7.37059013e+00  7.37059013e+00
  7.37059013e+00  2.04405171e+01  3.35737621e+01  3.35737621e+01
  3.35737621e+01  1.17614935e+02  1.29187230e+02  1.29187230e+02
  1.29187230e+02  4.83581621e+02  4.83581621e+02  4.83581621e+02
  5.99315078e+02  1.33545614e+03  1.33545614e+03  1.33545614e+03
  2.66654380e+03  3.02974235e+03  3.02974235e+03  3.02974235e+03
  6.65027918e+03  6.65027918e+03  6.65027918e+03  9.07124035e+03
  2.54263512e+04  7.61681068e+04]
E1 = -727.8610372523877  E_coul = 201.12223583691315
cycle= 1 E= -526.738801415475  delta_E= -0.393  |g|= 0.186  |ddm|=  1.2
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.543836
diis-c [-0.29575706  1.        ]
  HOMO = -0.589632683387581  LUMO = 0.930244606195478
  mo_energy =
[-1.18636035e+02 -1.23424403e+01 -9.59439975e+00 -9.59439975e+00
 -9.59439975e+00 -1.27819920e+00 -5.89632683e-01 -5.89632683e-01
 -5.89632683e-01  9.30244606e-01  1.01557012e+00  1.01557012e+00
  1.01557012e+00  4.86215007e+00  7.28162534e+00  7.28162534e+00
  7.28162534e+00  2.03262915e+01  3.34212896e+01  3.34212896e+01
  3.34212896e+01  1.17396345e+02  1.28959953e+02  1.28959953e+02
  1.28959953e+02  4.83275519e+02  4.83275519e+02  4.83275519e+02
  5.98971513e+02  1.33509347e+03  1.33509347e+03  1.33509347e+03
  2.66604572e+03  3.02931268e+03  3.02931268e+03  3.02931268e+03
  6.64973570e+03  6.64973570e+03  6.64973570e+03  9.07062130e+03
  2.54256379e+04  7.61673034e+04]
E1 = -728.4263821927005  E_coul = 201.6868706139888
cycle= 2 E= -526.739511578712  delta_E= -0.00071  |g|= 0.0375  |ddm|= 0.0817
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0756615
diis-c [-0.00331937  0.08315053  0.91684947]
  HOMO = -0.580796548985257  LUMO = 0.936650833953423
  mo_energy =
[-1.18568968e+02 -1.23049981e+01 -9.55529907e+00 -9.55529907e+00
 -9.55529907e+00 -1.26758531e+00 -5.80796549e-01 -5.80796549e-01
 -5.80796549e-01  9.36650834e-01  1.02211642e+00  1.02211642e+00
  1.02211642e+00  4.87733278e+00  7.30491545e+00  7.30491545e+00
  7.30491545e+00  2.03573906e+01  3.34607618e+01  3.34607618e+01
  3.34607618e+01  1.17451240e+02  1.29015223e+02  1.29015223e+02
  1.29015223e+02  4.83341776e+02  4.83341776e+02  4.83341776e+02
  5.99040014e+02  1.33516378e+03  1.33516378e+03  1.33516378e+03
  2.66611931e+03  3.02938522e+03  3.02938522e+03  3.02938522e+03
  6.64980998e+03  6.64980998e+03  6.64980998e+03  9.07069638e+03
  2.54257136e+04  7.61673794e+04]
E1 = -728.278253414565  E_coul = 201.53868412463103
cycle= 3 E= -526.739569289934  delta_E= -5.77e-05  |g|= 0.00619  |ddm|= 0.0269
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0130615
diis-c [-7.57178784e-07 -1.28629461e-03  1.42518859e-01  8.58767436e-01]
  HOMO = -0.582267272861677  LUMO = 0.935671651816164
  mo_energy =
[-1.18578783e+02 -1.23107117e+01 -9.56136092e+00 -9.56136092e+00
 -9.56136092e+00 -1.26923795e+00 -5.82267273e-01 -5.82267273e-01
 -5.82267273e-01  9.35671652e-01  1.02105373e+00  1.02105373e+00
  1.02105373e+00  4.87492806e+00  7.30119698e+00  7.30119698e+00
  7.30119698e+00  2.03525921e+01  3.34546847e+01  3.34546847e+01
  3.34546847e+01  1.17443115e+02  1.29006998e+02  1.29006998e+02
  1.29006998e+02  4.83332076e+02  4.83332076e+02  4.83332076e+02
  5.99029979e+02  1.33515349e+03  1.33515349e+03  1.33515349e+03
  2.66610840e+03  3.02937456e+03  3.02937456e+03  3.02937456e+03
  6.64979892e+03  6.64979892e+03  6.64979892e+03  9.07068511e+03
  2.54257021e+04  7.61673678e+04]
E1 = -728.3006284181907  E_coul = 201.56105726872943
cycle= 4 E= -526.739571149461  delta_E= -1.86e-06  |g|= 0.000106  |ddm|= 0.00258
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119101
diis-c [-6.64658684e-09  8.66522142e-05 -1.20893906e-02 -7.64559394e-02
  1.08845868e+00]
  HOMO = -0.582246517833503  LUMO = 0.93570377599331
  mo_energy =
[-1.18578724e+02 -1.23106342e+01 -9.56129696e+00 -9.56129696e+00
 -9.56129696e+00 -1.26919212e+00 -5.82246518e-01 -5.82246518e-01
 -5.82246518e-01  9.35703776e-01  1.02107162e+00  1.02107162e+00
  1.02107162e+00  4.87497563e+00  7.30124651e+00  7.30124651e+00
  7.30124651e+00  2.03526588e+01  3.34547464e+01  3.34547464e+01
  3.34547464e+01  1.17443182e+02  1.29007062e+02  1.29007062e+02
  1.29007062e+02  4.83332135e+02  4.83332135e+02  4.83332135e+02
  5.99030030e+02  1.33515354e+03  1.33515354e+03  1.33515354e+03
  2.66610843e+03  3.02937460e+03  3.02937460e+03  3.02937460e+03
  6.64979895e+03  6.64979895e+03  6.64979895e+03  9.07068513e+03
  2.54257021e+04  7.61673678e+04]
E1 = -728.3003648873974  E_coul = 201.5607937358991
cycle= 5 E= -526.739571151498  delta_E= -2.04e-09  |g|= 2.13e-05  |ddm|= 0.000833
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.02041e-05
diis-c [-1.08753232e-10  1.31339942e-05 -1.62062925e-03 -1.26482989e-02
  2.16369492e-02  9.92618845e-01]
  HOMO = -0.582254725836459  LUMO = 0.935700268230266
  mo_energy =
[-1.18578758e+02 -1.23106591e+01 -9.56132378e+00 -9.56132378e+00
 -9.56132378e+00 -1.26919888e+00 -5.82254726e-01 -5.82254726e-01
 -5.82254726e-01  9.35700268e-01  1.02106614e+00  1.02106614e+00
  1.02106614e+00  4.87496421e+00  7.30122821e+00  7.30122821e+00
  7.30122821e+00  2.03526373e+01  3.34547204e+01  3.34547204e+01
  3.34547204e+01  1.17443152e+02  1.29007032e+02  1.29007032e+02
  1.29007032e+02  4.83332102e+02  4.83332102e+02  4.83332102e+02
  5.99029997e+02  1.33515351e+03  1.33515351e+03  1.33515351e+03
  2.66610839e+03  3.02937456e+03  3.02937456e+03  3.02937456e+03
  6.64979891e+03  6.64979891e+03  6.64979891e+03  9.07068509e+03
  2.54257021e+04  7.61673677e+04]
E1 = -728.3004544536686  E_coul = 201.5608833021071
cycle= 6 E= -526.739571151562  delta_E= -6.32e-11  |g|= 1.7e-06  |ddm|= 9.36e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3004544536686  E_coul = 201.5608833021071
  HOMO = -0.582254459131126  LUMO = 0.935700727470469
  mo_energy =
[-1.18578756e+02 -1.23106580e+01 -9.56132274e+00 -9.56132274e+00
 -9.56132274e+00 -1.26919823e+00 -5.82254459e-01 -5.82254459e-01
 -5.82254459e-01  9.35700727e-01  1.02106638e+00  1.02106638e+00
  1.02106638e+00  4.87496485e+00  7.30122891e+00  7.30122891e+00
  7.30122891e+00  2.03526382e+01  3.34547214e+01  3.34547214e+01
  3.34547214e+01  1.17443153e+02  1.29007033e+02  1.29007033e+02
  1.29007033e+02  4.83332103e+02  4.83332103e+02  4.83332103e+02
  5.99029998e+02  1.33515351e+03  1.33515351e+03  1.33515351e+03
  2.66610839e+03  3.02937456e+03  3.02937456e+03  3.02937456e+03
  6.64979891e+03  6.64979891e+03  6.64979891e+03  9.07068510e+03
  2.54257021e+04  7.61673677e+04]
E1 = -728.3004501139723  E_coul = 201.56087896241056
Extra cycle  E= -526.739571151562  delta_E= -1.14e-13  |g|= 3.72e-07  |ddm|= 1.23e-05
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111970.68536364491
E1 = -728.3004501139723  E_coul = 201.56087896241056
init E= -526.739571151562
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.582254554253181  LUMO = 0.935700715665282
  mo_energy =
[-1.18578757e+02 -1.23106583e+01 -9.56132308e+00 -9.56132308e+00
 -9.56132308e+00 -1.26919828e+00 -5.82254554e-01 -5.82254554e-01
 -5.82254554e-01  9.35700716e-01  1.02106632e+00  1.02106632e+00
  1.02106632e+00  4.87496473e+00  7.30122870e+00  7.30122870e+00
  7.30122870e+00  2.03526380e+01  3.34547211e+01  3.34547211e+01
  3.34547211e+01  1.17443153e+02  1.29007033e+02  1.29007033e+02
  1.29007033e+02  4.83332103e+02  4.83332103e+02  4.83332103e+02
  5.99029998e+02  1.33515351e+03  1.33515351e+03  1.33515351e+03
  2.66610839e+03  3.02937456e+03  3.02937456e+03  3.02937456e+03
  6.64979891e+03  6.64979891e+03  6.64979891e+03  9.07068510e+03
  2.54257021e+04  7.61673677e+04]
E1 = -728.3004512426864  E_coul = 201.5608800911253
cycle= 1 E= -526.739571151561  delta_E= 5.68e-13  |g|= 9.58e-08  |ddm|= 2.36e-06
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.3004512426864  E_coul = 201.5608800911253
  HOMO = -0.582254535369464  LUMO = 0.935700739993991
  mo_energy =
[-1.18578756e+02 -1.23106582e+01 -9.56132300e+00 -9.56132300e+00
 -9.56132300e+00 -1.26919824e+00 -5.82254535e-01 -5.82254535e-01
 -5.82254535e-01  9.35700740e-01  1.02106634e+00  1.02106634e+00
  1.02106634e+00  4.87496477e+00  7.30122875e+00  7.30122875e+00
  7.30122875e+00  2.03526381e+01  3.34547212e+01  3.34547212e+01
  3.34547212e+01  1.17443153e+02  1.29007033e+02  1.29007033e+02
  1.29007033e+02  4.83332103e+02  4.83332103e+02  4.83332103e+02
  5.99029998e+02  1.33515351e+03  1.33515351e+03  1.33515351e+03
  2.66610839e+03  3.02937456e+03  3.02937456e+03  3.02937456e+03
  6.64979891e+03  6.64979891e+03  6.64979891e+03  9.07068510e+03
  2.54257021e+04  7.61673677e+04]
E1 = -728.3004509058259  E_coul = 201.56087975426527
Extra cycle  E= -526.739571151561  delta_E= 5.68e-13  |g|= 2.29e-08  |ddm|= 5.25e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826565e+04 7.61752053e+03 3.61735153e+03 1.59779676e+03
 3.82865024e+02 1.08208679e+02 3.62977818e+01 8.58092408e+00
 3.72358606e+00 8.65132380e-01 1.07113089e+00 2.47966005e-01
 1.36278342e+03 6.64743585e+02 3.00952102e+02 3.14033747e+02
 6.16315802e+01 7.34437605e+00 2.02258786e+01 7.75541758e-01
 2.81785121e+00 2.24353187e-01]
grad_E = [-1.49721645e-06  3.08903617e-06 -1.68319537e-06  6.06698108e-05
  2.52971613e-04 -2.56404677e-03  1.49031427e-03 -1.52723314e-03
  2.45739975e-04  1.73232914e-03 -2.35053046e-05 -6.01648625e-03
 -5.12311678e-07  4.93072565e-06  2.31532766e-05  1.99638459e-05
  3.53326442e-05  1.12562298e-03 -4.06545906e-04 -1.30683195e-02
 -6.89115915e-04  4.61986261e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:00 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6565787        1
[INPUT] 0    0    [1    /1   ]  7617.52034191        1
[INPUT] 0    0    [1    /1   ]  3617.35162279        1
[INPUT] 0    0    [1    /1   ]  1597.79278926        1
[INPUT] 0    0    [1    /1   ]  382.8620263          1
[INPUT] 0    0    [1    /1   ]  108.262024131        1
[INPUT] 0    0    [1    /1   ]  36.4215647505        1
[INPUT] 0    0    [1    /1   ]  8.7081399062         1
[INPUT] 0    0    [1    /1   ]  3.83783553409        1
[INPUT] 0    0    [1    /1   ]  0.850436851302       1
[INPUT] 0    0    [1    /1   ]  1.13963572296        1
[INPUT] 0    0    [1    /1   ]  0.248765016444       1
[INPUT] 1    0    [1    /1   ]  1362.78344786        1
[INPUT] 1    0    [1    /1   ]  664.74328879         1
[INPUT] 1    0    [1    /1   ]  300.950705684        1
[INPUT] 1    0    [1    /1   ]  314.03254337         1
[INPUT] 1    0    [1    /1   ]  61.631774823         1
[INPUT] 1    0    [1    /1   ]  7.33706750334        1
[INPUT] 1    0    [1    /1   ]  20.2313565779        1
[INPUT] 1    0    [1    /1   ]  0.775010377129       1
[INPUT] 1    0    [1    /1   ]  2.81096746587        1
[INPUT] 1    0    [1    /1   ]  0.224106166411       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65657868495, 1.0]], [0, [7617.520341907364, 1.0]], [0, [3617.3516227913724, 1.0]], [0, [1597.7927892632772, 1.0]], [0, [382.86202630000605, 1.0]], [0, [108.26202413101447, 1.0]], [0, [36.42156475053208, 1.0]], [0, [8.708139906197468, 1.0]], [0, [3.8378355340921275, 1.0]], [0, [0.850436851302046, 1.0]], [0, [1.139635722955464, 1.0]], [0, [0.2487650164441757, 1.0]], [1, [1362.7834478565242, 1.0]], [1, [664.7432887901424, 1.0]], [1, [300.9507056839425, 1.0]], [1, [314.03254337049367, 1.0]], [1, [61.63177482297615, 1.0]], [1, [7.337067503340335, 1.0]], [1, [20.231356577863973, 1.0]], [1, [0.7750103771294821, 1.0]], [1, [2.810967465874543, 1.0]], [1, [0.22410616641090786, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65657868]
bas 1, expnt(s) = [7617.52034191]
bas 2, expnt(s) = [3617.35162279]
bas 3, expnt(s) = [1597.79278926]
bas 4, expnt(s) = [382.8620263]
bas 5, expnt(s) = [108.26202413]
bas 6, expnt(s) = [36.42156475]
bas 7, expnt(s) = [8.70813991]
bas 8, expnt(s) = [3.83783553]
bas 9, expnt(s) = [0.85043685]
bas 10, expnt(s) = [1.13963572]
bas 11, expnt(s) = [0.24876502]
bas 12, expnt(s) = [1362.78344786]
bas 13, expnt(s) = [664.74328879]
bas 14, expnt(s) = [300.95070568]
bas 15, expnt(s) = [314.03254337]
bas 16, expnt(s) = [61.63177482]
bas 17, expnt(s) = [7.3370675]
bas 18, expnt(s) = [20.23135658]
bas 19, expnt(s) = [0.77501038]
bas 20, expnt(s) = [2.81096747]
bas 21, expnt(s) = [0.22410617]
CPU time:       129.04
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826566e+04 5.20026298e+03 7.61752034e+03 2.06003805e+03
 3.61735162e+03 1.17844161e+03 1.59779279e+03 6.38491863e+02
 3.82862026e+02 2.18673796e+02 1.08262024e+02 8.47953684e+01
 3.64215648e+01 3.74570848e+01 8.70813991e+00 1.28073439e+01
 3.83783553e+00 6.92755199e+00 8.50436851e-01 2.23741517e+00
 1.13963572e+00 2.78669581e+00 2.48765016e-01 8.89932370e-01
 1.36278345e+03 2.41556070e+04 6.64743289e+02 9.84695253e+03
 3.00950706e+02 3.65682014e+03 3.14032543e+02 3.85658327e+03
 6.16317748e+01 5.03779204e+02 7.33706750e+00 3.52279634e+01
 2.02313566e+01 1.25174437e+02 7.75010377e-01 2.12138156e+00
 2.81096747e+00 1.06182798e+01 2.24106166e-01 4.49833351e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99353954378749
cond(S) = 112083.45013856838
E1 = -729.51544169003  E_coul = 203.16939316876395
init E= -526.346048521266
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555824111758697  LUMO = 0.966219419870389
  mo_energy =
[-1.18328700e+02 -1.22067883e+01 -9.44767285e+00 -9.44767285e+00
 -9.44767285e+00 -1.24012555e+00 -5.55824112e-01 -5.55824112e-01
 -5.55824112e-01  9.66219420e-01  1.03771853e+00  1.03771853e+00
  1.03771853e+00  5.06852041e+00  7.35378633e+00  7.35378633e+00
  7.35378633e+00  2.11366403e+01  3.35329116e+01  3.35329116e+01
  3.35329116e+01  1.19094232e+02  1.29151832e+02  1.29151832e+02
  1.29151832e+02  4.83557535e+02  4.83557535e+02  4.83557535e+02
  6.01035126e+02  1.33543341e+03  1.33543341e+03  1.33543341e+03
  2.66816121e+03  3.02971775e+03  3.02971775e+03  3.02971775e+03
  6.65025383e+03  6.65025383e+03  6.65025383e+03  9.07273539e+03
  2.54277648e+04  7.61694228e+04]
E1 = -727.8609794871275  E_coul = 201.1220549879196
cycle= 1 E= -526.738924499208  delta_E= -0.393  |g|= 0.186  |ddm|= 0.723
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.543841
diis-c [-0.29576303  1.        ]
  HOMO = -0.589690203640371  LUMO = 0.944017438474922
  mo_energy =
[-1.18636009e+02 -1.23424480e+01 -9.59436368e+00 -9.59436368e+00
 -9.59436368e+00 -1.27830415e+00 -5.89690204e-01 -5.89690204e-01
 -5.89690204e-01  9.44017438e-01  1.01410585e+00  1.01410585e+00
  1.01410585e+00  5.01139811e+00  7.26486536e+00  7.26486536e+00
  7.26486536e+00  2.10210291e+01  3.33805081e+01  3.33805081e+01
  3.33805081e+01  1.18875562e+02  1.28924642e+02  1.28924642e+02
  1.28924642e+02  4.83251594e+02  4.83251594e+02  4.83251594e+02
  6.00691740e+02  1.33507091e+03  1.33507091e+03  1.33507091e+03
  2.66766330e+03  3.02928823e+03  3.02928823e+03  3.02928823e+03
  6.64971049e+03  6.64971049e+03  6.64971049e+03  9.07211648e+03
  2.54270517e+04  7.61686195e+04]
E1 = -728.4266949416898  E_coul = 201.6870609345869
cycle= 2 E= -526.739634007103  delta_E= -0.00071  |g|= 0.0375  |ddm|= 0.06
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0756823
diis-c [-0.00332888  0.08305016  0.91694984]
  HOMO = -0.580838993818507  LUMO = 0.950550729689826
  mo_energy =
[-1.18568928e+02 -1.23049776e+01 -9.55523101e+00 -9.55523101e+00
 -9.55523101e+00 -1.26767638e+00 -5.80838994e-01 -5.80838994e-01
 -5.80838994e-01  9.50550730e-01  1.02065372e+00  1.02065372e+00
  1.02065372e+00  5.02696442e+00  7.28815469e+00  7.28815469e+00
  7.28815469e+00  2.10525084e+01  3.34200072e+01  3.34200072e+01
  3.34200072e+01  1.18930508e+02  1.28979936e+02  1.28979936e+02
  1.28979936e+02  4.83317868e+02  4.83317868e+02  4.83317868e+02
  6.00760249e+02  1.33514122e+03  1.33514122e+03  1.33514122e+03
  2.66773690e+03  3.02936078e+03  3.02936078e+03  3.02936078e+03
  6.64978478e+03  6.64978478e+03  6.64978478e+03  9.07219158e+03
  2.54271274e+04  7.61686954e+04]
E1 = -728.278418773578  E_coul = 201.5387270028975
cycle= 3 E= -526.73969177068  delta_E= -5.78e-05  |g|= 0.0062  |ddm|= 0.021
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0130799
diis-c [-7.46060619e-07 -1.28383824e-03  1.42686216e-01  8.58597623e-01]
  HOMO = -0.582311460542133  LUMO = 0.949550356143122
  mo_energy =
[-1.18578758e+02 -1.23107013e+01 -9.56130243e+00 -9.56130243e+00
 -9.56130243e+00 -1.26933307e+00 -5.82311461e-01 -5.82311461e-01
 -5.82311461e-01  9.49550356e-01  1.01959092e+00  1.01959092e+00
  1.01959092e+00  5.02449843e+00  7.28443453e+00  7.28443453e+00
  7.28443453e+00  2.10476488e+01  3.34139208e+01  3.34139208e+01
  3.34139208e+01  1.18922364e+02  1.28971697e+02  1.28971697e+02
  1.28971697e+02  4.83308152e+02  4.83308152e+02  4.83308152e+02
  6.00750199e+02  1.33513092e+03  1.33513092e+03  1.33513092e+03
  2.66772598e+03  3.02935010e+03  3.02935010e+03  3.02935010e+03
  6.64977371e+03  6.64977371e+03  6.64977371e+03  9.07218030e+03
  2.54271159e+04  7.61686838e+04]
E1 = -728.3008493552597  E_coul = 201.56115571834061
cycle= 4 E= -526.739693636919  delta_E= -1.87e-06  |g|= 0.000104  |ddm|= 0.00228
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116547
diis-c [-6.48417139e-09  8.52013132e-05 -1.19281353e-02 -7.51957202e-02
  1.08703865e+00]
  HOMO = -0.582290430062254  LUMO = 0.949582739626
  mo_energy =
[-1.18578699e+02 -1.23106235e+01 -9.56123798e+00 -9.56123798e+00
 -9.56123798e+00 -1.26928748e+00 -5.82290430e-01 -5.82290430e-01
 -5.82290430e-01  9.49582740e-01  1.01960892e+00  1.01960892e+00
  1.01960892e+00  5.02454684e+00  7.28448436e+00  7.28448436e+00
  7.28448436e+00  2.10477161e+01  3.34139830e+01  3.34139830e+01
  3.34139830e+01  1.18922432e+02  1.28971762e+02  1.28971762e+02
  1.28971762e+02  4.83308211e+02  4.83308211e+02  4.83308211e+02
  6.00750251e+02  1.33513098e+03  1.33513098e+03  1.33513098e+03
  2.66772601e+03  3.02935014e+03  3.02935014e+03  3.02935014e+03
  6.64977374e+03  6.64977374e+03  6.64977374e+03  9.07218032e+03
  2.54271159e+04  7.61686838e+04]
E1 = -728.3005859380812  E_coul = 201.56089229921741
cycle= 5 E= -526.739693638864  delta_E= -1.94e-09  |g|= 2.11e-05  |ddm|= 0.000511
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.98192e-05
diis-c [-1.05002607e-10  1.30530682e-05 -1.61853700e-03 -1.25904853e-02
  2.25885765e-02  9.91607393e-01]
  HOMO = -0.582298522935132  LUMO = 0.949579190241506
  mo_energy =
[-1.18578732e+02 -1.23106482e+01 -9.56126448e+00 -9.56126448e+00
 -9.56126448e+00 -1.26929416e+00 -5.82298523e-01 -5.82298523e-01
 -5.82298523e-01  9.49579190e-01  1.01960352e+00  1.01960352e+00
  1.01960352e+00  5.02453529e+00  7.28446630e+00  7.28446630e+00
  7.28446630e+00  2.10476946e+01  3.34139573e+01  3.34139573e+01
  3.34139573e+01  1.18922402e+02  1.28971731e+02  1.28971731e+02
  1.28971731e+02  4.83308178e+02  4.83308178e+02  4.83308178e+02
  6.00750218e+02  1.33513094e+03  1.33513094e+03  1.33513094e+03
  2.66772597e+03  3.02935011e+03  3.02935011e+03  3.02935011e+03
  6.64977370e+03  6.64977370e+03  6.64977370e+03  9.07218028e+03
  2.54271159e+04  7.61686838e+04]
E1 = -728.3006746346881  E_coul = 201.56098099576297
cycle= 6 E= -526.739693638925  delta_E= -6.13e-11  |g|= 1.68e-06  |ddm|= 5.7e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3006746346881  E_coul = 201.56098099576297
  HOMO = -0.582298269786851  LUMO = 0.949579645442172
  mo_energy =
[-1.18578730e+02 -1.23106471e+01 -9.56126349e+00 -9.56126349e+00
 -9.56126349e+00 -1.26929353e+00 -5.82298270e-01 -5.82298270e-01
 -5.82298270e-01  9.49579645e-01  1.01960376e+00  1.01960376e+00
  1.01960376e+00  5.02453591e+00  7.28446697e+00  7.28446697e+00
  7.28446697e+00  2.10476955e+01  3.34139583e+01  3.34139583e+01
  3.34139583e+01  1.18922404e+02  1.28971733e+02  1.28971733e+02
  1.28971733e+02  4.83308180e+02  4.83308180e+02  4.83308180e+02
  6.00750220e+02  1.33513094e+03  1.33513094e+03  1.33513094e+03
  2.66772597e+03  3.02935011e+03  3.02935011e+03  3.02935011e+03
  6.64977370e+03  6.64977370e+03  6.64977370e+03  9.07218028e+03
  2.54271159e+04  7.61686838e+04]
E1 = -728.3006704969115  E_coul = 201.5609768579863
Extra cycle  E= -526.739693638925  delta_E= -1.14e-13  |g|= 3.65e-07  |ddm|= 7.88e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.26 sec
exp = [2.61826566e+04 7.61752034e+03 3.61735162e+03 1.59779279e+03
 3.82862026e+02 1.08262024e+02 3.64215648e+01 8.70813991e+00
 3.83783553e+00 8.50436851e-01 1.13963572e+00 2.48765016e-01
 1.36278345e+03 6.64743289e+02 3.00950706e+02 3.14032543e+02
 6.16317748e+01 7.33706750e+00 2.02313566e+01 7.75010377e-01
 2.81096747e+00 2.24106166e-01]
E = -526.7396936389252
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:00 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6565787        1
[INPUT] 0    0    [1    /1   ]  7617.52034191        1
[INPUT] 0    0    [1    /1   ]  3617.35162279        1
[INPUT] 0    0    [1    /1   ]  1597.79278926        1
[INPUT] 0    0    [1    /1   ]  382.8620263          1
[INPUT] 0    0    [1    /1   ]  108.262024131        1
[INPUT] 0    0    [1    /1   ]  36.4215647505        1
[INPUT] 0    0    [1    /1   ]  8.7081399062         1
[INPUT] 0    0    [1    /1   ]  3.83783553409        1
[INPUT] 0    0    [1    /1   ]  0.850436851302       1
[INPUT] 0    0    [1    /1   ]  1.13963572296        1
[INPUT] 0    0    [1    /1   ]  0.248765016444       1
[INPUT] 1    0    [1    /1   ]  1362.78344786        1
[INPUT] 1    0    [1    /1   ]  664.74328879         1
[INPUT] 1    0    [1    /1   ]  300.950705684        1
[INPUT] 1    0    [1    /1   ]  314.03254337         1
[INPUT] 1    0    [1    /1   ]  61.631774823         1
[INPUT] 1    0    [1    /1   ]  7.33706750334        1
[INPUT] 1    0    [1    /1   ]  20.2313565779        1
[INPUT] 1    0    [1    /1   ]  0.775010377129       1
[INPUT] 1    0    [1    /1   ]  2.81096746587        1
[INPUT] 1    0    [1    /1   ]  0.224106166411       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65657868495, 1.0]], [0, [7617.520341907364, 1.0]], [0, [3617.3516227913724, 1.0]], [0, [1597.7927892632772, 1.0]], [0, [382.86202630000605, 1.0]], [0, [108.26202413101447, 1.0]], [0, [36.42156475053208, 1.0]], [0, [8.708139906197468, 1.0]], [0, [3.8378355340921275, 1.0]], [0, [0.850436851302046, 1.0]], [0, [1.139635722955464, 1.0]], [0, [0.2487650164441757, 1.0]], [1, [1362.7834478565242, 1.0]], [1, [664.7432887901424, 1.0]], [1, [300.9507056839425, 1.0]], [1, [314.03254337049367, 1.0]], [1, [61.63177482297615, 1.0]], [1, [7.337067503340335, 1.0]], [1, [20.231356577863973, 1.0]], [1, [0.7750103771294821, 1.0]], [1, [2.810967465874543, 1.0]], [1, [0.22410616641090786, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65657868]
bas 1, expnt(s) = [7617.52034191]
bas 2, expnt(s) = [3617.35162279]
bas 3, expnt(s) = [1597.79278926]
bas 4, expnt(s) = [382.8620263]
bas 5, expnt(s) = [108.26202413]
bas 6, expnt(s) = [36.42156475]
bas 7, expnt(s) = [8.70813991]
bas 8, expnt(s) = [3.83783553]
bas 9, expnt(s) = [0.85043685]
bas 10, expnt(s) = [1.13963572]
bas 11, expnt(s) = [0.24876502]
bas 12, expnt(s) = [1362.78344786]
bas 13, expnt(s) = [664.74328879]
bas 14, expnt(s) = [300.95070568]
bas 15, expnt(s) = [314.03254337]
bas 16, expnt(s) = [61.63177482]
bas 17, expnt(s) = [7.3370675]
bas 18, expnt(s) = [20.23135658]
bas 19, expnt(s) = [0.77501038]
bas 20, expnt(s) = [2.81096747]
bas 21, expnt(s) = [0.22410617]
CPU time:       129.40
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826566e+04 5.20026298e+03 7.61752034e+03 2.06003805e+03
 3.61735162e+03 1.17844161e+03 1.59779279e+03 6.38491863e+02
 3.82862026e+02 2.18673796e+02 1.08262024e+02 8.47953684e+01
 3.64215648e+01 3.74570848e+01 8.70813991e+00 1.28073439e+01
 3.83783553e+00 6.92755199e+00 8.50436851e-01 2.23741517e+00
 1.13963572e+00 2.78669581e+00 2.48765016e-01 8.89932370e-01
 1.36278345e+03 2.41556070e+04 6.64743289e+02 9.84695253e+03
 3.00950706e+02 3.65682014e+03 3.14032543e+02 3.85658327e+03
 6.16317748e+01 5.03779204e+02 7.33706750e+00 3.52279634e+01
 2.02313566e+01 1.25174437e+02 7.75010377e-01 2.12138156e+00
 2.81096747e+00 1.06182798e+01 2.24106166e-01 4.49833351e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99353954378749
cond(S) = 112083.45013856838
E1 = -729.51544169003  E_coul = 203.16939316876395
init E= -526.346048521266
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555824111758697  LUMO = 0.966219419870389
  mo_energy =
[-1.18328700e+02 -1.22067883e+01 -9.44767285e+00 -9.44767285e+00
 -9.44767285e+00 -1.24012555e+00 -5.55824112e-01 -5.55824112e-01
 -5.55824112e-01  9.66219420e-01  1.03771853e+00  1.03771853e+00
  1.03771853e+00  5.06852041e+00  7.35378633e+00  7.35378633e+00
  7.35378633e+00  2.11366403e+01  3.35329116e+01  3.35329116e+01
  3.35329116e+01  1.19094232e+02  1.29151832e+02  1.29151832e+02
  1.29151832e+02  4.83557535e+02  4.83557535e+02  4.83557535e+02
  6.01035126e+02  1.33543341e+03  1.33543341e+03  1.33543341e+03
  2.66816121e+03  3.02971775e+03  3.02971775e+03  3.02971775e+03
  6.65025383e+03  6.65025383e+03  6.65025383e+03  9.07273539e+03
  2.54277648e+04  7.61694228e+04]
E1 = -727.8609794871275  E_coul = 201.1220549879196
cycle= 1 E= -526.738924499208  delta_E= -0.393  |g|= 0.186  |ddm|= 0.723
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.543841
diis-c [-0.29576303  1.        ]
  HOMO = -0.589690203640371  LUMO = 0.944017438474922
  mo_energy =
[-1.18636009e+02 -1.23424480e+01 -9.59436368e+00 -9.59436368e+00
 -9.59436368e+00 -1.27830415e+00 -5.89690204e-01 -5.89690204e-01
 -5.89690204e-01  9.44017438e-01  1.01410585e+00  1.01410585e+00
  1.01410585e+00  5.01139811e+00  7.26486536e+00  7.26486536e+00
  7.26486536e+00  2.10210291e+01  3.33805081e+01  3.33805081e+01
  3.33805081e+01  1.18875562e+02  1.28924642e+02  1.28924642e+02
  1.28924642e+02  4.83251594e+02  4.83251594e+02  4.83251594e+02
  6.00691740e+02  1.33507091e+03  1.33507091e+03  1.33507091e+03
  2.66766330e+03  3.02928823e+03  3.02928823e+03  3.02928823e+03
  6.64971049e+03  6.64971049e+03  6.64971049e+03  9.07211648e+03
  2.54270517e+04  7.61686195e+04]
E1 = -728.4266949416898  E_coul = 201.6870609345869
cycle= 2 E= -526.739634007103  delta_E= -0.00071  |g|= 0.0375  |ddm|= 0.06
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0756823
diis-c [-0.00332888  0.08305016  0.91694984]
  HOMO = -0.580838993818507  LUMO = 0.950550729689826
  mo_energy =
[-1.18568928e+02 -1.23049776e+01 -9.55523101e+00 -9.55523101e+00
 -9.55523101e+00 -1.26767638e+00 -5.80838994e-01 -5.80838994e-01
 -5.80838994e-01  9.50550730e-01  1.02065372e+00  1.02065372e+00
  1.02065372e+00  5.02696442e+00  7.28815469e+00  7.28815469e+00
  7.28815469e+00  2.10525084e+01  3.34200072e+01  3.34200072e+01
  3.34200072e+01  1.18930508e+02  1.28979936e+02  1.28979936e+02
  1.28979936e+02  4.83317868e+02  4.83317868e+02  4.83317868e+02
  6.00760249e+02  1.33514122e+03  1.33514122e+03  1.33514122e+03
  2.66773690e+03  3.02936078e+03  3.02936078e+03  3.02936078e+03
  6.64978478e+03  6.64978478e+03  6.64978478e+03  9.07219158e+03
  2.54271274e+04  7.61686954e+04]
E1 = -728.278418773578  E_coul = 201.5387270028975
cycle= 3 E= -526.73969177068  delta_E= -5.78e-05  |g|= 0.0062  |ddm|= 0.021
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0130799
diis-c [-7.46060619e-07 -1.28383824e-03  1.42686216e-01  8.58597623e-01]
  HOMO = -0.582311460542133  LUMO = 0.949550356143122
  mo_energy =
[-1.18578758e+02 -1.23107013e+01 -9.56130243e+00 -9.56130243e+00
 -9.56130243e+00 -1.26933307e+00 -5.82311461e-01 -5.82311461e-01
 -5.82311461e-01  9.49550356e-01  1.01959092e+00  1.01959092e+00
  1.01959092e+00  5.02449843e+00  7.28443453e+00  7.28443453e+00
  7.28443453e+00  2.10476488e+01  3.34139208e+01  3.34139208e+01
  3.34139208e+01  1.18922364e+02  1.28971697e+02  1.28971697e+02
  1.28971697e+02  4.83308152e+02  4.83308152e+02  4.83308152e+02
  6.00750199e+02  1.33513092e+03  1.33513092e+03  1.33513092e+03
  2.66772598e+03  3.02935010e+03  3.02935010e+03  3.02935010e+03
  6.64977371e+03  6.64977371e+03  6.64977371e+03  9.07218030e+03
  2.54271159e+04  7.61686838e+04]
E1 = -728.3008493552597  E_coul = 201.56115571834061
cycle= 4 E= -526.739693636919  delta_E= -1.87e-06  |g|= 0.000104  |ddm|= 0.00228
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116547
diis-c [-6.48417139e-09  8.52013132e-05 -1.19281353e-02 -7.51957202e-02
  1.08703865e+00]
  HOMO = -0.582290430062254  LUMO = 0.949582739626
  mo_energy =
[-1.18578699e+02 -1.23106235e+01 -9.56123798e+00 -9.56123798e+00
 -9.56123798e+00 -1.26928748e+00 -5.82290430e-01 -5.82290430e-01
 -5.82290430e-01  9.49582740e-01  1.01960892e+00  1.01960892e+00
  1.01960892e+00  5.02454684e+00  7.28448436e+00  7.28448436e+00
  7.28448436e+00  2.10477161e+01  3.34139830e+01  3.34139830e+01
  3.34139830e+01  1.18922432e+02  1.28971762e+02  1.28971762e+02
  1.28971762e+02  4.83308211e+02  4.83308211e+02  4.83308211e+02
  6.00750251e+02  1.33513098e+03  1.33513098e+03  1.33513098e+03
  2.66772601e+03  3.02935014e+03  3.02935014e+03  3.02935014e+03
  6.64977374e+03  6.64977374e+03  6.64977374e+03  9.07218032e+03
  2.54271159e+04  7.61686838e+04]
E1 = -728.3005859380812  E_coul = 201.56089229921741
cycle= 5 E= -526.739693638864  delta_E= -1.94e-09  |g|= 2.11e-05  |ddm|= 0.000511
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.98192e-05
diis-c [-1.05002607e-10  1.30530682e-05 -1.61853700e-03 -1.25904853e-02
  2.25885765e-02  9.91607393e-01]
  HOMO = -0.582298522935132  LUMO = 0.949579190241506
  mo_energy =
[-1.18578732e+02 -1.23106482e+01 -9.56126448e+00 -9.56126448e+00
 -9.56126448e+00 -1.26929416e+00 -5.82298523e-01 -5.82298523e-01
 -5.82298523e-01  9.49579190e-01  1.01960352e+00  1.01960352e+00
  1.01960352e+00  5.02453529e+00  7.28446630e+00  7.28446630e+00
  7.28446630e+00  2.10476946e+01  3.34139573e+01  3.34139573e+01
  3.34139573e+01  1.18922402e+02  1.28971731e+02  1.28971731e+02
  1.28971731e+02  4.83308178e+02  4.83308178e+02  4.83308178e+02
  6.00750218e+02  1.33513094e+03  1.33513094e+03  1.33513094e+03
  2.66772597e+03  3.02935011e+03  3.02935011e+03  3.02935011e+03
  6.64977370e+03  6.64977370e+03  6.64977370e+03  9.07218028e+03
  2.54271159e+04  7.61686838e+04]
E1 = -728.3006746346881  E_coul = 201.56098099576297
cycle= 6 E= -526.739693638925  delta_E= -6.13e-11  |g|= 1.68e-06  |ddm|= 5.7e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3006746346881  E_coul = 201.56098099576297
  HOMO = -0.582298269786851  LUMO = 0.949579645442172
  mo_energy =
[-1.18578730e+02 -1.23106471e+01 -9.56126349e+00 -9.56126349e+00
 -9.56126349e+00 -1.26929353e+00 -5.82298270e-01 -5.82298270e-01
 -5.82298270e-01  9.49579645e-01  1.01960376e+00  1.01960376e+00
  1.01960376e+00  5.02453591e+00  7.28446697e+00  7.28446697e+00
  7.28446697e+00  2.10476955e+01  3.34139583e+01  3.34139583e+01
  3.34139583e+01  1.18922404e+02  1.28971733e+02  1.28971733e+02
  1.28971733e+02  4.83308180e+02  4.83308180e+02  4.83308180e+02
  6.00750220e+02  1.33513094e+03  1.33513094e+03  1.33513094e+03
  2.66772597e+03  3.02935011e+03  3.02935011e+03  3.02935011e+03
  6.64977370e+03  6.64977370e+03  6.64977370e+03  9.07218028e+03
  2.54271159e+04  7.61686838e+04]
E1 = -728.3006704969115  E_coul = 201.5609768579863
Extra cycle  E= -526.739693638925  delta_E= -1.14e-13  |g|= 3.65e-07  |ddm|= 7.88e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 112083.45013856838
E1 = -728.3006704969115  E_coul = 201.5609768579863
init E= -526.739693638925
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.582298360771413  LUMO = 0.949579635757738
  mo_energy =
[-1.18578731e+02 -1.23106474e+01 -9.56126381e+00 -9.56126381e+00
 -9.56126381e+00 -1.26929357e+00 -5.82298361e-01 -5.82298361e-01
 -5.82298361e-01  9.49579636e-01  1.01960370e+00  1.01960370e+00
  1.01960370e+00  5.02453580e+00  7.28446676e+00  7.28446676e+00
  7.28446676e+00  2.10476952e+01  3.34139580e+01  3.34139580e+01
  3.34139580e+01  1.18922403e+02  1.28971732e+02  1.28971732e+02
  1.28971732e+02  4.83308179e+02  4.83308179e+02  4.83308179e+02
  6.00750219e+02  1.33513094e+03  1.33513094e+03  1.33513094e+03
  2.66772597e+03  3.02935011e+03  3.02935011e+03  3.02935011e+03
  6.64977370e+03  6.64977370e+03  6.64977370e+03  9.07218028e+03
  2.54271159e+04  7.61686838e+04]
E1 = -728.3006715727096  E_coul = 201.56097793378427
cycle= 1 E= -526.739693638925  delta_E=    0  |g|= 9.32e-08  |ddm|= 1.48e-06
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.3006715727096  E_coul = 201.56097793378427
  HOMO = -0.582298342808459  LUMO = 0.949579659746045
  mo_energy =
[-1.18578731e+02 -1.23106473e+01 -9.56126373e+00 -9.56126373e+00
 -9.56126373e+00 -1.26929354e+00 -5.82298343e-01 -5.82298343e-01
 -5.82298343e-01  9.49579660e-01  1.01960371e+00  1.01960371e+00
  1.01960371e+00  5.02453584e+00  7.28446681e+00  7.28446681e+00
  7.28446681e+00  2.10476953e+01  3.34139581e+01  3.34139581e+01
  3.34139581e+01  1.18922403e+02  1.28971732e+02  1.28971732e+02
  1.28971732e+02  4.83308180e+02  4.83308180e+02  4.83308180e+02
  6.00750219e+02  1.33513094e+03  1.33513094e+03  1.33513094e+03
  2.66772597e+03  3.02935011e+03  3.02935011e+03  3.02935011e+03
  6.64977370e+03  6.64977370e+03  6.64977370e+03  9.07218028e+03
  2.54271159e+04  7.61686838e+04]
E1 = -728.3006712513281  E_coul = 201.56097761240397
Extra cycle  E= -526.739693638924  delta_E= 1.14e-12  |g|= 2.21e-08  |ddm|= 3.34e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826566e+04 7.61752034e+03 3.61735162e+03 1.59779279e+03
 3.82862026e+02 1.08262024e+02 3.64215648e+01 8.70813991e+00
 3.83783553e+00 8.50436851e-01 1.13963572e+00 2.48765016e-01
 1.36278345e+03 6.64743289e+02 3.00950706e+02 3.14032543e+02
 6.16317748e+01 7.33706750e+00 2.02313566e+01 7.75010377e-01
 2.81096747e+00 2.24106166e-01]
grad_E = [-1.49670518e-06  3.08364894e-06 -1.68518966e-06  6.04478104e-05
  2.61644223e-04 -2.64039771e-03  1.60622143e-03 -1.82235228e-03
  1.61083709e-03  1.33808505e-03 -9.56215546e-04 -4.03372637e-03
 -5.09987400e-07  4.96319463e-06  2.33499018e-05  2.01325695e-05
  1.34971370e-05  9.73051446e-04 -2.65340205e-04 -1.20532690e-02
 -9.63821919e-04  4.27054290e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:05 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.656692         1
[INPUT] 0    0    [1    /1   ]  7617.52009948        1
[INPUT] 0    0    [1    /1   ]  3617.35174399        1
[INPUT] 0    0    [1    /1   ]  1597.78781402        1
[INPUT] 0    0    [1    /1   ]  382.857172685        1
[INPUT] 0    0    [1    /1   ]  108.338161646        1
[INPUT] 0    0    [1    /1   ]  36.5588851483        1
[INPUT] 0    0    [1    /1   ]  8.86648822716        1
[INPUT] 0    0    [1    /1   ]  3.96857223368        1
[INPUT] 0    0    [1    /1   ]  0.827297129802       1
[INPUT] 0    0    [1    /1   ]  1.21766061352        1
[INPUT] 0    0    [1    /1   ]  0.248559670925       1
[INPUT] 1    0    [1    /1   ]  1362.78348601        1
[INPUT] 1    0    [1    /1   ]  664.742914935        1
[INPUT] 1    0    [1    /1   ]  300.94894487         1
[INPUT] 1    0    [1    /1   ]  314.031025179        1
[INPUT] 1    0    [1    /1   ]  61.6318335714        1
[INPUT] 1    0    [1    /1   ]  7.32569302841        1
[INPUT] 1    0    [1    /1   ]  20.2395404946        1
[INPUT] 1    0    [1    /1   ]  0.774439257883       1
[INPUT] 1    0    [1    /1   ]  2.80224993702        1
[INPUT] 1    0    [1    /1   ]  0.223267892047       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65669198088, 1.0]], [0, [7617.520099475126, 1.0]], [0, [3617.3517439891625, 1.0]], [0, [1597.7878140222579, 1.0]], [0, [382.8571726849333, 1.0]], [0, [108.33816164628824, 1.0]], [0, [36.55888514829114, 1.0]], [0, [8.866488227155344, 1.0]], [0, [3.9685722336793625, 1.0]], [0, [0.8272971298019856, 1.0]], [0, [1.2176606135150279, 1.0]], [0, [0.24855967092464637, 1.0]], [1, [1362.7834860092391, 1.0]], [1, [664.7429149346445, 1.0]], [1, [300.9489448697961, 1.0]], [1, [314.0310251786765, 1.0]], [1, [61.631833571390615, 1.0]], [1, [7.325693028412128, 1.0]], [1, [20.23954049458054, 1.0]], [1, [0.7744392578827635, 1.0]], [1, [2.8022499370231593, 1.0]], [1, [0.22326789204711267, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65669198]
bas 1, expnt(s) = [7617.52009948]
bas 2, expnt(s) = [3617.35174399]
bas 3, expnt(s) = [1597.78781402]
bas 4, expnt(s) = [382.85717268]
bas 5, expnt(s) = [108.33816165]
bas 6, expnt(s) = [36.55888515]
bas 7, expnt(s) = [8.86648823]
bas 8, expnt(s) = [3.96857223]
bas 9, expnt(s) = [0.82729713]
bas 10, expnt(s) = [1.21766061]
bas 11, expnt(s) = [0.24855967]
bas 12, expnt(s) = [1362.78348601]
bas 13, expnt(s) = [664.74291493]
bas 14, expnt(s) = [300.94894487]
bas 15, expnt(s) = [314.03102518]
bas 16, expnt(s) = [61.63183357]
bas 17, expnt(s) = [7.32569303]
bas 18, expnt(s) = [20.23954049]
bas 19, expnt(s) = [0.77443926]
bas 20, expnt(s) = [2.80224994]
bas 21, expnt(s) = [0.22326789]
CPU time:       135.15
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826567e+04 5.20026299e+03 7.61752010e+03 2.06003800e+03
 3.61735174e+03 1.17844164e+03 1.59778781e+03 6.38490372e+02
 3.82857173e+02 2.18671717e+02 1.08338162e+02 8.48400900e+01
 3.65588851e+01 3.75629534e+01 8.86648823e+00 1.29816159e+01
 3.96857223e+00 7.10380025e+00 8.27297130e-01 2.19159935e+00
 1.21766061e+00 2.92859771e+00 2.48559671e-01 8.89381360e-01
 1.36278349e+03 2.41556078e+04 6.64742915e+02 9.84694561e+03
 3.00948945e+02 3.65679339e+03 3.14031025e+02 3.85655997e+03
 6.16318336e+01 5.03779804e+02 7.32569303e+00 3.51597103e+01
 2.02395405e+01 1.25237735e+02 7.74439258e-01 2.11942763e+00
 2.80224994e+00 1.05771333e+01 2.23267892e-01 4.47731070e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993632265844898
cond(S) = 112134.01338512267
E1 = -729.5153070229503  E_coul = 203.1691396712437
init E= -526.346167351707
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555875487610567  LUMO = 0.972548911897452
  mo_energy =
[-1.18328827e+02 -1.22067257e+01 -9.44765511e+00 -9.44765511e+00
 -9.44765511e+00 -1.24017361e+00 -5.55875488e-01 -5.55875488e-01
 -5.55875488e-01  9.72548912e-01  1.03389134e+00  1.03389134e+00
  1.03389134e+00  5.21209795e+00  7.33021024e+00  7.33021024e+00
  7.33021024e+00  2.19131717e+01  3.34758342e+01  3.34758342e+01
  3.34758342e+01  1.20798358e+02  1.29102087e+02  1.29102087e+02
  1.29102087e+02  4.83523668e+02  4.83523668e+02  4.83523668e+02
  6.03049160e+02  1.33540176e+03  1.33540176e+03  1.33540176e+03
  2.67007007e+03  3.02968397e+03  3.02968397e+03  3.02968397e+03
  6.65021936e+03  6.65021936e+03  6.65021936e+03  9.07450174e+03
  2.54294352e+04  7.61709775e+04]
E1 = -727.8511403923687  E_coul = 201.11207162372642
cycle= 1 E= -526.739068768642  delta_E= -0.393  |g|= 0.186  |ddm|= 0.493
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544093
diis-c [-0.29603702  1.        ]
  HOMO = -0.590133034805996  LUMO = 0.94966194084233
  mo_energy =
[-1.18636709e+02 -1.23430804e+01 -9.59498207e+00 -9.59498207e+00
 -9.59498207e+00 -1.27885685e+00 -5.90133035e-01 -5.90133035e-01
 -5.90133035e-01  9.49661941e-01  1.01004594e+00  1.01004594e+00
  1.01004594e+00  5.15295053e+00  7.24074951e+00  7.24074951e+00
  7.24074951e+00  2.17953370e+01  3.33228298e+01  3.33228298e+01
  3.33228298e+01  1.20578835e+02  1.28874260e+02  1.28874260e+02
  1.28874260e+02  4.83217155e+02  4.83217155e+02  4.83217155e+02
  6.02705219e+02  1.33503868e+03  1.33503868e+03  1.33503868e+03
  2.66957161e+03  3.02925387e+03  3.02925387e+03  3.02925387e+03
  6.64967543e+03  6.64967543e+03  6.64967543e+03  9.07388225e+03
  2.54287214e+04  7.61701736e+04]
E1 = -728.4204660789911  E_coul = 201.68068270594355
cycle= 2 E= -526.739783373048  delta_E= -0.000715  |g|= 0.0376  |ddm|= 0.0536
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0759775
diis-c [-0.00335874  0.0832544   0.9167456 ]
  HOMO = -0.581204287932265  LUMO = 0.956329050381869
  mo_energy =
[-1.18569331e+02 -1.23053727e+01 -9.55560104e+00 -9.55560104e+00
 -9.55560104e+00 -1.26814453e+00 -5.81204288e-01 -5.81204288e-01
 -5.81204288e-01  9.56329050e-01  1.01663247e+00  1.01663247e+00
  1.01663247e+00  5.16902530e+00  7.26417517e+00  7.26417517e+00
  7.26417517e+00  2.18274315e+01  3.33625658e+01  3.33625658e+01
  3.33625658e+01  1.20634094e+02  1.28929832e+02  1.28929832e+02
  1.28929832e+02  4.83283724e+02  4.83283724e+02  4.83283724e+02
  6.02774017e+02  1.33510930e+03  1.33510930e+03  1.33510930e+03
  2.66964552e+03  3.02932673e+03  3.02932673e+03  3.02932673e+03
  6.64975004e+03  6.64975004e+03  6.64975004e+03  9.07395767e+03
  2.54287974e+04  7.61702499e+04]
E1 = -728.2710278320926  E_coul = 201.53118594680737
cycle= 3 E= -526.739841885285  delta_E= -5.85e-05  |g|= 0.00624  |ddm|= 0.0181
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0131482
diis-c [-7.30843595e-07 -1.28200446e-03  1.42890184e-01  8.58391820e-01]
  HOMO = -0.582688365078858  LUMO = 0.955304368538112
  mo_energy =
[-1.18579220e+02 -1.23111369e+01 -9.56171332e+00 -9.56171332e+00
 -9.56171332e+00 -1.26981811e+00 -5.82688365e-01 -5.82688365e-01
 -5.82688365e-01  9.55304369e-01  1.01556333e+00  1.01556333e+00
  1.01556333e+00  5.16647820e+00  7.26043257e+00  7.26043257e+00
  7.26043257e+00  2.18224761e+01  3.33564391e+01  3.33564391e+01
  3.33564391e+01  1.20625892e+02  1.28921541e+02  1.28921541e+02
  1.28921541e+02  4.83273949e+02  4.83273949e+02  4.83273949e+02
  6.02763909e+02  1.33509894e+03  1.33509894e+03  1.33509894e+03
  2.66963454e+03  3.02931599e+03  3.02931599e+03  3.02931599e+03
  6.64973890e+03  6.64973890e+03  6.64973890e+03  9.07394633e+03
  2.54287859e+04  7.61702383e+04]
E1 = -728.2936657799102  E_coul = 201.55382199933837
cycle= 4 E= -526.739843780572  delta_E= -1.9e-06  |g|= 0.000101  |ddm|= 0.00221
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000112738
diis-c [-6.22745577e-09  8.23534470e-05 -1.15860551e-02 -7.27837115e-02
  1.08428741e+00]
  HOMO = -0.582667152347164  LUMO = 0.955336447575321
  mo_energy =
[-1.18579161e+02 -1.23110592e+01 -9.56164854e+00 -9.56164854e+00
 -9.56164854e+00 -1.26977323e+00 -5.82667152e-01 -5.82667152e-01
 -5.82667152e-01  9.55336448e-01  1.01558130e+00  1.01558130e+00
  1.01558130e+00  5.16652716e+00  7.26048247e+00  7.26048247e+00
  7.26048247e+00  2.18225435e+01  3.33565015e+01  3.33565015e+01
  3.33565015e+01  1.20625959e+02  1.28921606e+02  1.28921606e+02
  1.28921606e+02  4.83274009e+02  4.83274009e+02  4.83274009e+02
  6.02763962e+02  1.33509899e+03  1.33509899e+03  1.33509899e+03
  2.66963457e+03  3.02931603e+03  3.02931603e+03  3.02931603e+03
  6.64973893e+03  6.64973893e+03  6.64973893e+03  9.07394635e+03
  2.54287859e+04  7.61702383e+04]
E1 = -728.2934025550546  E_coul = 201.55355877269108
cycle= 5 E= -526.739843782364  delta_E= -1.79e-09  |g|= 2.07e-05  |ddm|= 0.000341
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.92381e-05
diis-c [-1.00088417e-10  1.28605237e-05 -1.60402987e-03 -1.24311689e-02
  2.38940195e-02  9.90128319e-01]
  HOMO = -0.582675091169931  LUMO = 0.955332881193521
  mo_energy =
[-1.18579193e+02 -1.23110834e+01 -9.56167457e+00 -9.56167457e+00
 -9.56167457e+00 -1.26977982e+00 -5.82675091e-01 -5.82675091e-01
 -5.82675091e-01  9.55332881e-01  1.01557601e+00  1.01557601e+00
  1.01557601e+00  5.16651553e+00  7.26046476e+00  7.26046476e+00
  7.26046476e+00  2.18225222e+01  3.33564763e+01  3.33564763e+01
  3.33564763e+01  1.20625930e+02  1.28921577e+02  1.28921577e+02
  1.28921577e+02  4.83273977e+02  4.83273977e+02  4.83273977e+02
  6.02763930e+02  1.33509896e+03  1.33509896e+03  1.33509896e+03
  2.66963453e+03  3.02931600e+03  3.02931600e+03  3.02931600e+03
  6.64973890e+03  6.64973890e+03  6.64973890e+03  9.07394631e+03
  2.54287859e+04  7.61702382e+04]
E1 = -728.2934900441428  E_coul = 201.55364626172096
cycle= 6 E= -526.739843782422  delta_E= -5.83e-11  |g|= 1.66e-06  |ddm|= 3.84e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2934900441428  E_coul = 201.55364626172096
  HOMO = -0.582674856718545  LUMO = 0.955333328263103
  mo_energy =
[-1.18579192e+02 -1.23110824e+01 -9.56167365e+00 -9.56167365e+00
 -9.56167365e+00 -1.26977921e+00 -5.82674857e-01 -5.82674857e-01
 -5.82674857e-01  9.55333328e-01  1.01557623e+00  1.01557623e+00
  1.01557623e+00  5.16651613e+00  7.26046538e+00  7.26046538e+00
  7.26046538e+00  2.18225231e+01  3.33564772e+01  3.33564772e+01
  3.33564772e+01  1.20625931e+02  1.28921578e+02  1.28921578e+02
  1.28921578e+02  4.83273978e+02  4.83273978e+02  4.83273978e+02
  6.02763931e+02  1.33509896e+03  1.33509896e+03  1.33509896e+03
  2.66963454e+03  3.02931600e+03  3.02931600e+03  3.02931600e+03
  6.64973890e+03  6.64973890e+03  6.64973890e+03  9.07394631e+03
  2.54287859e+04  7.61702382e+04]
E1 = -728.2934861654716  E_coul = 201.55364238304955
Extra cycle  E= -526.739843782422  delta_E= -1.14e-13  |g|= 3.58e-07  |ddm|= 5.6e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.26 sec
exp = [2.61826567e+04 7.61752010e+03 3.61735174e+03 1.59778781e+03
 3.82857173e+02 1.08338162e+02 3.65588851e+01 8.86648823e+00
 3.96857223e+00 8.27297130e-01 1.21766061e+00 2.48559671e-01
 1.36278349e+03 6.64742915e+02 3.00948945e+02 3.14031025e+02
 6.16318336e+01 7.32569303e+00 2.02395405e+01 7.74439258e-01
 2.80224994e+00 2.23267892e-01]
E = -526.739843782422
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:05 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.656692         1
[INPUT] 0    0    [1    /1   ]  7617.52009948        1
[INPUT] 0    0    [1    /1   ]  3617.35174399        1
[INPUT] 0    0    [1    /1   ]  1597.78781402        1
[INPUT] 0    0    [1    /1   ]  382.857172685        1
[INPUT] 0    0    [1    /1   ]  108.338161646        1
[INPUT] 0    0    [1    /1   ]  36.5588851483        1
[INPUT] 0    0    [1    /1   ]  8.86648822716        1
[INPUT] 0    0    [1    /1   ]  3.96857223368        1
[INPUT] 0    0    [1    /1   ]  0.827297129802       1
[INPUT] 0    0    [1    /1   ]  1.21766061352        1
[INPUT] 0    0    [1    /1   ]  0.248559670925       1
[INPUT] 1    0    [1    /1   ]  1362.78348601        1
[INPUT] 1    0    [1    /1   ]  664.742914935        1
[INPUT] 1    0    [1    /1   ]  300.94894487         1
[INPUT] 1    0    [1    /1   ]  314.031025179        1
[INPUT] 1    0    [1    /1   ]  61.6318335714        1
[INPUT] 1    0    [1    /1   ]  7.32569302841        1
[INPUT] 1    0    [1    /1   ]  20.2395404946        1
[INPUT] 1    0    [1    /1   ]  0.774439257883       1
[INPUT] 1    0    [1    /1   ]  2.80224993702        1
[INPUT] 1    0    [1    /1   ]  0.223267892047       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65669198088, 1.0]], [0, [7617.520099475126, 1.0]], [0, [3617.3517439891625, 1.0]], [0, [1597.7878140222579, 1.0]], [0, [382.8571726849333, 1.0]], [0, [108.33816164628824, 1.0]], [0, [36.55888514829114, 1.0]], [0, [8.866488227155344, 1.0]], [0, [3.9685722336793625, 1.0]], [0, [0.8272971298019856, 1.0]], [0, [1.2176606135150279, 1.0]], [0, [0.24855967092464637, 1.0]], [1, [1362.7834860092391, 1.0]], [1, [664.7429149346445, 1.0]], [1, [300.9489448697961, 1.0]], [1, [314.0310251786765, 1.0]], [1, [61.631833571390615, 1.0]], [1, [7.325693028412128, 1.0]], [1, [20.23954049458054, 1.0]], [1, [0.7744392578827635, 1.0]], [1, [2.8022499370231593, 1.0]], [1, [0.22326789204711267, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65669198]
bas 1, expnt(s) = [7617.52009948]
bas 2, expnt(s) = [3617.35174399]
bas 3, expnt(s) = [1597.78781402]
bas 4, expnt(s) = [382.85717268]
bas 5, expnt(s) = [108.33816165]
bas 6, expnt(s) = [36.55888515]
bas 7, expnt(s) = [8.86648823]
bas 8, expnt(s) = [3.96857223]
bas 9, expnt(s) = [0.82729713]
bas 10, expnt(s) = [1.21766061]
bas 11, expnt(s) = [0.24855967]
bas 12, expnt(s) = [1362.78348601]
bas 13, expnt(s) = [664.74291493]
bas 14, expnt(s) = [300.94894487]
bas 15, expnt(s) = [314.03102518]
bas 16, expnt(s) = [61.63183357]
bas 17, expnt(s) = [7.32569303]
bas 18, expnt(s) = [20.23954049]
bas 19, expnt(s) = [0.77443926]
bas 20, expnt(s) = [2.80224994]
bas 21, expnt(s) = [0.22326789]
CPU time:       135.51
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826567e+04 5.20026299e+03 7.61752010e+03 2.06003800e+03
 3.61735174e+03 1.17844164e+03 1.59778781e+03 6.38490372e+02
 3.82857173e+02 2.18671717e+02 1.08338162e+02 8.48400900e+01
 3.65588851e+01 3.75629534e+01 8.86648823e+00 1.29816159e+01
 3.96857223e+00 7.10380025e+00 8.27297130e-01 2.19159935e+00
 1.21766061e+00 2.92859771e+00 2.48559671e-01 8.89381360e-01
 1.36278349e+03 2.41556078e+04 6.64742915e+02 9.84694561e+03
 3.00948945e+02 3.65679339e+03 3.14031025e+02 3.85655997e+03
 6.16318336e+01 5.03779804e+02 7.32569303e+00 3.51597103e+01
 2.02395405e+01 1.25237735e+02 7.74439258e-01 2.11942763e+00
 2.80224994e+00 1.05771333e+01 2.23267892e-01 4.47731070e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993632265844898
cond(S) = 112134.01338512267
E1 = -729.5153070229503  E_coul = 203.1691396712437
init E= -526.346167351707
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555875487610567  LUMO = 0.972548911897452
  mo_energy =
[-1.18328827e+02 -1.22067257e+01 -9.44765511e+00 -9.44765511e+00
 -9.44765511e+00 -1.24017361e+00 -5.55875488e-01 -5.55875488e-01
 -5.55875488e-01  9.72548912e-01  1.03389134e+00  1.03389134e+00
  1.03389134e+00  5.21209795e+00  7.33021024e+00  7.33021024e+00
  7.33021024e+00  2.19131717e+01  3.34758342e+01  3.34758342e+01
  3.34758342e+01  1.20798358e+02  1.29102087e+02  1.29102087e+02
  1.29102087e+02  4.83523668e+02  4.83523668e+02  4.83523668e+02
  6.03049160e+02  1.33540176e+03  1.33540176e+03  1.33540176e+03
  2.67007007e+03  3.02968397e+03  3.02968397e+03  3.02968397e+03
  6.65021936e+03  6.65021936e+03  6.65021936e+03  9.07450174e+03
  2.54294352e+04  7.61709775e+04]
E1 = -727.8511403923687  E_coul = 201.11207162372642
cycle= 1 E= -526.739068768642  delta_E= -0.393  |g|= 0.186  |ddm|= 0.493
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544093
diis-c [-0.29603702  1.        ]
  HOMO = -0.590133034805996  LUMO = 0.94966194084233
  mo_energy =
[-1.18636709e+02 -1.23430804e+01 -9.59498207e+00 -9.59498207e+00
 -9.59498207e+00 -1.27885685e+00 -5.90133035e-01 -5.90133035e-01
 -5.90133035e-01  9.49661941e-01  1.01004594e+00  1.01004594e+00
  1.01004594e+00  5.15295053e+00  7.24074951e+00  7.24074951e+00
  7.24074951e+00  2.17953370e+01  3.33228298e+01  3.33228298e+01
  3.33228298e+01  1.20578835e+02  1.28874260e+02  1.28874260e+02
  1.28874260e+02  4.83217155e+02  4.83217155e+02  4.83217155e+02
  6.02705219e+02  1.33503868e+03  1.33503868e+03  1.33503868e+03
  2.66957161e+03  3.02925387e+03  3.02925387e+03  3.02925387e+03
  6.64967543e+03  6.64967543e+03  6.64967543e+03  9.07388225e+03
  2.54287214e+04  7.61701736e+04]
E1 = -728.4204660789911  E_coul = 201.68068270594355
cycle= 2 E= -526.739783373048  delta_E= -0.000715  |g|= 0.0376  |ddm|= 0.0536
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0759775
diis-c [-0.00335874  0.0832544   0.9167456 ]
  HOMO = -0.581204287932265  LUMO = 0.956329050381869
  mo_energy =
[-1.18569331e+02 -1.23053727e+01 -9.55560104e+00 -9.55560104e+00
 -9.55560104e+00 -1.26814453e+00 -5.81204288e-01 -5.81204288e-01
 -5.81204288e-01  9.56329050e-01  1.01663247e+00  1.01663247e+00
  1.01663247e+00  5.16902530e+00  7.26417517e+00  7.26417517e+00
  7.26417517e+00  2.18274315e+01  3.33625658e+01  3.33625658e+01
  3.33625658e+01  1.20634094e+02  1.28929832e+02  1.28929832e+02
  1.28929832e+02  4.83283724e+02  4.83283724e+02  4.83283724e+02
  6.02774017e+02  1.33510930e+03  1.33510930e+03  1.33510930e+03
  2.66964552e+03  3.02932673e+03  3.02932673e+03  3.02932673e+03
  6.64975004e+03  6.64975004e+03  6.64975004e+03  9.07395767e+03
  2.54287974e+04  7.61702499e+04]
E1 = -728.2710278320926  E_coul = 201.53118594680737
cycle= 3 E= -526.739841885285  delta_E= -5.85e-05  |g|= 0.00624  |ddm|= 0.0181
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0131482
diis-c [-7.30843595e-07 -1.28200446e-03  1.42890184e-01  8.58391820e-01]
  HOMO = -0.582688365078858  LUMO = 0.955304368538112
  mo_energy =
[-1.18579220e+02 -1.23111369e+01 -9.56171332e+00 -9.56171332e+00
 -9.56171332e+00 -1.26981811e+00 -5.82688365e-01 -5.82688365e-01
 -5.82688365e-01  9.55304369e-01  1.01556333e+00  1.01556333e+00
  1.01556333e+00  5.16647820e+00  7.26043257e+00  7.26043257e+00
  7.26043257e+00  2.18224761e+01  3.33564391e+01  3.33564391e+01
  3.33564391e+01  1.20625892e+02  1.28921541e+02  1.28921541e+02
  1.28921541e+02  4.83273949e+02  4.83273949e+02  4.83273949e+02
  6.02763909e+02  1.33509894e+03  1.33509894e+03  1.33509894e+03
  2.66963454e+03  3.02931599e+03  3.02931599e+03  3.02931599e+03
  6.64973890e+03  6.64973890e+03  6.64973890e+03  9.07394633e+03
  2.54287859e+04  7.61702383e+04]
E1 = -728.2936657799102  E_coul = 201.55382199933837
cycle= 4 E= -526.739843780572  delta_E= -1.9e-06  |g|= 0.000101  |ddm|= 0.00221
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000112738
diis-c [-6.22745577e-09  8.23534470e-05 -1.15860551e-02 -7.27837115e-02
  1.08428741e+00]
  HOMO = -0.582667152347164  LUMO = 0.955336447575321
  mo_energy =
[-1.18579161e+02 -1.23110592e+01 -9.56164854e+00 -9.56164854e+00
 -9.56164854e+00 -1.26977323e+00 -5.82667152e-01 -5.82667152e-01
 -5.82667152e-01  9.55336448e-01  1.01558130e+00  1.01558130e+00
  1.01558130e+00  5.16652716e+00  7.26048247e+00  7.26048247e+00
  7.26048247e+00  2.18225435e+01  3.33565015e+01  3.33565015e+01
  3.33565015e+01  1.20625959e+02  1.28921606e+02  1.28921606e+02
  1.28921606e+02  4.83274009e+02  4.83274009e+02  4.83274009e+02
  6.02763962e+02  1.33509899e+03  1.33509899e+03  1.33509899e+03
  2.66963457e+03  3.02931603e+03  3.02931603e+03  3.02931603e+03
  6.64973893e+03  6.64973893e+03  6.64973893e+03  9.07394635e+03
  2.54287859e+04  7.61702383e+04]
E1 = -728.2934025550546  E_coul = 201.55355877269108
cycle= 5 E= -526.739843782364  delta_E= -1.79e-09  |g|= 2.07e-05  |ddm|= 0.000341
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.92381e-05
diis-c [-1.00088417e-10  1.28605237e-05 -1.60402987e-03 -1.24311689e-02
  2.38940195e-02  9.90128319e-01]
  HOMO = -0.582675091169931  LUMO = 0.955332881193521
  mo_energy =
[-1.18579193e+02 -1.23110834e+01 -9.56167457e+00 -9.56167457e+00
 -9.56167457e+00 -1.26977982e+00 -5.82675091e-01 -5.82675091e-01
 -5.82675091e-01  9.55332881e-01  1.01557601e+00  1.01557601e+00
  1.01557601e+00  5.16651553e+00  7.26046476e+00  7.26046476e+00
  7.26046476e+00  2.18225222e+01  3.33564763e+01  3.33564763e+01
  3.33564763e+01  1.20625930e+02  1.28921577e+02  1.28921577e+02
  1.28921577e+02  4.83273977e+02  4.83273977e+02  4.83273977e+02
  6.02763930e+02  1.33509896e+03  1.33509896e+03  1.33509896e+03
  2.66963453e+03  3.02931600e+03  3.02931600e+03  3.02931600e+03
  6.64973890e+03  6.64973890e+03  6.64973890e+03  9.07394631e+03
  2.54287859e+04  7.61702382e+04]
E1 = -728.2934900441428  E_coul = 201.55364626172096
cycle= 6 E= -526.739843782422  delta_E= -5.83e-11  |g|= 1.66e-06  |ddm|= 3.84e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2934900441428  E_coul = 201.55364626172096
  HOMO = -0.582674856718545  LUMO = 0.955333328263103
  mo_energy =
[-1.18579192e+02 -1.23110824e+01 -9.56167365e+00 -9.56167365e+00
 -9.56167365e+00 -1.26977921e+00 -5.82674857e-01 -5.82674857e-01
 -5.82674857e-01  9.55333328e-01  1.01557623e+00  1.01557623e+00
  1.01557623e+00  5.16651613e+00  7.26046538e+00  7.26046538e+00
  7.26046538e+00  2.18225231e+01  3.33564772e+01  3.33564772e+01
  3.33564772e+01  1.20625931e+02  1.28921578e+02  1.28921578e+02
  1.28921578e+02  4.83273978e+02  4.83273978e+02  4.83273978e+02
  6.02763931e+02  1.33509896e+03  1.33509896e+03  1.33509896e+03
  2.66963454e+03  3.02931600e+03  3.02931600e+03  3.02931600e+03
  6.64973890e+03  6.64973890e+03  6.64973890e+03  9.07394631e+03
  2.54287859e+04  7.61702382e+04]
E1 = -728.2934861654716  E_coul = 201.55364238304955
Extra cycle  E= -526.739843782422  delta_E= -1.14e-13  |g|= 3.58e-07  |ddm|= 5.6e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 112134.01338512267
E1 = -728.2934861654716  E_coul = 201.55364238304955
init E= -526.739843782422
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.582674942673574  LUMO = 0.955333321998232
  mo_energy =
[-1.18579192e+02 -1.23110827e+01 -9.56167396e+00 -9.56167396e+00
 -9.56167396e+00 -1.26977925e+00 -5.82674943e-01 -5.82674943e-01
 -5.82674943e-01  9.55333322e-01  1.01557618e+00  1.01557618e+00
  1.01557618e+00  5.16651603e+00  7.26046519e+00  7.26046519e+00
  7.26046519e+00  2.18225228e+01  3.33564769e+01  3.33564769e+01
  3.33564769e+01  1.20625931e+02  1.28921577e+02  1.28921577e+02
  1.28921577e+02  4.83273978e+02  4.83273978e+02  4.83273978e+02
  6.02763930e+02  1.33509896e+03  1.33509896e+03  1.33509896e+03
  2.66963454e+03  3.02931600e+03  3.02931600e+03  3.02931600e+03
  6.64973890e+03  6.64973890e+03  6.64973890e+03  9.07394631e+03
  2.54287859e+04  7.61702382e+04]
E1 = -728.2934871719089  E_coul = 201.55364338948658
cycle= 1 E= -526.739843782422  delta_E= -2.27e-13  |g|= 9.02e-08  |ddm|= 1.04e-06
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2934871719089  E_coul = 201.55364338948658
  HOMO = -0.582674925944507  LUMO = 0.955333345397058
  mo_energy =
[-1.18579192e+02 -1.23110826e+01 -9.56167389e+00 -9.56167389e+00
 -9.56167389e+00 -1.26977921e+00 -5.82674926e-01 -5.82674926e-01
 -5.82674926e-01  9.55333345e-01  1.01557619e+00  1.01557619e+00
  1.01557619e+00  5.16651606e+00  7.26046523e+00  7.26046523e+00
  7.26046523e+00  2.18225229e+01  3.33564770e+01  3.33564770e+01
  3.33564770e+01  1.20625931e+02  1.28921577e+02  1.28921577e+02
  1.28921577e+02  4.83273978e+02  4.83273978e+02  4.83273978e+02
  6.02763931e+02  1.33509896e+03  1.33509896e+03  1.33509896e+03
  2.66963454e+03  3.02931600e+03  3.02931600e+03  3.02931600e+03
  6.64973890e+03  6.64973890e+03  6.64973890e+03  9.07394631e+03
  2.54287859e+04  7.61702382e+04]
E1 = -728.2934868698115  E_coul = 201.55364308738928
Extra cycle  E= -526.739843782422  delta_E=    0  |g|= 2.12e-08  |ddm|= 2.36e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826567e+04 7.61752010e+03 3.61735174e+03 1.59778781e+03
 3.82857173e+02 1.08338162e+02 3.65588851e+01 8.86648823e+00
 3.96857223e+00 8.27297130e-01 1.21766061e+00 2.48559671e-01
 1.36278349e+03 6.64742915e+02 3.00948945e+02 3.14031025e+02
 6.16318336e+01 7.32569303e+00 2.02395405e+01 7.74439258e-01
 2.80224994e+00 2.23267892e-01]
grad_E = [-1.49652435e-06  3.08170263e-06 -1.68581545e-06  6.03579208e-05
  2.66501650e-04 -2.69533278e-03  1.68387307e-03 -2.03917276e-03
  2.98787532e-03  6.28818039e-04 -2.16549287e-03 -1.17752302e-03
 -5.05809591e-07  5.02131626e-06  2.37024365e-05  2.04350838e-05
 -2.65770600e-05  4.08838881e-04  2.24786280e-05 -6.75064658e-03
 -9.83078355e-04  2.40251839e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:10 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6568429        1
[INPUT] 0    0    [1    /1   ]  7617.51977726        1
[INPUT] 0    0    [1    /1   ]  3617.35190585        1
[INPUT] 0    0    [1    /1   ]  1597.78121674        1
[INPUT] 0    0    [1    /1   ]  382.849652464        1
[INPUT] 0    0    [1    /1   ]  108.448268801        1
[INPUT] 0    0    [1    /1   ]  36.7235175702        1
[INPUT] 0    0    [1    /1   ]  9.07991912176        1
[INPUT] 0    0    [1    /1   ]  4.1181437581         1
[INPUT] 0    0    [1    /1   ]  0.7928529398         1
[INPUT] 0    0    [1    /1   ]  1.31205112283        1
[INPUT] 0    0    [1    /1   ]  0.246827506481       1
[INPUT] 1    0    [1    /1   ]  1362.78353686        1
[INPUT] 1    0    [1    /1   ]  664.74241702         1
[INPUT] 1    0    [1    /1   ]  300.946600014        1
[INPUT] 1    0    [1    /1   ]  314.02900342         1
[INPUT] 1    0    [1    /1   ]  61.6317873085        1
[INPUT] 1    0    [1    /1   ]  7.30912069019        1
[INPUT] 1    0    [1    /1   ]  20.2512764389        1
[INPUT] 1    0    [1    /1   ]  0.773605929064       1
[INPUT] 1    0    [1    /1   ]  2.79072235715        1
[INPUT] 1    0    [1    /1   ]  0.222029979931       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656842862045, 1.0]], [0, [7617.51977726075, 1.0]], [0, [3617.3519058535294, 1.0]], [0, [1597.781216735763, 1.0]], [0, [382.84965246374327, 1.0]], [0, [108.44826880112531, 1.0]], [0, [36.723517570194886, 1.0]], [0, [9.079919121757403, 1.0]], [0, [4.11814375810302, 1.0]], [0, [0.7928529398004772, 1.0]], [0, [1.3120511228259053, 1.0]], [0, [0.24682750648063737, 1.0]], [1, [1362.7835368583285, 1.0]], [1, [664.7424170201779, 1.0]], [1, [300.94660001425416, 1.0]], [1, [314.02900341951715, 1.0]], [1, [61.63178730849576, 1.0]], [1, [7.309120690185619, 1.0]], [1, [20.251276438919824, 1.0]], [1, [0.7736059290640164, 1.0]], [1, [2.7907223571471618, 1.0]], [1, [0.22202997993060794, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65684286]
bas 1, expnt(s) = [7617.51977726]
bas 2, expnt(s) = [3617.35190585]
bas 3, expnt(s) = [1597.78121674]
bas 4, expnt(s) = [382.84965246]
bas 5, expnt(s) = [108.4482688]
bas 6, expnt(s) = [36.72351757]
bas 7, expnt(s) = [9.07991912]
bas 8, expnt(s) = [4.11814376]
bas 9, expnt(s) = [0.79285294]
bas 10, expnt(s) = [1.31205112]
bas 11, expnt(s) = [0.24682751]
bas 12, expnt(s) = [1362.78353686]
bas 13, expnt(s) = [664.74241702]
bas 14, expnt(s) = [300.94660001]
bas 15, expnt(s) = [314.02900342]
bas 16, expnt(s) = [61.63178731]
bas 17, expnt(s) = [7.30912069]
bas 18, expnt(s) = [20.25127644]
bas 19, expnt(s) = [0.77360593]
bas 20, expnt(s) = [2.79072236]
bas 21, expnt(s) = [0.22202998]
CPU time:       141.19
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826568e+04 5.20026301e+03 7.61751978e+03 2.06003793e+03
 3.61735191e+03 1.17844168e+03 1.59778122e+03 6.38488395e+02
 3.82849652e+02 2.18668496e+02 1.08448269e+02 8.49047509e+01
 3.67235176e+01 3.76897476e+01 9.07991912e+00 1.32152843e+01
 4.11814376e+00 7.30367016e+00 7.92852940e-01 2.12280208e+00
 1.31205112e+00 3.09726305e+00 2.46827506e-01 8.84728854e-01
 1.36278354e+03 2.41556090e+04 6.64742417e+02 9.84693639e+03
 3.00946600e+02 3.65675778e+03 3.14029003e+02 3.85652893e+03
 6.16317873e+01 5.03779331e+02 7.30912069e+00 3.50603146e+01
 2.02512764e+01 1.25328515e+02 7.73605929e-01 2.11657728e+00
 2.79072236e+00 1.05227725e+01 2.22029980e-01 4.44630159e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993766474210695
cond(S) = 112106.13216327557
E1 = -729.5155456335824  E_coul = 203.16902659669012
init E= -526.346519036892
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555947826894424  LUMO = 0.966973728135093
  mo_energy =
[-1.18328954e+02 -1.22066347e+01 -9.44760460e+00 -9.44760460e+00
 -9.44760460e+00 -1.24024362e+00 -5.55947827e-01 -5.55947827e-01
 -5.55947827e-01  9.66973728e-01  1.02825981e+00  1.02825981e+00
  1.02825981e+00  5.34865250e+00  7.29777710e+00  7.29777710e+00
  7.29777710e+00  2.28213605e+01  3.33966628e+01  3.33966628e+01
  3.33966628e+01  1.22874248e+02  1.29032937e+02  1.29032937e+02
  1.29032937e+02  4.83476657e+02  4.83476657e+02  4.83476657e+02
  6.05552102e+02  1.33535799e+03  1.33535799e+03  1.33535799e+03
  2.67246164e+03  3.02963751e+03  3.02963751e+03  3.02963751e+03
  6.65017211e+03  6.65017211e+03  6.65017211e+03  9.07671725e+03
  2.54315304e+04  7.61729278e+04]
E1 = -727.8349934834445  E_coul = 201.09573918216472
cycle= 1 E= -526.73925430128  delta_E= -0.393  |g|= 0.186  |ddm|= 0.375
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544584
diis-c [-0.29657151  1.        ]
  HOMO = -0.59081504509286  LUMO = 0.943408100440846
  mo_energy =
[-1.18637891e+02 -1.23441359e+01 -9.59603280e+00 -9.59603280e+00
 -9.59603280e+00 -1.27968717e+00 -5.90815045e-01 -5.90815045e-01
 -5.90815045e-01  9.43408100e-01  1.00404612e+00  1.00404612e+00
  1.00404612e+00  5.28700040e+00  7.20743129e+00  7.20743129e+00
  7.20743129e+00  2.27005666e+01  3.32426145e+01  3.32426145e+01
  3.32426145e+01  1.22653286e+02  1.28803983e+02  1.28803983e+02
  1.28803983e+02  4.83169078e+02  4.83169078e+02  4.83169078e+02
  6.05207122e+02  1.33499385e+03  1.33499385e+03  1.33499385e+03
  2.67196217e+03  3.02920634e+03  3.02920634e+03  3.02920634e+03
  6.64962711e+03  6.64962711e+03  6.64962711e+03  9.07609672e+03
  2.54308156e+04  7.61721229e+04]
E1 = -728.410134217377  E_coul = 201.67015618301252
cycle= 2 E= -526.739978034365  delta_E= -0.000724  |g|= 0.0378  |ddm|= 0.0519
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0764567
diis-c [-0.00340367  0.08363359  0.91636641]
  HOMO = -0.581765153953421  LUMO = 0.950186950801126
  mo_energy =
[-1.18570023e+02 -1.23060479e+01 -9.55625617e+00 -9.55625617e+00
 -9.55625617e+00 -1.26884114e+00 -5.81765154e-01 -5.81765154e-01
 -5.81765154e-01  9.50186951e-01  1.01069483e+00  1.01069483e+00
  1.01069483e+00  5.30370507e+00  7.23107906e+00  7.23107906e+00
  7.23107906e+00  2.27334877e+01  3.32827296e+01  3.32827296e+01
  3.32827296e+01  1.22709044e+02  1.28860011e+02  1.28860011e+02
  1.28860011e+02  4.83236135e+02  4.83236135e+02  4.83236135e+02
  6.05276404e+02  1.33506497e+03  1.33506497e+03  1.33506497e+03
  2.67203659e+03  3.02927971e+03  3.02927971e+03  3.02927971e+03
  6.64970224e+03  6.64970224e+03  6.64970224e+03  9.07617267e+03
  2.54308921e+04  7.61721997e+04]
E1 = -728.2588277276832  E_coul = 201.51878994580025
cycle= 3 E= -526.740037781883  delta_E= -5.97e-05  |g|= 0.0063  |ddm|= 0.0166
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132547
diis-c [-7.16232549e-07 -1.28137709e-03  1.43159054e-01  8.58122323e-01]
  HOMO = -0.583268030317435  LUMO = 0.949140153935003
  mo_energy =
[-1.18580004e+02 -1.23118748e+01 -9.56243228e+00 -9.56243228e+00
 -9.56243228e+00 -1.27054047e+00 -5.83268030e-01 -5.83268030e-01
 -5.83268030e-01  9.49140154e-01  1.00961522e+00  1.00961522e+00
  1.00961522e+00  5.30105773e+00  7.22730017e+00  7.22730017e+00
  7.22730017e+00  2.27284041e+01  3.32765401e+01  3.32765401e+01
  3.32765401e+01  1.22700753e+02  1.28851639e+02  1.28851639e+02
  1.28851639e+02  4.83226270e+02  4.83226270e+02  4.83226270e+02
  6.05266206e+02  1.33505452e+03  1.33505452e+03  1.33505452e+03
  2.67202551e+03  3.02926887e+03  3.02926887e+03  3.02926887e+03
  6.64969101e+03  6.64969101e+03  6.64969101e+03  9.07616122e+03
  2.54308805e+04  7.61721879e+04]
E1 = -728.2817826180362  E_coul = 201.54174289491922
cycle= 4 E= -526.740039723117  delta_E= -1.94e-06  |g|= 9.72e-05  |ddm|= 0.0022
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00010864
diis-c [-5.93217364e-09  7.90020237e-05 -1.11732973e-02 -6.99297262e-02
  1.08102402e+00]
  HOMO = -0.583246756902268  LUMO = 0.949171474639449
  mo_energy =
[-1.18579944e+02 -1.23117974e+01 -9.56236746e+00 -9.56236746e+00
 -9.56236746e+00 -1.27049658e+00 -5.83246757e-01 -5.83246757e-01
 -5.83246757e-01  9.49171475e-01  1.00963302e+00  1.00963302e+00
  1.00963302e+00  5.30110709e+00  7.22734988e+00  7.22734988e+00
  7.22734988e+00  2.27284715e+01  3.32766025e+01  3.32766025e+01
  3.32766025e+01  1.22700821e+02  1.28851704e+02  1.28851704e+02
  1.28851704e+02  4.83226330e+02  4.83226330e+02  4.83226330e+02
  6.05266259e+02  1.33505457e+03  1.33505457e+03  1.33505457e+03
  2.67202554e+03  3.02926892e+03  3.02926892e+03  3.02926892e+03
  6.64969104e+03  6.64969104e+03  6.64969104e+03  9.07616124e+03
  2.54308805e+04  7.61721879e+04]
E1 = -728.2815197780292  E_coul = 201.54148005328986
cycle= 5 E= -526.740039724739  delta_E= -1.62e-09  |g|= 2.03e-05  |ddm|= 0.000243
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.85706e-05
diis-c [-9.47741022e-11  1.26142138e-05 -1.58369786e-03 -1.22192363e-02
  2.56817994e-02  9.88108521e-01]
  HOMO = -0.583254535158399  LUMO = 0.949167916497927
  mo_energy =
[-1.18579976e+02 -1.23118211e+01 -9.56239298e+00 -9.56239298e+00
 -9.56239298e+00 -1.27050309e+00 -5.83254535e-01 -5.83254535e-01
 -5.83254535e-01  9.49167916e-01  1.00962785e+00  1.00962785e+00
  1.00962785e+00  5.30109539e+00  7.22733254e+00  7.22733254e+00
  7.22733254e+00  2.27284504e+01  3.32765778e+01  3.32765778e+01
  3.32765778e+01  1.22700792e+02  1.28851675e+02  1.28851675e+02
  1.28851675e+02  4.83226298e+02  4.83226298e+02  4.83226298e+02
  6.05266227e+02  1.33505454e+03  1.33505454e+03  1.33505454e+03
  2.67202551e+03  3.02926888e+03  3.02926888e+03  3.02926888e+03
  6.64969100e+03  6.64969100e+03  6.64969100e+03  9.07616121e+03
  2.54308804e+04  7.61721879e+04]
E1 = -728.2816059231186  E_coul = 201.54156619832494
cycle= 6 E= -526.740039724794  delta_E= -5.43e-11  |g|= 1.65e-06  |ddm|= 2.81e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2816059231186  E_coul = 201.54156619832494
  HOMO = -0.583254323858065  LUMO = 0.949168350694873
  mo_energy =
[-1.18579975e+02 -1.23118202e+01 -9.56239215e+00 -9.56239215e+00
 -9.56239215e+00 -1.27050250e+00 -5.83254324e-01 -5.83254324e-01
 -5.83254324e-01  9.49168351e-01  1.00962805e+00  1.00962805e+00
  1.00962805e+00  5.30109595e+00  7.22733311e+00  7.22733311e+00
  7.22733311e+00  2.27284511e+01  3.32765786e+01  3.32765786e+01
  3.32765786e+01  1.22700793e+02  1.28851676e+02  1.28851676e+02
  1.28851676e+02  4.83226299e+02  4.83226299e+02  4.83226299e+02
  6.05266228e+02  1.33505454e+03  1.33505454e+03  1.33505454e+03
  2.67202551e+03  3.02926888e+03  3.02926888e+03  3.02926888e+03
  6.64969100e+03  6.64969100e+03  6.64969100e+03  9.07616121e+03
  2.54308804e+04  7.61721879e+04]
E1 = -728.2816023340795  E_coul = 201.5415626092845
Extra cycle  E= -526.740039724795  delta_E= -1.36e-12  |g|= 3.52e-07  |ddm|= 4.29e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826568e+04 7.61751978e+03 3.61735191e+03 1.59778122e+03
 3.82849652e+02 1.08448269e+02 3.67235176e+01 9.07991912e+00
 4.11814376e+00 7.92852940e-01 1.31205112e+00 2.46827506e-01
 1.36278354e+03 6.64742417e+02 3.00946600e+02 3.14029003e+02
 6.16317873e+01 7.30912069e+00 2.02512764e+01 7.73605929e-01
 2.79072236e+00 2.22029980e-01]
E = -526.740039724795
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:10 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6568429        1
[INPUT] 0    0    [1    /1   ]  7617.51977726        1
[INPUT] 0    0    [1    /1   ]  3617.35190585        1
[INPUT] 0    0    [1    /1   ]  1597.78121674        1
[INPUT] 0    0    [1    /1   ]  382.849652464        1
[INPUT] 0    0    [1    /1   ]  108.448268801        1
[INPUT] 0    0    [1    /1   ]  36.7235175702        1
[INPUT] 0    0    [1    /1   ]  9.07991912176        1
[INPUT] 0    0    [1    /1   ]  4.1181437581         1
[INPUT] 0    0    [1    /1   ]  0.7928529398         1
[INPUT] 0    0    [1    /1   ]  1.31205112283        1
[INPUT] 0    0    [1    /1   ]  0.246827506481       1
[INPUT] 1    0    [1    /1   ]  1362.78353686        1
[INPUT] 1    0    [1    /1   ]  664.74241702         1
[INPUT] 1    0    [1    /1   ]  300.946600014        1
[INPUT] 1    0    [1    /1   ]  314.02900342         1
[INPUT] 1    0    [1    /1   ]  61.6317873085        1
[INPUT] 1    0    [1    /1   ]  7.30912069019        1
[INPUT] 1    0    [1    /1   ]  20.2512764389        1
[INPUT] 1    0    [1    /1   ]  0.773605929064       1
[INPUT] 1    0    [1    /1   ]  2.79072235715        1
[INPUT] 1    0    [1    /1   ]  0.222029979931       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.656842862045, 1.0]], [0, [7617.51977726075, 1.0]], [0, [3617.3519058535294, 1.0]], [0, [1597.781216735763, 1.0]], [0, [382.84965246374327, 1.0]], [0, [108.44826880112531, 1.0]], [0, [36.723517570194886, 1.0]], [0, [9.079919121757403, 1.0]], [0, [4.11814375810302, 1.0]], [0, [0.7928529398004772, 1.0]], [0, [1.3120511228259053, 1.0]], [0, [0.24682750648063737, 1.0]], [1, [1362.7835368583285, 1.0]], [1, [664.7424170201779, 1.0]], [1, [300.94660001425416, 1.0]], [1, [314.02900341951715, 1.0]], [1, [61.63178730849576, 1.0]], [1, [7.309120690185619, 1.0]], [1, [20.251276438919824, 1.0]], [1, [0.7736059290640164, 1.0]], [1, [2.7907223571471618, 1.0]], [1, [0.22202997993060794, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65684286]
bas 1, expnt(s) = [7617.51977726]
bas 2, expnt(s) = [3617.35190585]
bas 3, expnt(s) = [1597.78121674]
bas 4, expnt(s) = [382.84965246]
bas 5, expnt(s) = [108.4482688]
bas 6, expnt(s) = [36.72351757]
bas 7, expnt(s) = [9.07991912]
bas 8, expnt(s) = [4.11814376]
bas 9, expnt(s) = [0.79285294]
bas 10, expnt(s) = [1.31205112]
bas 11, expnt(s) = [0.24682751]
bas 12, expnt(s) = [1362.78353686]
bas 13, expnt(s) = [664.74241702]
bas 14, expnt(s) = [300.94660001]
bas 15, expnt(s) = [314.02900342]
bas 16, expnt(s) = [61.63178731]
bas 17, expnt(s) = [7.30912069]
bas 18, expnt(s) = [20.25127644]
bas 19, expnt(s) = [0.77360593]
bas 20, expnt(s) = [2.79072236]
bas 21, expnt(s) = [0.22202998]
CPU time:       141.56
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826568e+04 5.20026301e+03 7.61751978e+03 2.06003793e+03
 3.61735191e+03 1.17844168e+03 1.59778122e+03 6.38488395e+02
 3.82849652e+02 2.18668496e+02 1.08448269e+02 8.49047509e+01
 3.67235176e+01 3.76897476e+01 9.07991912e+00 1.32152843e+01
 4.11814376e+00 7.30367016e+00 7.92852940e-01 2.12280208e+00
 1.31205112e+00 3.09726305e+00 2.46827506e-01 8.84728854e-01
 1.36278354e+03 2.41556090e+04 6.64742417e+02 9.84693639e+03
 3.00946600e+02 3.65675778e+03 3.14029003e+02 3.85652893e+03
 6.16317873e+01 5.03779331e+02 7.30912069e+00 3.50603146e+01
 2.02512764e+01 1.25328515e+02 7.73605929e-01 2.11657728e+00
 2.79072236e+00 1.05227725e+01 2.22029980e-01 4.44630159e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993766474210695
cond(S) = 112106.13216327557
E1 = -729.5155456335824  E_coul = 203.16902659669012
init E= -526.346519036892
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555947826894424  LUMO = 0.966973728135093
  mo_energy =
[-1.18328954e+02 -1.22066347e+01 -9.44760460e+00 -9.44760460e+00
 -9.44760460e+00 -1.24024362e+00 -5.55947827e-01 -5.55947827e-01
 -5.55947827e-01  9.66973728e-01  1.02825981e+00  1.02825981e+00
  1.02825981e+00  5.34865250e+00  7.29777710e+00  7.29777710e+00
  7.29777710e+00  2.28213605e+01  3.33966628e+01  3.33966628e+01
  3.33966628e+01  1.22874248e+02  1.29032937e+02  1.29032937e+02
  1.29032937e+02  4.83476657e+02  4.83476657e+02  4.83476657e+02
  6.05552102e+02  1.33535799e+03  1.33535799e+03  1.33535799e+03
  2.67246164e+03  3.02963751e+03  3.02963751e+03  3.02963751e+03
  6.65017211e+03  6.65017211e+03  6.65017211e+03  9.07671725e+03
  2.54315304e+04  7.61729278e+04]
E1 = -727.8349934834445  E_coul = 201.09573918216472
cycle= 1 E= -526.73925430128  delta_E= -0.393  |g|= 0.186  |ddm|= 0.375
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.544584
diis-c [-0.29657151  1.        ]
  HOMO = -0.59081504509286  LUMO = 0.943408100440846
  mo_energy =
[-1.18637891e+02 -1.23441359e+01 -9.59603280e+00 -9.59603280e+00
 -9.59603280e+00 -1.27968717e+00 -5.90815045e-01 -5.90815045e-01
 -5.90815045e-01  9.43408100e-01  1.00404612e+00  1.00404612e+00
  1.00404612e+00  5.28700040e+00  7.20743129e+00  7.20743129e+00
  7.20743129e+00  2.27005666e+01  3.32426145e+01  3.32426145e+01
  3.32426145e+01  1.22653286e+02  1.28803983e+02  1.28803983e+02
  1.28803983e+02  4.83169078e+02  4.83169078e+02  4.83169078e+02
  6.05207122e+02  1.33499385e+03  1.33499385e+03  1.33499385e+03
  2.67196217e+03  3.02920634e+03  3.02920634e+03  3.02920634e+03
  6.64962711e+03  6.64962711e+03  6.64962711e+03  9.07609672e+03
  2.54308156e+04  7.61721229e+04]
E1 = -728.410134217377  E_coul = 201.67015618301252
cycle= 2 E= -526.739978034365  delta_E= -0.000724  |g|= 0.0378  |ddm|= 0.0519
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0764567
diis-c [-0.00340367  0.08363359  0.91636641]
  HOMO = -0.581765153953421  LUMO = 0.950186950801126
  mo_energy =
[-1.18570023e+02 -1.23060479e+01 -9.55625617e+00 -9.55625617e+00
 -9.55625617e+00 -1.26884114e+00 -5.81765154e-01 -5.81765154e-01
 -5.81765154e-01  9.50186951e-01  1.01069483e+00  1.01069483e+00
  1.01069483e+00  5.30370507e+00  7.23107906e+00  7.23107906e+00
  7.23107906e+00  2.27334877e+01  3.32827296e+01  3.32827296e+01
  3.32827296e+01  1.22709044e+02  1.28860011e+02  1.28860011e+02
  1.28860011e+02  4.83236135e+02  4.83236135e+02  4.83236135e+02
  6.05276404e+02  1.33506497e+03  1.33506497e+03  1.33506497e+03
  2.67203659e+03  3.02927971e+03  3.02927971e+03  3.02927971e+03
  6.64970224e+03  6.64970224e+03  6.64970224e+03  9.07617267e+03
  2.54308921e+04  7.61721997e+04]
E1 = -728.2588277276832  E_coul = 201.51878994580025
cycle= 3 E= -526.740037781883  delta_E= -5.97e-05  |g|= 0.0063  |ddm|= 0.0166
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0132547
diis-c [-7.16232549e-07 -1.28137709e-03  1.43159054e-01  8.58122323e-01]
  HOMO = -0.583268030317435  LUMO = 0.949140153935003
  mo_energy =
[-1.18580004e+02 -1.23118748e+01 -9.56243228e+00 -9.56243228e+00
 -9.56243228e+00 -1.27054047e+00 -5.83268030e-01 -5.83268030e-01
 -5.83268030e-01  9.49140154e-01  1.00961522e+00  1.00961522e+00
  1.00961522e+00  5.30105773e+00  7.22730017e+00  7.22730017e+00
  7.22730017e+00  2.27284041e+01  3.32765401e+01  3.32765401e+01
  3.32765401e+01  1.22700753e+02  1.28851639e+02  1.28851639e+02
  1.28851639e+02  4.83226270e+02  4.83226270e+02  4.83226270e+02
  6.05266206e+02  1.33505452e+03  1.33505452e+03  1.33505452e+03
  2.67202551e+03  3.02926887e+03  3.02926887e+03  3.02926887e+03
  6.64969101e+03  6.64969101e+03  6.64969101e+03  9.07616122e+03
  2.54308805e+04  7.61721879e+04]
E1 = -728.2817826180362  E_coul = 201.54174289491922
cycle= 4 E= -526.740039723117  delta_E= -1.94e-06  |g|= 9.72e-05  |ddm|= 0.0022
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00010864
diis-c [-5.93217364e-09  7.90020237e-05 -1.11732973e-02 -6.99297262e-02
  1.08102402e+00]
  HOMO = -0.583246756902268  LUMO = 0.949171474639449
  mo_energy =
[-1.18579944e+02 -1.23117974e+01 -9.56236746e+00 -9.56236746e+00
 -9.56236746e+00 -1.27049658e+00 -5.83246757e-01 -5.83246757e-01
 -5.83246757e-01  9.49171475e-01  1.00963302e+00  1.00963302e+00
  1.00963302e+00  5.30110709e+00  7.22734988e+00  7.22734988e+00
  7.22734988e+00  2.27284715e+01  3.32766025e+01  3.32766025e+01
  3.32766025e+01  1.22700821e+02  1.28851704e+02  1.28851704e+02
  1.28851704e+02  4.83226330e+02  4.83226330e+02  4.83226330e+02
  6.05266259e+02  1.33505457e+03  1.33505457e+03  1.33505457e+03
  2.67202554e+03  3.02926892e+03  3.02926892e+03  3.02926892e+03
  6.64969104e+03  6.64969104e+03  6.64969104e+03  9.07616124e+03
  2.54308805e+04  7.61721879e+04]
E1 = -728.2815197780292  E_coul = 201.54148005328986
cycle= 5 E= -526.740039724739  delta_E= -1.62e-09  |g|= 2.03e-05  |ddm|= 0.000243
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.85706e-05
diis-c [-9.47741022e-11  1.26142138e-05 -1.58369786e-03 -1.22192363e-02
  2.56817994e-02  9.88108521e-01]
  HOMO = -0.583254535158399  LUMO = 0.949167916497927
  mo_energy =
[-1.18579976e+02 -1.23118211e+01 -9.56239298e+00 -9.56239298e+00
 -9.56239298e+00 -1.27050309e+00 -5.83254535e-01 -5.83254535e-01
 -5.83254535e-01  9.49167916e-01  1.00962785e+00  1.00962785e+00
  1.00962785e+00  5.30109539e+00  7.22733254e+00  7.22733254e+00
  7.22733254e+00  2.27284504e+01  3.32765778e+01  3.32765778e+01
  3.32765778e+01  1.22700792e+02  1.28851675e+02  1.28851675e+02
  1.28851675e+02  4.83226298e+02  4.83226298e+02  4.83226298e+02
  6.05266227e+02  1.33505454e+03  1.33505454e+03  1.33505454e+03
  2.67202551e+03  3.02926888e+03  3.02926888e+03  3.02926888e+03
  6.64969100e+03  6.64969100e+03  6.64969100e+03  9.07616121e+03
  2.54308804e+04  7.61721879e+04]
E1 = -728.2816059231186  E_coul = 201.54156619832494
cycle= 6 E= -526.740039724794  delta_E= -5.43e-11  |g|= 1.65e-06  |ddm|= 2.81e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2816059231186  E_coul = 201.54156619832494
  HOMO = -0.583254323858065  LUMO = 0.949168350694873
  mo_energy =
[-1.18579975e+02 -1.23118202e+01 -9.56239215e+00 -9.56239215e+00
 -9.56239215e+00 -1.27050250e+00 -5.83254324e-01 -5.83254324e-01
 -5.83254324e-01  9.49168351e-01  1.00962805e+00  1.00962805e+00
  1.00962805e+00  5.30109595e+00  7.22733311e+00  7.22733311e+00
  7.22733311e+00  2.27284511e+01  3.32765786e+01  3.32765786e+01
  3.32765786e+01  1.22700793e+02  1.28851676e+02  1.28851676e+02
  1.28851676e+02  4.83226299e+02  4.83226299e+02  4.83226299e+02
  6.05266228e+02  1.33505454e+03  1.33505454e+03  1.33505454e+03
  2.67202551e+03  3.02926888e+03  3.02926888e+03  3.02926888e+03
  6.64969100e+03  6.64969100e+03  6.64969100e+03  9.07616121e+03
  2.54308804e+04  7.61721879e+04]
E1 = -728.2816023340795  E_coul = 201.5415626092845
Extra cycle  E= -526.740039724795  delta_E= -1.36e-12  |g|= 3.52e-07  |ddm|= 4.29e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 112106.13216327557
E1 = -728.2816023340795  E_coul = 201.5415626092845
init E= -526.740039724795
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583254404454322  LUMO = 0.949168348754442
  mo_energy =
[-1.18579975e+02 -1.23118205e+01 -9.56239244e+00 -9.56239244e+00
 -9.56239244e+00 -1.27050253e+00 -5.83254404e-01 -5.83254404e-01
 -5.83254404e-01  9.49168349e-01  1.00962801e+00  1.00962801e+00
  1.00962801e+00  5.30109586e+00  7.22733293e+00  7.22733293e+00
  7.22733293e+00  2.27284509e+01  3.32765784e+01  3.32765784e+01
  3.32765784e+01  1.22700793e+02  1.28851676e+02  1.28851676e+02
  1.28851676e+02  4.83226299e+02  4.83226299e+02  4.83226299e+02
  6.05266228e+02  1.33505454e+03  1.33505454e+03  1.33505454e+03
  2.67202551e+03  3.02926888e+03  3.02926888e+03  3.02926888e+03
  6.64969100e+03  6.64969100e+03  6.64969100e+03  9.07616121e+03
  2.54308804e+04  7.61721879e+04]
E1 = -728.2816032597406  E_coul = 201.54156353494596
cycle= 1 E= -526.740039724795  delta_E= 4.55e-13  |g|= 8.73e-08  |ddm|= 7.94e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2816032597406  E_coul = 201.54156353494596
  HOMO = -0.583254389209943  LUMO = 0.949168371311264
  mo_energy =
[-1.18579975e+02 -1.23118204e+01 -9.56239237e+00 -9.56239237e+00
 -9.56239237e+00 -1.27050250e+00 -5.83254389e-01 -5.83254389e-01
 -5.83254389e-01  9.49168371e-01  1.00962802e+00  1.00962802e+00
  1.00962802e+00  5.30109589e+00  7.22733297e+00  7.22733297e+00
  7.22733297e+00  2.27284510e+01  3.32765784e+01  3.32765784e+01
  3.32765784e+01  1.22700793e+02  1.28851676e+02  1.28851676e+02
  1.28851676e+02  4.83226299e+02  4.83226299e+02  4.83226299e+02
  6.05266228e+02  1.33505454e+03  1.33505454e+03  1.33505454e+03
  2.67202551e+03  3.02926888e+03  3.02926888e+03  3.02926888e+03
  6.64969100e+03  6.64969100e+03  6.64969100e+03  9.07616121e+03
  2.54308804e+04  7.61721879e+04]
E1 = -728.2816029791601  E_coul = 201.54156325436483
Extra cycle  E= -526.740039724795  delta_E= -6.82e-13  |g|= 2.02e-08  |ddm|= 1.81e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826568e+04 7.61751978e+03 3.61735191e+03 1.59778122e+03
 3.82849652e+02 1.08448269e+02 3.67235176e+01 9.07991912e+00
 4.11814376e+00 7.92852940e-01 1.31205112e+00 2.46827506e-01
 1.36278354e+03 6.64742417e+02 3.00946600e+02 3.14029003e+02
 6.16317873e+01 7.30912069e+00 2.02512764e+01 7.73605929e-01
 2.79072236e+00 2.22029980e-01]
grad_E = [-1.49669702e-06  3.08339246e-06 -1.68504490e-06  6.04056957e-05
  2.67673968e-04 -2.73516983e-03  1.74946072e-03 -2.10174751e-03
  4.18824350e-03 -4.99041069e-04 -3.61050877e-03  2.74561162e-03
 -4.99258686e-07  5.11116694e-06  2.42475793e-05  2.09030627e-05
 -8.83922868e-05 -5.91036835e-04  4.82556971e-04  1.11230831e-03
 -7.68614885e-04 -3.77473377e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:15 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6570858        1
[INPUT] 0    0    [1    /1   ]  7617.519259          1
[INPUT] 0    0    [1    /1   ]  3617.35216691        1
[INPUT] 0    0    [1    /1   ]  1597.77061934        1
[INPUT] 0    0    [1    /1   ]  382.836582215        1
[INPUT] 0    0    [1    /1   ]  108.633505772        1
[INPUT] 0    0    [1    /1   ]  36.9723210068        1
[INPUT] 0    0    [1    /1   ]  9.43143153479        1
[INPUT] 0    0    [1    /1   ]  4.32277008434        1
[INPUT] 0    0    [1    /1   ]  0.735799136834       1
[INPUT] 0    0    [1    /1   ]  1.45412974692        1
[INPUT] 0    0    [1    /1   ]  0.242016111931       1
[INPUT] 1    0    [1    /1   ]  1362.78361876        1
[INPUT] 1    0    [1    /1   ]  664.741615077        1
[INPUT] 1    0    [1    /1   ]  300.942823409        1
[INPUT] 1    0    [1    /1   ]  314.025747193        1
[INPUT] 1    0    [1    /1   ]  61.6317046196        1
[INPUT] 1    0    [1    /1   ]  7.28244675063        1
[INPUT] 1    0    [1    /1   ]  20.2701855029        1
[INPUT] 1    0    [1    /1   ]  0.772021151015       1
[INPUT] 1    0    [1    /1   ]  2.77234537966        1
[INPUT] 1    0    [1    /1   ]  0.220360925139       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657085815175, 1.0]], [0, [7617.51925900307, 1.0]], [0, [3617.352166905672, 1.0]], [0, [1597.7706193442937, 1.0]], [0, [382.83658221548865, 1.0]], [0, [108.63350577153369, 1.0]], [0, [36.97232100675636, 1.0]], [0, [9.431431534786674, 1.0]], [0, [4.3227700843447066, 1.0]], [0, [0.735799136833601, 1.0]], [0, [1.45412974692187, 1.0]], [0, [0.2420161119314878, 1.0]], [1, [1362.783618761297, 1.0]], [1, [664.7416150774815, 1.0]], [1, [300.9428234089559, 1.0]], [1, [314.0257471930594, 1.0]], [1, [61.63170461956648, 1.0]], [1, [7.282446750625542, 1.0]], [1, [20.270185502892076, 1.0]], [1, [0.7720211510153432, 1.0]], [1, [2.7723453796633404, 1.0]], [1, [0.22036092513906239, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65708582]
bas 1, expnt(s) = [7617.519259]
bas 2, expnt(s) = [3617.35216691]
bas 3, expnt(s) = [1597.77061934]
bas 4, expnt(s) = [382.83658222]
bas 5, expnt(s) = [108.63350577]
bas 6, expnt(s) = [36.97232101]
bas 7, expnt(s) = [9.43143153]
bas 8, expnt(s) = [4.32277008]
bas 9, expnt(s) = [0.73579914]
bas 10, expnt(s) = [1.45412975]
bas 11, expnt(s) = [0.24201611]
bas 12, expnt(s) = [1362.78361876]
bas 13, expnt(s) = [664.74161508]
bas 14, expnt(s) = [300.94282341]
bas 15, expnt(s) = [314.02574719]
bas 16, expnt(s) = [61.63170462]
bas 17, expnt(s) = [7.28244675]
bas 18, expnt(s) = [20.2701855]
bas 19, expnt(s) = [0.77202115]
bas 20, expnt(s) = [2.77234538]
bas 21, expnt(s) = [0.22036093]
CPU time:       147.24
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826571e+04 5.20026305e+03 7.61751926e+03 2.06003783e+03
 3.61735217e+03 1.17844174e+03 1.59777062e+03 6.38485218e+02
 3.82836582e+02 2.18662897e+02 1.08633506e+02 8.50134949e+01
 3.69723210e+01 3.78810982e+01 9.43143153e+00 1.35971609e+01
 4.32277008e+00 7.57419753e+00 7.35799137e-01 2.00717149e+00
 1.45412975e+00 3.34554899e+00 2.42016112e-01 8.71762602e-01
 1.36278362e+03 2.41556108e+04 6.64741615e+02 9.84692154e+03
 3.00942823e+02 3.65670042e+03 3.14025747e+02 3.85647894e+03
 6.16317046e+01 5.03778486e+02 7.28244675e+00 3.49004510e+01
 2.02701855e+01 1.25474810e+02 7.72021151e-01 2.11115875e+00
 2.77234538e+00 1.04362280e+01 2.20360925e-01 4.40456097e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993948308082807
cond(S) = 111962.67450788176
E1 = -729.5162937121848  E_coul = 203.16914653051026
init E= -526.347147181675
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.556036290794928  LUMO = 0.938087873577045
  mo_energy =
[-1.18329110e+02 -1.22065438e+01 -9.44750440e+00 -9.44750440e+00
 -9.44750440e+00 -1.24033244e+00 -5.56036291e-01 -5.56036291e-01
 -5.56036291e-01  9.38087874e-01  1.02027428e+00  1.02027428e+00
  1.02027428e+00  5.50210593e+00  7.24623494e+00  7.24623494e+00
  7.24623494e+00  2.41416800e+01  3.32698383e+01  3.32698383e+01
  3.32698383e+01  1.25997254e+02  1.28922393e+02  1.28922393e+02
  1.28922393e+02  4.83401701e+02  4.83401701e+02  4.83401701e+02
  6.09390396e+02  1.33528816e+03  1.33528816e+03  1.33528816e+03
  2.67615403e+03  3.02956329e+03  3.02956329e+03  3.02956329e+03
  6.65009658e+03  6.65009658e+03  6.65009658e+03  9.08014113e+03
  2.54347686e+04  7.61759421e+04]
E1 = -727.8133875656049  E_coul = 201.07383763268473
cycle= 1 E= -526.73954993292  delta_E= -0.392  |g|= 0.187  |ddm|= 0.314
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.545479
diis-c [-0.29754748  1.        ]
  HOMO = -0.591683171280723  LUMO = 0.914076888571704
  mo_energy =
[-1.18639548e+02 -1.23456094e+01 -9.59747417e+00 -9.59747417e+00
 -9.59747417e+00 -1.28073684e+00 -5.91683171e-01 -5.91683171e-01
 -5.91683171e-01  9.14076889e-01  9.95611810e-01  9.95611810e-01
  9.95611810e-01  5.43705275e+00  7.15477190e+00  7.15477190e+00
  7.15477190e+00  2.40166625e+01  3.31143483e+01  3.31143483e+01
  3.31143483e+01  1.25774155e+02  1.28691839e+02  1.28691839e+02
  1.28691839e+02  4.83092594e+02  4.83092594e+02  4.83092594e+02
  6.09043938e+02  1.33492253e+03  1.33492253e+03  1.33492253e+03
  2.67565313e+03  3.02913063e+03  3.02913063e+03  3.02913063e+03
  6.64955009e+03  6.64955009e+03  6.64955009e+03  9.07951915e+03
  2.54340523e+04  7.61751357e+04]
E1 = -728.3966211467168  E_coul = 201.65633437554388
cycle= 2 E= -526.740286771173  delta_E= -0.000737  |g|= 0.0382  |ddm|= 0.0519
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0771109
diis-c [-0.00346661  0.08409981  0.91590019]
  HOMO = -0.582461926625682  LUMO = 0.920902437620682
  mo_energy =
[-1.18570990e+02 -1.23069913e+01 -9.55714883e+00 -9.55714883e+00
 -9.55714883e+00 -1.26970254e+00 -5.82461927e-01 -5.82461927e-01
 -5.82461927e-01  9.20902438e-01  1.00234487e+00  1.00234487e+00
  1.00234487e+00  5.45465476e+00  7.17871548e+00  7.17871548e+00
  7.17871548e+00  2.40507786e+01  3.31549890e+01  3.31549890e+01
  3.31549890e+01  1.25830627e+02  1.28748507e+02  1.28748507e+02
  1.28748507e+02  4.83160338e+02  4.83160338e+02  4.83160338e+02
  6.09113901e+02  1.33499436e+03  1.33499436e+03  1.33499436e+03
  2.67572828e+03  3.02920472e+03  3.02920472e+03  3.02920472e+03
  6.64962595e+03  6.64962595e+03  6.64962595e+03  9.07959583e+03
  2.54341296e+04  7.61752133e+04]
E1 = -728.2427250367896  E_coul = 201.502376792488
cycle= 3 E= -526.740348244302  delta_E= -6.15e-05  |g|= 0.00638  |ddm|= 0.0159
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0134092
diis-c [-7.03882950e-07 -1.28313185e-03  1.43593950e-01  8.57689182e-01]
  HOMO = -0.583990980280987  LUMO = 0.919843196054708
  mo_energy =
[-1.18581100e+02 -1.23129055e+01 -9.56341470e+00 -9.56341470e+00
 -9.56341470e+00 -1.27143668e+00 -5.83990980e-01 -5.83990980e-01
 -5.83990980e-01  9.19843196e-01  1.00125139e+00  1.00125139e+00
  1.00125139e+00  5.45186685e+00  7.17488819e+00  7.17488819e+00
  7.17488819e+00  2.40455102e+01  3.31487117e+01  3.31487117e+01
  3.31487117e+01  1.25822210e+02  1.28740020e+02  1.28740020e+02
  1.28740020e+02  4.83150345e+02  4.83150345e+02  4.83150345e+02
  6.09103574e+02  1.33498377e+03  1.33498377e+03  1.33498377e+03
  2.67571706e+03  3.02919375e+03  3.02919375e+03  3.02919375e+03
  6.64961458e+03  6.64961458e+03  6.64961458e+03  9.07958425e+03
  2.54341178e+04  7.61752014e+04]
E1 = -728.2661180266803  E_coul = 201.52576777585247
cycle= 4 E= -526.740350250828  delta_E= -2.01e-06  |g|= 9.27e-05  |ddm|= 0.00222
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000104685
diis-c [-5.57419322e-09  7.55804446e-05 -1.07407224e-02 -6.69678341e-02
  1.07763298e+00]
  HOMO = -0.583969846098992  LUMO = 0.919873085064098
  mo_energy =
[-1.18581041e+02 -1.23128293e+01 -9.56335068e+00 -9.56335068e+00
 -9.56335068e+00 -1.27139417e+00 -5.83969846e-01 -5.83969846e-01
 -5.83969846e-01  9.19873085e-01  1.00126882e+00  1.00126882e+00
  1.00126882e+00  5.45191660e+00  7.17493714e+00  7.17493714e+00
  7.17493714e+00  2.40455770e+01  3.31487732e+01  3.31487732e+01
  3.31487732e+01  1.25822276e+02  1.28740084e+02  1.28740084e+02
  1.28740084e+02  4.83150403e+02  4.83150403e+02  4.83150403e+02
  6.09103627e+02  1.33498382e+03  1.33498382e+03  1.33498382e+03
  2.67571709e+03  3.02919379e+03  3.02919379e+03  3.02919379e+03
  6.64961461e+03  6.64961461e+03  6.64961461e+03  9.07958427e+03
  2.54341178e+04  7.61752014e+04]
E1 = -728.2658575625435  E_coul = 201.5255073102766
cycle= 5 E= -526.740350252267  delta_E= -1.44e-09  |g|= 1.99e-05  |ddm|= 0.000178
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.77439e-05
diis-c [-8.84227885e-11  1.23283748e-05 -1.56062903e-03 -1.19621466e-02
  2.88461435e-02  9.84664304e-01]
  HOMO = -0.583977449887703  LUMO = 0.919869583047481
  mo_energy =
[-1.18581072e+02 -1.23128524e+01 -9.56337560e+00 -9.56337560e+00
 -9.56337560e+00 -1.27140059e+00 -5.83977450e-01 -5.83977450e-01
 -5.83977450e-01  9.19869583e-01  1.00126378e+00  1.00126378e+00
  1.00126378e+00  5.45190475e+00  7.17492024e+00  7.17492024e+00
  7.17492024e+00  2.40455560e+01  3.31487490e+01  3.31487490e+01
  3.31487490e+01  1.25822248e+02  1.28740056e+02  1.28740056e+02
  1.28740056e+02  4.83150373e+02  4.83150373e+02  4.83150373e+02
  6.09103595e+02  1.33498379e+03  1.33498379e+03  1.33498379e+03
  2.67571706e+03  3.02919375e+03  3.02919375e+03  3.02919375e+03
  6.64961458e+03  6.64961458e+03  6.64961458e+03  9.07958423e+03
  2.54341178e+04  7.61752013e+04]
E1 = -728.2659420070174  E_coul = 201.52559175469867
cycle= 6 E= -526.740350252319  delta_E= -5.18e-11  |g|= 1.64e-06  |ddm|= 2.15e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2659420070174  E_coul = 201.52559175469867
  HOMO = -0.583977273895396  LUMO = 0.919869992785842
  mo_energy =
[-1.18581071e+02 -1.23128516e+01 -9.56337489e+00 -9.56337489e+00
 -9.56337489e+00 -1.27140005e+00 -5.83977274e-01 -5.83977274e-01
 -5.83977274e-01  9.19869993e-01  1.00126395e+00  1.00126395e+00
  1.00126395e+00  5.45190527e+00  7.17492073e+00  7.17492073e+00
  7.17492073e+00  2.40455566e+01  3.31487498e+01  3.31487498e+01
  3.31487498e+01  1.25822249e+02  1.28740056e+02  1.28740056e+02
  1.28740056e+02  4.83150374e+02  4.83150374e+02  4.83150374e+02
  6.09103596e+02  1.33498379e+03  1.33498379e+03  1.33498379e+03
  2.67571706e+03  3.02919376e+03  3.02919376e+03  3.02919376e+03
  6.64961458e+03  6.64961458e+03  6.64961458e+03  9.07958423e+03
  2.54341178e+04  7.61752013e+04]
E1 = -728.2659387887401  E_coul = 201.52558853642043
Extra cycle  E= -526.74035025232  delta_E= -9.09e-13  |g|= 3.47e-07  |ddm|= 3.47e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826571e+04 7.61751926e+03 3.61735217e+03 1.59777062e+03
 3.82836582e+02 1.08633506e+02 3.69723210e+01 9.43143153e+00
 4.32277008e+00 7.35799137e-01 1.45412975e+00 2.42016112e-01
 1.36278362e+03 6.64741615e+02 3.00942823e+02 3.14025747e+02
 6.16317046e+01 7.28244675e+00 2.02701855e+01 7.72021151e-01
 2.77234538e+00 2.20360925e-01]
E = -526.7403502523197
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:15 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6570858        1
[INPUT] 0    0    [1    /1   ]  7617.519259          1
[INPUT] 0    0    [1    /1   ]  3617.35216691        1
[INPUT] 0    0    [1    /1   ]  1597.77061934        1
[INPUT] 0    0    [1    /1   ]  382.836582215        1
[INPUT] 0    0    [1    /1   ]  108.633505772        1
[INPUT] 0    0    [1    /1   ]  36.9723210068        1
[INPUT] 0    0    [1    /1   ]  9.43143153479        1
[INPUT] 0    0    [1    /1   ]  4.32277008434        1
[INPUT] 0    0    [1    /1   ]  0.735799136834       1
[INPUT] 0    0    [1    /1   ]  1.45412974692        1
[INPUT] 0    0    [1    /1   ]  0.242016111931       1
[INPUT] 1    0    [1    /1   ]  1362.78361876        1
[INPUT] 1    0    [1    /1   ]  664.741615077        1
[INPUT] 1    0    [1    /1   ]  300.942823409        1
[INPUT] 1    0    [1    /1   ]  314.025747193        1
[INPUT] 1    0    [1    /1   ]  61.6317046196        1
[INPUT] 1    0    [1    /1   ]  7.28244675063        1
[INPUT] 1    0    [1    /1   ]  20.2701855029        1
[INPUT] 1    0    [1    /1   ]  0.772021151015       1
[INPUT] 1    0    [1    /1   ]  2.77234537966        1
[INPUT] 1    0    [1    /1   ]  0.220360925139       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657085815175, 1.0]], [0, [7617.51925900307, 1.0]], [0, [3617.352166905672, 1.0]], [0, [1597.7706193442937, 1.0]], [0, [382.83658221548865, 1.0]], [0, [108.63350577153369, 1.0]], [0, [36.97232100675636, 1.0]], [0, [9.431431534786674, 1.0]], [0, [4.3227700843447066, 1.0]], [0, [0.735799136833601, 1.0]], [0, [1.45412974692187, 1.0]], [0, [0.2420161119314878, 1.0]], [1, [1362.783618761297, 1.0]], [1, [664.7416150774815, 1.0]], [1, [300.9428234089559, 1.0]], [1, [314.0257471930594, 1.0]], [1, [61.63170461956648, 1.0]], [1, [7.282446750625542, 1.0]], [1, [20.270185502892076, 1.0]], [1, [0.7720211510153432, 1.0]], [1, [2.7723453796633404, 1.0]], [1, [0.22036092513906239, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65708582]
bas 1, expnt(s) = [7617.519259]
bas 2, expnt(s) = [3617.35216691]
bas 3, expnt(s) = [1597.77061934]
bas 4, expnt(s) = [382.83658222]
bas 5, expnt(s) = [108.63350577]
bas 6, expnt(s) = [36.97232101]
bas 7, expnt(s) = [9.43143153]
bas 8, expnt(s) = [4.32277008]
bas 9, expnt(s) = [0.73579914]
bas 10, expnt(s) = [1.45412975]
bas 11, expnt(s) = [0.24201611]
bas 12, expnt(s) = [1362.78361876]
bas 13, expnt(s) = [664.74161508]
bas 14, expnt(s) = [300.94282341]
bas 15, expnt(s) = [314.02574719]
bas 16, expnt(s) = [61.63170462]
bas 17, expnt(s) = [7.28244675]
bas 18, expnt(s) = [20.2701855]
bas 19, expnt(s) = [0.77202115]
bas 20, expnt(s) = [2.77234538]
bas 21, expnt(s) = [0.22036093]
CPU time:       147.61
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826571e+04 5.20026305e+03 7.61751926e+03 2.06003783e+03
 3.61735217e+03 1.17844174e+03 1.59777062e+03 6.38485218e+02
 3.82836582e+02 2.18662897e+02 1.08633506e+02 8.50134949e+01
 3.69723210e+01 3.78810982e+01 9.43143153e+00 1.35971609e+01
 4.32277008e+00 7.57419753e+00 7.35799137e-01 2.00717149e+00
 1.45412975e+00 3.34554899e+00 2.42016112e-01 8.71762602e-01
 1.36278362e+03 2.41556108e+04 6.64741615e+02 9.84692154e+03
 3.00942823e+02 3.65670042e+03 3.14025747e+02 3.85647894e+03
 6.16317046e+01 5.03778486e+02 7.28244675e+00 3.49004510e+01
 2.02701855e+01 1.25474810e+02 7.72021151e-01 2.11115875e+00
 2.77234538e+00 1.04362280e+01 2.20360925e-01 4.40456097e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993948308082807
cond(S) = 111962.67450788176
E1 = -729.5162937121848  E_coul = 203.16914653051026
init E= -526.347147181675
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556036290794928  LUMO = 0.938087873577045
  mo_energy =
[-1.18329110e+02 -1.22065438e+01 -9.44750440e+00 -9.44750440e+00
 -9.44750440e+00 -1.24033244e+00 -5.56036291e-01 -5.56036291e-01
 -5.56036291e-01  9.38087874e-01  1.02027428e+00  1.02027428e+00
  1.02027428e+00  5.50210593e+00  7.24623494e+00  7.24623494e+00
  7.24623494e+00  2.41416800e+01  3.32698383e+01  3.32698383e+01
  3.32698383e+01  1.25997254e+02  1.28922393e+02  1.28922393e+02
  1.28922393e+02  4.83401701e+02  4.83401701e+02  4.83401701e+02
  6.09390396e+02  1.33528816e+03  1.33528816e+03  1.33528816e+03
  2.67615403e+03  3.02956329e+03  3.02956329e+03  3.02956329e+03
  6.65009658e+03  6.65009658e+03  6.65009658e+03  9.08014113e+03
  2.54347686e+04  7.61759421e+04]
E1 = -727.8133875656049  E_coul = 201.07383763268473
cycle= 1 E= -526.73954993292  delta_E= -0.392  |g|= 0.187  |ddm|= 0.314
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.545479
diis-c [-0.29754748  1.        ]
  HOMO = -0.591683171280723  LUMO = 0.914076888571704
  mo_energy =
[-1.18639548e+02 -1.23456094e+01 -9.59747417e+00 -9.59747417e+00
 -9.59747417e+00 -1.28073684e+00 -5.91683171e-01 -5.91683171e-01
 -5.91683171e-01  9.14076889e-01  9.95611810e-01  9.95611810e-01
  9.95611810e-01  5.43705275e+00  7.15477190e+00  7.15477190e+00
  7.15477190e+00  2.40166625e+01  3.31143483e+01  3.31143483e+01
  3.31143483e+01  1.25774155e+02  1.28691839e+02  1.28691839e+02
  1.28691839e+02  4.83092594e+02  4.83092594e+02  4.83092594e+02
  6.09043938e+02  1.33492253e+03  1.33492253e+03  1.33492253e+03
  2.67565313e+03  3.02913063e+03  3.02913063e+03  3.02913063e+03
  6.64955009e+03  6.64955009e+03  6.64955009e+03  9.07951915e+03
  2.54340523e+04  7.61751357e+04]
E1 = -728.3966211467168  E_coul = 201.65633437554388
cycle= 2 E= -526.740286771173  delta_E= -0.000737  |g|= 0.0382  |ddm|= 0.0519
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0771109
diis-c [-0.00346661  0.08409981  0.91590019]
  HOMO = -0.582461926625682  LUMO = 0.920902437620682
  mo_energy =
[-1.18570990e+02 -1.23069913e+01 -9.55714883e+00 -9.55714883e+00
 -9.55714883e+00 -1.26970254e+00 -5.82461927e-01 -5.82461927e-01
 -5.82461927e-01  9.20902438e-01  1.00234487e+00  1.00234487e+00
  1.00234487e+00  5.45465476e+00  7.17871548e+00  7.17871548e+00
  7.17871548e+00  2.40507786e+01  3.31549890e+01  3.31549890e+01
  3.31549890e+01  1.25830627e+02  1.28748507e+02  1.28748507e+02
  1.28748507e+02  4.83160338e+02  4.83160338e+02  4.83160338e+02
  6.09113901e+02  1.33499436e+03  1.33499436e+03  1.33499436e+03
  2.67572828e+03  3.02920472e+03  3.02920472e+03  3.02920472e+03
  6.64962595e+03  6.64962595e+03  6.64962595e+03  9.07959583e+03
  2.54341296e+04  7.61752133e+04]
E1 = -728.2427250367896  E_coul = 201.502376792488
cycle= 3 E= -526.740348244302  delta_E= -6.15e-05  |g|= 0.00638  |ddm|= 0.0159
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0134092
diis-c [-7.03882950e-07 -1.28313185e-03  1.43593950e-01  8.57689182e-01]
  HOMO = -0.583990980280987  LUMO = 0.919843196054708
  mo_energy =
[-1.18581100e+02 -1.23129055e+01 -9.56341470e+00 -9.56341470e+00
 -9.56341470e+00 -1.27143668e+00 -5.83990980e-01 -5.83990980e-01
 -5.83990980e-01  9.19843196e-01  1.00125139e+00  1.00125139e+00
  1.00125139e+00  5.45186685e+00  7.17488819e+00  7.17488819e+00
  7.17488819e+00  2.40455102e+01  3.31487117e+01  3.31487117e+01
  3.31487117e+01  1.25822210e+02  1.28740020e+02  1.28740020e+02
  1.28740020e+02  4.83150345e+02  4.83150345e+02  4.83150345e+02
  6.09103574e+02  1.33498377e+03  1.33498377e+03  1.33498377e+03
  2.67571706e+03  3.02919375e+03  3.02919375e+03  3.02919375e+03
  6.64961458e+03  6.64961458e+03  6.64961458e+03  9.07958425e+03
  2.54341178e+04  7.61752014e+04]
E1 = -728.2661180266803  E_coul = 201.52576777585247
cycle= 4 E= -526.740350250828  delta_E= -2.01e-06  |g|= 9.27e-05  |ddm|= 0.00222
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000104685
diis-c [-5.57419322e-09  7.55804446e-05 -1.07407224e-02 -6.69678341e-02
  1.07763298e+00]
  HOMO = -0.583969846098992  LUMO = 0.919873085064098
  mo_energy =
[-1.18581041e+02 -1.23128293e+01 -9.56335068e+00 -9.56335068e+00
 -9.56335068e+00 -1.27139417e+00 -5.83969846e-01 -5.83969846e-01
 -5.83969846e-01  9.19873085e-01  1.00126882e+00  1.00126882e+00
  1.00126882e+00  5.45191660e+00  7.17493714e+00  7.17493714e+00
  7.17493714e+00  2.40455770e+01  3.31487732e+01  3.31487732e+01
  3.31487732e+01  1.25822276e+02  1.28740084e+02  1.28740084e+02
  1.28740084e+02  4.83150403e+02  4.83150403e+02  4.83150403e+02
  6.09103627e+02  1.33498382e+03  1.33498382e+03  1.33498382e+03
  2.67571709e+03  3.02919379e+03  3.02919379e+03  3.02919379e+03
  6.64961461e+03  6.64961461e+03  6.64961461e+03  9.07958427e+03
  2.54341178e+04  7.61752014e+04]
E1 = -728.2658575625435  E_coul = 201.5255073102766
cycle= 5 E= -526.740350252267  delta_E= -1.44e-09  |g|= 1.99e-05  |ddm|= 0.000178
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.77439e-05
diis-c [-8.84227885e-11  1.23283748e-05 -1.56062903e-03 -1.19621466e-02
  2.88461435e-02  9.84664304e-01]
  HOMO = -0.583977449887703  LUMO = 0.919869583047481
  mo_energy =
[-1.18581072e+02 -1.23128524e+01 -9.56337560e+00 -9.56337560e+00
 -9.56337560e+00 -1.27140059e+00 -5.83977450e-01 -5.83977450e-01
 -5.83977450e-01  9.19869583e-01  1.00126378e+00  1.00126378e+00
  1.00126378e+00  5.45190475e+00  7.17492024e+00  7.17492024e+00
  7.17492024e+00  2.40455560e+01  3.31487490e+01  3.31487490e+01
  3.31487490e+01  1.25822248e+02  1.28740056e+02  1.28740056e+02
  1.28740056e+02  4.83150373e+02  4.83150373e+02  4.83150373e+02
  6.09103595e+02  1.33498379e+03  1.33498379e+03  1.33498379e+03
  2.67571706e+03  3.02919375e+03  3.02919375e+03  3.02919375e+03
  6.64961458e+03  6.64961458e+03  6.64961458e+03  9.07958423e+03
  2.54341178e+04  7.61752013e+04]
E1 = -728.2659420070174  E_coul = 201.52559175469867
cycle= 6 E= -526.740350252319  delta_E= -5.18e-11  |g|= 1.64e-06  |ddm|= 2.15e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2659420070174  E_coul = 201.52559175469867
  HOMO = -0.583977273895396  LUMO = 0.919869992785842
  mo_energy =
[-1.18581071e+02 -1.23128516e+01 -9.56337489e+00 -9.56337489e+00
 -9.56337489e+00 -1.27140005e+00 -5.83977274e-01 -5.83977274e-01
 -5.83977274e-01  9.19869993e-01  1.00126395e+00  1.00126395e+00
  1.00126395e+00  5.45190527e+00  7.17492073e+00  7.17492073e+00
  7.17492073e+00  2.40455566e+01  3.31487498e+01  3.31487498e+01
  3.31487498e+01  1.25822249e+02  1.28740056e+02  1.28740056e+02
  1.28740056e+02  4.83150374e+02  4.83150374e+02  4.83150374e+02
  6.09103596e+02  1.33498379e+03  1.33498379e+03  1.33498379e+03
  2.67571706e+03  3.02919376e+03  3.02919376e+03  3.02919376e+03
  6.64961458e+03  6.64961458e+03  6.64961458e+03  9.07958423e+03
  2.54341178e+04  7.61752013e+04]
E1 = -728.2659387887401  E_coul = 201.52558853642043
Extra cycle  E= -526.74035025232  delta_E= -9.09e-13  |g|= 3.47e-07  |ddm|= 3.47e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111962.67450788176
E1 = -728.2659387887401  E_coul = 201.52558853642043
init E= -526.74035025232
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583977348082017  LUMO = 0.919869996862195
  mo_energy =
[-1.18581071e+02 -1.23128519e+01 -9.56337515e+00 -9.56337515e+00
 -9.56337515e+00 -1.27140006e+00 -5.83977348e-01 -5.83977348e-01
 -5.83977348e-01  9.19869997e-01  1.00126391e+00  1.00126391e+00
  1.00126391e+00  5.45190518e+00  7.17492057e+00  7.17492057e+00
  7.17492057e+00  2.40455564e+01  3.31487495e+01  3.31487495e+01
  3.31487495e+01  1.25822249e+02  1.28740056e+02  1.28740056e+02
  1.28740056e+02  4.83150373e+02  4.83150373e+02  4.83150373e+02
  6.09103596e+02  1.33498379e+03  1.33498379e+03  1.33498379e+03
  2.67571706e+03  3.02919376e+03  3.02919376e+03  3.02919376e+03
  6.64961458e+03  6.64961458e+03  6.64961458e+03  9.07958423e+03
  2.54341178e+04  7.61752013e+04]
E1 = -728.2659396026324  E_coul = 201.52558935031425
cycle= 1 E= -526.740350252318  delta_E= 1.48e-12  |g|= 8.43e-08  |ddm|= 6.47e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2659396026324  E_coul = 201.52558935031425
  HOMO = -0.58397733501014  LUMO = 0.919870017986931
  mo_energy =
[-1.18581071e+02 -1.23128518e+01 -9.56337509e+00 -9.56337509e+00
 -9.56337509e+00 -1.27140004e+00 -5.83977335e-01 -5.83977335e-01
 -5.83977335e-01  9.19870018e-01  1.00126392e+00  1.00126392e+00
  1.00126392e+00  5.45190522e+00  7.17492061e+00  7.17492061e+00
  7.17492061e+00  2.40455565e+01  3.31487496e+01  3.31487496e+01
  3.31487496e+01  1.25822249e+02  1.28740056e+02  1.28740056e+02
  1.28740056e+02  4.83150374e+02  4.83150374e+02  4.83150374e+02
  6.09103596e+02  1.33498379e+03  1.33498379e+03  1.33498379e+03
  2.67571706e+03  3.02919376e+03  3.02919376e+03  3.02919376e+03
  6.64961458e+03  6.64961458e+03  6.64961458e+03  9.07958423e+03
  2.54341178e+04  7.61752013e+04]
E1 = -728.2659393505851  E_coul = 201.52558909826567
Extra cycle  E= -526.740350252319  delta_E= -1.25e-12  |g|= 1.91e-08  |ddm|= 1.47e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826571e+04 7.61751926e+03 3.61735217e+03 1.59777062e+03
 3.82836582e+02 1.08633506e+02 3.69723210e+01 9.43143153e+00
 4.32277008e+00 7.35799137e-01 1.45412975e+00 2.42016112e-01
 1.36278362e+03 6.64741615e+02 3.00942823e+02 3.14025747e+02
 6.16317046e+01 7.28244675e+00 2.02701855e+01 7.72021151e-01
 2.77234538e+00 2.20360925e-01]
grad_E = [-1.49733206e-06  3.08982084e-06 -1.68240714e-06  6.06275163e-05
  2.65006950e-04 -2.77159149e-03  1.83919715e-03 -1.95528659e-03
  5.20182094e-03 -3.18856283e-03 -5.50730969e-03  1.05844000e-02
 -4.88188235e-07  5.25967464e-06  2.51483425e-05  2.16768484e-05
 -1.88910031e-04 -2.24558936e-03  1.24151960e-03  1.10559783e-02
 -3.74579007e-04 -3.89421817e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:19 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6574103        1
[INPUT] 0    0    [1    /1   ]  7617.51856735        1
[INPUT] 0    0    [1    /1   ]  3617.35251599        1
[INPUT] 0    0    [1    /1   ]  1597.75649003        1
[INPUT] 0    0    [1    /1   ]  382.818167492        1
[INPUT] 0    0    [1    /1   ]  108.888877099        1
[INPUT] 0    0    [1    /1   ]  37.2886092748        1
[INPUT] 0    0    [1    /1   ]  9.9138501989         1
[INPUT] 0    0    [1    /1   ]  4.54680271516        1
[INPUT] 0    0    [1    /1   ]  0.661699872488       1
[INPUT] 0    0    [1    /1   ]  1.63321172699        1
[INPUT] 0    0    [1    /1   ]  0.231519221847       1
[INPUT] 1    0    [1    /1   ]  1362.78372817        1
[INPUT] 1    0    [1    /1   ]  664.740543537        1
[INPUT] 1    0    [1    /1   ]  300.937776914        1
[INPUT] 1    0    [1    /1   ]  314.021396061        1
[INPUT] 1    0    [1    /1   ]  61.6317289885        1
[INPUT] 1    0    [1    /1   ]  7.24859294659        1
[INPUT] 1    0    [1    /1   ]  20.2944257141        1
[INPUT] 1    0    [1    /1   ]  0.769582615417       1
[INPUT] 1    0    [1    /1   ]  2.74829443358        1
[INPUT] 1    0    [1    /1   ]  0.218602800883       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657410323332, 1.0]], [0, [7617.518567348352, 1.0]], [0, [3617.3525159942683, 1.0]], [0, [1597.7564900342095, 1.0]], [0, [382.81816749207155, 1.0]], [0, [108.88887709877916, 1.0]], [0, [37.28860927481561, 1.0]], [0, [9.913850198904502, 1.0]], [0, [4.54680271515926, 1.0]], [0, [0.6616998724875642, 1.0]], [0, [1.6332117269856443, 1.0]], [0, [0.23151922184738716, 1.0]], [1, [1362.783728165465, 1.0]], [1, [664.7405435365037, 1.0]], [1, [300.9377769140448, 1.0]], [1, [314.0213960614354, 1.0]], [1, [61.63172898852936, 1.0]], [1, [7.248592946588412, 1.0]], [1, [20.294425714118063, 1.0]], [1, [0.7695826154169977, 1.0]], [1, [2.7482944335823283, 1.0]], [1, [0.2186028008834485, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65741032]
bas 1, expnt(s) = [7617.51856735]
bas 2, expnt(s) = [3617.35251599]
bas 3, expnt(s) = [1597.75649003]
bas 4, expnt(s) = [382.81816749]
bas 5, expnt(s) = [108.8888771]
bas 6, expnt(s) = [37.28860927]
bas 7, expnt(s) = [9.9138502]
bas 8, expnt(s) = [4.54680272]
bas 9, expnt(s) = [0.66169987]
bas 10, expnt(s) = [1.63321173]
bas 11, expnt(s) = [0.23151922]
bas 12, expnt(s) = [1362.78372817]
bas 13, expnt(s) = [664.74054354]
bas 14, expnt(s) = [300.93777691]
bas 15, expnt(s) = [314.02139606]
bas 16, expnt(s) = [61.63172899]
bas 17, expnt(s) = [7.24859295]
bas 18, expnt(s) = [20.29442571]
bas 19, expnt(s) = [0.76958262]
bas 20, expnt(s) = [2.74829443]
bas 21, expnt(s) = [0.2186028]
CPU time:       153.30
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826574e+04 5.20026310e+03 7.61751857e+03 2.06003769e+03
 3.61735252e+03 1.17844183e+03 1.59775649e+03 6.38480984e+02
 3.82818167e+02 2.18655008e+02 1.08888877e+02 8.51633357e+01
 3.72886093e+01 3.81238861e+01 9.91385020e+00 1.41155170e+01
 4.54680272e+00 7.86673657e+00 6.61699872e-01 1.85357777e+00
 1.63321173e+00 3.65003384e+00 2.31519222e-01 8.43247990e-01
 1.36278373e+03 2.41556132e+04 6.64740544e+02 9.84690170e+03
 3.00937777e+02 3.65662377e+03 3.14021396e+02 3.85641215e+03
 6.16317290e+01 5.03778735e+02 7.24859295e+00 3.46977675e+01
 2.02944257e+01 1.25662400e+02 7.69582615e-01 2.10282656e+00
 2.74829443e+00 1.03231792e+01 2.18602801e-01 4.36067826e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99414918201066
cond(S) = 111677.9562933181
E1 = -729.5168406826909  E_coul = 203.1690303532889
init E= -526.347810329402
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556139416721364  LUMO = 0.870772237742266
  mo_energy =
[-1.18329307e+02 -1.22065979e+01 -9.44739804e+00 -9.44739804e+00
 -9.44739804e+00 -1.24038807e+00 -5.56139417e-01 -5.56139417e-01
 -5.56139417e-01  8.70772238e-01  1.01120681e+00  1.01120681e+00
  1.01120681e+00  5.62495532e+00  7.17938892e+00  7.17938892e+00
  7.17938892e+00  2.57435878e+01  3.31056963e+01  3.31056963e+01
  3.31056963e+01  1.28780134e+02  1.28780134e+02  1.28780134e+02
  1.29910813e+02  4.83305611e+02  4.83305611e+02  4.83305611e+02
  6.14301281e+02  1.33519838e+03  1.33519838e+03  1.33519838e+03
  2.68091086e+03  3.02946738e+03  3.02946738e+03  3.02946738e+03
  6.64999863e+03  6.64999863e+03  6.64999863e+03  9.08455653e+03
  2.54389451e+04  7.61798299e+04]
E1 = -727.7881802060585  E_coul = 201.0482267800499
cycle= 1 E= -526.739953426009  delta_E= -0.392  |g|= 0.187  |ddm|= 0.308
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.546982
diis-c [-0.29918953  1.        ]
  HOMO = -0.592583446571497  LUMO = 0.847152261508387
  mo_energy =
[-1.18641686e+02 -1.23474916e+01 -9.59924563e+00 -9.59924563e+00
 -9.59924563e+00 -1.28172119e+00 -5.92583447e-01 -5.92583447e-01
 -5.92583447e-01  8.47152262e-01  9.86120482e-01  9.86120482e-01
  9.86120482e-01  5.55606294e+00  7.08677496e+00  7.08677496e+00
  7.08677496e+00  2.56135306e+01  3.29484640e+01  3.29484640e+01
  3.29484640e+01  1.28547568e+02  1.28547568e+02  1.28547568e+02
  1.29684944e+02  4.82994517e+02  4.82994517e+02  4.82994517e+02
  6.13952903e+02  1.33483080e+03  1.33483080e+03  1.33483080e+03
  2.68040812e+03  3.02903277e+03  3.02903277e+03  3.02903277e+03
  6.64945020e+03  6.64945020e+03  6.64945020e+03  9.08393266e+03
  2.54382269e+04  7.61790216e+04]
E1 = -728.3807679479846  E_coul = 201.6400611215631
cycle= 2 E= -526.740706826422  delta_E= -0.000753  |g|= 0.0386  |ddm|= 0.0528
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0778643
diis-c [-0.00353933  0.08457402  0.91542598]
  HOMO = -0.583162037246393  LUMO = 0.85384036478869
  mo_energy =
[-1.18572310e+02 -1.23082608e+01 -9.55829195e+00 -9.55829195e+00
 -9.55829195e+00 -1.27046477e+00 -5.83162037e-01 -5.83162037e-01
 -5.83162037e-01  8.53840365e-01  9.92948857e-01  9.92948857e-01
  9.92948857e-01  5.57474789e+00  7.11104033e+00  7.11104033e+00
  7.11104033e+00  2.56490758e+01  3.29897088e+01  3.29897088e+01
  3.29897088e+01  1.28604987e+02  1.28604987e+02  1.28604987e+02
  1.29742274e+02  4.83063075e+02  4.83063075e+02  4.83063075e+02
  6.14023674e+02  1.33490347e+03  1.33490347e+03  1.33490347e+03
  2.68048411e+03  3.02910772e+03  3.02910772e+03  3.02910772e+03
  6.64952692e+03  6.64952692e+03  6.64952692e+03  9.08401020e+03
  2.54383050e+04  7.61791000e+04]
E1 = -728.2240005704105  E_coul = 201.4832302964089
cycle= 3 E= -526.740770274002  delta_E= -6.34e-05  |g|= 0.00648  |ddm|= 0.0158
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135921
diis-c [-7.10700218e-07 -1.29076091e-03  1.44100680e-01  8.57190081e-01]
  HOMO = -0.58471928477846  LUMO = 0.852802111141532
  mo_energy =
[-1.18582563e+02 -1.23142691e+01 -9.56465628e+00 -9.56465628e+00
 -9.56465628e+00 -1.27223320e+00 -5.84719285e-01 -5.84719285e-01
 -5.84719285e-01  8.52802111e-01  9.91841913e-01  9.91841913e-01
  9.91841913e-01  5.57179860e+00  7.10716482e+00  7.10716482e+00
  7.10716482e+00  2.56435930e+01  3.29833356e+01  3.29833356e+01
  3.29833356e+01  1.28596374e+02  1.28596374e+02  1.28596374e+02
  1.29733714e+02  4.83052939e+02  4.83052939e+02  4.83052939e+02
  6.14013204e+02  1.33489273e+03  1.33489273e+03  1.33489273e+03
  2.68047274e+03  3.02909659e+03  3.02909659e+03  3.02909659e+03
  6.64951539e+03  6.64951539e+03  6.64951539e+03  9.08399846e+03
  2.54382931e+04  7.61790879e+04]
E1 = -728.2478529216997  E_coul = 201.5070805690068
cycle= 4 E= -526.740772352693  delta_E= -2.08e-06  |g|= 9.04e-05  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000105228
diis-c [-5.33338238e-09  7.57702307e-05 -1.07315413e-02 -6.69118219e-02
  1.07756759e+00]
  HOMO = -0.584698912121043  LUMO = 0.852829981452301
  mo_energy =
[-1.18582508e+02 -1.23141958e+01 -9.56459536e+00 -9.56459536e+00
 -9.56459536e+00 -1.27219212e+00 -5.84698912e-01 -5.84698912e-01
 -5.84698912e-01  8.52829981e-01  9.91858583e-01  9.91858583e-01
  9.91858583e-01  5.57184841e+00  7.10721160e+00  7.10721160e+00
  7.10721160e+00  2.56436575e+01  3.29833940e+01  3.29833940e+01
  3.29833940e+01  1.28596434e+02  1.28596434e+02  1.28596434e+02
  1.29733776e+02  4.83052994e+02  4.83052994e+02  4.83052994e+02
  6.14013252e+02  1.33489278e+03  1.33489278e+03  1.33489278e+03
  2.68047277e+03  3.02909663e+03  3.02909663e+03  3.02909663e+03
  6.64951542e+03  6.64951542e+03  6.64951542e+03  9.08399848e+03
  2.54382931e+04  7.61790879e+04]
E1 = -728.2476007515704  E_coul = 201.50682839752483
cycle= 5 E= -526.740772354046  delta_E= -1.35e-09  |g|= 1.96e-05  |ddm|= 0.000149
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.71313e-05
diis-c [-8.51805864e-11  1.21945681e-05 -1.55080638e-03 -1.17985594e-02
  3.22322466e-02  9.81104925e-01]
  HOMO = -0.584706445824954  LUMO = 0.852826623333254
  mo_energy =
[-1.18582538e+02 -1.23142187e+01 -9.56461994e+00 -9.56461994e+00
 -9.56461994e+00 -1.27219851e+00 -5.84706446e-01 -5.84706446e-01
 -5.84706446e-01  8.52826623e-01  9.91853612e-01  9.91853612e-01
  9.91853612e-01  5.57183626e+00  7.10719498e+00  7.10719498e+00
  7.10719498e+00  2.56436363e+01  3.29833702e+01  3.29833702e+01
  3.29833702e+01  1.28596406e+02  1.28596406e+02  1.28596406e+02
  1.29733749e+02  4.83052964e+02  4.83052964e+02  4.83052964e+02
  6.14013221e+02  1.33489275e+03  1.33489275e+03  1.33489275e+03
  2.68047274e+03  3.02909660e+03  3.02909660e+03  3.02909660e+03
  6.64951539e+03  6.64951539e+03  6.64951539e+03  9.08399845e+03
  2.54382931e+04  7.61790879e+04]
E1 = -728.2476839480998  E_coul = 201.50691159400262
cycle= 6 E= -526.740772354097  delta_E= -5.16e-11  |g|= 1.67e-06  |ddm|= 1.88e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2476839480998  E_coul = 201.50691159400262
  HOMO = -0.584706301195788  LUMO = 0.852827006506171
  mo_energy =
[-1.18582538e+02 -1.23142180e+01 -9.56461931e+00 -9.56461931e+00
 -9.56461931e+00 -1.27219798e+00 -5.84706301e-01 -5.84706301e-01
 -5.84706301e-01  8.52827007e-01  9.91853765e-01  9.91853765e-01
  9.91853765e-01  5.57183675e+00  7.10719540e+00  7.10719540e+00
  7.10719540e+00  2.56436370e+01  3.29833708e+01  3.29833708e+01
  3.29833708e+01  1.28596407e+02  1.28596407e+02  1.28596407e+02
  1.29733749e+02  4.83052965e+02  4.83052965e+02  4.83052965e+02
  6.14013222e+02  1.33489275e+03  1.33489275e+03  1.33489275e+03
  2.68047274e+03  3.02909660e+03  3.02909660e+03  3.02909660e+03
  6.64951539e+03  6.64951539e+03  6.64951539e+03  9.08399845e+03
  2.54382931e+04  7.61790879e+04]
E1 = -728.2476809056491  E_coul = 201.50690855155185
Extra cycle  E= -526.740772354097  delta_E=    0  |g|= 3.54e-07  |ddm|= 3.18e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826574e+04 7.61751857e+03 3.61735252e+03 1.59775649e+03
 3.82818167e+02 1.08888877e+02 3.72886093e+01 9.91385020e+00
 4.54680272e+00 6.61699872e-01 1.63321173e+00 2.31519222e-01
 1.36278373e+03 6.64740544e+02 3.00937777e+02 3.14021396e+02
 6.16317290e+01 7.24859295e+00 2.02944257e+01 7.69582615e-01
 2.74829443e+00 2.18602801e-01]
E = -526.7407723540972
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:20 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6574103        1
[INPUT] 0    0    [1    /1   ]  7617.51856735        1
[INPUT] 0    0    [1    /1   ]  3617.35251599        1
[INPUT] 0    0    [1    /1   ]  1597.75649003        1
[INPUT] 0    0    [1    /1   ]  382.818167492        1
[INPUT] 0    0    [1    /1   ]  108.888877099        1
[INPUT] 0    0    [1    /1   ]  37.2886092748        1
[INPUT] 0    0    [1    /1   ]  9.9138501989         1
[INPUT] 0    0    [1    /1   ]  4.54680271516        1
[INPUT] 0    0    [1    /1   ]  0.661699872488       1
[INPUT] 0    0    [1    /1   ]  1.63321172699        1
[INPUT] 0    0    [1    /1   ]  0.231519221847       1
[INPUT] 1    0    [1    /1   ]  1362.78372817        1
[INPUT] 1    0    [1    /1   ]  664.740543537        1
[INPUT] 1    0    [1    /1   ]  300.937776914        1
[INPUT] 1    0    [1    /1   ]  314.021396061        1
[INPUT] 1    0    [1    /1   ]  61.6317289885        1
[INPUT] 1    0    [1    /1   ]  7.24859294659        1
[INPUT] 1    0    [1    /1   ]  20.2944257141        1
[INPUT] 1    0    [1    /1   ]  0.769582615417       1
[INPUT] 1    0    [1    /1   ]  2.74829443358        1
[INPUT] 1    0    [1    /1   ]  0.218602800883       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657410323332, 1.0]], [0, [7617.518567348352, 1.0]], [0, [3617.3525159942683, 1.0]], [0, [1597.7564900342095, 1.0]], [0, [382.81816749207155, 1.0]], [0, [108.88887709877916, 1.0]], [0, [37.28860927481561, 1.0]], [0, [9.913850198904502, 1.0]], [0, [4.54680271515926, 1.0]], [0, [0.6616998724875642, 1.0]], [0, [1.6332117269856443, 1.0]], [0, [0.23151922184738716, 1.0]], [1, [1362.783728165465, 1.0]], [1, [664.7405435365037, 1.0]], [1, [300.9377769140448, 1.0]], [1, [314.0213960614354, 1.0]], [1, [61.63172898852936, 1.0]], [1, [7.248592946588412, 1.0]], [1, [20.294425714118063, 1.0]], [1, [0.7695826154169977, 1.0]], [1, [2.7482944335823283, 1.0]], [1, [0.2186028008834485, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65741032]
bas 1, expnt(s) = [7617.51856735]
bas 2, expnt(s) = [3617.35251599]
bas 3, expnt(s) = [1597.75649003]
bas 4, expnt(s) = [382.81816749]
bas 5, expnt(s) = [108.8888771]
bas 6, expnt(s) = [37.28860927]
bas 7, expnt(s) = [9.9138502]
bas 8, expnt(s) = [4.54680272]
bas 9, expnt(s) = [0.66169987]
bas 10, expnt(s) = [1.63321173]
bas 11, expnt(s) = [0.23151922]
bas 12, expnt(s) = [1362.78372817]
bas 13, expnt(s) = [664.74054354]
bas 14, expnt(s) = [300.93777691]
bas 15, expnt(s) = [314.02139606]
bas 16, expnt(s) = [61.63172899]
bas 17, expnt(s) = [7.24859295]
bas 18, expnt(s) = [20.29442571]
bas 19, expnt(s) = [0.76958262]
bas 20, expnt(s) = [2.74829443]
bas 21, expnt(s) = [0.2186028]
CPU time:       153.66
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826574e+04 5.20026310e+03 7.61751857e+03 2.06003769e+03
 3.61735252e+03 1.17844183e+03 1.59775649e+03 6.38480984e+02
 3.82818167e+02 2.18655008e+02 1.08888877e+02 8.51633357e+01
 3.72886093e+01 3.81238861e+01 9.91385020e+00 1.41155170e+01
 4.54680272e+00 7.86673657e+00 6.61699872e-01 1.85357777e+00
 1.63321173e+00 3.65003384e+00 2.31519222e-01 8.43247990e-01
 1.36278373e+03 2.41556132e+04 6.64740544e+02 9.84690170e+03
 3.00937777e+02 3.65662377e+03 3.14021396e+02 3.85641215e+03
 6.16317290e+01 5.03778735e+02 7.24859295e+00 3.46977675e+01
 2.02944257e+01 1.25662400e+02 7.69582615e-01 2.10282656e+00
 2.74829443e+00 1.03231792e+01 2.18602801e-01 4.36067826e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99414918201066
cond(S) = 111677.9562933181
E1 = -729.5168406826909  E_coul = 203.1690303532889
init E= -526.347810329402
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556139416721364  LUMO = 0.870772237742266
  mo_energy =
[-1.18329307e+02 -1.22065979e+01 -9.44739804e+00 -9.44739804e+00
 -9.44739804e+00 -1.24038807e+00 -5.56139417e-01 -5.56139417e-01
 -5.56139417e-01  8.70772238e-01  1.01120681e+00  1.01120681e+00
  1.01120681e+00  5.62495532e+00  7.17938892e+00  7.17938892e+00
  7.17938892e+00  2.57435878e+01  3.31056963e+01  3.31056963e+01
  3.31056963e+01  1.28780134e+02  1.28780134e+02  1.28780134e+02
  1.29910813e+02  4.83305611e+02  4.83305611e+02  4.83305611e+02
  6.14301281e+02  1.33519838e+03  1.33519838e+03  1.33519838e+03
  2.68091086e+03  3.02946738e+03  3.02946738e+03  3.02946738e+03
  6.64999863e+03  6.64999863e+03  6.64999863e+03  9.08455653e+03
  2.54389451e+04  7.61798299e+04]
E1 = -727.7881802060585  E_coul = 201.0482267800499
cycle= 1 E= -526.739953426009  delta_E= -0.392  |g|= 0.187  |ddm|= 0.308
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.546982
diis-c [-0.29918953  1.        ]
  HOMO = -0.592583446571497  LUMO = 0.847152261508387
  mo_energy =
[-1.18641686e+02 -1.23474916e+01 -9.59924563e+00 -9.59924563e+00
 -9.59924563e+00 -1.28172119e+00 -5.92583447e-01 -5.92583447e-01
 -5.92583447e-01  8.47152262e-01  9.86120482e-01  9.86120482e-01
  9.86120482e-01  5.55606294e+00  7.08677496e+00  7.08677496e+00
  7.08677496e+00  2.56135306e+01  3.29484640e+01  3.29484640e+01
  3.29484640e+01  1.28547568e+02  1.28547568e+02  1.28547568e+02
  1.29684944e+02  4.82994517e+02  4.82994517e+02  4.82994517e+02
  6.13952903e+02  1.33483080e+03  1.33483080e+03  1.33483080e+03
  2.68040812e+03  3.02903277e+03  3.02903277e+03  3.02903277e+03
  6.64945020e+03  6.64945020e+03  6.64945020e+03  9.08393266e+03
  2.54382269e+04  7.61790216e+04]
E1 = -728.3807679479846  E_coul = 201.6400611215631
cycle= 2 E= -526.740706826422  delta_E= -0.000753  |g|= 0.0386  |ddm|= 0.0528
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0778643
diis-c [-0.00353933  0.08457402  0.91542598]
  HOMO = -0.583162037246393  LUMO = 0.85384036478869
  mo_energy =
[-1.18572310e+02 -1.23082608e+01 -9.55829195e+00 -9.55829195e+00
 -9.55829195e+00 -1.27046477e+00 -5.83162037e-01 -5.83162037e-01
 -5.83162037e-01  8.53840365e-01  9.92948857e-01  9.92948857e-01
  9.92948857e-01  5.57474789e+00  7.11104033e+00  7.11104033e+00
  7.11104033e+00  2.56490758e+01  3.29897088e+01  3.29897088e+01
  3.29897088e+01  1.28604987e+02  1.28604987e+02  1.28604987e+02
  1.29742274e+02  4.83063075e+02  4.83063075e+02  4.83063075e+02
  6.14023674e+02  1.33490347e+03  1.33490347e+03  1.33490347e+03
  2.68048411e+03  3.02910772e+03  3.02910772e+03  3.02910772e+03
  6.64952692e+03  6.64952692e+03  6.64952692e+03  9.08401020e+03
  2.54383050e+04  7.61791000e+04]
E1 = -728.2240005704105  E_coul = 201.4832302964089
cycle= 3 E= -526.740770274002  delta_E= -6.34e-05  |g|= 0.00648  |ddm|= 0.0158
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135921
diis-c [-7.10700218e-07 -1.29076091e-03  1.44100680e-01  8.57190081e-01]
  HOMO = -0.58471928477846  LUMO = 0.852802111141532
  mo_energy =
[-1.18582563e+02 -1.23142691e+01 -9.56465628e+00 -9.56465628e+00
 -9.56465628e+00 -1.27223320e+00 -5.84719285e-01 -5.84719285e-01
 -5.84719285e-01  8.52802111e-01  9.91841913e-01  9.91841913e-01
  9.91841913e-01  5.57179860e+00  7.10716482e+00  7.10716482e+00
  7.10716482e+00  2.56435930e+01  3.29833356e+01  3.29833356e+01
  3.29833356e+01  1.28596374e+02  1.28596374e+02  1.28596374e+02
  1.29733714e+02  4.83052939e+02  4.83052939e+02  4.83052939e+02
  6.14013204e+02  1.33489273e+03  1.33489273e+03  1.33489273e+03
  2.68047274e+03  3.02909659e+03  3.02909659e+03  3.02909659e+03
  6.64951539e+03  6.64951539e+03  6.64951539e+03  9.08399846e+03
  2.54382931e+04  7.61790879e+04]
E1 = -728.2478529216997  E_coul = 201.5070805690068
cycle= 4 E= -526.740772352693  delta_E= -2.08e-06  |g|= 9.04e-05  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000105228
diis-c [-5.33338238e-09  7.57702307e-05 -1.07315413e-02 -6.69118219e-02
  1.07756759e+00]
  HOMO = -0.584698912121043  LUMO = 0.852829981452301
  mo_energy =
[-1.18582508e+02 -1.23141958e+01 -9.56459536e+00 -9.56459536e+00
 -9.56459536e+00 -1.27219212e+00 -5.84698912e-01 -5.84698912e-01
 -5.84698912e-01  8.52829981e-01  9.91858583e-01  9.91858583e-01
  9.91858583e-01  5.57184841e+00  7.10721160e+00  7.10721160e+00
  7.10721160e+00  2.56436575e+01  3.29833940e+01  3.29833940e+01
  3.29833940e+01  1.28596434e+02  1.28596434e+02  1.28596434e+02
  1.29733776e+02  4.83052994e+02  4.83052994e+02  4.83052994e+02
  6.14013252e+02  1.33489278e+03  1.33489278e+03  1.33489278e+03
  2.68047277e+03  3.02909663e+03  3.02909663e+03  3.02909663e+03
  6.64951542e+03  6.64951542e+03  6.64951542e+03  9.08399848e+03
  2.54382931e+04  7.61790879e+04]
E1 = -728.2476007515704  E_coul = 201.50682839752483
cycle= 5 E= -526.740772354046  delta_E= -1.35e-09  |g|= 1.96e-05  |ddm|= 0.000149
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.71313e-05
diis-c [-8.51805864e-11  1.21945681e-05 -1.55080638e-03 -1.17985594e-02
  3.22322466e-02  9.81104925e-01]
  HOMO = -0.584706445824954  LUMO = 0.852826623333254
  mo_energy =
[-1.18582538e+02 -1.23142187e+01 -9.56461994e+00 -9.56461994e+00
 -9.56461994e+00 -1.27219851e+00 -5.84706446e-01 -5.84706446e-01
 -5.84706446e-01  8.52826623e-01  9.91853612e-01  9.91853612e-01
  9.91853612e-01  5.57183626e+00  7.10719498e+00  7.10719498e+00
  7.10719498e+00  2.56436363e+01  3.29833702e+01  3.29833702e+01
  3.29833702e+01  1.28596406e+02  1.28596406e+02  1.28596406e+02
  1.29733749e+02  4.83052964e+02  4.83052964e+02  4.83052964e+02
  6.14013221e+02  1.33489275e+03  1.33489275e+03  1.33489275e+03
  2.68047274e+03  3.02909660e+03  3.02909660e+03  3.02909660e+03
  6.64951539e+03  6.64951539e+03  6.64951539e+03  9.08399845e+03
  2.54382931e+04  7.61790879e+04]
E1 = -728.2476839480998  E_coul = 201.50691159400262
cycle= 6 E= -526.740772354097  delta_E= -5.16e-11  |g|= 1.67e-06  |ddm|= 1.88e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2476839480998  E_coul = 201.50691159400262
  HOMO = -0.584706301195788  LUMO = 0.852827006506171
  mo_energy =
[-1.18582538e+02 -1.23142180e+01 -9.56461931e+00 -9.56461931e+00
 -9.56461931e+00 -1.27219798e+00 -5.84706301e-01 -5.84706301e-01
 -5.84706301e-01  8.52827007e-01  9.91853765e-01  9.91853765e-01
  9.91853765e-01  5.57183675e+00  7.10719540e+00  7.10719540e+00
  7.10719540e+00  2.56436370e+01  3.29833708e+01  3.29833708e+01
  3.29833708e+01  1.28596407e+02  1.28596407e+02  1.28596407e+02
  1.29733749e+02  4.83052965e+02  4.83052965e+02  4.83052965e+02
  6.14013222e+02  1.33489275e+03  1.33489275e+03  1.33489275e+03
  2.68047274e+03  3.02909660e+03  3.02909660e+03  3.02909660e+03
  6.64951539e+03  6.64951539e+03  6.64951539e+03  9.08399845e+03
  2.54382931e+04  7.61790879e+04]
E1 = -728.2476809056491  E_coul = 201.50690855155185
Extra cycle  E= -526.740772354097  delta_E=    0  |g|= 3.54e-07  |ddm|= 3.18e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111677.9562933181
E1 = -728.2476809056491  E_coul = 201.50690855155185
init E= -526.740772354097
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.58470637374313  LUMO = 0.852827014512293
  mo_energy =
[-1.18582538e+02 -1.23142182e+01 -9.56461956e+00 -9.56461956e+00
 -9.56461956e+00 -1.27219800e+00 -5.84706374e-01 -5.84706374e-01
 -5.84706374e-01  8.52827015e-01  9.91853725e-01  9.91853725e-01
  9.91853725e-01  5.57183666e+00  7.10719525e+00  7.10719525e+00
  7.10719525e+00  2.56436368e+01  3.29833706e+01  3.29833706e+01
  3.29833706e+01  1.28596407e+02  1.28596407e+02  1.28596407e+02
  1.29733749e+02  4.83052964e+02  4.83052964e+02  4.83052964e+02
  6.14013222e+02  1.33489275e+03  1.33489275e+03  1.33489275e+03
  2.68047274e+03  3.02909660e+03  3.02909660e+03  3.02909660e+03
  6.64951539e+03  6.64951539e+03  6.64951539e+03  9.08399845e+03
  2.54382931e+04  7.61790879e+04]
E1 = -728.2476816464799  E_coul = 201.50690929238206
cycle= 1 E= -526.740772354098  delta_E= -6.82e-13  |g|= 8.45e-08  |ddm|= 6e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2476816464799  E_coul = 201.50690929238206
  HOMO = -0.58470636235307  LUMO = 0.852827034371428
  mo_energy =
[-1.18582538e+02 -1.23142181e+01 -9.56461951e+00 -9.56461951e+00
 -9.56461951e+00 -1.27219797e+00 -5.84706362e-01 -5.84706362e-01
 -5.84706362e-01  8.52827034e-01  9.91853735e-01  9.91853735e-01
  9.91853735e-01  5.57183670e+00  7.10719528e+00  7.10719528e+00
  7.10719528e+00  2.56436368e+01  3.29833706e+01  3.29833706e+01
  3.29833706e+01  1.28596407e+02  1.28596407e+02  1.28596407e+02
  1.29733749e+02  4.83052964e+02  4.83052964e+02  4.83052964e+02
  6.14013222e+02  1.33489275e+03  1.33489275e+03  1.33489275e+03
  2.68047274e+03  3.02909660e+03  3.02909660e+03  3.02909660e+03
  6.64951539e+03  6.64951539e+03  6.64951539e+03  9.08399845e+03
  2.54382931e+04  7.61790879e+04]
E1 = -728.2476814089309  E_coul = 201.50690905483296
Extra cycle  E= -526.740772354098  delta_E= -1.14e-13  |g|= 1.89e-08  |ddm|= 1.37e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.44 sec
exp = [2.61826574e+04 7.61751857e+03 3.61735252e+03 1.59775649e+03
 3.82818167e+02 1.08888877e+02 3.72886093e+01 9.91385020e+00
 4.54680272e+00 6.61699872e-01 1.63321173e+00 2.31519222e-01
 1.36278373e+03 6.64740544e+02 3.00937777e+02 3.14021396e+02
 6.16317290e+01 7.24859295e+00 2.02944257e+01 7.69582615e-01
 2.74829443e+00 2.18602801e-01]
grad_E = [-1.49851309e-06  3.10196176e-06 -1.67743010e-06  6.10627142e-05
  2.57122839e-04 -2.79423821e-03  1.95645810e-03 -1.57533965e-03
  5.36380724e-03 -9.27907286e-03 -6.95842529e-03  2.11363312e-02
 -4.73417396e-07  5.45231968e-06  2.63161695e-05  2.26809490e-05
 -3.16122713e-04 -4.31462864e-03  2.21254213e-03  2.02894351e-02
  3.16595005e-06 -7.17006222e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:24 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6576047        1
[INPUT] 0    0    [1    /1   ]  7617.51815429        1
[INPUT] 0    0    [1    /1   ]  3617.35272609        1
[INPUT] 0    0    [1    /1   ]  1597.7480839         1
[INPUT] 0    0    [1    /1   ]  382.804919158        1
[INPUT] 0    0    [1    /1   ]  109.060296396        1
[INPUT] 0    0    [1    /1   ]  37.4402883443        1
[INPUT] 0    0    [1    /1   ]  10.2218554098        1
[INPUT] 0    0    [1    /1   ]  4.59412365769        1
[INPUT] 0    0    [1    /1   ]  0.621949468933       1
[INPUT] 0    0    [1    /1   ]  1.71875531968        1
[INPUT] 0    0    [1    /1   ]  0.217505638511       1
[INPUT] 1    0    [1    /1   ]  1362.78379375        1
[INPUT] 1    0    [1    /1   ]  664.739900852        1
[INPUT] 1    0    [1    /1   ]  300.934749849        1
[INPUT] 1    0    [1    /1   ]  314.018786109        1
[INPUT] 1    0    [1    /1   ]  61.6318977797        1
[INPUT] 1    0    [1    /1   ]  7.23044142369        1
[INPUT] 1    0    [1    /1   ]  20.3077154343        1
[INPUT] 1    0    [1    /1   ]  0.767830082359       1
[INPUT] 1    0    [1    /1   ]  2.73500685386        1
[INPUT] 1    0    [1    /1   ]  0.217836343171       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657604744265, 1.0]], [0, [7617.518154292628, 1.0]], [0, [3617.3527260894475, 1.0]], [0, [1597.7480838983001, 1.0]], [0, [382.80491915801787, 1.0]], [0, [109.06029639648843, 1.0]], [0, [37.44028834425181, 1.0]], [0, [10.22185540975842, 1.0]], [0, [4.594123657694996, 1.0]], [0, [0.6219494689330408, 1.0]], [0, [1.7187553196842802, 1.0]], [0, [0.2175056385112776, 1.0]], [1, [1362.7837937470931, 1.0]], [1, [664.7399008524683, 1.0]], [1, [300.9347498494434, 1.0]], [1, [314.01878610896273, 1.0]], [1, [61.631897779689176, 1.0]], [1, [7.230441423691683, 1.0]], [1, [20.30771543429421, 1.0]], [1, [0.7678300823588017, 1.0]], [1, [2.7350068538621066, 1.0]], [1, [0.21783634317139458, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65760474]
bas 1, expnt(s) = [7617.51815429]
bas 2, expnt(s) = [3617.35272609]
bas 3, expnt(s) = [1597.7480839]
bas 4, expnt(s) = [382.80491916]
bas 5, expnt(s) = [109.0602964]
bas 6, expnt(s) = [37.44028834]
bas 7, expnt(s) = [10.22185541]
bas 8, expnt(s) = [4.59412366]
bas 9, expnt(s) = [0.62194947]
bas 10, expnt(s) = [1.71875532]
bas 11, expnt(s) = [0.21750564]
bas 12, expnt(s) = [1362.78379375]
bas 13, expnt(s) = [664.73990085]
bas 14, expnt(s) = [300.93474985]
bas 15, expnt(s) = [314.01878611]
bas 16, expnt(s) = [61.63189778]
bas 17, expnt(s) = [7.23044142]
bas 18, expnt(s) = [20.30771543]
bas 19, expnt(s) = [0.76783008]
bas 20, expnt(s) = [2.73500685]
bas 21, expnt(s) = [0.21783634]
CPU time:       159.31
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826576e+04 5.20026313e+03 7.61751815e+03 2.06003760e+03
 3.61735273e+03 1.17844188e+03 1.59774808e+03 6.38478464e+02
 3.82804919e+02 2.18649333e+02 1.09060296e+02 8.52638678e+01
 3.74402883e+01 3.82401346e+01 1.02218554e+01 1.44431634e+01
 4.59412366e+00 7.92806194e+00 6.21949469e-01 1.76942170e+00
 1.71875532e+00 3.79249979e+00 2.17505639e-01 8.04670193e-01
 1.36278379e+03 2.41556147e+04 6.64739901e+02 9.84688980e+03
 3.00934750e+02 3.65657779e+03 3.14018786e+02 3.85637209e+03
 6.16318978e+01 5.03780460e+02 7.23044142e+00 3.45891913e+01
 2.03077154e+01 1.25765270e+02 7.67830082e-01 2.09684243e+00
 2.73500685e+00 1.02608282e+01 2.17836343e-01 4.34157507e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99426209138153
cond(S) = 111369.68401265371
E1 = -729.5186531060656  E_coul = 203.16925011399928
init E= -526.349402992066
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556183796221056  LUMO = 0.802677217514445
  mo_energy =
[-1.18329389e+02 -1.22067665e+01 -9.44732789e+00 -9.44732789e+00
 -9.44732789e+00 -1.24043365e+00 -5.56183796e-01 -5.56183796e-01
 -5.56183796e-01  8.02677218e-01  1.00663945e+00  1.00663945e+00
  1.00663945e+00  5.59114309e+00  7.14189302e+00  7.14189302e+00
  7.14189302e+00  2.63877900e+01  3.30153723e+01  3.30153723e+01
  3.30153723e+01  1.28702702e+02  1.28702702e+02  1.28702702e+02
  1.31781091e+02  4.83253853e+02  4.83253853e+02  4.83253853e+02
  6.16802288e+02  1.33514956e+03  1.33514956e+03  1.33514956e+03
  2.68338749e+03  3.02941451e+03  3.02941451e+03  3.02941451e+03
  6.64994412e+03  6.64994412e+03  6.64994412e+03  9.08686230e+03
  2.54411265e+04  7.61818605e+04]
E1 = -727.7692620609399  E_coul = 201.02869443996934
cycle= 1 E= -526.740567620971  delta_E= -0.391  |g|= 0.188  |ddm|= 0.318
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.548299
diis-c [-0.30063206  1.        ]
  HOMO = -0.593256445951753  LUMO = 0.779973798581331
  mo_energy =
[-1.18643401e+02 -1.23490305e+01 -9.60064947e+00 -9.60064947e+00
 -9.60064947e+00 -1.28231898e+00 -5.93256446e-01 -5.93256446e-01
 -5.93256446e-01  7.79973799e-01  9.81209504e-01  9.81209504e-01
  9.81209504e-01  5.52035431e+00  7.04844308e+00  7.04844308e+00
  7.04844308e+00  2.62549040e+01  3.28567027e+01  3.28567027e+01
  3.28567027e+01  1.28468553e+02  1.28468553e+02  1.28468553e+02
  1.31553056e+02  4.82941056e+02  4.82941056e+02  4.82941056e+02
  6.16452291e+02  1.33478037e+03  1.33478037e+03  1.33478037e+03
  2.68288318e+03  3.02897828e+03  3.02897828e+03  3.02897828e+03
  6.64939407e+03  6.64939407e+03  6.64939407e+03  9.08623684e+03
  2.54404067e+04  7.61810505e+04]
E1 = -728.3671524817562  E_coul = 201.625818879829
cycle= 2 E= -526.741333601927  delta_E= -0.000766  |g|= 0.0389  |ddm|= 0.0531
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0784126
diis-c [-0.00358527  0.08499742  0.91500258]
  HOMO = -0.583743014918491  LUMO = 0.786400594940811
  mo_energy =
[-1.18573514e+02 -1.23094564e+01 -9.55934745e+00 -9.55934745e+00
 -9.55934745e+00 -1.27094143e+00 -5.83743015e-01 -5.83743015e-01
 -5.83743015e-01  7.86400595e-01  9.88081971e-01  9.88081971e-01
  9.88081971e-01  5.53950828e+00  7.07286818e+00  7.07286818e+00
  7.07286818e+00  2.62911742e+01  3.28982851e+01  3.28982851e+01
  3.28982851e+01  1.28526424e+02  1.28526424e+02  1.28526424e+02
  1.31610907e+02  4.83010121e+02  4.83010121e+02  4.83010121e+02
  6.16523572e+02  1.33485356e+03  1.33485356e+03  1.33485356e+03
  2.68295971e+03  3.02905376e+03  3.02905376e+03  3.02905376e+03
  6.64947133e+03  6.64947133e+03  6.64947133e+03  9.08631492e+03
  2.54404854e+04  7.61811295e+04]
E1 = -728.208655902302  E_coul = 201.46725757975364
cycle= 3 E= -526.741398322548  delta_E= -6.47e-05  |g|= 0.00653  |ddm|= 0.016
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136991
diis-c [-7.67827752e-07 -1.30100205e-03  1.44175403e-01  8.57125599e-01]
  HOMO = -0.585321125422189  LUMO = 0.785406412052351
  mo_energy =
[-1.18583845e+02 -1.23155175e+01 -9.56576887e+00 -9.56576887e+00
 -9.56576887e+00 -1.27272458e+00 -5.85321125e-01 -5.85321125e-01
 -5.85321125e-01  7.85406412e-01  9.86965181e-01  9.86965181e-01
  9.86965181e-01  5.53648623e+00  7.06896261e+00  7.06896261e+00
  7.06896261e+00  2.62855817e+01  3.28918563e+01  3.28918563e+01
  3.28918563e+01  1.28517741e+02  1.28517741e+02  1.28517741e+02
  1.31602266e+02  4.82999908e+02  4.82999908e+02  4.82999908e+02
  6.16513022e+02  1.33484274e+03  1.33484274e+03  1.33484274e+03
  2.68294825e+03  3.02904255e+03  3.02904255e+03  3.02904255e+03
  6.64945972e+03  6.64945972e+03  6.64945972e+03  9.08630310e+03
  2.54404733e+04  7.61811174e+04]
E1 = -728.2327350790123  E_coul = 201.49133463529674
cycle= 4 E= -526.741400443716  delta_E= -2.12e-06  |g|= 9.88e-05  |ddm|= 0.00228
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000114965
diis-c [-5.89226504e-09  8.40716476e-05 -1.17168118e-02 -7.31749833e-02
  1.08480772e+00]
  HOMO = -0.585302124431787  LUMO = 0.785434050992559
  mo_energy =
[-1.18583793e+02 -1.23154457e+01 -9.56571043e+00 -9.56571043e+00
 -9.56571043e+00 -1.27268241e+00 -5.85302124e-01 -5.85302124e-01
 -5.85302124e-01  7.85434051e-01  9.86981154e-01  9.86981154e-01
  9.86981154e-01  5.53653629e+00  7.06900750e+00  7.06900750e+00
  7.06900750e+00  2.62856448e+01  3.28919123e+01  3.28919123e+01
  3.28919123e+01  1.28517799e+02  1.28517799e+02  1.28517799e+02
  1.31602326e+02  4.82999960e+02  4.82999960e+02  4.82999960e+02
  6.16513066e+02  1.33484279e+03  1.33484279e+03  1.33484279e+03
  2.68294827e+03  3.02904258e+03  3.02904258e+03  3.02904258e+03
  6.64945974e+03  6.64945974e+03  6.64945974e+03  9.08630311e+03
  2.54404733e+04  7.61811174e+04]
E1 = -728.2324806526528  E_coul = 201.49108020718117
cycle= 5 E= -526.741400445472  delta_E= -1.76e-09  |g|= 2.05e-05  |ddm|= 0.000166
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.85241e-05
diis-c [-1.01495525e-10  1.26699206e-05 -1.59160473e-03 -1.20981818e-02
  2.58715817e-02  9.87805535e-01]
  HOMO = -0.585310120793623  LUMO = 0.785430806820967
  mo_energy =
[-1.18583825e+02 -1.23154697e+01 -9.56573621e+00 -9.56573621e+00
 -9.56573621e+00 -1.27268900e+00 -5.85310121e-01 -5.85310121e-01
 -5.85310121e-01  7.85430807e-01  9.86975911e-01  9.86975911e-01
  9.86975911e-01  5.53652339e+00  7.06899005e+00  7.06899005e+00
  7.06899005e+00  2.62856224e+01  3.28918873e+01  3.28918873e+01
  3.28918873e+01  1.28517769e+02  1.28517769e+02  1.28517769e+02
  1.31602297e+02  4.82999928e+02  4.82999928e+02  4.82999928e+02
  6.16513034e+02  1.33484275e+03  1.33484275e+03  1.33484275e+03
  2.68294824e+03  3.02904255e+03  3.02904255e+03  3.02904255e+03
  6.64945970e+03  6.64945970e+03  6.64945970e+03  9.08630307e+03
  2.54404733e+04  7.61811173e+04]
E1 = -728.2325670563048  E_coul = 201.49116661077488
cycle= 6 E= -526.74140044553  delta_E= -5.83e-11  |g|= 1.79e-06  |ddm|= 2.06e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2325670563048  E_coul = 201.49116661077488
  HOMO = -0.585309916404632  LUMO = 0.78543122798322
  mo_energy =
[-1.18583824e+02 -1.23154688e+01 -9.56573535e+00 -9.56573535e+00
 -9.56573535e+00 -1.27268839e+00 -5.85309916e-01 -5.85309916e-01
 -5.85309916e-01  7.85431228e-01  9.86976108e-01  9.86976108e-01
  9.86976108e-01  5.53652402e+00  7.06899063e+00  7.06899063e+00
  7.06899063e+00  2.62856233e+01  3.28918882e+01  3.28918882e+01
  3.28918882e+01  1.28517771e+02  1.28517771e+02  1.28517771e+02
  1.31602298e+02  4.82999929e+02  4.82999929e+02  4.82999929e+02
  6.16513035e+02  1.33484276e+03  1.33484276e+03  1.33484276e+03
  2.68294824e+03  3.02904255e+03  3.02904255e+03  3.02904255e+03
  6.64945971e+03  6.64945971e+03  6.64945971e+03  9.08630307e+03
  2.54404733e+04  7.61811173e+04]
E1 = -728.2325630217681  E_coul = 201.4911625762369
Extra cycle  E= -526.741400445531  delta_E= -1.25e-12  |g|= 3.92e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.26 sec
exp = [2.61826576e+04 7.61751815e+03 3.61735273e+03 1.59774808e+03
 3.82804919e+02 1.09060296e+02 3.74402883e+01 1.02218554e+01
 4.59412366e+00 6.21949469e-01 1.71875532e+00 2.17505639e-01
 1.36278379e+03 6.64739901e+02 3.00934750e+02 3.14018786e+02
 6.16318978e+01 7.23044142e+00 2.03077154e+01 7.67830082e-01
 2.73500685e+00 2.17836343e-01]
E = -526.7414004455312
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:25 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6576047        1
[INPUT] 0    0    [1    /1   ]  7617.51815429        1
[INPUT] 0    0    [1    /1   ]  3617.35272609        1
[INPUT] 0    0    [1    /1   ]  1597.7480839         1
[INPUT] 0    0    [1    /1   ]  382.804919158        1
[INPUT] 0    0    [1    /1   ]  109.060296396        1
[INPUT] 0    0    [1    /1   ]  37.4402883443        1
[INPUT] 0    0    [1    /1   ]  10.2218554098        1
[INPUT] 0    0    [1    /1   ]  4.59412365769        1
[INPUT] 0    0    [1    /1   ]  0.621949468933       1
[INPUT] 0    0    [1    /1   ]  1.71875531968        1
[INPUT] 0    0    [1    /1   ]  0.217505638511       1
[INPUT] 1    0    [1    /1   ]  1362.78379375        1
[INPUT] 1    0    [1    /1   ]  664.739900852        1
[INPUT] 1    0    [1    /1   ]  300.934749849        1
[INPUT] 1    0    [1    /1   ]  314.018786109        1
[INPUT] 1    0    [1    /1   ]  61.6318977797        1
[INPUT] 1    0    [1    /1   ]  7.23044142369        1
[INPUT] 1    0    [1    /1   ]  20.3077154343        1
[INPUT] 1    0    [1    /1   ]  0.767830082359       1
[INPUT] 1    0    [1    /1   ]  2.73500685386        1
[INPUT] 1    0    [1    /1   ]  0.217836343171       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657604744265, 1.0]], [0, [7617.518154292628, 1.0]], [0, [3617.3527260894475, 1.0]], [0, [1597.7480838983001, 1.0]], [0, [382.80491915801787, 1.0]], [0, [109.06029639648843, 1.0]], [0, [37.44028834425181, 1.0]], [0, [10.22185540975842, 1.0]], [0, [4.594123657694996, 1.0]], [0, [0.6219494689330408, 1.0]], [0, [1.7187553196842802, 1.0]], [0, [0.2175056385112776, 1.0]], [1, [1362.7837937470931, 1.0]], [1, [664.7399008524683, 1.0]], [1, [300.9347498494434, 1.0]], [1, [314.01878610896273, 1.0]], [1, [61.631897779689176, 1.0]], [1, [7.230441423691683, 1.0]], [1, [20.30771543429421, 1.0]], [1, [0.7678300823588017, 1.0]], [1, [2.7350068538621066, 1.0]], [1, [0.21783634317139458, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65760474]
bas 1, expnt(s) = [7617.51815429]
bas 2, expnt(s) = [3617.35272609]
bas 3, expnt(s) = [1597.7480839]
bas 4, expnt(s) = [382.80491916]
bas 5, expnt(s) = [109.0602964]
bas 6, expnt(s) = [37.44028834]
bas 7, expnt(s) = [10.22185541]
bas 8, expnt(s) = [4.59412366]
bas 9, expnt(s) = [0.62194947]
bas 10, expnt(s) = [1.71875532]
bas 11, expnt(s) = [0.21750564]
bas 12, expnt(s) = [1362.78379375]
bas 13, expnt(s) = [664.73990085]
bas 14, expnt(s) = [300.93474985]
bas 15, expnt(s) = [314.01878611]
bas 16, expnt(s) = [61.63189778]
bas 17, expnt(s) = [7.23044142]
bas 18, expnt(s) = [20.30771543]
bas 19, expnt(s) = [0.76783008]
bas 20, expnt(s) = [2.73500685]
bas 21, expnt(s) = [0.21783634]
CPU time:       159.68
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826576e+04 5.20026313e+03 7.61751815e+03 2.06003760e+03
 3.61735273e+03 1.17844188e+03 1.59774808e+03 6.38478464e+02
 3.82804919e+02 2.18649333e+02 1.09060296e+02 8.52638678e+01
 3.74402883e+01 3.82401346e+01 1.02218554e+01 1.44431634e+01
 4.59412366e+00 7.92806194e+00 6.21949469e-01 1.76942170e+00
 1.71875532e+00 3.79249979e+00 2.17505639e-01 8.04670193e-01
 1.36278379e+03 2.41556147e+04 6.64739901e+02 9.84688980e+03
 3.00934750e+02 3.65657779e+03 3.14018786e+02 3.85637209e+03
 6.16318978e+01 5.03780460e+02 7.23044142e+00 3.45891913e+01
 2.03077154e+01 1.25765270e+02 7.67830082e-01 2.09684243e+00
 2.73500685e+00 1.02608282e+01 2.17836343e-01 4.34157507e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99426209138153
cond(S) = 111369.68401265371
E1 = -729.5186531060656  E_coul = 203.16925011399928
init E= -526.349402992066
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556183796221056  LUMO = 0.802677217514445
  mo_energy =
[-1.18329389e+02 -1.22067665e+01 -9.44732789e+00 -9.44732789e+00
 -9.44732789e+00 -1.24043365e+00 -5.56183796e-01 -5.56183796e-01
 -5.56183796e-01  8.02677218e-01  1.00663945e+00  1.00663945e+00
  1.00663945e+00  5.59114309e+00  7.14189302e+00  7.14189302e+00
  7.14189302e+00  2.63877900e+01  3.30153723e+01  3.30153723e+01
  3.30153723e+01  1.28702702e+02  1.28702702e+02  1.28702702e+02
  1.31781091e+02  4.83253853e+02  4.83253853e+02  4.83253853e+02
  6.16802288e+02  1.33514956e+03  1.33514956e+03  1.33514956e+03
  2.68338749e+03  3.02941451e+03  3.02941451e+03  3.02941451e+03
  6.64994412e+03  6.64994412e+03  6.64994412e+03  9.08686230e+03
  2.54411265e+04  7.61818605e+04]
E1 = -727.7692620609399  E_coul = 201.02869443996934
cycle= 1 E= -526.740567620971  delta_E= -0.391  |g|= 0.188  |ddm|= 0.318
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.548299
diis-c [-0.30063206  1.        ]
  HOMO = -0.593256445951753  LUMO = 0.779973798581331
  mo_energy =
[-1.18643401e+02 -1.23490305e+01 -9.60064947e+00 -9.60064947e+00
 -9.60064947e+00 -1.28231898e+00 -5.93256446e-01 -5.93256446e-01
 -5.93256446e-01  7.79973799e-01  9.81209504e-01  9.81209504e-01
  9.81209504e-01  5.52035431e+00  7.04844308e+00  7.04844308e+00
  7.04844308e+00  2.62549040e+01  3.28567027e+01  3.28567027e+01
  3.28567027e+01  1.28468553e+02  1.28468553e+02  1.28468553e+02
  1.31553056e+02  4.82941056e+02  4.82941056e+02  4.82941056e+02
  6.16452291e+02  1.33478037e+03  1.33478037e+03  1.33478037e+03
  2.68288318e+03  3.02897828e+03  3.02897828e+03  3.02897828e+03
  6.64939407e+03  6.64939407e+03  6.64939407e+03  9.08623684e+03
  2.54404067e+04  7.61810505e+04]
E1 = -728.3671524817562  E_coul = 201.625818879829
cycle= 2 E= -526.741333601927  delta_E= -0.000766  |g|= 0.0389  |ddm|= 0.0531
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0784126
diis-c [-0.00358527  0.08499742  0.91500258]
  HOMO = -0.583743014918491  LUMO = 0.786400594940811
  mo_energy =
[-1.18573514e+02 -1.23094564e+01 -9.55934745e+00 -9.55934745e+00
 -9.55934745e+00 -1.27094143e+00 -5.83743015e-01 -5.83743015e-01
 -5.83743015e-01  7.86400595e-01  9.88081971e-01  9.88081971e-01
  9.88081971e-01  5.53950828e+00  7.07286818e+00  7.07286818e+00
  7.07286818e+00  2.62911742e+01  3.28982851e+01  3.28982851e+01
  3.28982851e+01  1.28526424e+02  1.28526424e+02  1.28526424e+02
  1.31610907e+02  4.83010121e+02  4.83010121e+02  4.83010121e+02
  6.16523572e+02  1.33485356e+03  1.33485356e+03  1.33485356e+03
  2.68295971e+03  3.02905376e+03  3.02905376e+03  3.02905376e+03
  6.64947133e+03  6.64947133e+03  6.64947133e+03  9.08631492e+03
  2.54404854e+04  7.61811295e+04]
E1 = -728.208655902302  E_coul = 201.46725757975364
cycle= 3 E= -526.741398322548  delta_E= -6.47e-05  |g|= 0.00653  |ddm|= 0.016
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136991
diis-c [-7.67827752e-07 -1.30100205e-03  1.44175403e-01  8.57125599e-01]
  HOMO = -0.585321125422189  LUMO = 0.785406412052351
  mo_energy =
[-1.18583845e+02 -1.23155175e+01 -9.56576887e+00 -9.56576887e+00
 -9.56576887e+00 -1.27272458e+00 -5.85321125e-01 -5.85321125e-01
 -5.85321125e-01  7.85406412e-01  9.86965181e-01  9.86965181e-01
  9.86965181e-01  5.53648623e+00  7.06896261e+00  7.06896261e+00
  7.06896261e+00  2.62855817e+01  3.28918563e+01  3.28918563e+01
  3.28918563e+01  1.28517741e+02  1.28517741e+02  1.28517741e+02
  1.31602266e+02  4.82999908e+02  4.82999908e+02  4.82999908e+02
  6.16513022e+02  1.33484274e+03  1.33484274e+03  1.33484274e+03
  2.68294825e+03  3.02904255e+03  3.02904255e+03  3.02904255e+03
  6.64945972e+03  6.64945972e+03  6.64945972e+03  9.08630310e+03
  2.54404733e+04  7.61811174e+04]
E1 = -728.2327350790123  E_coul = 201.49133463529674
cycle= 4 E= -526.741400443716  delta_E= -2.12e-06  |g|= 9.88e-05  |ddm|= 0.00228
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000114965
diis-c [-5.89226504e-09  8.40716476e-05 -1.17168118e-02 -7.31749833e-02
  1.08480772e+00]
  HOMO = -0.585302124431787  LUMO = 0.785434050992559
  mo_energy =
[-1.18583793e+02 -1.23154457e+01 -9.56571043e+00 -9.56571043e+00
 -9.56571043e+00 -1.27268241e+00 -5.85302124e-01 -5.85302124e-01
 -5.85302124e-01  7.85434051e-01  9.86981154e-01  9.86981154e-01
  9.86981154e-01  5.53653629e+00  7.06900750e+00  7.06900750e+00
  7.06900750e+00  2.62856448e+01  3.28919123e+01  3.28919123e+01
  3.28919123e+01  1.28517799e+02  1.28517799e+02  1.28517799e+02
  1.31602326e+02  4.82999960e+02  4.82999960e+02  4.82999960e+02
  6.16513066e+02  1.33484279e+03  1.33484279e+03  1.33484279e+03
  2.68294827e+03  3.02904258e+03  3.02904258e+03  3.02904258e+03
  6.64945974e+03  6.64945974e+03  6.64945974e+03  9.08630311e+03
  2.54404733e+04  7.61811174e+04]
E1 = -728.2324806526528  E_coul = 201.49108020718117
cycle= 5 E= -526.741400445472  delta_E= -1.76e-09  |g|= 2.05e-05  |ddm|= 0.000166
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.85241e-05
diis-c [-1.01495525e-10  1.26699206e-05 -1.59160473e-03 -1.20981818e-02
  2.58715817e-02  9.87805535e-01]
  HOMO = -0.585310120793623  LUMO = 0.785430806820967
  mo_energy =
[-1.18583825e+02 -1.23154697e+01 -9.56573621e+00 -9.56573621e+00
 -9.56573621e+00 -1.27268900e+00 -5.85310121e-01 -5.85310121e-01
 -5.85310121e-01  7.85430807e-01  9.86975911e-01  9.86975911e-01
  9.86975911e-01  5.53652339e+00  7.06899005e+00  7.06899005e+00
  7.06899005e+00  2.62856224e+01  3.28918873e+01  3.28918873e+01
  3.28918873e+01  1.28517769e+02  1.28517769e+02  1.28517769e+02
  1.31602297e+02  4.82999928e+02  4.82999928e+02  4.82999928e+02
  6.16513034e+02  1.33484275e+03  1.33484275e+03  1.33484275e+03
  2.68294824e+03  3.02904255e+03  3.02904255e+03  3.02904255e+03
  6.64945970e+03  6.64945970e+03  6.64945970e+03  9.08630307e+03
  2.54404733e+04  7.61811173e+04]
E1 = -728.2325670563048  E_coul = 201.49116661077488
cycle= 6 E= -526.74140044553  delta_E= -5.83e-11  |g|= 1.79e-06  |ddm|= 2.06e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2325670563048  E_coul = 201.49116661077488
  HOMO = -0.585309916404632  LUMO = 0.78543122798322
  mo_energy =
[-1.18583824e+02 -1.23154688e+01 -9.56573535e+00 -9.56573535e+00
 -9.56573535e+00 -1.27268839e+00 -5.85309916e-01 -5.85309916e-01
 -5.85309916e-01  7.85431228e-01  9.86976108e-01  9.86976108e-01
  9.86976108e-01  5.53652402e+00  7.06899063e+00  7.06899063e+00
  7.06899063e+00  2.62856233e+01  3.28918882e+01  3.28918882e+01
  3.28918882e+01  1.28517771e+02  1.28517771e+02  1.28517771e+02
  1.31602298e+02  4.82999929e+02  4.82999929e+02  4.82999929e+02
  6.16513035e+02  1.33484276e+03  1.33484276e+03  1.33484276e+03
  2.68294824e+03  3.02904255e+03  3.02904255e+03  3.02904255e+03
  6.64945971e+03  6.64945971e+03  6.64945971e+03  9.08630307e+03
  2.54404733e+04  7.61811173e+04]
E1 = -728.2325630217681  E_coul = 201.4911625762369
Extra cycle  E= -526.741400445531  delta_E= -1.25e-12  |g|= 3.92e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111369.68401265371
E1 = -728.2325630217681  E_coul = 201.4911625762369
init E= -526.741400445531
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.585310010505648  LUMO = 0.785431225541048
  mo_energy =
[-1.18583824e+02 -1.23154690e+01 -9.56573567e+00 -9.56573567e+00
 -9.56573567e+00 -1.27268842e+00 -5.85310011e-01 -5.85310011e-01
 -5.85310011e-01  7.85431226e-01  9.86976052e-01  9.86976052e-01
  9.86976052e-01  5.53652390e+00  7.06899043e+00  7.06899043e+00
  7.06899043e+00  2.62856230e+01  3.28918879e+01  3.28918879e+01
  3.28918879e+01  1.28517770e+02  1.28517770e+02  1.28517770e+02
  1.31602298e+02  4.82999929e+02  4.82999929e+02  4.82999929e+02
  6.16513035e+02  1.33484276e+03  1.33484276e+03  1.33484276e+03
  2.68294824e+03  3.02904255e+03  3.02904255e+03  3.02904255e+03
  6.64945971e+03  6.64945971e+03  6.64945971e+03  9.08630307e+03
  2.54404733e+04  7.61811173e+04]
E1 = -728.2325640186683  E_coul = 201.49116357313537
cycle= 1 E= -526.741400445533  delta_E= -1.71e-12  |g|= 9.81e-08  |ddm|= 6.12e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2325640186683  E_coul = 201.49116357313537
  HOMO = -0.585309994706006  LUMO = 0.785431248276708
  mo_energy =
[-1.18583824e+02 -1.23154690e+01 -9.56573560e+00 -9.56573560e+00
 -9.56573560e+00 -1.27268838e+00 -5.85309995e-01 -5.85309995e-01
 -5.85309995e-01  7.85431248e-01  9.86976066e-01  9.86976066e-01
  9.86976066e-01  5.53652394e+00  7.06899047e+00  7.06899047e+00
  7.06899047e+00  2.62856231e+01  3.28918880e+01  3.28918880e+01
  3.28918880e+01  1.28517770e+02  1.28517770e+02  1.28517770e+02
  1.31602298e+02  4.82999929e+02  4.82999929e+02  4.82999929e+02
  6.16513035e+02  1.33484276e+03  1.33484276e+03  1.33484276e+03
  2.68294824e+03  3.02904255e+03  3.02904255e+03  3.02904255e+03
  6.64945971e+03  6.64945971e+03  6.64945971e+03  9.08630307e+03
  2.54404733e+04  7.61811173e+04]
E1 = -728.2325637011162  E_coul = 201.49116325558472
Extra cycle  E= -526.741400445531  delta_E= 1.48e-12  |g|= 2.3e-08  |ddm|= 1.45e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826576e+04 7.61751815e+03 3.61735273e+03 1.59774808e+03
 3.82804919e+02 1.09060296e+02 3.74402883e+01 1.02218554e+01
 4.59412366e+00 6.21949469e-01 1.71875532e+00 2.17505639e-01
 1.36278379e+03 6.64739901e+02 3.00934750e+02 3.14018786e+02
 6.16318978e+01 7.23044142e+00 2.03077154e+01 7.67830082e-01
 2.73500685e+00 2.17836343e-01]
grad_E = [-1.49983665e-06  3.11566576e-06 -1.67192943e-06  6.15720812e-05
  2.45055855e-04 -2.77471622e-03  2.05248980e-03 -1.10480678e-03
  3.70691139e-03 -8.56930662e-03 -5.66736221e-03  8.82569499e-03
 -4.65143928e-07  5.55773140e-06  2.69547763e-05  2.32304550e-05
 -3.84042901e-04 -5.37434862e-03  2.73289247e-03  2.24647712e-02
  1.34730412e-04 -8.00490906e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:29 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6576913        1
[INPUT] 0    0    [1    /1   ]  7617.51797342        1
[INPUT] 0    0    [1    /1   ]  3617.35282181        1
[INPUT] 0    0    [1    /1   ]  1597.74447601        1
[INPUT] 0    0    [1    /1   ]  382.793955263        1
[INPUT] 0    0    [1    /1   ]  109.178927041        1
[INPUT] 0    0    [1    /1   ]  37.4197144637        1
[INPUT] 0    0    [1    /1   ]  10.384600399         1
[INPUT] 0    0    [1    /1   ]  4.45846059805        1
[INPUT] 0    0    [1    /1   ]  0.608941078164       1
[INPUT] 0    0    [1    /1   ]  1.71223061032        1
[INPUT] 0    0    [1    /1   ]  0.203369144243       1
[INPUT] 1    0    [1    /1   ]  1362.78382303        1
[INPUT] 1    0    [1    /1   ]  664.739613124        1
[INPUT] 1    0    [1    /1   ]  300.933393988        1
[INPUT] 1    0    [1    /1   ]  314.017617095        1
[INPUT] 1    0    [1    /1   ]  61.6323059576        1
[INPUT] 1    0    [1    /1   ]  7.22788239024        1
[INPUT] 1    0    [1    /1   ]  20.3108388457        1
[INPUT] 1    0    [1    /1   ]  0.766293379933       1
[INPUT] 1    0    [1    /1   ]  2.73007934351        1
[INPUT] 1    0    [1    /1   ]  0.219221110179       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657691312943, 1.0]], [0, [7617.517973418543, 1.0]], [0, [3617.352821811012, 1.0]], [0, [1597.7444760130236, 1.0]], [0, [382.7939552634057, 1.0]], [0, [109.1789270406667, 1.0]], [0, [37.41971446366042, 1.0]], [0, [10.384600398977378, 1.0]], [0, [4.458460598047995, 1.0]], [0, [0.6089410781635959, 1.0]], [0, [1.7122306103238283, 1.0]], [0, [0.2033691442430028, 1.0]], [1, [1362.7838230288105, 1.0]], [1, [664.7396131242485, 1.0]], [1, [300.93339398759656, 1.0]], [1, [314.01761709529416, 1.0]], [1, [61.63230595755055, 1.0]], [1, [7.227882390238899, 1.0]], [1, [20.31083884574978, 1.0]], [1, [0.766293379932761, 1.0]], [1, [2.730079343505455, 1.0]], [1, [0.2192211101787799, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65769131]
bas 1, expnt(s) = [7617.51797342]
bas 2, expnt(s) = [3617.35282181]
bas 3, expnt(s) = [1597.74447601]
bas 4, expnt(s) = [382.79395526]
bas 5, expnt(s) = [109.17892704]
bas 6, expnt(s) = [37.41971446]
bas 7, expnt(s) = [10.3846004]
bas 8, expnt(s) = [4.4584606]
bas 9, expnt(s) = [0.60894108]
bas 10, expnt(s) = [1.71223061]
bas 11, expnt(s) = [0.20336914]
bas 12, expnt(s) = [1362.78382303]
bas 13, expnt(s) = [664.73961312]
bas 14, expnt(s) = [300.93339399]
bas 15, expnt(s) = [314.0176171]
bas 16, expnt(s) = [61.63230596]
bas 17, expnt(s) = [7.22788239]
bas 18, expnt(s) = [20.31083885]
bas 19, expnt(s) = [0.76629338]
bas 20, expnt(s) = [2.73007934]
bas 21, expnt(s) = [0.21922111]
CPU time:       165.40
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826577e+04 5.20026314e+03 7.61751797e+03 2.06003757e+03
 3.61735282e+03 1.17844190e+03 1.59774448e+03 6.38477383e+02
 3.82793955e+02 2.18644636e+02 1.09178927e+02 8.53334178e+01
 3.74197145e+01 3.82243735e+01 1.03846004e+01 1.46152876e+01
 4.45846060e+00 7.75182079e+00 6.08941078e-01 1.74159223e+00
 1.71223061e+00 3.78169689e+00 2.03369144e-01 7.65118706e-01
 1.36278382e+03 2.41556153e+04 6.64739613e+02 9.84688447e+03
 3.00933394e+02 3.65655720e+03 3.14017617e+02 3.85635414e+03
 6.16323060e+01 5.03784630e+02 7.22788239e+00 3.45738895e+01
 2.03108388e+01 1.25789450e+02 7.66293380e-01 2.09159808e+00
 2.73007934e+00 1.02377255e+01 2.19221110e-01 4.37610122e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994168236564057
cond(S) = 111017.97064275786
E1 = -729.5222207287827  E_coul = 203.1712155229801
init E= -526.351005205803
    CPU time for initialize scf      0.08 sec, wall time      0.05 sec
  HOMO = -0.556063310447815  LUMO = 0.748671632713956
  mo_energy =
[-1.18329368e+02 -1.22068078e+01 -9.44725248e+00 -9.44725248e+00
 -9.44725248e+00 -1.24029730e+00 -5.56063310e-01 -5.56063310e-01
 -5.56063310e-01  7.48671633e-01  1.01075292e+00  1.01075292e+00
  1.01075292e+00  5.41106447e+00  7.13240414e+00  7.13240414e+00
  7.13240414e+00  2.60639883e+01  3.29925120e+01  3.29925120e+01
  3.29925120e+01  1.28685047e+02  1.28685047e+02  1.28685047e+02
  1.31688976e+02  4.83243179e+02  4.83243179e+02  4.83243179e+02
  6.17017239e+02  1.33513842e+03  1.33513842e+03  1.33513842e+03
  2.68372013e+03  3.02940072e+03  3.02940072e+03  3.02940072e+03
  6.64992872e+03  6.64992872e+03  6.64992872e+03  9.08718650e+03
  2.54414336e+04  7.61821462e+04]
E1 = -727.7854118007238  E_coul = 201.04421516532275
cycle= 1 E= -526.741196635401  delta_E= -0.39  |g|= 0.188  |ddm|= 0.336
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.548662
diis-c [-0.30103022  1.        ]
  HOMO = -0.592686642892244  LUMO = 0.72764730252893
  mo_energy =
[-1.18642463e+02 -1.23480644e+01 -9.59967527e+00 -9.59967527e+00
 -9.59967527e+00 -1.28140134e+00 -5.92686643e-01 -5.92686643e-01
 -5.92686643e-01  7.27647303e-01  9.85660024e-01  9.85660024e-01
  9.85660024e-01  5.34181801e+00  7.04010705e+00  7.04010705e+00
  7.04010705e+00  2.59321722e+01  3.28346395e+01  3.28346395e+01
  3.28346395e+01  1.28451869e+02  1.28451869e+02  1.28451869e+02
  1.31461428e+02  4.82931182e+02  4.82931182e+02  4.82931182e+02
  6.16668173e+02  1.33477019e+03  1.33477019e+03  1.33477019e+03
  2.68321684e+03  3.02896550e+03  3.02896550e+03  3.02896550e+03
  6.64937973e+03  6.64937973e+03  6.64937973e+03  9.08656212e+03
  2.54407150e+04  7.61813373e+04]
E1 = -728.3757195488535  E_coul = 201.63376586729538
cycle= 2 E= -526.741953681558  delta_E= -0.000757  |g|= 0.0386  |ddm|= 0.0525
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0780006
diis-c [-0.00355328  0.08444738  0.91555262]
  HOMO = -0.583357766385344  LUMO = 0.733676957672557
  mo_energy =
[-1.18573136e+02 -1.23089785e+01 -9.55888084e+00 -9.55888084e+00
 -9.55888084e+00 -1.27020428e+00 -5.83357766e-01 -5.83357766e-01
 -5.83357766e-01  7.33676958e-01  9.92414754e-01  9.92414754e-01
  9.92414754e-01  5.36046158e+00  7.06413819e+00  7.06413819e+00
  7.06413819e+00  2.59679833e+01  3.28757278e+01  3.28757278e+01
  3.28757278e+01  1.28509208e+02  1.28509208e+02  1.28509208e+02
  1.31518778e+02  4.82999688e+02  4.82999688e+02  4.82999688e+02
  6.16738896e+02  1.33484282e+03  1.33484282e+03  1.33484282e+03
  2.68329279e+03  3.02904040e+03  3.02904040e+03  3.02904040e+03
  6.64945640e+03  6.64945640e+03  6.64945640e+03  9.08663961e+03
  2.54407930e+04  7.61814157e+04]
E1 = -728.2191234790527  E_coul = 201.47710645148902
cycle= 3 E= -526.742017027564  delta_E= -6.33e-05  |g|= 0.00647  |ddm|= 0.0159
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136133
diis-c [-8.71734255e-07 -1.30850998e-03  1.43957258e-01  8.57351251e-01]
  HOMO = -0.584929710266422  LUMO = 0.73274651607573
  mo_energy =
[-1.18583393e+02 -1.23149910e+01 -9.56525476e+00 -9.56525476e+00
 -9.56525476e+00 -1.27196093e+00 -5.84929710e-01 -5.84929710e-01
 -5.84929710e-01  7.32746516e-01  9.91303831e-01  9.91303831e-01
  9.91303831e-01  5.35749615e+00  7.06026521e+00  7.06026521e+00
  7.06026521e+00  2.59624371e+01  3.28693465e+01  3.28693465e+01
  3.28693465e+01  1.28500589e+02  1.28500589e+02  1.28500589e+02
  1.31510197e+02  4.82989548e+02  4.82989548e+02  4.82989548e+02
  6.16728419e+02  1.33483208e+03  1.33483208e+03  1.33483208e+03
  2.68328141e+03  3.02902927e+03  3.02902927e+03  3.02902927e+03
  6.64944487e+03  6.64944487e+03  6.64944487e+03  9.08662786e+03
  2.54407811e+04  7.61814036e+04]
E1 = -728.2428963400338  E_coul = 201.50087722784463
cycle= 4 E= -526.742019112189  delta_E= -2.08e-06  |g|= 0.000117  |ddm|= 0.00224
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000131242
diis-c [-7.50037919e-09  9.84862843e-05 -1.34745293e-02 -8.39667504e-02
  1.09734279e+00]
  HOMO = -0.584911897530335  LUMO = 0.732776190430977
  mo_energy =
[-1.18583339e+02 -1.23149165e+01 -9.56519501e+00 -9.56519501e+00
 -9.56519501e+00 -1.27191444e+00 -5.84911898e-01 -5.84911898e-01
 -5.84911898e-01  7.32776190e-01  9.91319661e-01  9.91319661e-01
  9.91319661e-01  5.35754797e+00  7.06031049e+00  7.06031049e+00
  7.06031049e+00  2.59625024e+01  3.28694039e+01  3.28694039e+01
  3.28694039e+01  1.28500649e+02  1.28500649e+02  1.28500649e+02
  1.31510259e+02  4.82989602e+02  4.82989602e+02  4.82989602e+02
  6.16728465e+02  1.33483212e+03  1.33483212e+03  1.33483212e+03
  2.68328143e+03  3.02902930e+03  3.02902930e+03  3.02902930e+03
  6.64944489e+03  6.64944489e+03  6.64944489e+03  9.08662787e+03
  2.54407811e+04  7.61814036e+04]
E1 = -728.242617462691  E_coul = 201.500598347684
cycle= 5 E= -526.742019115007  delta_E= -2.82e-09  |g|= 2.28e-05  |ddm|= 0.000211
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.20633e-05
diis-c [-1.34505567e-10  1.36854126e-05 -1.68524659e-03 -1.28871643e-02
  1.38887591e-02  1.00066997e+00]
  HOMO = -0.584920913384167  LUMO = 0.732772945633904
  mo_energy =
[-1.18583374e+02 -1.23149431e+01 -9.56522365e+00 -9.56522365e+00
 -9.56522365e+00 -1.27192154e+00 -5.84920913e-01 -5.84920913e-01
 -5.84920913e-01  7.32772946e-01  9.91313774e-01  9.91313774e-01
  9.91313774e-01  5.35753384e+00  7.06029107e+00  7.06029107e+00
  7.06029107e+00  2.59624777e+01  3.28693762e+01  3.28693762e+01
  3.28693762e+01  1.28500617e+02  1.28500617e+02  1.28500617e+02
  1.31510227e+02  4.82989567e+02  4.82989567e+02  4.82989567e+02
  6.16728430e+02  1.33483208e+03  1.33483208e+03  1.33483208e+03
  2.68328140e+03  3.02902926e+03  3.02902926e+03  3.02902926e+03
  6.64944485e+03  6.64944485e+03  6.64944485e+03  9.08662783e+03
  2.54407811e+04  7.61814036e+04]
E1 = -728.2427116290839  E_coul = 201.50069251399694
cycle= 6 E= -526.742019115087  delta_E= -8e-11  |g|= 1.93e-06  |ddm|= 2.51e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2427116290839  E_coul = 201.50069251399694
  HOMO = -0.584920573745516  LUMO = 0.732773437581266
  mo_energy =
[-1.18583372e+02 -1.23149418e+01 -9.56522230e+00 -9.56522230e+00
 -9.56522230e+00 -1.27192076e+00 -5.84920574e-01 -5.84920574e-01
 -5.84920574e-01  7.32773438e-01  9.91314064e-01  9.91314064e-01
  9.91314064e-01  5.35753473e+00  7.06029196e+00  7.06029196e+00
  7.06029196e+00  2.59624789e+01  3.28693775e+01  3.28693775e+01
  3.28693775e+01  1.28500618e+02  1.28500618e+02  1.28500618e+02
  1.31510229e+02  4.82989569e+02  4.82989569e+02  4.82989569e+02
  6.16728431e+02  1.33483209e+03  1.33483209e+03  1.33483209e+03
  2.68328140e+03  3.02902927e+03  3.02902927e+03  3.02902927e+03
  6.64944485e+03  6.64944485e+03  6.64944485e+03  9.08662783e+03
  2.54407811e+04  7.61814036e+04]
E1 = -728.2427057980061  E_coul = 201.50068668291917
Extra cycle  E= -526.742019115087  delta_E= 1.14e-13  |g|= 4.5e-07  |ddm|= 3.24e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826577e+04 7.61751797e+03 3.61735282e+03 1.59774448e+03
 3.82793955e+02 1.09178927e+02 3.74197145e+01 1.03846004e+01
 4.45846060e+00 6.08941078e-01 1.71223061e+00 2.03369144e-01
 1.36278382e+03 6.64739613e+02 3.00933394e+02 3.14017617e+02
 6.16323060e+01 7.22788239e+00 2.03108388e+01 7.66293380e-01
 2.73007934e+00 2.19221110e-01]
E = -526.7420191150869
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:29 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6576913        1
[INPUT] 0    0    [1    /1   ]  7617.51797342        1
[INPUT] 0    0    [1    /1   ]  3617.35282181        1
[INPUT] 0    0    [1    /1   ]  1597.74447601        1
[INPUT] 0    0    [1    /1   ]  382.793955263        1
[INPUT] 0    0    [1    /1   ]  109.178927041        1
[INPUT] 0    0    [1    /1   ]  37.4197144637        1
[INPUT] 0    0    [1    /1   ]  10.384600399         1
[INPUT] 0    0    [1    /1   ]  4.45846059805        1
[INPUT] 0    0    [1    /1   ]  0.608941078164       1
[INPUT] 0    0    [1    /1   ]  1.71223061032        1
[INPUT] 0    0    [1    /1   ]  0.203369144243       1
[INPUT] 1    0    [1    /1   ]  1362.78382303        1
[INPUT] 1    0    [1    /1   ]  664.739613124        1
[INPUT] 1    0    [1    /1   ]  300.933393988        1
[INPUT] 1    0    [1    /1   ]  314.017617095        1
[INPUT] 1    0    [1    /1   ]  61.6323059576        1
[INPUT] 1    0    [1    /1   ]  7.22788239024        1
[INPUT] 1    0    [1    /1   ]  20.3108388457        1
[INPUT] 1    0    [1    /1   ]  0.766293379933       1
[INPUT] 1    0    [1    /1   ]  2.73007934351        1
[INPUT] 1    0    [1    /1   ]  0.219221110179       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657691312943, 1.0]], [0, [7617.517973418543, 1.0]], [0, [3617.352821811012, 1.0]], [0, [1597.7444760130236, 1.0]], [0, [382.7939552634057, 1.0]], [0, [109.1789270406667, 1.0]], [0, [37.41971446366042, 1.0]], [0, [10.384600398977378, 1.0]], [0, [4.458460598047995, 1.0]], [0, [0.6089410781635959, 1.0]], [0, [1.7122306103238283, 1.0]], [0, [0.2033691442430028, 1.0]], [1, [1362.7838230288105, 1.0]], [1, [664.7396131242485, 1.0]], [1, [300.93339398759656, 1.0]], [1, [314.01761709529416, 1.0]], [1, [61.63230595755055, 1.0]], [1, [7.227882390238899, 1.0]], [1, [20.31083884574978, 1.0]], [1, [0.766293379932761, 1.0]], [1, [2.730079343505455, 1.0]], [1, [0.2192211101787799, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65769131]
bas 1, expnt(s) = [7617.51797342]
bas 2, expnt(s) = [3617.35282181]
bas 3, expnt(s) = [1597.74447601]
bas 4, expnt(s) = [382.79395526]
bas 5, expnt(s) = [109.17892704]
bas 6, expnt(s) = [37.41971446]
bas 7, expnt(s) = [10.3846004]
bas 8, expnt(s) = [4.4584606]
bas 9, expnt(s) = [0.60894108]
bas 10, expnt(s) = [1.71223061]
bas 11, expnt(s) = [0.20336914]
bas 12, expnt(s) = [1362.78382303]
bas 13, expnt(s) = [664.73961312]
bas 14, expnt(s) = [300.93339399]
bas 15, expnt(s) = [314.0176171]
bas 16, expnt(s) = [61.63230596]
bas 17, expnt(s) = [7.22788239]
bas 18, expnt(s) = [20.31083885]
bas 19, expnt(s) = [0.76629338]
bas 20, expnt(s) = [2.73007934]
bas 21, expnt(s) = [0.21922111]
CPU time:       165.78
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826577e+04 5.20026314e+03 7.61751797e+03 2.06003757e+03
 3.61735282e+03 1.17844190e+03 1.59774448e+03 6.38477383e+02
 3.82793955e+02 2.18644636e+02 1.09178927e+02 8.53334178e+01
 3.74197145e+01 3.82243735e+01 1.03846004e+01 1.46152876e+01
 4.45846060e+00 7.75182079e+00 6.08941078e-01 1.74159223e+00
 1.71223061e+00 3.78169689e+00 2.03369144e-01 7.65118706e-01
 1.36278382e+03 2.41556153e+04 6.64739613e+02 9.84688447e+03
 3.00933394e+02 3.65655720e+03 3.14017617e+02 3.85635414e+03
 6.16323060e+01 5.03784630e+02 7.22788239e+00 3.45738895e+01
 2.03108388e+01 1.25789450e+02 7.66293380e-01 2.09159808e+00
 2.73007934e+00 1.02377255e+01 2.19221110e-01 4.37610122e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994168236564057
cond(S) = 111017.97064275786
E1 = -729.5222207287827  E_coul = 203.1712155229801
init E= -526.351005205803
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556063310447815  LUMO = 0.748671632713956
  mo_energy =
[-1.18329368e+02 -1.22068078e+01 -9.44725248e+00 -9.44725248e+00
 -9.44725248e+00 -1.24029730e+00 -5.56063310e-01 -5.56063310e-01
 -5.56063310e-01  7.48671633e-01  1.01075292e+00  1.01075292e+00
  1.01075292e+00  5.41106447e+00  7.13240414e+00  7.13240414e+00
  7.13240414e+00  2.60639883e+01  3.29925120e+01  3.29925120e+01
  3.29925120e+01  1.28685047e+02  1.28685047e+02  1.28685047e+02
  1.31688976e+02  4.83243179e+02  4.83243179e+02  4.83243179e+02
  6.17017239e+02  1.33513842e+03  1.33513842e+03  1.33513842e+03
  2.68372013e+03  3.02940072e+03  3.02940072e+03  3.02940072e+03
  6.64992872e+03  6.64992872e+03  6.64992872e+03  9.08718650e+03
  2.54414336e+04  7.61821462e+04]
E1 = -727.7854118007238  E_coul = 201.04421516532275
cycle= 1 E= -526.741196635401  delta_E= -0.39  |g|= 0.188  |ddm|= 0.336
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.548662
diis-c [-0.30103022  1.        ]
  HOMO = -0.592686642892244  LUMO = 0.72764730252893
  mo_energy =
[-1.18642463e+02 -1.23480644e+01 -9.59967527e+00 -9.59967527e+00
 -9.59967527e+00 -1.28140134e+00 -5.92686643e-01 -5.92686643e-01
 -5.92686643e-01  7.27647303e-01  9.85660024e-01  9.85660024e-01
  9.85660024e-01  5.34181801e+00  7.04010705e+00  7.04010705e+00
  7.04010705e+00  2.59321722e+01  3.28346395e+01  3.28346395e+01
  3.28346395e+01  1.28451869e+02  1.28451869e+02  1.28451869e+02
  1.31461428e+02  4.82931182e+02  4.82931182e+02  4.82931182e+02
  6.16668173e+02  1.33477019e+03  1.33477019e+03  1.33477019e+03
  2.68321684e+03  3.02896550e+03  3.02896550e+03  3.02896550e+03
  6.64937973e+03  6.64937973e+03  6.64937973e+03  9.08656212e+03
  2.54407150e+04  7.61813373e+04]
E1 = -728.3757195488535  E_coul = 201.63376586729538
cycle= 2 E= -526.741953681558  delta_E= -0.000757  |g|= 0.0386  |ddm|= 0.0525
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0780006
diis-c [-0.00355328  0.08444738  0.91555262]
  HOMO = -0.583357766385344  LUMO = 0.733676957672557
  mo_energy =
[-1.18573136e+02 -1.23089785e+01 -9.55888084e+00 -9.55888084e+00
 -9.55888084e+00 -1.27020428e+00 -5.83357766e-01 -5.83357766e-01
 -5.83357766e-01  7.33676958e-01  9.92414754e-01  9.92414754e-01
  9.92414754e-01  5.36046158e+00  7.06413819e+00  7.06413819e+00
  7.06413819e+00  2.59679833e+01  3.28757278e+01  3.28757278e+01
  3.28757278e+01  1.28509208e+02  1.28509208e+02  1.28509208e+02
  1.31518778e+02  4.82999688e+02  4.82999688e+02  4.82999688e+02
  6.16738896e+02  1.33484282e+03  1.33484282e+03  1.33484282e+03
  2.68329279e+03  3.02904040e+03  3.02904040e+03  3.02904040e+03
  6.64945640e+03  6.64945640e+03  6.64945640e+03  9.08663961e+03
  2.54407930e+04  7.61814157e+04]
E1 = -728.2191234790527  E_coul = 201.47710645148902
cycle= 3 E= -526.742017027564  delta_E= -6.33e-05  |g|= 0.00647  |ddm|= 0.0159
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136133
diis-c [-8.71734255e-07 -1.30850998e-03  1.43957258e-01  8.57351251e-01]
  HOMO = -0.584929710266422  LUMO = 0.73274651607573
  mo_energy =
[-1.18583393e+02 -1.23149910e+01 -9.56525476e+00 -9.56525476e+00
 -9.56525476e+00 -1.27196093e+00 -5.84929710e-01 -5.84929710e-01
 -5.84929710e-01  7.32746516e-01  9.91303831e-01  9.91303831e-01
  9.91303831e-01  5.35749615e+00  7.06026521e+00  7.06026521e+00
  7.06026521e+00  2.59624371e+01  3.28693465e+01  3.28693465e+01
  3.28693465e+01  1.28500589e+02  1.28500589e+02  1.28500589e+02
  1.31510197e+02  4.82989548e+02  4.82989548e+02  4.82989548e+02
  6.16728419e+02  1.33483208e+03  1.33483208e+03  1.33483208e+03
  2.68328141e+03  3.02902927e+03  3.02902927e+03  3.02902927e+03
  6.64944487e+03  6.64944487e+03  6.64944487e+03  9.08662786e+03
  2.54407811e+04  7.61814036e+04]
E1 = -728.2428963400338  E_coul = 201.50087722784463
cycle= 4 E= -526.742019112189  delta_E= -2.08e-06  |g|= 0.000117  |ddm|= 0.00224
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000131242
diis-c [-7.50037919e-09  9.84862843e-05 -1.34745293e-02 -8.39667504e-02
  1.09734279e+00]
  HOMO = -0.584911897530335  LUMO = 0.732776190430977
  mo_energy =
[-1.18583339e+02 -1.23149165e+01 -9.56519501e+00 -9.56519501e+00
 -9.56519501e+00 -1.27191444e+00 -5.84911898e-01 -5.84911898e-01
 -5.84911898e-01  7.32776190e-01  9.91319661e-01  9.91319661e-01
  9.91319661e-01  5.35754797e+00  7.06031049e+00  7.06031049e+00
  7.06031049e+00  2.59625024e+01  3.28694039e+01  3.28694039e+01
  3.28694039e+01  1.28500649e+02  1.28500649e+02  1.28500649e+02
  1.31510259e+02  4.82989602e+02  4.82989602e+02  4.82989602e+02
  6.16728465e+02  1.33483212e+03  1.33483212e+03  1.33483212e+03
  2.68328143e+03  3.02902930e+03  3.02902930e+03  3.02902930e+03
  6.64944489e+03  6.64944489e+03  6.64944489e+03  9.08662787e+03
  2.54407811e+04  7.61814036e+04]
E1 = -728.242617462691  E_coul = 201.500598347684
cycle= 5 E= -526.742019115007  delta_E= -2.82e-09  |g|= 2.28e-05  |ddm|= 0.000211
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.20633e-05
diis-c [-1.34505567e-10  1.36854126e-05 -1.68524659e-03 -1.28871643e-02
  1.38887591e-02  1.00066997e+00]
  HOMO = -0.584920913384167  LUMO = 0.732772945633904
  mo_energy =
[-1.18583374e+02 -1.23149431e+01 -9.56522365e+00 -9.56522365e+00
 -9.56522365e+00 -1.27192154e+00 -5.84920913e-01 -5.84920913e-01
 -5.84920913e-01  7.32772946e-01  9.91313774e-01  9.91313774e-01
  9.91313774e-01  5.35753384e+00  7.06029107e+00  7.06029107e+00
  7.06029107e+00  2.59624777e+01  3.28693762e+01  3.28693762e+01
  3.28693762e+01  1.28500617e+02  1.28500617e+02  1.28500617e+02
  1.31510227e+02  4.82989567e+02  4.82989567e+02  4.82989567e+02
  6.16728430e+02  1.33483208e+03  1.33483208e+03  1.33483208e+03
  2.68328140e+03  3.02902926e+03  3.02902926e+03  3.02902926e+03
  6.64944485e+03  6.64944485e+03  6.64944485e+03  9.08662783e+03
  2.54407811e+04  7.61814036e+04]
E1 = -728.2427116290839  E_coul = 201.50069251399694
cycle= 6 E= -526.742019115087  delta_E= -8e-11  |g|= 1.93e-06  |ddm|= 2.51e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2427116290839  E_coul = 201.50069251399694
  HOMO = -0.584920573745516  LUMO = 0.732773437581266
  mo_energy =
[-1.18583372e+02 -1.23149418e+01 -9.56522230e+00 -9.56522230e+00
 -9.56522230e+00 -1.27192076e+00 -5.84920574e-01 -5.84920574e-01
 -5.84920574e-01  7.32773438e-01  9.91314064e-01  9.91314064e-01
  9.91314064e-01  5.35753473e+00  7.06029196e+00  7.06029196e+00
  7.06029196e+00  2.59624789e+01  3.28693775e+01  3.28693775e+01
  3.28693775e+01  1.28500618e+02  1.28500618e+02  1.28500618e+02
  1.31510229e+02  4.82989569e+02  4.82989569e+02  4.82989569e+02
  6.16728431e+02  1.33483209e+03  1.33483209e+03  1.33483209e+03
  2.68328140e+03  3.02902927e+03  3.02902927e+03  3.02902927e+03
  6.64944485e+03  6.64944485e+03  6.64944485e+03  9.08662783e+03
  2.54407811e+04  7.61814036e+04]
E1 = -728.2427057980061  E_coul = 201.50068668291917
Extra cycle  E= -526.742019115087  delta_E= 1.14e-13  |g|= 4.5e-07  |ddm|= 3.24e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111017.97064275786
E1 = -728.2427057980061  E_coul = 201.50068668291917
init E= -526.742019115087
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.584920703985994  LUMO = 0.732773414175267
  mo_energy =
[-1.18583373e+02 -1.23149422e+01 -9.56522276e+00 -9.56522276e+00
 -9.56522276e+00 -1.27192083e+00 -5.84920704e-01 -5.84920704e-01
 -5.84920704e-01  7.32773414e-01  9.91313983e-01  9.91313983e-01
  9.91313983e-01  5.35753454e+00  7.06029168e+00  7.06029168e+00
  7.06029168e+00  2.59624785e+01  3.28693771e+01  3.28693771e+01
  3.28693771e+01  1.28500618e+02  1.28500618e+02  1.28500618e+02
  1.31510229e+02  4.82989568e+02  4.82989568e+02  4.82989568e+02
  6.16728431e+02  1.33483209e+03  1.33483209e+03  1.33483209e+03
  2.68328140e+03  3.02902926e+03  3.02902926e+03  3.02902926e+03
  6.64944485e+03  6.64944485e+03  6.64944485e+03  9.08662783e+03
  2.54407811e+04  7.61814036e+04]
E1 = -728.2427072882484  E_coul = 201.50068817316102
cycle= 1 E= -526.742019115087  delta_E= -4.55e-13  |g|= 1.21e-07  |ddm|= 5.98e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2427072882484  E_coul = 201.50068817316102
  HOMO = -0.584920679198253  LUMO = 0.732773441816487
  mo_energy =
[-1.18583373e+02 -1.23149421e+01 -9.56522265e+00 -9.56522265e+00
 -9.56522265e+00 -1.27192079e+00 -5.84920679e-01 -5.84920679e-01
 -5.84920679e-01  7.32773442e-01  9.91314003e-01  9.91314003e-01
  9.91314003e-01  5.35753460e+00  7.06029174e+00  7.06029174e+00
  7.06029174e+00  2.59624786e+01  3.28693772e+01  3.28693772e+01
  3.28693772e+01  1.28500618e+02  1.28500618e+02  1.28500618e+02
  1.31510229e+02  4.82989569e+02  4.82989569e+02  4.82989569e+02
  6.16728431e+02  1.33483209e+03  1.33483209e+03  1.33483209e+03
  2.68328140e+03  3.02902927e+03  3.02902927e+03  3.02902927e+03
  6.64944485e+03  6.64944485e+03  6.64944485e+03  9.08662783e+03
  2.54407811e+04  7.61814036e+04]
E1 = -728.242706826544  E_coul = 201.50068771145655
Extra cycle  E= -526.742019115087  delta_E= -1.14e-13  |g|= 3.02e-08  |ddm|= 1.5e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826577e+04 7.61751797e+03 3.61735282e+03 1.59774448e+03
 3.82793955e+02 1.09178927e+02 3.74197145e+01 1.03846004e+01
 4.45846060e+00 6.08941078e-01 1.71223061e+00 2.03369144e-01
 1.36278382e+03 6.64739613e+02 3.00933394e+02 3.14017617e+02
 6.16323060e+01 7.22788239e+00 2.03108388e+01 7.66293380e-01
 2.73007934e+00 2.19221110e-01]
grad_E = [-1.50188518e-06  3.13696985e-06 -1.66331854e-06  6.23859484e-05
  2.22411757e-04 -2.68629472e-03  2.12007789e-03 -2.75839069e-04
 -3.64453531e-04  4.40418679e-03 -2.00241595e-03 -2.70779309e-02
 -4.64634844e-07  5.56320481e-06  2.69866686e-05  2.32581661e-05
 -3.84826568e-04 -4.87181500e-03  2.69491080e-03  7.82614095e-03
 -4.69895433e-04 -2.94206143e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:34 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6580172        1
[INPUT] 0    0    [1    /1   ]  7617.51728062        1
[INPUT] 0    0    [1    /1   ]  3617.35317373        1
[INPUT] 0    0    [1    /1   ]  1597.73036775        1
[INPUT] 0    0    [1    /1   ]  382.772348044        1
[INPUT] 0    0    [1    /1   ]  109.46191014         1
[INPUT] 0    0    [1    /1   ]  37.6815680274        1
[INPUT] 0    0    [1    /1   ]  10.8810624622        1
[INPUT] 0    0    [1    /1   ]  4.59107377114        1
[INPUT] 0    0    [1    /1   ]  0.542251142949       1
[INPUT] 0    0    [1    /1   ]  1.8686512225         1
[INPUT] 0    0    [1    /1   ]  0.194366651451       1
[INPUT] 1    0    [1    /1   ]  1362.78393289        1
[INPUT] 1    0    [1    /1   ]  664.738535123        1
[INPUT] 1    0    [1    /1   ]  300.928315474        1
[INPUT] 1    0    [1    /1   ]  314.013238382        1
[INPUT] 1    0    [1    /1   ]  61.6331162017        1
[INPUT] 1    0    [1    /1   ]  7.20512693306        1
[INPUT] 1    0    [1    /1   ]  20.329194441         1
[INPUT] 1    0    [1    /1   ]  0.763117425712       1
[INPUT] 1    0    [1    /1   ]  2.7066493189         1
[INPUT] 1    0    [1    /1   ]  0.220346692203       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65801722273, 1.0]], [0, [7617.5172806212295, 1.0]], [0, [3617.353173727207, 1.0]], [0, [1597.7303677454279, 1.0]], [0, [382.7723480438305, 1.0]], [0, [109.46191014036077, 1.0]], [0, [37.68156802741349, 1.0]], [0, [10.881062462210261, 1.0]], [0, [4.591073771144944, 1.0]], [0, [0.5422511429485757, 1.0]], [0, [1.8686512225014758, 1.0]], [0, [0.1943666514513896, 1.0]], [1, [1362.7839328867387, 1.0]], [1, [664.7385351227911, 1.0]], [1, [300.9283154740696, 1.0]], [1, [314.0132383820856, 1.0]], [1, [61.63311620166125, 1.0]], [1, [7.205126933056815, 1.0]], [1, [20.329194440972568, 1.0]], [1, [0.7631174257121766, 1.0]], [1, [2.706649318902964, 1.0]], [1, [0.22034669220347522, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65801722]
bas 1, expnt(s) = [7617.51728062]
bas 2, expnt(s) = [3617.35317373]
bas 3, expnt(s) = [1597.73036775]
bas 4, expnt(s) = [382.77234804]
bas 5, expnt(s) = [109.46191014]
bas 6, expnt(s) = [37.68156803]
bas 7, expnt(s) = [10.88106246]
bas 8, expnt(s) = [4.59107377]
bas 9, expnt(s) = [0.54225114]
bas 10, expnt(s) = [1.86865122]
bas 11, expnt(s) = [0.19436665]
bas 12, expnt(s) = [1362.78393289]
bas 13, expnt(s) = [664.73853512]
bas 14, expnt(s) = [300.92831547]
bas 15, expnt(s) = [314.01323838]
bas 16, expnt(s) = [61.6331162]
bas 17, expnt(s) = [7.20512693]
bas 18, expnt(s) = [20.32919444]
bas 19, expnt(s) = [0.76311743]
bas 20, expnt(s) = [2.70664932]
bas 21, expnt(s) = [0.22034669]
CPU time:       171.45
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826580e+04 5.20026319e+03 7.61751728e+03 2.06003742e+03
 3.61735317e+03 1.17844199e+03 1.59773037e+03 6.38473155e+02
 3.82772348e+02 2.18635380e+02 1.09461910e+02 8.54992472e+01
 3.76815680e+01 3.84248118e+01 1.08810625e+01 1.51362573e+01
 4.59107377e+00 7.92411423e+00 5.42251143e-01 1.59648698e+00
 1.86865122e+00 4.03795255e+00 1.94366651e-01 7.39573496e-01
 1.36278393e+03 2.41556177e+04 6.64738535e+02 9.84686451e+03
 3.00928315e+02 3.65648007e+03 3.14013238e+02 3.85628692e+03
 6.16331162e+01 5.03792909e+02 7.20512693e+00 3.44378823e+01
 2.03291944e+01 1.25931566e+02 7.63117426e-01 2.08076774e+00
 2.70664932e+00 1.01280161e+01 2.20346692e-01 4.40420537e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99421147075244
cond(S) = 110796.69211488603
E1 = -729.5177434925561  E_coul = 203.16818956082253
init E= -526.349553931734
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556123434745729  LUMO = 0.675783677358509
  mo_energy =
[-1.18329945e+02 -1.22070144e+01 -9.44745707e+00 -9.44745707e+00
 -9.44745707e+00 -1.24017410e+00 -5.56123435e-01 -5.56123435e-01
 -5.56123435e-01  6.75783677e-01  1.01252940e+00  1.01252940e+00
  1.01252940e+00  5.44191229e+00  7.07828285e+00  7.07828285e+00
  7.07828285e+00  2.73853681e+01  3.28581527e+01  3.28581527e+01
  3.28581527e+01  1.28572165e+02  1.28572165e+02  1.28572165e+02
  1.35087059e+02  4.83168049e+02  4.83168049e+02  4.83168049e+02
  6.21455392e+02  1.33506666e+03  1.33506666e+03  1.33506666e+03
  2.68808863e+03  3.02932129e+03  3.02932129e+03  3.02932129e+03
  6.64984565e+03  6.64984565e+03  6.64984565e+03  9.09125088e+03
  2.54452789e+04  7.61857258e+04]
E1 = -727.8096833544164  E_coul = 201.06857611307836
cycle= 1 E= -526.741107241338  delta_E= -0.392  |g|= 0.187  |ddm|= 0.339
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.54945
diis-c [-0.30189484  1.        ]
  HOMO = -0.591382305369108  LUMO = 0.657409447533358
  mo_energy =
[-1.18641408e+02 -1.23466182e+01 -9.59828767e+00 -9.59828767e+00
 -9.59828767e+00 -1.27974310e+00 -5.91382305e-01 -5.91382305e-01
 -5.91382305e-01  6.57409448e-01  9.88458837e-01  9.88458837e-01
  9.88458837e-01  5.37270719e+00  6.98810177e+00  6.98810177e+00
  6.98810177e+00  2.72524291e+01  3.27019908e+01  3.27019908e+01
  3.27019908e+01  1.28340532e+02  1.28340532e+02  1.28340532e+02
  1.34860400e+02  4.82857648e+02  4.82857648e+02  4.82857648e+02
  6.21107917e+02  1.33470002e+03  1.33470002e+03  1.33470002e+03
  2.68758701e+03  3.02888767e+03  3.02888767e+03  3.02888767e+03
  6.64929823e+03  6.64929823e+03  6.64929823e+03  9.09062810e+03
  2.54445618e+04  7.61849184e+04]
E1 = -728.3939751048882  E_coul = 201.65212355142705
cycle= 2 E= -526.741851553461  delta_E= -0.000744  |g|= 0.0383  |ddm|= 0.0523
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0772483
diis-c [-0.00351512  0.08311979  0.91688021]
  HOMO = -0.582111173424427  LUMO = 0.662965710336867
  mo_energy =
[-1.18572612e+02 -1.23079007e+01 -9.55789375e+00 -9.55789375e+00
 -9.55789375e+00 -1.26863427e+00 -5.82111173e-01 -5.82111173e-01
 -5.82111173e-01  6.62965710e-01  9.95153320e-01  9.95153320e-01
  9.95153320e-01  5.39179808e+00  7.01180273e+00  7.01180273e+00
  7.01180273e+00  2.72886114e+01  3.27426885e+01  3.27426885e+01
  3.27426885e+01  1.28397407e+02  1.28397407e+02  1.28397407e+02
  1.34917399e+02  4.82925631e+02  4.82925631e+02  4.82925631e+02
  6.21178090e+02  1.33477210e+03  1.33477210e+03  1.33477210e+03
  2.68766238e+03  3.02896200e+03  3.02896200e+03  3.02896200e+03
  6.64937433e+03  6.64937433e+03  6.64937433e+03  9.09070501e+03
  2.54446393e+04  7.61849962e+04]
E1 = -728.240269901191  E_coul = 201.49835697418874
cycle= 3 E= -526.741912927002  delta_E= -6.14e-05  |g|= 0.00642  |ddm|= 0.0158
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135426
diis-c [-8.75982730e-07 -1.32141694e-03  1.44454402e-01  8.56867015e-01]
  HOMO = -0.583641099128656  LUMO = 0.66213018800326
  mo_energy =
[-1.18582768e+02 -1.23138221e+01 -9.56417743e+00 -9.56417743e+00
 -9.56417743e+00 -1.27034464e+00 -5.83641099e-01 -5.83641099e-01
 -5.83641099e-01  6.62130188e-01  9.94074373e-01  9.94074373e-01
  9.94074373e-01  5.38881913e+00  7.00802196e+00  7.00802196e+00
  7.00802196e+00  2.72830496e+01  3.27363983e+01  3.27363983e+01
  3.27363983e+01  1.28388885e+02  1.28388885e+02  1.28388885e+02
  1.34908898e+02  4.82915592e+02  4.82915592e+02  4.82915592e+02
  6.21167715e+02  1.33476146e+03  1.33476146e+03  1.33476146e+03
  2.68765110e+03  3.02895097e+03  3.02895097e+03  3.02895097e+03
  6.64936289e+03  6.64936289e+03  6.64936289e+03  9.09069335e+03
  2.54446274e+04  7.61849842e+04]
E1 = -728.2635577356116  E_coul = 201.52164279668045
cycle= 4 E= -526.741914938931  delta_E= -2.01e-06  |g|= 0.000115  |ddm|= 0.00222
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000139505
diis-c [-6.68389679e-09  1.04355953e-04 -1.41386998e-02 -8.90814317e-02
  1.10311578e+00]
  HOMO = -0.583624672424727  LUMO = 0.662156910916712
  mo_energy =
[-1.18582728e+02 -1.23137573e+01 -9.56412830e+00 -9.56412830e+00
 -9.56412830e+00 -1.27030070e+00 -5.83624672e-01 -5.83624672e-01
 -5.83624672e-01  6.62156911e-01  9.94089035e-01  9.94089035e-01
  9.94089035e-01  5.38886931e+00  7.00806156e+00  7.00806156e+00
  7.00806156e+00  2.72831066e+01  3.27364456e+01  3.27364456e+01
  3.27364456e+01  1.28388932e+02  1.28388932e+02  1.28388932e+02
  1.34908948e+02  4.82915632e+02  4.82915632e+02  4.82915632e+02
  6.21167747e+02  1.33476149e+03  1.33476149e+03  1.33476149e+03
  2.68765111e+03  3.02895099e+03  3.02895099e+03  3.02895099e+03
  6.64936290e+03  6.64936290e+03  6.64936290e+03  9.09069334e+03
  2.54446274e+04  7.61849842e+04]
E1 = -728.2633240326288  E_coul = 201.52140909108115
cycle= 5 E= -526.741914941548  delta_E= -2.62e-09  |g|= 2.15e-05  |ddm|= 0.000197
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93671e-05
diis-c [-1.23309160e-10  1.33355949e-05 -1.64861843e-03 -1.25033347e-02
  2.33852223e-02  9.90753395e-01]
  HOMO = -0.583633211273535  LUMO = 0.662154023407862
  mo_energy =
[-1.18582761e+02 -1.23137825e+01 -9.56415538e+00 -9.56415538e+00
 -9.56415538e+00 -1.27030750e+00 -5.83633211e-01 -5.83633211e-01
 -5.83633211e-01  6.62154023e-01  9.94083456e-01  9.94083456e-01
  9.94083456e-01  5.38885559e+00  7.00804327e+00  7.00804327e+00
  7.00804327e+00  2.72830828e+01  3.27364194e+01  3.27364194e+01
  3.27364194e+01  1.28388901e+02  1.28388901e+02  1.28388901e+02
  1.34908917e+02  4.82915599e+02  4.82915599e+02  4.82915599e+02
  6.21167714e+02  1.33476145e+03  1.33476145e+03  1.33476145e+03
  2.68765107e+03  3.02895095e+03  3.02895095e+03  3.02895095e+03
  6.64936286e+03  6.64936286e+03  6.64936286e+03  9.09069331e+03
  2.54446274e+04  7.61849842e+04]
E1 = -728.2634114626587  E_coul = 201.52149652104077
cycle= 6 E= -526.741914941618  delta_E= -7.04e-11  |g|= 1.92e-06  |ddm|= 2.33e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2634114626587  E_coul = 201.52149652104077
  HOMO = -0.583632966400383  LUMO = 0.662154434520626
  mo_energy =
[-1.18582759e+02 -1.23137813e+01 -9.56415424e+00 -9.56415424e+00
 -9.56415424e+00 -1.27030681e+00 -5.83632966e-01 -5.83632966e-01
 -5.83632966e-01  6.62154435e-01  9.94083681e-01  9.94083681e-01
  9.94083681e-01  5.38885635e+00  7.00804400e+00  7.00804400e+00
  7.00804400e+00  2.72830839e+01  3.27364205e+01  3.27364205e+01
  3.27364205e+01  1.28388902e+02  1.28388902e+02  1.28388902e+02
  1.34908919e+02  4.82915600e+02  4.82915600e+02  4.82915600e+02
  6.21167715e+02  1.33476145e+03  1.33476145e+03  1.33476145e+03
  2.68765107e+03  3.02895095e+03  3.02895095e+03  3.02895095e+03
  6.64936286e+03  6.64936286e+03  6.64936286e+03  9.09069331e+03
  2.54446274e+04  7.61849842e+04]
E1 = -728.2634061745903  E_coul = 201.52149123297147
Extra cycle  E= -526.741914941619  delta_E= -7.96e-13  |g|= 4.44e-07  |ddm|= 3.56e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
exp = [2.61826580e+04 7.61751728e+03 3.61735317e+03 1.59773037e+03
 3.82772348e+02 1.09461910e+02 3.76815680e+01 1.08810625e+01
 4.59107377e+00 5.42251143e-01 1.86865122e+00 1.94366651e-01
 1.36278393e+03 6.64738535e+02 3.00928315e+02 3.14013238e+02
 6.16331162e+01 7.20512693e+00 2.03291944e+01 7.63117426e-01
 2.70664932e+00 2.20346692e-01]
E = -526.7419149416188
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:34 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6578316        1
[INPUT] 0    0    [1    /1   ]  7617.5176751         1
[INPUT] 0    0    [1    /1   ]  3617.35297335        1
[INPUT] 0    0    [1    /1   ]  1597.73840101        1
[INPUT] 0    0    [1    /1   ]  382.784651214        1
[INPUT] 0    0    [1    /1   ]  109.300779309        1
[INPUT] 0    0    [1    /1   ]  37.5324683726        1
[INPUT] 0    0    [1    /1   ]  10.5983765168        1
[INPUT] 0    0    [1    /1   ]  4.51556371108        1
[INPUT] 0    0    [1    /1   ]  0.580224452058       1
[INPUT] 0    0    [1    /1   ]  1.7795851852         1
[INPUT] 0    0    [1    /1   ]  0.199492678946       1
[INPUT] 1    0    [1    /1   ]  1362.78387033        1
[INPUT] 1    0    [1    /1   ]  664.739148938        1
[INPUT] 1    0    [1    /1   ]  300.931207184        1
[INPUT] 1    0    [1    /1   ]  314.015731625        1
[INPUT] 1    0    [1    /1   ]  61.6326548479        1
[INPUT] 1    0    [1    /1   ]  7.21808391085        1
[INPUT] 1    0    [1    /1   ]  20.3187427485        1
[INPUT] 1    0    [1    /1   ]  0.764925816903       1
[INPUT] 1    0    [1    /1   ]  2.71999039599        1
[INPUT] 1    0    [1    /1   ]  0.219705784786       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657831649405, 1.0]], [0, [7617.517675100643, 1.0]], [0, [3617.352973345809, 1.0]], [0, [1597.7384010056894, 1.0]], [0, [382.7846512140957, 1.0]], [0, [109.30077930880749, 1.0]], [0, [37.53246837263433, 1.0]], [0, [10.598376516760322, 1.0]], [0, [4.515563711077288, 1.0]], [0, [0.5802244520580169, 1.0]], [0, [1.7795851852027615, 1.0]], [0, [0.1994926789460819, 1.0]], [1, [1362.7838703335356, 1.0]], [1, [664.7391489377908, 1.0]], [1, [300.93120718424075, 1.0]], [1, [314.0157316253259, 1.0]], [1, [61.632654847935676, 1.0]], [1, [7.21808391084838, 1.0]], [1, [20.31874274853899, 1.0]], [1, [0.764925816902644, 1.0]], [1, [2.7199903959905876, 1.0]], [1, [0.21970578478597694, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65783165]
bas 1, expnt(s) = [7617.5176751]
bas 2, expnt(s) = [3617.35297335]
bas 3, expnt(s) = [1597.73840101]
bas 4, expnt(s) = [382.78465121]
bas 5, expnt(s) = [109.30077931]
bas 6, expnt(s) = [37.53246837]
bas 7, expnt(s) = [10.59837652]
bas 8, expnt(s) = [4.51556371]
bas 9, expnt(s) = [0.58022445]
bas 10, expnt(s) = [1.77958519]
bas 11, expnt(s) = [0.19949268]
bas 12, expnt(s) = [1362.78387033]
bas 13, expnt(s) = [664.73914894]
bas 14, expnt(s) = [300.93120718]
bas 15, expnt(s) = [314.01573163]
bas 16, expnt(s) = [61.63265485]
bas 17, expnt(s) = [7.21808391]
bas 18, expnt(s) = [20.31874275]
bas 19, expnt(s) = [0.76492582]
bas 20, expnt(s) = [2.7199904]
bas 21, expnt(s) = [0.21970578]
CPU time:       171.81
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826578e+04 5.20026316e+03 7.61751768e+03 2.06003750e+03
 3.61735297e+03 1.17844194e+03 1.59773840e+03 6.38475562e+02
 3.82784651e+02 2.18640650e+02 1.09300779e+02 8.54048370e+01
 3.75324684e+01 3.83107249e+01 1.05983765e+01 1.48403633e+01
 4.51556371e+00 7.82616509e+00 5.80224452e-01 1.67962390e+00
 1.77958519e+00 3.89272846e+00 1.99492679e-01 7.54154360e-01
 1.36278387e+03 2.41556164e+04 6.64739149e+02 9.84687588e+03
 3.00931207e+02 3.65652399e+03 3.14015732e+02 3.85632520e+03
 6.16326548e+01 5.03788195e+02 7.21808391e+00 3.45153118e+01
 2.03187427e+01 1.25850641e+02 7.64925817e-01 2.08693317e+00
 2.71999040e+00 1.01904557e+01 2.19705785e-01 4.38819843e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994218099155347
cond(S) = 110919.17923568077
E1 = -729.5224746793832  E_coul = 203.17118733677228
init E= -526.351287342611
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556036727969326  LUMO = 0.718019240450407
  mo_energy =
[-1.18329531e+02 -1.22068241e+01 -9.44725543e+00 -9.44725543e+00
 -9.44725543e+00 -1.24028578e+00 -5.56036728e-01 -5.56036728e-01
 -5.56036728e-01  7.18019240e-01  1.01154735e+00  1.01154735e+00
  1.01154735e+00  5.42723126e+00  7.10917242e+00  7.10917242e+00
  7.10917242e+00  2.66322268e+01  3.29347686e+01  3.29347686e+01
  3.29347686e+01  1.28636506e+02  1.28636506e+02  1.28636506e+02
  1.33154067e+02  4.83210893e+02  4.83210893e+02  4.83210893e+02
  6.18927735e+02  1.33510758e+03  1.33510758e+03  1.33510758e+03
  2.68559969e+03  3.02936658e+03  3.02936658e+03  3.02936658e+03
  6.64989302e+03  6.64989302e+03  6.64989302e+03  9.08893504e+03
  2.54430879e+04  7.61836861e+04]
E1 = -727.7980137087565  E_coul = 201.0566420328651
cycle= 1 E= -526.741371675891  delta_E= -0.39  |g|= 0.188  |ddm|= 0.327
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.54892
diis-c [-0.30131354  1.        ]
  HOMO = -0.592087619793987  LUMO = 0.698082015376305
  mo_energy =
[-1.18641817e+02 -1.23473016e+01 -9.59891688e+00 -9.59891688e+00
 -9.59891688e+00 -1.28075064e+00 -5.92087620e-01 -5.92087620e-01
 -5.92087620e-01  6.98082015e-01  9.86878486e-01  9.86878486e-01
  9.86878486e-01  5.35797027e+00  7.01781606e+00  7.01781606e+00
  7.01781606e+00  2.64999726e+01  3.27776978e+01  3.27776978e+01
  3.27776978e+01  1.28404087e+02  1.28404087e+02  1.28404087e+02
  1.32926983e+02  4.82899685e+02  4.82899685e+02  4.82899685e+02
  6.18579464e+02  1.33474015e+03  1.33474015e+03  1.33474015e+03
  2.68509724e+03  3.02893217e+03  3.02893217e+03  3.02893217e+03
  6.64934483e+03  6.64934483e+03  6.64934483e+03  9.08831148e+03
  2.54423700e+04  7.61828780e+04]
E1 = -728.3853270604865  E_coul = 201.6432053087776
cycle= 2 E= -526.742121751709  delta_E= -0.00075  |g|= 0.0385  |ddm|= 0.0522
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776541
diis-c [-0.00353579  0.08384951  0.91615049]
  HOMO = -0.582793469035322  LUMO = 0.703911277539367
  mo_energy =
[-1.18572754e+02 -1.23084003e+01 -9.55831979e+00 -9.55831979e+00
 -9.55831979e+00 -1.26960283e+00 -5.82793469e-01 -5.82793469e-01
 -5.82793469e-01  7.03911278e-01  9.93600255e-01  9.93600255e-01
  9.93600255e-01  5.37678727e+00  7.04168626e+00  7.04168626e+00
  7.04168626e+00  2.65359245e+01  3.28185928e+01  3.28185928e+01
  3.28185928e+01  1.28461196e+02  1.28461196e+02  1.28461196e+02
  1.32984152e+02  4.82967931e+02  4.82967931e+02  4.82967931e+02
  6.18649916e+02  1.33481250e+03  1.33481250e+03  1.33481250e+03
  2.68517291e+03  3.02900679e+03  3.02900679e+03  3.02900679e+03
  6.64942122e+03  6.64942122e+03  6.64942122e+03  9.08838869e+03
  2.54424478e+04  7.61829561e+04]
E1 = -728.2299960183086  E_coul = 201.4878118285925
cycle= 3 E= -526.742184189716  delta_E= -6.24e-05  |g|= 0.00645  |ddm|= 0.0158
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135799
diis-c [-8.68188255e-07 -1.31239283e-03  1.44186806e-01  8.57125587e-01]
  HOMO = -0.584348791992891  LUMO = 0.703019323058409
  mo_energy =
[-1.18582968e+02 -1.23143759e+01 -9.56465683e+00 -9.56465683e+00
 -9.56465683e+00 -1.27134148e+00 -5.84348792e-01 -5.84348792e-01
 -5.84348792e-01  7.03019323e-01  9.92502051e-01  9.92502051e-01
  9.92502051e-01  5.37381303e+00  7.03785083e+00  7.03785083e+00
  7.03785083e+00  2.65303686e+01  3.28122487e+01  3.28122487e+01
  3.28122487e+01  1.28452617e+02  1.28452617e+02  1.28452617e+02
  1.32975603e+02  4.82957833e+02  4.82957833e+02  4.82957833e+02
  6.18639482e+02  1.33480180e+03  1.33480180e+03  1.33480180e+03
  2.68516157e+03  3.02899570e+03  3.02899570e+03  3.02899570e+03
  6.64940973e+03  6.64940973e+03  6.64940973e+03  9.08837697e+03
  2.54424359e+04  7.61829441e+04]
E1 = -728.253570554583  E_coul = 201.5113843108176
cycle= 4 E= -526.742186243765  delta_E= -2.05e-06  |g|= 0.000116  |ddm|= 0.00223
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000133388
diis-c [-7.18089044e-09  1.00286775e-04 -1.36779577e-02 -8.55330558e-02
  1.09911073e+00]
  HOMO = -0.58433146418103  LUMO = 0.703047789418586
  mo_energy =
[-1.18582919e+02 -1.23143049e+01 -9.56460081e+00 -9.56460081e+00
 -9.56460081e+00 -1.27129598e+00 -5.84331464e-01 -5.84331464e-01
 -5.84331464e-01  7.03047789e-01  9.92517453e-01  9.92517453e-01
  9.92517453e-01  5.37386434e+00  7.03789409e+00  7.03789409e+00
  7.03789409e+00  2.65304310e+01  3.28123025e+01  3.28123025e+01
  3.28123025e+01  1.28452672e+02  1.28452672e+02  1.28452672e+02
  1.32975661e+02  4.82957882e+02  4.82957882e+02  4.82957882e+02
  6.18639523e+02  1.33480184e+03  1.33480184e+03  1.33480184e+03
  2.68516159e+03  3.02899573e+03  3.02899573e+03  3.02899573e+03
  6.64940974e+03  6.64940974e+03  6.64940974e+03  9.08837698e+03
  2.54424359e+04  7.61829441e+04]
E1 = -728.2533073692418  E_coul = 201.51112112274387
cycle= 5 E= -526.742186246498  delta_E= -2.73e-09  |g|= 2.24e-05  |ddm|= 0.000203
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.10924e-05
diis-c [-1.30360908e-10  1.35904926e-05 -1.67677740e-03 -1.27709031e-02
  1.73285854e-02  9.97105505e-01]
  HOMO = -0.584340307387059  LUMO = 0.703044689033226
  mo_energy =
[-1.18582954e+02 -1.23143309e+01 -9.56462888e+00 -9.56462888e+00
 -9.56462888e+00 -1.27130296e+00 -5.84340307e-01 -5.84340307e-01
 -5.84340307e-01  7.03044689e-01  9.92511679e-01  9.92511679e-01
  9.92511679e-01  5.37385035e+00  7.03787509e+00  7.03787509e+00
  7.03787509e+00  2.65304066e+01  3.28122754e+01  3.28122754e+01
  3.28122754e+01  1.28452640e+02  1.28452640e+02  1.28452640e+02
  1.32975630e+02  4.82957848e+02  4.82957848e+02  4.82957848e+02
  6.18639488e+02  1.33480181e+03  1.33480181e+03  1.33480181e+03
  2.68516155e+03  3.02899569e+03  3.02899569e+03  3.02899569e+03
  6.64940970e+03  6.64940970e+03  6.64940970e+03  9.08837694e+03
  2.54424358e+04  7.61829440e+04]
E1 = -728.2533989656251  E_coul = 201.51121271905203
cycle= 6 E= -526.742186246573  delta_E= -7.5e-11  |g|= 1.93e-06  |ddm|= 2.43e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2533989656251  E_coul = 201.51121271905203
  HOMO = -0.584340006472933  LUMO = 0.703045147619142
  mo_energy =
[-1.18582952e+02 -1.23143297e+01 -9.56462762e+00 -9.56462762e+00
 -9.56462762e+00 -1.27130222e+00 -5.84340006e-01 -5.84340006e-01
 -5.84340006e-01  7.03045148e-01  9.92511943e-01  9.92511943e-01
  9.92511943e-01  5.37385118e+00  7.03787591e+00  7.03787591e+00
  7.03787591e+00  2.65304078e+01  3.28122766e+01  3.28122766e+01
  3.28122766e+01  1.28452642e+02  1.28452642e+02  1.28452642e+02
  1.32975631e+02  4.82957850e+02  4.82957850e+02  4.82957850e+02
  6.18639490e+02  1.33480181e+03  1.33480181e+03  1.33480181e+03
  2.68516155e+03  3.02899569e+03  3.02899569e+03  3.02899569e+03
  6.64940971e+03  6.64940971e+03  6.64940971e+03  9.08837694e+03
  2.54424358e+04  7.61829440e+04]
E1 = -728.2533933632284  E_coul = 201.51120711665436
Extra cycle  E= -526.742186246574  delta_E= -9.09e-13  |g|= 4.47e-07  |ddm|= 3.34e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
exp = [2.61826578e+04 7.61751768e+03 3.61735297e+03 1.59773840e+03
 3.82784651e+02 1.09300779e+02 3.75324684e+01 1.05983765e+01
 4.51556371e+00 5.80224452e-01 1.77958519e+00 1.99492679e-01
 1.36278387e+03 6.64739149e+02 3.00931207e+02 3.14015732e+02
 6.16326548e+01 7.21808391e+00 2.03187427e+01 7.64925817e-01
 2.71999040e+00 2.19705785e-01]
E = -526.742186246574
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:35 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6578316        1
[INPUT] 0    0    [1    /1   ]  7617.5176751         1
[INPUT] 0    0    [1    /1   ]  3617.35297335        1
[INPUT] 0    0    [1    /1   ]  1597.73840101        1
[INPUT] 0    0    [1    /1   ]  382.784651214        1
[INPUT] 0    0    [1    /1   ]  109.300779309        1
[INPUT] 0    0    [1    /1   ]  37.5324683726        1
[INPUT] 0    0    [1    /1   ]  10.5983765168        1
[INPUT] 0    0    [1    /1   ]  4.51556371108        1
[INPUT] 0    0    [1    /1   ]  0.580224452058       1
[INPUT] 0    0    [1    /1   ]  1.7795851852         1
[INPUT] 0    0    [1    /1   ]  0.199492678946       1
[INPUT] 1    0    [1    /1   ]  1362.78387033        1
[INPUT] 1    0    [1    /1   ]  664.739148938        1
[INPUT] 1    0    [1    /1   ]  300.931207184        1
[INPUT] 1    0    [1    /1   ]  314.015731625        1
[INPUT] 1    0    [1    /1   ]  61.6326548479        1
[INPUT] 1    0    [1    /1   ]  7.21808391085        1
[INPUT] 1    0    [1    /1   ]  20.3187427485        1
[INPUT] 1    0    [1    /1   ]  0.764925816903       1
[INPUT] 1    0    [1    /1   ]  2.71999039599        1
[INPUT] 1    0    [1    /1   ]  0.219705784786       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657831649405, 1.0]], [0, [7617.517675100643, 1.0]], [0, [3617.352973345809, 1.0]], [0, [1597.7384010056894, 1.0]], [0, [382.7846512140957, 1.0]], [0, [109.30077930880749, 1.0]], [0, [37.53246837263433, 1.0]], [0, [10.598376516760322, 1.0]], [0, [4.515563711077288, 1.0]], [0, [0.5802244520580169, 1.0]], [0, [1.7795851852027615, 1.0]], [0, [0.1994926789460819, 1.0]], [1, [1362.7838703335356, 1.0]], [1, [664.7391489377908, 1.0]], [1, [300.93120718424075, 1.0]], [1, [314.0157316253259, 1.0]], [1, [61.632654847935676, 1.0]], [1, [7.21808391084838, 1.0]], [1, [20.31874274853899, 1.0]], [1, [0.764925816902644, 1.0]], [1, [2.7199903959905876, 1.0]], [1, [0.21970578478597694, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65783165]
bas 1, expnt(s) = [7617.5176751]
bas 2, expnt(s) = [3617.35297335]
bas 3, expnt(s) = [1597.73840101]
bas 4, expnt(s) = [382.78465121]
bas 5, expnt(s) = [109.30077931]
bas 6, expnt(s) = [37.53246837]
bas 7, expnt(s) = [10.59837652]
bas 8, expnt(s) = [4.51556371]
bas 9, expnt(s) = [0.58022445]
bas 10, expnt(s) = [1.77958519]
bas 11, expnt(s) = [0.19949268]
bas 12, expnt(s) = [1362.78387033]
bas 13, expnt(s) = [664.73914894]
bas 14, expnt(s) = [300.93120718]
bas 15, expnt(s) = [314.01573163]
bas 16, expnt(s) = [61.63265485]
bas 17, expnt(s) = [7.21808391]
bas 18, expnt(s) = [20.31874275]
bas 19, expnt(s) = [0.76492582]
bas 20, expnt(s) = [2.7199904]
bas 21, expnt(s) = [0.21970578]
CPU time:       172.16
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826578e+04 5.20026316e+03 7.61751768e+03 2.06003750e+03
 3.61735297e+03 1.17844194e+03 1.59773840e+03 6.38475562e+02
 3.82784651e+02 2.18640650e+02 1.09300779e+02 8.54048370e+01
 3.75324684e+01 3.83107249e+01 1.05983765e+01 1.48403633e+01
 4.51556371e+00 7.82616509e+00 5.80224452e-01 1.67962390e+00
 1.77958519e+00 3.89272846e+00 1.99492679e-01 7.54154360e-01
 1.36278387e+03 2.41556164e+04 6.64739149e+02 9.84687588e+03
 3.00931207e+02 3.65652399e+03 3.14015732e+02 3.85632520e+03
 6.16326548e+01 5.03788195e+02 7.21808391e+00 3.45153118e+01
 2.03187427e+01 1.25850641e+02 7.64925817e-01 2.08693317e+00
 2.71999040e+00 1.01904557e+01 2.19705785e-01 4.38819843e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994218099155347
cond(S) = 110919.17923568077
E1 = -729.5224746793832  E_coul = 203.17118733677228
init E= -526.351287342611
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556036727969326  LUMO = 0.718019240450407
  mo_energy =
[-1.18329531e+02 -1.22068241e+01 -9.44725543e+00 -9.44725543e+00
 -9.44725543e+00 -1.24028578e+00 -5.56036728e-01 -5.56036728e-01
 -5.56036728e-01  7.18019240e-01  1.01154735e+00  1.01154735e+00
  1.01154735e+00  5.42723126e+00  7.10917242e+00  7.10917242e+00
  7.10917242e+00  2.66322268e+01  3.29347686e+01  3.29347686e+01
  3.29347686e+01  1.28636506e+02  1.28636506e+02  1.28636506e+02
  1.33154067e+02  4.83210893e+02  4.83210893e+02  4.83210893e+02
  6.18927735e+02  1.33510758e+03  1.33510758e+03  1.33510758e+03
  2.68559969e+03  3.02936658e+03  3.02936658e+03  3.02936658e+03
  6.64989302e+03  6.64989302e+03  6.64989302e+03  9.08893504e+03
  2.54430879e+04  7.61836861e+04]
E1 = -727.7980137087565  E_coul = 201.0566420328651
cycle= 1 E= -526.741371675891  delta_E= -0.39  |g|= 0.188  |ddm|= 0.327
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.54892
diis-c [-0.30131354  1.        ]
  HOMO = -0.592087619793987  LUMO = 0.698082015376305
  mo_energy =
[-1.18641817e+02 -1.23473016e+01 -9.59891688e+00 -9.59891688e+00
 -9.59891688e+00 -1.28075064e+00 -5.92087620e-01 -5.92087620e-01
 -5.92087620e-01  6.98082015e-01  9.86878486e-01  9.86878486e-01
  9.86878486e-01  5.35797027e+00  7.01781606e+00  7.01781606e+00
  7.01781606e+00  2.64999726e+01  3.27776978e+01  3.27776978e+01
  3.27776978e+01  1.28404087e+02  1.28404087e+02  1.28404087e+02
  1.32926983e+02  4.82899685e+02  4.82899685e+02  4.82899685e+02
  6.18579464e+02  1.33474015e+03  1.33474015e+03  1.33474015e+03
  2.68509724e+03  3.02893217e+03  3.02893217e+03  3.02893217e+03
  6.64934483e+03  6.64934483e+03  6.64934483e+03  9.08831148e+03
  2.54423700e+04  7.61828780e+04]
E1 = -728.3853270604865  E_coul = 201.6432053087776
cycle= 2 E= -526.742121751709  delta_E= -0.00075  |g|= 0.0385  |ddm|= 0.0522
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776541
diis-c [-0.00353579  0.08384951  0.91615049]
  HOMO = -0.582793469035322  LUMO = 0.703911277539367
  mo_energy =
[-1.18572754e+02 -1.23084003e+01 -9.55831979e+00 -9.55831979e+00
 -9.55831979e+00 -1.26960283e+00 -5.82793469e-01 -5.82793469e-01
 -5.82793469e-01  7.03911278e-01  9.93600255e-01  9.93600255e-01
  9.93600255e-01  5.37678727e+00  7.04168626e+00  7.04168626e+00
  7.04168626e+00  2.65359245e+01  3.28185928e+01  3.28185928e+01
  3.28185928e+01  1.28461196e+02  1.28461196e+02  1.28461196e+02
  1.32984152e+02  4.82967931e+02  4.82967931e+02  4.82967931e+02
  6.18649916e+02  1.33481250e+03  1.33481250e+03  1.33481250e+03
  2.68517291e+03  3.02900679e+03  3.02900679e+03  3.02900679e+03
  6.64942122e+03  6.64942122e+03  6.64942122e+03  9.08838869e+03
  2.54424478e+04  7.61829561e+04]
E1 = -728.2299960183086  E_coul = 201.4878118285925
cycle= 3 E= -526.742184189716  delta_E= -6.24e-05  |g|= 0.00645  |ddm|= 0.0158
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135799
diis-c [-8.68188255e-07 -1.31239283e-03  1.44186806e-01  8.57125587e-01]
  HOMO = -0.584348791992891  LUMO = 0.703019323058409
  mo_energy =
[-1.18582968e+02 -1.23143759e+01 -9.56465683e+00 -9.56465683e+00
 -9.56465683e+00 -1.27134148e+00 -5.84348792e-01 -5.84348792e-01
 -5.84348792e-01  7.03019323e-01  9.92502051e-01  9.92502051e-01
  9.92502051e-01  5.37381303e+00  7.03785083e+00  7.03785083e+00
  7.03785083e+00  2.65303686e+01  3.28122487e+01  3.28122487e+01
  3.28122487e+01  1.28452617e+02  1.28452617e+02  1.28452617e+02
  1.32975603e+02  4.82957833e+02  4.82957833e+02  4.82957833e+02
  6.18639482e+02  1.33480180e+03  1.33480180e+03  1.33480180e+03
  2.68516157e+03  3.02899570e+03  3.02899570e+03  3.02899570e+03
  6.64940973e+03  6.64940973e+03  6.64940973e+03  9.08837697e+03
  2.54424359e+04  7.61829441e+04]
E1 = -728.253570554583  E_coul = 201.5113843108176
cycle= 4 E= -526.742186243765  delta_E= -2.05e-06  |g|= 0.000116  |ddm|= 0.00223
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000133388
diis-c [-7.18089044e-09  1.00286775e-04 -1.36779577e-02 -8.55330558e-02
  1.09911073e+00]
  HOMO = -0.58433146418103  LUMO = 0.703047789418586
  mo_energy =
[-1.18582919e+02 -1.23143049e+01 -9.56460081e+00 -9.56460081e+00
 -9.56460081e+00 -1.27129598e+00 -5.84331464e-01 -5.84331464e-01
 -5.84331464e-01  7.03047789e-01  9.92517453e-01  9.92517453e-01
  9.92517453e-01  5.37386434e+00  7.03789409e+00  7.03789409e+00
  7.03789409e+00  2.65304310e+01  3.28123025e+01  3.28123025e+01
  3.28123025e+01  1.28452672e+02  1.28452672e+02  1.28452672e+02
  1.32975661e+02  4.82957882e+02  4.82957882e+02  4.82957882e+02
  6.18639523e+02  1.33480184e+03  1.33480184e+03  1.33480184e+03
  2.68516159e+03  3.02899573e+03  3.02899573e+03  3.02899573e+03
  6.64940974e+03  6.64940974e+03  6.64940974e+03  9.08837698e+03
  2.54424359e+04  7.61829441e+04]
E1 = -728.2533073692418  E_coul = 201.51112112274387
cycle= 5 E= -526.742186246498  delta_E= -2.73e-09  |g|= 2.24e-05  |ddm|= 0.000203
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.10924e-05
diis-c [-1.30360908e-10  1.35904926e-05 -1.67677740e-03 -1.27709031e-02
  1.73285854e-02  9.97105505e-01]
  HOMO = -0.584340307387059  LUMO = 0.703044689033226
  mo_energy =
[-1.18582954e+02 -1.23143309e+01 -9.56462888e+00 -9.56462888e+00
 -9.56462888e+00 -1.27130296e+00 -5.84340307e-01 -5.84340307e-01
 -5.84340307e-01  7.03044689e-01  9.92511679e-01  9.92511679e-01
  9.92511679e-01  5.37385035e+00  7.03787509e+00  7.03787509e+00
  7.03787509e+00  2.65304066e+01  3.28122754e+01  3.28122754e+01
  3.28122754e+01  1.28452640e+02  1.28452640e+02  1.28452640e+02
  1.32975630e+02  4.82957848e+02  4.82957848e+02  4.82957848e+02
  6.18639488e+02  1.33480181e+03  1.33480181e+03  1.33480181e+03
  2.68516155e+03  3.02899569e+03  3.02899569e+03  3.02899569e+03
  6.64940970e+03  6.64940970e+03  6.64940970e+03  9.08837694e+03
  2.54424358e+04  7.61829440e+04]
E1 = -728.2533989656251  E_coul = 201.51121271905203
cycle= 6 E= -526.742186246573  delta_E= -7.5e-11  |g|= 1.93e-06  |ddm|= 2.43e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2533989656251  E_coul = 201.51121271905203
  HOMO = -0.584340006472933  LUMO = 0.703045147619142
  mo_energy =
[-1.18582952e+02 -1.23143297e+01 -9.56462762e+00 -9.56462762e+00
 -9.56462762e+00 -1.27130222e+00 -5.84340006e-01 -5.84340006e-01
 -5.84340006e-01  7.03045148e-01  9.92511943e-01  9.92511943e-01
  9.92511943e-01  5.37385118e+00  7.03787591e+00  7.03787591e+00
  7.03787591e+00  2.65304078e+01  3.28122766e+01  3.28122766e+01
  3.28122766e+01  1.28452642e+02  1.28452642e+02  1.28452642e+02
  1.32975631e+02  4.82957850e+02  4.82957850e+02  4.82957850e+02
  6.18639490e+02  1.33480181e+03  1.33480181e+03  1.33480181e+03
  2.68516155e+03  3.02899569e+03  3.02899569e+03  3.02899569e+03
  6.64940971e+03  6.64940971e+03  6.64940971e+03  9.08837694e+03
  2.54424358e+04  7.61829440e+04]
E1 = -728.2533933632284  E_coul = 201.51120711665436
Extra cycle  E= -526.742186246574  delta_E= -9.09e-13  |g|= 4.47e-07  |ddm|= 3.34e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 110919.17923568077
E1 = -728.2533933632284  E_coul = 201.51120711665436
init E= -526.742186246574
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.584340133548718  LUMO = 0.703045128281221
  mo_energy =
[-1.18582953e+02 -1.23143301e+01 -9.56462806e+00 -9.56462806e+00
 -9.56462806e+00 -1.27130229e+00 -5.84340134e-01 -5.84340134e-01
 -5.84340134e-01  7.03045128e-01  9.92511864e-01  9.92511864e-01
  9.92511864e-01  5.37385100e+00  7.03787564e+00  7.03787564e+00
  7.03787564e+00  2.65304074e+01  3.28122762e+01  3.28122762e+01
  3.28122762e+01  1.28452641e+02  1.28452641e+02  1.28452641e+02
  1.32975631e+02  4.82957849e+02  4.82957849e+02  4.82957849e+02
  6.18639489e+02  1.33480181e+03  1.33480181e+03  1.33480181e+03
  2.68516155e+03  3.02899569e+03  3.02899569e+03  3.02899569e+03
  6.64940971e+03  6.64940971e+03  6.64940971e+03  9.08837694e+03
  2.54424358e+04  7.61829440e+04]
E1 = -728.2533947623023  E_coul = 201.51120851572767
cycle= 1 E= -526.742186246575  delta_E= -6.82e-13  |g|= 1.18e-07  |ddm|= 6.18e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2533947623023  E_coul = 201.51120851572767
  HOMO = -0.584340110836074  LUMO = 0.703045154186403
  mo_energy =
[-1.18582952e+02 -1.23143300e+01 -9.56462796e+00 -9.56462796e+00
 -9.56462796e+00 -1.27130224e+00 -5.84340111e-01 -5.84340111e-01
 -5.84340111e-01  7.03045154e-01  9.92511883e-01  9.92511883e-01
  9.92511883e-01  5.37385105e+00  7.03787570e+00  7.03787570e+00
  7.03787570e+00  2.65304075e+01  3.28122763e+01  3.28122763e+01
  3.28122763e+01  1.28452641e+02  1.28452641e+02  1.28452641e+02
  1.32975631e+02  4.82957850e+02  4.82957850e+02  4.82957850e+02
  6.18639490e+02  1.33480181e+03  1.33480181e+03  1.33480181e+03
  2.68516155e+03  3.02899569e+03  3.02899569e+03  3.02899569e+03
  6.64940971e+03  6.64940971e+03  6.64940971e+03  9.08837694e+03
  2.54424358e+04  7.61829440e+04]
E1 = -728.2533943239212  E_coul = 201.5112080773467
Extra cycle  E= -526.742186246574  delta_E= 2.27e-13  |g|= 2.92e-08  |ddm|= 1.54e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61826578e+04 7.61751768e+03 3.61735297e+03 1.59773840e+03
 3.82784651e+02 1.09300779e+02 3.75324684e+01 1.05983765e+01
 4.51556371e+00 5.80224452e-01 1.77958519e+00 1.99492679e-01
 1.36278387e+03 6.64739149e+02 3.00931207e+02 3.14015732e+02
 6.16326548e+01 7.21808391e+00 2.03187427e+01 7.64925817e-01
 2.71999040e+00 2.19705785e-01]
grad_E = [-1.50285093e-06  3.14722157e-06 -1.65871697e-06  6.27684006e-05
  2.13175638e-04 -2.66078635e-03  2.13180678e-03 -1.24986695e-04
 -6.88838495e-04 -4.56773651e-03 -1.86621826e-03 -9.41128771e-03
 -4.60765190e-07  5.61162429e-06  2.72791499e-05  2.35100461e-05
 -4.14076182e-04 -4.96698255e-03  2.88864663e-03  2.21714026e-03
 -9.81196787e-04 -9.90505349e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:39 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6578232        1
[INPUT] 0    0    [1    /1   ]  7617.51769502        1
[INPUT] 0    0    [1    /1   ]  3617.3529657         1
[INPUT] 0    0    [1    /1   ]  1597.7388549         1
[INPUT] 0    0    [1    /1   ]  382.781854361        1
[INPUT] 0    0    [1    /1   ]  109.321927498        1
[INPUT] 0    0    [1    /1   ]  37.4644305454        1
[INPUT] 0    0    [1    /1   ]  10.5759401662        1
[INPUT] 0    0    [1    /1   ]  4.46930764982        1
[INPUT] 0    0    [1    /1   ]  0.581210249129       1
[INPUT] 0    0    [1    /1   ]  1.75411041363        1
[INPUT] 0    0    [1    /1   ]  0.20065501095        1
[INPUT] 1    0    [1    /1   ]  1362.78386753        1
[INPUT] 1    0    [1    /1   ]  664.739175635        1
[INPUT] 1    0    [1    /1   ]  300.931332336        1
[INPUT] 1    0    [1    /1   ]  314.015839545        1
[INPUT] 1    0    [1    /1   ]  61.6329442139        1
[INPUT] 1    0    [1    /1   ]  7.22399718538        1
[INPUT] 1    0    [1    /1   ]  20.3156877831        1
[INPUT] 1    0    [1    /1   ]  0.765056205141       1
[INPUT] 1    0    [1    /1   ]  2.72049291316        1
[INPUT] 1    0    [1    /1   ]  0.22070737842        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657823224563, 1.0]], [0, [7617.517695019193, 1.0]], [0, [3617.3529656950373, 1.0]], [0, [1597.7388549013324, 1.0]], [0, [382.7818543610313, 1.0]], [0, [109.32192749780457, 1.0]], [0, [37.46443054543064, 1.0]], [0, [10.575940166186008, 1.0]], [0, [4.469307649818057, 1.0]], [0, [0.5812102491289575, 1.0]], [0, [1.754110413630775, 1.0]], [0, [0.2006550109500882, 1.0]], [1, [1362.7838675348623, 1.0]], [1, [664.7391756352766, 1.0]], [1, [300.9313323364127, 1.0]], [1, [314.01583954490553, 1.0]], [1, [61.63294421394794, 1.0]], [1, [7.2239971853828715, 1.0]], [1, [20.31568778305364, 1.0]], [1, [0.765056205141444, 1.0]], [1, [2.720492913157881, 1.0]], [1, [0.22070737841989851, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65782322]
bas 1, expnt(s) = [7617.51769502]
bas 2, expnt(s) = [3617.3529657]
bas 3, expnt(s) = [1597.7388549]
bas 4, expnt(s) = [382.78185436]
bas 5, expnt(s) = [109.3219275]
bas 6, expnt(s) = [37.46443055]
bas 7, expnt(s) = [10.57594017]
bas 8, expnt(s) = [4.46930765]
bas 9, expnt(s) = [0.58121025]
bas 10, expnt(s) = [1.75411041]
bas 11, expnt(s) = [0.20065501]
bas 12, expnt(s) = [1362.78386753]
bas 13, expnt(s) = [664.73917564]
bas 14, expnt(s) = [300.93133234]
bas 15, expnt(s) = [314.01583954]
bas 16, expnt(s) = [61.63294421]
bas 17, expnt(s) = [7.22399719]
bas 18, expnt(s) = [20.31568778]
bas 19, expnt(s) = [0.76505621]
bas 20, expnt(s) = [2.72049291]
bas 21, expnt(s) = [0.22070738]
CPU time:       177.82
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826578e+04 5.20026316e+03 7.61751770e+03 2.06003751e+03
 3.61735297e+03 1.17844194e+03 1.59773885e+03 6.38475698e+02
 3.82781854e+02 2.18639452e+02 1.09321927e+02 8.54172302e+01
 3.74644305e+01 3.82586266e+01 1.05759402e+01 1.48167947e+01
 4.46930765e+00 7.76596113e+00 5.81210249e-01 1.68176369e+00
 1.75411041e+00 3.85085991e+00 2.00655011e-01 7.57447491e-01
 1.36278387e+03 2.41556163e+04 6.64739176e+02 9.84687637e+03
 3.00931332e+02 3.65652589e+03 3.14015840e+02 3.85632685e+03
 6.16329442e+01 5.03791152e+02 7.22399719e+00 3.45506604e+01
 2.03156878e+01 1.25826989e+02 7.65056205e-01 2.08737785e+00
 2.72049291e+00 1.01928091e+01 2.20707378e-01 4.41321878e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994146929056697
cond(S) = 110877.73824312445
E1 = -729.5232479875353  E_coul = 203.17139634730657
init E= -526.351851640229
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555979119041402  LUMO = 0.721272927326676
  mo_energy =
[-1.18329605e+02 -1.22068115e+01 -9.44728452e+00 -9.44728452e+00
 -9.44728452e+00 -1.24026894e+00 -5.55979119e-01 -5.55979119e-01
 -5.55979119e-01  7.21272927e-01  1.01557688e+00  1.01557688e+00
  1.01557688e+00  5.37299002e+00  7.11616031e+00  7.11616031e+00
  7.11616031e+00  2.63710223e+01  3.29520300e+01  3.29520300e+01
  3.29520300e+01  1.28653155e+02  1.28653155e+02  1.28653155e+02
  1.32651952e+02  4.83222677e+02  4.83222677e+02  4.83222677e+02
  6.18376401e+02  1.33511792e+03  1.33511792e+03  1.33511792e+03
  2.68511007e+03  3.02937641e+03  3.02937641e+03  3.02937641e+03
  6.64990222e+03  6.64990222e+03  6.64990222e+03  9.08848590e+03
  2.54426630e+04  7.61832904e+04]
E1 = -727.8152154492985  E_coul = 201.0736753936199
cycle= 1 E= -526.741540055679  delta_E= -0.39  |g|= 0.187  |ddm|= 0.326
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.548533
diis-c [-0.30088896  1.        ]
  HOMO = -0.591426300183056  LUMO = 0.701776285788526
  mo_energy =
[-1.18640643e+02 -1.23461309e+01 -9.59778918e+00 -9.59778918e+00
 -9.59778918e+00 -1.28002317e+00 -5.91426300e-01 -5.91426300e-01
 -5.91426300e-01  7.01776286e-01  9.91297048e-01  9.91297048e-01
  9.91297048e-01  5.30519791e+00  7.02581375e+00  7.02581375e+00
  7.02581375e+00  2.62402411e+01  3.27960816e+01  3.27960816e+01
  3.27960816e+01  1.28421957e+02  1.28421957e+02  1.28421957e+02
  1.32426132e+02  4.82912706e+02  4.82912706e+02  4.82912706e+02
  6.18029349e+02  1.33475172e+03  1.33475172e+03  1.33475172e+03
  2.68460888e+03  3.02894326e+03  3.02894326e+03  3.02894326e+03
  6.64935531e+03  6.64935531e+03  6.64935531e+03  9.08786362e+03
  2.54419464e+04  7.61824836e+04]
E1 = -728.3971870342436  E_coul = 201.65490690035392
cycle= 2 E= -526.74228013389  delta_E= -0.00074  |g|= 0.0383  |ddm|= 0.0517
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0771829
diis-c [-0.00350061  0.08331522  0.91668478]
  HOMO = -0.582234064909272  LUMO = 0.707545613952338
  mo_energy =
[-1.18572038e+02 -1.23075717e+01 -9.55754643e+00 -9.55754643e+00
 -9.55754643e+00 -1.26899357e+00 -5.82234065e-01 -5.82234065e-01
 -5.82234065e-01  7.07545614e-01  9.97959339e-01  9.97959339e-01
  9.97959339e-01  5.32367527e+00  7.04945463e+00  7.04945463e+00
  7.04945463e+00  2.62757831e+01  3.28366327e+01  3.28366327e+01
  3.28366327e+01  1.28478648e+02  1.28478648e+02  1.28478648e+02
  1.32482876e+02  4.82980497e+02  4.82980497e+02  4.82980497e+02
  6.18099341e+02  1.33482360e+03  1.33482360e+03  1.33482360e+03
  2.68468406e+03  3.02901741e+03  3.02901741e+03  3.02901741e+03
  6.64943121e+03  6.64943121e+03  6.64943121e+03  9.08794034e+03
  2.54420237e+04  7.61825613e+04]
E1 = -728.2435006038122  E_coul = 201.5011592128238
cycle= 3 E= -526.742341390988  delta_E= -6.13e-05  |g|= 0.00641  |ddm|= 0.0156
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135028
diis-c [-8.73182746e-07 -1.31198470e-03  1.44213027e-01  8.57098958e-01]
  HOMO = -0.58377360285434  LUMO = 0.706664870320854
  mo_energy =
[-1.18582187e+02 -1.23135003e+01 -9.56383530e+00 -9.56383530e+00
 -9.56383530e+00 -1.27071239e+00 -5.83773603e-01 -5.83773603e-01
 -5.83773603e-01  7.06664870e-01  9.96870595e-01  9.96870595e-01
  9.96870595e-01  5.32075301e+00  7.04565237e+00  7.04565237e+00
  7.04565237e+00  2.62702854e+01  3.28303362e+01  3.28303362e+01
  3.28303362e+01  1.28470128e+02  1.28470128e+02  1.28470128e+02
  1.32474388e+02  4.82970464e+02  4.82970464e+02  4.82970464e+02
  6.18088972e+02  1.33481297e+03  1.33481297e+03  1.33481297e+03
  2.68467279e+03  3.02900638e+03  3.02900638e+03  3.02900638e+03
  6.64941979e+03  6.64941979e+03  6.64941979e+03  9.08792870e+03
  2.54420119e+04  7.61825493e+04]
E1 = -728.2668383200439  E_coul = 201.52449491103374
cycle= 4 E= -526.74234340901  delta_E= -2.02e-06  |g|= 0.000118  |ddm|= 0.00221
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000134976
diis-c [-7.30896014e-09  1.01659968e-04 -1.38626045e-02 -8.66945565e-02
  1.10045550e+00]
  HOMO = -0.583756170700096  LUMO = 0.706693742782249
  mo_energy =
[-1.18582138e+02 -1.23134290e+01 -9.56377917e+00 -9.56377917e+00
 -9.56377917e+00 -1.27066636e+00 -5.83756171e-01 -5.83756171e-01
 -5.83756171e-01  7.06693743e-01  9.96886151e-01  9.96886151e-01
  9.96886151e-01  5.32080447e+00  7.04569586e+00  7.04569586e+00
  7.04569586e+00  2.62703482e+01  3.28303902e+01  3.28303902e+01
  3.28303902e+01  1.28470183e+02  1.28470183e+02  1.28470183e+02
  1.32474446e+02  4.82970514e+02  4.82970514e+02  4.82970514e+02
  6.18089014e+02  1.33481301e+03  1.33481301e+03  1.33481301e+03
  2.68467281e+03  3.02900641e+03  3.02900641e+03  3.02900641e+03
  6.64941980e+03  6.64941980e+03  6.64941980e+03  9.08792870e+03
  2.54420119e+04  7.61825493e+04]
E1 = -728.266574875329  E_coul = 201.52423146350026
cycle= 5 E= -526.742343411829  delta_E= -2.82e-09  |g|= 2.25e-05  |ddm|= 0.000206
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.12889e-05
diis-c [-1.32118787e-10  1.36948520e-05 -1.68836623e-03 -1.28662984e-02
  1.72229185e-02  9.97318051e-01]
  HOMO = -0.583765062647821  LUMO = 0.70669063701134
  mo_energy =
[-1.18582173e+02 -1.23134553e+01 -9.56380741e+00 -9.56380741e+00
 -9.56380741e+00 -1.27067337e+00 -5.83765063e-01 -5.83765063e-01
 -5.83765063e-01  7.06690637e-01  9.96880338e-01  9.96880338e-01
  9.96880338e-01  5.32079051e+00  7.04567675e+00  7.04567675e+00
  7.04567675e+00  2.62703236e+01  3.28303629e+01  3.28303629e+01
  3.28303629e+01  1.28470152e+02  1.28470152e+02  1.28470152e+02
  1.32474415e+02  4.82970479e+02  4.82970479e+02  4.82970479e+02
  6.18088979e+02  1.33481297e+03  1.33481297e+03  1.33481297e+03
  2.68467278e+03  3.02900638e+03  3.02900638e+03  3.02900638e+03
  6.64941977e+03  6.64941977e+03  6.64941977e+03  9.08792867e+03
  2.54420119e+04  7.61825492e+04]
E1 = -728.2666666909561  E_coul = 201.5243232790526
cycle= 6 E= -526.742343411903  delta_E= -7.48e-11  |g|= 1.92e-06  |ddm|= 2.46e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2666666909561  E_coul = 201.5243232790526
  HOMO = -0.58376475909695  LUMO = 0.70669109484465
  mo_energy =
[-1.18582171e+02 -1.23134540e+01 -9.56380613e+00 -9.56380613e+00
 -9.56380613e+00 -1.27067263e+00 -5.83764759e-01 -5.83764759e-01
 -5.83764759e-01  7.06691095e-01  9.96880603e-01  9.96880603e-01
  9.96880603e-01  5.32079135e+00  7.04567758e+00  7.04567758e+00
  7.04567758e+00  2.62703248e+01  3.28303642e+01  3.28303642e+01
  3.28303642e+01  1.28470153e+02  1.28470153e+02  1.28470153e+02
  1.32474416e+02  4.82970481e+02  4.82970481e+02  4.82970481e+02
  6.18088981e+02  1.33481298e+03  1.33481298e+03  1.33481298e+03
  2.68467278e+03  3.02900638e+03  3.02900638e+03  3.02900638e+03
  6.64941977e+03  6.64941977e+03  6.64941977e+03  9.08792867e+03
  2.54420119e+04  7.61825492e+04]
E1 = -728.2666610390007  E_coul = 201.52431762709554
Extra cycle  E= -526.742343411905  delta_E= -1.71e-12  |g|= 4.48e-07  |ddm|= 3.33e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826578e+04 7.61751770e+03 3.61735297e+03 1.59773885e+03
 3.82781854e+02 1.09321927e+02 3.74644305e+01 1.05759402e+01
 4.46930765e+00 5.81210249e-01 1.75411041e+00 2.00655011e-01
 1.36278387e+03 6.64739176e+02 3.00931332e+02 3.14015840e+02
 6.16329442e+01 7.22399719e+00 2.03156878e+01 7.65056205e-01
 2.72049291e+00 2.20707378e-01]
E = -526.7423434119052
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:40 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6578232        1
[INPUT] 0    0    [1    /1   ]  7617.51769502        1
[INPUT] 0    0    [1    /1   ]  3617.3529657         1
[INPUT] 0    0    [1    /1   ]  1597.7388549         1
[INPUT] 0    0    [1    /1   ]  382.781854361        1
[INPUT] 0    0    [1    /1   ]  109.321927498        1
[INPUT] 0    0    [1    /1   ]  37.4644305454        1
[INPUT] 0    0    [1    /1   ]  10.5759401662        1
[INPUT] 0    0    [1    /1   ]  4.46930764982        1
[INPUT] 0    0    [1    /1   ]  0.581210249129       1
[INPUT] 0    0    [1    /1   ]  1.75411041363        1
[INPUT] 0    0    [1    /1   ]  0.20065501095        1
[INPUT] 1    0    [1    /1   ]  1362.78386753        1
[INPUT] 1    0    [1    /1   ]  664.739175635        1
[INPUT] 1    0    [1    /1   ]  300.931332336        1
[INPUT] 1    0    [1    /1   ]  314.015839545        1
[INPUT] 1    0    [1    /1   ]  61.6329442139        1
[INPUT] 1    0    [1    /1   ]  7.22399718538        1
[INPUT] 1    0    [1    /1   ]  20.3156877831        1
[INPUT] 1    0    [1    /1   ]  0.765056205141       1
[INPUT] 1    0    [1    /1   ]  2.72049291316        1
[INPUT] 1    0    [1    /1   ]  0.22070737842        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657823224563, 1.0]], [0, [7617.517695019193, 1.0]], [0, [3617.3529656950373, 1.0]], [0, [1597.7388549013324, 1.0]], [0, [382.7818543610313, 1.0]], [0, [109.32192749780457, 1.0]], [0, [37.46443054543064, 1.0]], [0, [10.575940166186008, 1.0]], [0, [4.469307649818057, 1.0]], [0, [0.5812102491289575, 1.0]], [0, [1.754110413630775, 1.0]], [0, [0.2006550109500882, 1.0]], [1, [1362.7838675348623, 1.0]], [1, [664.7391756352766, 1.0]], [1, [300.9313323364127, 1.0]], [1, [314.01583954490553, 1.0]], [1, [61.63294421394794, 1.0]], [1, [7.2239971853828715, 1.0]], [1, [20.31568778305364, 1.0]], [1, [0.765056205141444, 1.0]], [1, [2.720492913157881, 1.0]], [1, [0.22070737841989851, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65782322]
bas 1, expnt(s) = [7617.51769502]
bas 2, expnt(s) = [3617.3529657]
bas 3, expnt(s) = [1597.7388549]
bas 4, expnt(s) = [382.78185436]
bas 5, expnt(s) = [109.3219275]
bas 6, expnt(s) = [37.46443055]
bas 7, expnt(s) = [10.57594017]
bas 8, expnt(s) = [4.46930765]
bas 9, expnt(s) = [0.58121025]
bas 10, expnt(s) = [1.75411041]
bas 11, expnt(s) = [0.20065501]
bas 12, expnt(s) = [1362.78386753]
bas 13, expnt(s) = [664.73917564]
bas 14, expnt(s) = [300.93133234]
bas 15, expnt(s) = [314.01583954]
bas 16, expnt(s) = [61.63294421]
bas 17, expnt(s) = [7.22399719]
bas 18, expnt(s) = [20.31568778]
bas 19, expnt(s) = [0.76505621]
bas 20, expnt(s) = [2.72049291]
bas 21, expnt(s) = [0.22070738]
CPU time:       178.20
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826578e+04 5.20026316e+03 7.61751770e+03 2.06003751e+03
 3.61735297e+03 1.17844194e+03 1.59773885e+03 6.38475698e+02
 3.82781854e+02 2.18639452e+02 1.09321927e+02 8.54172302e+01
 3.74644305e+01 3.82586266e+01 1.05759402e+01 1.48167947e+01
 4.46930765e+00 7.76596113e+00 5.81210249e-01 1.68176369e+00
 1.75411041e+00 3.85085991e+00 2.00655011e-01 7.57447491e-01
 1.36278387e+03 2.41556163e+04 6.64739176e+02 9.84687637e+03
 3.00931332e+02 3.65652589e+03 3.14015840e+02 3.85632685e+03
 6.16329442e+01 5.03791152e+02 7.22399719e+00 3.45506604e+01
 2.03156878e+01 1.25826989e+02 7.65056205e-01 2.08737785e+00
 2.72049291e+00 1.01928091e+01 2.20707378e-01 4.41321878e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994146929056697
cond(S) = 110877.73824312445
E1 = -729.5232479875353  E_coul = 203.17139634730657
init E= -526.351851640229
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555979119041402  LUMO = 0.721272927326676
  mo_energy =
[-1.18329605e+02 -1.22068115e+01 -9.44728452e+00 -9.44728452e+00
 -9.44728452e+00 -1.24026894e+00 -5.55979119e-01 -5.55979119e-01
 -5.55979119e-01  7.21272927e-01  1.01557688e+00  1.01557688e+00
  1.01557688e+00  5.37299002e+00  7.11616031e+00  7.11616031e+00
  7.11616031e+00  2.63710223e+01  3.29520300e+01  3.29520300e+01
  3.29520300e+01  1.28653155e+02  1.28653155e+02  1.28653155e+02
  1.32651952e+02  4.83222677e+02  4.83222677e+02  4.83222677e+02
  6.18376401e+02  1.33511792e+03  1.33511792e+03  1.33511792e+03
  2.68511007e+03  3.02937641e+03  3.02937641e+03  3.02937641e+03
  6.64990222e+03  6.64990222e+03  6.64990222e+03  9.08848590e+03
  2.54426630e+04  7.61832904e+04]
E1 = -727.8152154492985  E_coul = 201.0736753936199
cycle= 1 E= -526.741540055679  delta_E= -0.39  |g|= 0.187  |ddm|= 0.326
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.548533
diis-c [-0.30088896  1.        ]
  HOMO = -0.591426300183056  LUMO = 0.701776285788526
  mo_energy =
[-1.18640643e+02 -1.23461309e+01 -9.59778918e+00 -9.59778918e+00
 -9.59778918e+00 -1.28002317e+00 -5.91426300e-01 -5.91426300e-01
 -5.91426300e-01  7.01776286e-01  9.91297048e-01  9.91297048e-01
  9.91297048e-01  5.30519791e+00  7.02581375e+00  7.02581375e+00
  7.02581375e+00  2.62402411e+01  3.27960816e+01  3.27960816e+01
  3.27960816e+01  1.28421957e+02  1.28421957e+02  1.28421957e+02
  1.32426132e+02  4.82912706e+02  4.82912706e+02  4.82912706e+02
  6.18029349e+02  1.33475172e+03  1.33475172e+03  1.33475172e+03
  2.68460888e+03  3.02894326e+03  3.02894326e+03  3.02894326e+03
  6.64935531e+03  6.64935531e+03  6.64935531e+03  9.08786362e+03
  2.54419464e+04  7.61824836e+04]
E1 = -728.3971870342436  E_coul = 201.65490690035392
cycle= 2 E= -526.74228013389  delta_E= -0.00074  |g|= 0.0383  |ddm|= 0.0517
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0771829
diis-c [-0.00350061  0.08331522  0.91668478]
  HOMO = -0.582234064909272  LUMO = 0.707545613952338
  mo_energy =
[-1.18572038e+02 -1.23075717e+01 -9.55754643e+00 -9.55754643e+00
 -9.55754643e+00 -1.26899357e+00 -5.82234065e-01 -5.82234065e-01
 -5.82234065e-01  7.07545614e-01  9.97959339e-01  9.97959339e-01
  9.97959339e-01  5.32367527e+00  7.04945463e+00  7.04945463e+00
  7.04945463e+00  2.62757831e+01  3.28366327e+01  3.28366327e+01
  3.28366327e+01  1.28478648e+02  1.28478648e+02  1.28478648e+02
  1.32482876e+02  4.82980497e+02  4.82980497e+02  4.82980497e+02
  6.18099341e+02  1.33482360e+03  1.33482360e+03  1.33482360e+03
  2.68468406e+03  3.02901741e+03  3.02901741e+03  3.02901741e+03
  6.64943121e+03  6.64943121e+03  6.64943121e+03  9.08794034e+03
  2.54420237e+04  7.61825613e+04]
E1 = -728.2435006038122  E_coul = 201.5011592128238
cycle= 3 E= -526.742341390988  delta_E= -6.13e-05  |g|= 0.00641  |ddm|= 0.0156
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135028
diis-c [-8.73182746e-07 -1.31198470e-03  1.44213027e-01  8.57098958e-01]
  HOMO = -0.58377360285434  LUMO = 0.706664870320854
  mo_energy =
[-1.18582187e+02 -1.23135003e+01 -9.56383530e+00 -9.56383530e+00
 -9.56383530e+00 -1.27071239e+00 -5.83773603e-01 -5.83773603e-01
 -5.83773603e-01  7.06664870e-01  9.96870595e-01  9.96870595e-01
  9.96870595e-01  5.32075301e+00  7.04565237e+00  7.04565237e+00
  7.04565237e+00  2.62702854e+01  3.28303362e+01  3.28303362e+01
  3.28303362e+01  1.28470128e+02  1.28470128e+02  1.28470128e+02
  1.32474388e+02  4.82970464e+02  4.82970464e+02  4.82970464e+02
  6.18088972e+02  1.33481297e+03  1.33481297e+03  1.33481297e+03
  2.68467279e+03  3.02900638e+03  3.02900638e+03  3.02900638e+03
  6.64941979e+03  6.64941979e+03  6.64941979e+03  9.08792870e+03
  2.54420119e+04  7.61825493e+04]
E1 = -728.2668383200439  E_coul = 201.52449491103374
cycle= 4 E= -526.74234340901  delta_E= -2.02e-06  |g|= 0.000118  |ddm|= 0.00221
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000134976
diis-c [-7.30896014e-09  1.01659968e-04 -1.38626045e-02 -8.66945565e-02
  1.10045550e+00]
  HOMO = -0.583756170700096  LUMO = 0.706693742782249
  mo_energy =
[-1.18582138e+02 -1.23134290e+01 -9.56377917e+00 -9.56377917e+00
 -9.56377917e+00 -1.27066636e+00 -5.83756171e-01 -5.83756171e-01
 -5.83756171e-01  7.06693743e-01  9.96886151e-01  9.96886151e-01
  9.96886151e-01  5.32080447e+00  7.04569586e+00  7.04569586e+00
  7.04569586e+00  2.62703482e+01  3.28303902e+01  3.28303902e+01
  3.28303902e+01  1.28470183e+02  1.28470183e+02  1.28470183e+02
  1.32474446e+02  4.82970514e+02  4.82970514e+02  4.82970514e+02
  6.18089014e+02  1.33481301e+03  1.33481301e+03  1.33481301e+03
  2.68467281e+03  3.02900641e+03  3.02900641e+03  3.02900641e+03
  6.64941980e+03  6.64941980e+03  6.64941980e+03  9.08792870e+03
  2.54420119e+04  7.61825493e+04]
E1 = -728.266574875329  E_coul = 201.52423146350026
cycle= 5 E= -526.742343411829  delta_E= -2.82e-09  |g|= 2.25e-05  |ddm|= 0.000206
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.12889e-05
diis-c [-1.32118787e-10  1.36948520e-05 -1.68836623e-03 -1.28662984e-02
  1.72229185e-02  9.97318051e-01]
  HOMO = -0.583765062647821  LUMO = 0.70669063701134
  mo_energy =
[-1.18582173e+02 -1.23134553e+01 -9.56380741e+00 -9.56380741e+00
 -9.56380741e+00 -1.27067337e+00 -5.83765063e-01 -5.83765063e-01
 -5.83765063e-01  7.06690637e-01  9.96880338e-01  9.96880338e-01
  9.96880338e-01  5.32079051e+00  7.04567675e+00  7.04567675e+00
  7.04567675e+00  2.62703236e+01  3.28303629e+01  3.28303629e+01
  3.28303629e+01  1.28470152e+02  1.28470152e+02  1.28470152e+02
  1.32474415e+02  4.82970479e+02  4.82970479e+02  4.82970479e+02
  6.18088979e+02  1.33481297e+03  1.33481297e+03  1.33481297e+03
  2.68467278e+03  3.02900638e+03  3.02900638e+03  3.02900638e+03
  6.64941977e+03  6.64941977e+03  6.64941977e+03  9.08792867e+03
  2.54420119e+04  7.61825492e+04]
E1 = -728.2666666909561  E_coul = 201.5243232790526
cycle= 6 E= -526.742343411903  delta_E= -7.48e-11  |g|= 1.92e-06  |ddm|= 2.46e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2666666909561  E_coul = 201.5243232790526
  HOMO = -0.58376475909695  LUMO = 0.70669109484465
  mo_energy =
[-1.18582171e+02 -1.23134540e+01 -9.56380613e+00 -9.56380613e+00
 -9.56380613e+00 -1.27067263e+00 -5.83764759e-01 -5.83764759e-01
 -5.83764759e-01  7.06691095e-01  9.96880603e-01  9.96880603e-01
  9.96880603e-01  5.32079135e+00  7.04567758e+00  7.04567758e+00
  7.04567758e+00  2.62703248e+01  3.28303642e+01  3.28303642e+01
  3.28303642e+01  1.28470153e+02  1.28470153e+02  1.28470153e+02
  1.32474416e+02  4.82970481e+02  4.82970481e+02  4.82970481e+02
  6.18088981e+02  1.33481298e+03  1.33481298e+03  1.33481298e+03
  2.68467278e+03  3.02900638e+03  3.02900638e+03  3.02900638e+03
  6.64941977e+03  6.64941977e+03  6.64941977e+03  9.08792867e+03
  2.54420119e+04  7.61825492e+04]
E1 = -728.2666610390007  E_coul = 201.52431762709554
Extra cycle  E= -526.742343411905  delta_E= -1.71e-12  |g|= 4.48e-07  |ddm|= 3.33e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 110877.73824312445
E1 = -728.2666610390007  E_coul = 201.52431762709554
init E= -526.742343411905
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583764886907329  LUMO = 0.706691074638379
  mo_energy =
[-1.18582171e+02 -1.23134544e+01 -9.56380657e+00 -9.56380657e+00
 -9.56380657e+00 -1.27067270e+00 -5.83764887e-01 -5.83764887e-01
 -5.83764887e-01  7.06691075e-01  9.96880524e-01  9.96880524e-01
  9.96880524e-01  5.32079116e+00  7.04567730e+00  7.04567730e+00
  7.04567730e+00  2.62703245e+01  3.28303637e+01  3.28303637e+01
  3.28303637e+01  1.28470153e+02  1.28470153e+02  1.28470153e+02
  1.32474416e+02  4.82970480e+02  4.82970480e+02  4.82970480e+02
  6.18088980e+02  1.33481298e+03  1.33481298e+03  1.33481298e+03
  2.68467278e+03  3.02900638e+03  3.02900638e+03  3.02900638e+03
  6.64941977e+03  6.64941977e+03  6.64941977e+03  9.08792867e+03
  2.54420119e+04  7.61825492e+04]
E1 = -728.2666624491285  E_coul = 201.52431903722254
cycle= 1 E= -526.742343411906  delta_E= -7.96e-13  |g|= 1.18e-07  |ddm|= 6.15e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2666624491285  E_coul = 201.52431903722254
  HOMO = -0.583764864025812  LUMO = 0.706691100534216
  mo_energy =
[-1.18582171e+02 -1.23134543e+01 -9.56380647e+00 -9.56380647e+00
 -9.56380647e+00 -1.27067265e+00 -5.83764864e-01 -5.83764864e-01
 -5.83764864e-01  7.06691101e-01  9.96880542e-01  9.96880542e-01
  9.96880542e-01  5.32079122e+00  7.04567737e+00  7.04567737e+00
  7.04567737e+00  2.62703246e+01  3.28303638e+01  3.28303638e+01
  3.28303638e+01  1.28470153e+02  1.28470153e+02  1.28470153e+02
  1.32474416e+02  4.82970481e+02  4.82970481e+02  4.82970481e+02
  6.18088980e+02  1.33481298e+03  1.33481298e+03  1.33481298e+03
  2.68467278e+03  3.02900638e+03  3.02900638e+03  3.02900638e+03
  6.64941977e+03  6.64941977e+03  6.64941977e+03  9.08792867e+03
  2.54420119e+04  7.61825492e+04]
E1 = -728.2666620088067  E_coul = 201.524318596902
Extra cycle  E= -526.742343411905  delta_E= 1.14e-12  |g|= 2.93e-08  |ddm|= 1.53e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61826578e+04 7.61751770e+03 3.61735297e+03 1.59773885e+03
 3.82781854e+02 1.09321927e+02 3.74644305e+01 1.05759402e+01
 4.46930765e+00 5.81210249e-01 1.75411041e+00 2.00655011e-01
 1.36278387e+03 6.64739176e+02 3.00931332e+02 3.14015840e+02
 6.16329442e+01 7.22399719e+00 2.03156878e+01 7.65056205e-01
 2.72049291e+00 2.20707378e-01]
grad_E = [-1.50402798e-06  3.15973010e-06 -1.65333660e-06  6.32562793e-05
  1.98097957e-04 -2.56909985e-03  1.99641367e-03  1.48289955e-05
 -1.14867410e-03 -4.43344404e-03 -1.53682922e-03 -8.08848535e-03
 -4.64351983e-07  5.56623967e-06  2.70031264e-05  2.32725762e-05
 -3.82933049e-04 -4.01110915e-03  2.60481242e-03 -4.77208090e-03
 -1.80456708e-03  1.53310419e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:44 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6577879        1
[INPUT] 0    0    [1    /1   ]  7617.51777682        1
[INPUT] 0    0    [1    /1   ]  3617.35293245        1
[INPUT] 0    0    [1    /1   ]  1597.74068344        1
[INPUT] 0    0    [1    /1   ]  382.772850512        1
[INPUT] 0    0    [1    /1   ]  109.38836589         1
[INPUT] 0    0    [1    /1   ]  37.2252150244        1
[INPUT] 0    0    [1    /1   ]  10.4694221229        1
[INPUT] 0    0    [1    /1   ]  4.35113458007        1
[INPUT] 0    0    [1    /1   ]  0.591888244826       1
[INPUT] 0    0    [1    /1   ]  1.67381204847        1
[INPUT] 0    0    [1    /1   ]  0.208668865312       1
[INPUT] 1    0    [1    /1   ]  1362.78385571        1
[INPUT] 1    0    [1    /1   ]  664.739287703        1
[INPUT] 1    0    [1    /1   ]  300.931857165        1
[INPUT] 1    0    [1    /1   ]  314.016292111        1
[INPUT] 1    0    [1    /1   ]  61.6344042995        1
[INPUT] 1    0    [1    /1   ]  7.24906723784        1
[INPUT] 1    0    [1    /1   ]  20.301535671         1
[INPUT] 1    0    [1    /1   ]  0.766495433747       1
[INPUT] 1    0    [1    /1   ]  2.72678475554        1
[INPUT] 1    0    [1    /1   ]  0.222848338444       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657787922184, 1.0]], [0, [7617.517776822818, 1.0]], [0, [3617.352932451081, 1.0]], [0, [1597.740683437796, 1.0]], [0, [382.772850512094, 1.0]], [0, [109.38836588959536, 1.0]], [0, [37.22521502442007, 1.0]], [0, [10.469422122883383, 1.0]], [0, [4.351134580074177, 1.0]], [0, [0.5918882448260053, 1.0]], [0, [1.673812048466152, 1.0]], [0, [0.20866886531174567, 1.0]], [1, [1362.7838557148164, 1.0]], [1, [664.7392877031824, 1.0]], [1, [300.93185716547356, 1.0]], [1, [314.01629211104705, 1.0]], [1, [61.63440429945915, 1.0]], [1, [7.249067237840044, 1.0]], [1, [20.301535670954287, 1.0]], [1, [0.7664954337473279, 1.0]], [1, [2.7267847555433495, 1.0]], [1, [0.2228483384439887, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65778792]
bas 1, expnt(s) = [7617.51777682]
bas 2, expnt(s) = [3617.35293245]
bas 3, expnt(s) = [1597.74068344]
bas 4, expnt(s) = [382.77285051]
bas 5, expnt(s) = [109.38836589]
bas 6, expnt(s) = [37.22521502]
bas 7, expnt(s) = [10.46942212]
bas 8, expnt(s) = [4.35113458]
bas 9, expnt(s) = [0.59188824]
bas 10, expnt(s) = [1.67381205]
bas 11, expnt(s) = [0.20866887]
bas 12, expnt(s) = [1362.78385571]
bas 13, expnt(s) = [664.7392877]
bas 14, expnt(s) = [300.93185717]
bas 15, expnt(s) = [314.01629211]
bas 16, expnt(s) = [61.6344043]
bas 17, expnt(s) = [7.24906724]
bas 18, expnt(s) = [20.30153567]
bas 19, expnt(s) = [0.76649543]
bas 20, expnt(s) = [2.72678476]
bas 21, expnt(s) = [0.22284834]
CPU time:       183.95
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826578e+04 5.20026316e+03 7.61751778e+03 2.06003753e+03
 3.61735293e+03 1.17844193e+03 1.59774068e+03 6.38476246e+02
 3.82772851e+02 2.18635595e+02 1.09388366e+02 8.54561603e+01
 3.72252150e+01 3.80752651e+01 1.04694221e+01 1.47047301e+01
 4.35113458e+00 7.61144146e+00 5.91888245e-01 1.70488390e+00
 1.67381205e+00 3.71787720e+00 2.08668865e-01 7.80024538e-01
 1.36278386e+03 2.41556160e+04 6.64739288e+02 9.84687844e+03
 3.00931857e+02 3.65653386e+03 3.14016292e+02 3.85633380e+03
 6.16344043e+01 5.03806070e+02 7.24906724e+00 3.47006055e+01
 2.03015357e+01 1.25717433e+02 7.66495434e-01 2.09228749e+00
 2.72678476e+00 1.02222845e+01 2.22848338e-01 4.46679625e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99394570722107
cond(S) = 110875.70899418004
E1 = -729.5253380486047  E_coul = 203.17160957443826
init E= -526.353728474166
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555858815424993  LUMO = 0.750033366470685
  mo_energy =
[-1.18329818e+02 -1.22067751e+01 -9.44736884e+00 -9.44736884e+00
 -9.44736884e+00 -1.24027886e+00 -5.55858815e-01 -5.55858815e-01
 -5.55858815e-01  7.50033366e-01  1.02513374e+00  1.02513374e+00
  1.02513374e+00  5.26392098e+00  7.14794485e+00  7.14794485e+00
  7.14794485e+00  2.56335019e+01  3.30362530e+01  3.30362530e+01
  3.30362530e+01  1.28732533e+02  1.28732533e+02  1.28732533e+02
  1.31053109e+02  4.83278668e+02  4.83278668e+02  4.83278668e+02
  6.16555399e+02  1.33516695e+03  1.33516695e+03  1.33516695e+03
  2.68347923e+03  3.02942286e+03  3.02942286e+03  3.02942286e+03
  6.64994555e+03  6.64994555e+03  6.64994555e+03  9.08698805e+03
  2.54412460e+04  7.61819708e+04]
E1 = -727.8521551024104  E_coul = 201.11016491873283
cycle= 1 E= -526.741990183678  delta_E= -0.388  |g|= 0.186  |ddm|= 0.324
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.547629
diis-c [-0.29989752  1.        ]
  HOMO = -0.589997264796929  LUMO = 0.73106177556545
  mo_energy =
[-1.18638159e+02 -1.23435935e+01 -9.59536910e+00 -9.59536910e+00
 -9.59536910e+00 -1.27855593e+00 -5.89997265e-01 -5.89997265e-01
 -5.89997265e-01  7.31061776e-01  1.00166833e+00  1.00166833e+00
  1.00166833e+00  5.19960270e+00  7.05961506e+00  7.05961506e+00
  7.05961506e+00  2.55062810e+01  3.28827081e+01  3.28827081e+01
  3.28827081e+01  1.28503979e+02  1.28503979e+02  1.28503979e+02
  1.30830179e+02  4.82971381e+02  4.82971381e+02  4.82971381e+02
  6.16210919e+02  1.33480332e+03  1.33480332e+03  1.33480332e+03
  2.68298073e+03  3.02899241e+03  3.02899241e+03  3.02899241e+03
  6.64940137e+03  6.64940137e+03  6.64940137e+03  9.08636853e+03
  2.54405322e+04  7.61811668e+04]
E1 = -728.4233223429082  E_coul = 201.68061309215292
cycle= 2 E= -526.742709250755  delta_E= -0.000719  |g|= 0.0378  |ddm|= 0.0506
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0761937
diis-c [-0.00342492  0.08223894  0.91776106]
  HOMO = -0.581006335706568  LUMO = 0.736812781679357
  mo_energy =
[-1.18570501e+02 -1.23057280e+01 -9.55584438e+00 -9.55584438e+00
 -9.55584438e+00 -1.26776737e+00 -5.81006336e-01 -5.81006336e-01
 -5.81006336e-01  7.36812782e-01  1.00822175e+00  1.00822175e+00
  1.00822175e+00  5.21728564e+00  7.08282541e+00  7.08282541e+00
  7.08282541e+00  2.55408789e+01  3.29225672e+01  3.29225672e+01
  3.29225672e+01  1.28559812e+02  1.28559812e+02  1.28559812e+02
  1.30886030e+02  4.83038232e+02  4.83038232e+02  4.83038232e+02
  6.16279965e+02  1.33487423e+03  1.33487423e+03  1.33487423e+03
  2.68305493e+03  3.02906557e+03  3.02906557e+03  3.02906557e+03
  6.64947628e+03  6.64947628e+03  6.64947628e+03  9.08644424e+03
  2.54406085e+04  7.61812433e+04]
E1 = -728.273019733574  E_coul = 201.53025161979917
cycle= 3 E= -526.742768113775  delta_E= -5.89e-05  |g|= 0.00632  |ddm|= 0.0152
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0133395
diis-c [-8.60483761e-07 -1.30910380e-03  1.44268470e-01  8.57040634e-01]
  HOMO = -0.582510673913041  LUMO = 0.735937818927035
  mo_energy =
[-1.18580510e+02 -1.23115574e+01 -9.56203087e+00 -9.56203087e+00
 -9.56203087e+00 -1.26944668e+00 -5.82510674e-01 -5.82510674e-01
 -5.82510674e-01  7.35937819e-01  1.00715247e+00  1.00715247e+00
  1.00715247e+00  5.21448792e+00  7.07908945e+00  7.07908945e+00
  7.07908945e+00  2.55355199e+01  3.29163707e+01  3.29163707e+01
  3.29163707e+01  1.28551417e+02  1.28551417e+02  1.28551417e+02
  1.30877672e+02  4.83028338e+02  4.83028338e+02  4.83028338e+02
  6.16269736e+02  1.33486375e+03  1.33486375e+03  1.33486375e+03
  2.68304380e+03  3.02905469e+03  3.02905469e+03  3.02905469e+03
  6.64946500e+03  6.64946500e+03  6.64946500e+03  9.08643275e+03
  2.54405968e+04  7.61812315e+04]
E1 = -728.2958793706962  E_coul = 201.55310931401087
cycle= 4 E= -526.742770056685  delta_E= -1.94e-06  |g|= 0.000117  |ddm|= 0.00216
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000134174
diis-c [-7.24352285e-09  1.00451240e-04 -1.37642718e-02 -8.61505435e-02
  1.09981436e+00]
  HOMO = -0.582492474466121  LUMO = 0.735967432155214
  mo_energy =
[-1.18580460e+02 -1.23114854e+01 -9.56197396e+00 -9.56197396e+00
 -9.56197396e+00 -1.26940031e+00 -5.82492474e-01 -5.82492474e-01
 -5.82492474e-01  7.35967432e-01  1.00716861e+00  1.00716861e+00
  1.00716861e+00  5.21453932e+00  7.07913390e+00  7.07913390e+00
  7.07913390e+00  2.55355834e+01  3.29164256e+01  3.29164256e+01
  3.29164256e+01  1.28551473e+02  1.28551473e+02  1.28551473e+02
  1.30877731e+02  4.83028388e+02  4.83028388e+02  4.83028388e+02
  6.16269778e+02  1.33486379e+03  1.33486379e+03  1.33486379e+03
  2.68304382e+03  3.02905472e+03  3.02905472e+03  3.02905472e+03
  6.64946502e+03  6.64946502e+03  6.64946502e+03  9.08643275e+03
  2.54405968e+04  7.61812315e+04]
E1 = -728.2956191490358  E_coul = 201.55284908963694
cycle= 5 E= -526.742770059399  delta_E= -2.71e-09  |g|= 2.23e-05  |ddm|= 0.000203
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.10895e-05
diis-c [-1.29224894e-10  1.36814222e-05 -1.69037926e-03 -1.29034411e-02
  1.91591685e-02  9.95420970e-01]
  HOMO = -0.582501251084819  LUMO = 0.735964288900094
  mo_energy =
[-1.18580495e+02 -1.23115114e+01 -9.56200198e+00 -9.56200198e+00
 -9.56200198e+00 -1.26940727e+00 -5.82501251e-01 -5.82501251e-01
 -5.82501251e-01  7.35964289e-01  1.00716285e+00  1.00716285e+00
  1.00716285e+00  5.21452578e+00  7.07911494e+00  7.07911494e+00
  7.07911494e+00  2.55355592e+01  3.29163985e+01  3.29163985e+01
  3.29163985e+01  1.28551442e+02  1.28551442e+02  1.28551442e+02
  1.30877700e+02  4.83028354e+02  4.83028354e+02  4.83028354e+02
  6.16269744e+02  1.33486375e+03  1.33486375e+03  1.33486375e+03
  2.68304378e+03  3.02905468e+03  3.02905468e+03  3.02905468e+03
  6.64946498e+03  6.64946498e+03  6.64946498e+03  9.08643271e+03
  2.54405968e+04  7.61812315e+04]
E1 = -728.2957100560732  E_coul = 201.55293999659955
cycle= 6 E= -526.742770059474  delta_E= -7.47e-11  |g|= 1.89e-06  |ddm|= 2.42e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2957100560732  E_coul = 201.55293999659955
  HOMO = -0.582500968922784  LUMO = 0.735964736835965
  mo_energy =
[-1.18580493e+02 -1.23115102e+01 -9.56200077e+00 -9.56200077e+00
 -9.56200077e+00 -1.26940656e+00 -5.82500969e-01 -5.82500969e-01
 -5.82500969e-01  7.35964737e-01  1.00716310e+00  1.00716310e+00
  1.00716310e+00  5.21452656e+00  7.07911573e+00  7.07911573e+00
  7.07911573e+00  2.55355603e+01  3.29163997e+01  3.29163997e+01
  3.29163997e+01  1.28551443e+02  1.28551443e+02  1.28551443e+02
  1.30877701e+02  4.83028356e+02  4.83028356e+02  4.83028356e+02
  6.16269745e+02  1.33486375e+03  1.33486375e+03  1.33486375e+03
  2.68304379e+03  3.02905468e+03  3.02905468e+03  3.02905468e+03
  6.64946498e+03  6.64946498e+03  6.64946498e+03  9.08643272e+03
  2.54405968e+04  7.61812315e+04]
E1 = -728.2957046904136  E_coul = 201.55293463093946
Extra cycle  E= -526.742770059474  delta_E= -4.55e-13  |g|= 4.35e-07  |ddm|= 3.32e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826578e+04 7.61751778e+03 3.61735293e+03 1.59774068e+03
 3.82772851e+02 1.09388366e+02 3.72252150e+01 1.04694221e+01
 4.35113458e+00 5.91888245e-01 1.67381205e+00 2.08668865e-01
 1.36278386e+03 6.64739288e+02 3.00931857e+02 3.14016292e+02
 6.16344043e+01 7.24906724e+00 2.03015357e+01 7.66495434e-01
 2.72678476e+00 2.22848338e-01]
E = -526.7427700594741
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:44 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6577879        1
[INPUT] 0    0    [1    /1   ]  7617.51777682        1
[INPUT] 0    0    [1    /1   ]  3617.35293245        1
[INPUT] 0    0    [1    /1   ]  1597.74068344        1
[INPUT] 0    0    [1    /1   ]  382.772850512        1
[INPUT] 0    0    [1    /1   ]  109.38836589         1
[INPUT] 0    0    [1    /1   ]  37.2252150244        1
[INPUT] 0    0    [1    /1   ]  10.4694221229        1
[INPUT] 0    0    [1    /1   ]  4.35113458007        1
[INPUT] 0    0    [1    /1   ]  0.591888244826       1
[INPUT] 0    0    [1    /1   ]  1.67381204847        1
[INPUT] 0    0    [1    /1   ]  0.208668865312       1
[INPUT] 1    0    [1    /1   ]  1362.78385571        1
[INPUT] 1    0    [1    /1   ]  664.739287703        1
[INPUT] 1    0    [1    /1   ]  300.931857165        1
[INPUT] 1    0    [1    /1   ]  314.016292111        1
[INPUT] 1    0    [1    /1   ]  61.6344042995        1
[INPUT] 1    0    [1    /1   ]  7.24906723784        1
[INPUT] 1    0    [1    /1   ]  20.301535671         1
[INPUT] 1    0    [1    /1   ]  0.766495433747       1
[INPUT] 1    0    [1    /1   ]  2.72678475554        1
[INPUT] 1    0    [1    /1   ]  0.222848338444       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657787922184, 1.0]], [0, [7617.517776822818, 1.0]], [0, [3617.352932451081, 1.0]], [0, [1597.740683437796, 1.0]], [0, [382.772850512094, 1.0]], [0, [109.38836588959536, 1.0]], [0, [37.22521502442007, 1.0]], [0, [10.469422122883383, 1.0]], [0, [4.351134580074177, 1.0]], [0, [0.5918882448260053, 1.0]], [0, [1.673812048466152, 1.0]], [0, [0.20866886531174567, 1.0]], [1, [1362.7838557148164, 1.0]], [1, [664.7392877031824, 1.0]], [1, [300.93185716547356, 1.0]], [1, [314.01629211104705, 1.0]], [1, [61.63440429945915, 1.0]], [1, [7.249067237840044, 1.0]], [1, [20.301535670954287, 1.0]], [1, [0.7664954337473279, 1.0]], [1, [2.7267847555433495, 1.0]], [1, [0.2228483384439887, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65778792]
bas 1, expnt(s) = [7617.51777682]
bas 2, expnt(s) = [3617.35293245]
bas 3, expnt(s) = [1597.74068344]
bas 4, expnt(s) = [382.77285051]
bas 5, expnt(s) = [109.38836589]
bas 6, expnt(s) = [37.22521502]
bas 7, expnt(s) = [10.46942212]
bas 8, expnt(s) = [4.35113458]
bas 9, expnt(s) = [0.59188824]
bas 10, expnt(s) = [1.67381205]
bas 11, expnt(s) = [0.20866887]
bas 12, expnt(s) = [1362.78385571]
bas 13, expnt(s) = [664.7392877]
bas 14, expnt(s) = [300.93185717]
bas 15, expnt(s) = [314.01629211]
bas 16, expnt(s) = [61.6344043]
bas 17, expnt(s) = [7.24906724]
bas 18, expnt(s) = [20.30153567]
bas 19, expnt(s) = [0.76649543]
bas 20, expnt(s) = [2.72678476]
bas 21, expnt(s) = [0.22284834]
CPU time:       184.33
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826578e+04 5.20026316e+03 7.61751778e+03 2.06003753e+03
 3.61735293e+03 1.17844193e+03 1.59774068e+03 6.38476246e+02
 3.82772851e+02 2.18635595e+02 1.09388366e+02 8.54561603e+01
 3.72252150e+01 3.80752651e+01 1.04694221e+01 1.47047301e+01
 4.35113458e+00 7.61144146e+00 5.91888245e-01 1.70488390e+00
 1.67381205e+00 3.71787720e+00 2.08668865e-01 7.80024538e-01
 1.36278386e+03 2.41556160e+04 6.64739288e+02 9.84687844e+03
 3.00931857e+02 3.65653386e+03 3.14016292e+02 3.85633380e+03
 6.16344043e+01 5.03806070e+02 7.24906724e+00 3.47006055e+01
 2.03015357e+01 1.25717433e+02 7.66495434e-01 2.09228749e+00
 2.72678476e+00 1.02222845e+01 2.22848338e-01 4.46679625e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99394570722107
cond(S) = 110875.70899418004
E1 = -729.5253380486047  E_coul = 203.17160957443826
init E= -526.353728474166
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555858815424993  LUMO = 0.750033366470685
  mo_energy =
[-1.18329818e+02 -1.22067751e+01 -9.44736884e+00 -9.44736884e+00
 -9.44736884e+00 -1.24027886e+00 -5.55858815e-01 -5.55858815e-01
 -5.55858815e-01  7.50033366e-01  1.02513374e+00  1.02513374e+00
  1.02513374e+00  5.26392098e+00  7.14794485e+00  7.14794485e+00
  7.14794485e+00  2.56335019e+01  3.30362530e+01  3.30362530e+01
  3.30362530e+01  1.28732533e+02  1.28732533e+02  1.28732533e+02
  1.31053109e+02  4.83278668e+02  4.83278668e+02  4.83278668e+02
  6.16555399e+02  1.33516695e+03  1.33516695e+03  1.33516695e+03
  2.68347923e+03  3.02942286e+03  3.02942286e+03  3.02942286e+03
  6.64994555e+03  6.64994555e+03  6.64994555e+03  9.08698805e+03
  2.54412460e+04  7.61819708e+04]
E1 = -727.8521551024104  E_coul = 201.11016491873283
cycle= 1 E= -526.741990183678  delta_E= -0.388  |g|= 0.186  |ddm|= 0.324
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.547629
diis-c [-0.29989752  1.        ]
  HOMO = -0.589997264796929  LUMO = 0.73106177556545
  mo_energy =
[-1.18638159e+02 -1.23435935e+01 -9.59536910e+00 -9.59536910e+00
 -9.59536910e+00 -1.27855593e+00 -5.89997265e-01 -5.89997265e-01
 -5.89997265e-01  7.31061776e-01  1.00166833e+00  1.00166833e+00
  1.00166833e+00  5.19960270e+00  7.05961506e+00  7.05961506e+00
  7.05961506e+00  2.55062810e+01  3.28827081e+01  3.28827081e+01
  3.28827081e+01  1.28503979e+02  1.28503979e+02  1.28503979e+02
  1.30830179e+02  4.82971381e+02  4.82971381e+02  4.82971381e+02
  6.16210919e+02  1.33480332e+03  1.33480332e+03  1.33480332e+03
  2.68298073e+03  3.02899241e+03  3.02899241e+03  3.02899241e+03
  6.64940137e+03  6.64940137e+03  6.64940137e+03  9.08636853e+03
  2.54405322e+04  7.61811668e+04]
E1 = -728.4233223429082  E_coul = 201.68061309215292
cycle= 2 E= -526.742709250755  delta_E= -0.000719  |g|= 0.0378  |ddm|= 0.0506
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0761937
diis-c [-0.00342492  0.08223894  0.91776106]
  HOMO = -0.581006335706568  LUMO = 0.736812781679357
  mo_energy =
[-1.18570501e+02 -1.23057280e+01 -9.55584438e+00 -9.55584438e+00
 -9.55584438e+00 -1.26776737e+00 -5.81006336e-01 -5.81006336e-01
 -5.81006336e-01  7.36812782e-01  1.00822175e+00  1.00822175e+00
  1.00822175e+00  5.21728564e+00  7.08282541e+00  7.08282541e+00
  7.08282541e+00  2.55408789e+01  3.29225672e+01  3.29225672e+01
  3.29225672e+01  1.28559812e+02  1.28559812e+02  1.28559812e+02
  1.30886030e+02  4.83038232e+02  4.83038232e+02  4.83038232e+02
  6.16279965e+02  1.33487423e+03  1.33487423e+03  1.33487423e+03
  2.68305493e+03  3.02906557e+03  3.02906557e+03  3.02906557e+03
  6.64947628e+03  6.64947628e+03  6.64947628e+03  9.08644424e+03
  2.54406085e+04  7.61812433e+04]
E1 = -728.273019733574  E_coul = 201.53025161979917
cycle= 3 E= -526.742768113775  delta_E= -5.89e-05  |g|= 0.00632  |ddm|= 0.0152
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0133395
diis-c [-8.60483761e-07 -1.30910380e-03  1.44268470e-01  8.57040634e-01]
  HOMO = -0.582510673913041  LUMO = 0.735937818927035
  mo_energy =
[-1.18580510e+02 -1.23115574e+01 -9.56203087e+00 -9.56203087e+00
 -9.56203087e+00 -1.26944668e+00 -5.82510674e-01 -5.82510674e-01
 -5.82510674e-01  7.35937819e-01  1.00715247e+00  1.00715247e+00
  1.00715247e+00  5.21448792e+00  7.07908945e+00  7.07908945e+00
  7.07908945e+00  2.55355199e+01  3.29163707e+01  3.29163707e+01
  3.29163707e+01  1.28551417e+02  1.28551417e+02  1.28551417e+02
  1.30877672e+02  4.83028338e+02  4.83028338e+02  4.83028338e+02
  6.16269736e+02  1.33486375e+03  1.33486375e+03  1.33486375e+03
  2.68304380e+03  3.02905469e+03  3.02905469e+03  3.02905469e+03
  6.64946500e+03  6.64946500e+03  6.64946500e+03  9.08643275e+03
  2.54405968e+04  7.61812315e+04]
E1 = -728.2958793706962  E_coul = 201.55310931401087
cycle= 4 E= -526.742770056685  delta_E= -1.94e-06  |g|= 0.000117  |ddm|= 0.00216
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000134174
diis-c [-7.24352285e-09  1.00451240e-04 -1.37642718e-02 -8.61505435e-02
  1.09981436e+00]
  HOMO = -0.582492474466121  LUMO = 0.735967432155214
  mo_energy =
[-1.18580460e+02 -1.23114854e+01 -9.56197396e+00 -9.56197396e+00
 -9.56197396e+00 -1.26940031e+00 -5.82492474e-01 -5.82492474e-01
 -5.82492474e-01  7.35967432e-01  1.00716861e+00  1.00716861e+00
  1.00716861e+00  5.21453932e+00  7.07913390e+00  7.07913390e+00
  7.07913390e+00  2.55355834e+01  3.29164256e+01  3.29164256e+01
  3.29164256e+01  1.28551473e+02  1.28551473e+02  1.28551473e+02
  1.30877731e+02  4.83028388e+02  4.83028388e+02  4.83028388e+02
  6.16269778e+02  1.33486379e+03  1.33486379e+03  1.33486379e+03
  2.68304382e+03  3.02905472e+03  3.02905472e+03  3.02905472e+03
  6.64946502e+03  6.64946502e+03  6.64946502e+03  9.08643275e+03
  2.54405968e+04  7.61812315e+04]
E1 = -728.2956191490358  E_coul = 201.55284908963694
cycle= 5 E= -526.742770059399  delta_E= -2.71e-09  |g|= 2.23e-05  |ddm|= 0.000203
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.10895e-05
diis-c [-1.29224894e-10  1.36814222e-05 -1.69037926e-03 -1.29034411e-02
  1.91591685e-02  9.95420970e-01]
  HOMO = -0.582501251084819  LUMO = 0.735964288900094
  mo_energy =
[-1.18580495e+02 -1.23115114e+01 -9.56200198e+00 -9.56200198e+00
 -9.56200198e+00 -1.26940727e+00 -5.82501251e-01 -5.82501251e-01
 -5.82501251e-01  7.35964289e-01  1.00716285e+00  1.00716285e+00
  1.00716285e+00  5.21452578e+00  7.07911494e+00  7.07911494e+00
  7.07911494e+00  2.55355592e+01  3.29163985e+01  3.29163985e+01
  3.29163985e+01  1.28551442e+02  1.28551442e+02  1.28551442e+02
  1.30877700e+02  4.83028354e+02  4.83028354e+02  4.83028354e+02
  6.16269744e+02  1.33486375e+03  1.33486375e+03  1.33486375e+03
  2.68304378e+03  3.02905468e+03  3.02905468e+03  3.02905468e+03
  6.64946498e+03  6.64946498e+03  6.64946498e+03  9.08643271e+03
  2.54405968e+04  7.61812315e+04]
E1 = -728.2957100560732  E_coul = 201.55293999659955
cycle= 6 E= -526.742770059474  delta_E= -7.47e-11  |g|= 1.89e-06  |ddm|= 2.42e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2957100560732  E_coul = 201.55293999659955
  HOMO = -0.582500968922784  LUMO = 0.735964736835965
  mo_energy =
[-1.18580493e+02 -1.23115102e+01 -9.56200077e+00 -9.56200077e+00
 -9.56200077e+00 -1.26940656e+00 -5.82500969e-01 -5.82500969e-01
 -5.82500969e-01  7.35964737e-01  1.00716310e+00  1.00716310e+00
  1.00716310e+00  5.21452656e+00  7.07911573e+00  7.07911573e+00
  7.07911573e+00  2.55355603e+01  3.29163997e+01  3.29163997e+01
  3.29163997e+01  1.28551443e+02  1.28551443e+02  1.28551443e+02
  1.30877701e+02  4.83028356e+02  4.83028356e+02  4.83028356e+02
  6.16269745e+02  1.33486375e+03  1.33486375e+03  1.33486375e+03
  2.68304379e+03  3.02905468e+03  3.02905468e+03  3.02905468e+03
  6.64946498e+03  6.64946498e+03  6.64946498e+03  9.08643272e+03
  2.54405968e+04  7.61812315e+04]
E1 = -728.2957046904136  E_coul = 201.55293463093946
Extra cycle  E= -526.742770059474  delta_E= -4.55e-13  |g|= 4.35e-07  |ddm|= 3.32e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 110875.70899418004
E1 = -728.2957046904136  E_coul = 201.55293463093946
init E= -526.742770059474
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.582501090235875  LUMO = 0.735964719136358
  mo_energy =
[-1.18580494e+02 -1.23115106e+01 -9.56200119e+00 -9.56200119e+00
 -9.56200119e+00 -1.26940662e+00 -5.82501090e-01 -5.82501090e-01
 -5.82501090e-01  7.35964719e-01  1.00716302e+00  1.00716302e+00
  1.00716302e+00  5.21452639e+00  7.07911547e+00  7.07911547e+00
  7.07911547e+00  2.55355600e+01  3.29163993e+01  3.29163993e+01
  3.29163993e+01  1.28551443e+02  1.28551443e+02  1.28551443e+02
  1.30877701e+02  4.83028355e+02  4.83028355e+02  4.83028355e+02
  6.16269745e+02  1.33486375e+03  1.33486375e+03  1.33486375e+03
  2.68304379e+03  3.02905468e+03  3.02905468e+03  3.02905468e+03
  6.64946498e+03  6.64946498e+03  6.64946498e+03  9.08643272e+03
  2.54405968e+04  7.61812315e+04]
E1 = -728.295706020731  E_coul = 201.55293596125733
cycle= 1 E= -526.742770059474  delta_E= 3.41e-13  |g|= 1.14e-07  |ddm|= 6.13e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.295706020731  E_coul = 201.55293596125733
  HOMO = -0.582501068829297  LUMO = 0.735964744294807
  mo_energy =
[-1.18580494e+02 -1.23115105e+01 -9.56200109e+00 -9.56200109e+00
 -9.56200109e+00 -1.26940658e+00 -5.82501069e-01 -5.82501069e-01
 -5.82501069e-01  7.35964744e-01  1.00716304e+00  1.00716304e+00
  1.00716304e+00  5.21452644e+00  7.07911553e+00  7.07911553e+00
  7.07911553e+00  2.55355601e+01  3.29163994e+01  3.29163994e+01
  3.29163994e+01  1.28551443e+02  1.28551443e+02  1.28551443e+02
  1.30877701e+02  4.83028355e+02  4.83028355e+02  4.83028355e+02
  6.16269745e+02  1.33486375e+03  1.33486375e+03  1.33486375e+03
  2.68304379e+03  3.02905468e+03  3.02905468e+03  3.02905468e+03
  6.64946498e+03  6.64946498e+03  6.64946498e+03  9.08643272e+03
  2.54405968e+04  7.61812315e+04]
E1 = -728.29570560703  E_coul = 201.5529355475554
Extra cycle  E= -526.742770059475  delta_E= -7.96e-13  |g|= 2.79e-08  |ddm|= 1.5e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826578e+04 7.61751778e+03 3.61735293e+03 1.59774068e+03
 3.82772851e+02 1.09388366e+02 3.72252150e+01 1.04694221e+01
 4.35113458e+00 5.91888245e-01 1.67381205e+00 2.08668865e-01
 1.36278386e+03 6.64739288e+02 3.00931857e+02 3.14016292e+02
 6.16344043e+01 7.24906724e+00 2.03015357e+01 7.66495434e-01
 2.72678476e+00 2.22848338e-01]
grad_E = [-1.50823392e-06  3.20476848e-06 -1.63319162e-06  6.50151157e-05
  1.43438932e-04 -2.22030607e-03  1.40993115e-03  3.29604581e-04
 -1.87961288e-03 -5.50587271e-03 -1.09547774e-03  1.79896112e-03
 -4.78153455e-07  5.38978642e-06  2.59312040e-05  2.23505246e-05
 -2.63057311e-04 -8.37111244e-04  1.56085797e-03 -1.71454395e-02
 -4.45616661e-03  6.11802175e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:49 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6578239        1
[INPUT] 0    0    [1    /1   ]  7617.51770498        1
[INPUT] 0    0    [1    /1   ]  3617.35297455        1
[INPUT] 0    0    [1    /1   ]  1597.73933033        1
[INPUT] 0    0    [1    /1   ]  382.762740057        1
[INPUT] 0    0    [1    /1   ]  109.486942758        1
[INPUT] 0    0    [1    /1   ]  37.1056595028        1
[INPUT] 0    0    [1    /1   ]  10.4680313259        1
[INPUT] 0    0    [1    /1   ]  4.33217507323        1
[INPUT] 0    0    [1    /1   ]  0.599362056082       1
[INPUT] 0    0    [1    /1   ]  1.65801142198        1
[INPUT] 0    0    [1    /1   ]  0.215144684737       1
[INPUT] 1    0    [1    /1   ]  1362.7838678         1
[INPUT] 1    0    [1    /1   ]  664.739164518        1
[INPUT] 1    0    [1    /1   ]  300.93127318         1
[INPUT] 1    0    [1    /1   ]  314.015788655        1
[INPUT] 1    0    [1    /1   ]  61.6362849314        1
[INPUT] 1    0    [1    /1   ]  7.26823693591        1
[INPUT] 1    0    [1    /1   ]  20.2902483517        1
[INPUT] 1    0    [1    /1   ]  0.767801473711       1
[INPUT] 1    0    [1    /1   ]  2.73391492089        1
[INPUT] 1    0    [1    /1   ]  0.223180465337       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657823861962, 1.0]], [0, [7617.517704976056, 1.0]], [0, [3617.35297455228, 1.0]], [0, [1597.7393303264787, 1.0]], [0, [382.7627400570256, 1.0]], [0, [109.48694275849444, 1.0]], [0, [37.10565950277881, 1.0]], [0, [10.4680313259488, 1.0]], [0, [4.332175073225914, 1.0]], [0, [0.599362056082254, 1.0]], [0, [1.6580114219750304, 1.0]], [0, [0.21514468473655202, 1.0]], [1, [1362.7838677958716, 1.0]], [1, [664.7391645175411, 1.0]], [1, [300.9312731803332, 1.0]], [1, [314.0157886549191, 1.0]], [1, [61.63628493143068, 1.0]], [1, [7.268236935906726, 1.0]], [1, [20.29024835172041, 1.0]], [1, [0.767801473711317, 1.0]], [1, [2.733914920889957, 1.0]], [1, [0.22318046533677963, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65782386]
bas 1, expnt(s) = [7617.51770498]
bas 2, expnt(s) = [3617.35297455]
bas 3, expnt(s) = [1597.73933033]
bas 4, expnt(s) = [382.76274006]
bas 5, expnt(s) = [109.48694276]
bas 6, expnt(s) = [37.1056595]
bas 7, expnt(s) = [10.46803133]
bas 8, expnt(s) = [4.33217507]
bas 9, expnt(s) = [0.59936206]
bas 10, expnt(s) = [1.65801142]
bas 11, expnt(s) = [0.21514468]
bas 12, expnt(s) = [1362.7838678]
bas 13, expnt(s) = [664.73916452]
bas 14, expnt(s) = [300.93127318]
bas 15, expnt(s) = [314.01578865]
bas 16, expnt(s) = [61.63628493]
bas 17, expnt(s) = [7.26823694]
bas 18, expnt(s) = [20.29024835]
bas 19, expnt(s) = [0.76780147]
bas 20, expnt(s) = [2.73391492]
bas 21, expnt(s) = [0.22318047]
CPU time:       190.02
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826578e+04 5.20026316e+03 7.61751770e+03 2.06003751e+03
 3.61735297e+03 1.17844194e+03 1.59773933e+03 6.38475841e+02
 3.82762740e+02 2.18631264e+02 1.09486943e+02 8.55139113e+01
 3.71056595e+01 3.79835140e+01 1.04680313e+01 1.47032650e+01
 4.33217507e+00 7.58655348e+00 5.99362056e-01 1.72100431e+00
 1.65801142e+00 3.69152372e+00 2.15144685e-01 7.98110437e-01
 1.36278387e+03 2.41556163e+04 6.64739165e+02 9.84687616e+03
 3.00931273e+02 3.65652499e+03 3.14015789e+02 3.85632607e+03
 6.16362849e+01 5.03825286e+02 7.26823694e+00 3.48153478e+01
 2.02902484e+01 1.25630068e+02 7.67801474e-01 2.09674477e+00
 2.73391492e+00 1.02557078e+01 2.23180465e-01 4.47511929e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993897917124908
cond(S) = 110990.43467013886
E1 = -729.5268584660158  E_coul = 203.1716062783634
init E= -526.355252187652
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555841977896396  LUMO = 0.774612330375954
  mo_energy =
[-1.18329967e+02 -1.22067563e+01 -9.44739644e+00 -9.44739644e+00
 -9.44739644e+00 -1.24029311e+00 -5.55841978e-01 -5.55841978e-01
 -5.55841978e-01  7.74612330e-01  1.02754074e+00  1.02754074e+00
  1.02754074e+00  5.28935637e+00  7.17185816e+00  7.17185816e+00
  7.17185816e+00  2.55653751e+01  3.31054827e+01  3.31054827e+01
  3.31054827e+01  1.28798208e+02  1.28798208e+02  1.28798208e+02
  1.30770402e+02  4.83325861e+02  4.83325861e+02  4.83325861e+02
  6.16271347e+02  1.33520682e+03  1.33520682e+03  1.33520682e+03
  2.68328981e+03  3.02945798e+03  3.02945798e+03  3.02945798e+03
  6.64997622e+03  6.64997622e+03  6.64997622e+03  9.08682264e+03
  2.54410895e+04  7.61818246e+04]
E1 = -727.8589670131204  E_coul = 201.1166241975367
cycle= 1 E= -526.742342815584  delta_E= -0.387  |g|= 0.186  |ddm|= 0.317
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.547649
diis-c [-0.29991953  1.        ]
  HOMO = -0.589720182806421  LUMO = 0.7553356571389
  mo_energy =
[-1.18637853e+02 -1.23431326e+01 -9.59494991e+00 -9.59494991e+00
 -9.59494991e+00 -1.27835658e+00 -5.89720183e-01 -5.89720183e-01
 -5.89720183e-01  7.55335657e-01  1.00420202e+00  1.00420202e+00
  1.00420202e+00  5.22557514e+00  7.08371261e+00  7.08371261e+00
  7.08371261e+00  2.54387618e+01  3.29523288e+01  3.29523288e+01
  3.29523288e+01  1.28570121e+02  1.28570121e+02  1.28570121e+02
  1.30548037e+02  4.83019035e+02  4.83019035e+02  4.83019035e+02
  6.15927224e+02  1.33484354e+03  1.33484354e+03  1.33484354e+03
  2.68279175e+03  3.02902795e+03  3.02902795e+03  3.02902795e+03
  6.64943248e+03  6.64943248e+03  6.64943248e+03  9.08620357e+03
  2.54403761e+04  7.61810210e+04]
E1 = -728.4289320311124  E_coul = 201.68587371367315
cycle= 2 E= -526.743058317439  delta_E= -0.000716  |g|= 0.0377  |ddm|= 0.0505
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0760564
diis-c [-0.00341392  0.08207746  0.91792254]
  HOMO = -0.580743630457161  LUMO = 0.761190156001468
  mo_energy =
[-1.18570313e+02 -1.23053440e+01 -9.55550460e+00 -9.55550460e+00
 -9.55550460e+00 -1.26759548e+00 -5.80743630e-01 -5.80743630e-01
 -5.80743630e-01  7.61190156e-01  1.01075736e+00  1.01075736e+00
  1.01075736e+00  5.24316722e+00  7.10691733e+00  7.10691733e+00
  7.10691733e+00  2.54732361e+01  3.29921183e+01  3.29921183e+01
  3.29921183e+01  1.28625846e+02  1.28625846e+02  1.28625846e+02
  1.30603767e+02  4.83085767e+02  4.83085767e+02  4.83085767e+02
  6.15996151e+02  1.33491432e+03  1.33491432e+03  1.33491432e+03
  2.68286581e+03  3.02910098e+03  3.02910098e+03  3.02910098e+03
  6.64950725e+03  6.64950725e+03  6.64950725e+03  9.08627915e+03
  2.54404522e+04  7.61810975e+04]
E1 = -728.2791388141592  E_coul = 201.53602198742178
cycle= 3 E= -526.743116826737  delta_E= -5.85e-05  |g|= 0.00631  |ddm|= 0.0151
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0133173
diis-c [-8.34115780e-07 -1.30696087e-03  1.44293774e-01  8.57013187e-01]
  HOMO = -0.582239311078924  LUMO = 0.760299108912013
  mo_energy =
[-1.18580300e+02 -1.23111565e+01 -9.56167299e+00 -9.56167299e+00
 -9.56167299e+00 -1.26927016e+00 -5.82239311e-01 -5.82239311e-01
 -5.82239311e-01  7.60299109e-01  1.00969138e+00  1.00969138e+00
  1.00969138e+00  5.24038867e+00  7.10318899e+00  7.10318899e+00
  7.10318899e+00  2.54679012e+01  3.29859382e+01  3.29859382e+01
  3.29859382e+01  1.28617471e+02  1.28617471e+02  1.28617471e+02
  1.30595432e+02  4.83075895e+02  4.83075895e+02  4.83075895e+02
  6.15985944e+02  1.33490386e+03  1.33490386e+03  1.33490386e+03
  2.68285471e+03  3.02909013e+03  3.02909013e+03  3.02909013e+03
  6.64949600e+03  6.64949600e+03  6.64949600e+03  9.08626769e+03
  2.54404406e+04  7.61810857e+04]
E1 = -728.301933251458  E_coul = 201.5588144955376
cycle= 4 E= -526.74311875592  delta_E= -1.93e-06  |g|= 0.000112  |ddm|= 0.00215
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000129623
diis-c [-6.80822274e-09  9.59315394e-05 -1.32306052e-02 -8.29078541e-02
  1.09604253e+00]
  HOMO = -0.582220493189936  LUMO = 0.760328528876065
  mo_energy =
[-1.18580250e+02 -1.23110847e+01 -9.56161586e+00 -9.56161586e+00
 -9.56161586e+00 -1.26922473e+00 -5.82220493e-01 -5.82220493e-01
 -5.82220493e-01  7.60328529e-01  1.00970779e+00  1.00970779e+00
  1.00970779e+00  5.24043971e+00  7.10323386e+00  7.10323386e+00
  7.10323386e+00  2.54679646e+01  3.29859933e+01  3.29859933e+01
  3.29859933e+01  1.28617527e+02  1.28617527e+02  1.28617527e+02
  1.30595491e+02  4.83075945e+02  4.83075945e+02  4.83075945e+02
  6.15985986e+02  1.33490390e+03  1.33490390e+03  1.33490390e+03
  2.68285473e+03  3.02909016e+03  3.02909016e+03  3.02909016e+03
  6.64949602e+03  6.64949602e+03  6.64949602e+03  9.08626769e+03
  2.54404406e+04  7.61810857e+04]
E1 = -728.3016793382028  E_coul = 201.5585605798932
cycle= 5 E= -526.74311875831  delta_E= -2.39e-09  |g|= 2.17e-05  |ddm|= 0.000191
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.0227e-05
diis-c [-1.20668585e-10  1.33815558e-05 -1.66244668e-03 -1.26949931e-02
  2.25749070e-02  9.91769151e-01]
  HOMO = -0.582228985867757  LUMO = 0.760325366065939
  mo_energy =
[-1.18580284e+02 -1.23111100e+01 -9.56164313e+00 -9.56164313e+00
 -9.56164313e+00 -1.26923155e+00 -5.82228986e-01 -5.82228986e-01
 -5.82228986e-01  7.60325366e-01  1.00970220e+00  1.00970220e+00
  1.00970220e+00  5.24042657e+00  7.10321540e+00  7.10321540e+00
  7.10321540e+00  2.54679411e+01  3.29859669e+01  3.29859669e+01
  3.29859669e+01  1.28617497e+02  1.28617497e+02  1.28617497e+02
  1.30595460e+02  4.83075912e+02  4.83075912e+02  4.83075912e+02
  6.15985953e+02  1.33490387e+03  1.33490387e+03  1.33490387e+03
  2.68285470e+03  3.02909012e+03  3.02909012e+03  3.02909012e+03
  6.64949598e+03  6.64949598e+03  6.64949598e+03  9.08626766e+03
  2.54404405e+04  7.61810856e+04]
E1 = -728.3017681935802  E_coul = 201.5586494352021
cycle= 6 E= -526.743118758378  delta_E= -6.84e-11  |g|= 1.86e-06  |ddm|= 2.31e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3017681935802  E_coul = 201.5586494352021
  HOMO = -0.582228742425506  LUMO = 0.760325798439922
  mo_energy =
[-1.18580282e+02 -1.23111089e+01 -9.56164206e+00 -9.56164206e+00
 -9.56164206e+00 -1.26923088e+00 -5.82228742e-01 -5.82228742e-01
 -5.82228742e-01  7.60325798e-01  1.00970242e+00  1.00970242e+00
  1.00970242e+00  5.24042728e+00  7.10321610e+00  7.10321610e+00
  7.10321610e+00  2.54679421e+01  3.29859680e+01  3.29859680e+01
  3.29859680e+01  1.28617498e+02  1.28617498e+02  1.28617498e+02
  1.30595462e+02  4.83075913e+02  4.83075913e+02  4.83075913e+02
  6.15985954e+02  1.33490387e+03  1.33490387e+03  1.33490387e+03
  2.68285470e+03  3.02909013e+03  3.02909013e+03  3.02909013e+03
  6.64949598e+03  6.64949598e+03  6.64949598e+03  9.08626766e+03
  2.54404405e+04  7.61810856e+04]
E1 = -728.3017633514226  E_coul = 201.55864459304507
Extra cycle  E= -526.743118758377  delta_E= 5.68e-13  |g|= 4.19e-07  |ddm|= 3.35e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.25 sec
exp = [2.61826578e+04 7.61751770e+03 3.61735297e+03 1.59773933e+03
 3.82762740e+02 1.09486943e+02 3.71056595e+01 1.04680313e+01
 4.33217507e+00 5.99362056e-01 1.65801142e+00 2.15144685e-01
 1.36278387e+03 6.64739165e+02 3.00931273e+02 3.14015789e+02
 6.16362849e+01 7.26823694e+00 2.02902484e+01 7.67801474e-01
 2.73391492e+00 2.23180465e-01]
E = -526.7431187583775
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:49 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6578239        1
[INPUT] 0    0    [1    /1   ]  7617.51770498        1
[INPUT] 0    0    [1    /1   ]  3617.35297455        1
[INPUT] 0    0    [1    /1   ]  1597.73933033        1
[INPUT] 0    0    [1    /1   ]  382.762740057        1
[INPUT] 0    0    [1    /1   ]  109.486942758        1
[INPUT] 0    0    [1    /1   ]  37.1056595028        1
[INPUT] 0    0    [1    /1   ]  10.4680313259        1
[INPUT] 0    0    [1    /1   ]  4.33217507323        1
[INPUT] 0    0    [1    /1   ]  0.599362056082       1
[INPUT] 0    0    [1    /1   ]  1.65801142198        1
[INPUT] 0    0    [1    /1   ]  0.215144684737       1
[INPUT] 1    0    [1    /1   ]  1362.7838678         1
[INPUT] 1    0    [1    /1   ]  664.739164518        1
[INPUT] 1    0    [1    /1   ]  300.93127318         1
[INPUT] 1    0    [1    /1   ]  314.015788655        1
[INPUT] 1    0    [1    /1   ]  61.6362849314        1
[INPUT] 1    0    [1    /1   ]  7.26823693591        1
[INPUT] 1    0    [1    /1   ]  20.2902483517        1
[INPUT] 1    0    [1    /1   ]  0.767801473711       1
[INPUT] 1    0    [1    /1   ]  2.73391492089        1
[INPUT] 1    0    [1    /1   ]  0.223180465337       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.657823861962, 1.0]], [0, [7617.517704976056, 1.0]], [0, [3617.35297455228, 1.0]], [0, [1597.7393303264787, 1.0]], [0, [382.7627400570256, 1.0]], [0, [109.48694275849444, 1.0]], [0, [37.10565950277881, 1.0]], [0, [10.4680313259488, 1.0]], [0, [4.332175073225914, 1.0]], [0, [0.599362056082254, 1.0]], [0, [1.6580114219750304, 1.0]], [0, [0.21514468473655202, 1.0]], [1, [1362.7838677958716, 1.0]], [1, [664.7391645175411, 1.0]], [1, [300.9312731803332, 1.0]], [1, [314.0157886549191, 1.0]], [1, [61.63628493143068, 1.0]], [1, [7.268236935906726, 1.0]], [1, [20.29024835172041, 1.0]], [1, [0.767801473711317, 1.0]], [1, [2.733914920889957, 1.0]], [1, [0.22318046533677963, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65782386]
bas 1, expnt(s) = [7617.51770498]
bas 2, expnt(s) = [3617.35297455]
bas 3, expnt(s) = [1597.73933033]
bas 4, expnt(s) = [382.76274006]
bas 5, expnt(s) = [109.48694276]
bas 6, expnt(s) = [37.1056595]
bas 7, expnt(s) = [10.46803133]
bas 8, expnt(s) = [4.33217507]
bas 9, expnt(s) = [0.59936206]
bas 10, expnt(s) = [1.65801142]
bas 11, expnt(s) = [0.21514468]
bas 12, expnt(s) = [1362.7838678]
bas 13, expnt(s) = [664.73916452]
bas 14, expnt(s) = [300.93127318]
bas 15, expnt(s) = [314.01578865]
bas 16, expnt(s) = [61.63628493]
bas 17, expnt(s) = [7.26823694]
bas 18, expnt(s) = [20.29024835]
bas 19, expnt(s) = [0.76780147]
bas 20, expnt(s) = [2.73391492]
bas 21, expnt(s) = [0.22318047]
CPU time:       190.39
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826578e+04 5.20026316e+03 7.61751770e+03 2.06003751e+03
 3.61735297e+03 1.17844194e+03 1.59773933e+03 6.38475841e+02
 3.82762740e+02 2.18631264e+02 1.09486943e+02 8.55139113e+01
 3.71056595e+01 3.79835140e+01 1.04680313e+01 1.47032650e+01
 4.33217507e+00 7.58655348e+00 5.99362056e-01 1.72100431e+00
 1.65801142e+00 3.69152372e+00 2.15144685e-01 7.98110437e-01
 1.36278387e+03 2.41556163e+04 6.64739165e+02 9.84687616e+03
 3.00931273e+02 3.65652499e+03 3.14015789e+02 3.85632607e+03
 6.16362849e+01 5.03825286e+02 7.26823694e+00 3.48153478e+01
 2.02902484e+01 1.25630068e+02 7.67801474e-01 2.09674477e+00
 2.73391492e+00 1.02557078e+01 2.23180465e-01 4.47511929e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993897917124908
cond(S) = 110990.43467013886
E1 = -729.5268584660158  E_coul = 203.1716062783634
init E= -526.355252187652
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555841977896396  LUMO = 0.774612330375954
  mo_energy =
[-1.18329967e+02 -1.22067563e+01 -9.44739644e+00 -9.44739644e+00
 -9.44739644e+00 -1.24029311e+00 -5.55841978e-01 -5.55841978e-01
 -5.55841978e-01  7.74612330e-01  1.02754074e+00  1.02754074e+00
  1.02754074e+00  5.28935637e+00  7.17185816e+00  7.17185816e+00
  7.17185816e+00  2.55653751e+01  3.31054827e+01  3.31054827e+01
  3.31054827e+01  1.28798208e+02  1.28798208e+02  1.28798208e+02
  1.30770402e+02  4.83325861e+02  4.83325861e+02  4.83325861e+02
  6.16271347e+02  1.33520682e+03  1.33520682e+03  1.33520682e+03
  2.68328981e+03  3.02945798e+03  3.02945798e+03  3.02945798e+03
  6.64997622e+03  6.64997622e+03  6.64997622e+03  9.08682264e+03
  2.54410895e+04  7.61818246e+04]
E1 = -727.8589670131204  E_coul = 201.1166241975367
cycle= 1 E= -526.742342815584  delta_E= -0.387  |g|= 0.186  |ddm|= 0.317
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.547649
diis-c [-0.29991953  1.        ]
  HOMO = -0.589720182806421  LUMO = 0.7553356571389
  mo_energy =
[-1.18637853e+02 -1.23431326e+01 -9.59494991e+00 -9.59494991e+00
 -9.59494991e+00 -1.27835658e+00 -5.89720183e-01 -5.89720183e-01
 -5.89720183e-01  7.55335657e-01  1.00420202e+00  1.00420202e+00
  1.00420202e+00  5.22557514e+00  7.08371261e+00  7.08371261e+00
  7.08371261e+00  2.54387618e+01  3.29523288e+01  3.29523288e+01
  3.29523288e+01  1.28570121e+02  1.28570121e+02  1.28570121e+02
  1.30548037e+02  4.83019035e+02  4.83019035e+02  4.83019035e+02
  6.15927224e+02  1.33484354e+03  1.33484354e+03  1.33484354e+03
  2.68279175e+03  3.02902795e+03  3.02902795e+03  3.02902795e+03
  6.64943248e+03  6.64943248e+03  6.64943248e+03  9.08620357e+03
  2.54403761e+04  7.61810210e+04]
E1 = -728.4289320311124  E_coul = 201.68587371367315
cycle= 2 E= -526.743058317439  delta_E= -0.000716  |g|= 0.0377  |ddm|= 0.0505
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0760564
diis-c [-0.00341392  0.08207746  0.91792254]
  HOMO = -0.580743630457161  LUMO = 0.761190156001468
  mo_energy =
[-1.18570313e+02 -1.23053440e+01 -9.55550460e+00 -9.55550460e+00
 -9.55550460e+00 -1.26759548e+00 -5.80743630e-01 -5.80743630e-01
 -5.80743630e-01  7.61190156e-01  1.01075736e+00  1.01075736e+00
  1.01075736e+00  5.24316722e+00  7.10691733e+00  7.10691733e+00
  7.10691733e+00  2.54732361e+01  3.29921183e+01  3.29921183e+01
  3.29921183e+01  1.28625846e+02  1.28625846e+02  1.28625846e+02
  1.30603767e+02  4.83085767e+02  4.83085767e+02  4.83085767e+02
  6.15996151e+02  1.33491432e+03  1.33491432e+03  1.33491432e+03
  2.68286581e+03  3.02910098e+03  3.02910098e+03  3.02910098e+03
  6.64950725e+03  6.64950725e+03  6.64950725e+03  9.08627915e+03
  2.54404522e+04  7.61810975e+04]
E1 = -728.2791388141592  E_coul = 201.53602198742178
cycle= 3 E= -526.743116826737  delta_E= -5.85e-05  |g|= 0.00631  |ddm|= 0.0151
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0133173
diis-c [-8.34115780e-07 -1.30696087e-03  1.44293774e-01  8.57013187e-01]
  HOMO = -0.582239311078924  LUMO = 0.760299108912013
  mo_energy =
[-1.18580300e+02 -1.23111565e+01 -9.56167299e+00 -9.56167299e+00
 -9.56167299e+00 -1.26927016e+00 -5.82239311e-01 -5.82239311e-01
 -5.82239311e-01  7.60299109e-01  1.00969138e+00  1.00969138e+00
  1.00969138e+00  5.24038867e+00  7.10318899e+00  7.10318899e+00
  7.10318899e+00  2.54679012e+01  3.29859382e+01  3.29859382e+01
  3.29859382e+01  1.28617471e+02  1.28617471e+02  1.28617471e+02
  1.30595432e+02  4.83075895e+02  4.83075895e+02  4.83075895e+02
  6.15985944e+02  1.33490386e+03  1.33490386e+03  1.33490386e+03
  2.68285471e+03  3.02909013e+03  3.02909013e+03  3.02909013e+03
  6.64949600e+03  6.64949600e+03  6.64949600e+03  9.08626769e+03
  2.54404406e+04  7.61810857e+04]
E1 = -728.301933251458  E_coul = 201.5588144955376
cycle= 4 E= -526.74311875592  delta_E= -1.93e-06  |g|= 0.000112  |ddm|= 0.00215
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000129623
diis-c [-6.80822274e-09  9.59315394e-05 -1.32306052e-02 -8.29078541e-02
  1.09604253e+00]
  HOMO = -0.582220493189936  LUMO = 0.760328528876065
  mo_energy =
[-1.18580250e+02 -1.23110847e+01 -9.56161586e+00 -9.56161586e+00
 -9.56161586e+00 -1.26922473e+00 -5.82220493e-01 -5.82220493e-01
 -5.82220493e-01  7.60328529e-01  1.00970779e+00  1.00970779e+00
  1.00970779e+00  5.24043971e+00  7.10323386e+00  7.10323386e+00
  7.10323386e+00  2.54679646e+01  3.29859933e+01  3.29859933e+01
  3.29859933e+01  1.28617527e+02  1.28617527e+02  1.28617527e+02
  1.30595491e+02  4.83075945e+02  4.83075945e+02  4.83075945e+02
  6.15985986e+02  1.33490390e+03  1.33490390e+03  1.33490390e+03
  2.68285473e+03  3.02909016e+03  3.02909016e+03  3.02909016e+03
  6.64949602e+03  6.64949602e+03  6.64949602e+03  9.08626769e+03
  2.54404406e+04  7.61810857e+04]
E1 = -728.3016793382028  E_coul = 201.5585605798932
cycle= 5 E= -526.74311875831  delta_E= -2.39e-09  |g|= 2.17e-05  |ddm|= 0.000191
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.0227e-05
diis-c [-1.20668585e-10  1.33815558e-05 -1.66244668e-03 -1.26949931e-02
  2.25749070e-02  9.91769151e-01]
  HOMO = -0.582228985867757  LUMO = 0.760325366065939
  mo_energy =
[-1.18580284e+02 -1.23111100e+01 -9.56164313e+00 -9.56164313e+00
 -9.56164313e+00 -1.26923155e+00 -5.82228986e-01 -5.82228986e-01
 -5.82228986e-01  7.60325366e-01  1.00970220e+00  1.00970220e+00
  1.00970220e+00  5.24042657e+00  7.10321540e+00  7.10321540e+00
  7.10321540e+00  2.54679411e+01  3.29859669e+01  3.29859669e+01
  3.29859669e+01  1.28617497e+02  1.28617497e+02  1.28617497e+02
  1.30595460e+02  4.83075912e+02  4.83075912e+02  4.83075912e+02
  6.15985953e+02  1.33490387e+03  1.33490387e+03  1.33490387e+03
  2.68285470e+03  3.02909012e+03  3.02909012e+03  3.02909012e+03
  6.64949598e+03  6.64949598e+03  6.64949598e+03  9.08626766e+03
  2.54404405e+04  7.61810856e+04]
E1 = -728.3017681935802  E_coul = 201.5586494352021
cycle= 6 E= -526.743118758378  delta_E= -6.84e-11  |g|= 1.86e-06  |ddm|= 2.31e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3017681935802  E_coul = 201.5586494352021
  HOMO = -0.582228742425506  LUMO = 0.760325798439922
  mo_energy =
[-1.18580282e+02 -1.23111089e+01 -9.56164206e+00 -9.56164206e+00
 -9.56164206e+00 -1.26923088e+00 -5.82228742e-01 -5.82228742e-01
 -5.82228742e-01  7.60325798e-01  1.00970242e+00  1.00970242e+00
  1.00970242e+00  5.24042728e+00  7.10321610e+00  7.10321610e+00
  7.10321610e+00  2.54679421e+01  3.29859680e+01  3.29859680e+01
  3.29859680e+01  1.28617498e+02  1.28617498e+02  1.28617498e+02
  1.30595462e+02  4.83075913e+02  4.83075913e+02  4.83075913e+02
  6.15985954e+02  1.33490387e+03  1.33490387e+03  1.33490387e+03
  2.68285470e+03  3.02909013e+03  3.02909013e+03  3.02909013e+03
  6.64949598e+03  6.64949598e+03  6.64949598e+03  9.08626766e+03
  2.54404405e+04  7.61810856e+04]
E1 = -728.3017633514226  E_coul = 201.55864459304507
Extra cycle  E= -526.743118758377  delta_E= 5.68e-13  |g|= 4.19e-07  |ddm|= 3.35e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 110990.43467013886
E1 = -728.3017633514226  E_coul = 201.55864459304507
init E= -526.743118758377
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.582228853116329  LUMO = 0.760325786808931
  mo_energy =
[-1.18580283e+02 -1.23111093e+01 -9.56164244e+00 -9.56164244e+00
 -9.56164244e+00 -1.26923093e+00 -5.82228853e-01 -5.82228853e-01
 -5.82228853e-01  7.60325787e-01  1.00970236e+00  1.00970236e+00
  1.00970236e+00  5.24042713e+00  7.10321586e+00  7.10321586e+00
  7.10321586e+00  2.54679418e+01  3.29859676e+01  3.29859676e+01
  3.29859676e+01  1.28617497e+02  1.28617497e+02  1.28617497e+02
  1.30595461e+02  4.83075913e+02  4.83075913e+02  4.83075913e+02
  6.15985954e+02  1.33490387e+03  1.33490387e+03  1.33490387e+03
  2.68285470e+03  3.02909012e+03  3.02909012e+03  3.02909012e+03
  6.64949598e+03  6.64949598e+03  6.64949598e+03  9.08626766e+03
  2.54404405e+04  7.61810856e+04]
E1 = -728.3017645393955  E_coul = 201.5586457810166
cycle= 1 E= -526.743118758379  delta_E= -1.48e-12  |g|= 1.07e-07  |ddm|= 6.2e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.3017645393955  E_coul = 201.5586457810166
  HOMO = -0.58222883429261  LUMO = 0.760325810773933
  mo_energy =
[-1.18580283e+02 -1.23111092e+01 -9.56164235e+00 -9.56164235e+00
 -9.56164235e+00 -1.26923089e+00 -5.82228834e-01 -5.82228834e-01
 -5.82228834e-01  7.60325811e-01  1.00970237e+00  1.00970237e+00
  1.00970237e+00  5.24042718e+00  7.10321592e+00  7.10321592e+00
  7.10321592e+00  2.54679419e+01  3.29859677e+01  3.29859677e+01
  3.29859677e+01  1.28617498e+02  1.28617498e+02  1.28617498e+02
  1.30595461e+02  4.83075913e+02  4.83075913e+02  4.83075913e+02
  6.15985954e+02  1.33490387e+03  1.33490387e+03  1.33490387e+03
  2.68285470e+03  3.02909012e+03  3.02909012e+03  3.02909012e+03
  6.64949598e+03  6.64949598e+03  6.64949598e+03  9.08626766e+03
  2.54404405e+04  7.61810856e+04]
E1 = -728.3017641677815  E_coul = 201.55864540940283
Extra cycle  E= -526.743118758379  delta_E= 3.41e-13  |g|= 2.58e-08  |ddm|= 1.48e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826578e+04 7.61751770e+03 3.61735297e+03 1.59773933e+03
 3.82762740e+02 1.09486943e+02 3.71056595e+01 1.04680313e+01
 4.33217507e+00 5.99362056e-01 1.65801142e+00 2.15144685e-01
 1.36278387e+03 6.64739165e+02 3.00931273e+02 3.14015789e+02
 6.16362849e+01 7.26823694e+00 2.02902484e+01 7.67801474e-01
 2.73391492e+00 2.23180465e-01]
grad_E = [-1.51174478e-06  3.24274575e-06 -1.61514647e-06  6.64903386e-05
  9.88127710e-05 -1.93843164e-03  9.02885624e-04  4.17264670e-04
 -1.75687915e-03 -7.82177918e-03 -1.12421518e-03  1.22117507e-02
 -4.87772049e-07  5.26467852e-06  2.51722154e-05  2.16978460e-05
 -1.78492925e-04  1.07408412e-03  8.58555861e-04 -1.71673247e-02
 -5.99389246e-03  6.17997263e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:54 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6580432        1
[INPUT] 0    0    [1    /1   ]  7617.51724564        1
[INPUT] 0    0    [1    /1   ]  3617.35321646        1
[INPUT] 0    0    [1    /1   ]  1597.73014536        1
[INPUT] 0    0    [1    /1   ]  382.736183004        1
[INPUT] 0    0    [1    /1   ]  109.78493596         1
[INPUT] 0    0    [1    /1   ]  37.0410192407        1
[INPUT] 0    0    [1    /1   ]  10.6821341971        1
[INPUT] 0    0    [1    /1   ]  4.42180052277        1
[INPUT] 0    0    [1    /1   ]  0.609271968494       1
[INPUT] 0    0    [1    /1   ]  1.73001935159        1
[INPUT] 0    0    [1    /1   ]  0.223929328033       1
[INPUT] 1    0    [1    /1   ]  1362.78394149        1
[INPUT] 1    0    [1    /1   ]  664.738429785        1
[INPUT] 1    0    [1    /1   ]  300.927802723        1
[INPUT] 1    0    [1    /1   ]  314.012796548        1
[INPUT] 1    0    [1    /1   ]  61.6412715588        1
[INPUT] 1    0    [1    /1   ]  7.30017490797        1
[INPUT] 1    0    [1    /1   ]  20.2706682297        1
[INPUT] 1    0    [1    /1   ]  0.770265952061       1
[INPUT] 1    0    [1    /1   ]  2.75058403757        1
[INPUT] 1    0    [1    /1   ]  0.222218603762       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.658043214567, 1.0]], [0, [7617.517245639739, 1.0]], [0, [3617.3532164556873, 1.0]], [0, [1597.7301453610248, 1.0]], [0, [382.7361830037432, 1.0]], [0, [109.78493596014182, 1.0]], [0, [37.04101924074209, 1.0]], [0, [10.68213419713518, 1.0]], [0, [4.421800522767913, 1.0]], [0, [0.6092719684940663, 1.0]], [0, [1.7300193515938058, 1.0]], [0, [0.22392932803321927, 1.0]], [1, [1362.7839414856217, 1.0]], [1, [664.7384297850642, 1.0]], [1, [300.9278027225133, 1.0]], [1, [314.0127965477532, 1.0]], [1, [61.64127155877425, 1.0]], [1, [7.300174907972508, 1.0]], [1, [20.270668229652507, 1.0]], [1, [0.7702659520610693, 1.0]], [1, [2.750584037573077, 1.0]], [1, [0.22221860376168673, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65804321]
bas 1, expnt(s) = [7617.51724564]
bas 2, expnt(s) = [3617.35321646]
bas 3, expnt(s) = [1597.73014536]
bas 4, expnt(s) = [382.736183]
bas 5, expnt(s) = [109.78493596]
bas 6, expnt(s) = [37.04101924]
bas 7, expnt(s) = [10.6821342]
bas 8, expnt(s) = [4.42180052]
bas 9, expnt(s) = [0.60927197]
bas 10, expnt(s) = [1.73001935]
bas 11, expnt(s) = [0.22392933]
bas 12, expnt(s) = [1362.78394149]
bas 13, expnt(s) = [664.73842979]
bas 14, expnt(s) = [300.92780272]
bas 15, expnt(s) = [314.01279655]
bas 16, expnt(s) = [61.64127156]
bas 17, expnt(s) = [7.30017491]
bas 18, expnt(s) = [20.27066823]
bas 19, expnt(s) = [0.77026595]
bas 20, expnt(s) = [2.75058404]
bas 21, expnt(s) = [0.2222186]
CPU time:       196.06
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826580e+04 5.20026319e+03 7.61751725e+03 2.06003742e+03
 3.61735322e+03 1.17844200e+03 1.59773015e+03 6.38473088e+02
 3.82736183e+02 2.18619887e+02 1.09784936e+02 8.56884109e+01
 3.70410192e+01 3.79338760e+01 1.06821342e+01 1.49282379e+01
 4.42180052e+00 7.70396648e+00 6.09271968e-01 1.74230195e+00
 1.73001935e+00 3.81112545e+00 2.23929328e-01 8.22428699e-01
 1.36278394e+03 2.41556179e+04 6.64738430e+02 9.84686256e+03
 3.00927803e+02 3.65647228e+03 3.14012797e+02 3.85628014e+03
 6.16412716e+01 5.03876239e+02 7.30017491e+00 3.50066840e+01
 2.02706682e+01 1.25478545e+02 7.70265952e-01 2.10516077e+00
 2.75058404e+00 1.03339306e+01 2.22218604e-01 4.45102374e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99394293486649
cond(S) = 111358.93945283796
E1 = -729.5291075575537  E_coul = 203.17131398181553
init E= -526.357793575738
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555903760398101  LUMO = 0.813989500505822
  mo_energy =
[-1.18330232e+02 -1.22067612e+01 -9.44741257e+00 -9.44741257e+00
 -9.44741257e+00 -1.24031029e+00 -5.55903760e-01 -5.55903760e-01
 -5.55903760e-01  8.13989501e-01  1.02591123e+00  1.02591123e+00
  1.02591123e+00  5.53949159e+00  7.21502742e+00  7.21502742e+00
  7.21502742e+00  2.64637943e+01  3.32338748e+01  3.32338748e+01
  3.32338748e+01  1.28920794e+02  1.28920794e+02  1.28920794e+02
  1.32344182e+02  4.83416257e+02  4.83416257e+02  4.83416257e+02
  6.18288460e+02  1.33527986e+03  1.33527986e+03  1.33527986e+03
  2.68538068e+03  3.02951600e+03  3.02951600e+03  3.02951600e+03
  6.65002153e+03  6.65002153e+03  6.65002153e+03  9.08878066e+03
  2.54429414e+04  7.61835480e+04]
E1 = -727.8435228562691  E_coul = 201.1004895321606
cycle= 1 E= -526.743033324109  delta_E= -0.385  |g|= 0.187  |ddm|= 0.297
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.548987
diis-c [-0.30138627  1.        ]
  HOMO = -0.590283060687277  LUMO = 0.793279976944988
  mo_energy =
[-1.18639383e+02 -1.23442244e+01 -9.59605910e+00 -9.59605910e+00
 -9.59605910e+00 -1.27913895e+00 -5.90283061e-01 -5.90283061e-01
 -5.90283061e-01  7.93279977e-01  1.00214154e+00  1.00214154e+00
  1.00214154e+00  5.47324302e+00  7.12550434e+00  7.12550434e+00
  7.12550434e+00  2.63349526e+01  3.30795497e+01  3.30795497e+01
  3.30795497e+01  1.28691545e+02  1.28691545e+02  1.28691545e+02
  1.32120497e+02  4.83108180e+02  4.83108180e+02  4.83108180e+02
  6.17942921e+02  1.33491509e+03  1.33491509e+03  1.33491509e+03
  2.68488133e+03  3.02908462e+03  3.02908462e+03  3.02908462e+03
  6.64947646e+03  6.64947646e+03  6.64947646e+03  9.08816030e+03
  2.54422267e+04  7.61827431e+04]
E1 = -728.4197706689073  E_coul = 201.67601217327203
cycle= 2 E= -526.743758495635  delta_E= -0.000725  |g|= 0.0379  |ddm|= 0.0516
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766307
diis-c [-0.00345868  0.08257455  0.91742545]
  HOMO = -0.581172788776222  LUMO = 0.799456364715416
  mo_energy =
[-1.18571311e+02 -1.23060300e+01 -9.55619251e+00 -9.55619251e+00
 -9.55619251e+00 -1.26824265e+00 -5.81172789e-01 -5.81172789e-01
 -5.81172789e-01  7.99456365e-01  1.00879913e+00  1.00879913e+00
  1.00879913e+00  5.49150070e+00  7.14908346e+00  7.14908346e+00
  7.14908346e+00  2.63701012e+01  3.31197652e+01  3.31197652e+01
  3.31197652e+01  1.28747744e+02  1.28747744e+02  1.28747744e+02
  1.32176723e+02  4.83175439e+02  4.83175439e+02  4.83175439e+02
  6.18012375e+02  1.33498642e+03  1.33498642e+03  1.33498642e+03
  2.68495595e+03  3.02915821e+03  3.02915821e+03  3.02915821e+03
  6.64955179e+03  6.64955179e+03  6.64955179e+03  9.08823645e+03
  2.54423034e+04  7.61828201e+04]
E1 = -728.2683122368092  E_coul = 201.52449405167312
cycle= 3 E= -526.743818185136  delta_E= -5.97e-05  |g|= 0.00636  |ddm|= 0.0153
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.013413
diis-c [-7.91035242e-07 -1.30510956e-03  1.44292275e-01  8.57012835e-01]
  HOMO = -0.58267859728207  LUMO = 0.798511424889385
  mo_energy =
[-1.18581368e+02 -1.23118888e+01 -9.56240728e+00 -9.56240728e+00
 -9.56240728e+00 -1.26994108e+00 -5.82678597e-01 -5.82678597e-01
 -5.82678597e-01  7.98511425e-01  1.00772249e+00  1.00772249e+00
  1.00772249e+00  5.48862746e+00  7.14531148e+00  7.14531148e+00
  7.14531148e+00  2.63646786e+01  3.31135362e+01  3.31135362e+01
  3.31135362e+01  1.28739310e+02  1.28739310e+02  1.28739310e+02
  1.32168324e+02  4.83165497e+02  4.83165497e+02  4.83165497e+02
  6.18002098e+02  1.33497588e+03  1.33497588e+03  1.33497588e+03
  2.68494478e+03  3.02914728e+03  3.02914728e+03  3.02914728e+03
  6.64954047e+03  6.64954047e+03  6.64954047e+03  9.08822490e+03
  2.54422917e+04  7.61828082e+04]
E1 = -728.2913629748508  E_coul = 201.5475428285145
cycle= 4 E= -526.743820146336  delta_E= -1.96e-06  |g|= 0.0001  |ddm|= 0.00219
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119259
diis-c [-5.85834691e-09  8.61696534e-05 -1.20422608e-02 -7.55592948e-02
  1.08751539e+00]
  HOMO = -0.582658914629449  LUMO = 0.798539872046594
  mo_energy =
[-1.18581319e+02 -1.23118176e+01 -9.56234984e+00 -9.56234984e+00
 -9.56234984e+00 -1.26989816e+00 -5.82658915e-01 -5.82658915e-01
 -5.82658915e-01  7.98539872e-01  1.00773910e+00  1.00773910e+00
  1.00773910e+00  5.48867821e+00  7.14535676e+00  7.14535676e+00
  7.14535676e+00  2.63647417e+01  3.31135914e+01  3.31135914e+01
  3.31135914e+01  1.28739366e+02  1.28739366e+02  1.28739366e+02
  1.32168383e+02  4.83165547e+02  4.83165547e+02  4.83165547e+02
  6.18002141e+02  1.33497592e+03  1.33497592e+03  1.33497592e+03
  2.68494480e+03  3.02914731e+03  3.02914731e+03  3.02914731e+03
  6.64954048e+03  6.64954048e+03  6.64954048e+03  9.08822491e+03
  2.54422917e+04  7.61828082e+04]
E1 = -728.2911191010285  E_coul = 201.54729895292965
cycle= 5 E= -526.743820148099  delta_E= -1.76e-09  |g|= 2.04e-05  |ddm|= 0.000163
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.83125e-05
diis-c [-1.00768826e-10  1.26472082e-05 -1.59500873e-03 -1.21714990e-02
  3.18228730e-02  9.81930988e-01]
  HOMO = -0.582666829036741  LUMO = 0.798536639969061
  mo_energy =
[-1.18581350e+02 -1.23118415e+01 -9.56237550e+00 -9.56237550e+00
 -9.56237550e+00 -1.26990472e+00 -5.82666829e-01 -5.82666829e-01
 -5.82666829e-01  7.98536640e-01  1.00773385e+00  1.00773385e+00
  1.00773385e+00  5.48866551e+00  7.14533937e+00  7.14533937e+00
  7.14533937e+00  2.63647194e+01  3.31135666e+01  3.31135666e+01
  3.31135666e+01  1.28739337e+02  1.28739337e+02  1.28739337e+02
  1.32168354e+02  4.83165515e+02  4.83165515e+02  4.83165515e+02
  6.18002109e+02  1.33497589e+03  1.33497589e+03  1.33497589e+03
  2.68494477e+03  3.02914727e+03  3.02914727e+03  3.02914727e+03
  6.64954045e+03  6.64954045e+03  6.64954045e+03  9.08822488e+03
  2.54422917e+04  7.61828082e+04]
E1 = -728.2912038441865  E_coul = 201.5473836960291
cycle= 6 E= -526.743820148157  delta_E= -5.85e-11  |g|= 1.79e-06  |ddm|= 2.01e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2912038441865  E_coul = 201.5473836960291
  HOMO = -0.582666671807718  LUMO = 0.798537033212572
  mo_energy =
[-1.18581349e+02 -1.23118407e+01 -9.56237476e+00 -9.56237476e+00
 -9.56237476e+00 -1.26990415e+00 -5.82666672e-01 -5.82666672e-01
 -5.82666672e-01  7.98537033e-01  1.00773402e+00  1.00773402e+00
  1.00773402e+00  5.48866606e+00  7.14533987e+00  7.14533987e+00
  7.14533987e+00  2.63647201e+01  3.31135673e+01  3.31135673e+01
  3.31135673e+01  1.28739338e+02  1.28739338e+02  1.28739338e+02
  1.32168355e+02  4.83165517e+02  4.83165517e+02  4.83165517e+02
  6.18002110e+02  1.33497589e+03  1.33497589e+03  1.33497589e+03
  2.68494477e+03  3.02914728e+03  3.02914728e+03  3.02914728e+03
  6.64954045e+03  6.64954045e+03  6.64954045e+03  9.08822488e+03
  2.54422917e+04  7.61828082e+04]
E1 = -728.2912002089596  E_coul = 201.54738006080152
Extra cycle  E= -526.743820148158  delta_E= -6.82e-13  |g|= 3.88e-07  |ddm|= 3.34e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.26 sec
exp = [2.61826580e+04 7.61751725e+03 3.61735322e+03 1.59773015e+03
 3.82736183e+02 1.09784936e+02 3.70410192e+01 1.06821342e+01
 4.42180052e+00 6.09271968e-01 1.73001935e+00 2.23929328e-01
 1.36278394e+03 6.64738430e+02 3.00927803e+02 3.14012797e+02
 6.16412716e+01 7.30017491e+00 2.02706682e+01 7.70265952e-01
 2.75058404e+00 2.22218604e-01]
E = -526.7438201481581
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:54 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6580432        1
[INPUT] 0    0    [1    /1   ]  7617.51724564        1
[INPUT] 0    0    [1    /1   ]  3617.35321646        1
[INPUT] 0    0    [1    /1   ]  1597.73014536        1
[INPUT] 0    0    [1    /1   ]  382.736183004        1
[INPUT] 0    0    [1    /1   ]  109.78493596         1
[INPUT] 0    0    [1    /1   ]  37.0410192407        1
[INPUT] 0    0    [1    /1   ]  10.6821341971        1
[INPUT] 0    0    [1    /1   ]  4.42180052277        1
[INPUT] 0    0    [1    /1   ]  0.609271968494       1
[INPUT] 0    0    [1    /1   ]  1.73001935159        1
[INPUT] 0    0    [1    /1   ]  0.223929328033       1
[INPUT] 1    0    [1    /1   ]  1362.78394149        1
[INPUT] 1    0    [1    /1   ]  664.738429785        1
[INPUT] 1    0    [1    /1   ]  300.927802723        1
[INPUT] 1    0    [1    /1   ]  314.012796548        1
[INPUT] 1    0    [1    /1   ]  61.6412715588        1
[INPUT] 1    0    [1    /1   ]  7.30017490797        1
[INPUT] 1    0    [1    /1   ]  20.2706682297        1
[INPUT] 1    0    [1    /1   ]  0.770265952061       1
[INPUT] 1    0    [1    /1   ]  2.75058403757        1
[INPUT] 1    0    [1    /1   ]  0.222218603762       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.658043214567, 1.0]], [0, [7617.517245639739, 1.0]], [0, [3617.3532164556873, 1.0]], [0, [1597.7301453610248, 1.0]], [0, [382.7361830037432, 1.0]], [0, [109.78493596014182, 1.0]], [0, [37.04101924074209, 1.0]], [0, [10.68213419713518, 1.0]], [0, [4.421800522767913, 1.0]], [0, [0.6092719684940663, 1.0]], [0, [1.7300193515938058, 1.0]], [0, [0.22392932803321927, 1.0]], [1, [1362.7839414856217, 1.0]], [1, [664.7384297850642, 1.0]], [1, [300.9278027225133, 1.0]], [1, [314.0127965477532, 1.0]], [1, [61.64127155877425, 1.0]], [1, [7.300174907972508, 1.0]], [1, [20.270668229652507, 1.0]], [1, [0.7702659520610693, 1.0]], [1, [2.750584037573077, 1.0]], [1, [0.22221860376168673, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65804321]
bas 1, expnt(s) = [7617.51724564]
bas 2, expnt(s) = [3617.35321646]
bas 3, expnt(s) = [1597.73014536]
bas 4, expnt(s) = [382.736183]
bas 5, expnt(s) = [109.78493596]
bas 6, expnt(s) = [37.04101924]
bas 7, expnt(s) = [10.6821342]
bas 8, expnt(s) = [4.42180052]
bas 9, expnt(s) = [0.60927197]
bas 10, expnt(s) = [1.73001935]
bas 11, expnt(s) = [0.22392933]
bas 12, expnt(s) = [1362.78394149]
bas 13, expnt(s) = [664.73842979]
bas 14, expnt(s) = [300.92780272]
bas 15, expnt(s) = [314.01279655]
bas 16, expnt(s) = [61.64127156]
bas 17, expnt(s) = [7.30017491]
bas 18, expnt(s) = [20.27066823]
bas 19, expnt(s) = [0.77026595]
bas 20, expnt(s) = [2.75058404]
bas 21, expnt(s) = [0.2222186]
CPU time:       196.45
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826580e+04 5.20026319e+03 7.61751725e+03 2.06003742e+03
 3.61735322e+03 1.17844200e+03 1.59773015e+03 6.38473088e+02
 3.82736183e+02 2.18619887e+02 1.09784936e+02 8.56884109e+01
 3.70410192e+01 3.79338760e+01 1.06821342e+01 1.49282379e+01
 4.42180052e+00 7.70396648e+00 6.09271968e-01 1.74230195e+00
 1.73001935e+00 3.81112545e+00 2.23929328e-01 8.22428699e-01
 1.36278394e+03 2.41556179e+04 6.64738430e+02 9.84686256e+03
 3.00927803e+02 3.65647228e+03 3.14012797e+02 3.85628014e+03
 6.16412716e+01 5.03876239e+02 7.30017491e+00 3.50066840e+01
 2.02706682e+01 1.25478545e+02 7.70265952e-01 2.10516077e+00
 2.75058404e+00 1.03339306e+01 2.22218604e-01 4.45102374e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99394293486649
cond(S) = 111358.93945283796
E1 = -729.5291075575537  E_coul = 203.17131398181553
init E= -526.357793575738
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555903760398101  LUMO = 0.813989500505822
  mo_energy =
[-1.18330232e+02 -1.22067612e+01 -9.44741257e+00 -9.44741257e+00
 -9.44741257e+00 -1.24031029e+00 -5.55903760e-01 -5.55903760e-01
 -5.55903760e-01  8.13989501e-01  1.02591123e+00  1.02591123e+00
  1.02591123e+00  5.53949159e+00  7.21502742e+00  7.21502742e+00
  7.21502742e+00  2.64637943e+01  3.32338748e+01  3.32338748e+01
  3.32338748e+01  1.28920794e+02  1.28920794e+02  1.28920794e+02
  1.32344182e+02  4.83416257e+02  4.83416257e+02  4.83416257e+02
  6.18288460e+02  1.33527986e+03  1.33527986e+03  1.33527986e+03
  2.68538068e+03  3.02951600e+03  3.02951600e+03  3.02951600e+03
  6.65002153e+03  6.65002153e+03  6.65002153e+03  9.08878066e+03
  2.54429414e+04  7.61835480e+04]
E1 = -727.8435228562691  E_coul = 201.1004895321606
cycle= 1 E= -526.743033324109  delta_E= -0.385  |g|= 0.187  |ddm|= 0.297
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.548987
diis-c [-0.30138627  1.        ]
  HOMO = -0.590283060687277  LUMO = 0.793279976944988
  mo_energy =
[-1.18639383e+02 -1.23442244e+01 -9.59605910e+00 -9.59605910e+00
 -9.59605910e+00 -1.27913895e+00 -5.90283061e-01 -5.90283061e-01
 -5.90283061e-01  7.93279977e-01  1.00214154e+00  1.00214154e+00
  1.00214154e+00  5.47324302e+00  7.12550434e+00  7.12550434e+00
  7.12550434e+00  2.63349526e+01  3.30795497e+01  3.30795497e+01
  3.30795497e+01  1.28691545e+02  1.28691545e+02  1.28691545e+02
  1.32120497e+02  4.83108180e+02  4.83108180e+02  4.83108180e+02
  6.17942921e+02  1.33491509e+03  1.33491509e+03  1.33491509e+03
  2.68488133e+03  3.02908462e+03  3.02908462e+03  3.02908462e+03
  6.64947646e+03  6.64947646e+03  6.64947646e+03  9.08816030e+03
  2.54422267e+04  7.61827431e+04]
E1 = -728.4197706689073  E_coul = 201.67601217327203
cycle= 2 E= -526.743758495635  delta_E= -0.000725  |g|= 0.0379  |ddm|= 0.0516
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766307
diis-c [-0.00345868  0.08257455  0.91742545]
  HOMO = -0.581172788776222  LUMO = 0.799456364715416
  mo_energy =
[-1.18571311e+02 -1.23060300e+01 -9.55619251e+00 -9.55619251e+00
 -9.55619251e+00 -1.26824265e+00 -5.81172789e-01 -5.81172789e-01
 -5.81172789e-01  7.99456365e-01  1.00879913e+00  1.00879913e+00
  1.00879913e+00  5.49150070e+00  7.14908346e+00  7.14908346e+00
  7.14908346e+00  2.63701012e+01  3.31197652e+01  3.31197652e+01
  3.31197652e+01  1.28747744e+02  1.28747744e+02  1.28747744e+02
  1.32176723e+02  4.83175439e+02  4.83175439e+02  4.83175439e+02
  6.18012375e+02  1.33498642e+03  1.33498642e+03  1.33498642e+03
  2.68495595e+03  3.02915821e+03  3.02915821e+03  3.02915821e+03
  6.64955179e+03  6.64955179e+03  6.64955179e+03  9.08823645e+03
  2.54423034e+04  7.61828201e+04]
E1 = -728.2683122368092  E_coul = 201.52449405167312
cycle= 3 E= -526.743818185136  delta_E= -5.97e-05  |g|= 0.00636  |ddm|= 0.0153
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.013413
diis-c [-7.91035242e-07 -1.30510956e-03  1.44292275e-01  8.57012835e-01]
  HOMO = -0.58267859728207  LUMO = 0.798511424889385
  mo_energy =
[-1.18581368e+02 -1.23118888e+01 -9.56240728e+00 -9.56240728e+00
 -9.56240728e+00 -1.26994108e+00 -5.82678597e-01 -5.82678597e-01
 -5.82678597e-01  7.98511425e-01  1.00772249e+00  1.00772249e+00
  1.00772249e+00  5.48862746e+00  7.14531148e+00  7.14531148e+00
  7.14531148e+00  2.63646786e+01  3.31135362e+01  3.31135362e+01
  3.31135362e+01  1.28739310e+02  1.28739310e+02  1.28739310e+02
  1.32168324e+02  4.83165497e+02  4.83165497e+02  4.83165497e+02
  6.18002098e+02  1.33497588e+03  1.33497588e+03  1.33497588e+03
  2.68494478e+03  3.02914728e+03  3.02914728e+03  3.02914728e+03
  6.64954047e+03  6.64954047e+03  6.64954047e+03  9.08822490e+03
  2.54422917e+04  7.61828082e+04]
E1 = -728.2913629748508  E_coul = 201.5475428285145
cycle= 4 E= -526.743820146336  delta_E= -1.96e-06  |g|= 0.0001  |ddm|= 0.00219
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119259
diis-c [-5.85834691e-09  8.61696534e-05 -1.20422608e-02 -7.55592948e-02
  1.08751539e+00]
  HOMO = -0.582658914629449  LUMO = 0.798539872046594
  mo_energy =
[-1.18581319e+02 -1.23118176e+01 -9.56234984e+00 -9.56234984e+00
 -9.56234984e+00 -1.26989816e+00 -5.82658915e-01 -5.82658915e-01
 -5.82658915e-01  7.98539872e-01  1.00773910e+00  1.00773910e+00
  1.00773910e+00  5.48867821e+00  7.14535676e+00  7.14535676e+00
  7.14535676e+00  2.63647417e+01  3.31135914e+01  3.31135914e+01
  3.31135914e+01  1.28739366e+02  1.28739366e+02  1.28739366e+02
  1.32168383e+02  4.83165547e+02  4.83165547e+02  4.83165547e+02
  6.18002141e+02  1.33497592e+03  1.33497592e+03  1.33497592e+03
  2.68494480e+03  3.02914731e+03  3.02914731e+03  3.02914731e+03
  6.64954048e+03  6.64954048e+03  6.64954048e+03  9.08822491e+03
  2.54422917e+04  7.61828082e+04]
E1 = -728.2911191010285  E_coul = 201.54729895292965
cycle= 5 E= -526.743820148099  delta_E= -1.76e-09  |g|= 2.04e-05  |ddm|= 0.000163
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.83125e-05
diis-c [-1.00768826e-10  1.26472082e-05 -1.59500873e-03 -1.21714990e-02
  3.18228730e-02  9.81930988e-01]
  HOMO = -0.582666829036741  LUMO = 0.798536639969061
  mo_energy =
[-1.18581350e+02 -1.23118415e+01 -9.56237550e+00 -9.56237550e+00
 -9.56237550e+00 -1.26990472e+00 -5.82666829e-01 -5.82666829e-01
 -5.82666829e-01  7.98536640e-01  1.00773385e+00  1.00773385e+00
  1.00773385e+00  5.48866551e+00  7.14533937e+00  7.14533937e+00
  7.14533937e+00  2.63647194e+01  3.31135666e+01  3.31135666e+01
  3.31135666e+01  1.28739337e+02  1.28739337e+02  1.28739337e+02
  1.32168354e+02  4.83165515e+02  4.83165515e+02  4.83165515e+02
  6.18002109e+02  1.33497589e+03  1.33497589e+03  1.33497589e+03
  2.68494477e+03  3.02914727e+03  3.02914727e+03  3.02914727e+03
  6.64954045e+03  6.64954045e+03  6.64954045e+03  9.08822488e+03
  2.54422917e+04  7.61828082e+04]
E1 = -728.2912038441865  E_coul = 201.5473836960291
cycle= 6 E= -526.743820148157  delta_E= -5.85e-11  |g|= 1.79e-06  |ddm|= 2.01e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2912038441865  E_coul = 201.5473836960291
  HOMO = -0.582666671807718  LUMO = 0.798537033212572
  mo_energy =
[-1.18581349e+02 -1.23118407e+01 -9.56237476e+00 -9.56237476e+00
 -9.56237476e+00 -1.26990415e+00 -5.82666672e-01 -5.82666672e-01
 -5.82666672e-01  7.98537033e-01  1.00773402e+00  1.00773402e+00
  1.00773402e+00  5.48866606e+00  7.14533987e+00  7.14533987e+00
  7.14533987e+00  2.63647201e+01  3.31135673e+01  3.31135673e+01
  3.31135673e+01  1.28739338e+02  1.28739338e+02  1.28739338e+02
  1.32168355e+02  4.83165517e+02  4.83165517e+02  4.83165517e+02
  6.18002110e+02  1.33497589e+03  1.33497589e+03  1.33497589e+03
  2.68494477e+03  3.02914728e+03  3.02914728e+03  3.02914728e+03
  6.64954045e+03  6.64954045e+03  6.64954045e+03  9.08822488e+03
  2.54422917e+04  7.61828082e+04]
E1 = -728.2912002089596  E_coul = 201.54738006080152
Extra cycle  E= -526.743820148158  delta_E= -6.82e-13  |g|= 3.88e-07  |ddm|= 3.34e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111358.93945283796
E1 = -728.2912002089596  E_coul = 201.54738006080152
init E= -526.743820148158
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.582666758340062  LUMO = 0.798537036446432
  mo_energy =
[-1.18581350e+02 -1.23118410e+01 -9.56237505e+00 -9.56237505e+00
 -9.56237505e+00 -1.26990417e+00 -5.82666758e-01 -5.82666758e-01
 -5.82666758e-01  7.98537036e-01  1.00773397e+00  1.00773397e+00
  1.00773397e+00  5.48866595e+00  7.14533968e+00  7.14533968e+00
  7.14533968e+00  2.63647199e+01  3.31135671e+01  3.31135671e+01
  3.31135671e+01  1.28739338e+02  1.28739338e+02  1.28739338e+02
  1.32168355e+02  4.83165516e+02  4.83165516e+02  4.83165516e+02
  6.18002109e+02  1.33497589e+03  1.33497589e+03  1.33497589e+03
  2.68494477e+03  3.02914727e+03  3.02914727e+03  3.02914727e+03
  6.64954045e+03  6.64954045e+03  6.64954045e+03  9.08822488e+03
  2.54422917e+04  7.61828082e+04]
E1 = -728.2912010708305  E_coul = 201.5473809226726
cycle= 1 E= -526.743820148158  delta_E= 1.14e-13  |g|= 9.41e-08  |ddm|= 6.26e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2912010708305  E_coul = 201.5473809226726
  HOMO = -0.582666745392101  LUMO = 0.798537057426995
  mo_energy =
[-1.18581349e+02 -1.23118409e+01 -9.56237498e+00 -9.56237498e+00
 -9.56237498e+00 -1.26990414e+00 -5.82666745e-01 -5.82666745e-01
 -5.82666745e-01  7.98537057e-01  1.00773398e+00  1.00773398e+00
  1.00773398e+00  5.48866599e+00  7.14533972e+00  7.14533972e+00
  7.14533972e+00  2.63647199e+01  3.31135671e+01  3.31135671e+01
  3.31135671e+01  1.28739338e+02  1.28739338e+02  1.28739338e+02
  1.32168355e+02  4.83165516e+02  4.83165516e+02  4.83165516e+02
  6.18002110e+02  1.33497589e+03  1.33497589e+03  1.33497589e+03
  2.68494477e+03  3.02914727e+03  3.02914727e+03  3.02914727e+03
  6.64954045e+03  6.64954045e+03  6.64954045e+03  9.08822488e+03
  2.54422917e+04  7.61828082e+04]
E1 = -728.2912007934517  E_coul = 201.54738064529388
Extra cycle  E= -526.743820148158  delta_E= 1.14e-13  |g|= 2.14e-08  |ddm|= 1.45e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826580e+04 7.61751725e+03 3.61735322e+03 1.59773015e+03
 3.82736183e+02 1.09784936e+02 3.70410192e+01 1.06821342e+01
 4.42180052e+00 6.09271968e-01 1.73001935e+00 2.23929328e-01
 1.36278394e+03 6.64738430e+02 3.00927803e+02 3.14012797e+02
 6.16412716e+01 7.30017491e+00 2.02706682e+01 7.70265952e-01
 2.75058404e+00 2.22218604e-01]
grad_E = [-1.51850931e-06  3.31682230e-06 -1.57726048e-06  6.93441103e-05
  1.62644756e-05 -1.44734217e-03  3.45723991e-05  4.44744277e-04
 -1.21053274e-03 -1.17582376e-02 -1.21294884e-03  2.77567154e-02
 -5.02115996e-07  5.07440439e-06  2.40201300e-05  2.07073862e-05
 -5.11713150e-05  3.34321316e-03 -1.33881648e-04 -6.32890941e-03
 -7.51672726e-03  2.29259530e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:59 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6585297        1
[INPUT] 0    0    [1    /1   ]  7617.51621693        1
[INPUT] 0    0    [1    /1   ]  3617.35374567        1
[INPUT] 0    0    [1    /1   ]  1597.70932965        1
[INPUT] 0    0    [1    /1   ]  382.694203507        1
[INPUT] 0    0    [1    /1   ]  110.29971971         1
[INPUT] 0    0    [1    /1   ]  37.217941797         1
[INPUT] 0    0    [1    /1   ]  11.2713406661        1
[INPUT] 0    0    [1    /1   ]  4.7021133644         1
[INPUT] 0    0    [1    /1   ]  0.615027377251       1
[INPUT] 0    0    [1    /1   ]  1.96736208042        1
[INPUT] 0    0    [1    /1   ]  0.228652415284       1
[INPUT] 1    0    [1    /1   ]  1362.78410489        1
[INPUT] 1    0    [1    /1   ]  664.736808648        1
[INPUT] 1    0    [1    /1   ]  300.920151699        1
[INPUT] 1    0    [1    /1   ]  314.006199998        1
[INPUT] 1    0    [1    /1   ]  61.6491764993        1
[INPUT] 1    0    [1    /1   ]  7.33045604735        1
[INPUT] 1    0    [1    /1   ]  20.2510975913        1
[INPUT] 1    0    [1    /1   ]  0.773035706287       1
[INPUT] 1    0    [1    /1   ]  2.7733252379         1
[INPUT] 1    0    [1    /1   ]  0.220271571753       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.658529674412, 1.0]], [0, [7617.516216933166, 1.0]], [0, [3617.3537456691847, 1.0]], [0, [1597.7093296524397, 1.0]], [0, [382.694203507174, 1.0]], [0, [110.29971971040221, 1.0]], [0, [37.217941796988654, 1.0]], [0, [11.271340666058272, 1.0]], [0, [4.7021133644044095, 1.0]], [0, [0.6150273772510477, 1.0]], [0, [1.9673620804235217, 1.0]], [0, [0.22865241528385893, 1.0]], [1, [1362.7841048891746, 1.0]], [1, [664.736808647826, 1.0]], [1, [300.9201516985791, 1.0]], [1, [314.0061999977824, 1.0]], [1, [61.649176499324724, 1.0]], [1, [7.3304560473514, 1.0]], [1, [20.251097591348735, 1.0]], [1, [0.7730357062869682, 1.0]], [1, [2.77332523789817, 1.0]], [1, [0.22027157175300774, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65852967]
bas 1, expnt(s) = [7617.51621693]
bas 2, expnt(s) = [3617.35374567]
bas 3, expnt(s) = [1597.70932965]
bas 4, expnt(s) = [382.69420351]
bas 5, expnt(s) = [110.29971971]
bas 6, expnt(s) = [37.2179418]
bas 7, expnt(s) = [11.27134067]
bas 8, expnt(s) = [4.70211336]
bas 9, expnt(s) = [0.61502738]
bas 10, expnt(s) = [1.96736208]
bas 11, expnt(s) = [0.22865242]
bas 12, expnt(s) = [1362.78410489]
bas 13, expnt(s) = [664.73680865]
bas 14, expnt(s) = [300.9201517]
bas 15, expnt(s) = [314.0062]
bas 16, expnt(s) = [61.6491765]
bas 17, expnt(s) = [7.33045605]
bas 18, expnt(s) = [20.25109759]
bas 19, expnt(s) = [0.77303571]
bas 20, expnt(s) = [2.77332524]
bas 21, expnt(s) = [0.22027157]
CPU time:       202.19
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826585e+04 5.20026327e+03 7.61751622e+03 2.06003721e+03
 3.61735375e+03 1.17844213e+03 1.59770933e+03 6.38466849e+02
 3.82694204e+02 2.18601903e+02 1.10299720e+02 8.59895806e+01
 3.72179418e+01 3.80696855e+01 1.12713407e+01 1.55416350e+01
 4.70211336e+00 8.06742331e+00 6.15027377e-01 1.75463125e+00
 1.96736208e+00 4.19689638e+00 2.28652415e-01 8.35404613e-01
 1.36278410e+03 2.41556216e+04 6.64736809e+02 9.84683254e+03
 3.00920152e+02 3.65635607e+03 3.14006200e+02 3.85617888e+03
 6.16491765e+01 5.03957012e+02 7.33045605e+00 3.51882878e+01
 2.02510976e+01 1.25327132e+02 7.73035706e-01 2.11462730e+00
 2.77332524e+00 1.04408390e+01 2.20271572e-01 4.40232860e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994022751962458
cond(S) = 111998.63225323276
E1 = -729.530196931005  E_coul = 203.17020521607347
init E= -526.359991714932
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.556026071080807  LUMO = 0.848152177623666
  mo_energy =
[-1.18330583e+02 -1.22068775e+01 -9.44745632e+00 -9.44745632e+00
 -9.44745632e+00 -1.24039362e+00 -5.56026071e-01 -5.56026071e-01
 -5.56026071e-01  8.48152178e-01  1.02066676e+00  1.02066676e+00
  1.02066676e+00  6.14465076e+00  7.26538833e+00  7.26538833e+00
  7.26538833e+00  2.90435913e+01  3.33780299e+01  3.33780299e+01
  3.33780299e+01  1.29059361e+02  1.29059361e+02  1.29059361e+02
  1.37345567e+02  4.83522191e+02  4.83522191e+02  4.83522191e+02
  6.24528200e+02  1.33536030e+03  1.33536030e+03  1.33536030e+03
  2.69155681e+03  3.02956985e+03  3.02956985e+03  3.02956985e+03
  6.65005414e+03  6.65005414e+03  6.65005414e+03  9.09453182e+03
  2.54483820e+04  7.61886124e+04]
E1 = -727.8068274721784  E_coul = 201.06290604684588
cycle= 1 E= -526.743921425332  delta_E= -0.384  |g|= 0.187  |ddm|= 0.277
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.55201
diis-c [-0.30471504  1.        ]
  HOMO = -0.591644482666771  LUMO = 0.825156744441519
  mo_energy =
[-1.18642572e+02 -1.23468334e+01 -9.59862820e+00 -9.59862820e+00
 -9.59862820e+00 -1.28080222e+00 -5.91644483e-01 -5.91644483e-01
 -5.91644483e-01  8.25156744e-01  9.95957301e-01  9.95957301e-01
  9.95957301e-01  6.07180036e+00  7.17321211e+00  7.17321211e+00
  7.17321211e+00  2.89089010e+01  3.32211075e+01  3.32211075e+01
  3.32211075e+01  1.28827460e+02  1.28827460e+02  1.28827460e+02
  1.37118451e+02  4.83211289e+02  4.83211289e+02  4.83211289e+02
  6.24179743e+02  1.33499252e+03  1.33499252e+03  1.33499252e+03
  2.69105470e+03  3.02913557e+03  3.02913557e+03  3.02913557e+03
  6.64950617e+03  6.64950617e+03  6.64950617e+03  9.09390864e+03
  2.54476644e+04  7.61878045e+04]
E1 = -728.3952559935519  E_coul = 201.6505869985162
cycle= 2 E= -526.744668995036  delta_E= -0.000748  |g|= 0.0385  |ddm|= 0.0537
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0778384
diis-c [-0.00356046  0.08347845  0.91652155]
  HOMO = -0.582292666468876  LUMO = 0.831806265574479
  mo_energy =
[-1.18573423e+02 -1.23078478e+01 -9.55794232e+00 -9.55794232e+00
 -9.55794232e+00 -1.26964116e+00 -5.82292666e-01 -5.82292666e-01
 -5.82292666e-01  8.31806266e-01  1.00278916e+00  1.00278916e+00
  1.00278916e+00  6.09177888e+00  7.19744643e+00  7.19744643e+00
  7.19744643e+00  2.89456873e+01  3.32621398e+01  3.32621398e+01
  3.32621398e+01  1.28884617e+02  1.28884617e+02  1.28884617e+02
  1.37175740e+02  4.83279613e+02  4.83279613e+02  4.83279613e+02
  6.24250260e+02  1.33506495e+03  1.33506495e+03  1.33506495e+03
  2.69113044e+03  3.02921028e+03  3.02921028e+03  3.02921028e+03
  6.64958264e+03  6.64958264e+03  6.64958264e+03  9.09398593e+03
  2.54477423e+04  7.61878827e+04]
E1 = -728.2402478988147  E_coul = 201.49551667595549
cycle= 3 E= -526.744731222859  delta_E= -6.22e-05  |g|= 0.00646  |ddm|= 0.0158
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136223
diis-c [-7.70593697e-07 -1.30577670e-03  1.44331346e-01  8.56974430e-01]
  HOMO = -0.583830702917421  LUMO = 0.830780029534882
  mo_energy =
[-1.18583640e+02 -1.23138148e+01 -9.56426727e+00 -9.56426727e+00
 -9.56426727e+00 -1.27138790e+00 -5.83830703e-01 -5.83830703e-01
 -5.83830703e-01  8.30780030e-01  1.00168687e+00  1.00168687e+00
  1.00168687e+00  6.08864330e+00  7.19358227e+00  7.19358227e+00
  7.19358227e+00  2.89400293e+01  3.32557980e+01  3.32557980e+01
  3.32557980e+01  1.28876045e+02  1.28876045e+02  1.28876045e+02
  1.37167186e+02  4.83269514e+02  4.83269514e+02  4.83269514e+02
  6.24239824e+02  1.33505424e+03  1.33505424e+03  1.33505424e+03
  2.69111910e+03  3.02919918e+03  3.02919918e+03  3.02919918e+03
  6.64957114e+03  6.64957114e+03  6.64957114e+03  9.09397421e+03
  2.54477304e+04  7.61878706e+04]
E1 = -728.2638402237748  E_coul = 201.51910696075873
cycle= 4 E= -526.744733263016  delta_E= -2.04e-06  |g|= 9e-05  |ddm|= 0.00228
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000109708
diis-c [-5.00743740e-09  7.79321621e-05 -1.10143280e-02 -6.90379883e-02
  1.07997438e+00]
  HOMO = -0.583810527724198  LUMO = 0.830807544932128
  mo_energy =
[-1.18583589e+02 -1.23137441e+01 -9.56420938e+00 -9.56420938e+00
 -9.56420938e+00 -1.27134749e+00 -5.83810528e-01 -5.83810528e-01
 -5.83810528e-01  8.30807545e-01  1.00170341e+00  1.00170341e+00
  1.00170341e+00  6.08869503e+00  7.19362780e+00  7.19362780e+00
  7.19362780e+00  2.89400921e+01  3.32558536e+01  3.32558536e+01
  3.32558536e+01  1.28876102e+02  1.28876102e+02  1.28876102e+02
  1.37167245e+02  4.83269564e+02  4.83269564e+02  4.83269564e+02
  6.24239867e+02  1.33505429e+03  1.33505429e+03  1.33505429e+03
  2.69111912e+03  3.02919921e+03  3.02919921e+03  3.02919921e+03
  6.64957116e+03  6.64957116e+03  6.64957116e+03  9.09397423e+03
  2.54477304e+04  7.61878706e+04]
E1 = -728.2636015434654  E_coul = 201.5188682791629
cycle= 5 E= -526.744733264302  delta_E= -1.29e-09  |g|= 1.93e-05  |ddm|= 0.000138
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.65809e-05
diis-c [-7.99908852e-11  1.20011436e-05 -1.54450048e-03 -1.17340033e-02
  4.46117513e-02  9.68654751e-01]
  HOMO = -0.583817958441943  LUMO = 0.830804149978169
  mo_energy =
[-1.18583619e+02 -1.23137666e+01 -9.56423363e+00 -9.56423363e+00
 -9.56423363e+00 -1.27135388e+00 -5.83817958e-01 -5.83817958e-01
 -5.83817958e-01  8.30804150e-01  1.00169846e+00  1.00169846e+00
  1.00169846e+00  6.08868213e+00  7.19361132e+00  7.19361132e+00
  7.19361132e+00  2.89400706e+01  3.32558301e+01  3.32558301e+01
  3.32558301e+01  1.28876074e+02  1.28876074e+02  1.28876074e+02
  1.37167217e+02  4.83269534e+02  4.83269534e+02  4.83269534e+02
  6.24239837e+02  1.33505425e+03  1.33505425e+03  1.33505425e+03
  2.69111909e+03  3.02919918e+03  3.02919918e+03  3.02919918e+03
  6.64957113e+03  6.64957113e+03  6.64957113e+03  9.09397419e+03
  2.54477303e+04  7.61878706e+04]
E1 = -728.2636828891208  E_coul = 201.5189496247697
cycle= 6 E= -526.744733264351  delta_E= -4.87e-11  |g|= 1.72e-06  |ddm|= 1.69e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2636828891208  E_coul = 201.5189496247697
  HOMO = -0.583817897392735  LUMO = 0.830804490444256
  mo_energy =
[-1.18583619e+02 -1.23137662e+01 -9.56423326e+00 -9.56423326e+00
 -9.56423326e+00 -1.27135342e+00 -5.83817897e-01 -5.83817897e-01
 -5.83817897e-01  8.30804490e-01  1.00169855e+00  1.00169855e+00
  1.00169855e+00  6.08868251e+00  7.19361157e+00  7.19361157e+00
  7.19361157e+00  2.89400710e+01  3.32558305e+01  3.32558305e+01
  3.32558305e+01  1.28876075e+02  1.28876075e+02  1.28876075e+02
  1.37167218e+02  4.83269535e+02  4.83269535e+02  4.83269535e+02
  6.24239837e+02  1.33505426e+03  1.33505426e+03  1.33505426e+03
  2.69111909e+03  3.02919918e+03  3.02919918e+03  3.02919918e+03
  6.64957113e+03  6.64957113e+03  6.64957113e+03  9.09397419e+03
  2.54477303e+04  7.61878706e+04]
E1 = -728.2636806287122  E_coul = 201.5189473643597
Extra cycle  E= -526.744733264353  delta_E= -1.48e-12  |g|= 3.6e-07  |ddm|= 3.2e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826585e+04 7.61751622e+03 3.61735375e+03 1.59770933e+03
 3.82694204e+02 1.10299720e+02 3.72179418e+01 1.12713407e+01
 4.70211336e+00 6.15027377e-01 1.96736208e+00 2.28652415e-01
 1.36278410e+03 6.64736809e+02 3.00920152e+02 3.14006200e+02
 6.16491765e+01 7.33045605e+00 2.02510976e+01 7.73035706e-01
 2.77332524e+00 2.20271572e-01]
E = -526.7447332643526
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:23:59 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6585297        1
[INPUT] 0    0    [1    /1   ]  7617.51621693        1
[INPUT] 0    0    [1    /1   ]  3617.35374567        1
[INPUT] 0    0    [1    /1   ]  1597.70932965        1
[INPUT] 0    0    [1    /1   ]  382.694203507        1
[INPUT] 0    0    [1    /1   ]  110.29971971         1
[INPUT] 0    0    [1    /1   ]  37.217941797         1
[INPUT] 0    0    [1    /1   ]  11.2713406661        1
[INPUT] 0    0    [1    /1   ]  4.7021133644         1
[INPUT] 0    0    [1    /1   ]  0.615027377251       1
[INPUT] 0    0    [1    /1   ]  1.96736208042        1
[INPUT] 0    0    [1    /1   ]  0.228652415284       1
[INPUT] 1    0    [1    /1   ]  1362.78410489        1
[INPUT] 1    0    [1    /1   ]  664.736808648        1
[INPUT] 1    0    [1    /1   ]  300.920151699        1
[INPUT] 1    0    [1    /1   ]  314.006199998        1
[INPUT] 1    0    [1    /1   ]  61.6491764993        1
[INPUT] 1    0    [1    /1   ]  7.33045604735        1
[INPUT] 1    0    [1    /1   ]  20.2510975913        1
[INPUT] 1    0    [1    /1   ]  0.773035706287       1
[INPUT] 1    0    [1    /1   ]  2.7733252379         1
[INPUT] 1    0    [1    /1   ]  0.220271571753       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.658529674412, 1.0]], [0, [7617.516216933166, 1.0]], [0, [3617.3537456691847, 1.0]], [0, [1597.7093296524397, 1.0]], [0, [382.694203507174, 1.0]], [0, [110.29971971040221, 1.0]], [0, [37.217941796988654, 1.0]], [0, [11.271340666058272, 1.0]], [0, [4.7021133644044095, 1.0]], [0, [0.6150273772510477, 1.0]], [0, [1.9673620804235217, 1.0]], [0, [0.22865241528385893, 1.0]], [1, [1362.7841048891746, 1.0]], [1, [664.736808647826, 1.0]], [1, [300.9201516985791, 1.0]], [1, [314.0061999977824, 1.0]], [1, [61.649176499324724, 1.0]], [1, [7.3304560473514, 1.0]], [1, [20.251097591348735, 1.0]], [1, [0.7730357062869682, 1.0]], [1, [2.77332523789817, 1.0]], [1, [0.22027157175300774, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65852967]
bas 1, expnt(s) = [7617.51621693]
bas 2, expnt(s) = [3617.35374567]
bas 3, expnt(s) = [1597.70932965]
bas 4, expnt(s) = [382.69420351]
bas 5, expnt(s) = [110.29971971]
bas 6, expnt(s) = [37.2179418]
bas 7, expnt(s) = [11.27134067]
bas 8, expnt(s) = [4.70211336]
bas 9, expnt(s) = [0.61502738]
bas 10, expnt(s) = [1.96736208]
bas 11, expnt(s) = [0.22865242]
bas 12, expnt(s) = [1362.78410489]
bas 13, expnt(s) = [664.73680865]
bas 14, expnt(s) = [300.9201517]
bas 15, expnt(s) = [314.0062]
bas 16, expnt(s) = [61.6491765]
bas 17, expnt(s) = [7.33045605]
bas 18, expnt(s) = [20.25109759]
bas 19, expnt(s) = [0.77303571]
bas 20, expnt(s) = [2.77332524]
bas 21, expnt(s) = [0.22027157]
CPU time:       202.60
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826585e+04 5.20026327e+03 7.61751622e+03 2.06003721e+03
 3.61735375e+03 1.17844213e+03 1.59770933e+03 6.38466849e+02
 3.82694204e+02 2.18601903e+02 1.10299720e+02 8.59895806e+01
 3.72179418e+01 3.80696855e+01 1.12713407e+01 1.55416350e+01
 4.70211336e+00 8.06742331e+00 6.15027377e-01 1.75463125e+00
 1.96736208e+00 4.19689638e+00 2.28652415e-01 8.35404613e-01
 1.36278410e+03 2.41556216e+04 6.64736809e+02 9.84683254e+03
 3.00920152e+02 3.65635607e+03 3.14006200e+02 3.85617888e+03
 6.16491765e+01 5.03957012e+02 7.33045605e+00 3.51882878e+01
 2.02510976e+01 1.25327132e+02 7.73035706e-01 2.11462730e+00
 2.77332524e+00 1.04408390e+01 2.20271572e-01 4.40232860e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994022751962458
cond(S) = 111998.63225323276
E1 = -729.530196931005  E_coul = 203.17020521607347
init E= -526.359991714932
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556026071080807  LUMO = 0.848152177623666
  mo_energy =
[-1.18330583e+02 -1.22068775e+01 -9.44745632e+00 -9.44745632e+00
 -9.44745632e+00 -1.24039362e+00 -5.56026071e-01 -5.56026071e-01
 -5.56026071e-01  8.48152178e-01  1.02066676e+00  1.02066676e+00
  1.02066676e+00  6.14465076e+00  7.26538833e+00  7.26538833e+00
  7.26538833e+00  2.90435913e+01  3.33780299e+01  3.33780299e+01
  3.33780299e+01  1.29059361e+02  1.29059361e+02  1.29059361e+02
  1.37345567e+02  4.83522191e+02  4.83522191e+02  4.83522191e+02
  6.24528200e+02  1.33536030e+03  1.33536030e+03  1.33536030e+03
  2.69155681e+03  3.02956985e+03  3.02956985e+03  3.02956985e+03
  6.65005414e+03  6.65005414e+03  6.65005414e+03  9.09453182e+03
  2.54483820e+04  7.61886124e+04]
E1 = -727.8068274721784  E_coul = 201.06290604684588
cycle= 1 E= -526.743921425332  delta_E= -0.384  |g|= 0.187  |ddm|= 0.277
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.55201
diis-c [-0.30471504  1.        ]
  HOMO = -0.591644482666771  LUMO = 0.825156744441519
  mo_energy =
[-1.18642572e+02 -1.23468334e+01 -9.59862820e+00 -9.59862820e+00
 -9.59862820e+00 -1.28080222e+00 -5.91644483e-01 -5.91644483e-01
 -5.91644483e-01  8.25156744e-01  9.95957301e-01  9.95957301e-01
  9.95957301e-01  6.07180036e+00  7.17321211e+00  7.17321211e+00
  7.17321211e+00  2.89089010e+01  3.32211075e+01  3.32211075e+01
  3.32211075e+01  1.28827460e+02  1.28827460e+02  1.28827460e+02
  1.37118451e+02  4.83211289e+02  4.83211289e+02  4.83211289e+02
  6.24179743e+02  1.33499252e+03  1.33499252e+03  1.33499252e+03
  2.69105470e+03  3.02913557e+03  3.02913557e+03  3.02913557e+03
  6.64950617e+03  6.64950617e+03  6.64950617e+03  9.09390864e+03
  2.54476644e+04  7.61878045e+04]
E1 = -728.3952559935519  E_coul = 201.6505869985162
cycle= 2 E= -526.744668995036  delta_E= -0.000748  |g|= 0.0385  |ddm|= 0.0537
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0778384
diis-c [-0.00356046  0.08347845  0.91652155]
  HOMO = -0.582292666468876  LUMO = 0.831806265574479
  mo_energy =
[-1.18573423e+02 -1.23078478e+01 -9.55794232e+00 -9.55794232e+00
 -9.55794232e+00 -1.26964116e+00 -5.82292666e-01 -5.82292666e-01
 -5.82292666e-01  8.31806266e-01  1.00278916e+00  1.00278916e+00
  1.00278916e+00  6.09177888e+00  7.19744643e+00  7.19744643e+00
  7.19744643e+00  2.89456873e+01  3.32621398e+01  3.32621398e+01
  3.32621398e+01  1.28884617e+02  1.28884617e+02  1.28884617e+02
  1.37175740e+02  4.83279613e+02  4.83279613e+02  4.83279613e+02
  6.24250260e+02  1.33506495e+03  1.33506495e+03  1.33506495e+03
  2.69113044e+03  3.02921028e+03  3.02921028e+03  3.02921028e+03
  6.64958264e+03  6.64958264e+03  6.64958264e+03  9.09398593e+03
  2.54477423e+04  7.61878827e+04]
E1 = -728.2402478988147  E_coul = 201.49551667595549
cycle= 3 E= -526.744731222859  delta_E= -6.22e-05  |g|= 0.00646  |ddm|= 0.0158
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136223
diis-c [-7.70593697e-07 -1.30577670e-03  1.44331346e-01  8.56974430e-01]
  HOMO = -0.583830702917421  LUMO = 0.830780029534882
  mo_energy =
[-1.18583640e+02 -1.23138148e+01 -9.56426727e+00 -9.56426727e+00
 -9.56426727e+00 -1.27138790e+00 -5.83830703e-01 -5.83830703e-01
 -5.83830703e-01  8.30780030e-01  1.00168687e+00  1.00168687e+00
  1.00168687e+00  6.08864330e+00  7.19358227e+00  7.19358227e+00
  7.19358227e+00  2.89400293e+01  3.32557980e+01  3.32557980e+01
  3.32557980e+01  1.28876045e+02  1.28876045e+02  1.28876045e+02
  1.37167186e+02  4.83269514e+02  4.83269514e+02  4.83269514e+02
  6.24239824e+02  1.33505424e+03  1.33505424e+03  1.33505424e+03
  2.69111910e+03  3.02919918e+03  3.02919918e+03  3.02919918e+03
  6.64957114e+03  6.64957114e+03  6.64957114e+03  9.09397421e+03
  2.54477304e+04  7.61878706e+04]
E1 = -728.2638402237748  E_coul = 201.51910696075873
cycle= 4 E= -526.744733263016  delta_E= -2.04e-06  |g|= 9e-05  |ddm|= 0.00228
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000109708
diis-c [-5.00743740e-09  7.79321621e-05 -1.10143280e-02 -6.90379883e-02
  1.07997438e+00]
  HOMO = -0.583810527724198  LUMO = 0.830807544932128
  mo_energy =
[-1.18583589e+02 -1.23137441e+01 -9.56420938e+00 -9.56420938e+00
 -9.56420938e+00 -1.27134749e+00 -5.83810528e-01 -5.83810528e-01
 -5.83810528e-01  8.30807545e-01  1.00170341e+00  1.00170341e+00
  1.00170341e+00  6.08869503e+00  7.19362780e+00  7.19362780e+00
  7.19362780e+00  2.89400921e+01  3.32558536e+01  3.32558536e+01
  3.32558536e+01  1.28876102e+02  1.28876102e+02  1.28876102e+02
  1.37167245e+02  4.83269564e+02  4.83269564e+02  4.83269564e+02
  6.24239867e+02  1.33505429e+03  1.33505429e+03  1.33505429e+03
  2.69111912e+03  3.02919921e+03  3.02919921e+03  3.02919921e+03
  6.64957116e+03  6.64957116e+03  6.64957116e+03  9.09397423e+03
  2.54477304e+04  7.61878706e+04]
E1 = -728.2636015434654  E_coul = 201.5188682791629
cycle= 5 E= -526.744733264302  delta_E= -1.29e-09  |g|= 1.93e-05  |ddm|= 0.000138
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.65809e-05
diis-c [-7.99908852e-11  1.20011436e-05 -1.54450048e-03 -1.17340033e-02
  4.46117513e-02  9.68654751e-01]
  HOMO = -0.583817958441943  LUMO = 0.830804149978169
  mo_energy =
[-1.18583619e+02 -1.23137666e+01 -9.56423363e+00 -9.56423363e+00
 -9.56423363e+00 -1.27135388e+00 -5.83817958e-01 -5.83817958e-01
 -5.83817958e-01  8.30804150e-01  1.00169846e+00  1.00169846e+00
  1.00169846e+00  6.08868213e+00  7.19361132e+00  7.19361132e+00
  7.19361132e+00  2.89400706e+01  3.32558301e+01  3.32558301e+01
  3.32558301e+01  1.28876074e+02  1.28876074e+02  1.28876074e+02
  1.37167217e+02  4.83269534e+02  4.83269534e+02  4.83269534e+02
  6.24239837e+02  1.33505425e+03  1.33505425e+03  1.33505425e+03
  2.69111909e+03  3.02919918e+03  3.02919918e+03  3.02919918e+03
  6.64957113e+03  6.64957113e+03  6.64957113e+03  9.09397419e+03
  2.54477303e+04  7.61878706e+04]
E1 = -728.2636828891208  E_coul = 201.5189496247697
cycle= 6 E= -526.744733264351  delta_E= -4.87e-11  |g|= 1.72e-06  |ddm|= 1.69e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2636828891208  E_coul = 201.5189496247697
  HOMO = -0.583817897392735  LUMO = 0.830804490444256
  mo_energy =
[-1.18583619e+02 -1.23137662e+01 -9.56423326e+00 -9.56423326e+00
 -9.56423326e+00 -1.27135342e+00 -5.83817897e-01 -5.83817897e-01
 -5.83817897e-01  8.30804490e-01  1.00169855e+00  1.00169855e+00
  1.00169855e+00  6.08868251e+00  7.19361157e+00  7.19361157e+00
  7.19361157e+00  2.89400710e+01  3.32558305e+01  3.32558305e+01
  3.32558305e+01  1.28876075e+02  1.28876075e+02  1.28876075e+02
  1.37167218e+02  4.83269535e+02  4.83269535e+02  4.83269535e+02
  6.24239837e+02  1.33505426e+03  1.33505426e+03  1.33505426e+03
  2.69111909e+03  3.02919918e+03  3.02919918e+03  3.02919918e+03
  6.64957113e+03  6.64957113e+03  6.64957113e+03  9.09397419e+03
  2.54477303e+04  7.61878706e+04]
E1 = -728.2636806287122  E_coul = 201.5189473643597
Extra cycle  E= -526.744733264353  delta_E= -1.48e-12  |g|= 3.6e-07  |ddm|= 3.2e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111998.63225323276
E1 = -728.2636806287122  E_coul = 201.5189473643597
init E= -526.744733264353
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583817956281017  LUMO = 0.830804511446783
  mo_energy =
[-1.18583619e+02 -1.23137663e+01 -9.56423344e+00 -9.56423344e+00
 -9.56423344e+00 -1.27135341e+00 -5.83817956e-01 -5.83817956e-01
 -5.83817956e-01  8.30804511e-01  1.00169852e+00  1.00169852e+00
  1.00169852e+00  6.08868245e+00  7.19361145e+00  7.19361145e+00
  7.19361145e+00  2.89400709e+01  3.32558303e+01  3.32558303e+01
  3.32558303e+01  1.28876074e+02  1.28876074e+02  1.28876074e+02
  1.37167218e+02  4.83269535e+02  4.83269535e+02  4.83269535e+02
  6.24239837e+02  1.33505425e+03  1.33505425e+03  1.33505425e+03
  2.69111909e+03  3.02919918e+03  3.02919918e+03  3.02919918e+03
  6.64957113e+03  6.64957113e+03  6.64957113e+03  9.09397419e+03
  2.54477303e+04  7.61878706e+04]
E1 = -728.263681117437  E_coul = 201.5189478530844
cycle= 1 E= -526.744733264353  delta_E=    0  |g|= 8.12e-08  |ddm|= 6.16e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.263681117437  E_coul = 201.5189478530844
  HOMO = -0.583817950064993  LUMO = 0.830804528508644
  mo_energy =
[-1.18583619e+02 -1.23137663e+01 -9.56423341e+00 -9.56423341e+00
 -9.56423341e+00 -1.27135339e+00 -5.83817950e-01 -5.83817950e-01
 -5.83817950e-01  8.30804529e-01  1.00169853e+00  1.00169853e+00
  1.00169853e+00  6.08868247e+00  7.19361147e+00  7.19361147e+00
  7.19361147e+00  2.89400709e+01  3.32558303e+01  3.32558303e+01
  3.32558303e+01  1.28876074e+02  1.28876074e+02  1.28876074e+02
  1.37167218e+02  4.83269535e+02  4.83269535e+02  4.83269535e+02
  6.24239837e+02  1.33505425e+03  1.33505425e+03  1.33505425e+03
  2.69111909e+03  3.02919918e+03  3.02919918e+03  3.02919918e+03
  6.64957113e+03  6.64957113e+03  6.64957113e+03  9.09397419e+03
  2.54477303e+04  7.61878706e+04]
E1 = -728.2636809475077  E_coul = 201.51894768315591
Extra cycle  E= -526.744733264352  delta_E= 7.96e-13  |g|= 1.73e-08  |ddm|= 1.37e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826585e+04 7.61751622e+03 3.61735375e+03 1.59770933e+03
 3.82694204e+02 1.10299720e+02 3.72179418e+01 1.12713407e+01
 4.70211336e+00 6.15027377e-01 1.96736208e+00 2.28652415e-01
 1.36278410e+03 6.64736809e+02 3.00920152e+02 3.14006200e+02
 6.16491765e+01 7.33045605e+00 2.02510976e+01 7.73035706e-01
 2.77332524e+00 2.20271572e-01]
grad_E = [-1.52608714e-06  3.40121010e-06 -1.52981777e-06  7.25530375e-05
 -6.97482046e-05 -1.00771872e-03 -6.35672000e-04  4.64172692e-04
 -1.22965315e-03 -1.44157406e-02 -5.71899328e-04  3.62143449e-02
 -5.13752139e-07  4.91669499e-06  2.30689680e-05  1.98896425e-05
  5.11243755e-05  4.34052724e-03 -8.42372296e-04  1.22859362e-02
 -7.44080265e-03 -4.44473764e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:04 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6594977        1
[INPUT] 0    0    [1    /1   ]  7617.51416279        1
[INPUT] 0    0    [1    /1   ]  3617.35479368        1
[INPUT] 0    0    [1    /1   ]  1597.66759396        1
[INPUT] 0    0    [1    /1   ]  382.622445649        1
[INPUT] 0    0    [1    /1   ]  111.223908398        1
[INPUT] 0    0    [1    /1   ]  37.7872051588        1
[INPUT] 0    0    [1    /1   ]  12.5026203277        1
[INPUT] 0    0    [1    /1   ]  5.35603492957        1
[INPUT] 0    0    [1    /1   ]  0.625764452813       1
[INPUT] 0    0    [1    /1   ]  2.4998049925         1
[INPUT] 0    0    [1    /1   ]  0.231172991368       1
[INPUT] 1    0    [1    /1   ]  1362.78442999        1
[INPUT] 1    0    [1    /1   ]  664.733587754        1
[INPUT] 1    0    [1    /1   ]  300.904954043        1
[INPUT] 1    0    [1    /1   ]  313.99309684         1
[INPUT] 1    0    [1    /1   ]  61.6631595805        1
[INPUT] 1    0    [1    /1   ]  7.3671925063         1
[INPUT] 1    0    [1    /1   ]  20.2255660491        1
[INPUT] 1    0    [1    /1   ]  0.777051970642       1
[INPUT] 1    0    [1    /1   ]  2.81174172383        1
[INPUT] 1    0    [1    /1   ]  0.218206612266       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659497713106, 1.0]], [0, [7617.51416278615, 1.0]], [0, [3617.3547936835585, 1.0]], [0, [1597.6675939608112, 1.0]], [0, [382.6224456492408, 1.0]], [0, [111.22390839798392, 1.0]], [0, [37.787205158758375, 1.0]], [0, [12.50262032770528, 1.0]], [0, [5.356034929565067, 1.0]], [0, [0.6257644528132127, 1.0]], [0, [2.4998049924974577, 1.0]], [0, [0.23117299136764974, 1.0]], [1, [1362.7844299878848, 1.0]], [1, [664.7335877535015, 1.0]], [1, [300.904954042873, 1.0]], [1, [313.99309684035484, 1.0]], [1, [61.6631595805187, 1.0]], [1, [7.367192506300286, 1.0]], [1, [20.22556604906008, 1.0]], [1, [0.7770519706421581, 1.0]], [1, [2.811741723828711, 1.0]], [1, [0.2182066122664593, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65949771]
bas 1, expnt(s) = [7617.51416279]
bas 2, expnt(s) = [3617.35479368]
bas 3, expnt(s) = [1597.66759396]
bas 4, expnt(s) = [382.62244565]
bas 5, expnt(s) = [111.2239084]
bas 6, expnt(s) = [37.78720516]
bas 7, expnt(s) = [12.50262033]
bas 8, expnt(s) = [5.35603493]
bas 9, expnt(s) = [0.62576445]
bas 10, expnt(s) = [2.49980499]
bas 11, expnt(s) = [0.23117299]
bas 12, expnt(s) = [1362.78442999]
bas 13, expnt(s) = [664.73358775]
bas 14, expnt(s) = [300.90495404]
bas 15, expnt(s) = [313.99309684]
bas 16, expnt(s) = [61.66315958]
bas 17, expnt(s) = [7.36719251]
bas 18, expnt(s) = [20.22556605]
bas 19, expnt(s) = [0.77705197]
bas 20, expnt(s) = [2.81174172]
bas 21, expnt(s) = [0.21820661]
CPU time:       208.38
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826595e+04 5.20026341e+03 7.61751416e+03 2.06003679e+03
 3.61735479e+03 1.17844239e+03 1.59766759e+03 6.38454341e+02
 3.82622446e+02 2.18571160e+02 1.11223908e+02 8.65293892e+01
 3.77872052e+01 3.85055741e+01 1.25026203e+01 1.67983183e+01
 5.35603493e+00 8.89503323e+00 6.25764453e-01 1.77755559e+00
 2.49980499e+00 5.02278539e+00 2.31172991e-01 8.42302023e-01
 1.36278443e+03 2.41556288e+04 6.64733588e+02 9.84677290e+03
 3.00904954e+02 3.65612525e+03 3.13993097e+02 3.85597774e+03
 6.16631596e+01 5.04099898e+02 7.36719251e+00 3.54088576e+01
 2.02255660e+01 1.25129655e+02 7.77051971e-01 2.12836925e+00
 2.81174172e+00 1.06219359e+01 2.18206612e-01 4.35080156e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993992596071287
cond(S) = 113296.76006047644
E1 = -729.5315540515212  E_coul = 203.17019909011836
init E= -526.361354961403
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556103056456304  LUMO = 0.893486079758051
  mo_energy =
[-1.18330946e+02 -1.22067264e+01 -9.44740340e+00 -9.44740340e+00
 -9.44740340e+00 -1.24063321e+00 -5.56103056e-01 -5.56103056e-01
 -5.56103056e-01  8.93486080e-01  1.01602097e+00  1.01602097e+00
  1.01602097e+00  7.34886465e+00  7.34886465e+00  7.34886465e+00
  7.53062236e+00  3.35934333e+01  3.35934333e+01  3.35934333e+01
  3.47772081e+01  1.29265495e+02  1.29265495e+02  1.29265495e+02
  1.48427472e+02  4.83683960e+02  4.83683960e+02  4.83683960e+02
  6.38326658e+02  1.33547799e+03  1.33547799e+03  1.33547799e+03
  2.70509200e+03  3.02963819e+03  3.02963819e+03  3.02963819e+03
  6.65008385e+03  6.65008385e+03  6.65008385e+03  9.10712413e+03
  2.54602966e+04  7.61997048e+04]
E1 = -727.7636028772183  E_coul = 201.01873224705017
cycle= 1 E= -526.744870630168  delta_E= -0.384  |g|= 0.188  |ddm|= 0.267
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.556696
diis-c [-0.30991097  1.        ]
  HOMO = -0.593480004770146  LUMO = 0.866983801709395
  mo_energy =
[-1.18645909e+02 -1.23496956e+01 -9.60148067e+00 -9.60148067e+00
 -9.60148067e+00 -1.28311996e+00 -5.93480005e-01 -5.93480005e-01
 -5.93480005e-01  8.66983802e-01  9.89990042e-01  9.89990042e-01
  9.89990042e-01  7.25335658e+00  7.25335658e+00  7.25335658e+00
  7.44566382e+00  3.34334252e+01  3.34334252e+01  3.34334252e+01
  3.46329648e+01  1.29030809e+02  1.29030809e+02  1.29030809e+02
  1.48195663e+02  4.83370053e+02  4.83370053e+02  4.83370053e+02
  6.37975316e+02  1.33510722e+03  1.33510722e+03  1.33510722e+03
  2.70458734e+03  3.02920107e+03  3.02920107e+03  3.02920107e+03
  6.64953309e+03  6.64953309e+03  6.64953309e+03  9.10649834e+03
  2.54595763e+04  7.61988941e+04]
E1 = -728.3651717521296  E_coul = 201.61952787845703
cycle= 2 E= -526.745643873673  delta_E= -0.000773  |g|= 0.0391  |ddm|= 0.0559
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0791751
diis-c [-0.00370073  0.08389385  0.91610615]
  HOMO = -0.583870627388165  LUMO = 0.874348699636869
  mo_energy =
[-1.18575561e+02 -1.23098308e+01 -9.55988117e+00 -9.55988117e+00
 -9.55988117e+00 -1.27166134e+00 -5.83870627e-01 -5.83870627e-01
 -5.83870627e-01  8.74348700e-01  9.97026151e-01  9.97026151e-01
  9.97026151e-01  7.27836419e+00  7.27836419e+00  7.27836419e+00
  7.46879578e+00  3.34753676e+01  3.34753676e+01  3.34753676e+01
  3.46723585e+01  1.29089034e+02  1.29089034e+02  1.29089034e+02
  1.48254263e+02  4.83439562e+02  4.83439562e+02  4.83439562e+02
  6.38046994e+02  1.33518088e+03  1.33518088e+03  1.33518088e+03
  2.70466433e+03  3.02927702e+03  3.02927702e+03  3.02927702e+03
  6.64961083e+03  6.64961083e+03  6.64961083e+03  9.10657690e+03
  2.54596555e+04  7.61989736e+04]
E1 = -728.2059553140236  E_coul = 201.46024628171193
cycle= 3 E= -526.745709032312  delta_E= -6.52e-05  |g|= 0.0066  |ddm|= 0.0165
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0139021
diis-c [-7.51499005e-07 -1.29640863e-03  1.44867178e-01  8.56429230e-01]
  HOMO = -0.585460819167997  LUMO = 0.873194273679492
  mo_energy =
[-1.18586004e+02 -1.23159550e+01 -9.56636446e+00 -9.56636446e+00
 -9.56636446e+00 -1.27347505e+00 -5.85460819e-01 -5.85460819e-01
 -5.85460819e-01  8.73194274e-01  9.95882222e-01  9.95882222e-01
  9.95882222e-01  7.27436233e+00  7.27436233e+00  7.27436233e+00
  7.46515313e+00  3.34688640e+01  3.34688640e+01  3.34688640e+01
  3.46662887e+01  1.29080266e+02  1.29080266e+02  1.29080266e+02
  1.48245474e+02  4.83429238e+02  4.83429238e+02  4.83429238e+02
  6.38036335e+02  1.33516994e+03  1.33516994e+03  1.33516994e+03
  2.70465275e+03  3.02926569e+03  3.02926569e+03  3.02926569e+03
  6.64959909e+03  6.64959909e+03  6.64959909e+03  9.10656495e+03
  2.54596433e+04  7.61989613e+04]
E1 = -728.2302908958401  E_coul = 201.48457970743718
cycle= 4 E= -526.745711188403  delta_E= -2.16e-06  |g|= 8.38e-05  |ddm|= 0.00239
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00010029
diis-c [-4.45826069e-09  7.14614613e-05 -1.01994022e-02 -6.33147052e-02
  1.07344265e+00]
  HOMO = -0.585440150917769  LUMO = 0.87322244986994
  mo_energy =
[-1.18585950e+02 -1.23158824e+01 -9.56630377e+00 -9.56630377e+00
 -9.56630377e+00 -1.27343565e+00 -5.85440151e-01 -5.85440151e-01
 -5.85440151e-01  8.73222450e-01  9.95898958e-01  9.95898958e-01
  9.95898958e-01  7.27440940e+00  7.27440940e+00  7.27440940e+00
  7.46520902e+00  3.34689222e+01  3.34689222e+01  3.34689222e+01
  3.46663536e+01  1.29080325e+02  1.29080325e+02  1.29080325e+02
  1.48245535e+02  4.83429292e+02  4.83429292e+02  4.83429292e+02
  6.38036382e+02  1.33516999e+03  1.33516999e+03  1.33516999e+03
  2.70465278e+03  3.02926573e+03  3.02926573e+03  3.02926573e+03
  6.64959912e+03  6.64959912e+03  6.64959912e+03  9.10656497e+03
  2.54596433e+04  7.61989613e+04]
E1 = -728.2300431945165  E_coul = 201.48433200503982
cycle= 5 E= -526.745711189477  delta_E= -1.07e-09  |g|= 1.89e-05  |ddm|= 0.000124
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.60518e-05
diis-c [-6.63291950e-11  1.18711897e-05 -1.56600626e-03 -1.17283776e-02
  5.45928192e-02  9.58689693e-01]
  HOMO = -0.585447373034148  LUMO = 0.873218747487922
  mo_energy =
[-1.18585980e+02 -1.23159044e+01 -9.56632736e+00 -9.56632736e+00
 -9.56632736e+00 -1.27344198e+00 -5.85447373e-01 -5.85447373e-01
 -5.85447373e-01  8.73218747e-01  9.95894107e-01  9.95894107e-01
  9.95894107e-01  7.27439325e+00  7.27439325e+00  7.27439325e+00
  7.46519489e+00  3.34688992e+01  3.34688992e+01  3.34688992e+01
  3.46663320e+01  1.29080298e+02  1.29080298e+02  1.29080298e+02
  1.48245509e+02  4.83429263e+02  4.83429263e+02  4.83429263e+02
  6.38036352e+02  1.33516996e+03  1.33516996e+03  1.33516996e+03
  2.70465275e+03  3.02926569e+03  3.02926569e+03  3.02926569e+03
  6.64959909e+03  6.64959909e+03  6.64959909e+03  9.10656493e+03
  2.54596433e+04  7.61989613e+04]
E1 = -728.2301234742489  E_coul = 201.48441228472672
cycle= 6 E= -526.745711189522  delta_E= -4.55e-11  |g|= 1.69e-06  |ddm|= 1.49e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2301234742489  E_coul = 201.48441228472672
  HOMO = -0.585447393245019  LUMO = 0.873219045691515
  mo_energy =
[-1.18585980e+02 -1.23159042e+01 -9.56632731e+00 -9.56632731e+00
 -9.56632731e+00 -1.27344162e+00 -5.85447393e-01 -5.85447393e-01
 -5.85447393e-01  8.73219046e-01  9.95894147e-01  9.95894147e-01
  9.95894147e-01  7.27439330e+00  7.27439330e+00  7.27439330e+00
  7.46519509e+00  3.34688993e+01  3.34688993e+01  3.34688993e+01
  3.46663321e+01  1.29080298e+02  1.29080298e+02  1.29080298e+02
  1.48245509e+02  4.83429263e+02  4.83429263e+02  4.83429263e+02
  6.38036353e+02  1.33516996e+03  1.33516996e+03  1.33516996e+03
  2.70465275e+03  3.02926569e+03  3.02926569e+03  3.02926569e+03
  6.64959909e+03  6.64959909e+03  6.64959909e+03  9.10656493e+03
  2.54596433e+04  7.61989613e+04]
E1 = -728.2301224249244  E_coul = 201.48441123540042
Extra cycle  E= -526.745711189524  delta_E= -1.82e-12  |g|= 3.5e-07  |ddm|= 2.98e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826595e+04 7.61751416e+03 3.61735479e+03 1.59766759e+03
 3.82622446e+02 1.11223908e+02 3.77872052e+01 1.25026203e+01
 5.35603493e+00 6.25764453e-01 2.49980499e+00 2.31172991e-01
 1.36278443e+03 6.64733588e+02 3.00904954e+02 3.13993097e+02
 6.16631596e+01 7.36719251e+00 2.02255660e+01 7.77051971e-01
 2.81174172e+00 2.18206612e-01]
E = -526.745711189524
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:04 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6594977        1
[INPUT] 0    0    [1    /1   ]  7617.51416279        1
[INPUT] 0    0    [1    /1   ]  3617.35479368        1
[INPUT] 0    0    [1    /1   ]  1597.66759396        1
[INPUT] 0    0    [1    /1   ]  382.622445649        1
[INPUT] 0    0    [1    /1   ]  111.223908398        1
[INPUT] 0    0    [1    /1   ]  37.7872051588        1
[INPUT] 0    0    [1    /1   ]  12.5026203277        1
[INPUT] 0    0    [1    /1   ]  5.35603492957        1
[INPUT] 0    0    [1    /1   ]  0.625764452813       1
[INPUT] 0    0    [1    /1   ]  2.4998049925         1
[INPUT] 0    0    [1    /1   ]  0.231172991368       1
[INPUT] 1    0    [1    /1   ]  1362.78442999        1
[INPUT] 1    0    [1    /1   ]  664.733587754        1
[INPUT] 1    0    [1    /1   ]  300.904954043        1
[INPUT] 1    0    [1    /1   ]  313.99309684         1
[INPUT] 1    0    [1    /1   ]  61.6631595805        1
[INPUT] 1    0    [1    /1   ]  7.3671925063         1
[INPUT] 1    0    [1    /1   ]  20.2255660491        1
[INPUT] 1    0    [1    /1   ]  0.777051970642       1
[INPUT] 1    0    [1    /1   ]  2.81174172383        1
[INPUT] 1    0    [1    /1   ]  0.218206612266       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659497713106, 1.0]], [0, [7617.51416278615, 1.0]], [0, [3617.3547936835585, 1.0]], [0, [1597.6675939608112, 1.0]], [0, [382.6224456492408, 1.0]], [0, [111.22390839798392, 1.0]], [0, [37.787205158758375, 1.0]], [0, [12.50262032770528, 1.0]], [0, [5.356034929565067, 1.0]], [0, [0.6257644528132127, 1.0]], [0, [2.4998049924974577, 1.0]], [0, [0.23117299136764974, 1.0]], [1, [1362.7844299878848, 1.0]], [1, [664.7335877535015, 1.0]], [1, [300.904954042873, 1.0]], [1, [313.99309684035484, 1.0]], [1, [61.6631595805187, 1.0]], [1, [7.367192506300286, 1.0]], [1, [20.22556604906008, 1.0]], [1, [0.7770519706421581, 1.0]], [1, [2.811741723828711, 1.0]], [1, [0.2182066122664593, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65949771]
bas 1, expnt(s) = [7617.51416279]
bas 2, expnt(s) = [3617.35479368]
bas 3, expnt(s) = [1597.66759396]
bas 4, expnt(s) = [382.62244565]
bas 5, expnt(s) = [111.2239084]
bas 6, expnt(s) = [37.78720516]
bas 7, expnt(s) = [12.50262033]
bas 8, expnt(s) = [5.35603493]
bas 9, expnt(s) = [0.62576445]
bas 10, expnt(s) = [2.49980499]
bas 11, expnt(s) = [0.23117299]
bas 12, expnt(s) = [1362.78442999]
bas 13, expnt(s) = [664.73358775]
bas 14, expnt(s) = [300.90495404]
bas 15, expnt(s) = [313.99309684]
bas 16, expnt(s) = [61.66315958]
bas 17, expnt(s) = [7.36719251]
bas 18, expnt(s) = [20.22556605]
bas 19, expnt(s) = [0.77705197]
bas 20, expnt(s) = [2.81174172]
bas 21, expnt(s) = [0.21820661]
CPU time:       208.77
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826595e+04 5.20026341e+03 7.61751416e+03 2.06003679e+03
 3.61735479e+03 1.17844239e+03 1.59766759e+03 6.38454341e+02
 3.82622446e+02 2.18571160e+02 1.11223908e+02 8.65293892e+01
 3.77872052e+01 3.85055741e+01 1.25026203e+01 1.67983183e+01
 5.35603493e+00 8.89503323e+00 6.25764453e-01 1.77755559e+00
 2.49980499e+00 5.02278539e+00 2.31172991e-01 8.42302023e-01
 1.36278443e+03 2.41556288e+04 6.64733588e+02 9.84677290e+03
 3.00904954e+02 3.65612525e+03 3.13993097e+02 3.85597774e+03
 6.16631596e+01 5.04099898e+02 7.36719251e+00 3.54088576e+01
 2.02255660e+01 1.25129655e+02 7.77051971e-01 2.12836925e+00
 2.81174172e+00 1.06219359e+01 2.18206612e-01 4.35080156e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993992596071287
cond(S) = 113296.76006047644
E1 = -729.5315540515212  E_coul = 203.17019909011836
init E= -526.361354961403
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556103056456304  LUMO = 0.893486079758051
  mo_energy =
[-1.18330946e+02 -1.22067264e+01 -9.44740340e+00 -9.44740340e+00
 -9.44740340e+00 -1.24063321e+00 -5.56103056e-01 -5.56103056e-01
 -5.56103056e-01  8.93486080e-01  1.01602097e+00  1.01602097e+00
  1.01602097e+00  7.34886465e+00  7.34886465e+00  7.34886465e+00
  7.53062236e+00  3.35934333e+01  3.35934333e+01  3.35934333e+01
  3.47772081e+01  1.29265495e+02  1.29265495e+02  1.29265495e+02
  1.48427472e+02  4.83683960e+02  4.83683960e+02  4.83683960e+02
  6.38326658e+02  1.33547799e+03  1.33547799e+03  1.33547799e+03
  2.70509200e+03  3.02963819e+03  3.02963819e+03  3.02963819e+03
  6.65008385e+03  6.65008385e+03  6.65008385e+03  9.10712413e+03
  2.54602966e+04  7.61997048e+04]
E1 = -727.7636028772183  E_coul = 201.01873224705017
cycle= 1 E= -526.744870630168  delta_E= -0.384  |g|= 0.188  |ddm|= 0.267
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.556696
diis-c [-0.30991097  1.        ]
  HOMO = -0.593480004770146  LUMO = 0.866983801709395
  mo_energy =
[-1.18645909e+02 -1.23496956e+01 -9.60148067e+00 -9.60148067e+00
 -9.60148067e+00 -1.28311996e+00 -5.93480005e-01 -5.93480005e-01
 -5.93480005e-01  8.66983802e-01  9.89990042e-01  9.89990042e-01
  9.89990042e-01  7.25335658e+00  7.25335658e+00  7.25335658e+00
  7.44566382e+00  3.34334252e+01  3.34334252e+01  3.34334252e+01
  3.46329648e+01  1.29030809e+02  1.29030809e+02  1.29030809e+02
  1.48195663e+02  4.83370053e+02  4.83370053e+02  4.83370053e+02
  6.37975316e+02  1.33510722e+03  1.33510722e+03  1.33510722e+03
  2.70458734e+03  3.02920107e+03  3.02920107e+03  3.02920107e+03
  6.64953309e+03  6.64953309e+03  6.64953309e+03  9.10649834e+03
  2.54595763e+04  7.61988941e+04]
E1 = -728.3651717521296  E_coul = 201.61952787845703
cycle= 2 E= -526.745643873673  delta_E= -0.000773  |g|= 0.0391  |ddm|= 0.0559
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0791751
diis-c [-0.00370073  0.08389385  0.91610615]
  HOMO = -0.583870627388165  LUMO = 0.874348699636869
  mo_energy =
[-1.18575561e+02 -1.23098308e+01 -9.55988117e+00 -9.55988117e+00
 -9.55988117e+00 -1.27166134e+00 -5.83870627e-01 -5.83870627e-01
 -5.83870627e-01  8.74348700e-01  9.97026151e-01  9.97026151e-01
  9.97026151e-01  7.27836419e+00  7.27836419e+00  7.27836419e+00
  7.46879578e+00  3.34753676e+01  3.34753676e+01  3.34753676e+01
  3.46723585e+01  1.29089034e+02  1.29089034e+02  1.29089034e+02
  1.48254263e+02  4.83439562e+02  4.83439562e+02  4.83439562e+02
  6.38046994e+02  1.33518088e+03  1.33518088e+03  1.33518088e+03
  2.70466433e+03  3.02927702e+03  3.02927702e+03  3.02927702e+03
  6.64961083e+03  6.64961083e+03  6.64961083e+03  9.10657690e+03
  2.54596555e+04  7.61989736e+04]
E1 = -728.2059553140236  E_coul = 201.46024628171193
cycle= 3 E= -526.745709032312  delta_E= -6.52e-05  |g|= 0.0066  |ddm|= 0.0165
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0139021
diis-c [-7.51499005e-07 -1.29640863e-03  1.44867178e-01  8.56429230e-01]
  HOMO = -0.585460819167997  LUMO = 0.873194273679492
  mo_energy =
[-1.18586004e+02 -1.23159550e+01 -9.56636446e+00 -9.56636446e+00
 -9.56636446e+00 -1.27347505e+00 -5.85460819e-01 -5.85460819e-01
 -5.85460819e-01  8.73194274e-01  9.95882222e-01  9.95882222e-01
  9.95882222e-01  7.27436233e+00  7.27436233e+00  7.27436233e+00
  7.46515313e+00  3.34688640e+01  3.34688640e+01  3.34688640e+01
  3.46662887e+01  1.29080266e+02  1.29080266e+02  1.29080266e+02
  1.48245474e+02  4.83429238e+02  4.83429238e+02  4.83429238e+02
  6.38036335e+02  1.33516994e+03  1.33516994e+03  1.33516994e+03
  2.70465275e+03  3.02926569e+03  3.02926569e+03  3.02926569e+03
  6.64959909e+03  6.64959909e+03  6.64959909e+03  9.10656495e+03
  2.54596433e+04  7.61989613e+04]
E1 = -728.2302908958401  E_coul = 201.48457970743718
cycle= 4 E= -526.745711188403  delta_E= -2.16e-06  |g|= 8.38e-05  |ddm|= 0.00239
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00010029
diis-c [-4.45826069e-09  7.14614613e-05 -1.01994022e-02 -6.33147052e-02
  1.07344265e+00]
  HOMO = -0.585440150917769  LUMO = 0.87322244986994
  mo_energy =
[-1.18585950e+02 -1.23158824e+01 -9.56630377e+00 -9.56630377e+00
 -9.56630377e+00 -1.27343565e+00 -5.85440151e-01 -5.85440151e-01
 -5.85440151e-01  8.73222450e-01  9.95898958e-01  9.95898958e-01
  9.95898958e-01  7.27440940e+00  7.27440940e+00  7.27440940e+00
  7.46520902e+00  3.34689222e+01  3.34689222e+01  3.34689222e+01
  3.46663536e+01  1.29080325e+02  1.29080325e+02  1.29080325e+02
  1.48245535e+02  4.83429292e+02  4.83429292e+02  4.83429292e+02
  6.38036382e+02  1.33516999e+03  1.33516999e+03  1.33516999e+03
  2.70465278e+03  3.02926573e+03  3.02926573e+03  3.02926573e+03
  6.64959912e+03  6.64959912e+03  6.64959912e+03  9.10656497e+03
  2.54596433e+04  7.61989613e+04]
E1 = -728.2300431945165  E_coul = 201.48433200503982
cycle= 5 E= -526.745711189477  delta_E= -1.07e-09  |g|= 1.89e-05  |ddm|= 0.000124
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.60518e-05
diis-c [-6.63291950e-11  1.18711897e-05 -1.56600626e-03 -1.17283776e-02
  5.45928192e-02  9.58689693e-01]
  HOMO = -0.585447373034148  LUMO = 0.873218747487922
  mo_energy =
[-1.18585980e+02 -1.23159044e+01 -9.56632736e+00 -9.56632736e+00
 -9.56632736e+00 -1.27344198e+00 -5.85447373e-01 -5.85447373e-01
 -5.85447373e-01  8.73218747e-01  9.95894107e-01  9.95894107e-01
  9.95894107e-01  7.27439325e+00  7.27439325e+00  7.27439325e+00
  7.46519489e+00  3.34688992e+01  3.34688992e+01  3.34688992e+01
  3.46663320e+01  1.29080298e+02  1.29080298e+02  1.29080298e+02
  1.48245509e+02  4.83429263e+02  4.83429263e+02  4.83429263e+02
  6.38036352e+02  1.33516996e+03  1.33516996e+03  1.33516996e+03
  2.70465275e+03  3.02926569e+03  3.02926569e+03  3.02926569e+03
  6.64959909e+03  6.64959909e+03  6.64959909e+03  9.10656493e+03
  2.54596433e+04  7.61989613e+04]
E1 = -728.2301234742489  E_coul = 201.48441228472672
cycle= 6 E= -526.745711189522  delta_E= -4.55e-11  |g|= 1.69e-06  |ddm|= 1.49e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2301234742489  E_coul = 201.48441228472672
  HOMO = -0.585447393245019  LUMO = 0.873219045691515
  mo_energy =
[-1.18585980e+02 -1.23159042e+01 -9.56632731e+00 -9.56632731e+00
 -9.56632731e+00 -1.27344162e+00 -5.85447393e-01 -5.85447393e-01
 -5.85447393e-01  8.73219046e-01  9.95894147e-01  9.95894147e-01
  9.95894147e-01  7.27439330e+00  7.27439330e+00  7.27439330e+00
  7.46519509e+00  3.34688993e+01  3.34688993e+01  3.34688993e+01
  3.46663321e+01  1.29080298e+02  1.29080298e+02  1.29080298e+02
  1.48245509e+02  4.83429263e+02  4.83429263e+02  4.83429263e+02
  6.38036353e+02  1.33516996e+03  1.33516996e+03  1.33516996e+03
  2.70465275e+03  3.02926569e+03  3.02926569e+03  3.02926569e+03
  6.64959909e+03  6.64959909e+03  6.64959909e+03  9.10656493e+03
  2.54596433e+04  7.61989613e+04]
E1 = -728.2301224249244  E_coul = 201.48441123540042
Extra cycle  E= -526.745711189524  delta_E= -1.82e-12  |g|= 3.5e-07  |ddm|= 2.98e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113296.76006047644
E1 = -728.2301224249244  E_coul = 201.48441123540042
init E= -526.745711189524
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.585447427422711  LUMO = 0.873219085047186
  mo_energy =
[-1.18585980e+02 -1.23159043e+01 -9.56632741e+00 -9.56632741e+00
 -9.56632741e+00 -1.27344158e+00 -5.85447427e-01 -5.85447427e-01
 -5.85447427e-01  8.73219085e-01  9.95894134e-01  9.95894134e-01
  9.95894134e-01  7.27439324e+00  7.27439324e+00  7.27439324e+00
  7.46519507e+00  3.34688992e+01  3.34688992e+01  3.34688992e+01
  3.46663320e+01  1.29080298e+02  1.29080298e+02  1.29080298e+02
  1.48245509e+02  4.83429263e+02  4.83429263e+02  4.83429263e+02
  6.38036352e+02  1.33516996e+03  1.33516996e+03  1.33516996e+03
  2.70465275e+03  3.02926569e+03  3.02926569e+03  3.02926569e+03
  6.64959909e+03  6.64959909e+03  6.64959909e+03  9.10656493e+03
  2.54596433e+04  7.61989613e+04]
E1 = -728.2301225854819  E_coul = 201.48441139595784
cycle= 1 E= -526.745711189524  delta_E= -1.14e-13  |g|= 7.43e-08  |ddm|= 5.93e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2301225854819  E_coul = 201.48441139595784
  HOMO = -0.585447427145295  LUMO = 0.873219098604618
  mo_energy =
[-1.18585980e+02 -1.23159043e+01 -9.56632740e+00 -9.56632740e+00
 -9.56632740e+00 -1.27344156e+00 -5.85447427e-01 -5.85447427e-01
 -5.85447427e-01  8.73219099e-01  9.95894137e-01  9.95894137e-01
  9.95894137e-01  7.27439324e+00  7.27439324e+00  7.27439324e+00
  7.46519508e+00  3.34688992e+01  3.34688992e+01  3.34688992e+01
  3.46663320e+01  1.29080298e+02  1.29080298e+02  1.29080298e+02
  1.48245509e+02  4.83429263e+02  4.83429263e+02  4.83429263e+02
  6.38036352e+02  1.33516996e+03  1.33516996e+03  1.33516996e+03
  2.70465275e+03  3.02926569e+03  3.02926569e+03  3.02926569e+03
  6.64959909e+03  6.64959909e+03  6.64959909e+03  9.10656493e+03
  2.54596433e+04  7.61989613e+04]
E1 = -728.2301225111889  E_coul = 201.48441132166553
Extra cycle  E= -526.745711189523  delta_E= 6.82e-13  |g|= 1.52e-08  |ddm|= 1.26e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826595e+04 7.61751416e+03 3.61735479e+03 1.59766759e+03
 3.82622446e+02 1.11223908e+02 3.77872052e+01 1.25026203e+01
 5.35603493e+00 6.25764453e-01 2.49980499e+00 2.31172991e-01
 1.36278443e+03 6.64733588e+02 3.00904954e+02 3.13993097e+02
 6.16631596e+01 7.36719251e+00 2.02255660e+01 7.77051971e-01
 2.81174172e+00 2.18206612e-01]
grad_E = [-1.53570296e-06  3.51022611e-06 -1.46196613e-06  7.66323646e-05
 -1.68376394e-04 -6.29990614e-04 -9.34964430e-04  5.68050480e-04
 -2.90807323e-03 -9.20629950e-03  4.23064577e-03  2.39436153e-02
 -5.25326133e-07  4.75603679e-06  2.21062754e-05  1.90616649e-05
  1.49027477e-04  4.07301253e-03 -1.38238423e-03  3.45752371e-02
 -5.06083198e-03 -1.25479914e-01]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:09 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6594258        1
[INPUT] 0    0    [1    /1   ]  7617.51431578        1
[INPUT] 0    0    [1    /1   ]  3617.35471606        1
[INPUT] 0    0    [1    /1   ]  1597.67071193        1
[INPUT] 0    0    [1    /1   ]  382.627012017        1
[INPUT] 0    0    [1    /1   ]  111.164266938        1
[INPUT] 0    0    [1    /1   ]  37.7205022622        1
[INPUT] 0    0    [1    /1   ]  12.3677013381        1
[INPUT] 0    0    [1    /1   ]  5.37903127897        1
[INPUT] 0    0    [1    /1   ]  0.63414540815        1
[INPUT] 0    0    [1    /1   ]  2.46003361486        1
[INPUT] 0    0    [1    /1   ]  0.227743467706       1
[INPUT] 1    0    [1    /1   ]  1362.78440584        1
[INPUT] 1    0    [1    /1   ]  664.73382703         1
[INPUT] 1    0    [1    /1   ]  300.906083108        1
[INPUT] 1    0    [1    /1   ]  313.994070303        1
[INPUT] 1    0    [1    /1   ]  61.6620823463        1
[INPUT] 1    0    [1    /1   ]  7.36045566811        1
[INPUT] 1    0    [1    /1   ]  20.2279759473        1
[INPUT] 1    0    [1    /1   ]  0.776846176169       1
[INPUT] 1    0    [1    /1   ]  2.81717293775        1
[INPUT] 1    0    [1    /1   ]  0.219984623925       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659425778937, 1.0]], [0, [7617.514315782411, 1.0]], [0, [3617.354716064803, 1.0]], [0, [1597.6707119333043, 1.0]], [0, [382.6270120174632, 1.0]], [0, [111.16426693838967, 1.0]], [0, [37.720502262164324, 1.0]], [0, [12.36770133808268, 1.0]], [0, [5.379031278974621, 1.0]], [0, [0.6341454081501365, 1.0]], [0, [2.4600336148587165, 1.0]], [0, [0.22774346770572115, 1.0]], [1, [1362.784405844802, 1.0]], [1, [664.7338270296669, 1.0]], [1, [300.90608310798746, 1.0]], [1, [313.9940703030056, 1.0]], [1, [61.662082346321384, 1.0]], [1, [7.360455668114234, 1.0]], [1, [20.227975947316782, 1.0]], [1, [0.7768461761685999, 1.0]], [1, [2.81717293774877, 1.0]], [1, [0.21998462392495102, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65942578]
bas 1, expnt(s) = [7617.51431578]
bas 2, expnt(s) = [3617.35471606]
bas 3, expnt(s) = [1597.67071193]
bas 4, expnt(s) = [382.62701202]
bas 5, expnt(s) = [111.16426694]
bas 6, expnt(s) = [37.72050226]
bas 7, expnt(s) = [12.36770134]
bas 8, expnt(s) = [5.37903128]
bas 9, expnt(s) = [0.63414541]
bas 10, expnt(s) = [2.46003361]
bas 11, expnt(s) = [0.22774347]
bas 12, expnt(s) = [1362.78440584]
bas 13, expnt(s) = [664.73382703]
bas 14, expnt(s) = [300.90608311]
bas 15, expnt(s) = [313.9940703]
bas 16, expnt(s) = [61.66208235]
bas 17, expnt(s) = [7.36045567]
bas 18, expnt(s) = [20.22797595]
bas 19, expnt(s) = [0.77684618]
bas 20, expnt(s) = [2.81717294]
bas 21, expnt(s) = [0.21998462]
CPU time:       214.46
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826594e+04 5.20026340e+03 7.61751432e+03 2.06003682e+03
 3.61735472e+03 1.17844237e+03 1.59767071e+03 6.38455275e+02
 3.82627012e+02 2.18573116e+02 1.11164267e+02 8.64945872e+01
 3.77205023e+01 3.84545846e+01 1.23677013e+01 1.66621779e+01
 5.37903128e+00 8.92366127e+00 6.34145408e-01 1.79538116e+00
 2.46003361e+00 4.96273180e+00 2.27743468e-01 8.32912675e-01
 1.36278441e+03 2.41556282e+04 6.64733827e+02 9.84677733e+03
 3.00906083e+02 3.65614240e+03 3.13994070e+02 3.85599268e+03
 6.16620823e+01 5.04088890e+02 7.36045567e+00 3.53683882e+01
 2.02279759e+01 1.25148292e+02 7.76846176e-01 2.12766467e+00
 2.81717294e+00 1.06475890e+01 2.19984624e-01 4.39516112e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993971331269876
cond(S) = 113257.37629965083
E1 = -729.5352435393635  E_coul = 203.17271847292506
init E= -526.362525066438
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555967760579535  LUMO = 0.889144544965078
  mo_energy =
[-1.18330790e+02 -1.22067614e+01 -9.44728501e+00 -9.44728501e+00
 -9.44728501e+00 -1.24048304e+00 -5.55967761e-01 -5.55967761e-01
 -5.55967761e-01  8.89144545e-01  1.02301575e+00  1.02301575e+00
  1.02301575e+00  7.36236356e+00  7.36236356e+00  7.36236356e+00
  7.48436226e+00  3.36029740e+01  3.36029740e+01  3.36029740e+01
  3.45210527e+01  1.29269270e+02  1.29269270e+02  1.29269270e+02
  1.47732895e+02  4.83686015e+02  4.83686015e+02  4.83686015e+02
  6.37362818e+02  1.33548143e+03  1.33548143e+03  1.33548143e+03
  2.70413205e+03  3.02964429e+03  3.02964429e+03  3.02964429e+03
  6.65009179e+03  6.65009179e+03  6.65009179e+03  9.10622912e+03
  2.54594494e+04  7.61989160e+04]
E1 = -727.7885163961906  E_coul = 201.04312987132903
cycle= 1 E= -526.745386524862  delta_E= -0.383  |g|= 0.188  |ddm|= 0.282
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.556236
diis-c [-0.30939884  1.        ]
  HOMO = -0.592643797005703  LUMO = 0.86346427004378
  mo_energy =
[-1.18644136e+02 -1.23481606e+01 -9.59982028e+00 -9.59982028e+00
 -9.59982028e+00 -1.28196497e+00 -5.92643797e-01 -5.92643797e-01
 -5.92643797e-01  8.63464270e-01  9.97435074e-01  9.97435074e-01
  9.97435074e-01  7.26817868e+00  7.26817868e+00  7.26817868e+00
  7.40092363e+00  3.34445199e+01  3.34445199e+01  3.34445199e+01
  3.43786867e+01  1.29036151e+02  1.29036151e+02  1.29036151e+02
  1.47502869e+02  4.83373745e+02  4.83373745e+02  4.83373745e+02
  6.37013073e+02  1.33511225e+03  1.33511225e+03  1.33511225e+03
  2.70362898e+03  3.02920877e+03  3.02920877e+03  3.02920877e+03
  6.64954263e+03  6.64954263e+03  6.64954263e+03  9.10560492e+03
  2.54587307e+04  7.61981069e+04]
E1 = -728.3818322670713  E_coul = 201.63568661787184
cycle= 2 E= -526.746145649199  delta_E= -0.000759  |g|= 0.0387  |ddm|= 0.0544
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0785062
diis-c [-0.00364645  0.08318047  0.91681953]
  HOMO = -0.583204181359213  LUMO = 0.870707040085877
  mo_energy =
[-1.18574489e+02 -1.23088257e+01 -9.55877101e+00 -9.55877101e+00
 -9.55877101e+00 -1.27068170e+00 -5.83204181e-01 -5.83204181e-01
 -5.83204181e-01  8.70707040e-01  1.00437702e+00  1.00437702e+00
  1.00437702e+00  7.29281449e+00  7.29281449e+00  7.29281449e+00
  7.42361786e+00  3.34859207e+01  3.34859207e+01  3.34859207e+01
  3.44174695e+01  1.29093738e+02  1.29093738e+02  1.29093738e+02
  1.47560803e+02  4.83442560e+02  4.83442560e+02  4.83442560e+02
  6.37084047e+02  1.33518519e+03  1.33518519e+03  1.33518519e+03
  2.70370523e+03  3.02928400e+03  3.02928400e+03  3.02928400e+03
  6.64961963e+03  6.64961963e+03  6.64961963e+03  9.10568274e+03
  2.54588091e+04  7.61981856e+04]
E1 = -728.2250749666832  E_coul = 201.47886592444698
cycle= 3 E= -526.746209042236  delta_E= -6.34e-05  |g|= 0.00653  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0137904
diis-c [-7.98902259e-07 -1.29921146e-03  1.44859120e-01  8.56440091e-01]
  HOMO = -0.584773973512268  LUMO = 0.869580905897415
  mo_energy =
[-1.18584829e+02 -1.23148770e+01 -9.56518192e+00 -9.56518192e+00
 -9.56518192e+00 -1.27245885e+00 -5.84773974e-01 -5.84773974e-01
 -5.84773974e-01  8.69580906e-01  1.00324601e+00  1.00324601e+00
  1.00324601e+00  7.28886175e+00  7.28886175e+00  7.28886175e+00
  7.42003826e+00  3.34794907e+01  3.34794907e+01  3.34794907e+01
  3.44114840e+01  1.29085061e+02  1.29085061e+02  1.29085061e+02
  1.47552111e+02  4.83432339e+02  4.83432339e+02  4.83432339e+02
  6.37073491e+02  1.33517436e+03  1.33517436e+03  1.33517436e+03
  2.70369376e+03  3.02927277e+03  3.02927277e+03  3.02927277e+03
  6.64960800e+03  6.64960800e+03  6.64960800e+03  9.10567089e+03
  2.54587971e+04  7.61981734e+04]
E1 = -728.2490224407672  E_coul = 201.5028112974886
cycle= 4 E= -526.746211143279  delta_E= -2.1e-06  |g|= 9.6e-05  |ddm|= 0.00233
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000111089
diis-c [-5.08517718e-09  8.06270567e-05 -1.13623346e-02 -7.06917685e-02
  1.08197348e+00]
  HOMO = -0.584754066598336  LUMO = 0.869611438766004
  mo_energy =
[-1.18584776e+02 -1.23148045e+01 -9.56512245e+00 -9.56512245e+00
 -9.56512245e+00 -1.27241673e+00 -5.84754067e-01 -5.84754067e-01
 -5.84754067e-01  8.69611439e-01  1.00326275e+00  1.00326275e+00
  1.00326275e+00  7.28890813e+00  7.28890813e+00  7.28890813e+00
  7.42009480e+00  3.34795478e+01  3.34795478e+01  3.34795478e+01
  3.44115485e+01  1.29085119e+02  1.29085119e+02  1.29085119e+02
  1.47552171e+02  4.83432391e+02  4.83432391e+02  4.83432391e+02
  6.37073537e+02  1.33517440e+03  1.33517440e+03  1.33517440e+03
  2.70369378e+03  3.02927280e+03  3.02927280e+03  3.02927280e+03
  6.64960802e+03  6.64960802e+03  6.64960802e+03  9.10567090e+03
  2.54587971e+04  7.61981734e+04]
E1 = -728.2487713763448  E_coul = 201.50256023148214
cycle= 5 E= -526.746211144863  delta_E= -1.58e-09  |g|= 2.02e-05  |ddm|= 0.000151
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.81374e-05
diis-c [-8.76330911e-11  1.26517919e-05 -1.64186193e-03 -1.23277928e-02
  4.31940812e-02  9.70762922e-01]
  HOMO = -0.58476179214773  LUMO = 0.869607738144957
  mo_energy =
[-1.18584807e+02 -1.23148278e+01 -9.56514755e+00 -9.56514755e+00
 -9.56514755e+00 -1.27242319e+00 -5.84761792e-01 -5.84761792e-01
 -5.84761792e-01  8.69607738e-01  1.00325759e+00  1.00325759e+00
  1.00325759e+00  7.28889096e+00  7.28889096e+00  7.28889096e+00
  7.42007994e+00  3.34795235e+01  3.34795235e+01  3.34795235e+01
  3.44115256e+01  1.29085091e+02  1.29085091e+02  1.29085091e+02
  1.47552143e+02  4.83432361e+02  4.83432361e+02  4.83432361e+02
  6.37073505e+02  1.33517437e+03  1.33517437e+03  1.33517437e+03
  2.70369375e+03  3.02927277e+03  3.02927277e+03  3.02927277e+03
  6.64960799e+03  6.64960799e+03  6.64960799e+03  9.10567087e+03
  2.54587970e+04  7.61981734e+04]
E1 = -728.2488555446693  E_coul = 201.5026443997507
cycle= 6 E= -526.746211144919  delta_E= -5.58e-11  |g|= 1.82e-06  |ddm|= 1.78e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2488555446693  E_coul = 201.5026443997507
  HOMO = -0.584761728936199  LUMO = 0.869608117766049
  mo_energy =
[-1.18584807e+02 -1.23148274e+01 -9.56514718e+00 -9.56514718e+00
 -9.56514718e+00 -1.27242271e+00 -5.84761729e-01 -5.84761729e-01
 -5.84761729e-01  8.69608118e-01  1.00325769e+00  1.00325769e+00
  1.00325769e+00  7.28889121e+00  7.28889121e+00  7.28889121e+00
  7.42008034e+00  3.34795239e+01  3.34795239e+01  3.34795239e+01
  3.44115260e+01  1.29085091e+02  1.29085091e+02  1.29085091e+02
  1.47552143e+02  4.83432361e+02  4.83432361e+02  4.83432361e+02
  6.37073506e+02  1.33517437e+03  1.33517437e+03  1.33517437e+03
  2.70369375e+03  3.02927277e+03  3.02927277e+03  3.02927277e+03
  6.64960799e+03  6.64960799e+03  6.64960799e+03  9.10567087e+03
  2.54587970e+04  7.61981734e+04]
E1 = -728.2488532927149  E_coul = 201.50264214779554
Extra cycle  E= -526.746211144919  delta_E= -7.96e-13  |g|= 3.8e-07  |ddm|= 3.2e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.26 sec
exp = [2.61826594e+04 7.61751432e+03 3.61735472e+03 1.59767071e+03
 3.82627012e+02 1.11164267e+02 3.77205023e+01 1.23677013e+01
 5.37903128e+00 6.34145408e-01 2.46003361e+00 2.27743468e-01
 1.36278441e+03 6.64733827e+02 3.00906083e+02 3.13994070e+02
 6.16620823e+01 7.36045567e+00 2.02279759e+01 7.76846176e-01
 2.81717294e+00 2.19984624e-01]
E = -526.7462111449194
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:09 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6594258        1
[INPUT] 0    0    [1    /1   ]  7617.51431578        1
[INPUT] 0    0    [1    /1   ]  3617.35471606        1
[INPUT] 0    0    [1    /1   ]  1597.67071193        1
[INPUT] 0    0    [1    /1   ]  382.627012017        1
[INPUT] 0    0    [1    /1   ]  111.164266938        1
[INPUT] 0    0    [1    /1   ]  37.7205022622        1
[INPUT] 0    0    [1    /1   ]  12.3677013381        1
[INPUT] 0    0    [1    /1   ]  5.37903127897        1
[INPUT] 0    0    [1    /1   ]  0.63414540815        1
[INPUT] 0    0    [1    /1   ]  2.46003361486        1
[INPUT] 0    0    [1    /1   ]  0.227743467706       1
[INPUT] 1    0    [1    /1   ]  1362.78440584        1
[INPUT] 1    0    [1    /1   ]  664.73382703         1
[INPUT] 1    0    [1    /1   ]  300.906083108        1
[INPUT] 1    0    [1    /1   ]  313.994070303        1
[INPUT] 1    0    [1    /1   ]  61.6620823463        1
[INPUT] 1    0    [1    /1   ]  7.36045566811        1
[INPUT] 1    0    [1    /1   ]  20.2279759473        1
[INPUT] 1    0    [1    /1   ]  0.776846176169       1
[INPUT] 1    0    [1    /1   ]  2.81717293775        1
[INPUT] 1    0    [1    /1   ]  0.219984623925       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659425778937, 1.0]], [0, [7617.514315782411, 1.0]], [0, [3617.354716064803, 1.0]], [0, [1597.6707119333043, 1.0]], [0, [382.6270120174632, 1.0]], [0, [111.16426693838967, 1.0]], [0, [37.720502262164324, 1.0]], [0, [12.36770133808268, 1.0]], [0, [5.379031278974621, 1.0]], [0, [0.6341454081501365, 1.0]], [0, [2.4600336148587165, 1.0]], [0, [0.22774346770572115, 1.0]], [1, [1362.784405844802, 1.0]], [1, [664.7338270296669, 1.0]], [1, [300.90608310798746, 1.0]], [1, [313.9940703030056, 1.0]], [1, [61.662082346321384, 1.0]], [1, [7.360455668114234, 1.0]], [1, [20.227975947316782, 1.0]], [1, [0.7768461761685999, 1.0]], [1, [2.81717293774877, 1.0]], [1, [0.21998462392495102, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65942578]
bas 1, expnt(s) = [7617.51431578]
bas 2, expnt(s) = [3617.35471606]
bas 3, expnt(s) = [1597.67071193]
bas 4, expnt(s) = [382.62701202]
bas 5, expnt(s) = [111.16426694]
bas 6, expnt(s) = [37.72050226]
bas 7, expnt(s) = [12.36770134]
bas 8, expnt(s) = [5.37903128]
bas 9, expnt(s) = [0.63414541]
bas 10, expnt(s) = [2.46003361]
bas 11, expnt(s) = [0.22774347]
bas 12, expnt(s) = [1362.78440584]
bas 13, expnt(s) = [664.73382703]
bas 14, expnt(s) = [300.90608311]
bas 15, expnt(s) = [313.9940703]
bas 16, expnt(s) = [61.66208235]
bas 17, expnt(s) = [7.36045567]
bas 18, expnt(s) = [20.22797595]
bas 19, expnt(s) = [0.77684618]
bas 20, expnt(s) = [2.81717294]
bas 21, expnt(s) = [0.21998462]
CPU time:       214.86
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826594e+04 5.20026340e+03 7.61751432e+03 2.06003682e+03
 3.61735472e+03 1.17844237e+03 1.59767071e+03 6.38455275e+02
 3.82627012e+02 2.18573116e+02 1.11164267e+02 8.64945872e+01
 3.77205023e+01 3.84545846e+01 1.23677013e+01 1.66621779e+01
 5.37903128e+00 8.92366127e+00 6.34145408e-01 1.79538116e+00
 2.46003361e+00 4.96273180e+00 2.27743468e-01 8.32912675e-01
 1.36278441e+03 2.41556282e+04 6.64733827e+02 9.84677733e+03
 3.00906083e+02 3.65614240e+03 3.13994070e+02 3.85599268e+03
 6.16620823e+01 5.04088890e+02 7.36045567e+00 3.53683882e+01
 2.02279759e+01 1.25148292e+02 7.76846176e-01 2.12766467e+00
 2.81717294e+00 1.06475890e+01 2.19984624e-01 4.39516112e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993971331269876
cond(S) = 113257.37629965083
E1 = -729.5352435393635  E_coul = 203.17271847292506
init E= -526.362525066438
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555967760579535  LUMO = 0.889144544965078
  mo_energy =
[-1.18330790e+02 -1.22067614e+01 -9.44728501e+00 -9.44728501e+00
 -9.44728501e+00 -1.24048304e+00 -5.55967761e-01 -5.55967761e-01
 -5.55967761e-01  8.89144545e-01  1.02301575e+00  1.02301575e+00
  1.02301575e+00  7.36236356e+00  7.36236356e+00  7.36236356e+00
  7.48436226e+00  3.36029740e+01  3.36029740e+01  3.36029740e+01
  3.45210527e+01  1.29269270e+02  1.29269270e+02  1.29269270e+02
  1.47732895e+02  4.83686015e+02  4.83686015e+02  4.83686015e+02
  6.37362818e+02  1.33548143e+03  1.33548143e+03  1.33548143e+03
  2.70413205e+03  3.02964429e+03  3.02964429e+03  3.02964429e+03
  6.65009179e+03  6.65009179e+03  6.65009179e+03  9.10622912e+03
  2.54594494e+04  7.61989160e+04]
E1 = -727.7885163961906  E_coul = 201.04312987132903
cycle= 1 E= -526.745386524862  delta_E= -0.383  |g|= 0.188  |ddm|= 0.282
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.556236
diis-c [-0.30939884  1.        ]
  HOMO = -0.592643797005703  LUMO = 0.86346427004378
  mo_energy =
[-1.18644136e+02 -1.23481606e+01 -9.59982028e+00 -9.59982028e+00
 -9.59982028e+00 -1.28196497e+00 -5.92643797e-01 -5.92643797e-01
 -5.92643797e-01  8.63464270e-01  9.97435074e-01  9.97435074e-01
  9.97435074e-01  7.26817868e+00  7.26817868e+00  7.26817868e+00
  7.40092363e+00  3.34445199e+01  3.34445199e+01  3.34445199e+01
  3.43786867e+01  1.29036151e+02  1.29036151e+02  1.29036151e+02
  1.47502869e+02  4.83373745e+02  4.83373745e+02  4.83373745e+02
  6.37013073e+02  1.33511225e+03  1.33511225e+03  1.33511225e+03
  2.70362898e+03  3.02920877e+03  3.02920877e+03  3.02920877e+03
  6.64954263e+03  6.64954263e+03  6.64954263e+03  9.10560492e+03
  2.54587307e+04  7.61981069e+04]
E1 = -728.3818322670713  E_coul = 201.63568661787184
cycle= 2 E= -526.746145649199  delta_E= -0.000759  |g|= 0.0387  |ddm|= 0.0544
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0785062
diis-c [-0.00364645  0.08318047  0.91681953]
  HOMO = -0.583204181359213  LUMO = 0.870707040085877
  mo_energy =
[-1.18574489e+02 -1.23088257e+01 -9.55877101e+00 -9.55877101e+00
 -9.55877101e+00 -1.27068170e+00 -5.83204181e-01 -5.83204181e-01
 -5.83204181e-01  8.70707040e-01  1.00437702e+00  1.00437702e+00
  1.00437702e+00  7.29281449e+00  7.29281449e+00  7.29281449e+00
  7.42361786e+00  3.34859207e+01  3.34859207e+01  3.34859207e+01
  3.44174695e+01  1.29093738e+02  1.29093738e+02  1.29093738e+02
  1.47560803e+02  4.83442560e+02  4.83442560e+02  4.83442560e+02
  6.37084047e+02  1.33518519e+03  1.33518519e+03  1.33518519e+03
  2.70370523e+03  3.02928400e+03  3.02928400e+03  3.02928400e+03
  6.64961963e+03  6.64961963e+03  6.64961963e+03  9.10568274e+03
  2.54588091e+04  7.61981856e+04]
E1 = -728.2250749666832  E_coul = 201.47886592444698
cycle= 3 E= -526.746209042236  delta_E= -6.34e-05  |g|= 0.00653  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0137904
diis-c [-7.98902259e-07 -1.29921146e-03  1.44859120e-01  8.56440091e-01]
  HOMO = -0.584773973512268  LUMO = 0.869580905897415
  mo_energy =
[-1.18584829e+02 -1.23148770e+01 -9.56518192e+00 -9.56518192e+00
 -9.56518192e+00 -1.27245885e+00 -5.84773974e-01 -5.84773974e-01
 -5.84773974e-01  8.69580906e-01  1.00324601e+00  1.00324601e+00
  1.00324601e+00  7.28886175e+00  7.28886175e+00  7.28886175e+00
  7.42003826e+00  3.34794907e+01  3.34794907e+01  3.34794907e+01
  3.44114840e+01  1.29085061e+02  1.29085061e+02  1.29085061e+02
  1.47552111e+02  4.83432339e+02  4.83432339e+02  4.83432339e+02
  6.37073491e+02  1.33517436e+03  1.33517436e+03  1.33517436e+03
  2.70369376e+03  3.02927277e+03  3.02927277e+03  3.02927277e+03
  6.64960800e+03  6.64960800e+03  6.64960800e+03  9.10567089e+03
  2.54587971e+04  7.61981734e+04]
E1 = -728.2490224407672  E_coul = 201.5028112974886
cycle= 4 E= -526.746211143279  delta_E= -2.1e-06  |g|= 9.6e-05  |ddm|= 0.00233
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000111089
diis-c [-5.08517718e-09  8.06270567e-05 -1.13623346e-02 -7.06917685e-02
  1.08197348e+00]
  HOMO = -0.584754066598336  LUMO = 0.869611438766004
  mo_energy =
[-1.18584776e+02 -1.23148045e+01 -9.56512245e+00 -9.56512245e+00
 -9.56512245e+00 -1.27241673e+00 -5.84754067e-01 -5.84754067e-01
 -5.84754067e-01  8.69611439e-01  1.00326275e+00  1.00326275e+00
  1.00326275e+00  7.28890813e+00  7.28890813e+00  7.28890813e+00
  7.42009480e+00  3.34795478e+01  3.34795478e+01  3.34795478e+01
  3.44115485e+01  1.29085119e+02  1.29085119e+02  1.29085119e+02
  1.47552171e+02  4.83432391e+02  4.83432391e+02  4.83432391e+02
  6.37073537e+02  1.33517440e+03  1.33517440e+03  1.33517440e+03
  2.70369378e+03  3.02927280e+03  3.02927280e+03  3.02927280e+03
  6.64960802e+03  6.64960802e+03  6.64960802e+03  9.10567090e+03
  2.54587971e+04  7.61981734e+04]
E1 = -728.2487713763448  E_coul = 201.50256023148214
cycle= 5 E= -526.746211144863  delta_E= -1.58e-09  |g|= 2.02e-05  |ddm|= 0.000151
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.81374e-05
diis-c [-8.76330911e-11  1.26517919e-05 -1.64186193e-03 -1.23277928e-02
  4.31940812e-02  9.70762922e-01]
  HOMO = -0.58476179214773  LUMO = 0.869607738144957
  mo_energy =
[-1.18584807e+02 -1.23148278e+01 -9.56514755e+00 -9.56514755e+00
 -9.56514755e+00 -1.27242319e+00 -5.84761792e-01 -5.84761792e-01
 -5.84761792e-01  8.69607738e-01  1.00325759e+00  1.00325759e+00
  1.00325759e+00  7.28889096e+00  7.28889096e+00  7.28889096e+00
  7.42007994e+00  3.34795235e+01  3.34795235e+01  3.34795235e+01
  3.44115256e+01  1.29085091e+02  1.29085091e+02  1.29085091e+02
  1.47552143e+02  4.83432361e+02  4.83432361e+02  4.83432361e+02
  6.37073505e+02  1.33517437e+03  1.33517437e+03  1.33517437e+03
  2.70369375e+03  3.02927277e+03  3.02927277e+03  3.02927277e+03
  6.64960799e+03  6.64960799e+03  6.64960799e+03  9.10567087e+03
  2.54587970e+04  7.61981734e+04]
E1 = -728.2488555446693  E_coul = 201.5026443997507
cycle= 6 E= -526.746211144919  delta_E= -5.58e-11  |g|= 1.82e-06  |ddm|= 1.78e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2488555446693  E_coul = 201.5026443997507
  HOMO = -0.584761728936199  LUMO = 0.869608117766049
  mo_energy =
[-1.18584807e+02 -1.23148274e+01 -9.56514718e+00 -9.56514718e+00
 -9.56514718e+00 -1.27242271e+00 -5.84761729e-01 -5.84761729e-01
 -5.84761729e-01  8.69608118e-01  1.00325769e+00  1.00325769e+00
  1.00325769e+00  7.28889121e+00  7.28889121e+00  7.28889121e+00
  7.42008034e+00  3.34795239e+01  3.34795239e+01  3.34795239e+01
  3.44115260e+01  1.29085091e+02  1.29085091e+02  1.29085091e+02
  1.47552143e+02  4.83432361e+02  4.83432361e+02  4.83432361e+02
  6.37073506e+02  1.33517437e+03  1.33517437e+03  1.33517437e+03
  2.70369375e+03  3.02927277e+03  3.02927277e+03  3.02927277e+03
  6.64960799e+03  6.64960799e+03  6.64960799e+03  9.10567087e+03
  2.54587970e+04  7.61981734e+04]
E1 = -728.2488532927149  E_coul = 201.50264214779554
Extra cycle  E= -526.746211144919  delta_E= -7.96e-13  |g|= 3.8e-07  |ddm|= 3.2e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113257.37629965083
E1 = -728.2488532927149  E_coul = 201.50264214779554
init E= -526.746211144919
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.584761787867822  LUMO = 0.869608142671727
  mo_energy =
[-1.18584807e+02 -1.23148275e+01 -9.56514737e+00 -9.56514737e+00
 -9.56514737e+00 -1.27242270e+00 -5.84761788e-01 -5.84761788e-01
 -5.84761788e-01  8.69608143e-01  1.00325766e+00  1.00325766e+00
  1.00325766e+00  7.28889109e+00  7.28889109e+00  7.28889109e+00
  7.42008027e+00  3.34795237e+01  3.34795237e+01  3.34795237e+01
  3.44115258e+01  1.29085091e+02  1.29085091e+02  1.29085091e+02
  1.47552143e+02  4.83432361e+02  4.83432361e+02  4.83432361e+02
  6.37073506e+02  1.33517437e+03  1.33517437e+03  1.33517437e+03
  2.70369375e+03  3.02927277e+03  3.02927277e+03  3.02927277e+03
  6.64960799e+03  6.64960799e+03  6.64960799e+03  9.10567087e+03
  2.54587970e+04  7.61981734e+04]
E1 = -728.2488537812695  E_coul = 201.50264263635066
cycle= 1 E= -526.746211144919  delta_E= 4.55e-13  |g|= 8.51e-08  |ddm|= 6.15e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2488537812695  E_coul = 201.50264263635066
  HOMO = -0.584761781669176  LUMO = 0.86960816148091
  mo_energy =
[-1.18584807e+02 -1.23148275e+01 -9.56514733e+00 -9.56514733e+00
 -9.56514733e+00 -1.27242268e+00 -5.84761782e-01 -5.84761782e-01
 -5.84761782e-01  8.69608161e-01  1.00325767e+00  1.00325767e+00
  1.00325767e+00  7.28889111e+00  7.28889111e+00  7.28889111e+00
  7.42008030e+00  3.34795237e+01  3.34795237e+01  3.34795237e+01
  3.44115259e+01  1.29085091e+02  1.29085091e+02  1.29085091e+02
  1.47552143e+02  4.83432361e+02  4.83432361e+02  4.83432361e+02
  6.37073506e+02  1.33517437e+03  1.33517437e+03  1.33517437e+03
  2.70369375e+03  3.02927277e+03  3.02927277e+03  3.02927277e+03
  6.64960799e+03  6.64960799e+03  6.64960799e+03  9.10567087e+03
  2.54587970e+04  7.61981734e+04]
E1 = -728.2488536110995  E_coul = 201.50264246618076
Extra cycle  E= -526.746211144919  delta_E= 1.14e-13  |g|= 1.8e-08  |ddm|= 1.37e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826594e+04 7.61751432e+03 3.61735472e+03 1.59767071e+03
 3.82627012e+02 1.11164267e+02 3.77205023e+01 1.23677013e+01
 5.37903128e+00 6.34145408e-01 2.46003361e+00 2.27743468e-01
 1.36278441e+03 6.64733827e+02 3.00906083e+02 3.13994070e+02
 6.16620823e+01 7.36045567e+00 2.02279759e+01 7.76846176e-01
 2.81717294e+00 2.19984624e-01]
grad_E = [-1.53560810e-06  3.50925636e-06 -1.46274175e-06  7.66076027e-05
 -1.69569058e-04 -5.94048965e-04 -1.08251911e-03  4.29079008e-04
 -1.99308125e-03 -2.66353647e-03  3.01781003e-03  7.51811646e-03
 -5.21111246e-07  4.81522168e-06  2.24671839e-05  1.93711828e-05
  1.04426704e-04  2.66017342e-03 -9.71889419e-04  2.07787454e-02
 -2.96624856e-03 -7.49780171e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:14 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6596274        1
[INPUT] 0    0    [1    /1   ]  7617.51388415        1
[INPUT] 0    0    [1    /1   ]  3617.35493166        1
[INPUT] 0    0    [1    /1   ]  1597.6618536         1
[INPUT] 0    0    [1    /1   ]  382.618038262        1
[INPUT] 0    0    [1    /1   ]  111.30978327         1
[INPUT] 0    0    [1    /1   ]  37.9332757448        1
[INPUT] 0    0    [1    /1   ]  12.5909450767        1
[INPUT] 0    0    [1    /1   ]  5.69161707277        1
[INPUT] 0    0    [1    /1   ]  0.632061695825       1
[INPUT] 0    0    [1    /1   ]  2.60191777236        1
[INPUT] 0    0    [1    /1   ]  0.221932949309       1
[INPUT] 1    0    [1    /1   ]  1362.78447362        1
[INPUT] 1    0    [1    /1   ]  664.733160114        1
[INPUT] 1    0    [1    /1   ]  300.902939836        1
[INPUT] 1    0    [1    /1   ]  313.991360178        1
[INPUT] 1    0    [1    /1   ]  61.6632282169        1
[INPUT] 1    0    [1    /1   ]  7.34376194716        1
[INPUT] 1    0    [1    /1   ]  20.2358028268        1
[INPUT] 1    0    [1    /1   ]  0.776175351851       1
[INPUT] 1    0    [1    /1   ]  2.82439191782        1
[INPUT] 1    0    [1    /1   ]  0.2229369714         1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65962742775, 1.0]], [0, [7617.513884151716, 1.0]], [0, [3617.3549316565263, 1.0]], [0, [1597.661853597038, 1.0]], [0, [382.61803826176924, 1.0]], [0, [111.30978327032871, 1.0]], [0, [37.93327574475458, 1.0]], [0, [12.590945076703264, 1.0]], [0, [5.69161707277105, 1.0]], [0, [0.6320616958245299, 1.0]], [0, [2.6019177723565603, 1.0]], [0, [0.22193294930889043, 1.0]], [1, [1362.7844736223367, 1.0]], [1, [664.7331601142055, 1.0]], [1, [300.90293983554574, 1.0]], [1, [313.99136017795945, 1.0]], [1, [61.66322821693246, 1.0]], [1, [7.3437619471619655, 1.0]], [1, [20.23580282678979, 1.0]], [1, [0.7761753518506876, 1.0]], [1, [2.8243919178211847, 1.0]], [1, [0.22293697140002056, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65962743]
bas 1, expnt(s) = [7617.51388415]
bas 2, expnt(s) = [3617.35493166]
bas 3, expnt(s) = [1597.6618536]
bas 4, expnt(s) = [382.61803826]
bas 5, expnt(s) = [111.30978327]
bas 6, expnt(s) = [37.93327574]
bas 7, expnt(s) = [12.59094508]
bas 8, expnt(s) = [5.69161707]
bas 9, expnt(s) = [0.6320617]
bas 10, expnt(s) = [2.60191777]
bas 11, expnt(s) = [0.22193295]
bas 12, expnt(s) = [1362.78447362]
bas 13, expnt(s) = [664.73316011]
bas 14, expnt(s) = [300.90293984]
bas 15, expnt(s) = [313.99136018]
bas 16, expnt(s) = [61.66322822]
bas 17, expnt(s) = [7.34376195]
bas 18, expnt(s) = [20.23580283]
bas 19, expnt(s) = [0.77617535]
bas 20, expnt(s) = [2.82439192]
bas 21, expnt(s) = [0.22293697]
CPU time:       220.56
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826596e+04 5.20026343e+03 7.61751388e+03 2.06003674e+03
 3.61735493e+03 1.17844242e+03 1.59766185e+03 6.38452620e+02
 3.82618038e+02 2.18569272e+02 1.11309783e+02 8.65794908e+01
 3.79332757e+01 3.86171559e+01 1.25909451e+01 1.68872437e+01
 5.69161707e+00 9.30983061e+00 6.32061696e-01 1.79095481e+00
 2.60191777e+00 5.17589193e+00 2.21932949e-01 8.16923450e-01
 1.36278447e+03 2.41556297e+04 6.64733160e+02 9.84676498e+03
 3.00902940e+02 3.65609466e+03 3.13991360e+02 3.85595108e+03
 6.16632282e+01 5.04100600e+02 7.34376195e+00 3.52681461e+01
 2.02358028e+01 1.25208825e+02 7.76175352e-01 2.12536831e+00
 2.82439192e+00 1.06817053e+01 2.22936971e-01 4.46901707e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993775235085845
cond(S) = 113563.6561451629
E1 = -729.5379244775077  E_coul = 203.17557916504288
init E= -526.362345312465
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555761372965334  LUMO = 0.874409475474315
  mo_energy =
[-1.18330805e+02 -1.22066787e+01 -9.44716641e+00 -9.44716641e+00
 -9.44716641e+00 -1.24024754e+00 -5.55761373e-01 -5.55761373e-01
 -5.55761373e-01  8.74409475e-01  1.03428382e+00  1.03428382e+00
  1.03428382e+00  7.37868243e+00  7.37868243e+00  7.37868243e+00
  7.88777748e+00  3.36006843e+01  3.36006843e+01  3.36006843e+01
  3.62594710e+01  1.29262441e+02  1.29262441e+02  1.29262441e+02
  1.50893907e+02  4.83684843e+02  4.83684843e+02  4.83684843e+02
  6.41110934e+02  1.33547594e+03  1.33547594e+03  1.33547594e+03
  2.70771237e+03  3.02963094e+03  3.02963094e+03  3.02963094e+03
  6.65007293e+03  6.65007293e+03  6.65007293e+03  9.10954864e+03
  2.54625904e+04  7.62018406e+04]
E1 = -727.836455840753  E_coul = 201.09062774771513
cycle= 1 E= -526.745828093038  delta_E= -0.383  |g|= 0.187  |ddm|= 0.32
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.556178
diis-c [-0.30933368  1.        ]
  HOMO = -0.591036117802999  LUMO = 0.850162640066595
  mo_energy =
[-1.18640591e+02 -1.23449768e+01 -9.59652199e+00 -9.59652199e+00
 -9.59652199e+00 -1.27986233e+00 -5.91036118e-01 -5.91036118e-01
 -5.91036118e-01  8.50162640e-01  1.00965071e+00  1.00965071e+00
  1.00965071e+00  7.28723601e+00  7.28723601e+00  7.28723601e+00
  7.80415651e+00  3.34453992e+01  3.34453992e+01  3.34453992e+01
  3.61183657e+01  1.29032732e+02  1.29032732e+02  1.29032732e+02
  1.50666884e+02  4.83376125e+02  4.83376125e+02  4.83376125e+02
  6.40764829e+02  1.33511041e+03  1.33511041e+03  1.33511041e+03
  2.70721304e+03  3.02919908e+03  3.02919908e+03  3.02919908e+03
  6.64952745e+03  6.64952745e+03  6.64952745e+03  9.10892817e+03
  2.54618753e+04  7.62010352e+04]
E1 = -728.413797475285  E_coul = 201.6672379046436
cycle= 2 E= -526.746559570641  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.0526
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.077108
diis-c [-0.00355698  0.08120701  0.91879299]
  HOMO = -0.581901702246399  LUMO = 0.857203475277958
  mo_energy =
[-1.18572302e+02 -1.23066490e+01 -9.55651848e+00 -9.55651848e+00
 -9.55651848e+00 -1.26890601e+00 -5.81901702e-01 -5.81901702e-01
 -5.81901702e-01  8.57203475e-01  1.01641315e+00  1.01641315e+00
  1.01641315e+00  7.31116591e+00  7.31116591e+00  7.31116591e+00
  7.82694313e+00  3.34857692e+01  3.34857692e+01  3.34857692e+01
  3.61566392e+01  1.29089094e+02  1.29089094e+02  1.29089094e+02
  1.50723647e+02  4.83443593e+02  4.83443593e+02  4.83443593e+02
  6.40834420e+02  1.33518195e+03  1.33518195e+03  1.33518195e+03
  2.70728785e+03  3.02927288e+03  3.02927288e+03  3.02927288e+03
  6.64960301e+03  6.64960301e+03  6.64960301e+03  9.10900453e+03
  2.54619523e+04  7.62011125e+04]
E1 = -728.2618057757395  E_coul = 201.5151862769556
cycle= 3 E= -526.746619498784  delta_E= -5.99e-05  |g|= 0.00642  |ddm|= 0.016
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.013597
diis-c [-8.54691526e-07 -1.29630774e-03  1.45286477e-01  8.56009831e-01]
  HOMO = -0.583435831701582  LUMO = 0.856119325855954
  mo_energy =
[-1.18582472e+02 -1.23125782e+01 -9.56280541e+00 -9.56280541e+00
 -9.56280541e+00 -1.27062407e+00 -5.83435832e-01 -5.83435832e-01
 -5.83435832e-01  8.56119326e-01  1.01530489e+00  1.01530489e+00
  1.01530489e+00  7.30730033e+00  7.30730033e+00  7.30730033e+00
  7.82333459e+00  3.34794646e+01  3.34794646e+01  3.34794646e+01
  3.61507037e+01  1.29080569e+02  1.29080569e+02  1.29080569e+02
  1.50715098e+02  4.83433541e+02  4.83433541e+02  4.83433541e+02
  6.40824036e+02  1.33517130e+03  1.33517130e+03  1.33517130e+03
  2.70727656e+03  3.02926183e+03  3.02926183e+03  3.02926183e+03
  6.64959156e+03  6.64959156e+03  6.64959156e+03  9.10899286e+03
  2.54619404e+04  7.62011005e+04]
E1 = -728.2850837119206  E_coul = 201.53846220605377
cycle= 4 E= -526.746621505867  delta_E= -2.01e-06  |g|= 0.000113  |ddm|= 0.00225
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000125702
diis-c [-5.98248474e-09  9.38182726e-05 -1.30440542e-02 -8.10558905e-02
  1.09400613e+00]
  HOMO = -0.583416904210308  LUMO = 0.856153285442445
  mo_energy =
[-1.18582421e+02 -1.23125055e+01 -9.56274739e+00 -9.56274739e+00
 -9.56274739e+00 -1.27057801e+00 -5.83416904e-01 -5.83416904e-01
 -5.83416904e-01  8.56153285e-01  1.01532168e+00  1.01532168e+00
  1.01532168e+00  7.30734601e+00  7.30734601e+00  7.30734601e+00
  7.82339361e+00  3.34795207e+01  3.34795207e+01  3.34795207e+01
  3.61507680e+01  1.29080626e+02  1.29080626e+02  1.29080626e+02
  1.50715158e+02  4.83433592e+02  4.83433592e+02  4.83433592e+02
  6.40824080e+02  1.33517134e+03  1.33517134e+03  1.33517134e+03
  2.70727658e+03  3.02926186e+03  3.02926186e+03  3.02926186e+03
  6.64959158e+03  6.64959158e+03  6.64959158e+03  9.10899286e+03
  2.54619404e+04  7.62011005e+04]
E1 = -728.2848268195874  E_coul = 201.53820531124455
cycle= 5 E= -526.746621508343  delta_E= -2.48e-09  |g|= 2.2e-05  |ddm|= 0.000187
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.07898e-05
diis-c [-1.11204799e-10  1.37524365e-05 -1.76737915e-03 -1.32329424e-02
  3.20419093e-02  9.82944660e-01]
  HOMO = -0.583425313762152  LUMO = 0.856149543768565
  mo_energy =
[-1.18582454e+02 -1.23125306e+01 -9.56277447e+00 -9.56277447e+00
 -9.56277447e+00 -1.27058469e+00 -5.83425314e-01 -5.83425314e-01
 -5.83425314e-01  8.56149544e-01  1.01531608e+00  1.01531608e+00
  1.01531608e+00  7.30732747e+00  7.30732747e+00  7.30732747e+00
  7.82337720e+00  3.34794944e+01  3.34794944e+01  3.34794944e+01
  3.61507431e+01  1.29080596e+02  1.29080596e+02  1.29080596e+02
  1.50715127e+02  4.83433559e+02  4.83433559e+02  4.83433559e+02
  6.40824046e+02  1.33517131e+03  1.33517131e+03  1.33517131e+03
  2.70727655e+03  3.02926183e+03  3.02926183e+03  3.02926183e+03
  6.64959154e+03  6.64959154e+03  6.64959154e+03  9.10899283e+03
  2.54619404e+04  7.62011004e+04]
E1 = -728.2849156221938  E_coul = 201.5382941137802
cycle= 6 E= -526.746621508414  delta_E= -7.08e-11  |g|= 1.9e-06  |ddm|= 2.13e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2849156221938  E_coul = 201.5382941137802
  HOMO = -0.583425160350605  LUMO = 0.856149994220903
  mo_energy =
[-1.18582453e+02 -1.23125298e+01 -9.56277375e+00 -9.56277375e+00
 -9.56277375e+00 -1.27058409e+00 -5.83425160e-01 -5.83425160e-01
 -5.83425160e-01  8.56149994e-01  1.01531625e+00  1.01531625e+00
  1.01531625e+00  7.30732795e+00  7.30732795e+00  7.30732795e+00
  7.82337783e+00  3.34794951e+01  3.34794951e+01  3.34794951e+01
  3.61507438e+01  1.29080597e+02  1.29080597e+02  1.29080597e+02
  1.50715128e+02  4.83433560e+02  4.83433560e+02  4.83433560e+02
  6.40824048e+02  1.33517131e+03  1.33517131e+03  1.33517131e+03
  2.70727655e+03  3.02926183e+03  3.02926183e+03  3.02926183e+03
  6.64959154e+03  6.64959154e+03  6.64959154e+03  9.10899283e+03
  2.54619404e+04  7.62011004e+04]
E1 = -728.2849120447258  E_coul = 201.53829053631108
Extra cycle  E= -526.746621508415  delta_E= -1.25e-12  |g|= 4.09e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.26 sec
exp = [2.61826596e+04 7.61751388e+03 3.61735493e+03 1.59766185e+03
 3.82618038e+02 1.11309783e+02 3.79332757e+01 1.25909451e+01
 5.69161707e+00 6.32061696e-01 2.60191777e+00 2.21932949e-01
 1.36278447e+03 6.64733160e+02 3.00902940e+02 3.13991360e+02
 6.16632282e+01 7.34376195e+00 2.02358028e+01 7.76175352e-01
 2.82439192e+00 2.22936971e-01]
E = -526.7466215084148
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:14 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6596274        1
[INPUT] 0    0    [1    /1   ]  7617.51388415        1
[INPUT] 0    0    [1    /1   ]  3617.35493166        1
[INPUT] 0    0    [1    /1   ]  1597.6618536         1
[INPUT] 0    0    [1    /1   ]  382.618038262        1
[INPUT] 0    0    [1    /1   ]  111.30978327         1
[INPUT] 0    0    [1    /1   ]  37.9332757448        1
[INPUT] 0    0    [1    /1   ]  12.5909450767        1
[INPUT] 0    0    [1    /1   ]  5.69161707277        1
[INPUT] 0    0    [1    /1   ]  0.632061695825       1
[INPUT] 0    0    [1    /1   ]  2.60191777236        1
[INPUT] 0    0    [1    /1   ]  0.221932949309       1
[INPUT] 1    0    [1    /1   ]  1362.78447362        1
[INPUT] 1    0    [1    /1   ]  664.733160114        1
[INPUT] 1    0    [1    /1   ]  300.902939836        1
[INPUT] 1    0    [1    /1   ]  313.991360178        1
[INPUT] 1    0    [1    /1   ]  61.6632282169        1
[INPUT] 1    0    [1    /1   ]  7.34376194716        1
[INPUT] 1    0    [1    /1   ]  20.2358028268        1
[INPUT] 1    0    [1    /1   ]  0.776175351851       1
[INPUT] 1    0    [1    /1   ]  2.82439191782        1
[INPUT] 1    0    [1    /1   ]  0.2229369714         1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65962742775, 1.0]], [0, [7617.513884151716, 1.0]], [0, [3617.3549316565263, 1.0]], [0, [1597.661853597038, 1.0]], [0, [382.61803826176924, 1.0]], [0, [111.30978327032871, 1.0]], [0, [37.93327574475458, 1.0]], [0, [12.590945076703264, 1.0]], [0, [5.69161707277105, 1.0]], [0, [0.6320616958245299, 1.0]], [0, [2.6019177723565603, 1.0]], [0, [0.22193294930889043, 1.0]], [1, [1362.7844736223367, 1.0]], [1, [664.7331601142055, 1.0]], [1, [300.90293983554574, 1.0]], [1, [313.99136017795945, 1.0]], [1, [61.66322821693246, 1.0]], [1, [7.3437619471619655, 1.0]], [1, [20.23580282678979, 1.0]], [1, [0.7761753518506876, 1.0]], [1, [2.8243919178211847, 1.0]], [1, [0.22293697140002056, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65962743]
bas 1, expnt(s) = [7617.51388415]
bas 2, expnt(s) = [3617.35493166]
bas 3, expnt(s) = [1597.6618536]
bas 4, expnt(s) = [382.61803826]
bas 5, expnt(s) = [111.30978327]
bas 6, expnt(s) = [37.93327574]
bas 7, expnt(s) = [12.59094508]
bas 8, expnt(s) = [5.69161707]
bas 9, expnt(s) = [0.6320617]
bas 10, expnt(s) = [2.60191777]
bas 11, expnt(s) = [0.22193295]
bas 12, expnt(s) = [1362.78447362]
bas 13, expnt(s) = [664.73316011]
bas 14, expnt(s) = [300.90293984]
bas 15, expnt(s) = [313.99136018]
bas 16, expnt(s) = [61.66322822]
bas 17, expnt(s) = [7.34376195]
bas 18, expnt(s) = [20.23580283]
bas 19, expnt(s) = [0.77617535]
bas 20, expnt(s) = [2.82439192]
bas 21, expnt(s) = [0.22293697]
CPU time:       220.96
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826596e+04 5.20026343e+03 7.61751388e+03 2.06003674e+03
 3.61735493e+03 1.17844242e+03 1.59766185e+03 6.38452620e+02
 3.82618038e+02 2.18569272e+02 1.11309783e+02 8.65794908e+01
 3.79332757e+01 3.86171559e+01 1.25909451e+01 1.68872437e+01
 5.69161707e+00 9.30983061e+00 6.32061696e-01 1.79095481e+00
 2.60191777e+00 5.17589193e+00 2.21932949e-01 8.16923450e-01
 1.36278447e+03 2.41556297e+04 6.64733160e+02 9.84676498e+03
 3.00902940e+02 3.65609466e+03 3.13991360e+02 3.85595108e+03
 6.16632282e+01 5.04100600e+02 7.34376195e+00 3.52681461e+01
 2.02358028e+01 1.25208825e+02 7.76175352e-01 2.12536831e+00
 2.82439192e+00 1.06817053e+01 2.22936971e-01 4.46901707e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993775235085845
cond(S) = 113563.6561451629
E1 = -729.5379244775077  E_coul = 203.17557916504288
init E= -526.362345312465
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555761372965334  LUMO = 0.874409475474315
  mo_energy =
[-1.18330805e+02 -1.22066787e+01 -9.44716641e+00 -9.44716641e+00
 -9.44716641e+00 -1.24024754e+00 -5.55761373e-01 -5.55761373e-01
 -5.55761373e-01  8.74409475e-01  1.03428382e+00  1.03428382e+00
  1.03428382e+00  7.37868243e+00  7.37868243e+00  7.37868243e+00
  7.88777748e+00  3.36006843e+01  3.36006843e+01  3.36006843e+01
  3.62594710e+01  1.29262441e+02  1.29262441e+02  1.29262441e+02
  1.50893907e+02  4.83684843e+02  4.83684843e+02  4.83684843e+02
  6.41110934e+02  1.33547594e+03  1.33547594e+03  1.33547594e+03
  2.70771237e+03  3.02963094e+03  3.02963094e+03  3.02963094e+03
  6.65007293e+03  6.65007293e+03  6.65007293e+03  9.10954864e+03
  2.54625904e+04  7.62018406e+04]
E1 = -727.836455840753  E_coul = 201.09062774771513
cycle= 1 E= -526.745828093038  delta_E= -0.383  |g|= 0.187  |ddm|= 0.32
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.556178
diis-c [-0.30933368  1.        ]
  HOMO = -0.591036117802999  LUMO = 0.850162640066595
  mo_energy =
[-1.18640591e+02 -1.23449768e+01 -9.59652199e+00 -9.59652199e+00
 -9.59652199e+00 -1.27986233e+00 -5.91036118e-01 -5.91036118e-01
 -5.91036118e-01  8.50162640e-01  1.00965071e+00  1.00965071e+00
  1.00965071e+00  7.28723601e+00  7.28723601e+00  7.28723601e+00
  7.80415651e+00  3.34453992e+01  3.34453992e+01  3.34453992e+01
  3.61183657e+01  1.29032732e+02  1.29032732e+02  1.29032732e+02
  1.50666884e+02  4.83376125e+02  4.83376125e+02  4.83376125e+02
  6.40764829e+02  1.33511041e+03  1.33511041e+03  1.33511041e+03
  2.70721304e+03  3.02919908e+03  3.02919908e+03  3.02919908e+03
  6.64952745e+03  6.64952745e+03  6.64952745e+03  9.10892817e+03
  2.54618753e+04  7.62010352e+04]
E1 = -728.413797475285  E_coul = 201.6672379046436
cycle= 2 E= -526.746559570641  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.0526
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.077108
diis-c [-0.00355698  0.08120701  0.91879299]
  HOMO = -0.581901702246399  LUMO = 0.857203475277958
  mo_energy =
[-1.18572302e+02 -1.23066490e+01 -9.55651848e+00 -9.55651848e+00
 -9.55651848e+00 -1.26890601e+00 -5.81901702e-01 -5.81901702e-01
 -5.81901702e-01  8.57203475e-01  1.01641315e+00  1.01641315e+00
  1.01641315e+00  7.31116591e+00  7.31116591e+00  7.31116591e+00
  7.82694313e+00  3.34857692e+01  3.34857692e+01  3.34857692e+01
  3.61566392e+01  1.29089094e+02  1.29089094e+02  1.29089094e+02
  1.50723647e+02  4.83443593e+02  4.83443593e+02  4.83443593e+02
  6.40834420e+02  1.33518195e+03  1.33518195e+03  1.33518195e+03
  2.70728785e+03  3.02927288e+03  3.02927288e+03  3.02927288e+03
  6.64960301e+03  6.64960301e+03  6.64960301e+03  9.10900453e+03
  2.54619523e+04  7.62011125e+04]
E1 = -728.2618057757395  E_coul = 201.5151862769556
cycle= 3 E= -526.746619498784  delta_E= -5.99e-05  |g|= 0.00642  |ddm|= 0.016
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.013597
diis-c [-8.54691526e-07 -1.29630774e-03  1.45286477e-01  8.56009831e-01]
  HOMO = -0.583435831701582  LUMO = 0.856119325855954
  mo_energy =
[-1.18582472e+02 -1.23125782e+01 -9.56280541e+00 -9.56280541e+00
 -9.56280541e+00 -1.27062407e+00 -5.83435832e-01 -5.83435832e-01
 -5.83435832e-01  8.56119326e-01  1.01530489e+00  1.01530489e+00
  1.01530489e+00  7.30730033e+00  7.30730033e+00  7.30730033e+00
  7.82333459e+00  3.34794646e+01  3.34794646e+01  3.34794646e+01
  3.61507037e+01  1.29080569e+02  1.29080569e+02  1.29080569e+02
  1.50715098e+02  4.83433541e+02  4.83433541e+02  4.83433541e+02
  6.40824036e+02  1.33517130e+03  1.33517130e+03  1.33517130e+03
  2.70727656e+03  3.02926183e+03  3.02926183e+03  3.02926183e+03
  6.64959156e+03  6.64959156e+03  6.64959156e+03  9.10899286e+03
  2.54619404e+04  7.62011005e+04]
E1 = -728.2850837119206  E_coul = 201.53846220605377
cycle= 4 E= -526.746621505867  delta_E= -2.01e-06  |g|= 0.000113  |ddm|= 0.00225
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000125702
diis-c [-5.98248474e-09  9.38182726e-05 -1.30440542e-02 -8.10558905e-02
  1.09400613e+00]
  HOMO = -0.583416904210308  LUMO = 0.856153285442445
  mo_energy =
[-1.18582421e+02 -1.23125055e+01 -9.56274739e+00 -9.56274739e+00
 -9.56274739e+00 -1.27057801e+00 -5.83416904e-01 -5.83416904e-01
 -5.83416904e-01  8.56153285e-01  1.01532168e+00  1.01532168e+00
  1.01532168e+00  7.30734601e+00  7.30734601e+00  7.30734601e+00
  7.82339361e+00  3.34795207e+01  3.34795207e+01  3.34795207e+01
  3.61507680e+01  1.29080626e+02  1.29080626e+02  1.29080626e+02
  1.50715158e+02  4.83433592e+02  4.83433592e+02  4.83433592e+02
  6.40824080e+02  1.33517134e+03  1.33517134e+03  1.33517134e+03
  2.70727658e+03  3.02926186e+03  3.02926186e+03  3.02926186e+03
  6.64959158e+03  6.64959158e+03  6.64959158e+03  9.10899286e+03
  2.54619404e+04  7.62011005e+04]
E1 = -728.2848268195874  E_coul = 201.53820531124455
cycle= 5 E= -526.746621508343  delta_E= -2.48e-09  |g|= 2.2e-05  |ddm|= 0.000187
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.07898e-05
diis-c [-1.11204799e-10  1.37524365e-05 -1.76737915e-03 -1.32329424e-02
  3.20419093e-02  9.82944660e-01]
  HOMO = -0.583425313762152  LUMO = 0.856149543768565
  mo_energy =
[-1.18582454e+02 -1.23125306e+01 -9.56277447e+00 -9.56277447e+00
 -9.56277447e+00 -1.27058469e+00 -5.83425314e-01 -5.83425314e-01
 -5.83425314e-01  8.56149544e-01  1.01531608e+00  1.01531608e+00
  1.01531608e+00  7.30732747e+00  7.30732747e+00  7.30732747e+00
  7.82337720e+00  3.34794944e+01  3.34794944e+01  3.34794944e+01
  3.61507431e+01  1.29080596e+02  1.29080596e+02  1.29080596e+02
  1.50715127e+02  4.83433559e+02  4.83433559e+02  4.83433559e+02
  6.40824046e+02  1.33517131e+03  1.33517131e+03  1.33517131e+03
  2.70727655e+03  3.02926183e+03  3.02926183e+03  3.02926183e+03
  6.64959154e+03  6.64959154e+03  6.64959154e+03  9.10899283e+03
  2.54619404e+04  7.62011004e+04]
E1 = -728.2849156221938  E_coul = 201.5382941137802
cycle= 6 E= -526.746621508414  delta_E= -7.08e-11  |g|= 1.9e-06  |ddm|= 2.13e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2849156221938  E_coul = 201.5382941137802
  HOMO = -0.583425160350605  LUMO = 0.856149994220903
  mo_energy =
[-1.18582453e+02 -1.23125298e+01 -9.56277375e+00 -9.56277375e+00
 -9.56277375e+00 -1.27058409e+00 -5.83425160e-01 -5.83425160e-01
 -5.83425160e-01  8.56149994e-01  1.01531625e+00  1.01531625e+00
  1.01531625e+00  7.30732795e+00  7.30732795e+00  7.30732795e+00
  7.82337783e+00  3.34794951e+01  3.34794951e+01  3.34794951e+01
  3.61507438e+01  1.29080597e+02  1.29080597e+02  1.29080597e+02
  1.50715128e+02  4.83433560e+02  4.83433560e+02  4.83433560e+02
  6.40824048e+02  1.33517131e+03  1.33517131e+03  1.33517131e+03
  2.70727655e+03  3.02926183e+03  3.02926183e+03  3.02926183e+03
  6.64959154e+03  6.64959154e+03  6.64959154e+03  9.10899283e+03
  2.54619404e+04  7.62011004e+04]
E1 = -728.2849120447258  E_coul = 201.53829053631108
Extra cycle  E= -526.746621508415  delta_E= -1.25e-12  |g|= 4.09e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113563.6561451629
E1 = -728.2849120447258  E_coul = 201.53829053631108
init E= -526.746621508415
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.58342524613536  LUMO = 0.856150000327108
  mo_energy =
[-1.18582453e+02 -1.23125301e+01 -9.56277404e+00 -9.56277404e+00
 -9.56277404e+00 -1.27058411e+00 -5.83425246e-01 -5.83425246e-01
 -5.83425246e-01  8.56150000e-01  1.01531620e+00  1.01531620e+00
  1.01531620e+00  7.30732777e+00  7.30732777e+00  7.30732777e+00
  7.82337769e+00  3.34794949e+01  3.34794949e+01  3.34794949e+01
  3.61507436e+01  1.29080596e+02  1.29080596e+02  1.29080596e+02
  1.50715128e+02  4.83433560e+02  4.83433560e+02  4.83433560e+02
  6.40824047e+02  1.33517131e+03  1.33517131e+03  1.33517131e+03
  2.70727655e+03  3.02926183e+03  3.02926183e+03  3.02926183e+03
  6.64959154e+03  6.64959154e+03  6.64959154e+03  9.10899283e+03
  2.54619404e+04  7.62011004e+04]
E1 = -728.2849128879008  E_coul = 201.53829137948645
cycle= 1 E= -526.746621508414  delta_E= 4.55e-13  |g|= 9.75e-08  |ddm|= 6.1e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2849128879008  E_coul = 201.53829137948645
  HOMO = -0.583425233582526  LUMO = 0.856150024122119
  mo_energy =
[-1.18582453e+02 -1.23125300e+01 -9.56277398e+00 -9.56277398e+00
 -9.56277398e+00 -1.27058408e+00 -5.83425234e-01 -5.83425234e-01
 -5.83425234e-01  8.56150024e-01  1.01531621e+00  1.01531621e+00
  1.01531621e+00  7.30732780e+00  7.30732780e+00  7.30732780e+00
  7.82337773e+00  3.34794949e+01  3.34794949e+01  3.34794949e+01
  3.61507436e+01  1.29080597e+02  1.29080597e+02  1.29080597e+02
  1.50715128e+02  4.83433560e+02  4.83433560e+02  4.83433560e+02
  6.40824047e+02  1.33517131e+03  1.33517131e+03  1.33517131e+03
  2.70727655e+03  3.02926183e+03  3.02926183e+03  3.02926183e+03
  6.64959154e+03  6.64959154e+03  6.64959154e+03  9.10899283e+03
  2.54619404e+04  7.62011004e+04]
E1 = -728.2849126154699  E_coul = 201.53829110705536
Extra cycle  E= -526.746621508415  delta_E= -2.27e-13  |g|= 2.19e-08  |ddm|= 1.43e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826596e+04 7.61751388e+03 3.61735493e+03 1.59766185e+03
 3.82618038e+02 1.11309783e+02 3.79332757e+01 1.25909451e+01
 5.69161707e+00 6.32061696e-01 2.60191777e+00 2.21932949e-01
 1.36278447e+03 6.64733160e+02 3.00902940e+02 3.13991360e+02
 6.16632282e+01 7.34376195e+00 2.02358028e+01 7.76175352e-01
 2.82439192e+00 2.22936971e-01]
grad_E = [-1.53581227e-06  3.51162814e-06 -1.46076516e-06  7.66752657e-05
 -1.67898661e-04 -6.45446929e-04 -9.74852014e-04  2.96157028e-04
 -1.49796456e-03  4.28948273e-03  3.78124410e-03 -1.43095725e-02
 -5.11846107e-07  4.94392290e-06  2.32530575e-05  2.00450498e-05
  7.90436198e-06 -1.61770277e-04 -1.02743869e-04 -1.77480280e-03
  8.83175772e-04  7.35096733e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:18 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6595564        1
[INPUT] 0    0    [1    /1   ]  7617.5140327         1
[INPUT] 0    0    [1    /1   ]  3617.35485315        1
[INPUT] 0    0    [1    /1   ]  1597.66482008        1
[INPUT] 0    0    [1    /1   ]  382.626760874        1
[INPUT] 0    0    [1    /1   ]  111.215172594        1
[INPUT] 0    0    [1    /1   ]  37.9453432396        1
[INPUT] 0    0    [1    /1   ]  12.4879248525        1
[INPUT] 0    0    [1    /1   ]  5.72510789274        1
[INPUT] 0    0    [1    /1   ]  0.629741904533       1
[INPUT] 0    0    [1    /1   ]  2.58216635802        1
[INPUT] 0    0    [1    /1   ]  0.223268383974       1
[INPUT] 1    0    [1    /1   ]  1362.78444974        1
[INPUT] 1    0    [1    /1   ]  664.733398067        1
[INPUT] 1    0    [1    /1   ]  300.90406365         1
[INPUT] 1    0    [1    /1   ]  313.992329098        1
[INPUT] 1    0    [1    /1   ]  61.6616841077        1
[INPUT] 1    0    [1    /1   ]  7.33440145485        1
[INPUT] 1    0    [1    /1   ]  20.2415394063        1
[INPUT] 1    0    [1    /1   ]  0.775340489033       1
[INPUT] 1    0    [1    /1   ]  2.81956329119        1
[INPUT] 1    0    [1    /1   ]  0.223580852333       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65955638925, 1.0]], [0, [7617.5140326999635, 1.0]], [0, [3617.3548531486194, 1.0]], [0, [1597.6648200762831, 1.0]], [0, [382.62676087351394, 1.0]], [0, [111.21517259438595, 1.0]], [0, [37.9453432396402, 1.0]], [0, [12.48792485254216, 1.0]], [0, [5.725107892742532, 1.0]], [0, [0.6297419045326798, 1.0]], [0, [2.5821663580173273, 1.0]], [0, [0.22326838397350277, 1.0]], [1, [1362.7844497421443, 1.0]], [1, [664.7333980671098, 1.0]], [1, [300.90406365021005, 1.0]], [1, [313.992329098184, 1.0]], [1, [61.661684107694846, 1.0]], [1, [7.33440145485158, 1.0]], [1, [20.241539406251714, 1.0]], [1, [0.7753404890332275, 1.0]], [1, [2.8195632911853266, 1.0]], [1, [0.22358085233281969, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65955639]
bas 1, expnt(s) = [7617.5140327]
bas 2, expnt(s) = [3617.35485315]
bas 3, expnt(s) = [1597.66482008]
bas 4, expnt(s) = [382.62676087]
bas 5, expnt(s) = [111.21517259]
bas 6, expnt(s) = [37.94534324]
bas 7, expnt(s) = [12.48792485]
bas 8, expnt(s) = [5.72510789]
bas 9, expnt(s) = [0.6297419]
bas 10, expnt(s) = [2.58216636]
bas 11, expnt(s) = [0.22326838]
bas 12, expnt(s) = [1362.78444974]
bas 13, expnt(s) = [664.73339807]
bas 14, expnt(s) = [300.90406365]
bas 15, expnt(s) = [313.9923291]
bas 16, expnt(s) = [61.66168411]
bas 17, expnt(s) = [7.33440145]
bas 18, expnt(s) = [20.24153941]
bas 19, expnt(s) = [0.77534049]
bas 20, expnt(s) = [2.81956329]
bas 21, expnt(s) = [0.22358085]
CPU time:       226.60
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826596e+04 5.20026342e+03 7.61751403e+03 2.06003677e+03
 3.61735485e+03 1.17844240e+03 1.59766482e+03 6.38453509e+02
 3.82626761e+02 2.18573009e+02 1.11215173e+02 8.65242920e+01
 3.79453432e+01 3.86263693e+01 1.24879249e+01 1.67835077e+01
 5.72510789e+00 9.35088640e+00 6.29741905e-01 1.78602268e+00
 2.58216636e+00 5.14639585e+00 2.23268384e-01 8.20607432e-01
 1.36278445e+03 2.41556292e+04 6.64733398e+02 9.84676939e+03
 3.00904064e+02 3.65611172e+03 3.13992329e+02 3.85596595e+03
 6.16616841e+01 5.04084821e+02 7.33440145e+00 3.52119632e+01
 2.02415394e+01 1.25253196e+02 7.75340489e-01 2.12251111e+00
 2.81956329e+00 1.06588832e+01 2.23580852e-01 4.48515702e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99374824183637
cond(S) = 113541.30700604142
E1 = -729.5369246394943  E_coul = 203.17448133305382
init E= -526.36244330644
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555741557058629  LUMO = 0.87564924432262
  mo_energy =
[-1.18330930e+02 -1.22068602e+01 -9.44727864e+00 -9.44727864e+00
 -9.44727864e+00 -1.24024164e+00 -5.55741557e-01 -5.55741557e-01
 -5.55741557e-01  8.75649244e-01  1.03612545e+00  1.03612545e+00
  1.03612545e+00  7.36692621e+00  7.36692621e+00  7.36692621e+00
  7.86011781e+00  3.35638979e+01  3.35638979e+01  3.35638979e+01
  3.61341793e+01  1.29226932e+02  1.29226932e+02  1.29226932e+02
  1.50555132e+02  4.83658344e+02  4.83658344e+02  4.83658344e+02
  6.40570063e+02  1.33545470e+03  1.33545470e+03  1.33545470e+03
  2.70712272e+03  3.02961433e+03  3.02961433e+03  3.02961433e+03
  6.65006022e+03  6.65006022e+03  6.65006022e+03  9.10899262e+03
  2.54620640e+04  7.62013506e+04]
E1 = -727.8508613534846  E_coul = 201.1049479883197
cycle= 1 E= -526.745913365165  delta_E= -0.383  |g|= 0.187  |ddm|= 0.323
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.55581
diis-c [-0.30892526  1.        ]
  HOMO = -0.590398243109395  LUMO = 0.851931559916659
  mo_energy =
[-1.18639694e+02 -1.23441029e+01 -9.59560857e+00 -9.59560857e+00
 -9.59560857e+00 -1.27916290e+00 -5.90398243e-01 -5.90398243e-01
 -5.90398243e-01  8.51931560e-01  1.01193201e+00  1.01193201e+00
  1.01193201e+00  7.27654026e+00  7.27654026e+00  7.27654026e+00
  7.77765569e+00  3.34096919e+01  3.34096919e+01  3.34096919e+01
  3.59942478e+01  1.28998205e+02  1.28998205e+02  1.28998205e+02
  1.50329269e+02  4.83350671e+02  4.83350671e+02  4.83350671e+02
  6.40224982e+02  1.33509019e+03  1.33509019e+03  1.33509019e+03
  2.70662435e+03  3.02918346e+03  3.02918346e+03  3.02918346e+03
  6.64951569e+03  6.64951569e+03  6.64951569e+03  9.10837308e+03
  2.54613499e+04  7.62005462e+04]
E1 = -728.4238621011364  E_coul = 201.67722587966932
cycle= 2 E= -526.746636221467  delta_E= -0.000723  |g|= 0.0378  |ddm|= 0.0522
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766808
diis-c [-0.00352315  0.08075287  0.91924713]
  HOMO = -0.58134011107927  LUMO = 0.858905349006807
  mo_energy =
[-1.18571786e+02 -1.23060556e+01 -9.55589728e+00 -9.55589728e+00
 -9.55589728e+00 -1.26830152e+00 -5.81340111e-01 -5.81340111e-01
 -5.81340111e-01  8.58905349e-01  1.01863731e+00  1.01863731e+00
  1.01863731e+00  7.30025363e+00  7.30025363e+00  7.30025363e+00
  7.80022287e+00  3.34497736e+01  3.34497736e+01  3.34497736e+01
  3.60322023e+01  1.29054226e+02  1.29054226e+02  1.29054226e+02
  1.50385675e+02  4.83417762e+02  4.83417763e+02  4.83417763e+02
  6.40294189e+02  1.33516135e+03  1.33516135e+03  1.33516135e+03
  2.70669876e+03  3.02925686e+03  3.02925686e+03  3.02925686e+03
  6.64959085e+03  6.64959085e+03  6.64959085e+03  9.10844903e+03
  2.54614264e+04  7.62006230e+04]
E1 = -728.2733298367978  E_coul = 201.52663471012787
cycle= 3 E= -526.74669512667  delta_E= -5.89e-05  |g|= 0.00638  |ddm|= 0.0158
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135229
diis-c [-8.47109572e-07 -1.29641642e-03  1.45277635e-01  8.56018781e-01]
  HOMO = -0.582857850727291  LUMO = 0.857834579762376
  mo_energy =
[-1.18581893e+02 -1.23119390e+01 -9.56213758e+00 -9.56213758e+00
 -9.56213758e+00 -1.27000147e+00 -5.82857851e-01 -5.82857851e-01
 -5.82857851e-01  8.57834580e-01  1.01754096e+00  1.01754096e+00
  1.01754096e+00  7.29642612e+00  7.29642612e+00  7.29642612e+00
  7.79665409e+00  3.34435162e+01  3.34435162e+01  3.34435162e+01
  3.60263182e+01  1.29045757e+02  1.29045757e+02  1.29045757e+02
  1.50377185e+02  4.83407772e+02  4.83407772e+02  4.83407772e+02
  6.40283869e+02  1.33515076e+03  1.33515076e+03  1.33515076e+03
  2.70668753e+03  3.02924588e+03  3.02924588e+03  3.02924588e+03
  6.64957946e+03  6.64957946e+03  6.64957946e+03  9.10843743e+03
  2.54614146e+04  7.62006111e+04]
E1 = -728.2963828317643  E_coul = 201.54968573369453
cycle= 4 E= -526.74669709807  delta_E= -1.97e-06  |g|= 0.000113  |ddm|= 0.00223
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000125839
diis-c [-5.90494066e-09  9.37944925e-05 -1.30372034e-02 -8.11523239e-02
  1.09409573e+00]
  HOMO = -0.582838823919899  LUMO = 0.857868349061848
  mo_energy =
[-1.18581843e+02 -1.23118670e+01 -9.56208018e+00 -9.56208018e+00
 -9.56208018e+00 -1.26995568e+00 -5.82838824e-01 -5.82838824e-01
 -5.82838824e-01  8.57868349e-01  1.01755778e+00  1.01755778e+00
  1.01755778e+00  7.29647158e+00  7.29647158e+00  7.29647158e+00
  7.79671289e+00  3.34435717e+01  3.34435717e+01  3.34435717e+01
  3.60263820e+01  1.29045813e+02  1.29045813e+02  1.29045813e+02
  1.50377244e+02  4.83407823e+02  4.83407823e+02  4.83407823e+02
  6.40283912e+02  1.33515080e+03  1.33515080e+03  1.33515080e+03
  2.70668755e+03  3.02924591e+03  3.02924591e+03  3.02924591e+03
  6.64957948e+03  6.64957948e+03  6.64957948e+03  9.10843743e+03
  2.54614146e+04  7.62006111e+04]
E1 = -728.2961304856038  E_coul = 201.54943338512746
cycle= 5 E= -526.746697100476  delta_E= -2.41e-09  |g|= 2.18e-05  |ddm|= 0.000185
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.04305e-05
diis-c [-1.09108553e-10  1.37240734e-05 -1.76385968e-03 -1.32123334e-02
  3.38451983e-02  9.81117271e-01]
  HOMO = -0.582847152183697  LUMO = 0.857864626723303
  mo_energy =
[-1.18581876e+02 -1.23118919e+01 -9.56210703e+00 -9.56210703e+00
 -9.56210703e+00 -1.26996232e+00 -5.82847152e-01 -5.82847152e-01
 -5.82847152e-01  8.57864627e-01  1.01755222e+00  1.01755222e+00
  1.01755222e+00  7.29645322e+00  7.29645322e+00  7.29645322e+00
  7.79669666e+00  3.34435457e+01  3.34435457e+01  3.34435457e+01
  3.60263573e+01  1.29045783e+02  1.29045783e+02  1.29045783e+02
  1.50377214e+02  4.83407790e+02  4.83407790e+02  4.83407790e+02
  6.40283879e+02  1.33515077e+03  1.33515077e+03  1.33515077e+03
  2.70668752e+03  3.02924587e+03  3.02924587e+03  3.02924587e+03
  6.64957944e+03  6.64957944e+03  6.64957944e+03  9.10843740e+03
  2.54614146e+04  7.62006111e+04]
E1 = -728.2962182752162  E_coul = 201.54952117467107
cycle= 6 E= -526.746697100545  delta_E= -6.88e-11  |g|= 1.9e-06  |ddm|= 2.11e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2962182752162  E_coul = 201.54952117467107
  HOMO = -0.582847015638324  LUMO = 0.857865063520905
  mo_energy =
[-1.18581875e+02 -1.23118911e+01 -9.56210636e+00 -9.56210636e+00
 -9.56210636e+00 -1.26996174e+00 -5.82847016e-01 -5.82847016e-01
 -5.82847016e-01  8.57865064e-01  1.01755238e+00  1.01755238e+00
  1.01755238e+00  7.29645367e+00  7.29645367e+00  7.29645367e+00
  7.79669725e+00  3.34435464e+01  3.34435464e+01  3.34435464e+01
  3.60263580e+01  1.29045784e+02  1.29045784e+02  1.29045784e+02
  1.50377214e+02  4.83407791e+02  4.83407791e+02  4.83407791e+02
  6.40283880e+02  1.33515077e+03  1.33515077e+03  1.33515077e+03
  2.70668752e+03  3.02924588e+03  3.02924588e+03  3.02924588e+03
  6.64957944e+03  6.64957944e+03  6.64957944e+03  9.10843740e+03
  2.54614146e+04  7.62006111e+04]
E1 = -728.296214861688  E_coul = 201.54951776114174
Extra cycle  E= -526.746697100546  delta_E= -1.14e-12  |g|= 4.05e-07  |ddm|= 3.3e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
exp = [2.61826596e+04 7.61751403e+03 3.61735485e+03 1.59766482e+03
 3.82626761e+02 1.11215173e+02 3.79453432e+01 1.24879249e+01
 5.72510789e+00 6.29741905e-01 2.58216636e+00 2.23268384e-01
 1.36278445e+03 6.64733398e+02 3.00904064e+02 3.13992329e+02
 6.16616841e+01 7.33440145e+00 2.02415394e+01 7.75340489e-01
 2.81956329e+00 2.23580852e-01]
E = -526.7466971005463
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:19 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6595564        1
[INPUT] 0    0    [1    /1   ]  7617.5140327         1
[INPUT] 0    0    [1    /1   ]  3617.35485315        1
[INPUT] 0    0    [1    /1   ]  1597.66482008        1
[INPUT] 0    0    [1    /1   ]  382.626760874        1
[INPUT] 0    0    [1    /1   ]  111.215172594        1
[INPUT] 0    0    [1    /1   ]  37.9453432396        1
[INPUT] 0    0    [1    /1   ]  12.4879248525        1
[INPUT] 0    0    [1    /1   ]  5.72510789274        1
[INPUT] 0    0    [1    /1   ]  0.629741904533       1
[INPUT] 0    0    [1    /1   ]  2.58216635802        1
[INPUT] 0    0    [1    /1   ]  0.223268383974       1
[INPUT] 1    0    [1    /1   ]  1362.78444974        1
[INPUT] 1    0    [1    /1   ]  664.733398067        1
[INPUT] 1    0    [1    /1   ]  300.90406365         1
[INPUT] 1    0    [1    /1   ]  313.992329098        1
[INPUT] 1    0    [1    /1   ]  61.6616841077        1
[INPUT] 1    0    [1    /1   ]  7.33440145485        1
[INPUT] 1    0    [1    /1   ]  20.2415394063        1
[INPUT] 1    0    [1    /1   ]  0.775340489033       1
[INPUT] 1    0    [1    /1   ]  2.81956329119        1
[INPUT] 1    0    [1    /1   ]  0.223580852333       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65955638925, 1.0]], [0, [7617.5140326999635, 1.0]], [0, [3617.3548531486194, 1.0]], [0, [1597.6648200762831, 1.0]], [0, [382.62676087351394, 1.0]], [0, [111.21517259438595, 1.0]], [0, [37.9453432396402, 1.0]], [0, [12.48792485254216, 1.0]], [0, [5.725107892742532, 1.0]], [0, [0.6297419045326798, 1.0]], [0, [2.5821663580173273, 1.0]], [0, [0.22326838397350277, 1.0]], [1, [1362.7844497421443, 1.0]], [1, [664.7333980671098, 1.0]], [1, [300.90406365021005, 1.0]], [1, [313.992329098184, 1.0]], [1, [61.661684107694846, 1.0]], [1, [7.33440145485158, 1.0]], [1, [20.241539406251714, 1.0]], [1, [0.7753404890332275, 1.0]], [1, [2.8195632911853266, 1.0]], [1, [0.22358085233281969, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65955639]
bas 1, expnt(s) = [7617.5140327]
bas 2, expnt(s) = [3617.35485315]
bas 3, expnt(s) = [1597.66482008]
bas 4, expnt(s) = [382.62676087]
bas 5, expnt(s) = [111.21517259]
bas 6, expnt(s) = [37.94534324]
bas 7, expnt(s) = [12.48792485]
bas 8, expnt(s) = [5.72510789]
bas 9, expnt(s) = [0.6297419]
bas 10, expnt(s) = [2.58216636]
bas 11, expnt(s) = [0.22326838]
bas 12, expnt(s) = [1362.78444974]
bas 13, expnt(s) = [664.73339807]
bas 14, expnt(s) = [300.90406365]
bas 15, expnt(s) = [313.9923291]
bas 16, expnt(s) = [61.66168411]
bas 17, expnt(s) = [7.33440145]
bas 18, expnt(s) = [20.24153941]
bas 19, expnt(s) = [0.77534049]
bas 20, expnt(s) = [2.81956329]
bas 21, expnt(s) = [0.22358085]
CPU time:       226.99
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826596e+04 5.20026342e+03 7.61751403e+03 2.06003677e+03
 3.61735485e+03 1.17844240e+03 1.59766482e+03 6.38453509e+02
 3.82626761e+02 2.18573009e+02 1.11215173e+02 8.65242920e+01
 3.79453432e+01 3.86263693e+01 1.24879249e+01 1.67835077e+01
 5.72510789e+00 9.35088640e+00 6.29741905e-01 1.78602268e+00
 2.58216636e+00 5.14639585e+00 2.23268384e-01 8.20607432e-01
 1.36278445e+03 2.41556292e+04 6.64733398e+02 9.84676939e+03
 3.00904064e+02 3.65611172e+03 3.13992329e+02 3.85596595e+03
 6.16616841e+01 5.04084821e+02 7.33440145e+00 3.52119632e+01
 2.02415394e+01 1.25253196e+02 7.75340489e-01 2.12251111e+00
 2.81956329e+00 1.06588832e+01 2.23580852e-01 4.48515702e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99374824183637
cond(S) = 113541.30700604142
E1 = -729.5369246394943  E_coul = 203.17448133305382
init E= -526.36244330644
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555741557058629  LUMO = 0.87564924432262
  mo_energy =
[-1.18330930e+02 -1.22068602e+01 -9.44727864e+00 -9.44727864e+00
 -9.44727864e+00 -1.24024164e+00 -5.55741557e-01 -5.55741557e-01
 -5.55741557e-01  8.75649244e-01  1.03612545e+00  1.03612545e+00
  1.03612545e+00  7.36692621e+00  7.36692621e+00  7.36692621e+00
  7.86011781e+00  3.35638979e+01  3.35638979e+01  3.35638979e+01
  3.61341793e+01  1.29226932e+02  1.29226932e+02  1.29226932e+02
  1.50555132e+02  4.83658344e+02  4.83658344e+02  4.83658344e+02
  6.40570063e+02  1.33545470e+03  1.33545470e+03  1.33545470e+03
  2.70712272e+03  3.02961433e+03  3.02961433e+03  3.02961433e+03
  6.65006022e+03  6.65006022e+03  6.65006022e+03  9.10899262e+03
  2.54620640e+04  7.62013506e+04]
E1 = -727.8508613534846  E_coul = 201.1049479883197
cycle= 1 E= -526.745913365165  delta_E= -0.383  |g|= 0.187  |ddm|= 0.323
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.55581
diis-c [-0.30892526  1.        ]
  HOMO = -0.590398243109395  LUMO = 0.851931559916659
  mo_energy =
[-1.18639694e+02 -1.23441029e+01 -9.59560857e+00 -9.59560857e+00
 -9.59560857e+00 -1.27916290e+00 -5.90398243e-01 -5.90398243e-01
 -5.90398243e-01  8.51931560e-01  1.01193201e+00  1.01193201e+00
  1.01193201e+00  7.27654026e+00  7.27654026e+00  7.27654026e+00
  7.77765569e+00  3.34096919e+01  3.34096919e+01  3.34096919e+01
  3.59942478e+01  1.28998205e+02  1.28998205e+02  1.28998205e+02
  1.50329269e+02  4.83350671e+02  4.83350671e+02  4.83350671e+02
  6.40224982e+02  1.33509019e+03  1.33509019e+03  1.33509019e+03
  2.70662435e+03  3.02918346e+03  3.02918346e+03  3.02918346e+03
  6.64951569e+03  6.64951569e+03  6.64951569e+03  9.10837308e+03
  2.54613499e+04  7.62005462e+04]
E1 = -728.4238621011364  E_coul = 201.67722587966932
cycle= 2 E= -526.746636221467  delta_E= -0.000723  |g|= 0.0378  |ddm|= 0.0522
    CPU time for cycle= 2      0.03 sec, wall time      0.04 sec
diis-norm(errvec)=0.0766808
diis-c [-0.00352315  0.08075287  0.91924713]
  HOMO = -0.58134011107927  LUMO = 0.858905349006807
  mo_energy =
[-1.18571786e+02 -1.23060556e+01 -9.55589728e+00 -9.55589728e+00
 -9.55589728e+00 -1.26830152e+00 -5.81340111e-01 -5.81340111e-01
 -5.81340111e-01  8.58905349e-01  1.01863731e+00  1.01863731e+00
  1.01863731e+00  7.30025363e+00  7.30025363e+00  7.30025363e+00
  7.80022287e+00  3.34497736e+01  3.34497736e+01  3.34497736e+01
  3.60322023e+01  1.29054226e+02  1.29054226e+02  1.29054226e+02
  1.50385675e+02  4.83417762e+02  4.83417763e+02  4.83417763e+02
  6.40294189e+02  1.33516135e+03  1.33516135e+03  1.33516135e+03
  2.70669876e+03  3.02925686e+03  3.02925686e+03  3.02925686e+03
  6.64959085e+03  6.64959085e+03  6.64959085e+03  9.10844903e+03
  2.54614264e+04  7.62006230e+04]
E1 = -728.2733298367978  E_coul = 201.52663471012787
cycle= 3 E= -526.74669512667  delta_E= -5.89e-05  |g|= 0.00638  |ddm|= 0.0158
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135229
diis-c [-8.47109572e-07 -1.29641642e-03  1.45277635e-01  8.56018781e-01]
  HOMO = -0.582857850727291  LUMO = 0.857834579762376
  mo_energy =
[-1.18581893e+02 -1.23119390e+01 -9.56213758e+00 -9.56213758e+00
 -9.56213758e+00 -1.27000147e+00 -5.82857851e-01 -5.82857851e-01
 -5.82857851e-01  8.57834580e-01  1.01754096e+00  1.01754096e+00
  1.01754096e+00  7.29642612e+00  7.29642612e+00  7.29642612e+00
  7.79665409e+00  3.34435162e+01  3.34435162e+01  3.34435162e+01
  3.60263182e+01  1.29045757e+02  1.29045757e+02  1.29045757e+02
  1.50377185e+02  4.83407772e+02  4.83407772e+02  4.83407772e+02
  6.40283869e+02  1.33515076e+03  1.33515076e+03  1.33515076e+03
  2.70668753e+03  3.02924588e+03  3.02924588e+03  3.02924588e+03
  6.64957946e+03  6.64957946e+03  6.64957946e+03  9.10843743e+03
  2.54614146e+04  7.62006111e+04]
E1 = -728.2963828317643  E_coul = 201.54968573369453
cycle= 4 E= -526.74669709807  delta_E= -1.97e-06  |g|= 0.000113  |ddm|= 0.00223
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000125839
diis-c [-5.90494066e-09  9.37944925e-05 -1.30372034e-02 -8.11523239e-02
  1.09409573e+00]
  HOMO = -0.582838823919899  LUMO = 0.857868349061848
  mo_energy =
[-1.18581843e+02 -1.23118670e+01 -9.56208018e+00 -9.56208018e+00
 -9.56208018e+00 -1.26995568e+00 -5.82838824e-01 -5.82838824e-01
 -5.82838824e-01  8.57868349e-01  1.01755778e+00  1.01755778e+00
  1.01755778e+00  7.29647158e+00  7.29647158e+00  7.29647158e+00
  7.79671289e+00  3.34435717e+01  3.34435717e+01  3.34435717e+01
  3.60263820e+01  1.29045813e+02  1.29045813e+02  1.29045813e+02
  1.50377244e+02  4.83407823e+02  4.83407823e+02  4.83407823e+02
  6.40283912e+02  1.33515080e+03  1.33515080e+03  1.33515080e+03
  2.70668755e+03  3.02924591e+03  3.02924591e+03  3.02924591e+03
  6.64957948e+03  6.64957948e+03  6.64957948e+03  9.10843743e+03
  2.54614146e+04  7.62006111e+04]
E1 = -728.2961304856038  E_coul = 201.54943338512746
cycle= 5 E= -526.746697100476  delta_E= -2.41e-09  |g|= 2.18e-05  |ddm|= 0.000185
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.04305e-05
diis-c [-1.09108553e-10  1.37240734e-05 -1.76385968e-03 -1.32123334e-02
  3.38451983e-02  9.81117271e-01]
  HOMO = -0.582847152183697  LUMO = 0.857864626723303
  mo_energy =
[-1.18581876e+02 -1.23118919e+01 -9.56210703e+00 -9.56210703e+00
 -9.56210703e+00 -1.26996232e+00 -5.82847152e-01 -5.82847152e-01
 -5.82847152e-01  8.57864627e-01  1.01755222e+00  1.01755222e+00
  1.01755222e+00  7.29645322e+00  7.29645322e+00  7.29645322e+00
  7.79669666e+00  3.34435457e+01  3.34435457e+01  3.34435457e+01
  3.60263573e+01  1.29045783e+02  1.29045783e+02  1.29045783e+02
  1.50377214e+02  4.83407790e+02  4.83407790e+02  4.83407790e+02
  6.40283879e+02  1.33515077e+03  1.33515077e+03  1.33515077e+03
  2.70668752e+03  3.02924587e+03  3.02924587e+03  3.02924587e+03
  6.64957944e+03  6.64957944e+03  6.64957944e+03  9.10843740e+03
  2.54614146e+04  7.62006111e+04]
E1 = -728.2962182752162  E_coul = 201.54952117467107
cycle= 6 E= -526.746697100545  delta_E= -6.88e-11  |g|= 1.9e-06  |ddm|= 2.11e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2962182752162  E_coul = 201.54952117467107
  HOMO = -0.582847015638324  LUMO = 0.857865063520905
  mo_energy =
[-1.18581875e+02 -1.23118911e+01 -9.56210636e+00 -9.56210636e+00
 -9.56210636e+00 -1.26996174e+00 -5.82847016e-01 -5.82847016e-01
 -5.82847016e-01  8.57865064e-01  1.01755238e+00  1.01755238e+00
  1.01755238e+00  7.29645367e+00  7.29645367e+00  7.29645367e+00
  7.79669725e+00  3.34435464e+01  3.34435464e+01  3.34435464e+01
  3.60263580e+01  1.29045784e+02  1.29045784e+02  1.29045784e+02
  1.50377214e+02  4.83407791e+02  4.83407791e+02  4.83407791e+02
  6.40283880e+02  1.33515077e+03  1.33515077e+03  1.33515077e+03
  2.70668752e+03  3.02924588e+03  3.02924588e+03  3.02924588e+03
  6.64957944e+03  6.64957944e+03  6.64957944e+03  9.10843740e+03
  2.54614146e+04  7.62006111e+04]
E1 = -728.296214861688  E_coul = 201.54951776114174
Extra cycle  E= -526.746697100546  delta_E= -1.14e-12  |g|= 4.05e-07  |ddm|= 3.3e-06
    CPU time for scf_cycle      0.30 sec, wall time      0.28 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113541.30700604142
E1 = -728.296214861688  E_coul = 201.54951776114174
init E= -526.746697100546
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.582847098229515  LUMO = 0.857865071914397
  mo_energy =
[-1.18581875e+02 -1.23118914e+01 -9.56210663e+00 -9.56210663e+00
 -9.56210663e+00 -1.26996176e+00 -5.82847098e-01 -5.82847098e-01
 -5.82847098e-01  8.57865072e-01  1.01755233e+00  1.01755233e+00
  1.01755233e+00  7.29645349e+00  7.29645349e+00  7.29645349e+00
  7.79669712e+00  3.34435461e+01  3.34435461e+01  3.34435461e+01
  3.60263578e+01  1.29045783e+02  1.29045783e+02  1.29045783e+02
  1.50377214e+02  4.83407791e+02  4.83407791e+02  4.83407791e+02
  6.40283879e+02  1.33515077e+03  1.33515077e+03  1.33515077e+03
  2.70668752e+03  3.02924588e+03  3.02924588e+03  3.02924588e+03
  6.64957944e+03  6.64957944e+03  6.64957944e+03  9.10843740e+03
  2.54614146e+04  7.62006111e+04]
E1 = -728.2962156544731  E_coul = 201.54951855392716
cycle= 1 E= -526.746697100546  delta_E= 2.27e-13  |g|= 9.57e-08  |ddm|= 6.16e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2962156544731  E_coul = 201.54951855392716
  HOMO = -0.58284708667057  LUMO = 0.857865094913622
  mo_energy =
[-1.18581875e+02 -1.23118913e+01 -9.56210658e+00 -9.56210658e+00
 -9.56210658e+00 -1.26996172e+00 -5.82847087e-01 -5.82847087e-01
 -5.82847087e-01  8.57865095e-01  1.01755234e+00  1.01755234e+00
  1.01755234e+00  7.29645353e+00  7.29645353e+00  7.29645353e+00
  7.79669716e+00  3.34435462e+01  3.34435462e+01  3.34435462e+01
  3.60263578e+01  1.29045783e+02  1.29045783e+02  1.29045783e+02
  1.50377214e+02  4.83407791e+02  4.83407791e+02  4.83407791e+02
  6.40283879e+02  1.33515077e+03  1.33515077e+03  1.33515077e+03
  2.70668752e+03  3.02924588e+03  3.02924588e+03  3.02924588e+03
  6.64957944e+03  6.64957944e+03  6.64957944e+03  9.10843740e+03
  2.54614146e+04  7.62006111e+04]
E1 = -728.2962153966632  E_coul = 201.54951829611775
Extra cycle  E= -526.746697100545  delta_E= 5.68e-13  |g|= 2.13e-08  |ddm|= 1.43e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826596e+04 7.61751403e+03 3.61735485e+03 1.59766482e+03
 3.82626761e+02 1.11215173e+02 3.79453432e+01 1.24879249e+01
 5.72510789e+00 6.29741905e-01 2.58216636e+00 2.23268384e-01
 1.36278445e+03 6.64733398e+02 3.00904064e+02 3.13992329e+02
 6.16616841e+01 7.33440145e+00 2.02415394e+01 7.75340489e-01
 2.81956329e+00 2.23580852e-01]
grad_E = [-1.53417752e-06  3.49302158e-06 -1.47254591e-06  7.59705444e-05
 -1.49545153e-04 -7.34464135e-04 -8.93305255e-04  1.97714498e-04
 -8.10768512e-04  4.23588424e-04  2.37512927e-03 -4.58578707e-03
 -5.08015010e-07  4.99635245e-06  2.35704743e-05  2.03177004e-05
 -2.76615980e-05 -7.46695705e-04  1.68024079e-04 -7.59557087e-03
  1.30447326e-03  2.81347555e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:23 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6596387        1
[INPUT] 0    0    [1    /1   ]  7617.51385595        1
[INPUT] 0    0    [1    /1   ]  3617.35494062        1
[INPUT] 0    0    [1    /1   ]  1597.66117823        1
[INPUT] 0    0    [1    /1   ]  382.623972301        1
[INPUT] 0    0    [1    /1   ]  111.269510628        1
[INPUT] 0    0    [1    /1   ]  38.0403639685        1
[INPUT] 0    0    [1    /1   ]  12.5717217338        1
[INPUT] 0    0    [1    /1   ]  5.86891318805        1
[INPUT] 0    0    [1    /1   ]  0.632422731879       1
[INPUT] 0    0    [1    /1   ]  2.64624659392        1
[INPUT] 0    0    [1    /1   ]  0.225952441185       1
[INPUT] 1    0    [1    /1   ]  1362.78447733        1
[INPUT] 1    0    [1    /1   ]  664.73312559         1
[INPUT] 1    0    [1    /1   ]  300.902778573        1
[INPUT] 1    0    [1    /1   ]  313.991221123        1
[INPUT] 1    0    [1    /1   ]  61.6625822341        1
[INPUT] 1    0    [1    /1   ]  7.33408230771        1
[INPUT] 1    0    [1    /1   ]  20.2415131671        1
[INPUT] 1    0    [1    /1   ]  0.7753962943         1
[INPUT] 1    0    [1    /1   ]  2.82072890857        1
[INPUT] 1    0    [1    /1   ]  0.223500448939       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659638661855, 1.0]], [0, [7617.513855946521, 1.0]], [0, [3617.354940622459, 1.0]], [0, [1597.6611782292603, 1.0]], [0, [382.6239723012669, 1.0]], [0, [111.26951062821242, 1.0]], [0, [38.04036396845233, 1.0]], [0, [12.571721733813511, 1.0]], [0, [5.868913188046932, 1.0]], [0, [0.6324227318790238, 1.0]], [0, [2.646246593915469, 1.0]], [0, [0.22595244118496072, 1.0]], [1, [1362.7844773250165, 1.0]], [1, [664.7331255904254, 1.0]], [1, [300.90277857314896, 1.0]], [1, [313.99122112273005, 1.0]], [1, [61.662582234071266, 1.0]], [1, [7.334082307706192, 1.0]], [1, [20.241513167065758, 1.0]], [1, [0.7753962942997417, 1.0]], [1, [2.8207289085669918, 1.0]], [1, [0.22350044893889606, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65963866]
bas 1, expnt(s) = [7617.51385595]
bas 2, expnt(s) = [3617.35494062]
bas 3, expnt(s) = [1597.66117823]
bas 4, expnt(s) = [382.6239723]
bas 5, expnt(s) = [111.26951063]
bas 6, expnt(s) = [38.04036397]
bas 7, expnt(s) = [12.57172173]
bas 8, expnt(s) = [5.86891319]
bas 9, expnt(s) = [0.63242273]
bas 10, expnt(s) = [2.64624659]
bas 11, expnt(s) = [0.22595244]
bas 12, expnt(s) = [1362.78447733]
bas 13, expnt(s) = [664.73312559]
bas 14, expnt(s) = [300.90277857]
bas 15, expnt(s) = [313.99122112]
bas 16, expnt(s) = [61.66258223]
bas 17, expnt(s) = [7.33408231]
bas 18, expnt(s) = [20.24151317]
bas 19, expnt(s) = [0.77539629]
bas 20, expnt(s) = [2.82072891]
bas 21, expnt(s) = [0.22350045]
CPU time:       232.69
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826596e+04 5.20026343e+03 7.61751386e+03 2.06003673e+03
 3.61735494e+03 1.17844242e+03 1.59766118e+03 6.38452418e+02
 3.82623972e+02 2.18571814e+02 1.11269511e+02 8.65559959e+01
 3.80403640e+01 3.86988912e+01 1.25717217e+01 1.68679030e+01
 5.86891319e+00 9.52649817e+00 6.32422732e-01 1.79172201e+00
 2.64624659e+00 5.24188825e+00 2.25952441e-01 8.27995168e-01
 1.36278448e+03 2.41556298e+04 6.64733126e+02 9.84676434e+03
 3.00902779e+02 3.65609221e+03 3.13991221e+02 3.85594894e+03
 6.16625822e+01 5.04093999e+02 7.33408231e+00 3.52100480e+01
 2.02415132e+01 1.25252993e+02 7.75396294e-01 2.12270207e+00
 2.82072891e+00 1.06643915e+01 2.23500449e-01 4.48314094e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993750981476165
cond(S) = 113757.9953869079
E1 = -729.5368641412862  E_coul = 203.17438364972472
init E= -526.362480491561
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555747266476157  LUMO = 0.890086446002489
  mo_energy =
[-1.18330986e+02 -1.22068462e+01 -9.44728225e+00 -9.44728225e+00
 -9.44728225e+00 -1.24025272e+00 -5.55747266e-01 -5.55747266e-01
 -5.55747266e-01  8.90086446e-01  1.03588737e+00  1.03588737e+00
  1.03588737e+00  7.36869502e+00  7.36869502e+00  7.36869502e+00
  8.08738351e+00  3.35672315e+01  3.35672315e+01  3.35672315e+01
  3.69404914e+01  1.29230452e+02  1.29230452e+02  1.29230452e+02
  1.51958344e+02  4.83661993e+02  4.83661993e+02  4.83661993e+02
  6.42206570e+02  1.33545600e+03  1.33545600e+03  1.33545600e+03
  2.70867607e+03  3.02961214e+03  3.02961214e+03  3.02961214e+03
  6.65005548e+03  6.65005548e+03  6.65005548e+03  9.11043169e+03
  2.54634256e+04  7.62026186e+04]
E1 = -727.8521708621753  E_coul = 201.10619335029597
cycle= 1 E= -526.745977511879  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.556066
diis-c [-0.30920935  1.        ]
  HOMO = -0.59036902674074  LUMO = 0.865966645936524
  mo_energy =
[-1.18639587e+02 -1.23440091e+01 -9.59550222e+00 -9.59550222e+00
 -9.59550222e+00 -1.27917942e+00 -5.90369027e-01 -5.90369027e-01
 -5.90369027e-01  8.65966646e-01  1.01171445e+00  1.01171445e+00
  1.01171445e+00  7.27836114e+00  7.27836114e+00  7.27836114e+00
  8.00380800e+00  3.34131377e+01  3.34131377e+01  3.34131377e+01
  3.67999067e+01  1.29001867e+02  1.29001867e+02  1.29001867e+02
  1.51732475e+02  4.83354486e+02  4.83354486e+02  4.83354486e+02
  6.41861686e+02  1.33509167e+03  1.33509167e+03  1.33509167e+03
  2.70817791e+03  3.02918145e+03  3.02918145e+03  3.02918145e+03
  6.64951115e+03  6.64951115e+03  6.64951115e+03  9.10981235e+03
  2.54627117e+04  7.62018143e+04]
E1 = -728.4250319563563  E_coul = 201.67833266329873
cycle= 2 E= -526.746699293058  delta_E= -0.000722  |g|= 0.0378  |ddm|= 0.0523
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766315
diis-c [-0.00352543  0.08056342  0.91943658]
  HOMO = -0.581306513874225  LUMO = 0.87304456463122
  mo_energy =
[-1.18571693e+02 -1.23059643e+01 -9.55579288e+00 -9.55579288e+00
 -9.55579288e+00 -1.26831854e+00 -5.81306514e-01 -5.81306514e-01
 -5.81306514e-01  8.73044565e-01  1.01842123e+00  1.01842123e+00
  1.01842123e+00  7.30208084e+00  7.30208084e+00  7.30208084e+00
  8.02670184e+00  3.34532172e+01  3.34532172e+01  3.34532172e+01
  3.68380474e+01  1.29057879e+02  1.29057879e+02  1.29057879e+02
  1.51788892e+02  4.83421564e+02  4.83421564e+02  4.83421564e+02
  6.41930873e+02  1.33516281e+03  1.33516281e+03  1.33516281e+03
  2.70825230e+03  3.02925484e+03  3.02925484e+03  3.02925484e+03
  6.64958629e+03  6.64958629e+03  6.64958629e+03  9.10988829e+03
  2.54627882e+04  7.62018911e+04]
E1 = -728.2745670198603  E_coul = 201.52780890778524
cycle= 3 E= -526.746758112075  delta_E= -5.88e-05  |g|= 0.00638  |ddm|= 0.0158
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135272
diis-c [-8.26521610e-07 -1.29284619e-03  1.45422518e-01  8.55870328e-01]
  HOMO = -0.582824113306823  LUMO = 0.871955370409778
  mo_energy =
[-1.18581806e+02 -1.23118513e+01 -9.56203602e+00 -9.56203602e+00
 -9.56203602e+00 -1.27002124e+00 -5.82824113e-01 -5.82824113e-01
 -5.82824113e-01  8.71955370e-01  1.01732472e+00  1.01732472e+00
  1.01732472e+00  7.29825142e+00  7.29825142e+00  7.29825142e+00
  8.02308090e+00  3.34469568e+01  3.34469568e+01  3.34469568e+01
  3.68321318e+01  1.29049404e+02  1.29049404e+02  1.29049404e+02
  1.51780394e+02  4.83411568e+02  4.83411568e+02  4.83411568e+02
  6.41920547e+02  1.33515221e+03  1.33515221e+03  1.33515221e+03
  2.70824107e+03  3.02924385e+03  3.02924385e+03  3.02924385e+03
  6.64957490e+03  6.64957490e+03  6.64957490e+03  9.10987668e+03
  2.54627764e+04  7.62018792e+04]
E1 = -728.297638282354  E_coul = 201.55087819811857
cycle= 4 E= -526.746760084235  delta_E= -1.97e-06  |g|= 0.00011  |ddm|= 0.00223
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000122789
diis-c [-5.71010479e-09  9.13874898e-05 -1.27403730e-02 -7.92204736e-02
  1.09186946e+00]
  HOMO = -0.582804770122344  LUMO = 0.871989102513475
  mo_energy =
[-1.18581755e+02 -1.23117791e+01 -9.56197818e+00 -9.56197818e+00
 -9.56197818e+00 -1.26997594e+00 -5.82804770e-01 -5.82804770e-01
 -5.82804770e-01  8.71989103e-01  1.01734167e+00  1.01734167e+00
  1.01734167e+00  7.29829722e+00  7.29829722e+00  7.29829722e+00
  8.02314011e+00  3.34470127e+01  3.34470127e+01  3.34470127e+01
  3.68321959e+01  1.29049461e+02  1.29049461e+02  1.29049461e+02
  1.51780453e+02  4.83411619e+02  4.83411619e+02  4.83411619e+02
  6.41920591e+02  1.33515226e+03  1.33515226e+03  1.33515226e+03
  2.70824109e+03  3.02924388e+03  3.02924388e+03  3.02924388e+03
  6.64957491e+03  6.64957491e+03  6.64957491e+03  9.10987669e+03
  2.54627764e+04  7.62018792e+04]
E1 = -728.2973874416747  E_coul = 201.55062735519104
cycle= 5 E= -526.746760086484  delta_E= -2.25e-09  |g|= 2.15e-05  |ddm|= 0.000179
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.00284e-05
diis-c [-1.04262060e-10  1.36462765e-05 -1.76286136e-03 -1.31715411e-02
  3.59412587e-02  9.78979497e-01]
  HOMO = -0.582812962519184  LUMO = 0.871985347438486
  mo_energy =
[-1.18581788e+02 -1.23118036e+01 -9.56200466e+00 -9.56200466e+00
 -9.56200466e+00 -1.26998251e+00 -5.82812963e-01 -5.82812963e-01
 -5.82812963e-01  8.71985347e-01  1.01733620e+00  1.01733620e+00
  1.01733620e+00  7.29827913e+00  7.29827913e+00  7.29827913e+00
  8.02312388e+00  3.34469870e+01  3.34469870e+01  3.34469870e+01
  3.68321714e+01  1.29049431e+02  1.29049431e+02  1.29049431e+02
  1.51780423e+02  4.83411586e+02  4.83411586e+02  4.83411586e+02
  6.41920558e+02  1.33515222e+03  1.33515222e+03  1.33515222e+03
  2.70824106e+03  3.02924385e+03  3.02924385e+03  3.02924385e+03
  6.64957488e+03  6.64957488e+03  6.64957488e+03  9.10987665e+03
  2.54627764e+04  7.62018791e+04]
E1 = -728.2974742443528  E_coul = 201.5507141578031
cycle= 6 E= -526.74676008655  delta_E= -6.61e-11  |g|= 1.88e-06  |ddm|= 2.04e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2974742443528  E_coul = 201.5507141578031
  HOMO = -0.582812848715665  LUMO = 0.871985771288712
  mo_energy =
[-1.18581787e+02 -1.23118030e+01 -9.56200408e+00 -9.56200408e+00
 -9.56200408e+00 -1.26998197e+00 -5.82812849e-01 -5.82812849e-01
 -5.82812849e-01  8.71985771e-01  1.01733634e+00  1.01733634e+00
  1.01733634e+00  7.29827952e+00  7.29827952e+00  7.29827952e+00
  8.02312442e+00  3.34469877e+01  3.34469877e+01  3.34469877e+01
  3.68321720e+01  1.29049432e+02  1.29049432e+02  1.29049432e+02
  1.51780424e+02  4.83411587e+02  4.83411587e+02  4.83411587e+02
  6.41920559e+02  1.33515222e+03  1.33515222e+03  1.33515222e+03
  2.70824106e+03  3.02924385e+03  3.02924385e+03  3.02924385e+03
  6.64957488e+03  6.64957488e+03  6.64957488e+03  9.10987665e+03
  2.54627764e+04  7.62018791e+04]
E1 = -728.2974711583853  E_coul = 201.55071107183397
Extra cycle  E= -526.746760086551  delta_E= -1.71e-12  |g|= 3.98e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826596e+04 7.61751386e+03 3.61735494e+03 1.59766118e+03
 3.82623972e+02 1.11269511e+02 3.80403640e+01 1.25717217e+01
 5.86891319e+00 6.32422732e-01 2.64624659e+00 2.25952441e-01
 1.36278448e+03 6.64733126e+02 3.00902779e+02 3.13991221e+02
 6.16625822e+01 7.33408231e+00 2.02415132e+01 7.75396294e-01
 2.82072891e+00 2.23500449e-01]
E = -526.7467600865514
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:24 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6596387        1
[INPUT] 0    0    [1    /1   ]  7617.51385595        1
[INPUT] 0    0    [1    /1   ]  3617.35494062        1
[INPUT] 0    0    [1    /1   ]  1597.66117823        1
[INPUT] 0    0    [1    /1   ]  382.623972301        1
[INPUT] 0    0    [1    /1   ]  111.269510628        1
[INPUT] 0    0    [1    /1   ]  38.0403639685        1
[INPUT] 0    0    [1    /1   ]  12.5717217338        1
[INPUT] 0    0    [1    /1   ]  5.86891318805        1
[INPUT] 0    0    [1    /1   ]  0.632422731879       1
[INPUT] 0    0    [1    /1   ]  2.64624659392        1
[INPUT] 0    0    [1    /1   ]  0.225952441185       1
[INPUT] 1    0    [1    /1   ]  1362.78447733        1
[INPUT] 1    0    [1    /1   ]  664.73312559         1
[INPUT] 1    0    [1    /1   ]  300.902778573        1
[INPUT] 1    0    [1    /1   ]  313.991221123        1
[INPUT] 1    0    [1    /1   ]  61.6625822341        1
[INPUT] 1    0    [1    /1   ]  7.33408230771        1
[INPUT] 1    0    [1    /1   ]  20.2415131671        1
[INPUT] 1    0    [1    /1   ]  0.7753962943         1
[INPUT] 1    0    [1    /1   ]  2.82072890857        1
[INPUT] 1    0    [1    /1   ]  0.223500448939       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659638661855, 1.0]], [0, [7617.513855946521, 1.0]], [0, [3617.354940622459, 1.0]], [0, [1597.6611782292603, 1.0]], [0, [382.6239723012669, 1.0]], [0, [111.26951062821242, 1.0]], [0, [38.04036396845233, 1.0]], [0, [12.571721733813511, 1.0]], [0, [5.868913188046932, 1.0]], [0, [0.6324227318790238, 1.0]], [0, [2.646246593915469, 1.0]], [0, [0.22595244118496072, 1.0]], [1, [1362.7844773250165, 1.0]], [1, [664.7331255904254, 1.0]], [1, [300.90277857314896, 1.0]], [1, [313.99122112273005, 1.0]], [1, [61.662582234071266, 1.0]], [1, [7.334082307706192, 1.0]], [1, [20.241513167065758, 1.0]], [1, [0.7753962942997417, 1.0]], [1, [2.8207289085669918, 1.0]], [1, [0.22350044893889606, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65963866]
bas 1, expnt(s) = [7617.51385595]
bas 2, expnt(s) = [3617.35494062]
bas 3, expnt(s) = [1597.66117823]
bas 4, expnt(s) = [382.6239723]
bas 5, expnt(s) = [111.26951063]
bas 6, expnt(s) = [38.04036397]
bas 7, expnt(s) = [12.57172173]
bas 8, expnt(s) = [5.86891319]
bas 9, expnt(s) = [0.63242273]
bas 10, expnt(s) = [2.64624659]
bas 11, expnt(s) = [0.22595244]
bas 12, expnt(s) = [1362.78447733]
bas 13, expnt(s) = [664.73312559]
bas 14, expnt(s) = [300.90277857]
bas 15, expnt(s) = [313.99122112]
bas 16, expnt(s) = [61.66258223]
bas 17, expnt(s) = [7.33408231]
bas 18, expnt(s) = [20.24151317]
bas 19, expnt(s) = [0.77539629]
bas 20, expnt(s) = [2.82072891]
bas 21, expnt(s) = [0.22350045]
CPU time:       233.09
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826596e+04 5.20026343e+03 7.61751386e+03 2.06003673e+03
 3.61735494e+03 1.17844242e+03 1.59766118e+03 6.38452418e+02
 3.82623972e+02 2.18571814e+02 1.11269511e+02 8.65559959e+01
 3.80403640e+01 3.86988912e+01 1.25717217e+01 1.68679030e+01
 5.86891319e+00 9.52649817e+00 6.32422732e-01 1.79172201e+00
 2.64624659e+00 5.24188825e+00 2.25952441e-01 8.27995168e-01
 1.36278448e+03 2.41556298e+04 6.64733126e+02 9.84676434e+03
 3.00902779e+02 3.65609221e+03 3.13991221e+02 3.85594894e+03
 6.16625822e+01 5.04093999e+02 7.33408231e+00 3.52100480e+01
 2.02415132e+01 1.25252993e+02 7.75396294e-01 2.12270207e+00
 2.82072891e+00 1.06643915e+01 2.23500449e-01 4.48314094e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993750981476165
cond(S) = 113757.9953869079
E1 = -729.5368641412862  E_coul = 203.17438364972472
init E= -526.362480491561
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555747266476157  LUMO = 0.890086446002489
  mo_energy =
[-1.18330986e+02 -1.22068462e+01 -9.44728225e+00 -9.44728225e+00
 -9.44728225e+00 -1.24025272e+00 -5.55747266e-01 -5.55747266e-01
 -5.55747266e-01  8.90086446e-01  1.03588737e+00  1.03588737e+00
  1.03588737e+00  7.36869502e+00  7.36869502e+00  7.36869502e+00
  8.08738351e+00  3.35672315e+01  3.35672315e+01  3.35672315e+01
  3.69404914e+01  1.29230452e+02  1.29230452e+02  1.29230452e+02
  1.51958344e+02  4.83661993e+02  4.83661993e+02  4.83661993e+02
  6.42206570e+02  1.33545600e+03  1.33545600e+03  1.33545600e+03
  2.70867607e+03  3.02961214e+03  3.02961214e+03  3.02961214e+03
  6.65005548e+03  6.65005548e+03  6.65005548e+03  9.11043169e+03
  2.54634256e+04  7.62026186e+04]
E1 = -727.8521708621753  E_coul = 201.10619335029597
cycle= 1 E= -526.745977511879  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.556066
diis-c [-0.30920935  1.        ]
  HOMO = -0.59036902674074  LUMO = 0.865966645936524
  mo_energy =
[-1.18639587e+02 -1.23440091e+01 -9.59550222e+00 -9.59550222e+00
 -9.59550222e+00 -1.27917942e+00 -5.90369027e-01 -5.90369027e-01
 -5.90369027e-01  8.65966646e-01  1.01171445e+00  1.01171445e+00
  1.01171445e+00  7.27836114e+00  7.27836114e+00  7.27836114e+00
  8.00380800e+00  3.34131377e+01  3.34131377e+01  3.34131377e+01
  3.67999067e+01  1.29001867e+02  1.29001867e+02  1.29001867e+02
  1.51732475e+02  4.83354486e+02  4.83354486e+02  4.83354486e+02
  6.41861686e+02  1.33509167e+03  1.33509167e+03  1.33509167e+03
  2.70817791e+03  3.02918145e+03  3.02918145e+03  3.02918145e+03
  6.64951115e+03  6.64951115e+03  6.64951115e+03  9.10981235e+03
  2.54627117e+04  7.62018143e+04]
E1 = -728.4250319563563  E_coul = 201.67833266329873
cycle= 2 E= -526.746699293058  delta_E= -0.000722  |g|= 0.0378  |ddm|= 0.0523
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766315
diis-c [-0.00352543  0.08056342  0.91943658]
  HOMO = -0.581306513874225  LUMO = 0.87304456463122
  mo_energy =
[-1.18571693e+02 -1.23059643e+01 -9.55579288e+00 -9.55579288e+00
 -9.55579288e+00 -1.26831854e+00 -5.81306514e-01 -5.81306514e-01
 -5.81306514e-01  8.73044565e-01  1.01842123e+00  1.01842123e+00
  1.01842123e+00  7.30208084e+00  7.30208084e+00  7.30208084e+00
  8.02670184e+00  3.34532172e+01  3.34532172e+01  3.34532172e+01
  3.68380474e+01  1.29057879e+02  1.29057879e+02  1.29057879e+02
  1.51788892e+02  4.83421564e+02  4.83421564e+02  4.83421564e+02
  6.41930873e+02  1.33516281e+03  1.33516281e+03  1.33516281e+03
  2.70825230e+03  3.02925484e+03  3.02925484e+03  3.02925484e+03
  6.64958629e+03  6.64958629e+03  6.64958629e+03  9.10988829e+03
  2.54627882e+04  7.62018911e+04]
E1 = -728.2745670198603  E_coul = 201.52780890778524
cycle= 3 E= -526.746758112075  delta_E= -5.88e-05  |g|= 0.00638  |ddm|= 0.0158
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135272
diis-c [-8.26521610e-07 -1.29284619e-03  1.45422518e-01  8.55870328e-01]
  HOMO = -0.582824113306823  LUMO = 0.871955370409778
  mo_energy =
[-1.18581806e+02 -1.23118513e+01 -9.56203602e+00 -9.56203602e+00
 -9.56203602e+00 -1.27002124e+00 -5.82824113e-01 -5.82824113e-01
 -5.82824113e-01  8.71955370e-01  1.01732472e+00  1.01732472e+00
  1.01732472e+00  7.29825142e+00  7.29825142e+00  7.29825142e+00
  8.02308090e+00  3.34469568e+01  3.34469568e+01  3.34469568e+01
  3.68321318e+01  1.29049404e+02  1.29049404e+02  1.29049404e+02
  1.51780394e+02  4.83411568e+02  4.83411568e+02  4.83411568e+02
  6.41920547e+02  1.33515221e+03  1.33515221e+03  1.33515221e+03
  2.70824107e+03  3.02924385e+03  3.02924385e+03  3.02924385e+03
  6.64957490e+03  6.64957490e+03  6.64957490e+03  9.10987668e+03
  2.54627764e+04  7.62018792e+04]
E1 = -728.297638282354  E_coul = 201.55087819811857
cycle= 4 E= -526.746760084235  delta_E= -1.97e-06  |g|= 0.00011  |ddm|= 0.00223
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000122789
diis-c [-5.71010479e-09  9.13874898e-05 -1.27403730e-02 -7.92204736e-02
  1.09186946e+00]
  HOMO = -0.582804770122344  LUMO = 0.871989102513475
  mo_energy =
[-1.18581755e+02 -1.23117791e+01 -9.56197818e+00 -9.56197818e+00
 -9.56197818e+00 -1.26997594e+00 -5.82804770e-01 -5.82804770e-01
 -5.82804770e-01  8.71989103e-01  1.01734167e+00  1.01734167e+00
  1.01734167e+00  7.29829722e+00  7.29829722e+00  7.29829722e+00
  8.02314011e+00  3.34470127e+01  3.34470127e+01  3.34470127e+01
  3.68321959e+01  1.29049461e+02  1.29049461e+02  1.29049461e+02
  1.51780453e+02  4.83411619e+02  4.83411619e+02  4.83411619e+02
  6.41920591e+02  1.33515226e+03  1.33515226e+03  1.33515226e+03
  2.70824109e+03  3.02924388e+03  3.02924388e+03  3.02924388e+03
  6.64957491e+03  6.64957491e+03  6.64957491e+03  9.10987669e+03
  2.54627764e+04  7.62018792e+04]
E1 = -728.2973874416747  E_coul = 201.55062735519104
cycle= 5 E= -526.746760086484  delta_E= -2.25e-09  |g|= 2.15e-05  |ddm|= 0.000179
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.00284e-05
diis-c [-1.04262060e-10  1.36462765e-05 -1.76286136e-03 -1.31715411e-02
  3.59412587e-02  9.78979497e-01]
  HOMO = -0.582812962519184  LUMO = 0.871985347438486
  mo_energy =
[-1.18581788e+02 -1.23118036e+01 -9.56200466e+00 -9.56200466e+00
 -9.56200466e+00 -1.26998251e+00 -5.82812963e-01 -5.82812963e-01
 -5.82812963e-01  8.71985347e-01  1.01733620e+00  1.01733620e+00
  1.01733620e+00  7.29827913e+00  7.29827913e+00  7.29827913e+00
  8.02312388e+00  3.34469870e+01  3.34469870e+01  3.34469870e+01
  3.68321714e+01  1.29049431e+02  1.29049431e+02  1.29049431e+02
  1.51780423e+02  4.83411586e+02  4.83411586e+02  4.83411586e+02
  6.41920558e+02  1.33515222e+03  1.33515222e+03  1.33515222e+03
  2.70824106e+03  3.02924385e+03  3.02924385e+03  3.02924385e+03
  6.64957488e+03  6.64957488e+03  6.64957488e+03  9.10987665e+03
  2.54627764e+04  7.62018791e+04]
E1 = -728.2974742443528  E_coul = 201.5507141578031
cycle= 6 E= -526.74676008655  delta_E= -6.61e-11  |g|= 1.88e-06  |ddm|= 2.04e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2974742443528  E_coul = 201.5507141578031
  HOMO = -0.582812848715665  LUMO = 0.871985771288712
  mo_energy =
[-1.18581787e+02 -1.23118030e+01 -9.56200408e+00 -9.56200408e+00
 -9.56200408e+00 -1.26998197e+00 -5.82812849e-01 -5.82812849e-01
 -5.82812849e-01  8.71985771e-01  1.01733634e+00  1.01733634e+00
  1.01733634e+00  7.29827952e+00  7.29827952e+00  7.29827952e+00
  8.02312442e+00  3.34469877e+01  3.34469877e+01  3.34469877e+01
  3.68321720e+01  1.29049432e+02  1.29049432e+02  1.29049432e+02
  1.51780424e+02  4.83411587e+02  4.83411587e+02  4.83411587e+02
  6.41920559e+02  1.33515222e+03  1.33515222e+03  1.33515222e+03
  2.70824106e+03  3.02924385e+03  3.02924385e+03  3.02924385e+03
  6.64957488e+03  6.64957488e+03  6.64957488e+03  9.10987665e+03
  2.54627764e+04  7.62018791e+04]
E1 = -728.2974711583853  E_coul = 201.55071107183397
Extra cycle  E= -526.746760086551  delta_E= -1.71e-12  |g|= 3.98e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113757.9953869079
E1 = -728.2974711583853  E_coul = 201.55071107183397
init E= -526.746760086551
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.58281292454449  LUMO = 0.871985784325976
  mo_energy =
[-1.18581788e+02 -1.23118032e+01 -9.56200433e+00 -9.56200433e+00
 -9.56200433e+00 -1.26998197e+00 -5.82812925e-01 -5.82812925e-01
 -5.82812925e-01  8.71985784e-01  1.01733630e+00  1.01733630e+00
  1.01733630e+00  7.29827936e+00  7.29827936e+00  7.29827936e+00
  8.02312430e+00  3.34469874e+01  3.34469874e+01  3.34469874e+01
  3.68321718e+01  1.29049432e+02  1.29049432e+02  1.29049432e+02
  1.51780423e+02  4.83411587e+02  4.83411587e+02  4.83411587e+02
  6.41920558e+02  1.33515222e+03  1.33515222e+03  1.33515222e+03
  2.70824106e+03  3.02924385e+03  3.02924385e+03  3.02924385e+03
  6.64957488e+03  6.64957488e+03  6.64957488e+03  9.10987665e+03
  2.54627764e+04  7.62018791e+04]
E1 = -728.297471863912  E_coul = 201.55071177736153
cycle= 1 E= -526.74676008655  delta_E= 9.09e-13  |g|= 9.25e-08  |ddm|= 6.15e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.297471863912  E_coul = 201.55071177736153
  HOMO = -0.582812914540329  LUMO = 0.871985806356247
  mo_energy =
[-1.18581788e+02 -1.23118031e+01 -9.56200428e+00 -9.56200428e+00
 -9.56200428e+00 -1.26998194e+00 -5.82812915e-01 -5.82812915e-01
 -5.82812915e-01  8.71985806e-01  1.01733631e+00  1.01733631e+00
  1.01733631e+00  7.29827939e+00  7.29827939e+00  7.29827939e+00
  8.02312434e+00  3.34469875e+01  3.34469875e+01  3.34469875e+01
  3.68321719e+01  1.29049432e+02  1.29049432e+02  1.29049432e+02
  1.51780423e+02  4.83411587e+02  4.83411587e+02  4.83411587e+02
  6.41920558e+02  1.33515222e+03  1.33515222e+03  1.33515222e+03
  2.70824106e+03  3.02924385e+03  3.02924385e+03  3.02924385e+03
  6.64957488e+03  6.64957488e+03  6.64957488e+03  9.10987665e+03
  2.54627764e+04  7.62018791e+04]
E1 = -728.2974716318321  E_coul = 201.5507115452814
Extra cycle  E= -526.746760086551  delta_E= -2.27e-13  |g|= 2.03e-08  |ddm|= 1.41e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61826596e+04 7.61751386e+03 3.61735494e+03 1.59766118e+03
 3.82623972e+02 1.11269511e+02 3.80403640e+01 1.25717217e+01
 5.86891319e+00 6.32422732e-01 2.64624659e+00 2.25952441e-01
 1.36278448e+03 6.64733126e+02 3.00902779e+02 3.13991221e+02
 6.16625822e+01 7.33408231e+00 2.02415132e+01 7.75396294e-01
 2.82072891e+00 2.23500449e-01]
grad_E = [-1.53409296e-06  3.49203097e-06 -1.47297948e-06  7.59230038e-05
 -1.46771170e-04 -7.67667464e-04 -8.25453824e-04  1.66511796e-04
 -7.05968041e-04 -6.04659684e-04  2.64946160e-03 -5.95753534e-04
 -5.07719527e-07  5.00055143e-06  2.35969118e-05  2.03402269e-05
 -3.17112432e-05 -9.43879814e-04  2.13352668e-04 -6.85496690e-03
  1.58008744e-03  2.51398630e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:28 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6597292        1
[INPUT] 0    0    [1    /1   ]  7617.51366202        1
[INPUT] 0    0    [1    /1   ]  3617.35503722        1
[INPUT] 0    0    [1    /1   ]  1597.65719667        1
[INPUT] 0    0    [1    /1   ]  382.619761292        1
[INPUT] 0    0    [1    /1   ]  111.341933943        1
[INPUT] 0    0    [1    /1   ]  38.1136907426        1
[INPUT] 0    0    [1    /1   ]  12.6399356713        1
[INPUT] 0    0    [1    /1   ]  6.04165003244        1
[INPUT] 0    0    [1    /1   ]  0.634566989063       1
[INPUT] 0    0    [1    /1   ]  2.70613810578        1
[INPUT] 0    0    [1    /1   ]  0.227746128973       1
[INPUT] 1    0    [1    /1   ]  1362.7845077         1
[INPUT] 1    0    [1    /1   ]  664.732825706        1
[INPUT] 1    0    [1    /1   ]  300.901364292        1
[INPUT] 1    0    [1    /1   ]  313.990001759        1
[INPUT] 1    0    [1    /1   ]  61.6635570082        1
[INPUT] 1    0    [1    /1   ]  7.33509345445        1
[INPUT] 1    0    [1    /1   ]  20.2412808042        1
[INPUT] 1    0    [1    /1   ]  0.775542129814       1
[INPUT] 1    0    [1    /1   ]  2.82017620031        1
[INPUT] 1    0    [1    /1   ]  0.22292642063        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65972917837, 1.0]], [0, [7617.513662020779, 1.0]], [0, [3617.3550372246636, 1.0]], [0, [1597.6571966719023, 1.0]], [0, [382.6197612924077, 1.0]], [0, [111.34193394319284, 1.0]], [0, [38.113690742576765, 1.0]], [0, [12.639935671347537, 1.0]], [0, [6.041650032438077, 1.0]], [0, [0.6345669890633633, 1.0]], [0, [2.7061381057750467, 1.0]], [0, [0.22774612897303104, 1.0]], [1, [1362.7845076976234, 1.0]], [1, [664.7328257057702, 1.0]], [1, [300.9013642923085, 1.0]], [1, [313.99000175918286, 1.0]], [1, [61.66355700815391, 1.0]], [1, [7.335093454451733, 1.0]], [1, [20.241280804178718, 1.0]], [1, [0.7755421298140889, 1.0]], [1, [2.820176200306615, 1.0]], [1, [0.22292642063039989, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65972918]
bas 1, expnt(s) = [7617.51366202]
bas 2, expnt(s) = [3617.35503722]
bas 3, expnt(s) = [1597.65719667]
bas 4, expnt(s) = [382.61976129]
bas 5, expnt(s) = [111.34193394]
bas 6, expnt(s) = [38.11369074]
bas 7, expnt(s) = [12.63993567]
bas 8, expnt(s) = [6.04165003]
bas 9, expnt(s) = [0.63456699]
bas 10, expnt(s) = [2.70613811]
bas 11, expnt(s) = [0.22774613]
bas 12, expnt(s) = [1362.7845077]
bas 13, expnt(s) = [664.73282571]
bas 14, expnt(s) = [300.90136429]
bas 15, expnt(s) = [313.99000176]
bas 16, expnt(s) = [61.66355701]
bas 17, expnt(s) = [7.33509345]
bas 18, expnt(s) = [20.2412808]
bas 19, expnt(s) = [0.77554213]
bas 20, expnt(s) = [2.8201762]
bas 21, expnt(s) = [0.22292642]
CPU time:       238.72
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826597e+04 5.20026344e+03 7.61751366e+03 2.06003669e+03
 3.61735504e+03 1.17844244e+03 1.59765720e+03 6.38451225e+02
 3.82619761e+02 2.18570010e+02 1.11341934e+02 8.65982458e+01
 3.81136907e+01 3.87548249e+01 1.26399357e+01 1.69365002e+01
 6.04165003e+00 9.73602539e+00 6.34566989e-01 1.79627626e+00
 2.70613811e+00 5.33061714e+00 2.27746129e-01 8.32919975e-01
 1.36278451e+03 2.41556305e+04 6.64732826e+02 9.84675879e+03
 3.00901364e+02 3.65607073e+03 3.13990002e+02 3.85593023e+03
 6.16635570e+01 5.04103960e+02 7.33509345e+00 3.52161161e+01
 2.02412808e+01 1.25251195e+02 7.75542130e-01 2.12320113e+00
 2.82017620e+00 1.06617795e+01 2.22926421e-01 4.46875270e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99379568546904
cond(S) = 113967.45536244607
E1 = -729.5371362893926  E_coul = 203.17440926334163
init E= -526.362727026051
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555780384310327  LUMO = 0.90083579265142
  mo_energy =
[-1.18331011e+02 -1.22068013e+01 -9.44725727e+00 -9.44725727e+00
 -9.44725727e+00 -1.24027499e+00 -5.55780384e-01 -5.55780384e-01
 -5.55780384e-01  9.00835793e-01  1.03374489e+00  1.03374489e+00
  1.03374489e+00  7.36639053e+00  7.36639053e+00  7.36639053e+00
  8.31686257e+00  3.35663650e+01  3.35663650e+01  3.35663650e+01
  3.77763417e+01  1.29231576e+02  1.29231576e+02  1.29231576e+02
  1.53365418e+02  4.83664008e+02  4.83664008e+02  4.83664008e+02
  6.43840271e+02  1.33545572e+03  1.33545572e+03  1.33545572e+03
  2.71023825e+03  3.02960816e+03  3.02960816e+03  3.02960816e+03
  6.65004885e+03  6.65004885e+03  6.65004885e+03  9.11188067e+03
  2.54647966e+04  7.62038952e+04]
E1 = -727.8436273215154  E_coul = 201.09759571832794
cycle= 1 E= -526.746031603187  delta_E= -0.383  |g|= 0.187  |ddm|= 0.315
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.556539
diis-c [-0.30973554  1.        ]
  HOMO = -0.590707217861872  LUMO = 0.876095561319201
  mo_energy =
[-1.18640228e+02 -1.23445711e+01 -9.59606629e+00 -9.59606629e+00
 -9.59606629e+00 -1.27959934e+00 -5.90707218e-01 -5.90707218e-01
 -5.90707218e-01  8.76095561e-01  1.00936289e+00  1.00936289e+00
  1.00936289e+00  7.27550414e+00  7.27550414e+00  7.27550414e+00
  8.23154901e+00  3.34116906e+01  3.34116906e+01  3.34116906e+01
  3.76344072e+01  1.29002375e+02  1.29002375e+02  1.29002375e+02
  1.53138824e+02  4.83355899e+02  4.83355899e+02  4.83355899e+02
  6.43494790e+02  1.33509077e+03  1.33509077e+03  1.33509077e+03
  2.70973952e+03  3.02917686e+03  3.02917686e+03  3.02917686e+03
  6.64950391e+03  6.64950391e+03  6.64950391e+03  9.11126074e+03
  2.54640821e+04  7.62030903e+04]
E1 = -728.4193725316021  E_coul = 201.67261443593426
cycle= 2 E= -526.746758095668  delta_E= -0.000726  |g|= 0.0379  |ddm|= 0.0527
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0768419
diis-c [-0.00354671  0.08067575  0.91932425]
  HOMO = -0.581583370238458  LUMO = 0.883301580509362
  mo_energy =
[-1.18572083e+02 -1.23063337e+01 -9.55615768e+00 -9.55615768e+00
 -9.55615768e+00 -1.26867158e+00 -5.81583370e-01 -5.81583370e-01
 -5.81583370e-01  8.83301581e-01  1.01610680e+00  1.01610680e+00
  1.01610680e+00  7.29936128e+00  7.29936128e+00  7.29936128e+00
  8.25490875e+00  3.34519660e+01  3.34519660e+01  3.34519660e+01
  3.76729283e+01  1.29058615e+02  1.29058615e+02  1.29058615e+02
  1.53195487e+02  4.83423226e+02  4.83423226e+02  4.83423226e+02
  6.43564223e+02  1.33516218e+03  1.33516218e+03  1.33516218e+03
  2.70981418e+03  3.02925052e+03  3.02925052e+03  3.02925052e+03
  6.64957931e+03  6.64957931e+03  6.64957931e+03  9.11133695e+03
  2.54641589e+04  7.62031674e+04]
E1 = -728.2680388817951  E_coul = 201.52122138853878
cycle= 3 E= -526.746817493256  delta_E= -5.94e-05  |g|= 0.00641  |ddm|= 0.0159
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135774
diis-c [-8.08094105e-07 -1.29047669e-03  1.45575237e-01  8.55715239e-01]
  HOMO = -0.583109945793481  LUMO = 0.882189372346368
  mo_energy =
[-1.18582242e+02 -1.23122517e+01 -9.56243199e+00 -9.56243199e+00
 -9.56243199e+00 -1.27038793e+00 -5.83109946e-01 -5.83109946e-01
 -5.83109946e-01  8.82189372e-01  1.01500431e+00  1.01500431e+00
  1.01500431e+00  7.29551041e+00  7.29551041e+00  7.29551041e+00
  8.25121494e+00  3.34456741e+01  3.34456741e+01  3.34456741e+01
  3.76669533e+01  1.29050101e+02  1.29050101e+02  1.29050101e+02
  1.53186945e+02  4.83413185e+02  4.83413185e+02  4.83413185e+02
  6.43553852e+02  1.33515153e+03  1.33515153e+03  1.33515153e+03
  2.70980290e+03  3.02923948e+03  3.02923948e+03  3.02923948e+03
  6.64956787e+03  6.64956787e+03  6.64956787e+03  9.11132529e+03
  2.54641471e+04  7.62031554e+04]
E1 = -728.2912626558937  E_coul = 201.5444431685755
cycle= 4 E= -526.746819487318  delta_E= -1.99e-06  |g|= 0.000106  |ddm|= 0.00226
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119861
diis-c [-5.51239523e-09  8.87586658e-05 -1.24144688e-02 -7.71255506e-02
  1.08945126e+00]
  HOMO = -0.583090486144942  LUMO = 0.882222754020062
  mo_energy =
[-1.18582191e+02 -1.23121798e+01 -9.56237415e+00 -9.56237415e+00
 -9.56237415e+00 -1.27034341e+00 -5.83090486e-01 -5.83090486e-01
 -5.83090486e-01  8.82222754e-01  1.01502121e+00  1.01502121e+00
  1.01502121e+00  7.29555618e+00  7.29555618e+00  7.29555618e+00
  8.25127417e+00  3.34457300e+01  3.34457300e+01  3.34457300e+01
  3.76670171e+01  1.29050158e+02  1.29050158e+02  1.29050158e+02
  1.53187004e+02  4.83413236e+02  4.83413236e+02  4.83413236e+02
  6.43553896e+02  1.33515157e+03  1.33515157e+03  1.33515157e+03
  2.70980292e+03  3.02923951e+03  3.02923951e+03  3.02923951e+03
  6.64956789e+03  6.64956789e+03  6.64956789e+03  9.11132530e+03
  2.54641471e+04  7.62031554e+04]
E1 = -728.2910140673957  E_coul = 201.54419457799298
cycle= 5 E= -526.746819489403  delta_E= -2.08e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.95408e-05
diis-c [-9.94556492e-11  1.34842117e-05 -1.75010609e-03 -1.30452667e-02
  3.75370024e-02  9.77244886e-01]
  HOMO = -0.58309853868381  LUMO = 0.882218975980038
  mo_energy =
[-1.18582223e+02 -1.23122040e+01 -9.56240023e+00 -9.56240023e+00
 -9.56240023e+00 -1.27034991e+00 -5.83098539e-01 -5.83098539e-01
 -5.83098539e-01  8.82218976e-01  1.01501584e+00  1.01501584e+00
  1.01501584e+00  7.29553836e+00  7.29553836e+00  7.29553836e+00
  8.25125797e+00  3.34457047e+01  3.34457047e+01  3.34457047e+01
  3.76669930e+01  1.29050128e+02  1.29050128e+02  1.29050128e+02
  1.53186975e+02  4.83413204e+02  4.83413204e+02  4.83413204e+02
  6.43553863e+02  1.33515154e+03  1.33515154e+03  1.33515154e+03
  2.70980288e+03  3.02923947e+03  3.02923947e+03  3.02923947e+03
  6.64956786e+03  6.64956786e+03  6.64956786e+03  9.11132527e+03
  2.54641470e+04  7.62031554e+04]
E1 = -728.2910999145423  E_coul = 201.54428042507737
cycle= 6 E= -526.746819489465  delta_E= -6.23e-11  |g|= 1.86e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2910999145423  E_coul = 201.54428042507737
  HOMO = -0.583098440411555  LUMO = 0.882219390609563
  mo_energy =
[-1.18582222e+02 -1.23122034e+01 -9.56239971e+00 -9.56239971e+00
 -9.56239971e+00 -1.27034939e+00 -5.83098440e-01 -5.83098440e-01
 -5.83098440e-01  8.82219391e-01  1.01501597e+00  1.01501597e+00
  1.01501597e+00  7.29553871e+00  7.29553871e+00  7.29553871e+00
  8.25125847e+00  3.34457053e+01  3.34457053e+01  3.34457053e+01
  3.76669935e+01  1.29050129e+02  1.29050129e+02  1.29050129e+02
  1.53186976e+02  4.83413205e+02  4.83413205e+02  4.83413205e+02
  6.43553864e+02  1.33515154e+03  1.33515154e+03  1.33515154e+03
  2.70980289e+03  3.02923947e+03  3.02923947e+03  3.02923947e+03
  6.64956786e+03  6.64956786e+03  6.64956786e+03  9.11132527e+03
  2.54641471e+04  7.62031554e+04]
E1 = -728.2910970803771  E_coul = 201.54427759091152
Extra cycle  E= -526.746819489466  delta_E= -5.68e-13  |g|= 3.92e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826597e+04 7.61751366e+03 3.61735504e+03 1.59765720e+03
 3.82619761e+02 1.11341934e+02 3.81136907e+01 1.26399357e+01
 6.04165003e+00 6.34566989e-01 2.70613811e+00 2.27746129e-01
 1.36278451e+03 6.64732826e+02 3.00901364e+02 3.13990002e+02
 6.16635570e+01 7.33509345e+00 2.02412808e+01 7.75542130e-01
 2.82017620e+00 2.22926421e-01]
E = -526.7468194894656
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:29 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6597292        1
[INPUT] 0    0    [1    /1   ]  7617.51366202        1
[INPUT] 0    0    [1    /1   ]  3617.35503722        1
[INPUT] 0    0    [1    /1   ]  1597.65719667        1
[INPUT] 0    0    [1    /1   ]  382.619761292        1
[INPUT] 0    0    [1    /1   ]  111.341933943        1
[INPUT] 0    0    [1    /1   ]  38.1136907426        1
[INPUT] 0    0    [1    /1   ]  12.6399356713        1
[INPUT] 0    0    [1    /1   ]  6.04165003244        1
[INPUT] 0    0    [1    /1   ]  0.634566989063       1
[INPUT] 0    0    [1    /1   ]  2.70613810578        1
[INPUT] 0    0    [1    /1   ]  0.227746128973       1
[INPUT] 1    0    [1    /1   ]  1362.7845077         1
[INPUT] 1    0    [1    /1   ]  664.732825706        1
[INPUT] 1    0    [1    /1   ]  300.901364292        1
[INPUT] 1    0    [1    /1   ]  313.990001759        1
[INPUT] 1    0    [1    /1   ]  61.6635570082        1
[INPUT] 1    0    [1    /1   ]  7.33509345445        1
[INPUT] 1    0    [1    /1   ]  20.2412808042        1
[INPUT] 1    0    [1    /1   ]  0.775542129814       1
[INPUT] 1    0    [1    /1   ]  2.82017620031        1
[INPUT] 1    0    [1    /1   ]  0.22292642063        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.65972917837, 1.0]], [0, [7617.513662020779, 1.0]], [0, [3617.3550372246636, 1.0]], [0, [1597.6571966719023, 1.0]], [0, [382.6197612924077, 1.0]], [0, [111.34193394319284, 1.0]], [0, [38.113690742576765, 1.0]], [0, [12.639935671347537, 1.0]], [0, [6.041650032438077, 1.0]], [0, [0.6345669890633633, 1.0]], [0, [2.7061381057750467, 1.0]], [0, [0.22774612897303104, 1.0]], [1, [1362.7845076976234, 1.0]], [1, [664.7328257057702, 1.0]], [1, [300.9013642923085, 1.0]], [1, [313.99000175918286, 1.0]], [1, [61.66355700815391, 1.0]], [1, [7.335093454451733, 1.0]], [1, [20.241280804178718, 1.0]], [1, [0.7755421298140889, 1.0]], [1, [2.820176200306615, 1.0]], [1, [0.22292642063039989, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65972918]
bas 1, expnt(s) = [7617.51366202]
bas 2, expnt(s) = [3617.35503722]
bas 3, expnt(s) = [1597.65719667]
bas 4, expnt(s) = [382.61976129]
bas 5, expnt(s) = [111.34193394]
bas 6, expnt(s) = [38.11369074]
bas 7, expnt(s) = [12.63993567]
bas 8, expnt(s) = [6.04165003]
bas 9, expnt(s) = [0.63456699]
bas 10, expnt(s) = [2.70613811]
bas 11, expnt(s) = [0.22774613]
bas 12, expnt(s) = [1362.7845077]
bas 13, expnt(s) = [664.73282571]
bas 14, expnt(s) = [300.90136429]
bas 15, expnt(s) = [313.99000176]
bas 16, expnt(s) = [61.66355701]
bas 17, expnt(s) = [7.33509345]
bas 18, expnt(s) = [20.2412808]
bas 19, expnt(s) = [0.77554213]
bas 20, expnt(s) = [2.8201762]
bas 21, expnt(s) = [0.22292642]
CPU time:       239.12
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826597e+04 5.20026344e+03 7.61751366e+03 2.06003669e+03
 3.61735504e+03 1.17844244e+03 1.59765720e+03 6.38451225e+02
 3.82619761e+02 2.18570010e+02 1.11341934e+02 8.65982458e+01
 3.81136907e+01 3.87548249e+01 1.26399357e+01 1.69365002e+01
 6.04165003e+00 9.73602539e+00 6.34566989e-01 1.79627626e+00
 2.70613811e+00 5.33061714e+00 2.27746129e-01 8.32919975e-01
 1.36278451e+03 2.41556305e+04 6.64732826e+02 9.84675879e+03
 3.00901364e+02 3.65607073e+03 3.13990002e+02 3.85593023e+03
 6.16635570e+01 5.04103960e+02 7.33509345e+00 3.52161161e+01
 2.02412808e+01 1.25251195e+02 7.75542130e-01 2.12320113e+00
 2.82017620e+00 1.06617795e+01 2.22926421e-01 4.46875270e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99379568546904
cond(S) = 113967.45536244607
E1 = -729.5371362893926  E_coul = 203.17440926334163
init E= -526.362727026051
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555780384310327  LUMO = 0.90083579265142
  mo_energy =
[-1.18331011e+02 -1.22068013e+01 -9.44725727e+00 -9.44725727e+00
 -9.44725727e+00 -1.24027499e+00 -5.55780384e-01 -5.55780384e-01
 -5.55780384e-01  9.00835793e-01  1.03374489e+00  1.03374489e+00
  1.03374489e+00  7.36639053e+00  7.36639053e+00  7.36639053e+00
  8.31686257e+00  3.35663650e+01  3.35663650e+01  3.35663650e+01
  3.77763417e+01  1.29231576e+02  1.29231576e+02  1.29231576e+02
  1.53365418e+02  4.83664008e+02  4.83664008e+02  4.83664008e+02
  6.43840271e+02  1.33545572e+03  1.33545572e+03  1.33545572e+03
  2.71023825e+03  3.02960816e+03  3.02960816e+03  3.02960816e+03
  6.65004885e+03  6.65004885e+03  6.65004885e+03  9.11188067e+03
  2.54647966e+04  7.62038952e+04]
E1 = -727.8436273215154  E_coul = 201.09759571832794
cycle= 1 E= -526.746031603187  delta_E= -0.383  |g|= 0.187  |ddm|= 0.315
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.556539
diis-c [-0.30973554  1.        ]
  HOMO = -0.590707217861872  LUMO = 0.876095561319201
  mo_energy =
[-1.18640228e+02 -1.23445711e+01 -9.59606629e+00 -9.59606629e+00
 -9.59606629e+00 -1.27959934e+00 -5.90707218e-01 -5.90707218e-01
 -5.90707218e-01  8.76095561e-01  1.00936289e+00  1.00936289e+00
  1.00936289e+00  7.27550414e+00  7.27550414e+00  7.27550414e+00
  8.23154901e+00  3.34116906e+01  3.34116906e+01  3.34116906e+01
  3.76344072e+01  1.29002375e+02  1.29002375e+02  1.29002375e+02
  1.53138824e+02  4.83355899e+02  4.83355899e+02  4.83355899e+02
  6.43494790e+02  1.33509077e+03  1.33509077e+03  1.33509077e+03
  2.70973952e+03  3.02917686e+03  3.02917686e+03  3.02917686e+03
  6.64950391e+03  6.64950391e+03  6.64950391e+03  9.11126074e+03
  2.54640821e+04  7.62030903e+04]
E1 = -728.4193725316021  E_coul = 201.67261443593426
cycle= 2 E= -526.746758095668  delta_E= -0.000726  |g|= 0.0379  |ddm|= 0.0527
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0768419
diis-c [-0.00354671  0.08067575  0.91932425]
  HOMO = -0.581583370238458  LUMO = 0.883301580509362
  mo_energy =
[-1.18572083e+02 -1.23063337e+01 -9.55615768e+00 -9.55615768e+00
 -9.55615768e+00 -1.26867158e+00 -5.81583370e-01 -5.81583370e-01
 -5.81583370e-01  8.83301581e-01  1.01610680e+00  1.01610680e+00
  1.01610680e+00  7.29936128e+00  7.29936128e+00  7.29936128e+00
  8.25490875e+00  3.34519660e+01  3.34519660e+01  3.34519660e+01
  3.76729283e+01  1.29058615e+02  1.29058615e+02  1.29058615e+02
  1.53195487e+02  4.83423226e+02  4.83423226e+02  4.83423226e+02
  6.43564223e+02  1.33516218e+03  1.33516218e+03  1.33516218e+03
  2.70981418e+03  3.02925052e+03  3.02925052e+03  3.02925052e+03
  6.64957931e+03  6.64957931e+03  6.64957931e+03  9.11133695e+03
  2.54641589e+04  7.62031674e+04]
E1 = -728.2680388817951  E_coul = 201.52122138853878
cycle= 3 E= -526.746817493256  delta_E= -5.94e-05  |g|= 0.00641  |ddm|= 0.0159
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0135774
diis-c [-8.08094105e-07 -1.29047669e-03  1.45575237e-01  8.55715239e-01]
  HOMO = -0.583109945793481  LUMO = 0.882189372346368
  mo_energy =
[-1.18582242e+02 -1.23122517e+01 -9.56243199e+00 -9.56243199e+00
 -9.56243199e+00 -1.27038793e+00 -5.83109946e-01 -5.83109946e-01
 -5.83109946e-01  8.82189372e-01  1.01500431e+00  1.01500431e+00
  1.01500431e+00  7.29551041e+00  7.29551041e+00  7.29551041e+00
  8.25121494e+00  3.34456741e+01  3.34456741e+01  3.34456741e+01
  3.76669533e+01  1.29050101e+02  1.29050101e+02  1.29050101e+02
  1.53186945e+02  4.83413185e+02  4.83413185e+02  4.83413185e+02
  6.43553852e+02  1.33515153e+03  1.33515153e+03  1.33515153e+03
  2.70980290e+03  3.02923948e+03  3.02923948e+03  3.02923948e+03
  6.64956787e+03  6.64956787e+03  6.64956787e+03  9.11132529e+03
  2.54641471e+04  7.62031554e+04]
E1 = -728.2912626558937  E_coul = 201.5444431685755
cycle= 4 E= -526.746819487318  delta_E= -1.99e-06  |g|= 0.000106  |ddm|= 0.00226
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119861
diis-c [-5.51239523e-09  8.87586658e-05 -1.24144688e-02 -7.71255506e-02
  1.08945126e+00]
  HOMO = -0.583090486144942  LUMO = 0.882222754020062
  mo_energy =
[-1.18582191e+02 -1.23121798e+01 -9.56237415e+00 -9.56237415e+00
 -9.56237415e+00 -1.27034341e+00 -5.83090486e-01 -5.83090486e-01
 -5.83090486e-01  8.82222754e-01  1.01502121e+00  1.01502121e+00
  1.01502121e+00  7.29555618e+00  7.29555618e+00  7.29555618e+00
  8.25127417e+00  3.34457300e+01  3.34457300e+01  3.34457300e+01
  3.76670171e+01  1.29050158e+02  1.29050158e+02  1.29050158e+02
  1.53187004e+02  4.83413236e+02  4.83413236e+02  4.83413236e+02
  6.43553896e+02  1.33515157e+03  1.33515157e+03  1.33515157e+03
  2.70980292e+03  3.02923951e+03  3.02923951e+03  3.02923951e+03
  6.64956789e+03  6.64956789e+03  6.64956789e+03  9.11132530e+03
  2.54641471e+04  7.62031554e+04]
E1 = -728.2910140673957  E_coul = 201.54419457799298
cycle= 5 E= -526.746819489403  delta_E= -2.08e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.95408e-05
diis-c [-9.94556492e-11  1.34842117e-05 -1.75010609e-03 -1.30452667e-02
  3.75370024e-02  9.77244886e-01]
  HOMO = -0.58309853868381  LUMO = 0.882218975980038
  mo_energy =
[-1.18582223e+02 -1.23122040e+01 -9.56240023e+00 -9.56240023e+00
 -9.56240023e+00 -1.27034991e+00 -5.83098539e-01 -5.83098539e-01
 -5.83098539e-01  8.82218976e-01  1.01501584e+00  1.01501584e+00
  1.01501584e+00  7.29553836e+00  7.29553836e+00  7.29553836e+00
  8.25125797e+00  3.34457047e+01  3.34457047e+01  3.34457047e+01
  3.76669930e+01  1.29050128e+02  1.29050128e+02  1.29050128e+02
  1.53186975e+02  4.83413204e+02  4.83413204e+02  4.83413204e+02
  6.43553863e+02  1.33515154e+03  1.33515154e+03  1.33515154e+03
  2.70980288e+03  3.02923947e+03  3.02923947e+03  3.02923947e+03
  6.64956786e+03  6.64956786e+03  6.64956786e+03  9.11132527e+03
  2.54641470e+04  7.62031554e+04]
E1 = -728.2910999145423  E_coul = 201.54428042507737
cycle= 6 E= -526.746819489465  delta_E= -6.23e-11  |g|= 1.86e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2910999145423  E_coul = 201.54428042507737
  HOMO = -0.583098440411555  LUMO = 0.882219390609563
  mo_energy =
[-1.18582222e+02 -1.23122034e+01 -9.56239971e+00 -9.56239971e+00
 -9.56239971e+00 -1.27034939e+00 -5.83098440e-01 -5.83098440e-01
 -5.83098440e-01  8.82219391e-01  1.01501597e+00  1.01501597e+00
  1.01501597e+00  7.29553871e+00  7.29553871e+00  7.29553871e+00
  8.25125847e+00  3.34457053e+01  3.34457053e+01  3.34457053e+01
  3.76669935e+01  1.29050129e+02  1.29050129e+02  1.29050129e+02
  1.53186976e+02  4.83413205e+02  4.83413205e+02  4.83413205e+02
  6.43553864e+02  1.33515154e+03  1.33515154e+03  1.33515154e+03
  2.70980289e+03  3.02923947e+03  3.02923947e+03  3.02923947e+03
  6.64956786e+03  6.64956786e+03  6.64956786e+03  9.11132527e+03
  2.54641471e+04  7.62031554e+04]
E1 = -728.2910970803771  E_coul = 201.54427759091152
Extra cycle  E= -526.746819489466  delta_E= -5.68e-13  |g|= 3.92e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113967.45536244607
E1 = -728.2910970803771  E_coul = 201.54427759091152
init E= -526.746819489466
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583098510995067  LUMO = 0.882219407197568
  mo_energy =
[-1.18582223e+02 -1.23122036e+01 -9.56239994e+00 -9.56239994e+00
 -9.56239994e+00 -1.27034938e+00 -5.83098511e-01 -5.83098511e-01
 -5.83098511e-01  8.82219407e-01  1.01501593e+00  1.01501593e+00
  1.01501593e+00  7.29553856e+00  7.29553856e+00  7.29553856e+00
  8.25125837e+00  3.34457051e+01  3.34457051e+01  3.34457051e+01
  3.76669933e+01  1.29050129e+02  1.29050129e+02  1.29050129e+02
  1.53186975e+02  4.83413204e+02  4.83413204e+02  4.83413204e+02
  6.43553864e+02  1.33515154e+03  1.33515154e+03  1.33515154e+03
  2.70980288e+03  3.02923947e+03  3.02923947e+03  3.02923947e+03
  6.64956786e+03  6.64956786e+03  6.64956786e+03  9.11132527e+03
  2.54641470e+04  7.62031554e+04]
E1 = -728.2910977210718  E_coul = 201.54427823160586
cycle= 1 E= -526.746819489466  delta_E= -3.41e-13  |g|= 9.01e-08  |ddm|= 6.13e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2910977210718  E_coul = 201.54427823160586
  HOMO = -0.583098502110026  LUMO = 0.882219428504027
  mo_energy =
[-1.18582223e+02 -1.23122035e+01 -9.56239989e+00 -9.56239989e+00
 -9.56239989e+00 -1.27034936e+00 -5.83098502e-01 -5.83098502e-01
 -5.83098502e-01  8.82219429e-01  1.01501594e+00  1.01501594e+00
  1.01501594e+00  7.29553859e+00  7.29553859e+00  7.29553859e+00
  8.25125840e+00  3.34457051e+01  3.34457051e+01  3.34457051e+01
  3.76669934e+01  1.29050129e+02  1.29050129e+02  1.29050129e+02
  1.53186975e+02  4.83413204e+02  4.83413204e+02  4.83413204e+02
  6.43553864e+02  1.33515154e+03  1.33515154e+03  1.33515154e+03
  2.70980288e+03  3.02923947e+03  3.02923947e+03  3.02923947e+03
  6.64956786e+03  6.64956786e+03  6.64956786e+03  9.11132527e+03
  2.54641470e+04  7.62031554e+04]
E1 = -728.2910975080705  E_coul = 201.54427801860464
Extra cycle  E= -526.746819489466  delta_E=    0  |g|= 1.95e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.46 sec
exp = [2.61826597e+04 7.61751366e+03 3.61735504e+03 1.59765720e+03
 3.82619761e+02 1.11341934e+02 3.81136907e+01 1.26399357e+01
 6.04165003e+00 6.34566989e-01 2.70613811e+00 2.27746129e-01
 1.36278451e+03 6.64732826e+02 3.00901364e+02 3.13990002e+02
 6.16635570e+01 7.33509345e+00 2.02412808e+01 7.75542130e-01
 2.82017620e+00 2.22926421e-01]
grad_E = [-1.53459870e-06  3.49783378e-06 -1.46913005e-06  7.61369923e-05
 -1.51439028e-04 -7.53566022e-04 -8.47619733e-04  1.26664896e-04
 -4.12531580e-04 -1.14367670e-03  2.55316975e-03  1.68504449e-03
 -5.08364380e-07  4.99218026e-06  2.35466014e-05  2.02968610e-05
 -2.63800232e-05 -8.15250203e-04  1.67114829e-04 -2.48309014e-03
  1.33936102e-03  9.19919616e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:33 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6597839        1
[INPUT] 0    0    [1    /1   ]  7617.51354515        1
[INPUT] 0    0    [1    /1   ]  3617.35509579        1
[INPUT] 0    0    [1    /1   ]  1597.65480525        1
[INPUT] 0    0    [1    /1   ]  382.616527449        1
[INPUT] 0    0    [1    /1   ]  111.393708984        1
[INPUT] 0    0    [1    /1   ]  38.1381318085        1
[INPUT] 0    0    [1    /1   ]  12.6703069369        1
[INPUT] 0    0    [1    /1   ]  6.14394997245        1
[INPUT] 0    0    [1    /1   ]  0.632422747913       1
[INPUT] 0    0    [1    /1   ]  2.73167408087        1
[INPUT] 0    0    [1    /1   ]  0.226881757275       1
[INPUT] 1    0    [1    /1   ]  1362.78452609        1
[INPUT] 1    0    [1    /1   ]  664.732644765        1
[INPUT] 1    0    [1    /1   ]  300.900511407        1
[INPUT] 1    0    [1    /1   ]  313.989266422        1
[INPUT] 1    0    [1    /1   ]  61.6639421987        1
[INPUT] 1    0    [1    /1   ]  7.3348584946         1
[INPUT] 1    0    [1    /1   ]  20.2423373123        1
[INPUT] 1    0    [1    /1   ]  0.775454896018       1
[INPUT] 1    0    [1    /1   ]  2.81691170002        1
[INPUT] 1    0    [1    /1   ]  0.222499940015       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659783871288, 1.0]], [0, [7617.513545145713, 1.0]], [0, [3617.355095785129, 1.0]], [0, [1597.6548052494825, 1.0]], [0, [382.61652744897697, 1.0]], [0, [111.3937089842734, 1.0]], [0, [38.13813180852627, 1.0]], [0, [12.670306936926687, 1.0]], [0, [6.143949972445521, 1.0]], [0, [0.632422747913162, 1.0]], [0, [2.731674080865931, 1.0]], [0, [0.22688175727497853, 1.0]], [1, [1362.784526088383, 1.0]], [1, [664.7326447650197, 1.0]], [1, [300.90051140697534, 1.0]], [1, [313.98926642221056, 1.0]], [1, [61.66394219872078, 1.0]], [1, [7.33485849459641, 1.0]], [1, [20.24233731230504, 1.0]], [1, [0.7754548960184977, 1.0]], [1, [2.8169117000161457, 1.0]], [1, [0.22249994001520015, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65978387]
bas 1, expnt(s) = [7617.51354515]
bas 2, expnt(s) = [3617.35509579]
bas 3, expnt(s) = [1597.65480525]
bas 4, expnt(s) = [382.61652745]
bas 5, expnt(s) = [111.39370898]
bas 6, expnt(s) = [38.13813181]
bas 7, expnt(s) = [12.67030694]
bas 8, expnt(s) = [6.14394997]
bas 9, expnt(s) = [0.63242275]
bas 10, expnt(s) = [2.73167408]
bas 11, expnt(s) = [0.22688176]
bas 12, expnt(s) = [1362.78452609]
bas 13, expnt(s) = [664.73264477]
bas 14, expnt(s) = [300.90051141]
bas 15, expnt(s) = [313.98926642]
bas 16, expnt(s) = [61.6639422]
bas 17, expnt(s) = [7.33485849]
bas 18, expnt(s) = [20.24233731]
bas 19, expnt(s) = [0.7754549]
bas 20, expnt(s) = [2.8169117]
bas 21, expnt(s) = [0.22249994]
CPU time:       244.85
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826598e+04 5.20026345e+03 7.61751355e+03 2.06003667e+03
 3.61735510e+03 1.17844246e+03 1.59765481e+03 6.38450508e+02
 3.82616527e+02 2.18568624e+02 1.11393709e+02 8.66284458e+01
 3.81381318e+01 3.87734625e+01 1.26703069e+01 1.69670124e+01
 6.14394997e+00 9.85940660e+00 6.32422748e-01 1.79172204e+00
 2.73167408e+00 5.36829886e+00 2.26881757e-01 8.30547943e-01
 1.36278453e+03 2.41556309e+04 6.64732645e+02 9.84675544e+03
 3.00900511e+02 3.65605777e+03 3.13989266e+02 3.85591894e+03
 6.16639422e+01 5.04107896e+02 7.33485849e+00 3.52147060e+01
 2.02423373e+01 1.25259368e+02 7.75454896e-01 2.12290261e+00
 2.81691170e+00 1.06463548e+01 2.22499940e-01 4.45806879e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993834978800546
cond(S) = 114034.67343609793
E1 = -729.5373581821897  E_coul = 203.17445112087944
init E= -526.36290706131
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555804413216234  LUMO = 0.896716500874224
  mo_energy =
[-1.18331019e+02 -1.22067674e+01 -9.44723678e+00 -9.44723678e+00
 -9.44723678e+00 -1.24029074e+00 -5.55804413e-01 -5.55804413e-01
 -5.55804413e-01  8.96716501e-01  1.03194834e+00  1.03194834e+00
  1.03194834e+00  7.35880605e+00  7.35880605e+00  7.35880605e+00
  8.40944815e+00  3.35533408e+01  3.35533408e+01  3.35533408e+01
  3.81890556e+01  1.29221929e+02  1.29221929e+02  1.29221929e+02
  1.54064231e+02  4.83657849e+02  4.83657849e+02  4.83657849e+02
  6.44664621e+02  1.33544923e+03  1.33544923e+03  1.33544923e+03
  2.71103967e+03  3.02959993e+03  3.02959993e+03  3.02959993e+03
  6.65003954e+03  6.65003954e+03  6.65003954e+03  9.11262592e+03
  2.54655018e+04  7.62045517e+04]
E1 = -727.8356751398017  E_coul = 201.08962193573808
cycle= 1 E= -526.746053204064  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.556878
diis-c [-0.31011281  1.        ]
  HOMO = -0.590997274568145  LUMO = 0.87178959525718
  mo_energy =
[-1.18640866e+02 -1.23451021e+01 -9.59661216e+00 -9.59661216e+00
 -9.59661216e+00 -1.27992369e+00 -5.90997275e-01 -5.90997275e-01
 -5.90997275e-01  8.71789595e-01  1.00739368e+00  1.00739368e+00
  1.00739368e+00  7.26746049e+00  7.26746049e+00  7.26746049e+00
  8.32306815e+00  3.33981109e+01  3.33981109e+01  3.33981109e+01
  3.80461590e+01  1.28992105e+02  1.28992105e+02  1.28992105e+02
  1.53836981e+02  4.83349125e+02  4.83349125e+02  4.83349125e+02
  6.44318506e+02  1.33508363e+03  1.33508363e+03  1.33508363e+03
  2.71054032e+03  3.02916799e+03  3.02916799e+03  3.02916799e+03
  6.64949396e+03  6.64949396e+03  6.64949396e+03  9.11200536e+03
  2.54647867e+04  7.62037462e+04]
E1 = -728.4138427998613  E_coul = 201.66705853121425
cycle= 2 E= -526.746784268647  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.053
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0770248
diis-c [-0.00356309  0.08081668  0.91918332]
  HOMO = -0.581824115094936  LUMO = 0.879022080051911
  mo_energy =
[-1.18572507e+02 -1.23067048e+01 -9.55653956e+00 -9.55653956e+00
 -9.55653956e+00 -1.26893837e+00 -5.81824115e-01 -5.81824115e-01
 -5.81824115e-01  8.79022080e-01  1.01416644e+00  1.01416644e+00
  1.01416644e+00  7.29141927e+00  7.29141927e+00  7.29141927e+00
  8.34670310e+00  3.34385479e+01  3.34385479e+01  3.34385479e+01
  3.80849396e+01  1.29048539e+02  1.29048539e+02  1.29048539e+02
  1.53893845e+02  4.83416665e+02  4.83416665e+02  4.83416665e+02
  6.44388151e+02  1.33515525e+03  1.33515525e+03  1.33515525e+03
  2.71061520e+03  3.02924187e+03  3.02924187e+03  3.02924187e+03
  6.64956959e+03  6.64956959e+03  6.64956959e+03  9.11208179e+03
  2.54648637e+04  7.62038235e+04]
E1 = -728.2617821887446  E_coul = 201.51493801587284
cycle= 3 E= -526.746844172872  delta_E= -5.99e-05  |g|= 0.00643  |ddm|= 0.016
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136179
diis-c [-8.06150617e-07 -1.29074387e-03  1.45662971e-01  8.55627773e-01]
  HOMO = -0.583358283239047  LUMO = 0.877905153372193
  mo_energy =
[-1.18582701e+02 -1.23126466e+01 -9.56283839e+00 -9.56283839e+00
 -9.56283839e+00 -1.27066400e+00 -5.83358283e-01 -5.83358283e-01
 -5.83358283e-01  8.77905153e-01  1.01305940e+00  1.01305940e+00
  1.01305940e+00  7.28755302e+00  7.28755302e+00  7.28755302e+00
  8.34296764e+00  3.34322314e+01  3.34322314e+01  3.34322314e+01
  3.80789253e+01  1.29039994e+02  1.29039994e+02  1.29039994e+02
  1.53885271e+02  4.83406588e+02  4.83406588e+02  4.83406588e+02
  6.44377746e+02  1.33514457e+03  1.33514457e+03  1.33514457e+03
  2.71060388e+03  3.02923079e+03  3.02923079e+03  3.02923079e+03
  6.64955811e+03  6.64955811e+03  6.64955811e+03  9.11207010e+03
  2.54648518e+04  7.62038115e+04]
E1 = -728.285117013234  E_coul = 201.53827082868634
cycle= 4 E= -526.746846184548  delta_E= -2.01e-06  |g|= 0.000106  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00011992
diis-c [-5.47093462e-09  8.85193466e-05 -1.23861842e-02 -7.69579341e-02
  1.08925560e+00]
  HOMO = -0.583339065091975  LUMO = 0.877938194880313
  mo_energy =
[-1.18582651e+02 -1.23125754e+01 -9.56278126e+00 -9.56278126e+00
 -9.56278126e+00 -1.27061985e+00 -5.83339065e-01 -5.83339065e-01
 -5.83339065e-01  8.77938195e-01  1.01307609e+00  1.01307609e+00
  1.01307609e+00  7.28759824e+00  7.28759824e+00  7.28759824e+00
  8.34302654e+00  3.34322865e+01  3.34322865e+01  3.34322865e+01
  3.80789884e+01  1.29040050e+02  1.29040050e+02  1.29040050e+02
  1.53885329e+02  4.83406638e+02  4.83406638e+02  4.83406638e+02
  6.44377788e+02  1.33514461e+03  1.33514461e+03  1.33514461e+03
  2.71060390e+03  3.02923082e+03  3.02923082e+03  3.02923082e+03
  6.64955813e+03  6.64955813e+03  6.64955813e+03  9.11207010e+03
  2.54648518e+04  7.62038115e+04]
E1 = -728.2848705872556  E_coul = 201.53802440064618
cycle= 5 E= -526.746846186609  delta_E= -2.06e-09  |g|= 2.11e-05  |ddm|= 0.000172
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93718e-05
diis-c [-9.89504492e-11  1.34199738e-05 -1.74318934e-03 -1.29793424e-02
  3.72720719e-02  9.77437040e-01]
  HOMO = -0.583347094263085  LUMO = 0.877934431177713
  mo_energy =
[-1.18582683e+02 -1.23125995e+01 -9.56280724e+00 -9.56280724e+00
 -9.56280724e+00 -1.27062634e+00 -5.83347094e-01 -5.83347094e-01
 -5.83347094e-01  8.77934431e-01  1.01307074e+00  1.01307074e+00
  1.01307074e+00  7.28758049e+00  7.28758049e+00  7.28758049e+00
  8.34301030e+00  3.34322613e+01  3.34322613e+01  3.34322613e+01
  3.80789643e+01  1.29040021e+02  1.29040021e+02  1.29040021e+02
  1.53885300e+02  4.83406606e+02  4.83406606e+02  4.83406606e+02
  6.44377756e+02  1.33514458e+03  1.33514458e+03  1.33514458e+03
  2.71060387e+03  3.02923079e+03  3.02923079e+03  3.02923079e+03
  6.64955809e+03  6.64955809e+03  6.64955809e+03  9.11207007e+03
  2.54648518e+04  7.62038115e+04]
E1 = -728.2849561846045  E_coul = 201.5381099979334
cycle= 6 E= -526.746846186671  delta_E= -6.17e-11  |g|= 1.86e-06  |ddm|= 1.97e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2849561846045  E_coul = 201.5381099979334
  HOMO = -0.583346993039855  LUMO = 0.87793484752732
  mo_energy =
[-1.18582682e+02 -1.23125988e+01 -9.56280671e+00 -9.56280671e+00
 -9.56280671e+00 -1.27062581e+00 -5.83346993e-01 -5.83346993e-01
 -5.83346993e-01  8.77934848e-01  1.01307087e+00  1.01307087e+00
  1.01307087e+00  7.28758085e+00  7.28758085e+00  7.28758085e+00
  8.34301081e+00  3.34322619e+01  3.34322619e+01  3.34322619e+01
  3.80789649e+01  1.29040021e+02  1.29040021e+02  1.29040021e+02
  1.53885301e+02  4.83406607e+02  4.83406607e+02  4.83406607e+02
  6.44377756e+02  1.33514458e+03  1.33514458e+03  1.33514458e+03
  2.71060387e+03  3.02923079e+03  3.02923079e+03  3.02923079e+03
  6.64955810e+03  6.64955810e+03  6.64955810e+03  9.11207007e+03
  2.54648518e+04  7.62038115e+04]
E1 = -728.2849533131327  E_coul = 201.53810712645952
Extra cycle  E= -526.746846186673  delta_E= -2.05e-12  |g|= 3.93e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.24 sec
exp = [2.61826598e+04 7.61751355e+03 3.61735510e+03 1.59765481e+03
 3.82616527e+02 1.11393709e+02 3.81381318e+01 1.26703069e+01
 6.14394997e+00 6.32422748e-01 2.73167408e+00 2.26881757e-01
 1.36278453e+03 6.64732645e+02 3.00900511e+02 3.13989266e+02
 6.16639422e+01 7.33485849e+00 2.02423373e+01 7.75454896e-01
 2.81691170e+00 2.22499940e-01]
E = -526.7468461866732
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:33 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6597839        1
[INPUT] 0    0    [1    /1   ]  7617.51354515        1
[INPUT] 0    0    [1    /1   ]  3617.35509579        1
[INPUT] 0    0    [1    /1   ]  1597.65480525        1
[INPUT] 0    0    [1    /1   ]  382.616527449        1
[INPUT] 0    0    [1    /1   ]  111.393708984        1
[INPUT] 0    0    [1    /1   ]  38.1381318085        1
[INPUT] 0    0    [1    /1   ]  12.6703069369        1
[INPUT] 0    0    [1    /1   ]  6.14394997245        1
[INPUT] 0    0    [1    /1   ]  0.632422747913       1
[INPUT] 0    0    [1    /1   ]  2.73167408087        1
[INPUT] 0    0    [1    /1   ]  0.226881757275       1
[INPUT] 1    0    [1    /1   ]  1362.78452609        1
[INPUT] 1    0    [1    /1   ]  664.732644765        1
[INPUT] 1    0    [1    /1   ]  300.900511407        1
[INPUT] 1    0    [1    /1   ]  313.989266422        1
[INPUT] 1    0    [1    /1   ]  61.6639421987        1
[INPUT] 1    0    [1    /1   ]  7.3348584946         1
[INPUT] 1    0    [1    /1   ]  20.2423373123        1
[INPUT] 1    0    [1    /1   ]  0.775454896018       1
[INPUT] 1    0    [1    /1   ]  2.81691170002        1
[INPUT] 1    0    [1    /1   ]  0.222499940015       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659783871288, 1.0]], [0, [7617.513545145713, 1.0]], [0, [3617.355095785129, 1.0]], [0, [1597.6548052494825, 1.0]], [0, [382.61652744897697, 1.0]], [0, [111.3937089842734, 1.0]], [0, [38.13813180852627, 1.0]], [0, [12.670306936926687, 1.0]], [0, [6.143949972445521, 1.0]], [0, [0.632422747913162, 1.0]], [0, [2.731674080865931, 1.0]], [0, [0.22688175727497853, 1.0]], [1, [1362.784526088383, 1.0]], [1, [664.7326447650197, 1.0]], [1, [300.90051140697534, 1.0]], [1, [313.98926642221056, 1.0]], [1, [61.66394219872078, 1.0]], [1, [7.33485849459641, 1.0]], [1, [20.24233731230504, 1.0]], [1, [0.7754548960184977, 1.0]], [1, [2.8169117000161457, 1.0]], [1, [0.22249994001520015, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65978387]
bas 1, expnt(s) = [7617.51354515]
bas 2, expnt(s) = [3617.35509579]
bas 3, expnt(s) = [1597.65480525]
bas 4, expnt(s) = [382.61652745]
bas 5, expnt(s) = [111.39370898]
bas 6, expnt(s) = [38.13813181]
bas 7, expnt(s) = [12.67030694]
bas 8, expnt(s) = [6.14394997]
bas 9, expnt(s) = [0.63242275]
bas 10, expnt(s) = [2.73167408]
bas 11, expnt(s) = [0.22688176]
bas 12, expnt(s) = [1362.78452609]
bas 13, expnt(s) = [664.73264477]
bas 14, expnt(s) = [300.90051141]
bas 15, expnt(s) = [313.98926642]
bas 16, expnt(s) = [61.6639422]
bas 17, expnt(s) = [7.33485849]
bas 18, expnt(s) = [20.24233731]
bas 19, expnt(s) = [0.7754549]
bas 20, expnt(s) = [2.8169117]
bas 21, expnt(s) = [0.22249994]
CPU time:       245.25
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826598e+04 5.20026345e+03 7.61751355e+03 2.06003667e+03
 3.61735510e+03 1.17844246e+03 1.59765481e+03 6.38450508e+02
 3.82616527e+02 2.18568624e+02 1.11393709e+02 8.66284458e+01
 3.81381318e+01 3.87734625e+01 1.26703069e+01 1.69670124e+01
 6.14394997e+00 9.85940660e+00 6.32422748e-01 1.79172204e+00
 2.73167408e+00 5.36829886e+00 2.26881757e-01 8.30547943e-01
 1.36278453e+03 2.41556309e+04 6.64732645e+02 9.84675544e+03
 3.00900511e+02 3.65605777e+03 3.13989266e+02 3.85591894e+03
 6.16639422e+01 5.04107896e+02 7.33485849e+00 3.52147060e+01
 2.02423373e+01 1.25259368e+02 7.75454896e-01 2.12290261e+00
 2.81691170e+00 1.06463548e+01 2.22499940e-01 4.45806879e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993834978800546
cond(S) = 114034.67343609793
E1 = -729.5373581821897  E_coul = 203.17445112087944
init E= -526.36290706131
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555804413216234  LUMO = 0.896716500874224
  mo_energy =
[-1.18331019e+02 -1.22067674e+01 -9.44723678e+00 -9.44723678e+00
 -9.44723678e+00 -1.24029074e+00 -5.55804413e-01 -5.55804413e-01
 -5.55804413e-01  8.96716501e-01  1.03194834e+00  1.03194834e+00
  1.03194834e+00  7.35880605e+00  7.35880605e+00  7.35880605e+00
  8.40944815e+00  3.35533408e+01  3.35533408e+01  3.35533408e+01
  3.81890556e+01  1.29221929e+02  1.29221929e+02  1.29221929e+02
  1.54064231e+02  4.83657849e+02  4.83657849e+02  4.83657849e+02
  6.44664621e+02  1.33544923e+03  1.33544923e+03  1.33544923e+03
  2.71103967e+03  3.02959993e+03  3.02959993e+03  3.02959993e+03
  6.65003954e+03  6.65003954e+03  6.65003954e+03  9.11262592e+03
  2.54655018e+04  7.62045517e+04]
E1 = -727.8356751398017  E_coul = 201.08962193573808
cycle= 1 E= -526.746053204064  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.556878
diis-c [-0.31011281  1.        ]
  HOMO = -0.590997274568145  LUMO = 0.87178959525718
  mo_energy =
[-1.18640866e+02 -1.23451021e+01 -9.59661216e+00 -9.59661216e+00
 -9.59661216e+00 -1.27992369e+00 -5.90997275e-01 -5.90997275e-01
 -5.90997275e-01  8.71789595e-01  1.00739368e+00  1.00739368e+00
  1.00739368e+00  7.26746049e+00  7.26746049e+00  7.26746049e+00
  8.32306815e+00  3.33981109e+01  3.33981109e+01  3.33981109e+01
  3.80461590e+01  1.28992105e+02  1.28992105e+02  1.28992105e+02
  1.53836981e+02  4.83349125e+02  4.83349125e+02  4.83349125e+02
  6.44318506e+02  1.33508363e+03  1.33508363e+03  1.33508363e+03
  2.71054032e+03  3.02916799e+03  3.02916799e+03  3.02916799e+03
  6.64949396e+03  6.64949396e+03  6.64949396e+03  9.11200536e+03
  2.54647867e+04  7.62037462e+04]
E1 = -728.4138427998613  E_coul = 201.66705853121425
cycle= 2 E= -526.746784268647  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.053
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0770248
diis-c [-0.00356309  0.08081668  0.91918332]
  HOMO = -0.581824115094936  LUMO = 0.879022080051911
  mo_energy =
[-1.18572507e+02 -1.23067048e+01 -9.55653956e+00 -9.55653956e+00
 -9.55653956e+00 -1.26893837e+00 -5.81824115e-01 -5.81824115e-01
 -5.81824115e-01  8.79022080e-01  1.01416644e+00  1.01416644e+00
  1.01416644e+00  7.29141927e+00  7.29141927e+00  7.29141927e+00
  8.34670310e+00  3.34385479e+01  3.34385479e+01  3.34385479e+01
  3.80849396e+01  1.29048539e+02  1.29048539e+02  1.29048539e+02
  1.53893845e+02  4.83416665e+02  4.83416665e+02  4.83416665e+02
  6.44388151e+02  1.33515525e+03  1.33515525e+03  1.33515525e+03
  2.71061520e+03  3.02924187e+03  3.02924187e+03  3.02924187e+03
  6.64956959e+03  6.64956959e+03  6.64956959e+03  9.11208179e+03
  2.54648637e+04  7.62038235e+04]
E1 = -728.2617821887446  E_coul = 201.51493801587284
cycle= 3 E= -526.746844172872  delta_E= -5.99e-05  |g|= 0.00643  |ddm|= 0.016
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136179
diis-c [-8.06150617e-07 -1.29074387e-03  1.45662971e-01  8.55627773e-01]
  HOMO = -0.583358283239047  LUMO = 0.877905153372193
  mo_energy =
[-1.18582701e+02 -1.23126466e+01 -9.56283839e+00 -9.56283839e+00
 -9.56283839e+00 -1.27066400e+00 -5.83358283e-01 -5.83358283e-01
 -5.83358283e-01  8.77905153e-01  1.01305940e+00  1.01305940e+00
  1.01305940e+00  7.28755302e+00  7.28755302e+00  7.28755302e+00
  8.34296764e+00  3.34322314e+01  3.34322314e+01  3.34322314e+01
  3.80789253e+01  1.29039994e+02  1.29039994e+02  1.29039994e+02
  1.53885271e+02  4.83406588e+02  4.83406588e+02  4.83406588e+02
  6.44377746e+02  1.33514457e+03  1.33514457e+03  1.33514457e+03
  2.71060388e+03  3.02923079e+03  3.02923079e+03  3.02923079e+03
  6.64955811e+03  6.64955811e+03  6.64955811e+03  9.11207010e+03
  2.54648518e+04  7.62038115e+04]
E1 = -728.285117013234  E_coul = 201.53827082868634
cycle= 4 E= -526.746846184548  delta_E= -2.01e-06  |g|= 0.000106  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00011992
diis-c [-5.47093462e-09  8.85193466e-05 -1.23861842e-02 -7.69579341e-02
  1.08925560e+00]
  HOMO = -0.583339065091975  LUMO = 0.877938194880313
  mo_energy =
[-1.18582651e+02 -1.23125754e+01 -9.56278126e+00 -9.56278126e+00
 -9.56278126e+00 -1.27061985e+00 -5.83339065e-01 -5.83339065e-01
 -5.83339065e-01  8.77938195e-01  1.01307609e+00  1.01307609e+00
  1.01307609e+00  7.28759824e+00  7.28759824e+00  7.28759824e+00
  8.34302654e+00  3.34322865e+01  3.34322865e+01  3.34322865e+01
  3.80789884e+01  1.29040050e+02  1.29040050e+02  1.29040050e+02
  1.53885329e+02  4.83406638e+02  4.83406638e+02  4.83406638e+02
  6.44377788e+02  1.33514461e+03  1.33514461e+03  1.33514461e+03
  2.71060390e+03  3.02923082e+03  3.02923082e+03  3.02923082e+03
  6.64955813e+03  6.64955813e+03  6.64955813e+03  9.11207010e+03
  2.54648518e+04  7.62038115e+04]
E1 = -728.2848705872556  E_coul = 201.53802440064618
cycle= 5 E= -526.746846186609  delta_E= -2.06e-09  |g|= 2.11e-05  |ddm|= 0.000172
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93718e-05
diis-c [-9.89504492e-11  1.34199738e-05 -1.74318934e-03 -1.29793424e-02
  3.72720719e-02  9.77437040e-01]
  HOMO = -0.583347094263085  LUMO = 0.877934431177713
  mo_energy =
[-1.18582683e+02 -1.23125995e+01 -9.56280724e+00 -9.56280724e+00
 -9.56280724e+00 -1.27062634e+00 -5.83347094e-01 -5.83347094e-01
 -5.83347094e-01  8.77934431e-01  1.01307074e+00  1.01307074e+00
  1.01307074e+00  7.28758049e+00  7.28758049e+00  7.28758049e+00
  8.34301030e+00  3.34322613e+01  3.34322613e+01  3.34322613e+01
  3.80789643e+01  1.29040021e+02  1.29040021e+02  1.29040021e+02
  1.53885300e+02  4.83406606e+02  4.83406606e+02  4.83406606e+02
  6.44377756e+02  1.33514458e+03  1.33514458e+03  1.33514458e+03
  2.71060387e+03  3.02923079e+03  3.02923079e+03  3.02923079e+03
  6.64955809e+03  6.64955809e+03  6.64955809e+03  9.11207007e+03
  2.54648518e+04  7.62038115e+04]
E1 = -728.2849561846045  E_coul = 201.5381099979334
cycle= 6 E= -526.746846186671  delta_E= -6.17e-11  |g|= 1.86e-06  |ddm|= 1.97e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2849561846045  E_coul = 201.5381099979334
  HOMO = -0.583346993039855  LUMO = 0.87793484752732
  mo_energy =
[-1.18582682e+02 -1.23125988e+01 -9.56280671e+00 -9.56280671e+00
 -9.56280671e+00 -1.27062581e+00 -5.83346993e-01 -5.83346993e-01
 -5.83346993e-01  8.77934848e-01  1.01307087e+00  1.01307087e+00
  1.01307087e+00  7.28758085e+00  7.28758085e+00  7.28758085e+00
  8.34301081e+00  3.34322619e+01  3.34322619e+01  3.34322619e+01
  3.80789649e+01  1.29040021e+02  1.29040021e+02  1.29040021e+02
  1.53885301e+02  4.83406607e+02  4.83406607e+02  4.83406607e+02
  6.44377756e+02  1.33514458e+03  1.33514458e+03  1.33514458e+03
  2.71060387e+03  3.02923079e+03  3.02923079e+03  3.02923079e+03
  6.64955810e+03  6.64955810e+03  6.64955810e+03  9.11207007e+03
  2.54648518e+04  7.62038115e+04]
E1 = -728.2849533131327  E_coul = 201.53810712645952
Extra cycle  E= -526.746846186673  delta_E= -2.05e-12  |g|= 3.93e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114034.67343609793
E1 = -728.2849533131327  E_coul = 201.53810712645952
init E= -526.746846186673
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583347064449899  LUMO = 0.877934863509815
  mo_energy =
[-1.18582683e+02 -1.23125990e+01 -9.56280695e+00 -9.56280695e+00
 -9.56280695e+00 -1.27062581e+00 -5.83347064e-01 -5.83347064e-01
 -5.83347064e-01  8.77934864e-01  1.01307083e+00  1.01307083e+00
  1.01307083e+00  7.28758070e+00  7.28758070e+00  7.28758070e+00
  8.34301070e+00  3.34322617e+01  3.34322617e+01  3.34322617e+01
  3.80789646e+01  1.29040021e+02  1.29040021e+02  1.29040021e+02
  1.53885301e+02  4.83406607e+02  4.83406607e+02  4.83406607e+02
  6.44377756e+02  1.33514458e+03  1.33514458e+03  1.33514458e+03
  2.71060387e+03  3.02923079e+03  3.02923079e+03  3.02923079e+03
  6.64955809e+03  6.64955809e+03  6.64955809e+03  9.11207007e+03
  2.54648518e+04  7.62038115e+04]
E1 = -728.2849539641082  E_coul = 201.5381077774355
cycle= 1 E= -526.746846186673  delta_E= 4.55e-13  |g|= 9.04e-08  |ddm|= 6.14e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2849539641082  E_coul = 201.5381077774355
  HOMO = -0.583347055373551  LUMO = 0.87793488495362
  mo_energy =
[-1.18582683e+02 -1.23125990e+01 -9.56280690e+00 -9.56280690e+00
 -9.56280690e+00 -1.27062578e+00 -5.83347055e-01 -5.83347055e-01
 -5.83347055e-01  8.77934885e-01  1.01307084e+00  1.01307084e+00
  1.01307084e+00  7.28758073e+00  7.28758073e+00  7.28758073e+00
  8.34301074e+00  3.34322617e+01  3.34322617e+01  3.34322617e+01
  3.80789647e+01  1.29040021e+02  1.29040021e+02  1.29040021e+02
  1.53885301e+02  4.83406607e+02  4.83406607e+02  4.83406607e+02
  6.44377756e+02  1.33514458e+03  1.33514458e+03  1.33514458e+03
  2.71060387e+03  3.02923079e+03  3.02923079e+03  3.02923079e+03
  6.64955810e+03  6.64955810e+03  6.64955810e+03  9.11207007e+03
  2.54648518e+04  7.62038115e+04]
E1 = -728.2849537478205  E_coul = 201.5381075611471
Extra cycle  E= -526.746846186673  delta_E= -6.82e-13  |g|= 1.96e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.44 sec
exp = [2.61826598e+04 7.61751355e+03 3.61735510e+03 1.59765481e+03
 3.82616527e+02 1.11393709e+02 3.81381318e+01 1.26703069e+01
 6.14394997e+00 6.32422748e-01 2.73167408e+00 2.26881757e-01
 1.36278453e+03 6.64732645e+02 3.00900511e+02 3.13989266e+02
 6.16639422e+01 7.33485849e+00 2.02423373e+01 7.75454896e-01
 2.81691170e+00 2.22499940e-01]
grad_E = [-1.53526797e-06  3.50555691e-06 -1.46411829e-06  7.64290544e-05
 -1.58939273e-04 -7.14986202e-04 -9.16130338e-04  1.04557665e-04
 -1.46107334e-04 -1.31953820e-03  2.20311768e-03  1.13406638e-03
 -5.08833048e-07  4.98610792e-06  2.35093194e-05  2.02648201e-05
 -2.13540769e-05 -5.00812375e-04  1.02891710e-04  3.91260238e-04
  7.46119775e-04 -1.07266922e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:38 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.659824         1
[INPUT] 0    0    [1    /1   ]  7617.51345922        1
[INPUT] 0    0    [1    /1   ]  3617.35513872        1
[INPUT] 0    0    [1    /1   ]  1597.65304554        1
[INPUT] 0    0    [1    /1   ]  382.614199351        1
[INPUT] 0    0    [1    /1   ]  111.432333719        1
[INPUT] 0    0    [1    /1   ]  38.1540924217        1
[INPUT] 0    0    [1    /1   ]  12.6965251674        1
[INPUT] 0    0    [1    /1   ]  6.2036389112         1
[INPUT] 0    0    [1    /1   ]  0.630294632633       1
[INPUT] 0    0    [1    /1   ]  2.74608903109        1
[INPUT] 0    0    [1    /1   ]  0.225734142305       1
[INPUT] 1    0    [1    /1   ]  1362.7845396         1
[INPUT] 1    0    [1    /1   ]  664.732511992        1
[INPUT] 1    0    [1    /1   ]  300.899885671        1
[INPUT] 1    0    [1    /1   ]  313.98872693         1
[INPUT] 1    0    [1    /1   ]  61.6641820191        1
[INPUT] 1    0    [1    /1   ]  7.33458361341        1
[INPUT] 1    0    [1    /1   ]  20.2433602235        1
[INPUT] 1    0    [1    /1   ]  0.77528313026        1
[INPUT] 1    0    [1    /1   ]  2.81368609731        1
[INPUT] 1    0    [1    /1   ]  0.22234356371        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659824041122, 1.0]], [0, [7617.513459219319, 1.0]], [0, [3617.355138715481, 1.0]], [0, [1597.6530455435457, 1.0]], [0, [382.61419935106693, 1.0]], [0, [111.43233371874332, 1.0]], [0, [38.154092421654, 1.0]], [0, [12.69652516742564, 1.0]], [0, [6.2036389111976895, 1.0]], [0, [0.6302946326327559, 1.0]], [0, [2.7460890310895305, 1.0]], [0, [0.22573414230532848, 1.0]], [1, [1362.784539599687, 1.0]], [1, [664.7325119923594, 1.0]], [1, [300.8998856705591, 1.0]], [1, [313.9887269302679, 1.0]], [1, [61.66418201909204, 1.0]], [1, [7.334583613414067, 1.0]], [1, [20.243360223539526, 1.0]], [1, [0.775283130260054, 1.0]], [1, [2.8136860973094593, 1.0]], [1, [0.22234356370977992, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65982404]
bas 1, expnt(s) = [7617.51345922]
bas 2, expnt(s) = [3617.35513872]
bas 3, expnt(s) = [1597.65304554]
bas 4, expnt(s) = [382.61419935]
bas 5, expnt(s) = [111.43233372]
bas 6, expnt(s) = [38.15409242]
bas 7, expnt(s) = [12.69652517]
bas 8, expnt(s) = [6.20363891]
bas 9, expnt(s) = [0.63029463]
bas 10, expnt(s) = [2.74608903]
bas 11, expnt(s) = [0.22573414]
bas 12, expnt(s) = [1362.7845396]
bas 13, expnt(s) = [664.73251199]
bas 14, expnt(s) = [300.89988567]
bas 15, expnt(s) = [313.98872693]
bas 16, expnt(s) = [61.66418202]
bas 17, expnt(s) = [7.33458361]
bas 18, expnt(s) = [20.24336022]
bas 19, expnt(s) = [0.77528313]
bas 20, expnt(s) = [2.8136861]
bas 21, expnt(s) = [0.22234356]
CPU time:       250.92
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826598e+04 5.20026346e+03 7.61751346e+03 2.06003665e+03
 3.61735514e+03 1.17844247e+03 1.59765305e+03 6.38449980e+02
 3.82614199e+02 2.18567627e+02 1.11432334e+02 8.66509730e+01
 3.81540924e+01 3.87856318e+01 1.26965252e+01 1.69933375e+01
 6.20363891e+00 9.93115837e+00 6.30294633e-01 1.78719825e+00
 2.74608903e+00 5.38953112e+00 2.25734142e-01 8.27395134e-01
 1.36278454e+03 2.41556312e+04 6.64732512e+02 9.84675298e+03
 3.00899886e+02 3.65604827e+03 3.13988727e+02 3.85591066e+03
 6.16641820e+01 5.04110347e+02 7.33458361e+00 3.52130564e+01
 2.02433602e+01 1.25267280e+02 7.75283130e-01 2.12231484e+00
 2.81368610e+00 1.06311182e+01 2.22343564e-01 4.45415263e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.9938518474787
cond(S) = 114061.18928282909
E1 = -729.5375620783619  E_coul = 203.17457571848462
init E= -526.362986359877
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555810554878063  LUMO = 0.891213755866547
  mo_energy =
[-1.18331022e+02 -1.22067385e+01 -9.44722033e+00 -9.44722033e+00
 -9.44722033e+00 -1.24029406e+00 -5.55810555e-01 -5.55810555e-01
 -5.55810555e-01  8.91213756e-01  1.03114647e+00  1.03114647e+00
  1.03114647e+00  7.35200884e+00  7.35200884e+00  7.35200884e+00
  8.45621742e+00  3.35408222e+01  3.35408222e+01  3.35408222e+01
  3.84324662e+01  1.29212387e+02  1.29212387e+02  1.29212387e+02
  1.54500791e+02  4.83651569e+02  4.83651569e+02  4.83651569e+02
  6.45198966e+02  1.33544294e+03  1.33544294e+03  1.33544294e+03
  2.71156662e+03  3.02959249e+03  3.02959249e+03  3.02959249e+03
  6.65003144e+03  6.65003144e+03  6.65003144e+03  9.11311701e+03
  2.54659666e+04  7.62049844e+04]
E1 = -727.8323298905068  E_coul = 201.08626661258688
cycle= 1 E= -526.74606327792  delta_E= -0.383  |g|= 0.187  |ddm|= 0.308
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.557051
diis-c [-0.31030598  1.        ]
  HOMO = -0.591115692064845  LUMO = 0.866293255576064
  mo_energy =
[-1.18641151e+02 -1.23453245e+01 -9.59684594e+00 -9.59684594e+00
 -9.59684594e+00 -1.28004347e+00 -5.91115692e-01 -5.91115692e-01
 -5.91115692e-01  8.66293256e-01  1.00652587e+00  1.00652587e+00
  1.00652587e+00  7.26048932e+00  7.26048932e+00  7.26048932e+00
  8.36928878e+00  3.33853454e+01  3.33853454e+01  3.33853454e+01
  3.82890671e+01  1.28982281e+02  1.28982281e+02  1.28982281e+02
  1.54273229e+02  4.83342570e+02  4.83342570e+02  4.83342570e+02
  6.44852565e+02  1.33507705e+03  1.33507705e+03  1.33507705e+03
  2.71106699e+03  3.02916027e+03  3.02916027e+03  3.02916027e+03
  6.64948558e+03  6.64948558e+03  6.64948558e+03  9.11249617e+03
  2.54652512e+04  7.62041786e+04]
E1 = -728.411422634939  E_coul = 201.6646263565066
cycle= 2 E= -526.746796278432  delta_E= -0.000733  |g|= 0.038  |ddm|= 0.0531
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0770873
diis-c [-0.0035698   0.08084005  0.91915995]
  HOMO = -0.5819232985117  LUMO = 0.873518063514057
  mo_energy =
[-1.18572708e+02 -1.23068650e+01 -9.55671015e+00 -9.55671015e+00
 -9.55671015e+00 -1.26903403e+00 -5.81923299e-01 -5.81923299e-01
 -5.81923299e-01  8.73518064e-01  1.01330873e+00  1.01330873e+00
  1.01330873e+00  7.28448067e+00  7.28448067e+00  7.28448067e+00
  8.39306238e+00  3.34258451e+01  3.34258451e+01  3.34258451e+01
  3.83279739e+01  1.29038791e+02  1.29038791e+02  1.29038791e+02
  1.54330176e+02  4.83410194e+02  4.83410194e+02  4.83410194e+02
  6.44922293e+02  1.33514875e+03  1.33514875e+03  1.33514875e+03
  2.71114196e+03  3.02923423e+03  3.02923423e+03  3.02923423e+03
  6.64956129e+03  6.64956129e+03  6.64956129e+03  9.11257269e+03
  2.54653283e+04  7.62042560e+04]
E1 = -728.2590818825945  E_coul = 201.51222550430492
cycle= 3 E= -526.74685637829  delta_E= -6.01e-05  |g|= 0.00644  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136356
diis-c [-8.09081318e-07 -1.29120881e-03  1.45727163e-01  8.55564046e-01]
  HOMO = -0.583460862294461  LUMO = 0.872402662896756
  mo_energy =
[-1.18582917e+02 -1.23128168e+01 -9.56301945e+00 -9.56301945e+00
 -9.56301945e+00 -1.27076291e+00 -5.83460862e-01 -5.83460862e-01
 -5.83460862e-01  8.72402663e-01  1.01219993e+00  1.01219993e+00
  1.01219993e+00  7.28060891e+00  7.28060891e+00  7.28060891e+00
  8.38930567e+00  3.34195180e+01  3.34195180e+01  3.34195180e+01
  3.83219398e+01  1.29030233e+02  1.29030233e+02  1.29030233e+02
  1.54321588e+02  4.83400102e+02  4.83400102e+02  4.83400102e+02
  6.44911872e+02  1.33513806e+03  1.33513806e+03  1.33513806e+03
  2.71113063e+03  3.02922314e+03  3.02922314e+03  3.02922314e+03
  6.64954980e+03  6.64954980e+03  6.64954980e+03  9.11256098e+03
  2.54653164e+04  7.62042440e+04]
E1 = -728.282458932574  E_coul = 201.5356005351227
cycle= 4 E= -526.746858397451  delta_E= -2.02e-06  |g|= 0.000106  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000120853
diis-c [-5.49507096e-09  8.91535826e-05 -1.24686041e-02 -7.74761022e-02
  1.08985555e+00]
  HOMO = -0.583441888337685  LUMO = 0.872435592372836
  mo_energy =
[-1.18582868e+02 -1.23127461e+01 -9.56296294e+00 -9.56296294e+00
 -9.56296294e+00 -1.27071883e+00 -5.83441888e-01 -5.83441888e-01
 -5.83441888e-01  8.72435592e-01  1.01221646e+00  1.01221646e+00
  1.01221646e+00  7.28065368e+00  7.28065368e+00  7.28065368e+00
  8.38936436e+00  3.34195725e+01  3.34195725e+01  3.34195725e+01
  3.83220023e+01  1.29030288e+02  1.29030288e+02  1.29030288e+02
  1.54321645e+02  4.83400151e+02  4.83400151e+02  4.83400151e+02
  6.44911913e+02  1.33513810e+03  1.33513810e+03  1.33513810e+03
  2.71113065e+03  3.02922317e+03  3.02922317e+03  3.02922317e+03
  6.64954982e+03  6.64954982e+03  6.64954982e+03  9.11256099e+03
  2.54653164e+04  7.62042440e+04]
E1 = -728.2822137220868  E_coul = 201.53535532253917
cycle= 5 E= -526.746858399548  delta_E= -2.1e-09  |g|= 2.11e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93865e-05
diis-c [-1.00003155e-10  1.34285605e-05 -1.74372817e-03 -1.29741382e-02
  3.64171310e-02  9.78287307e-01]
  HOMO = -0.583449940286307  LUMO = 0.872431844668427
  mo_energy =
[-1.18582900e+02 -1.23127703e+01 -9.56298896e+00 -9.56298896e+00
 -9.56298896e+00 -1.27072531e+00 -5.83449940e-01 -5.83449940e-01
 -5.83449940e-01  8.72431845e-01  1.01221110e+00  1.01221110e+00
  1.01221110e+00  7.28063590e+00  7.28063590e+00  7.28063590e+00
  8.38934804e+00  3.34195473e+01  3.34195473e+01  3.34195473e+01
  3.83219781e+01  1.29030259e+02  1.29030259e+02  1.29030259e+02
  1.54321616e+02  4.83400119e+02  4.83400119e+02  4.83400119e+02
  6.44911881e+02  1.33513806e+03  1.33513806e+03  1.33513806e+03
  2.71113061e+03  3.02922313e+03  3.02922313e+03  3.02922313e+03
  6.64954978e+03  6.64954978e+03  6.64954978e+03  9.11256095e+03
  2.54653163e+04  7.62042440e+04]
E1 = -728.2822993884367  E_coul = 201.53544098882574
cycle= 6 E= -526.746858399611  delta_E= -6.34e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2822993884367  E_coul = 201.53544098882574
  HOMO = -0.583449831272719  LUMO = 0.87243226603825
  mo_energy =
[-1.18582900e+02 -1.23127696e+01 -9.56298841e+00 -9.56298841e+00
 -9.56298841e+00 -1.27072478e+00 -5.83449831e-01 -5.83449831e-01
 -5.83449831e-01  8.72432266e-01  1.01221124e+00  1.01221124e+00
  1.01221124e+00  7.28063628e+00  7.28063628e+00  7.28063628e+00
  8.38934857e+00  3.34195479e+01  3.34195479e+01  3.34195479e+01
  3.83219787e+01  1.29030259e+02  1.29030259e+02  1.29030259e+02
  1.54321617e+02  4.83400120e+02  4.83400120e+02  4.83400120e+02
  6.44911882e+02  1.33513807e+03  1.33513807e+03  1.33513807e+03
  2.71113061e+03  3.02922313e+03  3.02922313e+03  3.02922313e+03
  6.64954978e+03  6.64954978e+03  6.64954978e+03  9.11256095e+03
  2.54653163e+04  7.62042440e+04]
E1 = -728.2822964047175  E_coul = 201.5354380051061
Extra cycle  E= -526.746858399611  delta_E= -3.41e-13  |g|= 3.95e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826598e+04 7.61751346e+03 3.61735514e+03 1.59765305e+03
 3.82614199e+02 1.11432334e+02 3.81540924e+01 1.26965252e+01
 6.20363891e+00 6.30294633e-01 2.74608903e+00 2.25734142e-01
 1.36278454e+03 6.64732512e+02 3.00899886e+02 3.13988727e+02
 6.16641820e+01 7.33458361e+00 2.02433602e+01 7.75283130e-01
 2.81368610e+00 2.22343564e-01]
E = -526.7468583996114
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:38 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.659824         1
[INPUT] 0    0    [1    /1   ]  7617.51345922        1
[INPUT] 0    0    [1    /1   ]  3617.35513872        1
[INPUT] 0    0    [1    /1   ]  1597.65304554        1
[INPUT] 0    0    [1    /1   ]  382.614199351        1
[INPUT] 0    0    [1    /1   ]  111.432333719        1
[INPUT] 0    0    [1    /1   ]  38.1540924217        1
[INPUT] 0    0    [1    /1   ]  12.6965251674        1
[INPUT] 0    0    [1    /1   ]  6.2036389112         1
[INPUT] 0    0    [1    /1   ]  0.630294632633       1
[INPUT] 0    0    [1    /1   ]  2.74608903109        1
[INPUT] 0    0    [1    /1   ]  0.225734142305       1
[INPUT] 1    0    [1    /1   ]  1362.7845396         1
[INPUT] 1    0    [1    /1   ]  664.732511992        1
[INPUT] 1    0    [1    /1   ]  300.899885671        1
[INPUT] 1    0    [1    /1   ]  313.98872693         1
[INPUT] 1    0    [1    /1   ]  61.6641820191        1
[INPUT] 1    0    [1    /1   ]  7.33458361341        1
[INPUT] 1    0    [1    /1   ]  20.2433602235        1
[INPUT] 1    0    [1    /1   ]  0.77528313026        1
[INPUT] 1    0    [1    /1   ]  2.81368609731        1
[INPUT] 1    0    [1    /1   ]  0.22234356371        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659824041122, 1.0]], [0, [7617.513459219319, 1.0]], [0, [3617.355138715481, 1.0]], [0, [1597.6530455435457, 1.0]], [0, [382.61419935106693, 1.0]], [0, [111.43233371874332, 1.0]], [0, [38.154092421654, 1.0]], [0, [12.69652516742564, 1.0]], [0, [6.2036389111976895, 1.0]], [0, [0.6302946326327559, 1.0]], [0, [2.7460890310895305, 1.0]], [0, [0.22573414230532848, 1.0]], [1, [1362.784539599687, 1.0]], [1, [664.7325119923594, 1.0]], [1, [300.8998856705591, 1.0]], [1, [313.9887269302679, 1.0]], [1, [61.66418201909204, 1.0]], [1, [7.334583613414067, 1.0]], [1, [20.243360223539526, 1.0]], [1, [0.775283130260054, 1.0]], [1, [2.8136860973094593, 1.0]], [1, [0.22234356370977992, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65982404]
bas 1, expnt(s) = [7617.51345922]
bas 2, expnt(s) = [3617.35513872]
bas 3, expnt(s) = [1597.65304554]
bas 4, expnt(s) = [382.61419935]
bas 5, expnt(s) = [111.43233372]
bas 6, expnt(s) = [38.15409242]
bas 7, expnt(s) = [12.69652517]
bas 8, expnt(s) = [6.20363891]
bas 9, expnt(s) = [0.63029463]
bas 10, expnt(s) = [2.74608903]
bas 11, expnt(s) = [0.22573414]
bas 12, expnt(s) = [1362.7845396]
bas 13, expnt(s) = [664.73251199]
bas 14, expnt(s) = [300.89988567]
bas 15, expnt(s) = [313.98872693]
bas 16, expnt(s) = [61.66418202]
bas 17, expnt(s) = [7.33458361]
bas 18, expnt(s) = [20.24336022]
bas 19, expnt(s) = [0.77528313]
bas 20, expnt(s) = [2.8136861]
bas 21, expnt(s) = [0.22234356]
CPU time:       251.33
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826598e+04 5.20026346e+03 7.61751346e+03 2.06003665e+03
 3.61735514e+03 1.17844247e+03 1.59765305e+03 6.38449980e+02
 3.82614199e+02 2.18567627e+02 1.11432334e+02 8.66509730e+01
 3.81540924e+01 3.87856318e+01 1.26965252e+01 1.69933375e+01
 6.20363891e+00 9.93115837e+00 6.30294633e-01 1.78719825e+00
 2.74608903e+00 5.38953112e+00 2.25734142e-01 8.27395134e-01
 1.36278454e+03 2.41556312e+04 6.64732512e+02 9.84675298e+03
 3.00899886e+02 3.65604827e+03 3.13988727e+02 3.85591066e+03
 6.16641820e+01 5.04110347e+02 7.33458361e+00 3.52130564e+01
 2.02433602e+01 1.25267280e+02 7.75283130e-01 2.12231484e+00
 2.81368610e+00 1.06311182e+01 2.22343564e-01 4.45415263e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.9938518474787
cond(S) = 114061.18928282909
E1 = -729.5375620783619  E_coul = 203.17457571848462
init E= -526.362986359877
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555810554878063  LUMO = 0.891213755866547
  mo_energy =
[-1.18331022e+02 -1.22067385e+01 -9.44722033e+00 -9.44722033e+00
 -9.44722033e+00 -1.24029406e+00 -5.55810555e-01 -5.55810555e-01
 -5.55810555e-01  8.91213756e-01  1.03114647e+00  1.03114647e+00
  1.03114647e+00  7.35200884e+00  7.35200884e+00  7.35200884e+00
  8.45621742e+00  3.35408222e+01  3.35408222e+01  3.35408222e+01
  3.84324662e+01  1.29212387e+02  1.29212387e+02  1.29212387e+02
  1.54500791e+02  4.83651569e+02  4.83651569e+02  4.83651569e+02
  6.45198966e+02  1.33544294e+03  1.33544294e+03  1.33544294e+03
  2.71156662e+03  3.02959249e+03  3.02959249e+03  3.02959249e+03
  6.65003144e+03  6.65003144e+03  6.65003144e+03  9.11311701e+03
  2.54659666e+04  7.62049844e+04]
E1 = -727.8323298905068  E_coul = 201.08626661258688
cycle= 1 E= -526.74606327792  delta_E= -0.383  |g|= 0.187  |ddm|= 0.308
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.557051
diis-c [-0.31030598  1.        ]
  HOMO = -0.591115692064845  LUMO = 0.866293255576064
  mo_energy =
[-1.18641151e+02 -1.23453245e+01 -9.59684594e+00 -9.59684594e+00
 -9.59684594e+00 -1.28004347e+00 -5.91115692e-01 -5.91115692e-01
 -5.91115692e-01  8.66293256e-01  1.00652587e+00  1.00652587e+00
  1.00652587e+00  7.26048932e+00  7.26048932e+00  7.26048932e+00
  8.36928878e+00  3.33853454e+01  3.33853454e+01  3.33853454e+01
  3.82890671e+01  1.28982281e+02  1.28982281e+02  1.28982281e+02
  1.54273229e+02  4.83342570e+02  4.83342570e+02  4.83342570e+02
  6.44852565e+02  1.33507705e+03  1.33507705e+03  1.33507705e+03
  2.71106699e+03  3.02916027e+03  3.02916027e+03  3.02916027e+03
  6.64948558e+03  6.64948558e+03  6.64948558e+03  9.11249617e+03
  2.54652512e+04  7.62041786e+04]
E1 = -728.411422634939  E_coul = 201.6646263565066
cycle= 2 E= -526.746796278432  delta_E= -0.000733  |g|= 0.038  |ddm|= 0.0531
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0770873
diis-c [-0.0035698   0.08084005  0.91915995]
  HOMO = -0.5819232985117  LUMO = 0.873518063514057
  mo_energy =
[-1.18572708e+02 -1.23068650e+01 -9.55671015e+00 -9.55671015e+00
 -9.55671015e+00 -1.26903403e+00 -5.81923299e-01 -5.81923299e-01
 -5.81923299e-01  8.73518064e-01  1.01330873e+00  1.01330873e+00
  1.01330873e+00  7.28448067e+00  7.28448067e+00  7.28448067e+00
  8.39306238e+00  3.34258451e+01  3.34258451e+01  3.34258451e+01
  3.83279739e+01  1.29038791e+02  1.29038791e+02  1.29038791e+02
  1.54330176e+02  4.83410194e+02  4.83410194e+02  4.83410194e+02
  6.44922293e+02  1.33514875e+03  1.33514875e+03  1.33514875e+03
  2.71114196e+03  3.02923423e+03  3.02923423e+03  3.02923423e+03
  6.64956129e+03  6.64956129e+03  6.64956129e+03  9.11257269e+03
  2.54653283e+04  7.62042560e+04]
E1 = -728.2590818825945  E_coul = 201.51222550430492
cycle= 3 E= -526.74685637829  delta_E= -6.01e-05  |g|= 0.00644  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136356
diis-c [-8.09081318e-07 -1.29120881e-03  1.45727163e-01  8.55564046e-01]
  HOMO = -0.583460862294461  LUMO = 0.872402662896756
  mo_energy =
[-1.18582917e+02 -1.23128168e+01 -9.56301945e+00 -9.56301945e+00
 -9.56301945e+00 -1.27076291e+00 -5.83460862e-01 -5.83460862e-01
 -5.83460862e-01  8.72402663e-01  1.01219993e+00  1.01219993e+00
  1.01219993e+00  7.28060891e+00  7.28060891e+00  7.28060891e+00
  8.38930567e+00  3.34195180e+01  3.34195180e+01  3.34195180e+01
  3.83219398e+01  1.29030233e+02  1.29030233e+02  1.29030233e+02
  1.54321588e+02  4.83400102e+02  4.83400102e+02  4.83400102e+02
  6.44911872e+02  1.33513806e+03  1.33513806e+03  1.33513806e+03
  2.71113063e+03  3.02922314e+03  3.02922314e+03  3.02922314e+03
  6.64954980e+03  6.64954980e+03  6.64954980e+03  9.11256098e+03
  2.54653164e+04  7.62042440e+04]
E1 = -728.282458932574  E_coul = 201.5356005351227
cycle= 4 E= -526.746858397451  delta_E= -2.02e-06  |g|= 0.000106  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000120853
diis-c [-5.49507096e-09  8.91535826e-05 -1.24686041e-02 -7.74761022e-02
  1.08985555e+00]
  HOMO = -0.583441888337685  LUMO = 0.872435592372836
  mo_energy =
[-1.18582868e+02 -1.23127461e+01 -9.56296294e+00 -9.56296294e+00
 -9.56296294e+00 -1.27071883e+00 -5.83441888e-01 -5.83441888e-01
 -5.83441888e-01  8.72435592e-01  1.01221646e+00  1.01221646e+00
  1.01221646e+00  7.28065368e+00  7.28065368e+00  7.28065368e+00
  8.38936436e+00  3.34195725e+01  3.34195725e+01  3.34195725e+01
  3.83220023e+01  1.29030288e+02  1.29030288e+02  1.29030288e+02
  1.54321645e+02  4.83400151e+02  4.83400151e+02  4.83400151e+02
  6.44911913e+02  1.33513810e+03  1.33513810e+03  1.33513810e+03
  2.71113065e+03  3.02922317e+03  3.02922317e+03  3.02922317e+03
  6.64954982e+03  6.64954982e+03  6.64954982e+03  9.11256099e+03
  2.54653164e+04  7.62042440e+04]
E1 = -728.2822137220868  E_coul = 201.53535532253917
cycle= 5 E= -526.746858399548  delta_E= -2.1e-09  |g|= 2.11e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93865e-05
diis-c [-1.00003155e-10  1.34285605e-05 -1.74372817e-03 -1.29741382e-02
  3.64171310e-02  9.78287307e-01]
  HOMO = -0.583449940286307  LUMO = 0.872431844668427
  mo_energy =
[-1.18582900e+02 -1.23127703e+01 -9.56298896e+00 -9.56298896e+00
 -9.56298896e+00 -1.27072531e+00 -5.83449940e-01 -5.83449940e-01
 -5.83449940e-01  8.72431845e-01  1.01221110e+00  1.01221110e+00
  1.01221110e+00  7.28063590e+00  7.28063590e+00  7.28063590e+00
  8.38934804e+00  3.34195473e+01  3.34195473e+01  3.34195473e+01
  3.83219781e+01  1.29030259e+02  1.29030259e+02  1.29030259e+02
  1.54321616e+02  4.83400119e+02  4.83400119e+02  4.83400119e+02
  6.44911881e+02  1.33513806e+03  1.33513806e+03  1.33513806e+03
  2.71113061e+03  3.02922313e+03  3.02922313e+03  3.02922313e+03
  6.64954978e+03  6.64954978e+03  6.64954978e+03  9.11256095e+03
  2.54653163e+04  7.62042440e+04]
E1 = -728.2822993884367  E_coul = 201.53544098882574
cycle= 6 E= -526.746858399611  delta_E= -6.34e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2822993884367  E_coul = 201.53544098882574
  HOMO = -0.583449831272719  LUMO = 0.87243226603825
  mo_energy =
[-1.18582900e+02 -1.23127696e+01 -9.56298841e+00 -9.56298841e+00
 -9.56298841e+00 -1.27072478e+00 -5.83449831e-01 -5.83449831e-01
 -5.83449831e-01  8.72432266e-01  1.01221124e+00  1.01221124e+00
  1.01221124e+00  7.28063628e+00  7.28063628e+00  7.28063628e+00
  8.38934857e+00  3.34195479e+01  3.34195479e+01  3.34195479e+01
  3.83219787e+01  1.29030259e+02  1.29030259e+02  1.29030259e+02
  1.54321617e+02  4.83400120e+02  4.83400120e+02  4.83400120e+02
  6.44911882e+02  1.33513807e+03  1.33513807e+03  1.33513807e+03
  2.71113061e+03  3.02922313e+03  3.02922313e+03  3.02922313e+03
  6.64954978e+03  6.64954978e+03  6.64954978e+03  9.11256095e+03
  2.54653163e+04  7.62042440e+04]
E1 = -728.2822964047175  E_coul = 201.5354380051061
Extra cycle  E= -526.746858399611  delta_E= -3.41e-13  |g|= 3.95e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114061.18928282909
E1 = -728.2822964047175  E_coul = 201.5354380051061
init E= -526.746858399611
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583449905026359  LUMO = 0.872432280333196
  mo_energy =
[-1.18582900e+02 -1.23127698e+01 -9.56298865e+00 -9.56298865e+00
 -9.56298865e+00 -1.27072478e+00 -5.83449905e-01 -5.83449905e-01
 -5.83449905e-01  8.72432280e-01  1.01221120e+00  1.01221120e+00
  1.01221120e+00  7.28063613e+00  7.28063613e+00  7.28063613e+00
  8.38934845e+00  3.34195476e+01  3.34195476e+01  3.34195476e+01
  3.83219785e+01  1.29030259e+02  1.29030259e+02  1.29030259e+02
  1.54321617e+02  4.83400120e+02  4.83400120e+02  4.83400120e+02
  6.44911881e+02  1.33513807e+03  1.33513807e+03  1.33513807e+03
  2.71113061e+03  3.02922313e+03  3.02922313e+03  3.02922313e+03
  6.64954978e+03  6.64954978e+03  6.64954978e+03  9.11256095e+03
  2.54653163e+04  7.62042440e+04]
E1 = -728.2822970856837  E_coul = 201.53543868607144
cycle= 1 E= -526.746858399612  delta_E= -9.09e-13  |g|= 9.15e-08  |ddm|= 6.14e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2822970856837  E_coul = 201.53543868607144
  HOMO = -0.583449895411592  LUMO = 0.872432302158927
  mo_energy =
[-1.18582900e+02 -1.23127698e+01 -9.56298860e+00 -9.56298860e+00
 -9.56298860e+00 -1.27072475e+00 -5.83449895e-01 -5.83449895e-01
 -5.83449895e-01  8.72432302e-01  1.01221121e+00  1.01221121e+00
  1.01221121e+00  7.28063616e+00  7.28063616e+00  7.28063616e+00
  8.38934849e+00  3.34195477e+01  3.34195477e+01  3.34195477e+01
  3.83219785e+01  1.29030259e+02  1.29030259e+02  1.29030259e+02
  1.54321617e+02  4.83400120e+02  4.83400120e+02  4.83400120e+02
  6.44911881e+02  1.33513807e+03  1.33513807e+03  1.33513807e+03
  2.71113061e+03  3.02922313e+03  3.02922313e+03  3.02922313e+03
  6.64954978e+03  6.64954978e+03  6.64954978e+03  9.11256095e+03
  2.54653163e+04  7.62042440e+04]
E1 = -728.2822968604452  E_coul = 201.5354384608324
Extra cycle  E= -526.746858399613  delta_E= -4.55e-13  |g|= 2e-08  |ddm|= 1.41e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826598e+04 7.61751346e+03 3.61735514e+03 1.59765305e+03
 3.82614199e+02 1.11432334e+02 3.81540924e+01 1.26965252e+01
 6.20363891e+00 6.30294633e-01 2.74608903e+00 2.25734142e-01
 1.36278454e+03 6.64732512e+02 3.00899886e+02 3.13988727e+02
 6.16641820e+01 7.33458361e+00 2.02433602e+01 7.75283130e-01
 2.81368610e+00 2.22343564e-01]
grad_E = [-1.53577157e-06  3.51136921e-06 -1.46033744e-06  7.66487462e-05
 -1.64557616e-04 -6.86885680e-04 -9.61036538e-04  9.66122286e-05
 -1.18103328e-05 -1.14168939e-03  2.03273404e-03 -3.82472627e-04
 -5.09289755e-07  4.97997694e-06  2.34715206e-05  2.02323929e-05
 -1.60306809e-05 -1.57460012e-04  3.51491021e-05  1.13513950e-03
  1.56065953e-04 -3.69976980e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:43 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6598619        1
[INPUT] 0    0    [1    /1   ]  7617.51337778        1
[INPUT] 0    0    [1    /1   ]  3617.35517877        1
[INPUT] 0    0    [1    /1   ]  1597.65136733        1
[INPUT] 0    0    [1    /1   ]  382.612589571        1
[INPUT] 0    0    [1    /1   ]  111.466338213        1
[INPUT] 0    0    [1    /1   ]  38.1718556967        1
[INPUT] 0    0    [1    /1   ]  12.7223626304        1
[INPUT] 0    0    [1    /1   ]  6.25023464555        1
[INPUT] 0    0    [1    /1   ]  0.629074243393       1
[INPUT] 0    0    [1    /1   ]  2.75615373938        1
[INPUT] 0    0    [1    /1   ]  0.224887409797       1
[INPUT] 1    0    [1    /1   ]  1362.78455231        1
[INPUT] 1    0    [1    /1   ]  664.73238716         1
[INPUT] 1    0    [1    /1   ]  300.899297404        1
[INPUT] 1    0    [1    /1   ]  313.988219751        1
[INPUT] 1    0    [1    /1   ]  61.6643966823        1
[INPUT] 1    0    [1    /1   ]  7.33454826487        1
[INPUT] 1    0    [1    /1   ]  20.2443412678        1
[INPUT] 1    0    [1    /1   ]  0.775045994901       1
[INPUT] 1    0    [1    /1   ]  2.80996662971        1
[INPUT] 1    0    [1    /1   ]  0.22227427186        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659861882225, 1.0]], [0, [7617.513377783053, 1.0]], [0, [3617.3551787674987, 1.0]], [0, [1597.6513673280483, 1.0]], [0, [382.6125895708101, 1.0]], [0, [111.46633821271634, 1.0]], [0, [38.1718556967133, 1.0]], [0, [12.722362630419571, 1.0]], [0, [6.250234645551218, 1.0]], [0, [0.6290742433931826, 1.0]], [0, [2.756153739380747, 1.0]], [0, [0.22488740979691668, 1.0]], [1, [1362.784552314627, 1.0]], [1, [664.7323871600888, 1.0]], [1, [300.89929740436827, 1.0]], [1, [313.9882197512636, 1.0]], [1, [61.66439668226211, 1.0]], [1, [7.334548264867084, 1.0]], [1, [20.244341267807872, 1.0]], [1, [0.775045994901081, 1.0]], [1, [2.809966629714972, 1.0]], [1, [0.22227427186014379, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65986188]
bas 1, expnt(s) = [7617.51337778]
bas 2, expnt(s) = [3617.35517877]
bas 3, expnt(s) = [1597.65136733]
bas 4, expnt(s) = [382.61258957]
bas 5, expnt(s) = [111.46633821]
bas 6, expnt(s) = [38.1718557]
bas 7, expnt(s) = [12.72236263]
bas 8, expnt(s) = [6.25023465]
bas 9, expnt(s) = [0.62907424]
bas 10, expnt(s) = [2.75615374]
bas 11, expnt(s) = [0.22488741]
bas 12, expnt(s) = [1362.78455231]
bas 13, expnt(s) = [664.73238716]
bas 14, expnt(s) = [300.8992974]
bas 15, expnt(s) = [313.98821975]
bas 16, expnt(s) = [61.66439668]
bas 17, expnt(s) = [7.33454826]
bas 18, expnt(s) = [20.24434127]
bas 19, expnt(s) = [0.77504599]
bas 20, expnt(s) = [2.80996663]
bas 21, expnt(s) = [0.22227427]
CPU time:       257.00
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826599e+04 5.20026346e+03 7.61751338e+03 2.06003663e+03
 3.61735518e+03 1.17844248e+03 1.59765137e+03 6.38449477e+02
 3.82612590e+02 2.18566937e+02 1.11466338e+02 8.66708039e+01
 3.81718557e+01 3.87991739e+01 1.27223626e+01 1.70192670e+01
 6.25023465e+00 9.98705095e+00 6.29074243e-01 1.78460232e+00
 2.75615374e+00 5.40433925e+00 2.24887410e-01 8.25066362e-01
 1.36278455e+03 2.41556315e+04 6.64732387e+02 9.84675067e+03
 3.00899297e+02 3.65603934e+03 3.13988220e+02 3.85590287e+03
 6.16643967e+01 5.04112540e+02 7.33454826e+00 3.52128443e+01
 2.02443413e+01 1.25274868e+02 7.75045995e-01 2.12150343e+00
 2.80996663e+00 1.06135543e+01 2.22274272e-01 4.45241757e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99386145942051
cond(S) = 114082.06109055427
E1 = -729.5377656856012  E_coul = 203.1747166220251
init E= -526.363049063576
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555810414288469  LUMO = 0.887507281565314
  mo_energy =
[-1.18331028e+02 -1.22067153e+01 -9.44720623e+00 -9.44720623e+00
 -9.44720623e+00 -1.24029209e+00 -5.55810414e-01 -5.55810414e-01
 -5.55810414e-01  8.87507282e-01  1.03062801e+00  1.03062801e+00
  1.03062801e+00  7.34453791e+00  7.34453791e+00  7.34453791e+00
  8.49322318e+00  3.35271003e+01  3.35271003e+01  3.35271003e+01
  3.86281706e+01  1.29201888e+02  1.29201888e+02  1.29201888e+02
  1.54869506e+02  4.83644539e+02  4.83644539e+02  4.83644539e+02
  6.45663539e+02  1.33543605e+03  1.33543605e+03  1.33543605e+03
  2.71202845e+03  3.02958459e+03  3.02958459e+03  3.02958459e+03
  6.65002301e+03  6.65002301e+03  6.65002301e+03  9.11354810e+03
  2.54663747e+04  7.62053643e+04]
E1 = -727.8307625031442  E_coul = 201.08468690259858
cycle= 1 E= -526.746075600546  delta_E= -0.383  |g|= 0.187  |ddm|= 0.307
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.557157
diis-c [-0.31042396  1.        ]
  HOMO = -0.591165080757199  LUMO = 0.862614552953062
  mo_energy =
[-1.18641306e+02 -1.23454317e+01 -9.59696055e+00 -9.59696055e+00
 -9.59696055e+00 -1.28008565e+00 -5.91165081e-01 -5.91165081e-01
 -5.91165081e-01  8.62614553e-01  1.00598672e+00  1.00598672e+00
  1.00598672e+00  7.25295892e+00  7.25295892e+00  7.25295892e+00
  8.40592674e+00  3.33714955e+01  3.33714955e+01  3.33714955e+01
  3.84844323e+01  1.28971629e+02  1.28971629e+02  1.28971629e+02
  1.54641761e+02  4.83335395e+02  4.83335395e+02  4.83335395e+02
  6.45316984e+02  1.33507000e+03  1.33507000e+03  1.33507000e+03
  2.71152868e+03  3.02915222e+03  3.02915222e+03  3.02915222e+03
  6.64947699e+03  6.64947699e+03  6.64947699e+03  9.11292712e+03
  2.54656591e+04  7.62045584e+04]
E1 = -728.4102423498296  E_coul = 201.66343284385835
cycle= 2 E= -526.746809505971  delta_E= -0.000734  |g|= 0.0381  |ddm|= 0.0531
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0771052
diis-c [-0.00357311  0.08081738  0.91918262]
  HOMO = -0.581964090070203  LUMO = 0.869832298268133
  mo_energy =
[-1.18572826e+02 -1.23069449e+01 -9.55679746e+00 -9.55679746e+00
 -9.55679746e+00 -1.26906439e+00 -5.81964090e-01 -5.81964090e-01
 -5.81964090e-01  8.69832298e-01  1.01277233e+00  1.01277233e+00
  1.01277233e+00  7.27695691e+00  7.27695691e+00  7.27695691e+00
  8.42979259e+00  3.34120228e+01  3.34120228e+01  3.34120228e+01
  3.85234195e+01  1.29028173e+02  1.29028173e+02  1.29028173e+02
  1.54698748e+02  4.83403057e+02  4.83403057e+02  4.83403057e+02
  6.45386748e+02  1.33514175e+03  1.33514175e+03  1.33514175e+03
  2.71160369e+03  3.02922622e+03  3.02922622e+03  3.02922622e+03
  6.64955275e+03  6.64955275e+03  6.64955275e+03  9.11300368e+03
  2.54657362e+04  7.62046358e+04]
E1 = -728.2577799888124  E_coul = 201.51091030006546
cycle= 3 E= -526.746869688747  delta_E= -6.02e-05  |g|= 0.00645  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136453
diis-c [-8.12382673e-07 -1.29164167e-03  1.45789170e-01  8.55502472e-01]
  HOMO = -0.583503462464862  LUMO = 0.868718433245856
  mo_energy =
[-1.18583044e+02 -1.23129021e+01 -9.56311245e+00 -9.56311245e+00
 -9.56311245e+00 -1.27079457e+00 -5.83503462e-01 -5.83503462e-01
 -5.83503462e-01  8.68718433e-01  1.01166291e+00  1.01166291e+00
  1.01166291e+00  7.27308329e+00  7.27308329e+00  7.27308329e+00
  8.42602131e+00  3.34056899e+01  3.34056899e+01  3.34056899e+01
  3.85173718e+01  1.29019607e+02  1.29019607e+02  1.29019607e+02
  1.54690151e+02  4.83392956e+02  4.83392956e+02  4.83392956e+02
  6.45376318e+02  1.33513104e+03  1.33513104e+03  1.33513104e+03
  2.71159234e+03  3.02921512e+03  3.02921512e+03  3.02921512e+03
  6.64954125e+03  6.64954125e+03  6.64954125e+03  9.11299196e+03
  2.54657243e+04  7.62046238e+04]
E1 = -728.2811770859245  E_coul = 201.5343053739923
cycle= 4 E= -526.746871711932  delta_E= -2.02e-06  |g|= 0.000107  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000121799
diis-c [-5.52792325e-09  8.98479463e-05 -1.25596474e-02 -7.80382764e-02
  1.09050808e+00]
  HOMO = -0.583484689961486  LUMO = 0.868751345107155
  mo_energy =
[-1.18582996e+02 -1.23128319e+01 -9.56305646e+00 -9.56305646e+00
 -9.56305646e+00 -1.27075047e+00 -5.83484690e-01 -5.83484690e-01
 -5.83484690e-01  8.68751345e-01  1.01167932e+00  1.01167932e+00
  1.01167932e+00  7.27312769e+00  7.27312769e+00  7.27312769e+00
  8.42607985e+00  3.34057439e+01  3.34057439e+01  3.34057439e+01
  3.85174339e+01  1.29019662e+02  1.29019662e+02  1.29019662e+02
  1.54690208e+02  4.83393005e+02  4.83393005e+02  4.83393005e+02
  6.45376359e+02  1.33513108e+03  1.33513108e+03  1.33513108e+03
  2.71159236e+03  3.02921515e+03  3.02921515e+03  3.02921515e+03
  6.64954126e+03  6.64954126e+03  6.64954126e+03  9.11299196e+03
  2.54657243e+04  7.62046238e+04]
E1 = -728.2809327941892  E_coul = 201.5340610801176
cycle= 5 E= -526.746871714072  delta_E= -2.14e-09  |g|= 2.12e-05  |ddm|= 0.000175
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.94299e-05
diis-c [-1.01131112e-10  1.34483103e-05 -1.74556721e-03 -1.29797616e-02
  3.55403135e-02  9.79171567e-01]
  HOMO = -0.583492767346288  LUMO = 0.868747608900759
  mo_energy =
[-1.18583028e+02 -1.23128561e+01 -9.56308253e+00 -9.56308253e+00
 -9.56308253e+00 -1.27075695e+00 -5.83492767e-01 -5.83492767e-01
 -5.83492767e-01  8.68747609e-01  1.01167394e+00  1.01167394e+00
  1.01167394e+00  7.27310988e+00  7.27310988e+00  7.27310988e+00
  8.42606346e+00  3.34057187e+01  3.34057187e+01  3.34057187e+01
  3.85174096e+01  1.29019632e+02  1.29019632e+02  1.29019632e+02
  1.54690179e+02  4.83392973e+02  4.83392973e+02  4.83392973e+02
  6.45376327e+02  1.33513105e+03  1.33513105e+03  1.33513105e+03
  2.71159233e+03  3.02921512e+03  3.02921512e+03  3.02921512e+03
  6.64954123e+03  6.64954123e+03  6.64954123e+03  9.11299193e+03
  2.54657243e+04  7.62046237e+04]
E1 = -728.2810185676217  E_coul = 201.5341468534852
cycle= 6 E= -526.746871714136  delta_E= -6.48e-11  |g|= 1.87e-06  |ddm|= 2.01e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2810185676217  E_coul = 201.5341468534852
  HOMO = -0.583492650396184  LUMO = 0.868748035485265
  mo_energy =
[-1.18583027e+02 -1.23128554e+01 -9.56308194e+00 -9.56308194e+00
 -9.56308194e+00 -1.27075641e+00 -5.83492650e-01 -5.83492650e-01
 -5.83492650e-01  8.68748035e-01  1.01167409e+00  1.01167409e+00
  1.01167409e+00  7.27311027e+00  7.27311027e+00  7.27311027e+00
  8.42606401e+00  3.34057193e+01  3.34057193e+01  3.34057193e+01
  3.85174102e+01  1.29019633e+02  1.29019633e+02  1.29019633e+02
  1.54690179e+02  4.83392974e+02  4.83392974e+02  4.83392974e+02
  6.45376328e+02  1.33513105e+03  1.33513105e+03  1.33513105e+03
  2.71159233e+03  3.02921512e+03  3.02921512e+03  3.02921512e+03
  6.64954123e+03  6.64954123e+03  6.64954123e+03  9.11299193e+03
  2.54657243e+04  7.62046237e+04]
E1 = -728.2810154743995  E_coul = 201.5341437602636
Extra cycle  E= -526.746871714136  delta_E= 4.55e-13  |g|= 3.97e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826599e+04 7.61751338e+03 3.61735518e+03 1.59765137e+03
 3.82612590e+02 1.11466338e+02 3.81718557e+01 1.27223626e+01
 6.25023465e+00 6.29074243e-01 2.75615374e+00 2.24887410e-01
 1.36278455e+03 6.64732387e+02 3.00899297e+02 3.13988220e+02
 6.16643967e+01 7.33454826e+00 2.02443413e+01 7.75045995e-01
 2.80996663e+00 2.22274272e-01]
E = -526.746871714136
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:43 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6598619        1
[INPUT] 0    0    [1    /1   ]  7617.51337778        1
[INPUT] 0    0    [1    /1   ]  3617.35517877        1
[INPUT] 0    0    [1    /1   ]  1597.65136733        1
[INPUT] 0    0    [1    /1   ]  382.612589571        1
[INPUT] 0    0    [1    /1   ]  111.466338213        1
[INPUT] 0    0    [1    /1   ]  38.1718556967        1
[INPUT] 0    0    [1    /1   ]  12.7223626304        1
[INPUT] 0    0    [1    /1   ]  6.25023464555        1
[INPUT] 0    0    [1    /1   ]  0.629074243393       1
[INPUT] 0    0    [1    /1   ]  2.75615373938        1
[INPUT] 0    0    [1    /1   ]  0.224887409797       1
[INPUT] 1    0    [1    /1   ]  1362.78455231        1
[INPUT] 1    0    [1    /1   ]  664.73238716         1
[INPUT] 1    0    [1    /1   ]  300.899297404        1
[INPUT] 1    0    [1    /1   ]  313.988219751        1
[INPUT] 1    0    [1    /1   ]  61.6643966823        1
[INPUT] 1    0    [1    /1   ]  7.33454826487        1
[INPUT] 1    0    [1    /1   ]  20.2443412678        1
[INPUT] 1    0    [1    /1   ]  0.775045994901       1
[INPUT] 1    0    [1    /1   ]  2.80996662971        1
[INPUT] 1    0    [1    /1   ]  0.22227427186        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659861882225, 1.0]], [0, [7617.513377783053, 1.0]], [0, [3617.3551787674987, 1.0]], [0, [1597.6513673280483, 1.0]], [0, [382.6125895708101, 1.0]], [0, [111.46633821271634, 1.0]], [0, [38.1718556967133, 1.0]], [0, [12.722362630419571, 1.0]], [0, [6.250234645551218, 1.0]], [0, [0.6290742433931826, 1.0]], [0, [2.756153739380747, 1.0]], [0, [0.22488740979691668, 1.0]], [1, [1362.784552314627, 1.0]], [1, [664.7323871600888, 1.0]], [1, [300.89929740436827, 1.0]], [1, [313.9882197512636, 1.0]], [1, [61.66439668226211, 1.0]], [1, [7.334548264867084, 1.0]], [1, [20.244341267807872, 1.0]], [1, [0.775045994901081, 1.0]], [1, [2.809966629714972, 1.0]], [1, [0.22227427186014379, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65986188]
bas 1, expnt(s) = [7617.51337778]
bas 2, expnt(s) = [3617.35517877]
bas 3, expnt(s) = [1597.65136733]
bas 4, expnt(s) = [382.61258957]
bas 5, expnt(s) = [111.46633821]
bas 6, expnt(s) = [38.1718557]
bas 7, expnt(s) = [12.72236263]
bas 8, expnt(s) = [6.25023465]
bas 9, expnt(s) = [0.62907424]
bas 10, expnt(s) = [2.75615374]
bas 11, expnt(s) = [0.22488741]
bas 12, expnt(s) = [1362.78455231]
bas 13, expnt(s) = [664.73238716]
bas 14, expnt(s) = [300.8992974]
bas 15, expnt(s) = [313.98821975]
bas 16, expnt(s) = [61.66439668]
bas 17, expnt(s) = [7.33454826]
bas 18, expnt(s) = [20.24434127]
bas 19, expnt(s) = [0.77504599]
bas 20, expnt(s) = [2.80996663]
bas 21, expnt(s) = [0.22227427]
CPU time:       257.41
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826599e+04 5.20026346e+03 7.61751338e+03 2.06003663e+03
 3.61735518e+03 1.17844248e+03 1.59765137e+03 6.38449477e+02
 3.82612590e+02 2.18566937e+02 1.11466338e+02 8.66708039e+01
 3.81718557e+01 3.87991739e+01 1.27223626e+01 1.70192670e+01
 6.25023465e+00 9.98705095e+00 6.29074243e-01 1.78460232e+00
 2.75615374e+00 5.40433925e+00 2.24887410e-01 8.25066362e-01
 1.36278455e+03 2.41556315e+04 6.64732387e+02 9.84675067e+03
 3.00899297e+02 3.65603934e+03 3.13988220e+02 3.85590287e+03
 6.16643967e+01 5.04112540e+02 7.33454826e+00 3.52128443e+01
 2.02443413e+01 1.25274868e+02 7.75045995e-01 2.12150343e+00
 2.80996663e+00 1.06135543e+01 2.22274272e-01 4.45241757e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99386145942051
cond(S) = 114082.06109055427
E1 = -729.5377656856012  E_coul = 203.1747166220251
init E= -526.363049063576
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555810414288469  LUMO = 0.887507281565314
  mo_energy =
[-1.18331028e+02 -1.22067153e+01 -9.44720623e+00 -9.44720623e+00
 -9.44720623e+00 -1.24029209e+00 -5.55810414e-01 -5.55810414e-01
 -5.55810414e-01  8.87507282e-01  1.03062801e+00  1.03062801e+00
  1.03062801e+00  7.34453791e+00  7.34453791e+00  7.34453791e+00
  8.49322318e+00  3.35271003e+01  3.35271003e+01  3.35271003e+01
  3.86281706e+01  1.29201888e+02  1.29201888e+02  1.29201888e+02
  1.54869506e+02  4.83644539e+02  4.83644539e+02  4.83644539e+02
  6.45663539e+02  1.33543605e+03  1.33543605e+03  1.33543605e+03
  2.71202845e+03  3.02958459e+03  3.02958459e+03  3.02958459e+03
  6.65002301e+03  6.65002301e+03  6.65002301e+03  9.11354810e+03
  2.54663747e+04  7.62053643e+04]
E1 = -727.8307625031442  E_coul = 201.08468690259858
cycle= 1 E= -526.746075600546  delta_E= -0.383  |g|= 0.187  |ddm|= 0.307
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.557157
diis-c [-0.31042396  1.        ]
  HOMO = -0.591165080757199  LUMO = 0.862614552953062
  mo_energy =
[-1.18641306e+02 -1.23454317e+01 -9.59696055e+00 -9.59696055e+00
 -9.59696055e+00 -1.28008565e+00 -5.91165081e-01 -5.91165081e-01
 -5.91165081e-01  8.62614553e-01  1.00598672e+00  1.00598672e+00
  1.00598672e+00  7.25295892e+00  7.25295892e+00  7.25295892e+00
  8.40592674e+00  3.33714955e+01  3.33714955e+01  3.33714955e+01
  3.84844323e+01  1.28971629e+02  1.28971629e+02  1.28971629e+02
  1.54641761e+02  4.83335395e+02  4.83335395e+02  4.83335395e+02
  6.45316984e+02  1.33507000e+03  1.33507000e+03  1.33507000e+03
  2.71152868e+03  3.02915222e+03  3.02915222e+03  3.02915222e+03
  6.64947699e+03  6.64947699e+03  6.64947699e+03  9.11292712e+03
  2.54656591e+04  7.62045584e+04]
E1 = -728.4102423498296  E_coul = 201.66343284385835
cycle= 2 E= -526.746809505971  delta_E= -0.000734  |g|= 0.0381  |ddm|= 0.0531
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0771052
diis-c [-0.00357311  0.08081738  0.91918262]
  HOMO = -0.581964090070203  LUMO = 0.869832298268133
  mo_energy =
[-1.18572826e+02 -1.23069449e+01 -9.55679746e+00 -9.55679746e+00
 -9.55679746e+00 -1.26906439e+00 -5.81964090e-01 -5.81964090e-01
 -5.81964090e-01  8.69832298e-01  1.01277233e+00  1.01277233e+00
  1.01277233e+00  7.27695691e+00  7.27695691e+00  7.27695691e+00
  8.42979259e+00  3.34120228e+01  3.34120228e+01  3.34120228e+01
  3.85234195e+01  1.29028173e+02  1.29028173e+02  1.29028173e+02
  1.54698748e+02  4.83403057e+02  4.83403057e+02  4.83403057e+02
  6.45386748e+02  1.33514175e+03  1.33514175e+03  1.33514175e+03
  2.71160369e+03  3.02922622e+03  3.02922622e+03  3.02922622e+03
  6.64955275e+03  6.64955275e+03  6.64955275e+03  9.11300368e+03
  2.54657362e+04  7.62046358e+04]
E1 = -728.2577799888124  E_coul = 201.51091030006546
cycle= 3 E= -526.746869688747  delta_E= -6.02e-05  |g|= 0.00645  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136453
diis-c [-8.12382673e-07 -1.29164167e-03  1.45789170e-01  8.55502472e-01]
  HOMO = -0.583503462464862  LUMO = 0.868718433245856
  mo_energy =
[-1.18583044e+02 -1.23129021e+01 -9.56311245e+00 -9.56311245e+00
 -9.56311245e+00 -1.27079457e+00 -5.83503462e-01 -5.83503462e-01
 -5.83503462e-01  8.68718433e-01  1.01166291e+00  1.01166291e+00
  1.01166291e+00  7.27308329e+00  7.27308329e+00  7.27308329e+00
  8.42602131e+00  3.34056899e+01  3.34056899e+01  3.34056899e+01
  3.85173718e+01  1.29019607e+02  1.29019607e+02  1.29019607e+02
  1.54690151e+02  4.83392956e+02  4.83392956e+02  4.83392956e+02
  6.45376318e+02  1.33513104e+03  1.33513104e+03  1.33513104e+03
  2.71159234e+03  3.02921512e+03  3.02921512e+03  3.02921512e+03
  6.64954125e+03  6.64954125e+03  6.64954125e+03  9.11299196e+03
  2.54657243e+04  7.62046238e+04]
E1 = -728.2811770859245  E_coul = 201.5343053739923
cycle= 4 E= -526.746871711932  delta_E= -2.02e-06  |g|= 0.000107  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000121799
diis-c [-5.52792325e-09  8.98479463e-05 -1.25596474e-02 -7.80382764e-02
  1.09050808e+00]
  HOMO = -0.583484689961486  LUMO = 0.868751345107155
  mo_energy =
[-1.18582996e+02 -1.23128319e+01 -9.56305646e+00 -9.56305646e+00
 -9.56305646e+00 -1.27075047e+00 -5.83484690e-01 -5.83484690e-01
 -5.83484690e-01  8.68751345e-01  1.01167932e+00  1.01167932e+00
  1.01167932e+00  7.27312769e+00  7.27312769e+00  7.27312769e+00
  8.42607985e+00  3.34057439e+01  3.34057439e+01  3.34057439e+01
  3.85174339e+01  1.29019662e+02  1.29019662e+02  1.29019662e+02
  1.54690208e+02  4.83393005e+02  4.83393005e+02  4.83393005e+02
  6.45376359e+02  1.33513108e+03  1.33513108e+03  1.33513108e+03
  2.71159236e+03  3.02921515e+03  3.02921515e+03  3.02921515e+03
  6.64954126e+03  6.64954126e+03  6.64954126e+03  9.11299196e+03
  2.54657243e+04  7.62046238e+04]
E1 = -728.2809327941892  E_coul = 201.5340610801176
cycle= 5 E= -526.746871714072  delta_E= -2.14e-09  |g|= 2.12e-05  |ddm|= 0.000175
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.94299e-05
diis-c [-1.01131112e-10  1.34483103e-05 -1.74556721e-03 -1.29797616e-02
  3.55403135e-02  9.79171567e-01]
  HOMO = -0.583492767346288  LUMO = 0.868747608900759
  mo_energy =
[-1.18583028e+02 -1.23128561e+01 -9.56308253e+00 -9.56308253e+00
 -9.56308253e+00 -1.27075695e+00 -5.83492767e-01 -5.83492767e-01
 -5.83492767e-01  8.68747609e-01  1.01167394e+00  1.01167394e+00
  1.01167394e+00  7.27310988e+00  7.27310988e+00  7.27310988e+00
  8.42606346e+00  3.34057187e+01  3.34057187e+01  3.34057187e+01
  3.85174096e+01  1.29019632e+02  1.29019632e+02  1.29019632e+02
  1.54690179e+02  4.83392973e+02  4.83392973e+02  4.83392973e+02
  6.45376327e+02  1.33513105e+03  1.33513105e+03  1.33513105e+03
  2.71159233e+03  3.02921512e+03  3.02921512e+03  3.02921512e+03
  6.64954123e+03  6.64954123e+03  6.64954123e+03  9.11299193e+03
  2.54657243e+04  7.62046237e+04]
E1 = -728.2810185676217  E_coul = 201.5341468534852
cycle= 6 E= -526.746871714136  delta_E= -6.48e-11  |g|= 1.87e-06  |ddm|= 2.01e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2810185676217  E_coul = 201.5341468534852
  HOMO = -0.583492650396184  LUMO = 0.868748035485265
  mo_energy =
[-1.18583027e+02 -1.23128554e+01 -9.56308194e+00 -9.56308194e+00
 -9.56308194e+00 -1.27075641e+00 -5.83492650e-01 -5.83492650e-01
 -5.83492650e-01  8.68748035e-01  1.01167409e+00  1.01167409e+00
  1.01167409e+00  7.27311027e+00  7.27311027e+00  7.27311027e+00
  8.42606401e+00  3.34057193e+01  3.34057193e+01  3.34057193e+01
  3.85174102e+01  1.29019633e+02  1.29019633e+02  1.29019633e+02
  1.54690179e+02  4.83392974e+02  4.83392974e+02  4.83392974e+02
  6.45376328e+02  1.33513105e+03  1.33513105e+03  1.33513105e+03
  2.71159233e+03  3.02921512e+03  3.02921512e+03  3.02921512e+03
  6.64954123e+03  6.64954123e+03  6.64954123e+03  9.11299193e+03
  2.54657243e+04  7.62046237e+04]
E1 = -728.2810154743995  E_coul = 201.5341437602636
Extra cycle  E= -526.746871714136  delta_E= 4.55e-13  |g|= 3.97e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114082.06109055427
E1 = -728.2810154743995  E_coul = 201.5341437602636
init E= -526.746871714136
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583492726384303  LUMO = 0.868748048110014
  mo_energy =
[-1.18583027e+02 -1.23128556e+01 -9.56308219e+00 -9.56308219e+00
 -9.56308219e+00 -1.27075641e+00 -5.83492726e-01 -5.83492726e-01
 -5.83492726e-01  8.68748048e-01  1.01167404e+00  1.01167404e+00
  1.01167404e+00  7.27311011e+00  7.27311011e+00  7.27311011e+00
  8.42606389e+00  3.34057190e+01  3.34057190e+01  3.34057190e+01
  3.85174100e+01  1.29019633e+02  1.29019633e+02  1.29019633e+02
  1.54690179e+02  4.83392973e+02  4.83392973e+02  4.83392973e+02
  6.45376327e+02  1.33513105e+03  1.33513105e+03  1.33513105e+03
  2.71159233e+03  3.02921512e+03  3.02921512e+03  3.02921512e+03
  6.64954123e+03  6.64954123e+03  6.64954123e+03  9.11299193e+03
  2.54657243e+04  7.62046237e+04]
E1 = -728.2810161851377  E_coul = 201.53414447100087
cycle= 1 E= -526.746871714137  delta_E= -7.96e-13  |g|= 9.24e-08  |ddm|= 6.13e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2810161851377  E_coul = 201.53414447100087
  HOMO = -0.583492716228145  LUMO = 0.868748070320819
  mo_energy =
[-1.18583027e+02 -1.23128556e+01 -9.56308214e+00 -9.56308214e+00
 -9.56308214e+00 -1.27075638e+00 -5.83492716e-01 -5.83492716e-01
 -5.83492716e-01  8.68748070e-01  1.01167405e+00  1.01167405e+00
  1.01167405e+00  7.27311015e+00  7.27311015e+00  7.27311015e+00
  8.42606393e+00  3.34057191e+01  3.34057191e+01  3.34057191e+01
  3.85174101e+01  1.29019633e+02  1.29019633e+02  1.29019633e+02
  1.54690179e+02  4.83392973e+02  4.83392973e+02  4.83392973e+02
  6.45376327e+02  1.33513105e+03  1.33513105e+03  1.33513105e+03
  2.71159233e+03  3.02921512e+03  3.02921512e+03  3.02921512e+03
  6.64954123e+03  6.64954123e+03  6.64954123e+03  9.11299193e+03
  2.54657243e+04  7.62046237e+04]
E1 = -728.2810159512333  E_coul = 201.53414423709526
Extra cycle  E= -526.746871714138  delta_E= -1.25e-12  |g|= 2.03e-08  |ddm|= 1.42e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.44 sec
exp = [2.61826599e+04 7.61751338e+03 3.61735518e+03 1.59765137e+03
 3.82612590e+02 1.11466338e+02 3.81718557e+01 1.27223626e+01
 6.25023465e+00 6.29074243e-01 2.75615374e+00 2.24887410e-01
 1.36278455e+03 6.64732387e+02 3.00899297e+02 3.13988220e+02
 6.16643967e+01 7.33454826e+00 2.02443413e+01 7.75045995e-01
 2.80996663e+00 2.22274272e-01]
grad_E = [-1.53616370e-06  3.51589942e-06 -1.45737133e-06  7.68194528e-05
 -1.68829919e-04 -6.66872238e-04 -9.90861802e-04  9.10202161e-05
  9.25947883e-05 -8.30494242e-04  1.88149289e-03 -1.87524921e-03
 -5.09971167e-07  4.97065502e-06  2.34141450e-05  2.01831973e-05
 -8.13755448e-06  2.95886415e-04 -5.85138304e-05  1.09042036e-03
 -5.71748507e-04 -3.58874240e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:48 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6599313        1
[INPUT] 0    0    [1    /1   ]  7617.51322754        1
[INPUT] 0    0    [1    /1   ]  3617.35525166        1
[INPUT] 0    0    [1    /1   ]  1597.6482545         1
[INPUT] 0    0    [1    /1   ]  382.61060432         1
[INPUT] 0    0    [1    /1   ]  111.52401228         1
[INPUT] 0    0    [1    /1   ]  38.2116969847        1
[INPUT] 0    0    [1    /1   ]  12.7765085412        1
[INPUT] 0    0    [1    /1   ]  6.31356485473        1
[INPUT] 0    0    [1    /1   ]  0.628062993644       1
[INPUT] 0    0    [1    /1   ]  2.76998951755        1
[INPUT] 0    0    [1    /1   ]  0.223958038293       1
[INPUT] 1    0    [1    /1   ]  1362.78457563        1
[INPUT] 1    0    [1    /1   ]  664.732158391        1
[INPUT] 1    0    [1    /1   ]  300.898219369        1
[INPUT] 1    0    [1    /1   ]  313.987290324        1
[INPUT] 1    0    [1    /1   ]  61.6647916846        1
[INPUT] 1    0    [1    /1   ]  7.3344158023         1
[INPUT] 1    0    [1    /1   ]  20.2461204235        1
[INPUT] 1    0    [1    /1   ]  0.774588443542       1
[INPUT] 1    0    [1    /1   ]  2.8032991149         1
[INPUT] 1    0    [1    /1   ]  0.222233273184       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659931333917, 1.0]], [0, [7617.513227541732, 1.0]], [0, [3617.3552516647337, 1.0]], [0, [1597.6482544954076, 1.0]], [0, [382.61060432006127, 1.0]], [0, [111.52401227985581, 1.0]], [0, [38.21169698473085, 1.0]], [0, [12.776508541169287, 1.0]], [0, [6.313564854729605, 1.0]], [0, [0.6280629936437929, 1.0]], [0, [2.7699895175473697, 1.0]], [0, [0.2239580382928362, 1.0]], [1, [1362.7845756272673, 1.0]], [1, [664.7321583906227, 1.0]], [1, [300.89821936942326, 1.0]], [1, [313.98729032392157, 1.0]], [1, [61.66479168461846, 1.0]], [1, [7.334415802303537, 1.0]], [1, [20.24612042348141, 1.0]], [1, [0.7745884435421112, 1.0]], [1, [2.803299114902947, 1.0]], [1, [0.22223327318401054, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65993133]
bas 1, expnt(s) = [7617.51322754]
bas 2, expnt(s) = [3617.35525166]
bas 3, expnt(s) = [1597.6482545]
bas 4, expnt(s) = [382.61060432]
bas 5, expnt(s) = [111.52401228]
bas 6, expnt(s) = [38.21169698]
bas 7, expnt(s) = [12.77650854]
bas 8, expnt(s) = [6.31356485]
bas 9, expnt(s) = [0.62806299]
bas 10, expnt(s) = [2.76998952]
bas 11, expnt(s) = [0.22395804]
bas 12, expnt(s) = [1362.78457563]
bas 13, expnt(s) = [664.73215839]
bas 14, expnt(s) = [300.89821937]
bas 15, expnt(s) = [313.98729032]
bas 16, expnt(s) = [61.66479168]
bas 17, expnt(s) = [7.3344158]
bas 18, expnt(s) = [20.24612042]
bas 19, expnt(s) = [0.77458844]
bas 20, expnt(s) = [2.80329911]
bas 21, expnt(s) = [0.22223327]
CPU time:       263.05
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826599e+04 5.20026347e+03 7.61751323e+03 2.06003660e+03
 3.61735525e+03 1.17844250e+03 1.59764825e+03 6.38448544e+02
 3.82610604e+02 2.18566087e+02 1.11524012e+02 8.67044352e+01
 3.82116970e+01 3.88295420e+01 1.27765085e+01 1.70735632e+01
 6.31356485e+00 1.00628502e+01 6.28062994e-01 1.78245029e+00
 2.76998952e+00 5.42467368e+00 2.23958038e-01 8.22507781e-01
 1.36278458e+03 2.41556320e+04 6.64732158e+02 9.84674644e+03
 3.00898219e+02 3.65602296e+03 3.13987290e+02 3.85588860e+03
 6.16647917e+01 5.04116577e+02 7.33441580e+00 3.52120493e+01
 2.02461204e+01 1.25288631e+02 7.74588444e-01 2.11993800e+00
 2.80329911e+00 1.05820837e+01 2.22233273e-01 4.45139103e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993870836424804
cond(S) = 114115.0651612841
E1 = -729.5380795050744  E_coul = 203.174945966015
init E= -526.363133539059
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555805255752916  LUMO = 0.883920322792206
  mo_energy =
[-1.18331044e+02 -1.22066833e+01 -9.44718534e+00 -9.44718534e+00
 -9.44718534e+00 -1.24028587e+00 -5.55805256e-01 -5.55805256e-01
 -5.55805256e-01  8.83920323e-01  1.03000294e+00  1.03000294e+00
  1.03000294e+00  7.33131845e+00  7.33131845e+00  7.33131845e+00
  8.54956982e+00  3.35024697e+01  3.35024697e+01  3.35024697e+01
  3.89277071e+01  1.29182977e+02  1.29182977e+02  1.29182977e+02
  1.55478155e+02  4.83631882e+02  4.83631882e+02  4.83631882e+02
  6.46459474e+02  1.33542361e+03  1.33542361e+03  1.33542361e+03
  2.71282606e+03  3.02957030e+03  3.02957030e+03  3.02957030e+03
  6.65000771e+03  6.65000771e+03  6.65000771e+03  9.11429376e+03
  2.54670806e+04  7.62060216e+04]
E1 = -727.8299993562715  E_coul = 201.08389656573337
cycle= 1 E= -526.746102790538  delta_E= -0.383  |g|= 0.187  |ddm|= 0.306
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.55727
diis-c [-0.31055022  1.        ]
  HOMO = -0.591179784007756  LUMO = 0.859072986593415
  mo_energy =
[-1.18641422e+02 -1.23454907e+01 -9.59702421e+00 -9.59702421e+00
 -9.59702421e+00 -1.28008484e+00 -5.91179784e-01 -5.91179784e-01
 -5.91179784e-01  8.59072987e-01  1.00537231e+00  1.00537231e+00
  1.00537231e+00  7.23975993e+00  7.23975993e+00  7.23975993e+00
  8.46182793e+00  3.33467784e+01  3.33467784e+01  3.33467784e+01
  3.87835471e+01  1.28952607e+02  1.28952607e+02  1.28952607e+02
  1.55250227e+02  4.83322645e+02  4.83322645e+02  4.83322645e+02
  6.46112812e+02  1.33505745e+03  1.33505745e+03  1.33505745e+03
  2.71232621e+03  3.02913782e+03  3.02913782e+03  3.02913782e+03
  6.64946160e+03  6.64946160e+03  6.64946160e+03  9.11367268e+03
  2.54663649e+04  7.62052155e+04]
E1 = -728.4095897247488  E_coul = 201.66275262073125
cycle= 2 E= -526.746837104018  delta_E= -0.000734  |g|= 0.0381  |ddm|= 0.0531
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.077091
diis-c [-0.00357572  0.08072711  0.91927289]
  HOMO = -0.581974792197576  LUMO = 0.866284156926539
  mo_energy =
[-1.18572926e+02 -1.23069930e+01 -9.55685081e+00 -9.55685081e+00
 -9.55685081e+00 -1.26905634e+00 -5.81974792e-01 -5.81974792e-01
 -5.81974792e-01  8.66284157e-01  1.01215513e+00  1.01215513e+00
  1.01215513e+00  7.26374350e+00  7.26374350e+00  7.26374350e+00
  8.48580609e+00  3.33873171e+01  3.33873171e+01  3.33873171e+01
  3.88226299e+01  1.29009166e+02  1.29009166e+02  1.29009166e+02
  1.55307243e+02  4.83390322e+02  4.83390322e+02  4.83390322e+02
  6.46182590e+02  1.33512921e+03  1.33512921e+03  1.33512921e+03
  2.71240123e+03  3.02921184e+03  3.02921184e+03  3.02921184e+03
  6.64953737e+03  6.64953737e+03  6.64953737e+03  9.11374926e+03
  2.54664421e+04  7.62052930e+04]
E1 = -728.2570794068906  E_coul = 201.5101820956733
cycle= 3 E= -526.746897311217  delta_E= -6.02e-05  |g|= 0.00645  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136542
diis-c [-8.16844535e-07 -1.29212300e-03  1.45896399e-01  8.55395724e-01]
  HOMO = -0.583515665450191  LUMO = 0.865171858807191
  mo_energy =
[-1.18583153e+02 -1.23129550e+01 -9.56317093e+00 -9.56317093e+00
 -9.56317093e+00 -1.27078709e+00 -5.83515665e-01 -5.83515665e-01
 -5.83515665e-01  8.65171859e-01  1.01104573e+00  1.01104573e+00
  1.01104573e+00  7.25987022e+00  7.25987022e+00  7.25987022e+00
  8.48201615e+00  3.33809788e+01  3.33809788e+01  3.33809788e+01
  3.88165645e+01  1.29000592e+02  1.29000592e+02  1.29000592e+02
  1.55298637e+02  4.83380213e+02  4.83380213e+02  4.83380213e+02
  6.46172152e+02  1.33511850e+03  1.33511850e+03  1.33511850e+03
  2.71238987e+03  3.02920073e+03  3.02920073e+03  3.02920073e+03
  6.64952586e+03  6.64952586e+03  6.64952586e+03  9.11373753e+03
  2.54664302e+04  7.62052809e+04]
E1 = -728.280490790807  E_coul = 201.53359145290815
cycle= 4 E= -526.746899337899  delta_E= -2.03e-06  |g|= 0.000108  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000123071
diis-c [-5.57799898e-09  9.08388582e-05 -1.26915429e-02 -7.88288757e-02
  1.09142958e+00]
  HOMO = -0.583497144629464  LUMO = 0.865204823196332
  mo_energy =
[-1.18583105e+02 -1.23128853e+01 -9.56311556e+00 -9.56311556e+00
 -9.56311556e+00 -1.27074291e+00 -5.83497145e-01 -5.83497145e-01
 -5.83497145e-01  8.65204823e-01  1.01106199e+00  1.01106199e+00
  1.01106199e+00  7.25991415e+00  7.25991415e+00  7.25991415e+00
  8.48207453e+00  3.33810322e+01  3.33810322e+01  3.33810322e+01
  3.88166260e+01  1.29000646e+02  1.29000646e+02  1.29000646e+02
  1.55298693e+02  4.83380261e+02  4.83380261e+02  4.83380261e+02
  6.46172192e+02  1.33511854e+03  1.33511854e+03  1.33511854e+03
  2.71238989e+03  3.02920076e+03  3.02920076e+03  3.02920076e+03
  6.64952587e+03  6.64952587e+03  6.64952587e+03  9.11373753e+03
  2.54664301e+04  7.62052809e+04]
E1 = -728.2802475856646  E_coul = 201.53334824556185
cycle= 5 E= -526.746899340103  delta_E= -2.2e-09  |g|= 2.13e-05  |ddm|= 0.000178
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.95045e-05
diis-c [-1.02687615e-10  1.34846710e-05 -1.74961972e-03 -1.29957590e-02
  3.42562559e-02  9.80475638e-01]
  HOMO = -0.583505257157041  LUMO = 0.86520110012705
  mo_energy =
[-1.18583137e+02 -1.23129095e+01 -9.56314171e+00 -9.56314171e+00
 -9.56314171e+00 -1.27074939e+00 -5.83505257e-01 -5.83505257e-01
 -5.83505257e-01  8.65201100e-01  1.01105661e+00  1.01105661e+00
  1.01105661e+00  7.25989629e+00  7.25989629e+00  7.25989629e+00
  8.48205803e+00  3.33810069e+01  3.33810069e+01  3.33810069e+01
  3.88166017e+01  1.29000617e+02  1.29000617e+02  1.29000617e+02
  1.55298663e+02  4.83380229e+02  4.83380229e+02  4.83380229e+02
  6.46172159e+02  1.33511850e+03  1.33511850e+03  1.33511850e+03
  2.71238986e+03  3.02920073e+03  3.02920073e+03  3.02920073e+03
  6.64952584e+03  6.64952584e+03  6.64952584e+03  9.11373750e+03
  2.54664301e+04  7.62052809e+04]
E1 = -728.2803335117721  E_coul = 201.53343417160298
cycle= 6 E= -526.746899340169  delta_E= -6.64e-11  |g|= 1.87e-06  |ddm|= 2.03e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2803335117721  E_coul = 201.53343417160298
  HOMO = -0.583505128917754  LUMO = 0.865201534136922
  mo_energy =
[-1.18583136e+02 -1.23129088e+01 -9.56314108e+00 -9.56314108e+00
 -9.56314108e+00 -1.27074884e+00 -5.83505129e-01 -5.83505129e-01
 -5.83505129e-01  8.65201534e-01  1.01105676e+00  1.01105676e+00
  1.01105676e+00  7.25989672e+00  7.25989672e+00  7.25989672e+00
  8.48205861e+00  3.33810075e+01  3.33810075e+01  3.33810075e+01
  3.88166023e+01  1.29000617e+02  1.29000617e+02  1.29000617e+02
  1.55298664e+02  4.83380229e+02  4.83380229e+02  4.83380229e+02
  6.46172160e+02  1.33511850e+03  1.33511850e+03  1.33511850e+03
  2.71238986e+03  3.02920073e+03  3.02920073e+03  3.02920073e+03
  6.64952584e+03  6.64952584e+03  6.64952584e+03  9.11373750e+03
  2.54664301e+04  7.62052809e+04]
E1 = -728.2803302686605  E_coul = 201.5334309284912
Extra cycle  E= -526.746899340169  delta_E=    0  |g|= 3.99e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.29 sec, wall time      0.26 sec
exp = [2.61826599e+04 7.61751323e+03 3.61735525e+03 1.59764825e+03
 3.82610604e+02 1.11524012e+02 3.82116970e+01 1.27765085e+01
 6.31356485e+00 6.28062994e-01 2.76998952e+00 2.23958038e-01
 1.36278458e+03 6.64732158e+02 3.00898219e+02 3.13987290e+02
 6.16647917e+01 7.33441580e+00 2.02461204e+01 7.74588444e-01
 2.80329911e+00 2.22233273e-01]
E = -526.7468993401692
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:48 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6599313        1
[INPUT] 0    0    [1    /1   ]  7617.51322754        1
[INPUT] 0    0    [1    /1   ]  3617.35525166        1
[INPUT] 0    0    [1    /1   ]  1597.6482545         1
[INPUT] 0    0    [1    /1   ]  382.61060432         1
[INPUT] 0    0    [1    /1   ]  111.52401228         1
[INPUT] 0    0    [1    /1   ]  38.2116969847        1
[INPUT] 0    0    [1    /1   ]  12.7765085412        1
[INPUT] 0    0    [1    /1   ]  6.31356485473        1
[INPUT] 0    0    [1    /1   ]  0.628062993644       1
[INPUT] 0    0    [1    /1   ]  2.76998951755        1
[INPUT] 0    0    [1    /1   ]  0.223958038293       1
[INPUT] 1    0    [1    /1   ]  1362.78457563        1
[INPUT] 1    0    [1    /1   ]  664.732158391        1
[INPUT] 1    0    [1    /1   ]  300.898219369        1
[INPUT] 1    0    [1    /1   ]  313.987290324        1
[INPUT] 1    0    [1    /1   ]  61.6647916846        1
[INPUT] 1    0    [1    /1   ]  7.3344158023         1
[INPUT] 1    0    [1    /1   ]  20.2461204235        1
[INPUT] 1    0    [1    /1   ]  0.774588443542       1
[INPUT] 1    0    [1    /1   ]  2.8032991149         1
[INPUT] 1    0    [1    /1   ]  0.222233273184       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.659931333917, 1.0]], [0, [7617.513227541732, 1.0]], [0, [3617.3552516647337, 1.0]], [0, [1597.6482544954076, 1.0]], [0, [382.61060432006127, 1.0]], [0, [111.52401227985581, 1.0]], [0, [38.21169698473085, 1.0]], [0, [12.776508541169287, 1.0]], [0, [6.313564854729605, 1.0]], [0, [0.6280629936437929, 1.0]], [0, [2.7699895175473697, 1.0]], [0, [0.2239580382928362, 1.0]], [1, [1362.7845756272673, 1.0]], [1, [664.7321583906227, 1.0]], [1, [300.89821936942326, 1.0]], [1, [313.98729032392157, 1.0]], [1, [61.66479168461846, 1.0]], [1, [7.334415802303537, 1.0]], [1, [20.24612042348141, 1.0]], [1, [0.7745884435421112, 1.0]], [1, [2.803299114902947, 1.0]], [1, [0.22223327318401054, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.65993133]
bas 1, expnt(s) = [7617.51322754]
bas 2, expnt(s) = [3617.35525166]
bas 3, expnt(s) = [1597.6482545]
bas 4, expnt(s) = [382.61060432]
bas 5, expnt(s) = [111.52401228]
bas 6, expnt(s) = [38.21169698]
bas 7, expnt(s) = [12.77650854]
bas 8, expnt(s) = [6.31356485]
bas 9, expnt(s) = [0.62806299]
bas 10, expnt(s) = [2.76998952]
bas 11, expnt(s) = [0.22395804]
bas 12, expnt(s) = [1362.78457563]
bas 13, expnt(s) = [664.73215839]
bas 14, expnt(s) = [300.89821937]
bas 15, expnt(s) = [313.98729032]
bas 16, expnt(s) = [61.66479168]
bas 17, expnt(s) = [7.3344158]
bas 18, expnt(s) = [20.24612042]
bas 19, expnt(s) = [0.77458844]
bas 20, expnt(s) = [2.80329911]
bas 21, expnt(s) = [0.22223327]
CPU time:       263.47
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826599e+04 5.20026347e+03 7.61751323e+03 2.06003660e+03
 3.61735525e+03 1.17844250e+03 1.59764825e+03 6.38448544e+02
 3.82610604e+02 2.18566087e+02 1.11524012e+02 8.67044352e+01
 3.82116970e+01 3.88295420e+01 1.27765085e+01 1.70735632e+01
 6.31356485e+00 1.00628502e+01 6.28062994e-01 1.78245029e+00
 2.76998952e+00 5.42467368e+00 2.23958038e-01 8.22507781e-01
 1.36278458e+03 2.41556320e+04 6.64732158e+02 9.84674644e+03
 3.00898219e+02 3.65602296e+03 3.13987290e+02 3.85588860e+03
 6.16647917e+01 5.04116577e+02 7.33441580e+00 3.52120493e+01
 2.02461204e+01 1.25288631e+02 7.74588444e-01 2.11993800e+00
 2.80329911e+00 1.05820837e+01 2.22233273e-01 4.45139103e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993870836424804
cond(S) = 114115.0651612841
E1 = -729.5380795050744  E_coul = 203.174945966015
init E= -526.363133539059
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555805255752916  LUMO = 0.883920322792206
  mo_energy =
[-1.18331044e+02 -1.22066833e+01 -9.44718534e+00 -9.44718534e+00
 -9.44718534e+00 -1.24028587e+00 -5.55805256e-01 -5.55805256e-01
 -5.55805256e-01  8.83920323e-01  1.03000294e+00  1.03000294e+00
  1.03000294e+00  7.33131845e+00  7.33131845e+00  7.33131845e+00
  8.54956982e+00  3.35024697e+01  3.35024697e+01  3.35024697e+01
  3.89277071e+01  1.29182977e+02  1.29182977e+02  1.29182977e+02
  1.55478155e+02  4.83631882e+02  4.83631882e+02  4.83631882e+02
  6.46459474e+02  1.33542361e+03  1.33542361e+03  1.33542361e+03
  2.71282606e+03  3.02957030e+03  3.02957030e+03  3.02957030e+03
  6.65000771e+03  6.65000771e+03  6.65000771e+03  9.11429376e+03
  2.54670806e+04  7.62060216e+04]
E1 = -727.8299993562715  E_coul = 201.08389656573337
cycle= 1 E= -526.746102790538  delta_E= -0.383  |g|= 0.187  |ddm|= 0.306
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.55727
diis-c [-0.31055022  1.        ]
  HOMO = -0.591179784007756  LUMO = 0.859072986593415
  mo_energy =
[-1.18641422e+02 -1.23454907e+01 -9.59702421e+00 -9.59702421e+00
 -9.59702421e+00 -1.28008484e+00 -5.91179784e-01 -5.91179784e-01
 -5.91179784e-01  8.59072987e-01  1.00537231e+00  1.00537231e+00
  1.00537231e+00  7.23975993e+00  7.23975993e+00  7.23975993e+00
  8.46182793e+00  3.33467784e+01  3.33467784e+01  3.33467784e+01
  3.87835471e+01  1.28952607e+02  1.28952607e+02  1.28952607e+02
  1.55250227e+02  4.83322645e+02  4.83322645e+02  4.83322645e+02
  6.46112812e+02  1.33505745e+03  1.33505745e+03  1.33505745e+03
  2.71232621e+03  3.02913782e+03  3.02913782e+03  3.02913782e+03
  6.64946160e+03  6.64946160e+03  6.64946160e+03  9.11367268e+03
  2.54663649e+04  7.62052155e+04]
E1 = -728.4095897247488  E_coul = 201.66275262073125
cycle= 2 E= -526.746837104018  delta_E= -0.000734  |g|= 0.0381  |ddm|= 0.0531
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.077091
diis-c [-0.00357572  0.08072711  0.91927289]
  HOMO = -0.581974792197576  LUMO = 0.866284156926539
  mo_energy =
[-1.18572926e+02 -1.23069930e+01 -9.55685081e+00 -9.55685081e+00
 -9.55685081e+00 -1.26905634e+00 -5.81974792e-01 -5.81974792e-01
 -5.81974792e-01  8.66284157e-01  1.01215513e+00  1.01215513e+00
  1.01215513e+00  7.26374350e+00  7.26374350e+00  7.26374350e+00
  8.48580609e+00  3.33873171e+01  3.33873171e+01  3.33873171e+01
  3.88226299e+01  1.29009166e+02  1.29009166e+02  1.29009166e+02
  1.55307243e+02  4.83390322e+02  4.83390322e+02  4.83390322e+02
  6.46182590e+02  1.33512921e+03  1.33512921e+03  1.33512921e+03
  2.71240123e+03  3.02921184e+03  3.02921184e+03  3.02921184e+03
  6.64953737e+03  6.64953737e+03  6.64953737e+03  9.11374926e+03
  2.54664421e+04  7.62052930e+04]
E1 = -728.2570794068906  E_coul = 201.5101820956733
cycle= 3 E= -526.746897311217  delta_E= -6.02e-05  |g|= 0.00645  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136542
diis-c [-8.16844535e-07 -1.29212300e-03  1.45896399e-01  8.55395724e-01]
  HOMO = -0.583515665450191  LUMO = 0.865171858807191
  mo_energy =
[-1.18583153e+02 -1.23129550e+01 -9.56317093e+00 -9.56317093e+00
 -9.56317093e+00 -1.27078709e+00 -5.83515665e-01 -5.83515665e-01
 -5.83515665e-01  8.65171859e-01  1.01104573e+00  1.01104573e+00
  1.01104573e+00  7.25987022e+00  7.25987022e+00  7.25987022e+00
  8.48201615e+00  3.33809788e+01  3.33809788e+01  3.33809788e+01
  3.88165645e+01  1.29000592e+02  1.29000592e+02  1.29000592e+02
  1.55298637e+02  4.83380213e+02  4.83380213e+02  4.83380213e+02
  6.46172152e+02  1.33511850e+03  1.33511850e+03  1.33511850e+03
  2.71238987e+03  3.02920073e+03  3.02920073e+03  3.02920073e+03
  6.64952586e+03  6.64952586e+03  6.64952586e+03  9.11373753e+03
  2.54664302e+04  7.62052809e+04]
E1 = -728.280490790807  E_coul = 201.53359145290815
cycle= 4 E= -526.746899337899  delta_E= -2.03e-06  |g|= 0.000108  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000123071
diis-c [-5.57799898e-09  9.08388582e-05 -1.26915429e-02 -7.88288757e-02
  1.09142958e+00]
  HOMO = -0.583497144629464  LUMO = 0.865204823196332
  mo_energy =
[-1.18583105e+02 -1.23128853e+01 -9.56311556e+00 -9.56311556e+00
 -9.56311556e+00 -1.27074291e+00 -5.83497145e-01 -5.83497145e-01
 -5.83497145e-01  8.65204823e-01  1.01106199e+00  1.01106199e+00
  1.01106199e+00  7.25991415e+00  7.25991415e+00  7.25991415e+00
  8.48207453e+00  3.33810322e+01  3.33810322e+01  3.33810322e+01
  3.88166260e+01  1.29000646e+02  1.29000646e+02  1.29000646e+02
  1.55298693e+02  4.83380261e+02  4.83380261e+02  4.83380261e+02
  6.46172192e+02  1.33511854e+03  1.33511854e+03  1.33511854e+03
  2.71238989e+03  3.02920076e+03  3.02920076e+03  3.02920076e+03
  6.64952587e+03  6.64952587e+03  6.64952587e+03  9.11373753e+03
  2.54664301e+04  7.62052809e+04]
E1 = -728.2802475856646  E_coul = 201.53334824556185
cycle= 5 E= -526.746899340103  delta_E= -2.2e-09  |g|= 2.13e-05  |ddm|= 0.000178
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.95045e-05
diis-c [-1.02687615e-10  1.34846710e-05 -1.74961972e-03 -1.29957590e-02
  3.42562559e-02  9.80475638e-01]
  HOMO = -0.583505257157041  LUMO = 0.86520110012705
  mo_energy =
[-1.18583137e+02 -1.23129095e+01 -9.56314171e+00 -9.56314171e+00
 -9.56314171e+00 -1.27074939e+00 -5.83505257e-01 -5.83505257e-01
 -5.83505257e-01  8.65201100e-01  1.01105661e+00  1.01105661e+00
  1.01105661e+00  7.25989629e+00  7.25989629e+00  7.25989629e+00
  8.48205803e+00  3.33810069e+01  3.33810069e+01  3.33810069e+01
  3.88166017e+01  1.29000617e+02  1.29000617e+02  1.29000617e+02
  1.55298663e+02  4.83380229e+02  4.83380229e+02  4.83380229e+02
  6.46172159e+02  1.33511850e+03  1.33511850e+03  1.33511850e+03
  2.71238986e+03  3.02920073e+03  3.02920073e+03  3.02920073e+03
  6.64952584e+03  6.64952584e+03  6.64952584e+03  9.11373750e+03
  2.54664301e+04  7.62052809e+04]
E1 = -728.2803335117721  E_coul = 201.53343417160298
cycle= 6 E= -526.746899340169  delta_E= -6.64e-11  |g|= 1.87e-06  |ddm|= 2.03e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2803335117721  E_coul = 201.53343417160298
  HOMO = -0.583505128917754  LUMO = 0.865201534136922
  mo_energy =
[-1.18583136e+02 -1.23129088e+01 -9.56314108e+00 -9.56314108e+00
 -9.56314108e+00 -1.27074884e+00 -5.83505129e-01 -5.83505129e-01
 -5.83505129e-01  8.65201534e-01  1.01105676e+00  1.01105676e+00
  1.01105676e+00  7.25989672e+00  7.25989672e+00  7.25989672e+00
  8.48205861e+00  3.33810075e+01  3.33810075e+01  3.33810075e+01
  3.88166023e+01  1.29000617e+02  1.29000617e+02  1.29000617e+02
  1.55298664e+02  4.83380229e+02  4.83380229e+02  4.83380229e+02
  6.46172160e+02  1.33511850e+03  1.33511850e+03  1.33511850e+03
  2.71238986e+03  3.02920073e+03  3.02920073e+03  3.02920073e+03
  6.64952584e+03  6.64952584e+03  6.64952584e+03  9.11373750e+03
  2.54664301e+04  7.62052809e+04]
E1 = -728.2803302686605  E_coul = 201.5334309284912
Extra cycle  E= -526.746899340169  delta_E=    0  |g|= 3.99e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114115.0651612841
E1 = -728.2803302686605  E_coul = 201.5334309284912
init E= -526.746899340169
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583505207905309  LUMO = 0.865201544425328
  mo_energy =
[-1.18583137e+02 -1.23129091e+01 -9.56314134e+00 -9.56314134e+00
 -9.56314134e+00 -1.27074884e+00 -5.83505208e-01 -5.83505208e-01
 -5.83505208e-01  8.65201544e-01  1.01105671e+00  1.01105671e+00
  1.01105671e+00  7.25989655e+00  7.25989655e+00  7.25989655e+00
  8.48205848e+00  3.33810073e+01  3.33810073e+01  3.33810073e+01
  3.88166021e+01  1.29000617e+02  1.29000617e+02  1.29000617e+02
  1.55298664e+02  4.83380229e+02  4.83380229e+02  4.83380229e+02
  6.46172160e+02  1.33511850e+03  1.33511850e+03  1.33511850e+03
  2.71238986e+03  3.02920073e+03  3.02920073e+03  3.02920073e+03
  6.64952584e+03  6.64952584e+03  6.64952584e+03  9.11373750e+03
  2.54664301e+04  7.62052809e+04]
E1 = -728.2803310207181  E_coul = 201.53343168054886
cycle= 1 E= -526.746899340169  delta_E=    0  |g|= 9.37e-08  |ddm|= 6.12e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2803310207181  E_coul = 201.53343168054886
  HOMO = -0.583505196988445  LUMO = 0.865201567175871
  mo_energy =
[-1.18583137e+02 -1.23129090e+01 -9.56314129e+00 -9.56314129e+00
 -9.56314129e+00 -1.27074881e+00 -5.83505197e-01 -5.83505197e-01
 -5.83505197e-01  8.65201567e-01  1.01105672e+00  1.01105672e+00
  1.01105672e+00  7.25989658e+00  7.25989658e+00  7.25989658e+00
  8.48205852e+00  3.33810073e+01  3.33810073e+01  3.33810073e+01
  3.88166022e+01  1.29000617e+02  1.29000617e+02  1.29000617e+02
  1.55298664e+02  4.83380229e+02  4.83380229e+02  4.83380229e+02
  6.46172160e+02  1.33511850e+03  1.33511850e+03  1.33511850e+03
  2.71238986e+03  3.02920073e+03  3.02920073e+03  3.02920073e+03
  6.64952584e+03  6.64952584e+03  6.64952584e+03  9.11373750e+03
  2.54664301e+04  7.62052809e+04]
E1 = -728.2803307749354  E_coul = 201.53343143476616
Extra cycle  E= -526.746899340169  delta_E=    0  |g|= 2.07e-08  |ddm|= 1.42e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61826599e+04 7.61751323e+03 3.61735525e+03 1.59764825e+03
 3.82610604e+02 1.11524012e+02 3.82116970e+01 1.27765085e+01
 6.31356485e+00 6.28062994e-01 2.76998952e+00 2.23958038e-01
 1.36278458e+03 6.64732158e+02 3.00898219e+02 3.13987290e+02
 6.16647917e+01 7.33441580e+00 2.02461204e+01 7.74588444e-01
 2.80329911e+00 2.22233273e-01]
grad_E = [-1.53669579e-06  3.52204120e-06 -1.45331803e-06  7.70491365e-05
 -1.74284927e-04 -6.45835474e-04 -1.01336154e-03  8.64628744e-05
  2.03709820e-04 -2.61823089e-04  1.73440408e-03 -4.02681123e-03
 -5.11168780e-07  4.95416522e-06  2.33126104e-05  2.00961560e-05
  5.92944993e-06  1.11790048e-03 -2.26024511e-04  3.45545659e-04
 -1.87734294e-03 -1.09693558e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:53 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6600487        1
[INPUT] 0    0    [1    /1   ]  7617.51297233        1
[INPUT] 0    0    [1    /1   ]  3617.35537379        1
[INPUT] 0    0    [1    /1   ]  1597.64293886        1
[INPUT] 0    0    [1    /1   ]  382.608810505        1
[INPUT] 0    0    [1    /1   ]  111.615295736        1
[INPUT] 0    0    [1    /1   ]  38.2859808092        1
[INPUT] 0    0    [1    /1   ]  12.8750444105        1
[INPUT] 0    0    [1    /1   ]  6.38373451013        1
[INPUT] 0    0    [1    /1   ]  0.628057360036       1
[INPUT] 0    0    [1    /1   ]  2.78261285357        1
[INPUT] 0    0    [1    /1   ]  0.223263506001       1
[INPUT] 1    0    [1    /1   ]  1362.78461499        1
[INPUT] 1    0    [1    /1   ]  664.731772463        1
[INPUT] 1    0    [1    /1   ]  300.896400884        1
[INPUT] 1    0    [1    /1   ]  313.985722537        1
[INPUT] 1    0    [1    /1   ]  61.6654257668        1
[INPUT] 1    0    [1    /1   ]  7.33347971846        1
[INPUT] 1    0    [1    /1   ]  20.2493264014        1
[INPUT] 1    0    [1    /1   ]  0.773836601851       1
[INPUT] 1    0    [1    /1   ]  2.79285411214        1
[INPUT] 1    0    [1    /1   ]  0.222224802884       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.660048696453, 1.0]], [0, [7617.512972328248, 1.0]], [0, [3617.355373789928, 1.0]], [0, [1597.6429388608185, 1.0]], [0, [382.608810505414, 1.0]], [0, [111.6152957358039, 1.0]], [0, [38.285980809183094, 1.0]], [0, [12.875044410546751, 1.0]], [0, [6.383734510130885, 1.0]], [0, [0.6280573600361726, 1.0]], [0, [2.7826128535679695, 1.0]], [0, [0.2232635060008145, 1.0]], [1, [1362.784614986711, 1.0]], [1, [664.7317724625589, 1.0]], [1, [300.8964008840261, 1.0]], [1, [313.98572253748705, 1.0]], [1, [61.665425766815396, 1.0]], [1, [7.333479718463156, 1.0]], [1, [20.249326401431446, 1.0]], [1, [0.7738366018514267, 1.0]], [1, [2.792854112139343, 1.0]], [1, [0.22222480288380114, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6600487]
bas 1, expnt(s) = [7617.51297233]
bas 2, expnt(s) = [3617.35537379]
bas 3, expnt(s) = [1597.64293886]
bas 4, expnt(s) = [382.60881051]
bas 5, expnt(s) = [111.61529574]
bas 6, expnt(s) = [38.28598081]
bas 7, expnt(s) = [12.87504441]
bas 8, expnt(s) = [6.38373451]
bas 9, expnt(s) = [0.62805736]
bas 10, expnt(s) = [2.78261285]
bas 11, expnt(s) = [0.22326351]
bas 12, expnt(s) = [1362.78461499]
bas 13, expnt(s) = [664.73177246]
bas 14, expnt(s) = [300.89640088]
bas 15, expnt(s) = [313.98572254]
bas 16, expnt(s) = [61.66542577]
bas 17, expnt(s) = [7.33347972]
bas 18, expnt(s) = [20.2493264]
bas 19, expnt(s) = [0.7738366]
bas 20, expnt(s) = [2.79285411]
bas 21, expnt(s) = [0.2222248]
CPU time:       269.17
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826600e+04 5.20026349e+03 7.61751297e+03 2.06003655e+03
 3.61735537e+03 1.17844253e+03 1.59764294e+03 6.38446951e+02
 3.82608811e+02 2.18565318e+02 1.11615296e+02 8.67576560e+01
 3.82859808e+01 3.88861420e+01 1.28750444e+01 1.71722252e+01
 6.38373451e+00 1.01466140e+01 6.28057360e-01 1.78243830e+00
 2.78261285e+00 5.44320404e+00 2.23263506e-01 8.20593986e-01
 1.36278461e+03 2.41556329e+04 6.64731772e+02 9.84673929e+03
 3.00896401e+02 3.65599534e+03 3.13985723e+02 3.85586454e+03
 6.16654258e+01 5.04123056e+02 7.33347972e+00 3.52064318e+01
 2.02493264e+01 1.25313430e+02 7.73836602e-01 2.11736621e+00
 2.79285411e+00 1.05328210e+01 2.22224803e-01 4.45117895e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99387992844288
cond(S) = 114153.44718423735
E1 = -729.5384706298869  E_coul = 203.17522600872297
init E= -526.363244621164
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555795432768273  LUMO = 0.882176063768766
  mo_energy =
[-1.18331082e+02 -1.22066541e+01 -9.44715854e+00 -9.44715854e+00
 -9.44715854e+00 -1.24027466e+00 -5.55795433e-01 -5.55795433e-01
 -5.55795433e-01  8.82176064e-01  1.02921980e+00  1.02921980e+00
  1.02921980e+00  7.31045665e+00  7.31045665e+00  7.31045665e+00
  8.61724262e+00  3.34624509e+01  3.34624509e+01  3.34624509e+01
  3.93144577e+01  1.29152003e+02  1.29152003e+02  1.29152003e+02
  1.56354625e+02  4.83611223e+02  4.83611223e+02  4.83611223e+02
  6.47666154e+02  1.33540320e+03  1.33540320e+03  1.33540320e+03
  2.71405174e+03  3.02954670e+03  3.02954670e+03  3.02954670e+03
  6.64998238e+03  6.64998238e+03  6.64998238e+03  9.11544241e+03
  2.54681683e+04  7.62070343e+04]
E1 = -727.8304405474629  E_coul = 201.08428232578734
cycle= 1 E= -526.746158221676  delta_E= -0.383  |g|= 0.187  |ddm|= 0.305
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.557387
diis-c [-0.31068025  1.        ]
  HOMO = -0.59114294651523  LUMO = 0.857371423153053
  mo_energy =
[-1.18641477e+02 -1.23454832e+01 -9.59701045e+00 -9.59701045e+00
 -9.59701045e+00 -1.28002347e+00 -5.91142947e-01 -5.91142947e-01
 -5.91142947e-01  8.57371423e-01  1.00464625e+00  1.00464625e+00
  1.00464625e+00  7.21903733e+00  7.21903733e+00  7.21903733e+00
  8.52906274e+00  3.33067437e+01  3.33067437e+01  3.33067437e+01
  3.91698156e+01  1.28921591e+02  1.28921591e+02  1.28921591e+02
  1.56126519e+02  4.83301973e+02  4.83301973e+02  4.83301973e+02
  6.47319462e+02  1.33503701e+03  1.33503701e+03  1.33503701e+03
  2.71355190e+03  3.02911422e+03  3.02911422e+03  3.02911422e+03
  6.64943626e+03  6.64943626e+03  6.64943626e+03  9.11482134e+03
  2.54674526e+04  7.62062282e+04]
E1 = -728.4097809284735  E_coul = 201.66288869220963
cycle= 2 E= -526.746892236264  delta_E= -0.000734  |g|= 0.038  |ddm|= 0.053
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0770404
diis-c [-0.00357776  0.08055738  0.91944262]
  HOMO = -0.581940252596356  LUMO = 0.864583423711462
  mo_energy =
[-1.18572994e+02 -1.23069963e+01 -9.55684899e+00 -9.55684899e+00
 -9.55684899e+00 -1.26899459e+00 -5.81940253e-01 -5.81940253e-01
 -5.81940253e-01  8.64583424e-01  1.01141862e+00  1.01141862e+00
  1.01141862e+00  7.24297839e+00  7.24297839e+00  7.24297839e+00
  8.55315253e+00  3.33472721e+01  3.33472721e+01  3.33472721e+01
  3.92090054e+01  1.28978141e+02  1.28978141e+02  1.28978141e+02
  1.56183551e+02  4.83369638e+02  4.83369638e+02  4.83369638e+02
  6.47389226e+02  1.33510876e+03  1.33510876e+03  1.33510876e+03
  2.71362691e+03  3.02918823e+03  3.02918823e+03  3.02918823e+03
  6.64951202e+03  6.64951202e+03  6.64951202e+03  9.11489791e+03
  2.54675298e+04  7.62063057e+04]
E1 = -728.2573153171978  E_coul = 201.51036292350594
cycle= 3 E= -526.746952393692  delta_E= -6.02e-05  |g|= 0.00646  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136623
diis-c [-8.22473017e-07 -1.29288248e-03  1.46056667e-01  8.55236215e-01]
  HOMO = -0.583482076357334  LUMO = 0.863471472078851
  mo_energy =
[-1.18583229e+02 -1.23129622e+01 -9.56317342e+00 -9.56317342e+00
 -9.56317342e+00 -1.27072505e+00 -5.83482076e-01 -5.83482076e-01
 -5.83482076e-01  8.63471472e-01  1.01031020e+00  1.01031020e+00
  1.01031020e+00  7.23910841e+00  7.23910841e+00  7.23910841e+00
  8.54934263e+00  3.33409292e+01  3.33409292e+01  3.33409292e+01
  3.92029184e+01  1.28969560e+02  1.28969560e+02  1.28969560e+02
  1.56174933e+02  4.83359521e+02  4.83359521e+02  4.83359521e+02
  6.47378779e+02  1.33509804e+03  1.33509804e+03  1.33509804e+03
  2.71361554e+03  3.02917710e+03  3.02917710e+03  3.02917710e+03
  6.64950050e+03  6.64950050e+03  6.64950050e+03  9.11488617e+03
  2.54675178e+04  7.62062936e+04]
E1 = -728.2807353086921  E_coul = 201.53378088546626
cycle= 4 E= -526.746954423226  delta_E= -2.03e-06  |g|= 0.00011  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000124495
diis-c [-5.63991603e-09  9.19866463e-05 -1.28472287e-02 -7.97267795e-02
  1.09248202e+00]
  HOMO = -0.583463810585724  LUMO = 0.863504589735659
  mo_energy =
[-1.18583182e+02 -1.23128930e+01 -9.56311869e+00 -9.56311869e+00
 -9.56311869e+00 -1.27068073e+00 -5.83463811e-01 -5.83463811e-01
 -5.83463811e-01  8.63504590e-01  1.01032632e+00  1.01032632e+00
  1.01032632e+00  7.23915186e+00  7.23915186e+00  7.23915186e+00
  8.54940088e+00  3.33409820e+01  3.33409820e+01  3.33409820e+01
  3.92029793e+01  1.28969613e+02  1.28969613e+02  1.28969613e+02
  1.56174989e+02  4.83359568e+02  4.83359568e+02  4.83359568e+02
  6.47378819e+02  1.33509807e+03  1.33509807e+03  1.33509807e+03
  2.71361556e+03  3.02917713e+03  3.02917713e+03  3.02917713e+03
  6.64950051e+03  6.64950051e+03  6.64950051e+03  9.11488617e+03
  2.54675178e+04  7.62062936e+04]
E1 = -728.2804932195482  E_coul = 201.5335387940388
cycle= 5 E= -526.746954425509  delta_E= -2.28e-09  |g|= 2.14e-05  |ddm|= 0.000181
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96006e-05
diis-c [-1.04401966e-10  1.35278862e-05 -1.75493493e-03 -1.30151545e-02
  3.27032591e-02  9.82053303e-01]
  HOMO = -0.583471960647411  LUMO = 0.863500877426679
  mo_energy =
[-1.18583214e+02 -1.23129173e+01 -9.56314493e+00 -9.56314493e+00
 -9.56314493e+00 -1.27068721e+00 -5.83471961e-01 -5.83471961e-01
 -5.83471961e-01  8.63500877e-01  1.01032092e+00  1.01032092e+00
  1.01032092e+00  7.23913396e+00  7.23913396e+00  7.23913396e+00
  8.54938426e+00  3.33409566e+01  3.33409566e+01  3.33409566e+01
  3.92029549e+01  1.28969583e+02  1.28969583e+02  1.28969583e+02
  1.56174959e+02  4.83359536e+02  4.83359536e+02  4.83359536e+02
  6.47378786e+02  1.33509804e+03  1.33509804e+03  1.33509804e+03
  2.71361553e+03  3.02917710e+03  3.02917710e+03  3.02917710e+03
  6.64950047e+03  6.64950047e+03  6.64950047e+03  9.11488613e+03
  2.54675178e+04  7.62062935e+04]
E1 = -728.2805793235758  E_coul = 201.5336248980012
cycle= 6 E= -526.746954425575  delta_E= -6.51e-11  |g|= 1.87e-06  |ddm|= 2.06e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2805793235758  E_coul = 201.5336248980012
  HOMO = -0.583471818820012  LUMO = 0.86350132048677
  mo_energy =
[-1.18583213e+02 -1.23129166e+01 -9.56314425e+00 -9.56314425e+00
 -9.56314425e+00 -1.27068664e+00 -5.83471819e-01 -5.83471819e-01
 -5.83471819e-01  8.63501320e-01  1.01032108e+00  1.01032108e+00
  1.01032108e+00  7.23913442e+00  7.23913442e+00  7.23913442e+00
  8.54938487e+00  3.33409573e+01  3.33409573e+01  3.33409573e+01
  3.92029556e+01  1.28969584e+02  1.28969584e+02  1.28969584e+02
  1.56174960e+02  4.83359537e+02  4.83359537e+02  4.83359537e+02
  6.47378787e+02  1.33509804e+03  1.33509804e+03  1.33509804e+03
  2.71361553e+03  3.02917710e+03  3.02917710e+03  3.02917710e+03
  6.64950047e+03  6.64950047e+03  6.64950047e+03  9.11488614e+03
  2.54675178e+04  7.62062935e+04]
E1 = -728.2805759105297  E_coul = 201.53362148495327
Extra cycle  E= -526.746954425576  delta_E= -1.82e-12  |g|= 4.02e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826600e+04 7.61751297e+03 3.61735537e+03 1.59764294e+03
 3.82608811e+02 1.11615296e+02 3.82859808e+01 1.28750444e+01
 6.38373451e+00 6.28057360e-01 2.78261285e+00 2.23263506e-01
 1.36278461e+03 6.64731772e+02 3.00896401e+02 3.13985723e+02
 6.16654258e+01 7.33347972e+00 2.02493264e+01 7.73836602e-01
 2.79285411e+00 2.22224803e-01]
E = -526.7469544255764
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:53 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6600487        1
[INPUT] 0    0    [1    /1   ]  7617.51297233        1
[INPUT] 0    0    [1    /1   ]  3617.35537379        1
[INPUT] 0    0    [1    /1   ]  1597.64293886        1
[INPUT] 0    0    [1    /1   ]  382.608810505        1
[INPUT] 0    0    [1    /1   ]  111.615295736        1
[INPUT] 0    0    [1    /1   ]  38.2859808092        1
[INPUT] 0    0    [1    /1   ]  12.8750444105        1
[INPUT] 0    0    [1    /1   ]  6.38373451013        1
[INPUT] 0    0    [1    /1   ]  0.628057360036       1
[INPUT] 0    0    [1    /1   ]  2.78261285357        1
[INPUT] 0    0    [1    /1   ]  0.223263506001       1
[INPUT] 1    0    [1    /1   ]  1362.78461499        1
[INPUT] 1    0    [1    /1   ]  664.731772463        1
[INPUT] 1    0    [1    /1   ]  300.896400884        1
[INPUT] 1    0    [1    /1   ]  313.985722537        1
[INPUT] 1    0    [1    /1   ]  61.6654257668        1
[INPUT] 1    0    [1    /1   ]  7.33347971846        1
[INPUT] 1    0    [1    /1   ]  20.2493264014        1
[INPUT] 1    0    [1    /1   ]  0.773836601851       1
[INPUT] 1    0    [1    /1   ]  2.79285411214        1
[INPUT] 1    0    [1    /1   ]  0.222224802884       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.660048696453, 1.0]], [0, [7617.512972328248, 1.0]], [0, [3617.355373789928, 1.0]], [0, [1597.6429388608185, 1.0]], [0, [382.608810505414, 1.0]], [0, [111.6152957358039, 1.0]], [0, [38.285980809183094, 1.0]], [0, [12.875044410546751, 1.0]], [0, [6.383734510130885, 1.0]], [0, [0.6280573600361726, 1.0]], [0, [2.7826128535679695, 1.0]], [0, [0.2232635060008145, 1.0]], [1, [1362.784614986711, 1.0]], [1, [664.7317724625589, 1.0]], [1, [300.8964008840261, 1.0]], [1, [313.98572253748705, 1.0]], [1, [61.665425766815396, 1.0]], [1, [7.333479718463156, 1.0]], [1, [20.249326401431446, 1.0]], [1, [0.7738366018514267, 1.0]], [1, [2.792854112139343, 1.0]], [1, [0.22222480288380114, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6600487]
bas 1, expnt(s) = [7617.51297233]
bas 2, expnt(s) = [3617.35537379]
bas 3, expnt(s) = [1597.64293886]
bas 4, expnt(s) = [382.60881051]
bas 5, expnt(s) = [111.61529574]
bas 6, expnt(s) = [38.28598081]
bas 7, expnt(s) = [12.87504441]
bas 8, expnt(s) = [6.38373451]
bas 9, expnt(s) = [0.62805736]
bas 10, expnt(s) = [2.78261285]
bas 11, expnt(s) = [0.22326351]
bas 12, expnt(s) = [1362.78461499]
bas 13, expnt(s) = [664.73177246]
bas 14, expnt(s) = [300.89640088]
bas 15, expnt(s) = [313.98572254]
bas 16, expnt(s) = [61.66542577]
bas 17, expnt(s) = [7.33347972]
bas 18, expnt(s) = [20.2493264]
bas 19, expnt(s) = [0.7738366]
bas 20, expnt(s) = [2.79285411]
bas 21, expnt(s) = [0.2222248]
CPU time:       269.59
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826600e+04 5.20026349e+03 7.61751297e+03 2.06003655e+03
 3.61735537e+03 1.17844253e+03 1.59764294e+03 6.38446951e+02
 3.82608811e+02 2.18565318e+02 1.11615296e+02 8.67576560e+01
 3.82859808e+01 3.88861420e+01 1.28750444e+01 1.71722252e+01
 6.38373451e+00 1.01466140e+01 6.28057360e-01 1.78243830e+00
 2.78261285e+00 5.44320404e+00 2.23263506e-01 8.20593986e-01
 1.36278461e+03 2.41556329e+04 6.64731772e+02 9.84673929e+03
 3.00896401e+02 3.65599534e+03 3.13985723e+02 3.85586454e+03
 6.16654258e+01 5.04123056e+02 7.33347972e+00 3.52064318e+01
 2.02493264e+01 1.25313430e+02 7.73836602e-01 2.11736621e+00
 2.79285411e+00 1.05328210e+01 2.22224803e-01 4.45117895e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99387992844288
cond(S) = 114153.44718423735
E1 = -729.5384706298869  E_coul = 203.17522600872297
init E= -526.363244621164
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555795432768273  LUMO = 0.882176063768766
  mo_energy =
[-1.18331082e+02 -1.22066541e+01 -9.44715854e+00 -9.44715854e+00
 -9.44715854e+00 -1.24027466e+00 -5.55795433e-01 -5.55795433e-01
 -5.55795433e-01  8.82176064e-01  1.02921980e+00  1.02921980e+00
  1.02921980e+00  7.31045665e+00  7.31045665e+00  7.31045665e+00
  8.61724262e+00  3.34624509e+01  3.34624509e+01  3.34624509e+01
  3.93144577e+01  1.29152003e+02  1.29152003e+02  1.29152003e+02
  1.56354625e+02  4.83611223e+02  4.83611223e+02  4.83611223e+02
  6.47666154e+02  1.33540320e+03  1.33540320e+03  1.33540320e+03
  2.71405174e+03  3.02954670e+03  3.02954670e+03  3.02954670e+03
  6.64998238e+03  6.64998238e+03  6.64998238e+03  9.11544241e+03
  2.54681683e+04  7.62070343e+04]
E1 = -727.8304405474629  E_coul = 201.08428232578734
cycle= 1 E= -526.746158221676  delta_E= -0.383  |g|= 0.187  |ddm|= 0.305
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.557387
diis-c [-0.31068025  1.        ]
  HOMO = -0.59114294651523  LUMO = 0.857371423153053
  mo_energy =
[-1.18641477e+02 -1.23454832e+01 -9.59701045e+00 -9.59701045e+00
 -9.59701045e+00 -1.28002347e+00 -5.91142947e-01 -5.91142947e-01
 -5.91142947e-01  8.57371423e-01  1.00464625e+00  1.00464625e+00
  1.00464625e+00  7.21903733e+00  7.21903733e+00  7.21903733e+00
  8.52906274e+00  3.33067437e+01  3.33067437e+01  3.33067437e+01
  3.91698156e+01  1.28921591e+02  1.28921591e+02  1.28921591e+02
  1.56126519e+02  4.83301973e+02  4.83301973e+02  4.83301973e+02
  6.47319462e+02  1.33503701e+03  1.33503701e+03  1.33503701e+03
  2.71355190e+03  3.02911422e+03  3.02911422e+03  3.02911422e+03
  6.64943626e+03  6.64943626e+03  6.64943626e+03  9.11482134e+03
  2.54674526e+04  7.62062282e+04]
E1 = -728.4097809284735  E_coul = 201.66288869220963
cycle= 2 E= -526.746892236264  delta_E= -0.000734  |g|= 0.038  |ddm|= 0.053
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0770404
diis-c [-0.00357776  0.08055738  0.91944262]
  HOMO = -0.581940252596356  LUMO = 0.864583423711462
  mo_energy =
[-1.18572994e+02 -1.23069963e+01 -9.55684899e+00 -9.55684899e+00
 -9.55684899e+00 -1.26899459e+00 -5.81940253e-01 -5.81940253e-01
 -5.81940253e-01  8.64583424e-01  1.01141862e+00  1.01141862e+00
  1.01141862e+00  7.24297839e+00  7.24297839e+00  7.24297839e+00
  8.55315253e+00  3.33472721e+01  3.33472721e+01  3.33472721e+01
  3.92090054e+01  1.28978141e+02  1.28978141e+02  1.28978141e+02
  1.56183551e+02  4.83369638e+02  4.83369638e+02  4.83369638e+02
  6.47389226e+02  1.33510876e+03  1.33510876e+03  1.33510876e+03
  2.71362691e+03  3.02918823e+03  3.02918823e+03  3.02918823e+03
  6.64951202e+03  6.64951202e+03  6.64951202e+03  9.11489791e+03
  2.54675298e+04  7.62063057e+04]
E1 = -728.2573153171978  E_coul = 201.51036292350594
cycle= 3 E= -526.746952393692  delta_E= -6.02e-05  |g|= 0.00646  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136623
diis-c [-8.22473017e-07 -1.29288248e-03  1.46056667e-01  8.55236215e-01]
  HOMO = -0.583482076357334  LUMO = 0.863471472078851
  mo_energy =
[-1.18583229e+02 -1.23129622e+01 -9.56317342e+00 -9.56317342e+00
 -9.56317342e+00 -1.27072505e+00 -5.83482076e-01 -5.83482076e-01
 -5.83482076e-01  8.63471472e-01  1.01031020e+00  1.01031020e+00
  1.01031020e+00  7.23910841e+00  7.23910841e+00  7.23910841e+00
  8.54934263e+00  3.33409292e+01  3.33409292e+01  3.33409292e+01
  3.92029184e+01  1.28969560e+02  1.28969560e+02  1.28969560e+02
  1.56174933e+02  4.83359521e+02  4.83359521e+02  4.83359521e+02
  6.47378779e+02  1.33509804e+03  1.33509804e+03  1.33509804e+03
  2.71361554e+03  3.02917710e+03  3.02917710e+03  3.02917710e+03
  6.64950050e+03  6.64950050e+03  6.64950050e+03  9.11488617e+03
  2.54675178e+04  7.62062936e+04]
E1 = -728.2807353086921  E_coul = 201.53378088546626
cycle= 4 E= -526.746954423226  delta_E= -2.03e-06  |g|= 0.00011  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000124495
diis-c [-5.63991603e-09  9.19866463e-05 -1.28472287e-02 -7.97267795e-02
  1.09248202e+00]
  HOMO = -0.583463810585724  LUMO = 0.863504589735659
  mo_energy =
[-1.18583182e+02 -1.23128930e+01 -9.56311869e+00 -9.56311869e+00
 -9.56311869e+00 -1.27068073e+00 -5.83463811e-01 -5.83463811e-01
 -5.83463811e-01  8.63504590e-01  1.01032632e+00  1.01032632e+00
  1.01032632e+00  7.23915186e+00  7.23915186e+00  7.23915186e+00
  8.54940088e+00  3.33409820e+01  3.33409820e+01  3.33409820e+01
  3.92029793e+01  1.28969613e+02  1.28969613e+02  1.28969613e+02
  1.56174989e+02  4.83359568e+02  4.83359568e+02  4.83359568e+02
  6.47378819e+02  1.33509807e+03  1.33509807e+03  1.33509807e+03
  2.71361556e+03  3.02917713e+03  3.02917713e+03  3.02917713e+03
  6.64950051e+03  6.64950051e+03  6.64950051e+03  9.11488617e+03
  2.54675178e+04  7.62062936e+04]
E1 = -728.2804932195482  E_coul = 201.5335387940388
cycle= 5 E= -526.746954425509  delta_E= -2.28e-09  |g|= 2.14e-05  |ddm|= 0.000181
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96006e-05
diis-c [-1.04401966e-10  1.35278862e-05 -1.75493493e-03 -1.30151545e-02
  3.27032591e-02  9.82053303e-01]
  HOMO = -0.583471960647411  LUMO = 0.863500877426679
  mo_energy =
[-1.18583214e+02 -1.23129173e+01 -9.56314493e+00 -9.56314493e+00
 -9.56314493e+00 -1.27068721e+00 -5.83471961e-01 -5.83471961e-01
 -5.83471961e-01  8.63500877e-01  1.01032092e+00  1.01032092e+00
  1.01032092e+00  7.23913396e+00  7.23913396e+00  7.23913396e+00
  8.54938426e+00  3.33409566e+01  3.33409566e+01  3.33409566e+01
  3.92029549e+01  1.28969583e+02  1.28969583e+02  1.28969583e+02
  1.56174959e+02  4.83359536e+02  4.83359536e+02  4.83359536e+02
  6.47378786e+02  1.33509804e+03  1.33509804e+03  1.33509804e+03
  2.71361553e+03  3.02917710e+03  3.02917710e+03  3.02917710e+03
  6.64950047e+03  6.64950047e+03  6.64950047e+03  9.11488613e+03
  2.54675178e+04  7.62062935e+04]
E1 = -728.2805793235758  E_coul = 201.5336248980012
cycle= 6 E= -526.746954425575  delta_E= -6.51e-11  |g|= 1.87e-06  |ddm|= 2.06e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2805793235758  E_coul = 201.5336248980012
  HOMO = -0.583471818820012  LUMO = 0.86350132048677
  mo_energy =
[-1.18583213e+02 -1.23129166e+01 -9.56314425e+00 -9.56314425e+00
 -9.56314425e+00 -1.27068664e+00 -5.83471819e-01 -5.83471819e-01
 -5.83471819e-01  8.63501320e-01  1.01032108e+00  1.01032108e+00
  1.01032108e+00  7.23913442e+00  7.23913442e+00  7.23913442e+00
  8.54938487e+00  3.33409573e+01  3.33409573e+01  3.33409573e+01
  3.92029556e+01  1.28969584e+02  1.28969584e+02  1.28969584e+02
  1.56174960e+02  4.83359537e+02  4.83359537e+02  4.83359537e+02
  6.47378787e+02  1.33509804e+03  1.33509804e+03  1.33509804e+03
  2.71361553e+03  3.02917710e+03  3.02917710e+03  3.02917710e+03
  6.64950047e+03  6.64950047e+03  6.64950047e+03  9.11488614e+03
  2.54675178e+04  7.62062935e+04]
E1 = -728.2805759105297  E_coul = 201.53362148495327
Extra cycle  E= -526.746954425576  delta_E= -1.82e-12  |g|= 4.02e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114153.44718423735
E1 = -728.2805759105297  E_coul = 201.53362148495327
init E= -526.746954425576
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583471901120244  LUMO = 0.863501328046828
  mo_energy =
[-1.18583214e+02 -1.23129168e+01 -9.56314453e+00 -9.56314453e+00
 -9.56314453e+00 -1.27068665e+00 -5.83471901e-01 -5.83471901e-01
 -5.83471901e-01  8.63501328e-01  1.01032103e+00  1.01032103e+00
  1.01032103e+00  7.23913424e+00  7.23913424e+00  7.23913424e+00
  8.54938473e+00  3.33409570e+01  3.33409570e+01  3.33409570e+01
  3.92029553e+01  1.28969584e+02  1.28969584e+02  1.28969584e+02
  1.56174959e+02  4.83359536e+02  4.83359536e+02  4.83359536e+02
  6.47378787e+02  1.33509804e+03  1.33509804e+03  1.33509804e+03
  2.71361553e+03  3.02917710e+03  3.02917710e+03  3.02917710e+03
  6.64950047e+03  6.64950047e+03  6.64950047e+03  9.11488614e+03
  2.54675178e+04  7.62062935e+04]
E1 = -728.2805767105505  E_coul = 201.53362228497411
cycle= 1 E= -526.746954425576  delta_E=    0  |g|= 9.52e-08  |ddm|= 6.08e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2805767105505  E_coul = 201.53362228497411
  HOMO = -0.583471889302121  LUMO = 0.863501351438296
  mo_energy =
[-1.18583214e+02 -1.23129167e+01 -9.56314447e+00 -9.56314447e+00
 -9.56314447e+00 -1.27068662e+00 -5.83471889e-01 -5.83471889e-01
 -5.83471889e-01  8.63501351e-01  1.01032104e+00  1.01032104e+00
  1.01032104e+00  7.23913428e+00  7.23913428e+00  7.23913428e+00
  8.54938478e+00  3.33409571e+01  3.33409571e+01  3.33409571e+01
  3.92029554e+01  1.28969584e+02  1.28969584e+02  1.28969584e+02
  1.56174960e+02  4.83359536e+02  4.83359536e+02  4.83359536e+02
  6.47378787e+02  1.33509804e+03  1.33509804e+03  1.33509804e+03
  2.71361553e+03  3.02917710e+03  3.02917710e+03  3.02917710e+03
  6.64950047e+03  6.64950047e+03  6.64950047e+03  9.11488614e+03
  2.54675178e+04  7.62062935e+04]
E1 = -728.2805764512808  E_coul = 201.53362202570506
Extra cycle  E= -526.746954425576  delta_E= 6.82e-13  |g|= 2.12e-08  |ddm|= 1.43e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61826600e+04 7.61751297e+03 3.61735537e+03 1.59764294e+03
 3.82608811e+02 1.11615296e+02 3.82859808e+01 1.28750444e+01
 6.38373451e+00 6.28057360e-01 2.78261285e+00 2.23263506e-01
 1.36278461e+03 6.64731772e+02 3.00896401e+02 3.13985723e+02
 6.16654258e+01 7.33347972e+00 2.02493264e+01 7.73836602e-01
 2.79285411e+00 2.22224803e-01]
grad_E = [-1.53737891e-06  3.52992472e-06 -1.44807075e-06  7.73415901e-05
 -1.80815442e-04 -6.27495918e-04 -1.01708694e-03  8.35654709e-05
  3.23058268e-04  5.70171635e-04  1.53731798e-03 -6.52268791e-03
 -5.12675753e-07  4.93334537e-06  2.31840517e-05  1.99859817e-05
  2.43949970e-05  2.32717547e-03 -4.58087738e-04 -1.26164865e-03
 -3.83355811e-03  4.27416369e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:58 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6602867        1
[INPUT] 0    0    [1    /1   ]  7617.51245343        1
[INPUT] 0    0    [1    /1   ]  3617.35562046        1
[INPUT] 0    0    [1    /1   ]  1597.63210498        1
[INPUT] 0    0    [1    /1   ]  382.606616748        1
[INPUT] 0    0    [1    /1   ]  111.795302142        1
[INPUT] 0    0    [1    /1   ]  38.4418798917        1
[INPUT] 0    0    [1    /1   ]  13.0906036226        1
[INPUT] 0    0    [1    /1   ]  6.46548658887        1
[INPUT] 0    0    [1    /1   ]  0.629788138731       1
[INPUT] 0    0    [1    /1   ]  2.79464937032        1
[INPUT] 0    0    [1    /1   ]  0.223026643542       1
[INPUT] 1    0    [1    /1   ]  1362.78469478        1
[INPUT] 1    0    [1    /1   ]  664.730990271        1
[INPUT] 1    0    [1    /1   ]  300.89271523         1
[INPUT] 1    0    [1    /1   ]  313.982545015        1
[INPUT] 1    0    [1    /1   ]  61.6667318107        1
[INPUT] 1    0    [1    /1   ]  7.32990094382        1
[INPUT] 1    0    [1    /1   ]  20.2558094446        1
[INPUT] 1    0    [1    /1   ]  0.772600342484       1
[INPUT] 1    0    [1    /1   ]  2.77597688914        1
[INPUT] 1    0    [1    /1   ]  0.222247136627       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.660286731, 1.0]], [0, [7617.512453434185, 1.0]], [0, [3617.3556204576917, 1.0]], [0, [1597.6321049765413, 1.0]], [0, [382.60661674831573, 1.0]], [0, [111.7953021424875, 1.0]], [0, [38.44187989167894, 1.0]], [0, [13.090603622642204, 1.0]], [0, [6.46548658886881, 1.0]], [0, [0.6297881387306256, 1.0]], [0, [2.794649370316971, 1.0]], [0, [0.2230266435415401, 1.0]], [1, [1362.7846947763553, 1.0]], [1, [664.7309902711684, 1.0]], [1, [300.89271523014855, 1.0]], [1, [313.9825450152659, 1.0]], [1, [61.66673181065689, 1.0]], [1, [7.32990094382343, 1.0]], [1, [20.25580944462871, 1.0]], [1, [0.7726003424844443, 1.0]], [1, [2.775976889137326, 1.0]], [1, [0.22224713662696527, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66028673]
bas 1, expnt(s) = [7617.51245343]
bas 2, expnt(s) = [3617.35562046]
bas 3, expnt(s) = [1597.63210498]
bas 4, expnt(s) = [382.60661675]
bas 5, expnt(s) = [111.79530214]
bas 6, expnt(s) = [38.44187989]
bas 7, expnt(s) = [13.09060362]
bas 8, expnt(s) = [6.46548659]
bas 9, expnt(s) = [0.62978814]
bas 10, expnt(s) = [2.79464937]
bas 11, expnt(s) = [0.22302664]
bas 12, expnt(s) = [1362.78469478]
bas 13, expnt(s) = [664.73099027]
bas 14, expnt(s) = [300.89271523]
bas 15, expnt(s) = [313.98254502]
bas 16, expnt(s) = [61.66673181]
bas 17, expnt(s) = [7.32990094]
bas 18, expnt(s) = [20.25580944]
bas 19, expnt(s) = [0.77260034]
bas 20, expnt(s) = [2.77597689]
bas 21, expnt(s) = [0.22224714]
CPU time:       275.30
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826603e+04 5.20026353e+03 7.61751245e+03 2.06003645e+03
 3.61735562e+03 1.17844259e+03 1.59763210e+03 6.38443704e+02
 3.82606617e+02 2.18564378e+02 1.11795302e+02 8.68625730e+01
 3.84418799e+01 3.90048388e+01 1.30906036e+01 1.73874053e+01
 6.46548659e+00 1.02439143e+01 6.29788139e-01 1.78612102e+00
 2.79464937e+00 5.46085342e+00 2.23026644e-01 8.19940967e-01
 1.36278469e+03 2.41556346e+04 6.64730990e+02 9.84672481e+03
 3.00892715e+02 3.65593937e+03 3.13982545e+02 3.85581576e+03
 6.16667318e+01 5.04136403e+02 7.32990094e+00 3.51849570e+01
 2.02558094e+01 1.25363583e+02 7.72600342e-01 2.11313874e+00
 2.77597689e+00 1.04533189e+01 2.22247137e-01 4.45173814e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99388904583611
cond(S) = 114203.23798176489
E1 = -729.5390027243665  E_coul = 203.17558905992612
init E= -526.36341366444
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555780840771406  LUMO = 0.883888575516397
  mo_energy =
[-1.18331166e+02 -1.22066317e+01 -9.44711696e+00 -9.44711696e+00
 -9.44711696e+00 -1.24025793e+00 -5.55780841e-01 -5.55780841e-01
 -5.55780841e-01  8.83888576e-01  1.02808867e+00  1.02808867e+00
  1.02808867e+00  7.27615828e+00  7.27615828e+00  7.27615828e+00
  8.71118779e+00  3.33937384e+01  3.33937384e+01  3.33937384e+01
  3.99181352e+01  1.29098637e+02  1.29098637e+02  1.29098637e+02
  1.57899015e+02  4.83576250e+02  4.83576250e+02  4.83576250e+02
  6.49902397e+02  1.33536774e+03  1.33536774e+03  1.33536774e+03
  2.71635374e+03  3.02950431e+03  3.02950431e+03  3.02950431e+03
  6.64993597e+03  6.64993597e+03  6.64993597e+03  9.11760457e+03
  2.54702162e+04  7.62089409e+04]
E1 = -727.8327017716422  E_coul = 201.0864219645115
cycle= 1 E= -526.746279807131  delta_E= -0.383  |g|= 0.187  |ddm|= 0.307
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.557578
diis-c [-0.31089269  1.        ]
  HOMO = -0.591037541376221  LUMO = 0.859096825257767
  mo_energy =
[-1.18641438e+02 -1.23453804e+01 -9.59687379e+00 -9.59687379e+00
 -9.59687379e+00 -1.27988160e+00 -5.91037541e-01 -5.91037541e-01
 -5.91037541e-01  8.59096825e-01  1.00364012e+00  1.00364012e+00
  1.00364012e+00  7.18506707e+00  7.18506707e+00  7.18506707e+00
  8.62252000e+00  3.32381230e+01  3.32381230e+01  3.32381230e+01
  3.97727944e+01  1.28868297e+02  1.28868297e+02  1.28868297e+02
  1.57670671e+02  4.83267125e+02  4.83267125e+02  4.83267125e+02
  6.49555803e+02  1.33500167e+03  1.33500167e+03  1.33500167e+03
  2.71585409e+03  3.02907198e+03  3.02907198e+03  3.02907198e+03
  6.64939000e+03  6.64939000e+03  6.64939000e+03  9.11698369e+03
  2.54695007e+04  7.62081350e+04]
E1 = -728.4112806576153  E_coul = 201.664268187158
cycle= 2 E= -526.747012470457  delta_E= -0.000733  |g|= 0.038  |ddm|= 0.0529
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0769407
diis-c [-0.00358109  0.08023824  0.91976176]
  HOMO = -0.581845631906253  LUMO = 0.866326521930224
  mo_energy =
[-1.18573006e+02 -1.23069332e+01 -9.55675406e+00 -9.55675406e+00
 -9.55675406e+00 -1.26886157e+00 -5.81845632e-01 -5.81845632e-01
 -5.81845632e-01  8.66326522e-01  1.01039048e+00  1.01039048e+00
  1.01039048e+00  7.20892213e+00  7.20892213e+00  7.20892213e+00
  8.64673811e+00  3.32786115e+01  3.32786115e+01  3.32786115e+01
  3.98121442e+01  1.28924803e+02  1.28924803e+02  1.28924803e+02
  1.57727716e+02  4.83334740e+02  4.83334740e+02  4.83334740e+02
  6.49625515e+02  1.33507337e+03  1.33507337e+03  1.33507337e+03
  2.71592904e+03  3.02914594e+03  3.02914594e+03  3.02914594e+03
  6.64946571e+03  6.64946571e+03  6.64946571e+03  9.11706020e+03
  2.54695778e+04  7.62082124e+04]
E1 = -728.2589762661755  E_coul = 201.51190379103375
cycle= 3 E= -526.747072475142  delta_E= -6e-05  |g|= 0.00647  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136738
diis-c [-8.29961611e-07 -1.29418408e-03  1.46331618e-01  8.54962566e-01]
  HOMO = -0.583388138498217  LUMO = 0.865211788656249
  mo_energy =
[-1.18583253e+02 -1.23129039e+01 -9.56308372e+00 -9.56308372e+00
 -9.56308372e+00 -1.27059121e+00 -5.83388138e-01 -5.83388138e-01
 -5.83388138e-01  8.65211789e-01  1.00928418e+00  1.00928418e+00
  1.00928418e+00  7.20505917e+00  7.20505917e+00  7.20505917e+00
  8.64290249e+00  3.32722631e+01  3.32722631e+01  3.32722631e+01
  3.98060226e+01  1.28916213e+02  1.28916213e+02  1.28916213e+02
  1.57719081e+02  4.83324611e+02  4.83324611e+02  4.83324611e+02
  6.49615057e+02  1.33506263e+03  1.33506263e+03  1.33506263e+03
  2.71591767e+03  3.02913480e+03  3.02913480e+03  3.02913480e+03
  6.64945418e+03  6.64945418e+03  6.64945418e+03  9.11704845e+03
  2.54695658e+04  7.62082003e+04]
E1 = -728.282406489594  E_coul = 201.53533198148287
cycle= 4 E= -526.747074508111  delta_E= -2.03e-06  |g|= 0.000111  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000125978
diis-c [-5.71566094e-09  9.32625366e-05 -1.30267056e-02 -8.06765974e-02
  1.09361004e+00]
  HOMO = -0.583370102295539  LUMO = 0.86524523573203
  mo_energy =
[-1.18583206e+02 -1.23128351e+01 -9.56302955e+00 -9.56302955e+00
 -9.56302955e+00 -1.27054663e+00 -5.83370102e-01 -5.83370102e-01
 -5.83370102e-01  8.65245236e-01  1.00930018e+00  1.00930018e+00
  1.00930018e+00  7.20510217e+00  7.20510217e+00  7.20510217e+00
  8.64296070e+00  3.32723153e+01  3.32723153e+01  3.32723153e+01
  3.98060831e+01  1.28916265e+02  1.28916265e+02  1.28916265e+02
  1.57719135e+02  4.83324658e+02  4.83324658e+02  4.83324658e+02
  6.49615095e+02  1.33506267e+03  1.33506267e+03  1.33506267e+03
  2.71591768e+03  3.02913483e+03  3.02913483e+03  3.02913483e+03
  6.64945419e+03  6.64945419e+03  6.64945419e+03  9.11704845e+03
  2.54695658e+04  7.62082003e+04]
E1 = -728.2821653017189  E_coul = 201.5350907912297
cycle= 5 E= -526.747074510489  delta_E= -2.38e-09  |g|= 2.15e-05  |ddm|= 0.000185
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.97351e-05
diis-c [-1.06214373e-10  1.35785595e-05 -1.76267953e-03 -1.30390548e-02
  3.07832762e-02  9.84004880e-01]
  HOMO = -0.583378290721219  LUMO = 0.865241528745061
  mo_energy =
[-1.18583239e+02 -1.23128595e+01 -9.56305590e+00 -9.56305590e+00
 -9.56305590e+00 -1.27055310e+00 -5.83378291e-01 -5.83378291e-01
 -5.83378291e-01  8.65241529e-01  1.00929477e+00  1.00929477e+00
  1.00929477e+00  7.20508425e+00  7.20508425e+00  7.20508425e+00
  8.64294395e+00  3.32722898e+01  3.32722898e+01  3.32722898e+01
  3.98060584e+01  1.28916236e+02  1.28916236e+02  1.28916236e+02
  1.57719106e+02  4.83324626e+02  4.83324626e+02  4.83324626e+02
  6.49615063e+02  1.33506264e+03  1.33506264e+03  1.33506264e+03
  2.71591765e+03  3.02913479e+03  3.02913479e+03  3.02913479e+03
  6.64945416e+03  6.64945416e+03  6.64945416e+03  9.11704841e+03
  2.54695658e+04  7.62082002e+04]
E1 = -728.2822516250551  E_coul = 201.53517711449777
cycle= 6 E= -526.747074510557  delta_E= -6.81e-11  |g|= 1.87e-06  |ddm|= 2.1e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2822516250551  E_coul = 201.53517711449777
  HOMO = -0.583378132568733  LUMO = 0.865241983073761
  mo_energy =
[-1.18583238e+02 -1.23128587e+01 -9.56305516e+00 -9.56305516e+00
 -9.56305516e+00 -1.27055251e+00 -5.83378133e-01 -5.83378133e-01
 -5.83378133e-01  8.65241983e-01  1.00929494e+00  1.00929494e+00
  1.00929494e+00  7.20508474e+00  7.20508474e+00  7.20508474e+00
  8.64294460e+00  3.32722906e+01  3.32722906e+01  3.32722906e+01
  3.98060592e+01  1.28916237e+02  1.28916237e+02  1.28916237e+02
  1.57719107e+02  4.83324627e+02  4.83324627e+02  4.83324627e+02
  6.49615064e+02  1.33506264e+03  1.33506264e+03  1.33506264e+03
  2.71591765e+03  3.02913480e+03  3.02913480e+03  3.02913480e+03
  6.64945416e+03  6.64945416e+03  6.64945416e+03  9.11704841e+03
  2.54695658e+04  7.62082002e+04]
E1 = -728.2822480243924  E_coul = 201.53517351383522
Extra cycle  E= -526.747074510557  delta_E= 1.14e-13  |g|= 4.04e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826603e+04 7.61751245e+03 3.61735562e+03 1.59763210e+03
 3.82606617e+02 1.11795302e+02 3.84418799e+01 1.30906036e+01
 6.46548659e+00 6.29788139e-01 2.79464937e+00 2.23026644e-01
 1.36278469e+03 6.64730990e+02 3.00892715e+02 3.13982545e+02
 6.16667318e+01 7.32990094e+00 2.02558094e+01 7.72600342e-01
 2.77597689e+00 2.22247137e-01]
E = -526.7470745105572
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:24:58 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6602867        1
[INPUT] 0    0    [1    /1   ]  7617.51245343        1
[INPUT] 0    0    [1    /1   ]  3617.35562046        1
[INPUT] 0    0    [1    /1   ]  1597.63210498        1
[INPUT] 0    0    [1    /1   ]  382.606616748        1
[INPUT] 0    0    [1    /1   ]  111.795302142        1
[INPUT] 0    0    [1    /1   ]  38.4418798917        1
[INPUT] 0    0    [1    /1   ]  13.0906036226        1
[INPUT] 0    0    [1    /1   ]  6.46548658887        1
[INPUT] 0    0    [1    /1   ]  0.629788138731       1
[INPUT] 0    0    [1    /1   ]  2.79464937032        1
[INPUT] 0    0    [1    /1   ]  0.223026643542       1
[INPUT] 1    0    [1    /1   ]  1362.78469478        1
[INPUT] 1    0    [1    /1   ]  664.730990271        1
[INPUT] 1    0    [1    /1   ]  300.89271523         1
[INPUT] 1    0    [1    /1   ]  313.982545015        1
[INPUT] 1    0    [1    /1   ]  61.6667318107        1
[INPUT] 1    0    [1    /1   ]  7.32990094382        1
[INPUT] 1    0    [1    /1   ]  20.2558094446        1
[INPUT] 1    0    [1    /1   ]  0.772600342484       1
[INPUT] 1    0    [1    /1   ]  2.77597688914        1
[INPUT] 1    0    [1    /1   ]  0.222247136627       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.660286731, 1.0]], [0, [7617.512453434185, 1.0]], [0, [3617.3556204576917, 1.0]], [0, [1597.6321049765413, 1.0]], [0, [382.60661674831573, 1.0]], [0, [111.7953021424875, 1.0]], [0, [38.44187989167894, 1.0]], [0, [13.090603622642204, 1.0]], [0, [6.46548658886881, 1.0]], [0, [0.6297881387306256, 1.0]], [0, [2.794649370316971, 1.0]], [0, [0.2230266435415401, 1.0]], [1, [1362.7846947763553, 1.0]], [1, [664.7309902711684, 1.0]], [1, [300.89271523014855, 1.0]], [1, [313.9825450152659, 1.0]], [1, [61.66673181065689, 1.0]], [1, [7.32990094382343, 1.0]], [1, [20.25580944462871, 1.0]], [1, [0.7726003424844443, 1.0]], [1, [2.775976889137326, 1.0]], [1, [0.22224713662696527, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66028673]
bas 1, expnt(s) = [7617.51245343]
bas 2, expnt(s) = [3617.35562046]
bas 3, expnt(s) = [1597.63210498]
bas 4, expnt(s) = [382.60661675]
bas 5, expnt(s) = [111.79530214]
bas 6, expnt(s) = [38.44187989]
bas 7, expnt(s) = [13.09060362]
bas 8, expnt(s) = [6.46548659]
bas 9, expnt(s) = [0.62978814]
bas 10, expnt(s) = [2.79464937]
bas 11, expnt(s) = [0.22302664]
bas 12, expnt(s) = [1362.78469478]
bas 13, expnt(s) = [664.73099027]
bas 14, expnt(s) = [300.89271523]
bas 15, expnt(s) = [313.98254502]
bas 16, expnt(s) = [61.66673181]
bas 17, expnt(s) = [7.32990094]
bas 18, expnt(s) = [20.25580944]
bas 19, expnt(s) = [0.77260034]
bas 20, expnt(s) = [2.77597689]
bas 21, expnt(s) = [0.22224714]
CPU time:       275.72
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826603e+04 5.20026353e+03 7.61751245e+03 2.06003645e+03
 3.61735562e+03 1.17844259e+03 1.59763210e+03 6.38443704e+02
 3.82606617e+02 2.18564378e+02 1.11795302e+02 8.68625730e+01
 3.84418799e+01 3.90048388e+01 1.30906036e+01 1.73874053e+01
 6.46548659e+00 1.02439143e+01 6.29788139e-01 1.78612102e+00
 2.79464937e+00 5.46085342e+00 2.23026644e-01 8.19940967e-01
 1.36278469e+03 2.41556346e+04 6.64730990e+02 9.84672481e+03
 3.00892715e+02 3.65593937e+03 3.13982545e+02 3.85581576e+03
 6.16667318e+01 5.04136403e+02 7.32990094e+00 3.51849570e+01
 2.02558094e+01 1.25363583e+02 7.72600342e-01 2.11313874e+00
 2.77597689e+00 1.04533189e+01 2.22247137e-01 4.45173814e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99388904583611
cond(S) = 114203.23798176489
E1 = -729.5390027243665  E_coul = 203.17558905992612
init E= -526.36341366444
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555780840771406  LUMO = 0.883888575516397
  mo_energy =
[-1.18331166e+02 -1.22066317e+01 -9.44711696e+00 -9.44711696e+00
 -9.44711696e+00 -1.24025793e+00 -5.55780841e-01 -5.55780841e-01
 -5.55780841e-01  8.83888576e-01  1.02808867e+00  1.02808867e+00
  1.02808867e+00  7.27615828e+00  7.27615828e+00  7.27615828e+00
  8.71118779e+00  3.33937384e+01  3.33937384e+01  3.33937384e+01
  3.99181352e+01  1.29098637e+02  1.29098637e+02  1.29098637e+02
  1.57899015e+02  4.83576250e+02  4.83576250e+02  4.83576250e+02
  6.49902397e+02  1.33536774e+03  1.33536774e+03  1.33536774e+03
  2.71635374e+03  3.02950431e+03  3.02950431e+03  3.02950431e+03
  6.64993597e+03  6.64993597e+03  6.64993597e+03  9.11760457e+03
  2.54702162e+04  7.62089409e+04]
E1 = -727.8327017716422  E_coul = 201.0864219645115
cycle= 1 E= -526.746279807131  delta_E= -0.383  |g|= 0.187  |ddm|= 0.307
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.557578
diis-c [-0.31089269  1.        ]
  HOMO = -0.591037541376221  LUMO = 0.859096825257767
  mo_energy =
[-1.18641438e+02 -1.23453804e+01 -9.59687379e+00 -9.59687379e+00
 -9.59687379e+00 -1.27988160e+00 -5.91037541e-01 -5.91037541e-01
 -5.91037541e-01  8.59096825e-01  1.00364012e+00  1.00364012e+00
  1.00364012e+00  7.18506707e+00  7.18506707e+00  7.18506707e+00
  8.62252000e+00  3.32381230e+01  3.32381230e+01  3.32381230e+01
  3.97727944e+01  1.28868297e+02  1.28868297e+02  1.28868297e+02
  1.57670671e+02  4.83267125e+02  4.83267125e+02  4.83267125e+02
  6.49555803e+02  1.33500167e+03  1.33500167e+03  1.33500167e+03
  2.71585409e+03  3.02907198e+03  3.02907198e+03  3.02907198e+03
  6.64939000e+03  6.64939000e+03  6.64939000e+03  9.11698369e+03
  2.54695007e+04  7.62081350e+04]
E1 = -728.4112806576153  E_coul = 201.664268187158
cycle= 2 E= -526.747012470457  delta_E= -0.000733  |g|= 0.038  |ddm|= 0.0529
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0769407
diis-c [-0.00358109  0.08023824  0.91976176]
  HOMO = -0.581845631906253  LUMO = 0.866326521930224
  mo_energy =
[-1.18573006e+02 -1.23069332e+01 -9.55675406e+00 -9.55675406e+00
 -9.55675406e+00 -1.26886157e+00 -5.81845632e-01 -5.81845632e-01
 -5.81845632e-01  8.66326522e-01  1.01039048e+00  1.01039048e+00
  1.01039048e+00  7.20892213e+00  7.20892213e+00  7.20892213e+00
  8.64673811e+00  3.32786115e+01  3.32786115e+01  3.32786115e+01
  3.98121442e+01  1.28924803e+02  1.28924803e+02  1.28924803e+02
  1.57727716e+02  4.83334740e+02  4.83334740e+02  4.83334740e+02
  6.49625515e+02  1.33507337e+03  1.33507337e+03  1.33507337e+03
  2.71592904e+03  3.02914594e+03  3.02914594e+03  3.02914594e+03
  6.64946571e+03  6.64946571e+03  6.64946571e+03  9.11706020e+03
  2.54695778e+04  7.62082124e+04]
E1 = -728.2589762661755  E_coul = 201.51190379103375
cycle= 3 E= -526.747072475142  delta_E= -6e-05  |g|= 0.00647  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136738
diis-c [-8.29961611e-07 -1.29418408e-03  1.46331618e-01  8.54962566e-01]
  HOMO = -0.583388138498217  LUMO = 0.865211788656249
  mo_energy =
[-1.18583253e+02 -1.23129039e+01 -9.56308372e+00 -9.56308372e+00
 -9.56308372e+00 -1.27059121e+00 -5.83388138e-01 -5.83388138e-01
 -5.83388138e-01  8.65211789e-01  1.00928418e+00  1.00928418e+00
  1.00928418e+00  7.20505917e+00  7.20505917e+00  7.20505917e+00
  8.64290249e+00  3.32722631e+01  3.32722631e+01  3.32722631e+01
  3.98060226e+01  1.28916213e+02  1.28916213e+02  1.28916213e+02
  1.57719081e+02  4.83324611e+02  4.83324611e+02  4.83324611e+02
  6.49615057e+02  1.33506263e+03  1.33506263e+03  1.33506263e+03
  2.71591767e+03  3.02913480e+03  3.02913480e+03  3.02913480e+03
  6.64945418e+03  6.64945418e+03  6.64945418e+03  9.11704845e+03
  2.54695658e+04  7.62082003e+04]
E1 = -728.282406489594  E_coul = 201.53533198148287
cycle= 4 E= -526.747074508111  delta_E= -2.03e-06  |g|= 0.000111  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000125978
diis-c [-5.71566094e-09  9.32625366e-05 -1.30267056e-02 -8.06765974e-02
  1.09361004e+00]
  HOMO = -0.583370102295539  LUMO = 0.86524523573203
  mo_energy =
[-1.18583206e+02 -1.23128351e+01 -9.56302955e+00 -9.56302955e+00
 -9.56302955e+00 -1.27054663e+00 -5.83370102e-01 -5.83370102e-01
 -5.83370102e-01  8.65245236e-01  1.00930018e+00  1.00930018e+00
  1.00930018e+00  7.20510217e+00  7.20510217e+00  7.20510217e+00
  8.64296070e+00  3.32723153e+01  3.32723153e+01  3.32723153e+01
  3.98060831e+01  1.28916265e+02  1.28916265e+02  1.28916265e+02
  1.57719135e+02  4.83324658e+02  4.83324658e+02  4.83324658e+02
  6.49615095e+02  1.33506267e+03  1.33506267e+03  1.33506267e+03
  2.71591768e+03  3.02913483e+03  3.02913483e+03  3.02913483e+03
  6.64945419e+03  6.64945419e+03  6.64945419e+03  9.11704845e+03
  2.54695658e+04  7.62082003e+04]
E1 = -728.2821653017189  E_coul = 201.5350907912297
cycle= 5 E= -526.747074510489  delta_E= -2.38e-09  |g|= 2.15e-05  |ddm|= 0.000185
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.97351e-05
diis-c [-1.06214373e-10  1.35785595e-05 -1.76267953e-03 -1.30390548e-02
  3.07832762e-02  9.84004880e-01]
  HOMO = -0.583378290721219  LUMO = 0.865241528745061
  mo_energy =
[-1.18583239e+02 -1.23128595e+01 -9.56305590e+00 -9.56305590e+00
 -9.56305590e+00 -1.27055310e+00 -5.83378291e-01 -5.83378291e-01
 -5.83378291e-01  8.65241529e-01  1.00929477e+00  1.00929477e+00
  1.00929477e+00  7.20508425e+00  7.20508425e+00  7.20508425e+00
  8.64294395e+00  3.32722898e+01  3.32722898e+01  3.32722898e+01
  3.98060584e+01  1.28916236e+02  1.28916236e+02  1.28916236e+02
  1.57719106e+02  4.83324626e+02  4.83324626e+02  4.83324626e+02
  6.49615063e+02  1.33506264e+03  1.33506264e+03  1.33506264e+03
  2.71591765e+03  3.02913479e+03  3.02913479e+03  3.02913479e+03
  6.64945416e+03  6.64945416e+03  6.64945416e+03  9.11704841e+03
  2.54695658e+04  7.62082002e+04]
E1 = -728.2822516250551  E_coul = 201.53517711449777
cycle= 6 E= -526.747074510557  delta_E= -6.81e-11  |g|= 1.87e-06  |ddm|= 2.1e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2822516250551  E_coul = 201.53517711449777
  HOMO = -0.583378132568733  LUMO = 0.865241983073761
  mo_energy =
[-1.18583238e+02 -1.23128587e+01 -9.56305516e+00 -9.56305516e+00
 -9.56305516e+00 -1.27055251e+00 -5.83378133e-01 -5.83378133e-01
 -5.83378133e-01  8.65241983e-01  1.00929494e+00  1.00929494e+00
  1.00929494e+00  7.20508474e+00  7.20508474e+00  7.20508474e+00
  8.64294460e+00  3.32722906e+01  3.32722906e+01  3.32722906e+01
  3.98060592e+01  1.28916237e+02  1.28916237e+02  1.28916237e+02
  1.57719107e+02  4.83324627e+02  4.83324627e+02  4.83324627e+02
  6.49615064e+02  1.33506264e+03  1.33506264e+03  1.33506264e+03
  2.71591765e+03  3.02913480e+03  3.02913480e+03  3.02913480e+03
  6.64945416e+03  6.64945416e+03  6.64945416e+03  9.11704841e+03
  2.54695658e+04  7.62082002e+04]
E1 = -728.2822480243924  E_coul = 201.53517351383522
Extra cycle  E= -526.747074510557  delta_E= 1.14e-13  |g|= 4.04e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114203.23798176489
E1 = -728.2822480243924  E_coul = 201.53517351383522
init E= -526.747074510557
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583378218385929  LUMO = 0.865241987480631
  mo_energy =
[-1.18583238e+02 -1.23128590e+01 -9.56305545e+00 -9.56305545e+00
 -9.56305545e+00 -1.27055252e+00 -5.83378218e-01 -5.83378218e-01
 -5.83378218e-01  8.65241987e-01  1.00929489e+00  1.00929489e+00
  1.00929489e+00  7.20508456e+00  7.20508456e+00  7.20508456e+00
  8.64294445e+00  3.32722903e+01  3.32722903e+01  3.32722903e+01
  3.98060589e+01  1.28916236e+02  1.28916236e+02  1.28916236e+02
  1.57719106e+02  4.83324626e+02  4.83324626e+02  4.83324626e+02
  6.49615063e+02  1.33506264e+03  1.33506264e+03  1.33506264e+03
  2.71591765e+03  3.02913479e+03  3.02913479e+03  3.02913479e+03
  6.64945416e+03  6.64945416e+03  6.64945416e+03  9.11704841e+03
  2.54695658e+04  7.62082002e+04]
E1 = -728.2822488791354  E_coul = 201.5351743685778
cycle= 1 E= -526.747074510558  delta_E= -3.41e-13  |g|= 9.66e-08  |ddm|= 6.02e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2822488791354  E_coul = 201.5351743685778
  HOMO = -0.583378205514224  LUMO = 0.865242011639968
  mo_energy =
[-1.18583238e+02 -1.23128589e+01 -9.56305539e+00 -9.56305539e+00
 -9.56305539e+00 -1.27055249e+00 -5.83378206e-01 -5.83378206e-01
 -5.83378206e-01  8.65242012e-01  1.00929490e+00  1.00929490e+00
  1.00929490e+00  7.20508460e+00  7.20508460e+00  7.20508460e+00
  8.64294450e+00  3.32722903e+01  3.32722903e+01  3.32722903e+01
  3.98060590e+01  1.28916236e+02  1.28916236e+02  1.28916236e+02
  1.57719106e+02  4.83324626e+02  4.83324626e+02  4.83324626e+02
  6.49615063e+02  1.33506264e+03  1.33506264e+03  1.33506264e+03
  2.71591765e+03  3.02913479e+03  3.02913479e+03  3.02913479e+03
  6.64945416e+03  6.64945416e+03  6.64945416e+03  9.11704841e+03
  2.54695658e+04  7.62082002e+04]
E1 = -728.2822486048852  E_coul = 201.53517409432848
Extra cycle  E= -526.747074510557  delta_E= 7.96e-13  |g|= 2.18e-08  |ddm|= 1.43e-07
    CPU time for scf_cycle      1.11 sec, wall time      0.62 sec
exp = [2.61826603e+04 7.61751245e+03 3.61735562e+03 1.59763210e+03
 3.82606617e+02 1.11795302e+02 3.84418799e+01 1.30906036e+01
 6.46548659e+00 6.29788139e-01 2.79464937e+00 2.23026644e-01
 1.36278469e+03 6.64730990e+02 3.00892715e+02 3.13982545e+02
 6.16667318e+01 7.32990094e+00 2.02558094e+01 7.72600342e-01
 2.77597689e+00 2.22247137e-01]
grad_E = [-1.53856795e-06  3.54364143e-06 -1.43887194e-06  7.78473176e-05
 -1.91560715e-04 -6.07057621e-04 -9.86470007e-04  8.70851457e-05
  4.31500081e-04  1.82513250e-03  1.33798132e-03 -9.57138640e-03
 -5.14062262e-07  4.91427646e-06  2.30652112e-05  1.98841750e-05
  4.35241690e-05  4.02683519e-03 -7.41725741e-04 -4.03909895e-03
 -6.72330401e-03  1.35630779e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:03 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.660761         1
[INPUT] 0    0    [1    /1   ]  7617.51141793        1
[INPUT] 0    0    [1    /1   ]  3617.35611044        1
[INPUT] 0    0    [1    /1   ]  1597.61045           1
[INPUT] 0    0    [1    /1   ]  382.604028303        1
[INPUT] 0    0    [1    /1   ]  112.150759375        1
[INPUT] 0    0    [1    /1   ]  38.7491440219        1
[INPUT] 0    0    [1    /1   ]  13.5392343715        1
[INPUT] 0    0    [1    /1   ]  6.53157359744        1
[INPUT] 0    0    [1    /1   ]  0.635394824796       1
[INPUT] 0    0    [1    /1   ]  2.79309943112        1
[INPUT] 0    0    [1    /1   ]  0.224045193249       1
[INPUT] 1    0    [1    /1   ]  1362.78485368        1
[INPUT] 1    0    [1    /1   ]  664.729432719        1
[INPUT] 1    0    [1    /1   ]  300.885376109        1
[INPUT] 1    0    [1    /1   ]  313.976217758        1
[INPUT] 1    0    [1    /1   ]  61.6693807295        1
[INPUT] 1    0    [1    /1   ]  7.31989495247        1
[INPUT] 1    0    [1    /1   ]  20.2685771126        1
[INPUT] 1    0    [1    /1   ]  0.770715743416       1
[INPUT] 1    0    [1    /1   ]  2.75042454422        1
[INPUT] 1    0    [1    /1   ]  0.222277936582       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.66076095255, 1.0]], [0, [7617.511417929319, 1.0]], [0, [3617.3561104382, 1.0]], [0, [1597.6104499969956, 1.0]], [0, [382.6040283033072, 1.0]], [0, [112.15075937456207, 1.0]], [0, [38.74914402185596, 1.0]], [0, [13.539234371503987, 1.0]], [0, [6.53157359743631, 1.0]], [0, [0.6353948247957447, 1.0]], [0, [2.79309943111603, 1.0]], [0, [0.2240451932487478, 1.0]], [1, [1362.7848536834813, 1.0]], [1, [664.7294327194464, 1.0]], [1, [300.88537610904154, 1.0]], [1, [313.9762177582879, 1.0]], [1, [61.66938072952852, 1.0]], [1, [7.319894952470677, 1.0]], [1, [20.26857711260167, 1.0]], [1, [0.7707157434164036, 1.0]], [1, [2.750424544220895, 1.0]], [1, [0.22227793658183792, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66076095]
bas 1, expnt(s) = [7617.51141793]
bas 2, expnt(s) = [3617.35611044]
bas 3, expnt(s) = [1597.61045]
bas 4, expnt(s) = [382.6040283]
bas 5, expnt(s) = [112.15075937]
bas 6, expnt(s) = [38.74914402]
bas 7, expnt(s) = [13.53923437]
bas 8, expnt(s) = [6.5315736]
bas 9, expnt(s) = [0.63539482]
bas 10, expnt(s) = [2.79309943]
bas 11, expnt(s) = [0.22404519]
bas 12, expnt(s) = [1362.78485368]
bas 13, expnt(s) = [664.72943272]
bas 14, expnt(s) = [300.88537611]
bas 15, expnt(s) = [313.97621776]
bas 16, expnt(s) = [61.66938073]
bas 17, expnt(s) = [7.31989495]
bas 18, expnt(s) = [20.26857711]
bas 19, expnt(s) = [0.77071574]
bas 20, expnt(s) = [2.75042454]
bas 21, expnt(s) = [0.22227794]
CPU time:       281.63
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826608e+04 5.20026360e+03 7.61751142e+03 2.06003624e+03
 3.61735611e+03 1.17844271e+03 1.59761045e+03 6.38437214e+02
 3.82604028e+02 2.18563269e+02 1.12150759e+02 8.70696278e+01
 3.87491440e+01 3.92384288e+01 1.35392344e+01 1.78324331e+01
 6.53157360e+00 1.03223455e+01 6.35394825e-01 1.79803350e+00
 2.79309943e+00 5.45858178e+00 2.24045193e-01 8.22747833e-01
 1.36278485e+03 2.41556381e+04 6.64729433e+02 9.84669597e+03
 3.00885376e+02 3.65582790e+03 3.13976218e+02 3.85571864e+03
 6.16693807e+01 5.04163472e+02 7.31989495e+00 3.51249289e+01
 2.02685771e+01 1.25462365e+02 7.70715743e-01 2.10669750e+00
 2.75042454e+00 1.03331816e+01 2.22277937e-01 4.45250933e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993899720749333
cond(S) = 114244.78807407043
E1 = -729.5396092607753  E_coul = 203.17588711486223
init E= -526.363722145913
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555768339775494  LUMO = 0.893607481749541
  mo_energy =
[-1.18331340e+02 -1.22066537e+01 -9.44706213e+00 -9.44706213e+00
 -9.44706213e+00 -1.24023704e+00 -5.55768340e-01 -5.55768340e-01
 -5.55768340e-01  8.93607482e-01  1.02637237e+00  1.02637237e+00
  1.02637237e+00  7.22275940e+00  7.22275940e+00  7.22275940e+00
  8.81496419e+00  3.32806159e+01  3.32806159e+01  3.32806159e+01
  4.07995475e+01  1.29010621e+02  1.29010621e+02  1.29010621e+02
  1.60537019e+02  4.83519970e+02  4.83519970e+02  4.83519970e+02
  6.53946637e+02  1.33530860e+03  1.33530860e+03  1.33530860e+03
  2.72058393e+03  3.02943046e+03  3.02943046e+03  3.02943046e+03
  6.64985313e+03  6.64985313e+03  6.64985313e+03  9.12158827e+03
  2.54739903e+04  7.62124546e+04]
E1 = -727.8372276710752  E_coul = 201.09068954946216
cycle= 1 E= -526.746538121613  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.557985
diis-c [-0.31134769  1.        ]
  HOMO = -0.590851467250304  LUMO = 0.868722407792185
  mo_energy =
[-1.18641299e+02 -1.23451783e+01 -9.59658357e+00 -9.59658357e+00
 -9.59658357e+00 -1.27964520e+00 -5.90851467e-01 -5.90851467e-01
 -5.90851467e-01  8.68722408e-01  1.00213762e+00  1.00213762e+00
  1.00213762e+00  7.13225674e+00  7.13225674e+00  7.13225674e+00
  8.72589793e+00  3.31252407e+01  3.31252407e+01  3.31252407e+01
  4.06531460e+01  1.28780496e+02  1.28780496e+02  1.28780496e+02
  1.60308248e+02  4.83211156e+02  4.83211156e+02  4.83211156e+02
  6.53600295e+02  1.33494287e+03  1.33494287e+03  1.33494287e+03
  2.72008472e+03  3.02899849e+03  3.02899849e+03  3.02899849e+03
  6.64930755e+03  6.64930755e+03  6.64930755e+03  9.12096781e+03
  2.54732752e+04  7.62116491e+04]
E1 = -728.4145271237044  E_coul = 201.66725888524851
cycle= 2 E= -526.747268238456  delta_E= -0.00073  |g|= 0.038  |ddm|= 0.0527
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.076807
diis-c [-0.0035899   0.07971984  0.92028016]
  HOMO = -0.581678998104098  LUMO = 0.876008781477171
  mo_energy =
[-1.18572952e+02 -1.23067981e+01 -9.55653314e+00 -9.55653314e+00
 -9.55653314e+00 -1.26864421e+00 -5.81678998e-01 -5.81678998e-01
 -5.81678998e-01  8.76008781e-01  1.00885184e+00  1.00885184e+00
  1.00885184e+00  7.15597234e+00  7.15597234e+00  7.15597234e+00
  8.75023207e+00  3.31656603e+01  3.31656603e+01  3.31656603e+01
  4.06927565e+01  1.28836931e+02  1.28836931e+02  1.28836931e+02
  1.60365336e+02  4.83278688e+02  4.83278688e+02  4.83278688e+02
  6.53669922e+02  1.33501448e+03  1.33501448e+03  1.33501448e+03
  2.72015959e+03  3.02907236e+03  3.02907236e+03  3.02907236e+03
  6.64938318e+03  6.64938318e+03  6.64938318e+03  9.12104424e+03
  2.54733522e+04  7.62117264e+04]
E1 = -728.262475127549  E_coul = 201.51514713353154
cycle= 3 E= -526.747327994017  delta_E= -5.98e-05  |g|= 0.00648  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136974
diis-c [-8.40595443e-07 -1.29710570e-03  1.46778476e-01  8.54518630e-01]
  HOMO = -0.583222366221564  LUMO = 0.874883835886255
  mo_energy =
[-1.18583219e+02 -1.23127775e+01 -9.56287220e+00 -9.56287220e+00
 -9.56287220e+00 -1.27037347e+00 -5.83222366e-01 -5.83222366e-01
 -5.83222366e-01  8.74883836e-01  1.00774882e+00  1.00774882e+00
  1.00774882e+00  7.15212005e+00  7.15212005e+00  7.15212005e+00
  8.74636757e+00  3.31593023e+01  3.31593023e+01  3.31593023e+01
  4.06865779e+01  1.28828323e+02  1.28828323e+02  1.28828323e+02
  1.60356667e+02  4.83268540e+02  4.83268540e+02  4.83268540e+02
  6.53659443e+02  1.33500372e+03  1.33500372e+03  1.33500372e+03
  2.72014819e+03  3.02906121e+03  3.02906121e+03  3.02906121e+03
  6.64937162e+03  6.64937162e+03  6.64937162e+03  9.12103246e+03
  2.54733402e+04  7.62117143e+04]
E1 = -728.2859349870255  E_coul = 201.53860495354374
cycle= 4 E= -526.747330033482  delta_E= -2.04e-06  |g|= 0.000113  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000127002
diis-c [-5.78647684e-09  9.42112871e-05 -1.31746607e-02 -8.12707300e-02
  1.09435118e+00]
  HOMO = -0.583204393281264  LUMO = 0.874917876396175
  mo_energy =
[-1.18583173e+02 -1.23127087e+01 -9.56281819e+00 -9.56281819e+00
 -9.56281819e+00 -1.27032852e+00 -5.83204393e-01 -5.83204393e-01
 -5.83204393e-01  8.74917876e-01  1.00776480e+00  1.00776480e+00
  1.00776480e+00  7.15216286e+00  7.15216286e+00  7.15216286e+00
  8.74642598e+00  3.31593545e+01  3.31593545e+01  3.31593545e+01
  4.06866383e+01  1.28828376e+02  1.28828376e+02  1.28828376e+02
  1.60356721e+02  4.83268586e+02  4.83268586e+02  4.83268586e+02
  6.53659482e+02  1.33500376e+03  1.33500376e+03  1.33500376e+03
  2.72014820e+03  3.02906123e+03  3.02906123e+03  3.02906123e+03
  6.64937163e+03  6.64937163e+03  6.64937163e+03  9.12103247e+03
  2.54733402e+04  7.62117143e+04]
E1 = -728.2856939698281  E_coul = 201.5383639338804
cycle= 5 E= -526.747330035948  delta_E= -2.47e-09  |g|= 2.16e-05  |ddm|= 0.000188
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.99028e-05
diis-c [-1.07492932e-10  1.36064873e-05 -1.77056170e-03 -1.30474716e-02
  2.88869001e-02  9.85917527e-01]
  HOMO = -0.583212602175026  LUMO = 0.874914158163397
  mo_energy =
[-1.18583205e+02 -1.23127332e+01 -9.56284462e+00 -9.56284462e+00
 -9.56284462e+00 -1.27033496e+00 -5.83212602e-01 -5.83212602e-01
 -5.83212602e-01  8.74914158e-01  1.00775940e+00  1.00775940e+00
  1.00775940e+00  7.15214495e+00  7.15214495e+00  7.15214495e+00
  8.74640911e+00  3.31593288e+01  3.31593288e+01  3.31593288e+01
  4.06866134e+01  1.28828346e+02  1.28828346e+02  1.28828346e+02
  1.60356692e+02  4.83268554e+02  4.83268554e+02  4.83268554e+02
  6.53659449e+02  1.33500372e+03  1.33500372e+03  1.33500372e+03
  2.72014817e+03  3.02906120e+03  3.02906120e+03  3.02906120e+03
  6.64937159e+03  6.64937159e+03  6.64937159e+03  9.12103243e+03
  2.54733402e+04  7.62117143e+04]
E1 = -728.2857805353325  E_coul = 201.5384504993165
cycle= 6 E= -526.747330036016  delta_E= -6.83e-11  |g|= 1.87e-06  |ddm|= 2.13e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2857805353325  E_coul = 201.5384504993165
  HOMO = -0.583212428428567  LUMO = 0.874914624808978
  mo_energy =
[-1.18583204e+02 -1.23127323e+01 -9.56284384e+00 -9.56284384e+00
 -9.56284384e+00 -1.27033436e+00 -5.83212428e-01 -5.83212428e-01
 -5.83212428e-01  8.74914625e-01  1.00775958e+00  1.00775958e+00
  1.00775958e+00  7.15214547e+00  7.15214547e+00  7.15214547e+00
  8.74640980e+00  3.31593296e+01  3.31593296e+01  3.31593296e+01
  4.06866143e+01  1.28828347e+02  1.28828347e+02  1.28828347e+02
  1.60356693e+02  4.83268555e+02  4.83268555e+02  4.83268555e+02
  6.53659450e+02  1.33500372e+03  1.33500372e+03  1.33500372e+03
  2.72014817e+03  3.02906120e+03  3.02906120e+03  3.02906120e+03
  6.64937159e+03  6.64937159e+03  6.64937159e+03  9.12103243e+03
  2.54733402e+04  7.62117143e+04]
E1 = -728.2857767886844  E_coul = 201.5384467526683
Extra cycle  E= -526.747330036016  delta_E= -1.14e-13  |g|= 4.04e-07  |ddm|= 3.23e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
exp = [2.61826608e+04 7.61751142e+03 3.61735611e+03 1.59761045e+03
 3.82604028e+02 1.12150759e+02 3.87491440e+01 1.35392344e+01
 6.53157360e+00 6.35394825e-01 2.79309943e+00 2.24045193e-01
 1.36278485e+03 6.64729433e+02 3.00885376e+02 3.13976218e+02
 6.16693807e+01 7.31989495e+00 2.02685771e+01 7.70715743e-01
 2.75042454e+00 2.22277937e-01]
E = -526.7473300360161
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:03 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.660761         1
[INPUT] 0    0    [1    /1   ]  7617.51141793        1
[INPUT] 0    0    [1    /1   ]  3617.35611044        1
[INPUT] 0    0    [1    /1   ]  1597.61045           1
[INPUT] 0    0    [1    /1   ]  382.604028303        1
[INPUT] 0    0    [1    /1   ]  112.150759375        1
[INPUT] 0    0    [1    /1   ]  38.7491440219        1
[INPUT] 0    0    [1    /1   ]  13.5392343715        1
[INPUT] 0    0    [1    /1   ]  6.53157359744        1
[INPUT] 0    0    [1    /1   ]  0.635394824796       1
[INPUT] 0    0    [1    /1   ]  2.79309943112        1
[INPUT] 0    0    [1    /1   ]  0.224045193249       1
[INPUT] 1    0    [1    /1   ]  1362.78485368        1
[INPUT] 1    0    [1    /1   ]  664.729432719        1
[INPUT] 1    0    [1    /1   ]  300.885376109        1
[INPUT] 1    0    [1    /1   ]  313.976217758        1
[INPUT] 1    0    [1    /1   ]  61.6693807295        1
[INPUT] 1    0    [1    /1   ]  7.31989495247        1
[INPUT] 1    0    [1    /1   ]  20.2685771126        1
[INPUT] 1    0    [1    /1   ]  0.770715743416       1
[INPUT] 1    0    [1    /1   ]  2.75042454422        1
[INPUT] 1    0    [1    /1   ]  0.222277936582       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.66076095255, 1.0]], [0, [7617.511417929319, 1.0]], [0, [3617.3561104382, 1.0]], [0, [1597.6104499969956, 1.0]], [0, [382.6040283033072, 1.0]], [0, [112.15075937456207, 1.0]], [0, [38.74914402185596, 1.0]], [0, [13.539234371503987, 1.0]], [0, [6.53157359743631, 1.0]], [0, [0.6353948247957447, 1.0]], [0, [2.79309943111603, 1.0]], [0, [0.2240451932487478, 1.0]], [1, [1362.7848536834813, 1.0]], [1, [664.7294327194464, 1.0]], [1, [300.88537610904154, 1.0]], [1, [313.9762177582879, 1.0]], [1, [61.66938072952852, 1.0]], [1, [7.319894952470677, 1.0]], [1, [20.26857711260167, 1.0]], [1, [0.7707157434164036, 1.0]], [1, [2.750424544220895, 1.0]], [1, [0.22227793658183792, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66076095]
bas 1, expnt(s) = [7617.51141793]
bas 2, expnt(s) = [3617.35611044]
bas 3, expnt(s) = [1597.61045]
bas 4, expnt(s) = [382.6040283]
bas 5, expnt(s) = [112.15075937]
bas 6, expnt(s) = [38.74914402]
bas 7, expnt(s) = [13.53923437]
bas 8, expnt(s) = [6.5315736]
bas 9, expnt(s) = [0.63539482]
bas 10, expnt(s) = [2.79309943]
bas 11, expnt(s) = [0.22404519]
bas 12, expnt(s) = [1362.78485368]
bas 13, expnt(s) = [664.72943272]
bas 14, expnt(s) = [300.88537611]
bas 15, expnt(s) = [313.97621776]
bas 16, expnt(s) = [61.66938073]
bas 17, expnt(s) = [7.31989495]
bas 18, expnt(s) = [20.26857711]
bas 19, expnt(s) = [0.77071574]
bas 20, expnt(s) = [2.75042454]
bas 21, expnt(s) = [0.22227794]
CPU time:       282.05
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826608e+04 5.20026360e+03 7.61751142e+03 2.06003624e+03
 3.61735611e+03 1.17844271e+03 1.59761045e+03 6.38437214e+02
 3.82604028e+02 2.18563269e+02 1.12150759e+02 8.70696278e+01
 3.87491440e+01 3.92384288e+01 1.35392344e+01 1.78324331e+01
 6.53157360e+00 1.03223455e+01 6.35394825e-01 1.79803350e+00
 2.79309943e+00 5.45858178e+00 2.24045193e-01 8.22747833e-01
 1.36278485e+03 2.41556381e+04 6.64729433e+02 9.84669597e+03
 3.00885376e+02 3.65582790e+03 3.13976218e+02 3.85571864e+03
 6.16693807e+01 5.04163472e+02 7.31989495e+00 3.51249289e+01
 2.02685771e+01 1.25462365e+02 7.70715743e-01 2.10669750e+00
 2.75042454e+00 1.03331816e+01 2.22277937e-01 4.45250933e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993899720749333
cond(S) = 114244.78807407043
E1 = -729.5396092607753  E_coul = 203.17588711486223
init E= -526.363722145913
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555768339775494  LUMO = 0.893607481749541
  mo_energy =
[-1.18331340e+02 -1.22066537e+01 -9.44706213e+00 -9.44706213e+00
 -9.44706213e+00 -1.24023704e+00 -5.55768340e-01 -5.55768340e-01
 -5.55768340e-01  8.93607482e-01  1.02637237e+00  1.02637237e+00
  1.02637237e+00  7.22275940e+00  7.22275940e+00  7.22275940e+00
  8.81496419e+00  3.32806159e+01  3.32806159e+01  3.32806159e+01
  4.07995475e+01  1.29010621e+02  1.29010621e+02  1.29010621e+02
  1.60537019e+02  4.83519970e+02  4.83519970e+02  4.83519970e+02
  6.53946637e+02  1.33530860e+03  1.33530860e+03  1.33530860e+03
  2.72058393e+03  3.02943046e+03  3.02943046e+03  3.02943046e+03
  6.64985313e+03  6.64985313e+03  6.64985313e+03  9.12158827e+03
  2.54739903e+04  7.62124546e+04]
E1 = -727.8372276710752  E_coul = 201.09068954946216
cycle= 1 E= -526.746538121613  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.557985
diis-c [-0.31134769  1.        ]
  HOMO = -0.590851467250304  LUMO = 0.868722407792185
  mo_energy =
[-1.18641299e+02 -1.23451783e+01 -9.59658357e+00 -9.59658357e+00
 -9.59658357e+00 -1.27964520e+00 -5.90851467e-01 -5.90851467e-01
 -5.90851467e-01  8.68722408e-01  1.00213762e+00  1.00213762e+00
  1.00213762e+00  7.13225674e+00  7.13225674e+00  7.13225674e+00
  8.72589793e+00  3.31252407e+01  3.31252407e+01  3.31252407e+01
  4.06531460e+01  1.28780496e+02  1.28780496e+02  1.28780496e+02
  1.60308248e+02  4.83211156e+02  4.83211156e+02  4.83211156e+02
  6.53600295e+02  1.33494287e+03  1.33494287e+03  1.33494287e+03
  2.72008472e+03  3.02899849e+03  3.02899849e+03  3.02899849e+03
  6.64930755e+03  6.64930755e+03  6.64930755e+03  9.12096781e+03
  2.54732752e+04  7.62116491e+04]
E1 = -728.4145271237044  E_coul = 201.66725888524851
cycle= 2 E= -526.747268238456  delta_E= -0.00073  |g|= 0.038  |ddm|= 0.0527
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.076807
diis-c [-0.0035899   0.07971984  0.92028016]
  HOMO = -0.581678998104098  LUMO = 0.876008781477171
  mo_energy =
[-1.18572952e+02 -1.23067981e+01 -9.55653314e+00 -9.55653314e+00
 -9.55653314e+00 -1.26864421e+00 -5.81678998e-01 -5.81678998e-01
 -5.81678998e-01  8.76008781e-01  1.00885184e+00  1.00885184e+00
  1.00885184e+00  7.15597234e+00  7.15597234e+00  7.15597234e+00
  8.75023207e+00  3.31656603e+01  3.31656603e+01  3.31656603e+01
  4.06927565e+01  1.28836931e+02  1.28836931e+02  1.28836931e+02
  1.60365336e+02  4.83278688e+02  4.83278688e+02  4.83278688e+02
  6.53669922e+02  1.33501448e+03  1.33501448e+03  1.33501448e+03
  2.72015959e+03  3.02907236e+03  3.02907236e+03  3.02907236e+03
  6.64938318e+03  6.64938318e+03  6.64938318e+03  9.12104424e+03
  2.54733522e+04  7.62117264e+04]
E1 = -728.262475127549  E_coul = 201.51514713353154
cycle= 3 E= -526.747327994017  delta_E= -5.98e-05  |g|= 0.00648  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0136974
diis-c [-8.40595443e-07 -1.29710570e-03  1.46778476e-01  8.54518630e-01]
  HOMO = -0.583222366221564  LUMO = 0.874883835886255
  mo_energy =
[-1.18583219e+02 -1.23127775e+01 -9.56287220e+00 -9.56287220e+00
 -9.56287220e+00 -1.27037347e+00 -5.83222366e-01 -5.83222366e-01
 -5.83222366e-01  8.74883836e-01  1.00774882e+00  1.00774882e+00
  1.00774882e+00  7.15212005e+00  7.15212005e+00  7.15212005e+00
  8.74636757e+00  3.31593023e+01  3.31593023e+01  3.31593023e+01
  4.06865779e+01  1.28828323e+02  1.28828323e+02  1.28828323e+02
  1.60356667e+02  4.83268540e+02  4.83268540e+02  4.83268540e+02
  6.53659443e+02  1.33500372e+03  1.33500372e+03  1.33500372e+03
  2.72014819e+03  3.02906121e+03  3.02906121e+03  3.02906121e+03
  6.64937162e+03  6.64937162e+03  6.64937162e+03  9.12103246e+03
  2.54733402e+04  7.62117143e+04]
E1 = -728.2859349870255  E_coul = 201.53860495354374
cycle= 4 E= -526.747330033482  delta_E= -2.04e-06  |g|= 0.000113  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000127002
diis-c [-5.78647684e-09  9.42112871e-05 -1.31746607e-02 -8.12707300e-02
  1.09435118e+00]
  HOMO = -0.583204393281264  LUMO = 0.874917876396175
  mo_energy =
[-1.18583173e+02 -1.23127087e+01 -9.56281819e+00 -9.56281819e+00
 -9.56281819e+00 -1.27032852e+00 -5.83204393e-01 -5.83204393e-01
 -5.83204393e-01  8.74917876e-01  1.00776480e+00  1.00776480e+00
  1.00776480e+00  7.15216286e+00  7.15216286e+00  7.15216286e+00
  8.74642598e+00  3.31593545e+01  3.31593545e+01  3.31593545e+01
  4.06866383e+01  1.28828376e+02  1.28828376e+02  1.28828376e+02
  1.60356721e+02  4.83268586e+02  4.83268586e+02  4.83268586e+02
  6.53659482e+02  1.33500376e+03  1.33500376e+03  1.33500376e+03
  2.72014820e+03  3.02906123e+03  3.02906123e+03  3.02906123e+03
  6.64937163e+03  6.64937163e+03  6.64937163e+03  9.12103247e+03
  2.54733402e+04  7.62117143e+04]
E1 = -728.2856939698281  E_coul = 201.5383639338804
cycle= 5 E= -526.747330035948  delta_E= -2.47e-09  |g|= 2.16e-05  |ddm|= 0.000188
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.99028e-05
diis-c [-1.07492932e-10  1.36064873e-05 -1.77056170e-03 -1.30474716e-02
  2.88869001e-02  9.85917527e-01]
  HOMO = -0.583212602175026  LUMO = 0.874914158163397
  mo_energy =
[-1.18583205e+02 -1.23127332e+01 -9.56284462e+00 -9.56284462e+00
 -9.56284462e+00 -1.27033496e+00 -5.83212602e-01 -5.83212602e-01
 -5.83212602e-01  8.74914158e-01  1.00775940e+00  1.00775940e+00
  1.00775940e+00  7.15214495e+00  7.15214495e+00  7.15214495e+00
  8.74640911e+00  3.31593288e+01  3.31593288e+01  3.31593288e+01
  4.06866134e+01  1.28828346e+02  1.28828346e+02  1.28828346e+02
  1.60356692e+02  4.83268554e+02  4.83268554e+02  4.83268554e+02
  6.53659449e+02  1.33500372e+03  1.33500372e+03  1.33500372e+03
  2.72014817e+03  3.02906120e+03  3.02906120e+03  3.02906120e+03
  6.64937159e+03  6.64937159e+03  6.64937159e+03  9.12103243e+03
  2.54733402e+04  7.62117143e+04]
E1 = -728.2857805353325  E_coul = 201.5384504993165
cycle= 6 E= -526.747330036016  delta_E= -6.83e-11  |g|= 1.87e-06  |ddm|= 2.13e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2857805353325  E_coul = 201.5384504993165
  HOMO = -0.583212428428567  LUMO = 0.874914624808978
  mo_energy =
[-1.18583204e+02 -1.23127323e+01 -9.56284384e+00 -9.56284384e+00
 -9.56284384e+00 -1.27033436e+00 -5.83212428e-01 -5.83212428e-01
 -5.83212428e-01  8.74914625e-01  1.00775958e+00  1.00775958e+00
  1.00775958e+00  7.15214547e+00  7.15214547e+00  7.15214547e+00
  8.74640980e+00  3.31593296e+01  3.31593296e+01  3.31593296e+01
  4.06866143e+01  1.28828347e+02  1.28828347e+02  1.28828347e+02
  1.60356693e+02  4.83268555e+02  4.83268555e+02  4.83268555e+02
  6.53659450e+02  1.33500372e+03  1.33500372e+03  1.33500372e+03
  2.72014817e+03  3.02906120e+03  3.02906120e+03  3.02906120e+03
  6.64937159e+03  6.64937159e+03  6.64937159e+03  9.12103243e+03
  2.54733402e+04  7.62117143e+04]
E1 = -728.2857767886844  E_coul = 201.5384467526683
Extra cycle  E= -526.747330036016  delta_E= -1.14e-13  |g|= 4.04e-07  |ddm|= 3.23e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114244.78807407043
E1 = -728.2857767886844  E_coul = 201.5384467526683
init E= -526.747330036016
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583212516697913  LUMO = 0.874914626517582
  mo_energy =
[-1.18583205e+02 -1.23127326e+01 -9.56284413e+00 -9.56284413e+00
 -9.56284413e+00 -1.27033438e+00 -5.83212517e-01 -5.83212517e-01
 -5.83212517e-01  8.74914627e-01  1.00775953e+00  1.00775953e+00
  1.00775953e+00  7.15214528e+00  7.15214528e+00  7.15214528e+00
  8.74640964e+00  3.31593294e+01  3.31593294e+01  3.31593294e+01
  4.06866140e+01  1.28828347e+02  1.28828347e+02  1.28828347e+02
  1.60356692e+02  4.83268555e+02  4.83268555e+02  4.83268555e+02
  6.53659450e+02  1.33500372e+03  1.33500372e+03  1.33500372e+03
  2.72014817e+03  3.02906120e+03  3.02906120e+03  3.02906120e+03
  6.64937159e+03  6.64937159e+03  6.64937159e+03  9.12103243e+03
  2.54733402e+04  7.62117143e+04]
E1 = -728.285777689998  E_coul = 201.5384476539819
cycle= 1 E= -526.747330036016  delta_E=    0  |g|= 9.76e-08  |ddm|= 5.93e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.285777689998  E_coul = 201.5384476539819
  HOMO = -0.583212502874624  LUMO = 0.874914651441153
  mo_energy =
[-1.18583205e+02 -1.23127325e+01 -9.56284407e+00 -9.56284407e+00
 -9.56284407e+00 -1.27033435e+00 -5.83212503e-01 -5.83212503e-01
 -5.83212503e-01  8.74914651e-01  1.00775954e+00  1.00775954e+00
  1.00775954e+00  7.15214532e+00  7.15214532e+00  7.15214532e+00
  8.74640969e+00  3.31593294e+01  3.31593294e+01  3.31593294e+01
  4.06866140e+01  1.28828347e+02  1.28828347e+02  1.28828347e+02
  1.60356692e+02  4.83268555e+02  4.83268555e+02  4.83268555e+02
  6.53659450e+02  1.33500372e+03  1.33500372e+03  1.33500372e+03
  2.72014817e+03  3.02906120e+03  3.02906120e+03  3.02906120e+03
  6.64937159e+03  6.64937159e+03  6.64937159e+03  9.12103243e+03
  2.54733402e+04  7.62117143e+04]
E1 = -728.2857774038106  E_coul = 201.53844736779425
Extra cycle  E= -526.747330036016  delta_E= -2.27e-13  |g|= 2.22e-08  |ddm|= 1.42e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61826608e+04 7.61751142e+03 3.61735611e+03 1.59761045e+03
 3.82604028e+02 1.12150759e+02 3.87491440e+01 1.35392344e+01
 6.53157360e+00 6.35394825e-01 2.79309943e+00 2.24045193e-01
 1.36278485e+03 6.64729433e+02 3.00885376e+02 3.13976218e+02
 6.16693807e+01 7.31989495e+00 2.02685771e+01 7.70715743e-01
 2.75042454e+00 2.22277937e-01]
grad_E = [-1.54086269e-06  3.57020197e-06 -1.42084214e-06  7.88256433e-05
 -2.12128984e-04 -5.70659106e-04 -9.12617780e-04  1.01926854e-04
  5.46824336e-04  3.41274055e-03  9.70453117e-04 -1.23124414e-02
 -5.13807144e-07  4.91851303e-06  2.30873242e-05  1.99032062e-05
  4.79097576e-05  5.99732885e-03 -9.61442005e-04 -7.94844797e-03
 -1.04576553e-02  2.66523257e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:08 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.661682         1
[INPUT] 0    0    [1    /1   ]  7617.50940651        1
[INPUT] 0    0    [1    /1   ]  3617.35706171        1
[INPUT] 0    0    [1    /1   ]  1597.56838134        1
[INPUT] 0    0    [1    /1   ]  382.599023139        1
[INPUT] 0    0    [1    /1   ]  112.845924094        1
[INPUT] 0    0    [1    /1   ]  39.333099928         1
[INPUT] 0    0    [1    /1   ]  14.4452403578        1
[INPUT] 0    0    [1    /1   ]  6.54075179025        1
[INPUT] 0    0    [1    /1   ]  0.647902727991       1
[INPUT] 0    0    [1    /1   ]  2.76969180016        1
[INPUT] 0    0    [1    /1   ]  0.227623093086       1
[INPUT] 1    0    [1    /1   ]  1362.78516226        1
[INPUT] 1    0    [1    /1   ]  664.726407387        1
[INPUT] 1    0    [1    /1   ]  300.871120186        1
[INPUT] 1    0    [1    /1   ]  313.963927364        1
[INPUT] 1    0    [1    /1   ]  61.6748669162        1
[INPUT] 1    0    [1    /1   ]  7.29739145314        1
[INPUT] 1    0    [1    /1   ]  20.2915705269        1
[INPUT] 1    0    [1    /1   ]  0.768240888402       1
[INPUT] 1    0    [1    /1   ]  2.71686221866        1
[INPUT] 1    0    [1    /1   ]  0.222249197997       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.661681959187, 1.0]], [0, [7617.509406505083, 1.0]], [0, [3617.357061711248, 1.0]], [0, [1597.5683813389674, 1.0]], [0, [382.59902313914733, 1.0]], [0, [112.84592409376091, 1.0]], [0, [39.33309992802657, 1.0]], [0, [14.445240357840094, 1.0]], [0, [6.5407517902499395, 1.0]], [0, [0.6479027279909683, 1.0]], [0, [2.7696918001648374, 1.0]], [0, [0.22762309308573037, 1.0]], [1, [1362.7851622606192, 1.0]], [1, [664.7264073867608, 1.0]], [1, [300.871120185808, 1.0]], [1, [313.96392736440794, 1.0]], [1, [61.67486691623189, 1.0]], [1, [7.297391453142936, 1.0]], [1, [20.29157052691981, 1.0]], [1, [0.768240888402387, 1.0]], [1, [2.716862218663656, 1.0]], [1, [0.22224919799685083, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66168196]
bas 1, expnt(s) = [7617.50940651]
bas 2, expnt(s) = [3617.35706171]
bas 3, expnt(s) = [1597.56838134]
bas 4, expnt(s) = [382.59902314]
bas 5, expnt(s) = [112.84592409]
bas 6, expnt(s) = [39.33309993]
bas 7, expnt(s) = [14.44524036]
bas 8, expnt(s) = [6.54075179]
bas 9, expnt(s) = [0.64790273]
bas 10, expnt(s) = [2.7696918]
bas 11, expnt(s) = [0.22762309]
bas 12, expnt(s) = [1362.78516226]
bas 13, expnt(s) = [664.72640739]
bas 14, expnt(s) = [300.87112019]
bas 15, expnt(s) = [313.96392736]
bas 16, expnt(s) = [61.67486692]
bas 17, expnt(s) = [7.29739145]
bas 18, expnt(s) = [20.29157053]
bas 19, expnt(s) = [0.76824089]
bas 20, expnt(s) = [2.71686222]
bas 21, expnt(s) = [0.2222492]
CPU time:       287.74
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826617e+04 5.20026374e+03 7.61750941e+03 2.06003583e+03
 3.61735706e+03 1.17844294e+03 1.59756838e+03 6.38424605e+02
 3.82599023e+02 2.18561125e+02 1.12845924e+02 8.74740898e+01
 3.93330999e+01 3.96810957e+01 1.44452404e+01 1.87201189e+01
 6.54075179e+00 1.03332224e+01 6.47902728e-01 1.82451476e+00
 2.76969180e+00 5.42423639e+00 2.27623093e-01 8.32582474e-01
 1.36278516e+03 2.41556450e+04 6.64726407e+02 9.84663995e+03
 3.00871120e+02 3.65561139e+03 3.13963927e+02 3.85552997e+03
 6.16748669e+01 5.04219536e+02 7.29739145e+00 3.49900004e+01
 2.02915705e+01 1.25640301e+02 7.68240888e-01 2.09824485e+00
 2.71686222e+00 1.01758082e+01 2.22249198e-01 4.45178975e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99391418944524
cond(S) = 114269.52813170747
E1 = -729.540295742537  E_coul = 203.17594088101163
init E= -526.364354861525
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555771343043551  LUMO = 0.918840932935779
  mo_energy =
[-1.18331648e+02 -1.22067512e+01 -9.44700182e+00 -9.44700182e+00
 -9.44700182e+00 -1.24021895e+00 -5.55771343e-01 -5.55771343e-01
 -5.55771343e-01  9.18840933e-01  1.02388899e+00  1.02388899e+00
  1.02388899e+00  7.14959825e+00  7.14959825e+00  7.14959825e+00
  8.92211742e+00  3.31135070e+01  3.31135070e+01  3.31135070e+01
  4.21476882e+01  1.28881345e+02  1.28881345e+02  1.28881345e+02
  1.65168876e+02  4.83440991e+02  4.83440991e+02  4.83440991e+02
  6.61359132e+02  1.33521984e+03  1.33521984e+03  1.33521984e+03
  2.72843332e+03  3.02931099e+03  3.02931099e+03  3.02931099e+03
  6.64971402e+03  6.64971402e+03  6.64971402e+03  9.12899527e+03
  2.54810092e+04  7.62189897e+04]
E1 = -727.844202157895  E_coul = 201.0971621185639
cycle= 1 E= -526.747040039331  delta_E= -0.383  |g|= 0.187  |ddm|= 0.313
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.558967
diis-c [-0.31244367  1.        ]
  HOMO = -0.590613270220172  LUMO = 0.893581474644616
  mo_energy =
[-1.18641031e+02 -1.23448727e+01 -9.59611338e+00 -9.59611338e+00
 -9.59611338e+00 -1.27935595e+00 -5.90613270e-01 -5.90613270e-01
 -5.90613270e-01  8.93581475e-01  9.99943906e-01  9.99943906e-01
  9.99943906e-01  7.05997113e+00  7.05997113e+00  7.05997113e+00
  8.83282819e+00  3.29585569e+01  3.29585569e+01  3.29585569e+01
  4.19995292e+01  1.28651633e+02  1.28651633e+02  1.28651633e+02
  1.64939218e+02  4.83132736e+02  4.83132736e+02  4.83132736e+02
  6.61013235e+02  1.33485472e+03  1.33485472e+03  1.33485472e+03
  2.72793495e+03  3.02887973e+03  3.02887973e+03  3.02887973e+03
  6.64916917e+03  6.64916917e+03  6.64916917e+03  9.12837565e+03
  2.54802949e+04  7.62181849e+04]
E1 = -728.4198737051387  E_coul = 201.67210727027157
cycle= 2 E= -526.747766434867  delta_E= -0.000726  |g|= 0.0379  |ddm|= 0.0524
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766899
diis-c [-0.0036131   0.07893588  0.92106412]
  HOMO = -0.581466167810625  LUMO = 0.901002527447781
  mo_energy =
[-1.18572782e+02 -1.23065721e+01 -9.55614326e+00 -9.55614326e+00
 -9.55614326e+00 -1.26838292e+00 -5.81466168e-01 -5.81466168e-01
 -5.81466168e-01  9.01002527e-01  1.00660949e+00  1.00660949e+00
  1.00660949e+00  7.08350021e+00  7.08350021e+00  7.08350021e+00
  8.85725694e+00  3.29988917e+01  3.29988917e+01  3.29988917e+01
  4.20396116e+01  1.28707991e+02  1.28707991e+02  1.28707991e+02
  1.64996453e+02  4.83200173e+02  4.83200173e+02  4.83200173e+02
  6.61082770e+02  1.33492623e+03  1.33492623e+03  1.33492623e+03
  2.72800971e+03  3.02895350e+03  3.02895350e+03  3.02895350e+03
  6.64924470e+03  6.64924470e+03  6.64924470e+03  9.12845197e+03
  2.54803718e+04  7.62182622e+04]
E1 = -728.2680734270324  E_coul = 201.52024753949976
cycle= 3 E= -526.747825887533  delta_E= -5.95e-05  |g|= 0.00651  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0137486
diis-c [-8.51855524e-07 -1.30199991e-03  1.47466179e-01  8.53835821e-01]
  HOMO = -0.583012117209915  LUMO = 0.899851535033046
  mo_energy =
[-1.18583088e+02 -1.23125708e+01 -9.56250271e+00 -9.56250271e+00
 -9.56250271e+00 -1.27011539e+00 -5.83012117e-01 -5.83012117e-01
 -5.83012117e-01  8.99851535e-01  1.00550969e+00  1.00550969e+00
  1.00550969e+00  7.07965845e+00  7.07965845e+00  7.07965845e+00
  8.85335825e+00  3.29925137e+01  3.29925137e+01  3.29925137e+01
  4.20333327e+01  1.28699349e+02  1.28699349e+02  1.28699349e+02
  1.64987717e+02  4.83189985e+02  4.83189985e+02  4.83189985e+02
  6.61072250e+02  1.33491543e+03  1.33491543e+03  1.33491543e+03
  2.72799827e+03  3.02894230e+03  3.02894230e+03  3.02894230e+03
  6.64923310e+03  6.64923310e+03  6.64923310e+03  9.12844015e+03
  2.54803598e+04  7.62182500e+04]
E1 = -728.291620414698  E_coul = 201.54379247321984
cycle= 4 E= -526.747827941478  delta_E= -2.05e-06  |g|= 0.000113  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000125874
diis-c [-5.79457626e-09  9.35064380e-05 -1.31230552e-02 -8.03642506e-02
  1.09339380e+00]
  HOMO = -0.582993695367985  LUMO = 0.899886548267499
  mo_energy =
[-1.18583040e+02 -1.23125008e+01 -9.56244750e+00 -9.56244750e+00
 -9.56244750e+00 -1.27006993e+00 -5.82993695e-01 -5.82993695e-01
 -5.82993695e-01  8.99886548e-01  1.00552595e+00  1.00552595e+00
  1.00552595e+00  7.07970195e+00  7.07970195e+00  7.07970195e+00
  8.85341755e+00  3.29925670e+01  3.29925670e+01  3.29925670e+01
  4.20333943e+01  1.28699403e+02  1.28699403e+02  1.28699403e+02
  1.64987773e+02  4.83190034e+02  4.83190034e+02  4.83190034e+02
  6.61072291e+02  1.33491547e+03  1.33491547e+03  1.33491547e+03
  2.72799829e+03  3.02894233e+03  3.02894233e+03  3.02894233e+03
  6.64923311e+03  6.64923311e+03  6.64923311e+03  9.12844016e+03
  2.54803598e+04  7.62182500e+04]
E1 = -728.2913768790561  E_coul = 201.54354893510947
cycle= 5 E= -526.747827943947  delta_E= -2.47e-09  |g|= 2.17e-05  |ddm|= 0.000189
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.00954e-05
diis-c [-1.06739731e-10  1.35812310e-05 -1.77894192e-03 -1.30344147e-02
  2.80685406e-02  9.86731235e-01]
  HOMO = -0.58300186934947  LUMO = 0.899882780398277
  mo_energy =
[-1.18583073e+02 -1.23125252e+01 -9.56247391e+00 -9.56247391e+00
 -9.56247391e+00 -1.27007632e+00 -5.83001869e-01 -5.83001869e-01
 -5.83001869e-01  8.99882780e-01  1.00552061e+00  1.00552061e+00
  1.00552061e+00  7.07968416e+00  7.07968416e+00  7.07968416e+00
  8.85340065e+00  3.29925414e+01  3.29925414e+01  3.29925414e+01
  4.20333693e+01  1.28699373e+02  1.28699373e+02  1.28699373e+02
  1.64987743e+02  4.83190001e+02  4.83190001e+02  4.83190001e+02
  6.61072258e+02  1.33491544e+03  1.33491544e+03  1.33491544e+03
  2.72799826e+03  3.02894229e+03  3.02894229e+03  3.02894229e+03
  6.64923308e+03  6.64923308e+03  6.64923308e+03  9.12844012e+03
  2.54803598e+04  7.62182500e+04]
E1 = -728.2914636519511  E_coul = 201.5436357079352
cycle= 6 E= -526.747827944016  delta_E= -6.92e-11  |g|= 1.86e-06  |ddm|= 2.13e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2914636519511  E_coul = 201.5436357079352
  HOMO = -0.583001692139354  LUMO = 0.899883254916196
  mo_energy =
[-1.18583072e+02 -1.23125244e+01 -9.56247313e+00 -9.56247313e+00
 -9.56247313e+00 -1.27007572e+00 -5.83001692e-01 -5.83001692e-01
 -5.83001692e-01  8.99883255e-01  1.00552079e+00  1.00552079e+00
  1.00552079e+00  7.07968469e+00  7.07968469e+00  7.07968469e+00
  8.85340133e+00  3.29925422e+01  3.29925422e+01  3.29925422e+01
  4.20333701e+01  1.28699374e+02  1.28699374e+02  1.28699374e+02
  1.64987744e+02  4.83190002e+02  4.83190002e+02  4.83190002e+02
  6.61072259e+02  1.33491544e+03  1.33491544e+03  1.33491544e+03
  2.72799826e+03  3.02894230e+03  3.02894230e+03  3.02894230e+03
  6.64923308e+03  6.64923308e+03  6.64923308e+03  9.12844012e+03
  2.54803598e+04  7.62182500e+04]
E1 = -728.2914599649238  E_coul = 201.54363202090607
Extra cycle  E= -526.747827944018  delta_E= -1.82e-12  |g|= 4e-07  |ddm|= 3.19e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826617e+04 7.61750941e+03 3.61735706e+03 1.59756838e+03
 3.82599023e+02 1.12845924e+02 3.93330999e+01 1.44452404e+01
 6.54075179e+00 6.47902728e-01 2.76969180e+00 2.27623093e-01
 1.36278516e+03 6.64726407e+02 3.00871120e+02 3.13963927e+02
 6.16748669e+01 7.29739145e+00 2.02915705e+01 7.68240888e-01
 2.71686222e+00 2.22249198e-01]
E = -526.7478279440177
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:08 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.661682         1
[INPUT] 0    0    [1    /1   ]  7617.50940651        1
[INPUT] 0    0    [1    /1   ]  3617.35706171        1
[INPUT] 0    0    [1    /1   ]  1597.56838134        1
[INPUT] 0    0    [1    /1   ]  382.599023139        1
[INPUT] 0    0    [1    /1   ]  112.845924094        1
[INPUT] 0    0    [1    /1   ]  39.333099928         1
[INPUT] 0    0    [1    /1   ]  14.4452403578        1
[INPUT] 0    0    [1    /1   ]  6.54075179025        1
[INPUT] 0    0    [1    /1   ]  0.647902727991       1
[INPUT] 0    0    [1    /1   ]  2.76969180016        1
[INPUT] 0    0    [1    /1   ]  0.227623093086       1
[INPUT] 1    0    [1    /1   ]  1362.78516226        1
[INPUT] 1    0    [1    /1   ]  664.726407387        1
[INPUT] 1    0    [1    /1   ]  300.871120186        1
[INPUT] 1    0    [1    /1   ]  313.963927364        1
[INPUT] 1    0    [1    /1   ]  61.6748669162        1
[INPUT] 1    0    [1    /1   ]  7.29739145314        1
[INPUT] 1    0    [1    /1   ]  20.2915705269        1
[INPUT] 1    0    [1    /1   ]  0.768240888402       1
[INPUT] 1    0    [1    /1   ]  2.71686221866        1
[INPUT] 1    0    [1    /1   ]  0.222249197997       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.661681959187, 1.0]], [0, [7617.509406505083, 1.0]], [0, [3617.357061711248, 1.0]], [0, [1597.5683813389674, 1.0]], [0, [382.59902313914733, 1.0]], [0, [112.84592409376091, 1.0]], [0, [39.33309992802657, 1.0]], [0, [14.445240357840094, 1.0]], [0, [6.5407517902499395, 1.0]], [0, [0.6479027279909683, 1.0]], [0, [2.7696918001648374, 1.0]], [0, [0.22762309308573037, 1.0]], [1, [1362.7851622606192, 1.0]], [1, [664.7264073867608, 1.0]], [1, [300.871120185808, 1.0]], [1, [313.96392736440794, 1.0]], [1, [61.67486691623189, 1.0]], [1, [7.297391453142936, 1.0]], [1, [20.29157052691981, 1.0]], [1, [0.768240888402387, 1.0]], [1, [2.716862218663656, 1.0]], [1, [0.22224919799685083, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66168196]
bas 1, expnt(s) = [7617.50940651]
bas 2, expnt(s) = [3617.35706171]
bas 3, expnt(s) = [1597.56838134]
bas 4, expnt(s) = [382.59902314]
bas 5, expnt(s) = [112.84592409]
bas 6, expnt(s) = [39.33309993]
bas 7, expnt(s) = [14.44524036]
bas 8, expnt(s) = [6.54075179]
bas 9, expnt(s) = [0.64790273]
bas 10, expnt(s) = [2.7696918]
bas 11, expnt(s) = [0.22762309]
bas 12, expnt(s) = [1362.78516226]
bas 13, expnt(s) = [664.72640739]
bas 14, expnt(s) = [300.87112019]
bas 15, expnt(s) = [313.96392736]
bas 16, expnt(s) = [61.67486692]
bas 17, expnt(s) = [7.29739145]
bas 18, expnt(s) = [20.29157053]
bas 19, expnt(s) = [0.76824089]
bas 20, expnt(s) = [2.71686222]
bas 21, expnt(s) = [0.2222492]
CPU time:       288.17
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826617e+04 5.20026374e+03 7.61750941e+03 2.06003583e+03
 3.61735706e+03 1.17844294e+03 1.59756838e+03 6.38424605e+02
 3.82599023e+02 2.18561125e+02 1.12845924e+02 8.74740898e+01
 3.93330999e+01 3.96810957e+01 1.44452404e+01 1.87201189e+01
 6.54075179e+00 1.03332224e+01 6.47902728e-01 1.82451476e+00
 2.76969180e+00 5.42423639e+00 2.27623093e-01 8.32582474e-01
 1.36278516e+03 2.41556450e+04 6.64726407e+02 9.84663995e+03
 3.00871120e+02 3.65561139e+03 3.13963927e+02 3.85552997e+03
 6.16748669e+01 5.04219536e+02 7.29739145e+00 3.49900004e+01
 2.02915705e+01 1.25640301e+02 7.68240888e-01 2.09824485e+00
 2.71686222e+00 1.01758082e+01 2.22249198e-01 4.45178975e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99391418944524
cond(S) = 114269.52813170747
E1 = -729.540295742537  E_coul = 203.17594088101163
init E= -526.364354861525
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555771343043551  LUMO = 0.918840932935779
  mo_energy =
[-1.18331648e+02 -1.22067512e+01 -9.44700182e+00 -9.44700182e+00
 -9.44700182e+00 -1.24021895e+00 -5.55771343e-01 -5.55771343e-01
 -5.55771343e-01  9.18840933e-01  1.02388899e+00  1.02388899e+00
  1.02388899e+00  7.14959825e+00  7.14959825e+00  7.14959825e+00
  8.92211742e+00  3.31135070e+01  3.31135070e+01  3.31135070e+01
  4.21476882e+01  1.28881345e+02  1.28881345e+02  1.28881345e+02
  1.65168876e+02  4.83440991e+02  4.83440991e+02  4.83440991e+02
  6.61359132e+02  1.33521984e+03  1.33521984e+03  1.33521984e+03
  2.72843332e+03  3.02931099e+03  3.02931099e+03  3.02931099e+03
  6.64971402e+03  6.64971402e+03  6.64971402e+03  9.12899527e+03
  2.54810092e+04  7.62189897e+04]
E1 = -727.844202157895  E_coul = 201.0971621185639
cycle= 1 E= -526.747040039331  delta_E= -0.383  |g|= 0.187  |ddm|= 0.313
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.558967
diis-c [-0.31244367  1.        ]
  HOMO = -0.590613270220172  LUMO = 0.893581474644616
  mo_energy =
[-1.18641031e+02 -1.23448727e+01 -9.59611338e+00 -9.59611338e+00
 -9.59611338e+00 -1.27935595e+00 -5.90613270e-01 -5.90613270e-01
 -5.90613270e-01  8.93581475e-01  9.99943906e-01  9.99943906e-01
  9.99943906e-01  7.05997113e+00  7.05997113e+00  7.05997113e+00
  8.83282819e+00  3.29585569e+01  3.29585569e+01  3.29585569e+01
  4.19995292e+01  1.28651633e+02  1.28651633e+02  1.28651633e+02
  1.64939218e+02  4.83132736e+02  4.83132736e+02  4.83132736e+02
  6.61013235e+02  1.33485472e+03  1.33485472e+03  1.33485472e+03
  2.72793495e+03  3.02887973e+03  3.02887973e+03  3.02887973e+03
  6.64916917e+03  6.64916917e+03  6.64916917e+03  9.12837565e+03
  2.54802949e+04  7.62181849e+04]
E1 = -728.4198737051387  E_coul = 201.67210727027157
cycle= 2 E= -526.747766434867  delta_E= -0.000726  |g|= 0.0379  |ddm|= 0.0524
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766899
diis-c [-0.0036131   0.07893588  0.92106412]
  HOMO = -0.581466167810625  LUMO = 0.901002527447781
  mo_energy =
[-1.18572782e+02 -1.23065721e+01 -9.55614326e+00 -9.55614326e+00
 -9.55614326e+00 -1.26838292e+00 -5.81466168e-01 -5.81466168e-01
 -5.81466168e-01  9.01002527e-01  1.00660949e+00  1.00660949e+00
  1.00660949e+00  7.08350021e+00  7.08350021e+00  7.08350021e+00
  8.85725694e+00  3.29988917e+01  3.29988917e+01  3.29988917e+01
  4.20396116e+01  1.28707991e+02  1.28707991e+02  1.28707991e+02
  1.64996453e+02  4.83200173e+02  4.83200173e+02  4.83200173e+02
  6.61082770e+02  1.33492623e+03  1.33492623e+03  1.33492623e+03
  2.72800971e+03  3.02895350e+03  3.02895350e+03  3.02895350e+03
  6.64924470e+03  6.64924470e+03  6.64924470e+03  9.12845197e+03
  2.54803718e+04  7.62182622e+04]
E1 = -728.2680734270324  E_coul = 201.52024753949976
cycle= 3 E= -526.747825887533  delta_E= -5.95e-05  |g|= 0.00651  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0137486
diis-c [-8.51855524e-07 -1.30199991e-03  1.47466179e-01  8.53835821e-01]
  HOMO = -0.583012117209915  LUMO = 0.899851535033046
  mo_energy =
[-1.18583088e+02 -1.23125708e+01 -9.56250271e+00 -9.56250271e+00
 -9.56250271e+00 -1.27011539e+00 -5.83012117e-01 -5.83012117e-01
 -5.83012117e-01  8.99851535e-01  1.00550969e+00  1.00550969e+00
  1.00550969e+00  7.07965845e+00  7.07965845e+00  7.07965845e+00
  8.85335825e+00  3.29925137e+01  3.29925137e+01  3.29925137e+01
  4.20333327e+01  1.28699349e+02  1.28699349e+02  1.28699349e+02
  1.64987717e+02  4.83189985e+02  4.83189985e+02  4.83189985e+02
  6.61072250e+02  1.33491543e+03  1.33491543e+03  1.33491543e+03
  2.72799827e+03  3.02894230e+03  3.02894230e+03  3.02894230e+03
  6.64923310e+03  6.64923310e+03  6.64923310e+03  9.12844015e+03
  2.54803598e+04  7.62182500e+04]
E1 = -728.291620414698  E_coul = 201.54379247321984
cycle= 4 E= -526.747827941478  delta_E= -2.05e-06  |g|= 0.000113  |ddm|= 0.00227
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000125874
diis-c [-5.79457626e-09  9.35064380e-05 -1.31230552e-02 -8.03642506e-02
  1.09339380e+00]
  HOMO = -0.582993695367985  LUMO = 0.899886548267499
  mo_energy =
[-1.18583040e+02 -1.23125008e+01 -9.56244750e+00 -9.56244750e+00
 -9.56244750e+00 -1.27006993e+00 -5.82993695e-01 -5.82993695e-01
 -5.82993695e-01  8.99886548e-01  1.00552595e+00  1.00552595e+00
  1.00552595e+00  7.07970195e+00  7.07970195e+00  7.07970195e+00
  8.85341755e+00  3.29925670e+01  3.29925670e+01  3.29925670e+01
  4.20333943e+01  1.28699403e+02  1.28699403e+02  1.28699403e+02
  1.64987773e+02  4.83190034e+02  4.83190034e+02  4.83190034e+02
  6.61072291e+02  1.33491547e+03  1.33491547e+03  1.33491547e+03
  2.72799829e+03  3.02894233e+03  3.02894233e+03  3.02894233e+03
  6.64923311e+03  6.64923311e+03  6.64923311e+03  9.12844016e+03
  2.54803598e+04  7.62182500e+04]
E1 = -728.2913768790561  E_coul = 201.54354893510947
cycle= 5 E= -526.747827943947  delta_E= -2.47e-09  |g|= 2.17e-05  |ddm|= 0.000189
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.00954e-05
diis-c [-1.06739731e-10  1.35812310e-05 -1.77894192e-03 -1.30344147e-02
  2.80685406e-02  9.86731235e-01]
  HOMO = -0.58300186934947  LUMO = 0.899882780398277
  mo_energy =
[-1.18583073e+02 -1.23125252e+01 -9.56247391e+00 -9.56247391e+00
 -9.56247391e+00 -1.27007632e+00 -5.83001869e-01 -5.83001869e-01
 -5.83001869e-01  8.99882780e-01  1.00552061e+00  1.00552061e+00
  1.00552061e+00  7.07968416e+00  7.07968416e+00  7.07968416e+00
  8.85340065e+00  3.29925414e+01  3.29925414e+01  3.29925414e+01
  4.20333693e+01  1.28699373e+02  1.28699373e+02  1.28699373e+02
  1.64987743e+02  4.83190001e+02  4.83190001e+02  4.83190001e+02
  6.61072258e+02  1.33491544e+03  1.33491544e+03  1.33491544e+03
  2.72799826e+03  3.02894229e+03  3.02894229e+03  3.02894229e+03
  6.64923308e+03  6.64923308e+03  6.64923308e+03  9.12844012e+03
  2.54803598e+04  7.62182500e+04]
E1 = -728.2914636519511  E_coul = 201.5436357079352
cycle= 6 E= -526.747827944016  delta_E= -6.92e-11  |g|= 1.86e-06  |ddm|= 2.13e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2914636519511  E_coul = 201.5436357079352
  HOMO = -0.583001692139354  LUMO = 0.899883254916196
  mo_energy =
[-1.18583072e+02 -1.23125244e+01 -9.56247313e+00 -9.56247313e+00
 -9.56247313e+00 -1.27007572e+00 -5.83001692e-01 -5.83001692e-01
 -5.83001692e-01  8.99883255e-01  1.00552079e+00  1.00552079e+00
  1.00552079e+00  7.07968469e+00  7.07968469e+00  7.07968469e+00
  8.85340133e+00  3.29925422e+01  3.29925422e+01  3.29925422e+01
  4.20333701e+01  1.28699374e+02  1.28699374e+02  1.28699374e+02
  1.64987744e+02  4.83190002e+02  4.83190002e+02  4.83190002e+02
  6.61072259e+02  1.33491544e+03  1.33491544e+03  1.33491544e+03
  2.72799826e+03  3.02894230e+03  3.02894230e+03  3.02894230e+03
  6.64923308e+03  6.64923308e+03  6.64923308e+03  9.12844012e+03
  2.54803598e+04  7.62182500e+04]
E1 = -728.2914599649238  E_coul = 201.54363202090607
Extra cycle  E= -526.747827944018  delta_E= -1.82e-12  |g|= 4e-07  |ddm|= 3.19e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114269.52813170747
E1 = -728.2914599649238  E_coul = 201.54363202090607
init E= -526.747827944018
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583001778465314  LUMO = 0.899883257032411
  mo_energy =
[-1.18583072e+02 -1.23125247e+01 -9.56247343e+00 -9.56247343e+00
 -9.56247343e+00 -1.27007574e+00 -5.83001778e-01 -5.83001778e-01
 -5.83001778e-01  8.99883257e-01  1.00552074e+00  1.00552074e+00
  1.00552074e+00  7.07968450e+00  7.07968450e+00  7.07968450e+00
  8.85340118e+00  3.29925419e+01  3.29925419e+01  3.29925419e+01
  4.20333698e+01  1.28699374e+02  1.28699374e+02  1.28699374e+02
  1.64987743e+02  4.83190002e+02  4.83190002e+02  4.83190002e+02
  6.61072258e+02  1.33491544e+03  1.33491544e+03  1.33491544e+03
  2.72799826e+03  3.02894230e+03  3.02894230e+03  3.02894230e+03
  6.64923308e+03  6.64923308e+03  6.64923308e+03  9.12844012e+03
  2.54803598e+04  7.62182500e+04]
E1 = -728.2914608609375  E_coul = 201.5436329169198
cycle= 1 E= -526.747827944018  delta_E=    0  |g|= 9.66e-08  |ddm|= 5.84e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2914608609375  E_coul = 201.5436329169198
  HOMO = -0.583001764578571  LUMO = 0.899883282249023
  mo_energy =
[-1.18583072e+02 -1.23125246e+01 -9.56247336e+00 -9.56247336e+00
 -9.56247336e+00 -1.27007570e+00 -5.83001765e-01 -5.83001765e-01
 -5.83001765e-01  8.99883282e-01  1.00552075e+00  1.00552075e+00
  1.00552075e+00  7.07968454e+00  7.07968454e+00  7.07968454e+00
  8.85340123e+00  3.29925420e+01  3.29925420e+01  3.29925420e+01
  4.20333699e+01  1.28699374e+02  1.28699374e+02  1.28699374e+02
  1.64987743e+02  4.83190002e+02  4.83190002e+02  4.83190002e+02
  6.61072258e+02  1.33491544e+03  1.33491544e+03  1.33491544e+03
  2.72799826e+03  3.02894230e+03  3.02894230e+03  3.02894230e+03
  6.64923308e+03  6.64923308e+03  6.64923308e+03  9.12844012e+03
  2.54803598e+04  7.62182500e+04]
E1 = -728.291460578551  E_coul = 201.54363263453348
Extra cycle  E= -526.747827944017  delta_E= 2.27e-13  |g|= 2.19e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61826617e+04 7.61750941e+03 3.61735706e+03 1.59756838e+03
 3.82599023e+02 1.12845924e+02 3.93330999e+01 1.44452404e+01
 6.54075179e+00 6.47902728e-01 2.76969180e+00 2.27623093e-01
 1.36278516e+03 6.64726407e+02 3.00871120e+02 3.13963927e+02
 6.16748669e+01 7.29739145e+00 2.02915705e+01 7.68240888e-01
 2.71686222e+00 2.22249198e-01]
grad_E = [-1.54547588e-06  3.62402734e-06 -1.38330997e-06  8.08097304e-05
 -2.54036626e-04 -4.83451367e-04 -7.94830884e-04  1.46251986e-04
  5.00243357e-04  5.02211487e-03  7.48495450e-04 -1.32650529e-02
 -5.08514920e-07  4.99341810e-06  2.35399600e-05  2.02912245e-05
  2.01906060e-06  7.24237351e-03 -8.04834586e-04 -1.18940528e-02
 -1.39410692e-02  4.02088154e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:13 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6630243        1
[INPUT] 0    0    [1    /1   ]  7617.50647359        1
[INPUT] 0    0    [1    /1   ]  3617.35844702        1
[INPUT] 0    0    [1    /1   ]  1597.50701573        1
[INPUT] 0    0    [1    /1   ]  382.592703505        1
[INPUT] 0    0    [1    /1   ]  113.863197139        1
[INPUT] 0    0    [1    /1   ]  40.1655827896        1
[INPUT] 0    0    [1    /1   ]  15.7938932573        1
[INPUT] 0    0    [1    /1   ]  6.41790736622        1
[INPUT] 0    0    [1    /1   ]  0.66969384226        1
[INPUT] 0    0    [1    /1   ]  2.70473677797        1
[INPUT] 0    0    [1    /1   ]  0.235053594981       1
[INPUT] 1    0    [1    /1   ]  1362.78561192        1
[INPUT] 1    0    [1    /1   ]  664.721997895        1
[INPUT] 1    0    [1    /1   ]  300.850340882        1
[INPUT] 1    0    [1    /1   ]  313.946013052        1
[INPUT] 1    0    [1    /1   ]  61.6833729106        1
[INPUT] 1    0    [1    /1   ]  7.26118196786        1
[INPUT] 1    0    [1    /1   ]  20.3221921635        1
[INPUT] 1    0    [1    /1   ]  0.76603586794        1
[INPUT] 1    0    [1    /1   ]  2.68965636964        1
[INPUT] 1    0    [1    /1   ]  0.221934338175       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.663024309175, 1.0]], [0, [7617.5064735887445, 1.0]], [0, [3617.3584470217047, 1.0]], [0, [1597.5070157252771, 1.0]], [0, [382.59270350528715, 1.0]], [0, [113.86319713919622, 1.0]], [0, [40.16558278962898, 1.0]], [0, [15.793893257307545, 1.0]], [0, [6.41790736621608, 1.0]], [0, [0.6696938422600931, 1.0]], [0, [2.7047367779719793, 1.0]], [0, [0.23505359498120115, 1.0]], [1, [1362.7856119168569, 1.0]], [1, [664.7219978947675, 1.0]], [1, [300.8503408822637, 1.0]], [1, [313.94601305212046, 1.0]], [1, [61.68337291060038, 1.0]], [1, [7.261181967858357, 1.0]], [1, [20.322192163533227, 1.0]], [1, [0.7660358679403253, 1.0]], [1, [2.6896563696415803, 1.0]], [1, [0.22193433817509775, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66302431]
bas 1, expnt(s) = [7617.50647359]
bas 2, expnt(s) = [3617.35844702]
bas 3, expnt(s) = [1597.50701573]
bas 4, expnt(s) = [382.59270351]
bas 5, expnt(s) = [113.86319714]
bas 6, expnt(s) = [40.16558279]
bas 7, expnt(s) = [15.79389326]
bas 8, expnt(s) = [6.41790737]
bas 9, expnt(s) = [0.66969384]
bas 10, expnt(s) = [2.70473678]
bas 11, expnt(s) = [0.23505359]
bas 12, expnt(s) = [1362.78561192]
bas 13, expnt(s) = [664.72199789]
bas 14, expnt(s) = [300.85034088]
bas 15, expnt(s) = [313.94601305]
bas 16, expnt(s) = [61.68337291]
bas 17, expnt(s) = [7.26118197]
bas 18, expnt(s) = [20.32219216]
bas 19, expnt(s) = [0.76603587]
bas 20, expnt(s) = [2.68965637]
bas 21, expnt(s) = [0.22193434]
CPU time:       293.84
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826630e+04 5.20026394e+03 7.61750647e+03 2.06003523e+03
 3.61735845e+03 1.17844328e+03 1.59750702e+03 6.38406213e+02
 3.82592704e+02 2.18558417e+02 1.13863197e+02 8.80648409e+01
 4.01655828e+01 4.03093299e+01 1.57938933e+01 2.00162134e+01
 6.41790737e+00 1.01873237e+01 6.69693842e-01 1.87034728e+00
 2.70473678e+00 5.32854673e+00 2.35053595e-01 8.52884453e-01
 1.36278561e+03 2.41556549e+04 6.64721998e+02 9.84655830e+03
 3.00850341e+02 3.65529580e+03 3.13946013e+02 3.85525499e+03
 6.16833729e+01 5.04306463e+02 7.26118197e+00 3.47731107e+01
 2.03221922e+01 1.25877348e+02 7.66035868e-01 2.09071952e+00
 2.68965637e+00 1.00485961e+01 2.21934338e-01 4.44390760e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993950031836555
cond(S) = 114239.27659050515
E1 = -729.5404600751945  E_coul = 203.17523388523546
init E= -526.365226189959
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555809283024884  LUMO = 0.965706762134211
  mo_energy =
[-1.18332027e+02 -1.22069315e+01 -9.44701053e+00 -9.44701053e+00
 -9.44701053e+00 -1.24020605e+00 -5.55809283e-01 -5.55809283e-01
 -5.55809283e-01  9.65706762e-01  1.02066910e+00  1.02066910e+00
  1.02066910e+00  7.08327758e+00  7.08327758e+00  7.08327758e+00
  8.94469224e+00  3.29413655e+01  3.29413655e+01  3.29413655e+01
  4.36025196e+01  1.28749465e+02  1.28749465e+02  1.28749465e+02
  1.71247269e+02  4.83366830e+02  4.83366830e+02  4.83366830e+02
  6.71561971e+02  1.33512568e+03  1.33512568e+03  1.33512568e+03
  2.73938830e+03  3.02916924e+03  3.02916924e+03  3.02916924e+03
  6.64954067e+03  6.64954067e+03  6.64954067e+03  9.13935797e+03
  2.54908325e+04  7.62281365e+04]
E1 = -727.8492833905486  E_coul = 201.1015678113956
cycle= 1 E= -526.747715579153  delta_E= -0.382  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.560867
diis-c [-0.3145719  1.       ]
  HOMO = -0.590482920153823  LUMO = 0.93957395684964
  mo_energy =
[-1.18640940e+02 -1.23446718e+01 -9.59576400e+00 -9.59576400e+00
 -9.59576400e+00 -1.27922106e+00 -5.90482920e-01 -5.90482920e-01
 -5.90482920e-01  9.39573957e-01  9.96945335e-01  9.96945335e-01
  9.96945335e-01  6.99444043e+00  6.99444043e+00  6.99444043e+00
  8.85576226e+00  3.27867928e+01  3.27867928e+01  3.27867928e+01
  4.34520295e+01  1.28520086e+02  1.28520086e+02  1.28520086e+02
  1.71015996e+02  4.83059017e+02  4.83059017e+02  4.83059017e+02
  6.71216326e+02  1.33476109e+03  1.33476109e+03  1.33476109e+03
  2.73889075e+03  3.02873861e+03  3.02873861e+03  3.02873861e+03
  6.64899649e+03  6.64899649e+03  6.64899649e+03  9.13873915e+03
  2.54901189e+04  7.62273325e+04]
E1 = -728.4244596664213  E_coul = 201.6760199181401
cycle= 2 E= -526.748439748281  delta_E= -0.000724  |g|= 0.0379  |ddm|= 0.0523
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0767901
diis-c [-0.00365881  0.07820528  0.92179472]
  HOMO = -0.581344837181015  LUMO = 0.947235125454848
  mo_energy =
[-1.18572667e+02 -1.23063751e+01 -9.55579211e+00 -9.55579211e+00
 -9.55579211e+00 -1.26826379e+00 -5.81344837e-01 -5.81344837e-01
 -5.81344837e-01  9.47235125e-01  1.00357373e+00  1.00357373e+00
  1.00357373e+00  7.01784071e+00  7.01784071e+00  7.01784071e+00
  8.88016983e+00  3.28271156e+01  3.28271156e+01  3.28271156e+01
  4.34928010e+01  1.28576473e+02  1.28576473e+02  1.28576473e+02
  1.71073591e+02  4.83126480e+02  4.83126480e+02  4.83126480e+02
  6.71285902e+02  1.33483263e+03  1.33483263e+03  1.33483263e+03
  2.73896554e+03  3.02881242e+03  3.02881242e+03  3.02881242e+03
  6.64907206e+03  6.64907206e+03  6.64907206e+03  9.13881551e+03
  2.54901959e+04  7.62274097e+04]
E1 = -728.2725308990604  E_coul = 201.52403175463158
cycle= 3 E= -526.748499144429  delta_E= -5.94e-05  |g|= 0.00656  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0138338
diis-c [-8.53052301e-07 -1.30771981e-03  1.48117290e-01  8.53190430e-01]
  HOMO = -0.582896897841561  LUMO = 0.946035684104182
  mo_energy =
[-1.18583034e+02 -1.23124084e+01 -9.56218738e+00 -9.56218738e+00
 -9.56218738e+00 -1.27000810e+00 -5.82896898e-01 -5.82896898e-01
 -5.82896898e-01  9.46035684e-01  1.00247403e+00  1.00247403e+00
  1.00247403e+00  7.01399780e+00  7.01399780e+00  7.01399780e+00
  8.87625053e+00  3.28207036e+01  3.28207036e+01  3.28207036e+01
  4.34863869e+01  1.28567779e+02  1.28567779e+02  1.28567779e+02
  1.71064753e+02  4.83116232e+02  4.83116232e+02  4.83116232e+02
  6.71275317e+02  1.33482177e+03  1.33482177e+03  1.33482177e+03
  2.73895403e+03  3.02880115e+03  3.02880115e+03  3.02880115e+03
  6.64906039e+03  6.64906039e+03  6.64906039e+03  9.13880362e+03
  2.54901838e+04  7.62273975e+04]
E1 = -728.2962580634529  E_coul = 201.54775683959488
cycle= 4 E= -526.748501223858  delta_E= -2.08e-06  |g|= 0.00011  |ddm|= 0.00229
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119654
diis-c [-5.62627965e-09  8.86117723e-05 -1.25226655e-02 -7.59538542e-02
  1.08838791e+00]
  HOMO = -0.582876995885794  LUMO = 0.946071794886269
  mo_energy =
[-1.18582981e+02 -1.23123350e+01 -9.56212823e+00 -9.56212823e+00
 -9.56212823e+00 -1.26996227e+00 -5.82876996e-01 -5.82876996e-01
 -5.82876996e-01  9.46071795e-01  1.00249114e+00  1.00249114e+00
  1.00249114e+00  7.01404384e+00  7.01404384e+00  7.01404384e+00
  8.87631185e+00  3.28207607e+01  3.28207607e+01  3.28207607e+01
  4.34864522e+01  1.28567838e+02  1.28567838e+02  1.28567838e+02
  1.71064813e+02  4.83116285e+02  4.83116285e+02  4.83116285e+02
  6.71275363e+02  1.33482181e+03  1.33482181e+03  1.33482181e+03
  2.73895406e+03  3.02880119e+03  3.02880119e+03  3.02880119e+03
  6.64906041e+03  6.64906041e+03  6.64906041e+03  9.13880363e+03
  2.54901838e+04  7.62273975e+04]
E1 = -728.2960064662693  E_coul = 201.547505240179
cycle= 5 E= -526.74850122609  delta_E= -2.23e-09  |g|= 2.15e-05  |ddm|= 0.00018
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.01204e-05
diis-c [-1.00884476e-10  1.34163238e-05 -1.77799755e-03 -1.29562726e-02
  3.11375144e-02  9.83583339e-01]
  HOMO = -0.582885009428233  LUMO = 0.946067906552456
  mo_energy =
[-1.18583013e+02 -1.23123592e+01 -9.56215435e+00 -9.56215435e+00
 -9.56215435e+00 -1.26996860e+00 -5.82885009e-01 -5.82885009e-01
 -5.82885009e-01  9.46067907e-01  1.00248592e+00  1.00248592e+00
  1.00248592e+00  7.01402637e+00  7.01402637e+00  7.01402637e+00
  8.87629517e+00  3.28207354e+01  3.28207354e+01  3.28207354e+01
  4.34864273e+01  1.28567808e+02  1.28567808e+02  1.28567808e+02
  1.71064783e+02  4.83116253e+02  4.83116253e+02  4.83116253e+02
  6.71275330e+02  1.33482178e+03  1.33482178e+03  1.33482178e+03
  2.73895402e+03  3.02880115e+03  3.02880115e+03  3.02880115e+03
  6.64906037e+03  6.64906037e+03  6.64906037e+03  9.13880360e+03
  2.54901838e+04  7.62273975e+04]
E1 = -728.2960931047846  E_coul = 201.54759187862734
cycle= 6 E= -526.748501226157  delta_E= -6.7e-11  |g|= 1.84e-06  |ddm|= 2.04e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2960931047846  E_coul = 201.54759187862734
  HOMO = -0.582884865595249  LUMO = 0.946068367469402
  mo_energy =
[-1.18583012e+02 -1.23123585e+01 -9.56215372e+00 -9.56215372e+00
 -9.56215372e+00 -1.26996804e+00 -5.82884866e-01 -5.82884866e-01
 -5.82884866e-01  9.46068367e-01  1.00248608e+00  1.00248608e+00
  1.00248608e+00  7.01402680e+00  7.01402680e+00  7.01402680e+00
  8.87629577e+00  3.28207360e+01  3.28207360e+01  3.28207360e+01
  4.34864280e+01  1.28567809e+02  1.28567809e+02  1.28567809e+02
  1.71064784e+02  4.83116254e+02  4.83116254e+02  4.83116254e+02
  6.71275331e+02  1.33482178e+03  1.33482178e+03  1.33482178e+03
  2.73895402e+03  3.02880115e+03  3.02880115e+03  3.02880115e+03
  6.64906037e+03  6.64906037e+03  6.64906037e+03  9.13880360e+03
  2.54901838e+04  7.62273975e+04]
E1 = -728.296090003787  E_coul = 201.54758877762973
Extra cycle  E= -526.748501226157  delta_E=    0  |g|= 3.88e-07  |ddm|= 3.16e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826630e+04 7.61750647e+03 3.61735845e+03 1.59750702e+03
 3.82592704e+02 1.13863197e+02 4.01655828e+01 1.57938933e+01
 6.41790737e+00 6.69693842e-01 2.70473678e+00 2.35053595e-01
 1.36278561e+03 6.64721998e+02 3.00850341e+02 3.13946013e+02
 6.16833729e+01 7.26118197e+00 2.03221922e+01 7.66035868e-01
 2.68965637e+00 2.21934338e-01]
E = -526.7485012261573
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:13 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6630243        1
[INPUT] 0    0    [1    /1   ]  7617.50647359        1
[INPUT] 0    0    [1    /1   ]  3617.35844702        1
[INPUT] 0    0    [1    /1   ]  1597.50701573        1
[INPUT] 0    0    [1    /1   ]  382.592703505        1
[INPUT] 0    0    [1    /1   ]  113.863197139        1
[INPUT] 0    0    [1    /1   ]  40.1655827896        1
[INPUT] 0    0    [1    /1   ]  15.7938932573        1
[INPUT] 0    0    [1    /1   ]  6.41790736622        1
[INPUT] 0    0    [1    /1   ]  0.66969384226        1
[INPUT] 0    0    [1    /1   ]  2.70473677797        1
[INPUT] 0    0    [1    /1   ]  0.235053594981       1
[INPUT] 1    0    [1    /1   ]  1362.78561192        1
[INPUT] 1    0    [1    /1   ]  664.721997895        1
[INPUT] 1    0    [1    /1   ]  300.850340882        1
[INPUT] 1    0    [1    /1   ]  313.946013052        1
[INPUT] 1    0    [1    /1   ]  61.6833729106        1
[INPUT] 1    0    [1    /1   ]  7.26118196786        1
[INPUT] 1    0    [1    /1   ]  20.3221921635        1
[INPUT] 1    0    [1    /1   ]  0.76603586794        1
[INPUT] 1    0    [1    /1   ]  2.68965636964        1
[INPUT] 1    0    [1    /1   ]  0.221934338175       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.663024309175, 1.0]], [0, [7617.5064735887445, 1.0]], [0, [3617.3584470217047, 1.0]], [0, [1597.5070157252771, 1.0]], [0, [382.59270350528715, 1.0]], [0, [113.86319713919622, 1.0]], [0, [40.16558278962898, 1.0]], [0, [15.793893257307545, 1.0]], [0, [6.41790736621608, 1.0]], [0, [0.6696938422600931, 1.0]], [0, [2.7047367779719793, 1.0]], [0, [0.23505359498120115, 1.0]], [1, [1362.7856119168569, 1.0]], [1, [664.7219978947675, 1.0]], [1, [300.8503408822637, 1.0]], [1, [313.94601305212046, 1.0]], [1, [61.68337291060038, 1.0]], [1, [7.261181967858357, 1.0]], [1, [20.322192163533227, 1.0]], [1, [0.7660358679403253, 1.0]], [1, [2.6896563696415803, 1.0]], [1, [0.22193433817509775, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66302431]
bas 1, expnt(s) = [7617.50647359]
bas 2, expnt(s) = [3617.35844702]
bas 3, expnt(s) = [1597.50701573]
bas 4, expnt(s) = [382.59270351]
bas 5, expnt(s) = [113.86319714]
bas 6, expnt(s) = [40.16558279]
bas 7, expnt(s) = [15.79389326]
bas 8, expnt(s) = [6.41790737]
bas 9, expnt(s) = [0.66969384]
bas 10, expnt(s) = [2.70473678]
bas 11, expnt(s) = [0.23505359]
bas 12, expnt(s) = [1362.78561192]
bas 13, expnt(s) = [664.72199789]
bas 14, expnt(s) = [300.85034088]
bas 15, expnt(s) = [313.94601305]
bas 16, expnt(s) = [61.68337291]
bas 17, expnt(s) = [7.26118197]
bas 18, expnt(s) = [20.32219216]
bas 19, expnt(s) = [0.76603587]
bas 20, expnt(s) = [2.68965637]
bas 21, expnt(s) = [0.22193434]
CPU time:       294.28
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826630e+04 5.20026394e+03 7.61750647e+03 2.06003523e+03
 3.61735845e+03 1.17844328e+03 1.59750702e+03 6.38406213e+02
 3.82592704e+02 2.18558417e+02 1.13863197e+02 8.80648409e+01
 4.01655828e+01 4.03093299e+01 1.57938933e+01 2.00162134e+01
 6.41790737e+00 1.01873237e+01 6.69693842e-01 1.87034728e+00
 2.70473678e+00 5.32854673e+00 2.35053595e-01 8.52884453e-01
 1.36278561e+03 2.41556549e+04 6.64721998e+02 9.84655830e+03
 3.00850341e+02 3.65529580e+03 3.13946013e+02 3.85525499e+03
 6.16833729e+01 5.04306463e+02 7.26118197e+00 3.47731107e+01
 2.03221922e+01 1.25877348e+02 7.66035868e-01 2.09071952e+00
 2.68965637e+00 1.00485961e+01 2.21934338e-01 4.44390760e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993950031836555
cond(S) = 114239.27659050515
E1 = -729.5404600751945  E_coul = 203.17523388523546
init E= -526.365226189959
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555809283024884  LUMO = 0.965706762134211
  mo_energy =
[-1.18332027e+02 -1.22069315e+01 -9.44701053e+00 -9.44701053e+00
 -9.44701053e+00 -1.24020605e+00 -5.55809283e-01 -5.55809283e-01
 -5.55809283e-01  9.65706762e-01  1.02066910e+00  1.02066910e+00
  1.02066910e+00  7.08327758e+00  7.08327758e+00  7.08327758e+00
  8.94469224e+00  3.29413655e+01  3.29413655e+01  3.29413655e+01
  4.36025196e+01  1.28749465e+02  1.28749465e+02  1.28749465e+02
  1.71247269e+02  4.83366830e+02  4.83366830e+02  4.83366830e+02
  6.71561971e+02  1.33512568e+03  1.33512568e+03  1.33512568e+03
  2.73938830e+03  3.02916924e+03  3.02916924e+03  3.02916924e+03
  6.64954067e+03  6.64954067e+03  6.64954067e+03  9.13935797e+03
  2.54908325e+04  7.62281365e+04]
E1 = -727.8492833905486  E_coul = 201.1015678113956
cycle= 1 E= -526.747715579153  delta_E= -0.382  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.560867
diis-c [-0.3145719  1.       ]
  HOMO = -0.590482920153823  LUMO = 0.93957395684964
  mo_energy =
[-1.18640940e+02 -1.23446718e+01 -9.59576400e+00 -9.59576400e+00
 -9.59576400e+00 -1.27922106e+00 -5.90482920e-01 -5.90482920e-01
 -5.90482920e-01  9.39573957e-01  9.96945335e-01  9.96945335e-01
  9.96945335e-01  6.99444043e+00  6.99444043e+00  6.99444043e+00
  8.85576226e+00  3.27867928e+01  3.27867928e+01  3.27867928e+01
  4.34520295e+01  1.28520086e+02  1.28520086e+02  1.28520086e+02
  1.71015996e+02  4.83059017e+02  4.83059017e+02  4.83059017e+02
  6.71216326e+02  1.33476109e+03  1.33476109e+03  1.33476109e+03
  2.73889075e+03  3.02873861e+03  3.02873861e+03  3.02873861e+03
  6.64899649e+03  6.64899649e+03  6.64899649e+03  9.13873915e+03
  2.54901189e+04  7.62273325e+04]
E1 = -728.4244596664213  E_coul = 201.6760199181401
cycle= 2 E= -526.748439748281  delta_E= -0.000724  |g|= 0.0379  |ddm|= 0.0523
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0767901
diis-c [-0.00365881  0.07820528  0.92179472]
  HOMO = -0.581344837181015  LUMO = 0.947235125454848
  mo_energy =
[-1.18572667e+02 -1.23063751e+01 -9.55579211e+00 -9.55579211e+00
 -9.55579211e+00 -1.26826379e+00 -5.81344837e-01 -5.81344837e-01
 -5.81344837e-01  9.47235125e-01  1.00357373e+00  1.00357373e+00
  1.00357373e+00  7.01784071e+00  7.01784071e+00  7.01784071e+00
  8.88016983e+00  3.28271156e+01  3.28271156e+01  3.28271156e+01
  4.34928010e+01  1.28576473e+02  1.28576473e+02  1.28576473e+02
  1.71073591e+02  4.83126480e+02  4.83126480e+02  4.83126480e+02
  6.71285902e+02  1.33483263e+03  1.33483263e+03  1.33483263e+03
  2.73896554e+03  3.02881242e+03  3.02881242e+03  3.02881242e+03
  6.64907206e+03  6.64907206e+03  6.64907206e+03  9.13881551e+03
  2.54901959e+04  7.62274097e+04]
E1 = -728.2725308990604  E_coul = 201.52403175463158
cycle= 3 E= -526.748499144429  delta_E= -5.94e-05  |g|= 0.00656  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0138338
diis-c [-8.53052301e-07 -1.30771981e-03  1.48117290e-01  8.53190430e-01]
  HOMO = -0.582896897841561  LUMO = 0.946035684104182
  mo_energy =
[-1.18583034e+02 -1.23124084e+01 -9.56218738e+00 -9.56218738e+00
 -9.56218738e+00 -1.27000810e+00 -5.82896898e-01 -5.82896898e-01
 -5.82896898e-01  9.46035684e-01  1.00247403e+00  1.00247403e+00
  1.00247403e+00  7.01399780e+00  7.01399780e+00  7.01399780e+00
  8.87625053e+00  3.28207036e+01  3.28207036e+01  3.28207036e+01
  4.34863869e+01  1.28567779e+02  1.28567779e+02  1.28567779e+02
  1.71064753e+02  4.83116232e+02  4.83116232e+02  4.83116232e+02
  6.71275317e+02  1.33482177e+03  1.33482177e+03  1.33482177e+03
  2.73895403e+03  3.02880115e+03  3.02880115e+03  3.02880115e+03
  6.64906039e+03  6.64906039e+03  6.64906039e+03  9.13880362e+03
  2.54901838e+04  7.62273975e+04]
E1 = -728.2962580634529  E_coul = 201.54775683959488
cycle= 4 E= -526.748501223858  delta_E= -2.08e-06  |g|= 0.00011  |ddm|= 0.00229
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119654
diis-c [-5.62627965e-09  8.86117723e-05 -1.25226655e-02 -7.59538542e-02
  1.08838791e+00]
  HOMO = -0.582876995885794  LUMO = 0.946071794886269
  mo_energy =
[-1.18582981e+02 -1.23123350e+01 -9.56212823e+00 -9.56212823e+00
 -9.56212823e+00 -1.26996227e+00 -5.82876996e-01 -5.82876996e-01
 -5.82876996e-01  9.46071795e-01  1.00249114e+00  1.00249114e+00
  1.00249114e+00  7.01404384e+00  7.01404384e+00  7.01404384e+00
  8.87631185e+00  3.28207607e+01  3.28207607e+01  3.28207607e+01
  4.34864522e+01  1.28567838e+02  1.28567838e+02  1.28567838e+02
  1.71064813e+02  4.83116285e+02  4.83116285e+02  4.83116285e+02
  6.71275363e+02  1.33482181e+03  1.33482181e+03  1.33482181e+03
  2.73895406e+03  3.02880119e+03  3.02880119e+03  3.02880119e+03
  6.64906041e+03  6.64906041e+03  6.64906041e+03  9.13880363e+03
  2.54901838e+04  7.62273975e+04]
E1 = -728.2960064662693  E_coul = 201.547505240179
cycle= 5 E= -526.74850122609  delta_E= -2.23e-09  |g|= 2.15e-05  |ddm|= 0.00018
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.01204e-05
diis-c [-1.00884476e-10  1.34163238e-05 -1.77799755e-03 -1.29562726e-02
  3.11375144e-02  9.83583339e-01]
  HOMO = -0.582885009428233  LUMO = 0.946067906552456
  mo_energy =
[-1.18583013e+02 -1.23123592e+01 -9.56215435e+00 -9.56215435e+00
 -9.56215435e+00 -1.26996860e+00 -5.82885009e-01 -5.82885009e-01
 -5.82885009e-01  9.46067907e-01  1.00248592e+00  1.00248592e+00
  1.00248592e+00  7.01402637e+00  7.01402637e+00  7.01402637e+00
  8.87629517e+00  3.28207354e+01  3.28207354e+01  3.28207354e+01
  4.34864273e+01  1.28567808e+02  1.28567808e+02  1.28567808e+02
  1.71064783e+02  4.83116253e+02  4.83116253e+02  4.83116253e+02
  6.71275330e+02  1.33482178e+03  1.33482178e+03  1.33482178e+03
  2.73895402e+03  3.02880115e+03  3.02880115e+03  3.02880115e+03
  6.64906037e+03  6.64906037e+03  6.64906037e+03  9.13880360e+03
  2.54901838e+04  7.62273975e+04]
E1 = -728.2960931047846  E_coul = 201.54759187862734
cycle= 6 E= -526.748501226157  delta_E= -6.7e-11  |g|= 1.84e-06  |ddm|= 2.04e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2960931047846  E_coul = 201.54759187862734
  HOMO = -0.582884865595249  LUMO = 0.946068367469402
  mo_energy =
[-1.18583012e+02 -1.23123585e+01 -9.56215372e+00 -9.56215372e+00
 -9.56215372e+00 -1.26996804e+00 -5.82884866e-01 -5.82884866e-01
 -5.82884866e-01  9.46068367e-01  1.00248608e+00  1.00248608e+00
  1.00248608e+00  7.01402680e+00  7.01402680e+00  7.01402680e+00
  8.87629577e+00  3.28207360e+01  3.28207360e+01  3.28207360e+01
  4.34864280e+01  1.28567809e+02  1.28567809e+02  1.28567809e+02
  1.71064784e+02  4.83116254e+02  4.83116254e+02  4.83116254e+02
  6.71275331e+02  1.33482178e+03  1.33482178e+03  1.33482178e+03
  2.73895402e+03  3.02880115e+03  3.02880115e+03  3.02880115e+03
  6.64906037e+03  6.64906037e+03  6.64906037e+03  9.13880360e+03
  2.54901838e+04  7.62273975e+04]
E1 = -728.296090003787  E_coul = 201.54758877762973
Extra cycle  E= -526.748501226157  delta_E=    0  |g|= 3.88e-07  |ddm|= 3.16e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114239.27659050515
E1 = -728.296090003787  E_coul = 201.54758877762973
init E= -526.748501226157
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.582884939297876  LUMO = 0.946068378857698
  mo_energy =
[-1.18583013e+02 -1.23123587e+01 -9.56215397e+00 -9.56215397e+00
 -9.56215397e+00 -1.26996805e+00 -5.82884939e-01 -5.82884939e-01
 -5.82884939e-01  9.46068379e-01  1.00248604e+00  1.00248604e+00
  1.00248604e+00  7.01402664e+00  7.01402664e+00  7.01402664e+00
  8.87629564e+00  3.28207358e+01  3.28207358e+01  3.28207358e+01
  4.34864278e+01  1.28567809e+02  1.28567809e+02  1.28567809e+02
  1.71064784e+02  4.83116254e+02  4.83116254e+02  4.83116254e+02
  6.71275331e+02  1.33482178e+03  1.33482178e+03  1.33482178e+03
  2.73895402e+03  3.02880115e+03  3.02880115e+03  3.02880115e+03
  6.64906037e+03  6.64906037e+03  6.64906037e+03  9.13880360e+03
  2.54901838e+04  7.62273975e+04]
E1 = -728.2960907535504  E_coul = 201.54758952739368
cycle= 1 E= -526.748501226157  delta_E= 5.68e-13  |g|= 9.08e-08  |ddm|= 5.83e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2960907535504  E_coul = 201.54758952739368
  HOMO = -0.582884927890393  LUMO = 0.946068402637673
  mo_energy =
[-1.18583013e+02 -1.23123586e+01 -9.56215391e+00 -9.56215391e+00
 -9.56215391e+00 -1.26996802e+00 -5.82884928e-01 -5.82884928e-01
 -5.82884928e-01  9.46068403e-01  1.00248605e+00  1.00248605e+00
  1.00248605e+00  7.01402668e+00  7.01402668e+00  7.01402668e+00
  8.87629569e+00  3.28207359e+01  3.28207359e+01  3.28207359e+01
  4.34864278e+01  1.28567809e+02  1.28567809e+02  1.28567809e+02
  1.71064784e+02  4.83116254e+02  4.83116254e+02  4.83116254e+02
  6.71275331e+02  1.33482178e+03  1.33482178e+03  1.33482178e+03
  2.73895402e+03  3.02880115e+03  3.02880115e+03  3.02880115e+03
  6.64906037e+03  6.64906037e+03  6.64906037e+03  9.13880360e+03
  2.54901838e+04  7.62273975e+04]
E1 = -728.2960905160108  E_coul = 201.5475892898531
Extra cycle  E= -526.748501226158  delta_E= -1.02e-12  |g|= 2e-08  |ddm|= 1.35e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826630e+04 7.61750647e+03 3.61735845e+03 1.59750702e+03
 3.82592704e+02 1.13863197e+02 4.01655828e+01 1.57938933e+01
 6.41790737e+00 6.69693842e-01 2.70473678e+00 2.35053595e-01
 1.36278561e+03 6.64721998e+02 3.00850341e+02 3.13946013e+02
 6.16833729e+01 7.26118197e+00 2.03221922e+01 7.66035868e-01
 2.68965637e+00 2.21934338e-01]
grad_E = [-1.55238578e-06  3.70588327e-06 -1.32344896e-06  8.38276508e-05
 -3.17656815e-04 -3.27706045e-04 -6.85429845e-04  2.39313655e-04
 -7.47662506e-05  5.31294961e-03  1.04285518e-03 -8.27971650e-03
 -4.94031087e-07  5.19185791e-06  2.47480264e-05  2.13273031e-05
 -1.35433643e-04  5.39823770e-03  2.07406944e-04 -1.21590122e-02
 -1.37986608e-02  4.20673171e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:18 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6640557        1
[INPUT] 0    0    [1    /1   ]  7617.50422237        1
[INPUT] 0    0    [1    /1   ]  3617.35951319        1
[INPUT] 0    0    [1    /1   ]  1597.45995715        1
[INPUT] 0    0    [1    /1   ]  382.585636442        1
[INPUT] 0    0    [1    /1   ]  114.64732482         1
[INPUT] 0    0    [1    /1   ]  40.814148827         1
[INPUT] 0    0    [1    /1   ]  16.8158376531        1
[INPUT] 0    0    [1    /1   ]  6.43220990192        1
[INPUT] 0    0    [1    /1   ]  0.689492794196       1
[INPUT] 0    0    [1    /1   ]  2.69815207519        1
[INPUT] 0    0    [1    /1   ]  0.242539809455       1
[INPUT] 1    0    [1    /1   ]  1362.78595735        1
[INPUT] 1    0    [1    /1   ]  664.718607532        1
[INPUT] 1    0    [1    /1   ]  300.834362207        1
[INPUT] 1    0    [1    /1   ]  313.932237439        1
[INPUT] 1    0    [1    /1   ]  61.6907385038        1
[INPUT] 1    0    [1    /1   ]  7.23274825023        1
[INPUT] 1    0    [1    /1   ]  20.3411011504        1
[INPUT] 1    0    [1    /1   ]  0.76537221237        1
[INPUT] 1    0    [1    /1   ]  2.69062915702        1
[INPUT] 1    0    [1    /1   ]  0.221204983362       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.664055667443, 1.0]], [0, [7617.5042223699875, 1.0]], [0, [3617.359513186695, 1.0]], [0, [1597.4599571538959, 1.0]], [0, [382.5856364423199, 1.0]], [0, [114.64732482009664, 1.0]], [0, [40.814148826962445, 1.0]], [0, [16.815837653102193, 1.0]], [0, [6.432209901922033, 1.0]], [0, [0.6894927941955755, 1.0]], [0, [2.698152075194237, 1.0]], [0, [0.24253980945468165, 1.0]], [1, [1362.7859573549372, 1.0]], [1, [664.7186075323594, 1.0]], [1, [300.83436220676805, 1.0]], [1, [313.9322374391741, 1.0]], [1, [61.690738503825806, 1.0]], [1, [7.232748250229105, 1.0]], [1, [20.34110115037207, 1.0]], [1, [0.7653722123695715, 1.0]], [1, [2.690629157018702, 1.0]], [1, [0.22120498336195674, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66405567]
bas 1, expnt(s) = [7617.50422237]
bas 2, expnt(s) = [3617.35951319]
bas 3, expnt(s) = [1597.45995715]
bas 4, expnt(s) = [382.58563644]
bas 5, expnt(s) = [114.64732482]
bas 6, expnt(s) = [40.81414883]
bas 7, expnt(s) = [16.81583765]
bas 8, expnt(s) = [6.4322099]
bas 9, expnt(s) = [0.68949279]
bas 10, expnt(s) = [2.69815208]
bas 11, expnt(s) = [0.24253981]
bas 12, expnt(s) = [1362.78595735]
bas 13, expnt(s) = [664.71860753]
bas 14, expnt(s) = [300.83436221]
bas 15, expnt(s) = [313.93223744]
bas 16, expnt(s) = [61.6907385]
bas 17, expnt(s) = [7.23274825]
bas 18, expnt(s) = [20.34110115]
bas 19, expnt(s) = [0.76537221]
bas 20, expnt(s) = [2.69062916]
bas 21, expnt(s) = [0.22120498]
CPU time:       299.99
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826641e+04 5.20026409e+03 7.61750422e+03 2.06003478e+03
 3.61735951e+03 1.17844354e+03 1.59745996e+03 6.38392108e+02
 3.82585636e+02 2.18555389e+02 1.14647325e+02 8.85192995e+01
 4.08141488e+01 4.07965166e+01 1.68158377e+01 2.09799237e+01
 6.43220990e+00 1.02043461e+01 6.89492794e-01 1.91166735e+00
 2.69815208e+00 5.31881448e+00 2.42539809e-01 8.73177021e-01
 1.36278596e+03 2.41556626e+04 6.64718608e+02 9.84649552e+03
 3.00834362e+02 3.65505313e+03 3.13932237e+02 3.85504353e+03
 6.16907385e+01 5.04381738e+02 7.23274825e+00 3.46029861e+01
 2.03411012e+01 1.26023770e+02 7.65372212e-01 2.08845564e+00
 2.69062916e+00 1.00531392e+01 2.21204983e-01 4.42565979e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994000340665536
cond(S) = 114382.00129011262
E1 = -729.5402936333887  E_coul = 203.17472594587167
init E= -526.365567687517
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555856724801941  LUMO = 1.01352240728134
  mo_energy =
[-1.18332219e+02 -1.22070095e+01 -9.44704100e+00 -9.44704100e+00
 -9.44704100e+00 -1.24016988e+00 -5.55856725e-01 -5.55856725e-01
 -5.55856725e-01  1.01352241e+00  1.01744542e+00  1.01744542e+00
  1.01744542e+00  7.07142487e+00  7.07142487e+00  7.07142487e+00
  9.12379037e+00  3.28849776e+01  3.28849776e+01  3.28849776e+01
  4.51787322e+01  1.28708774e+02  1.28708774e+02  1.28708774e+02
  1.76487743e+02  4.83353394e+02  4.83353394e+02  4.83353394e+02
  6.79973658e+02  1.33509081e+03  1.33509081e+03  1.33509081e+03
  2.74834312e+03  3.02909476e+03  3.02909476e+03  3.02909476e+03
  6.64943873e+03  6.64943873e+03  6.64943873e+03  9.14782009e+03
  2.54988548e+04  7.62356073e+04]
E1 = -727.8446766231519  E_coul = 201.09655138908448
cycle= 1 E= -526.748125234067  delta_E= -0.383  |g|= 0.187  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.563107
diis-c [-0.31708997  1.        ]
  HOMO = -0.590720102843361  LUMO = 0.986112383161456
  mo_energy =
[-1.18641460e+02 -1.23449827e+01 -9.59605630e+00 -9.59605630e+00
 -9.59605630e+00 -1.27951720e+00 -5.90720103e-01 -5.90720103e-01
 -5.90720103e-01  9.86112383e-01  9.93617136e-01  9.93617136e-01
  9.93617136e-01  6.98242511e+00  6.98242511e+00  6.98242511e+00
  9.03399440e+00  3.27301760e+01  3.27301760e+01  3.27301760e+01
  4.50257321e+01  1.28479046e+02  1.28479046e+02  1.28479046e+02
  1.76254635e+02  4.83045251e+02  4.83045251e+02  4.83045251e+02
  6.79627534e+02  1.33472593e+03  1.33472593e+03  1.33472593e+03
  2.74784551e+03  3.02866392e+03  3.02866392e+03  3.02866392e+03
  6.64889437e+03  6.64889437e+03  6.64889437e+03  9.14720119e+03
  2.54981411e+04  7.62348031e+04]
E1 = -728.4223175639684  E_coul = 201.67346459563805
cycle= 2 E= -526.74885296833  delta_E= -0.000728  |g|= 0.038  |ddm|= 0.0527
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0771821
diis-c [-0.00371421  0.07800073  0.92199927]
  HOMO = -0.581536769413604  LUMO = 0.994068920915948
  mo_energy =
[-1.18572918e+02 -1.23065085e+01 -9.55589544e+00 -9.55589544e+00
 -9.55589544e+00 -1.26851575e+00 -5.81536769e-01 -5.81536769e-01
 -5.81536769e-01  9.94068921e-01  1.00026269e+00  1.00026269e+00
  1.00026269e+00  7.00592199e+00  7.00592199e+00  7.00592199e+00
  9.05870369e+00  3.27706719e+01  3.27706719e+01  3.27706719e+01
  4.50672602e+01  1.28535677e+02  1.28535677e+02  1.28535677e+02
  1.76312721e+02  4.83112982e+02  4.83112982e+02  4.83112982e+02
  6.79697392e+02  1.33479775e+03  1.33479775e+03  1.33479775e+03
  2.74792058e+03  3.02873801e+03  3.02873801e+03  3.02873801e+03
  6.64897023e+03  6.64897023e+03  6.64897023e+03  9.14727784e+03
  2.54982183e+04  7.62348807e+04]
E1 = -728.2695095071645  E_coul = 201.5205966110239
cycle= 3 E= -526.748912896141  delta_E= -5.99e-05  |g|= 0.0066  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0139315
diis-c [-8.36683356e-07 -1.30900318e-03  1.48403764e-01  8.52905239e-01]
  HOMO = -0.583100343069998  LUMO = 0.992811314044939
  mo_energy =
[-1.18583357e+02 -1.23125880e+01 -9.56233766e+00 -9.56233766e+00
 -9.56233766e+00 -1.27028085e+00 -5.83100343e-01 -5.83100343e-01
 -5.83100343e-01  9.92811314e-01  9.99156174e-01  9.99156174e-01
  9.99156174e-01  7.00205180e+00  7.00205180e+00  7.00205180e+00
  9.05472266e+00  3.27642149e+01  3.27642149e+01  3.27642149e+01
  4.50607156e+01  1.28526920e+02  1.28526920e+02  1.28526920e+02
  1.76303784e+02  4.83102662e+02  4.83102662e+02  4.83102662e+02
  6.79686732e+02  1.33478681e+03  1.33478681e+03  1.33478681e+03
  2.74790901e+03  3.02872667e+03  3.02872667e+03  3.02872667e+03
  6.64895848e+03  6.64895848e+03  6.64895848e+03  9.14726588e+03
  2.54982062e+04  7.62348684e+04]
E1 = -728.2934783245628  E_coul = 201.54456331541095
cycle= 4 E= -526.748915009152  delta_E= -2.11e-06  |g|= 0.000104  |ddm|= 0.00233
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00011157
diis-c [-5.34823368e-09  8.19152063e-05 -1.16623750e-02 -7.02452425e-02
  1.08182570e+00]
  HOMO = -0.583078855033658  LUMO = 0.992848009923577
  mo_energy =
[-1.18583298e+02 -1.23125111e+01 -9.56227427e+00 -9.56227427e+00
 -9.56227427e+00 -1.27023523e+00 -5.83078855e-01 -5.83078855e-01
 -5.83078855e-01  9.92848010e-01  9.99174114e-01  9.99174114e-01
  9.99174114e-01  7.00210064e+00  7.00210064e+00  7.00210064e+00
  9.05478619e+00  3.27642761e+01  3.27642761e+01  3.27642761e+01
  4.50607848e+01  1.28526983e+02  1.28526983e+02  1.28526983e+02
  1.76303849e+02  4.83102721e+02  4.83102721e+02  4.83102721e+02
  6.79686784e+02  1.33478686e+03  1.33478686e+03  1.33478686e+03
  2.74790904e+03  3.02872671e+03  3.02872671e+03  3.02872671e+03
  6.64895851e+03  6.64895851e+03  6.64895851e+03  9.14726590e+03
  2.54982062e+04  7.62348684e+04]
E1 = -728.2932183035911  E_coul = 201.5443032925534
cycle= 5 E= -526.748915011038  delta_E= -1.89e-09  |g|= 2.11e-05  |ddm|= 0.000166
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.97846e-05
diis-c [-9.13874718e-11  1.31239700e-05 -1.76050567e-03 -1.27898189e-02
  3.68077051e-02  9.77729496e-01]
  HOMO = -0.583086646244036  LUMO = 0.992843961239416
  mo_energy =
[-1.18583330e+02 -1.23125348e+01 -9.56229989e+00 -9.56229989e+00
 -9.56229989e+00 -1.27024153e+00 -5.83086646e-01 -5.83086646e-01
 -5.83086646e-01  9.92843961e-01  9.99169038e-01  9.99169038e-01
  9.99169038e-01  7.00208355e+00  7.00208355e+00  7.00208355e+00
  9.05476971e+00  3.27642512e+01  3.27642512e+01  3.27642512e+01
  4.50607602e+01  1.28526954e+02  1.28526954e+02  1.28526954e+02
  1.76303819e+02  4.83102689e+02  4.83102689e+02  4.83102689e+02
  6.79686751e+02  1.33478683e+03  1.33478683e+03  1.33478683e+03
  2.74790900e+03  3.02872668e+03  3.02872668e+03  3.02872668e+03
  6.64895848e+03  6.64895848e+03  6.64895848e+03  9.14726586e+03
  2.54982062e+04  7.62348683e+04]
E1 = -728.293304289808  E_coul = 201.54438927870893
cycle= 6 E= -526.748915011099  delta_E= -6.15e-11  |g|= 1.81e-06  |ddm|= 1.9e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.293304289808  E_coul = 201.54438927870893
  HOMO = -0.583086553914518  LUMO = 0.992844390730047
  mo_energy =
[-1.18583329e+02 -1.23125343e+01 -9.56229946e+00 -9.56229946e+00
 -9.56229946e+00 -1.27024103e+00 -5.83086554e-01 -5.83086554e-01
 -5.83086554e-01  9.92844391e-01  9.99169159e-01  9.99169159e-01
  9.99169159e-01  7.00208385e+00  7.00208385e+00  7.00208385e+00
  9.05477017e+00  3.27642517e+01  3.27642517e+01  3.27642517e+01
  4.50607607e+01  1.28526955e+02  1.28526955e+02  1.28526955e+02
  1.76303820e+02  4.83102690e+02  4.83102690e+02  4.83102690e+02
  6.79686752e+02  1.33478683e+03  1.33478683e+03  1.33478683e+03
  2.74790900e+03  3.02872668e+03  3.02872668e+03  3.02872668e+03
  6.64895848e+03  6.64895848e+03  6.64895848e+03  9.14726586e+03
  2.54982062e+04  7.62348683e+04]
E1 = -728.2933020116698  E_coul = 201.54438700056951
Extra cycle  E= -526.7489150111  delta_E= -1.14e-12  |g|= 3.73e-07  |ddm|= 3.11e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826641e+04 7.61750422e+03 3.61735951e+03 1.59745996e+03
 3.82585636e+02 1.14647325e+02 4.08141488e+01 1.68158377e+01
 6.43220990e+00 6.89492794e-01 2.69815208e+00 2.42539809e-01
 1.36278596e+03 6.64718608e+02 3.00834362e+02 3.13932237e+02
 6.16907385e+01 7.23274825e+00 2.03411012e+01 7.65372212e-01
 2.69062916e+00 2.21204983e-01]
E = -526.7489150111003
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:18 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6640557        1
[INPUT] 0    0    [1    /1   ]  7617.50422237        1
[INPUT] 0    0    [1    /1   ]  3617.35951319        1
[INPUT] 0    0    [1    /1   ]  1597.45995715        1
[INPUT] 0    0    [1    /1   ]  382.585636442        1
[INPUT] 0    0    [1    /1   ]  114.64732482         1
[INPUT] 0    0    [1    /1   ]  40.814148827         1
[INPUT] 0    0    [1    /1   ]  16.8158376531        1
[INPUT] 0    0    [1    /1   ]  6.43220990192        1
[INPUT] 0    0    [1    /1   ]  0.689492794196       1
[INPUT] 0    0    [1    /1   ]  2.69815207519        1
[INPUT] 0    0    [1    /1   ]  0.242539809455       1
[INPUT] 1    0    [1    /1   ]  1362.78595735        1
[INPUT] 1    0    [1    /1   ]  664.718607532        1
[INPUT] 1    0    [1    /1   ]  300.834362207        1
[INPUT] 1    0    [1    /1   ]  313.932237439        1
[INPUT] 1    0    [1    /1   ]  61.6907385038        1
[INPUT] 1    0    [1    /1   ]  7.23274825023        1
[INPUT] 1    0    [1    /1   ]  20.3411011504        1
[INPUT] 1    0    [1    /1   ]  0.76537221237        1
[INPUT] 1    0    [1    /1   ]  2.69062915702        1
[INPUT] 1    0    [1    /1   ]  0.221204983362       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.664055667443, 1.0]], [0, [7617.5042223699875, 1.0]], [0, [3617.359513186695, 1.0]], [0, [1597.4599571538959, 1.0]], [0, [382.5856364423199, 1.0]], [0, [114.64732482009664, 1.0]], [0, [40.814148826962445, 1.0]], [0, [16.815837653102193, 1.0]], [0, [6.432209901922033, 1.0]], [0, [0.6894927941955755, 1.0]], [0, [2.698152075194237, 1.0]], [0, [0.24253980945468165, 1.0]], [1, [1362.7859573549372, 1.0]], [1, [664.7186075323594, 1.0]], [1, [300.83436220676805, 1.0]], [1, [313.9322374391741, 1.0]], [1, [61.690738503825806, 1.0]], [1, [7.232748250229105, 1.0]], [1, [20.34110115037207, 1.0]], [1, [0.7653722123695715, 1.0]], [1, [2.690629157018702, 1.0]], [1, [0.22120498336195674, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66405567]
bas 1, expnt(s) = [7617.50422237]
bas 2, expnt(s) = [3617.35951319]
bas 3, expnt(s) = [1597.45995715]
bas 4, expnt(s) = [382.58563644]
bas 5, expnt(s) = [114.64732482]
bas 6, expnt(s) = [40.81414883]
bas 7, expnt(s) = [16.81583765]
bas 8, expnt(s) = [6.4322099]
bas 9, expnt(s) = [0.68949279]
bas 10, expnt(s) = [2.69815208]
bas 11, expnt(s) = [0.24253981]
bas 12, expnt(s) = [1362.78595735]
bas 13, expnt(s) = [664.71860753]
bas 14, expnt(s) = [300.83436221]
bas 15, expnt(s) = [313.93223744]
bas 16, expnt(s) = [61.6907385]
bas 17, expnt(s) = [7.23274825]
bas 18, expnt(s) = [20.34110115]
bas 19, expnt(s) = [0.76537221]
bas 20, expnt(s) = [2.69062916]
bas 21, expnt(s) = [0.22120498]
CPU time:       300.43
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826641e+04 5.20026409e+03 7.61750422e+03 2.06003478e+03
 3.61735951e+03 1.17844354e+03 1.59745996e+03 6.38392108e+02
 3.82585636e+02 2.18555389e+02 1.14647325e+02 8.85192995e+01
 4.08141488e+01 4.07965166e+01 1.68158377e+01 2.09799237e+01
 6.43220990e+00 1.02043461e+01 6.89492794e-01 1.91166735e+00
 2.69815208e+00 5.31881448e+00 2.42539809e-01 8.73177021e-01
 1.36278596e+03 2.41556626e+04 6.64718608e+02 9.84649552e+03
 3.00834362e+02 3.65505313e+03 3.13932237e+02 3.85504353e+03
 6.16907385e+01 5.04381738e+02 7.23274825e+00 3.46029861e+01
 2.03411012e+01 1.26023770e+02 7.65372212e-01 2.08845564e+00
 2.69062916e+00 1.00531392e+01 2.21204983e-01 4.42565979e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994000340665536
cond(S) = 114382.00129011262
E1 = -729.5402936333887  E_coul = 203.17472594587167
init E= -526.365567687517
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555856724801941  LUMO = 1.01352240728134
  mo_energy =
[-1.18332219e+02 -1.22070095e+01 -9.44704100e+00 -9.44704100e+00
 -9.44704100e+00 -1.24016988e+00 -5.55856725e-01 -5.55856725e-01
 -5.55856725e-01  1.01352241e+00  1.01744542e+00  1.01744542e+00
  1.01744542e+00  7.07142487e+00  7.07142487e+00  7.07142487e+00
  9.12379037e+00  3.28849776e+01  3.28849776e+01  3.28849776e+01
  4.51787322e+01  1.28708774e+02  1.28708774e+02  1.28708774e+02
  1.76487743e+02  4.83353394e+02  4.83353394e+02  4.83353394e+02
  6.79973658e+02  1.33509081e+03  1.33509081e+03  1.33509081e+03
  2.74834312e+03  3.02909476e+03  3.02909476e+03  3.02909476e+03
  6.64943873e+03  6.64943873e+03  6.64943873e+03  9.14782009e+03
  2.54988548e+04  7.62356073e+04]
E1 = -727.8446766231519  E_coul = 201.09655138908448
cycle= 1 E= -526.748125234067  delta_E= -0.383  |g|= 0.187  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.563107
diis-c [-0.31708997  1.        ]
  HOMO = -0.590720102843361  LUMO = 0.986112383161456
  mo_energy =
[-1.18641460e+02 -1.23449827e+01 -9.59605630e+00 -9.59605630e+00
 -9.59605630e+00 -1.27951720e+00 -5.90720103e-01 -5.90720103e-01
 -5.90720103e-01  9.86112383e-01  9.93617136e-01  9.93617136e-01
  9.93617136e-01  6.98242511e+00  6.98242511e+00  6.98242511e+00
  9.03399440e+00  3.27301760e+01  3.27301760e+01  3.27301760e+01
  4.50257321e+01  1.28479046e+02  1.28479046e+02  1.28479046e+02
  1.76254635e+02  4.83045251e+02  4.83045251e+02  4.83045251e+02
  6.79627534e+02  1.33472593e+03  1.33472593e+03  1.33472593e+03
  2.74784551e+03  3.02866392e+03  3.02866392e+03  3.02866392e+03
  6.64889437e+03  6.64889437e+03  6.64889437e+03  9.14720119e+03
  2.54981411e+04  7.62348031e+04]
E1 = -728.4223175639684  E_coul = 201.67346459563805
cycle= 2 E= -526.74885296833  delta_E= -0.000728  |g|= 0.038  |ddm|= 0.0527
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0771821
diis-c [-0.00371421  0.07800073  0.92199927]
  HOMO = -0.581536769413604  LUMO = 0.994068920915948
  mo_energy =
[-1.18572918e+02 -1.23065085e+01 -9.55589544e+00 -9.55589544e+00
 -9.55589544e+00 -1.26851575e+00 -5.81536769e-01 -5.81536769e-01
 -5.81536769e-01  9.94068921e-01  1.00026269e+00  1.00026269e+00
  1.00026269e+00  7.00592199e+00  7.00592199e+00  7.00592199e+00
  9.05870369e+00  3.27706719e+01  3.27706719e+01  3.27706719e+01
  4.50672602e+01  1.28535677e+02  1.28535677e+02  1.28535677e+02
  1.76312721e+02  4.83112982e+02  4.83112982e+02  4.83112982e+02
  6.79697392e+02  1.33479775e+03  1.33479775e+03  1.33479775e+03
  2.74792058e+03  3.02873801e+03  3.02873801e+03  3.02873801e+03
  6.64897023e+03  6.64897023e+03  6.64897023e+03  9.14727784e+03
  2.54982183e+04  7.62348807e+04]
E1 = -728.2695095071645  E_coul = 201.5205966110239
cycle= 3 E= -526.748912896141  delta_E= -5.99e-05  |g|= 0.0066  |ddm|= 0.0161
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0139315
diis-c [-8.36683356e-07 -1.30900318e-03  1.48403764e-01  8.52905239e-01]
  HOMO = -0.583100343069998  LUMO = 0.992811314044939
  mo_energy =
[-1.18583357e+02 -1.23125880e+01 -9.56233766e+00 -9.56233766e+00
 -9.56233766e+00 -1.27028085e+00 -5.83100343e-01 -5.83100343e-01
 -5.83100343e-01  9.92811314e-01  9.99156174e-01  9.99156174e-01
  9.99156174e-01  7.00205180e+00  7.00205180e+00  7.00205180e+00
  9.05472266e+00  3.27642149e+01  3.27642149e+01  3.27642149e+01
  4.50607156e+01  1.28526920e+02  1.28526920e+02  1.28526920e+02
  1.76303784e+02  4.83102662e+02  4.83102662e+02  4.83102662e+02
  6.79686732e+02  1.33478681e+03  1.33478681e+03  1.33478681e+03
  2.74790901e+03  3.02872667e+03  3.02872667e+03  3.02872667e+03
  6.64895848e+03  6.64895848e+03  6.64895848e+03  9.14726588e+03
  2.54982062e+04  7.62348684e+04]
E1 = -728.2934783245628  E_coul = 201.54456331541095
cycle= 4 E= -526.748915009152  delta_E= -2.11e-06  |g|= 0.000104  |ddm|= 0.00233
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00011157
diis-c [-5.34823368e-09  8.19152063e-05 -1.16623750e-02 -7.02452425e-02
  1.08182570e+00]
  HOMO = -0.583078855033658  LUMO = 0.992848009923577
  mo_energy =
[-1.18583298e+02 -1.23125111e+01 -9.56227427e+00 -9.56227427e+00
 -9.56227427e+00 -1.27023523e+00 -5.83078855e-01 -5.83078855e-01
 -5.83078855e-01  9.92848010e-01  9.99174114e-01  9.99174114e-01
  9.99174114e-01  7.00210064e+00  7.00210064e+00  7.00210064e+00
  9.05478619e+00  3.27642761e+01  3.27642761e+01  3.27642761e+01
  4.50607848e+01  1.28526983e+02  1.28526983e+02  1.28526983e+02
  1.76303849e+02  4.83102721e+02  4.83102721e+02  4.83102721e+02
  6.79686784e+02  1.33478686e+03  1.33478686e+03  1.33478686e+03
  2.74790904e+03  3.02872671e+03  3.02872671e+03  3.02872671e+03
  6.64895851e+03  6.64895851e+03  6.64895851e+03  9.14726590e+03
  2.54982062e+04  7.62348684e+04]
E1 = -728.2932183035911  E_coul = 201.5443032925534
cycle= 5 E= -526.748915011038  delta_E= -1.89e-09  |g|= 2.11e-05  |ddm|= 0.000166
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.97846e-05
diis-c [-9.13874718e-11  1.31239700e-05 -1.76050567e-03 -1.27898189e-02
  3.68077051e-02  9.77729496e-01]
  HOMO = -0.583086646244036  LUMO = 0.992843961239416
  mo_energy =
[-1.18583330e+02 -1.23125348e+01 -9.56229989e+00 -9.56229989e+00
 -9.56229989e+00 -1.27024153e+00 -5.83086646e-01 -5.83086646e-01
 -5.83086646e-01  9.92843961e-01  9.99169038e-01  9.99169038e-01
  9.99169038e-01  7.00208355e+00  7.00208355e+00  7.00208355e+00
  9.05476971e+00  3.27642512e+01  3.27642512e+01  3.27642512e+01
  4.50607602e+01  1.28526954e+02  1.28526954e+02  1.28526954e+02
  1.76303819e+02  4.83102689e+02  4.83102689e+02  4.83102689e+02
  6.79686751e+02  1.33478683e+03  1.33478683e+03  1.33478683e+03
  2.74790900e+03  3.02872668e+03  3.02872668e+03  3.02872668e+03
  6.64895848e+03  6.64895848e+03  6.64895848e+03  9.14726586e+03
  2.54982062e+04  7.62348683e+04]
E1 = -728.293304289808  E_coul = 201.54438927870893
cycle= 6 E= -526.748915011099  delta_E= -6.15e-11  |g|= 1.81e-06  |ddm|= 1.9e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.293304289808  E_coul = 201.54438927870893
  HOMO = -0.583086553914518  LUMO = 0.992844390730047
  mo_energy =
[-1.18583329e+02 -1.23125343e+01 -9.56229946e+00 -9.56229946e+00
 -9.56229946e+00 -1.27024103e+00 -5.83086554e-01 -5.83086554e-01
 -5.83086554e-01  9.92844391e-01  9.99169159e-01  9.99169159e-01
  9.99169159e-01  7.00208385e+00  7.00208385e+00  7.00208385e+00
  9.05477017e+00  3.27642517e+01  3.27642517e+01  3.27642517e+01
  4.50607607e+01  1.28526955e+02  1.28526955e+02  1.28526955e+02
  1.76303820e+02  4.83102690e+02  4.83102690e+02  4.83102690e+02
  6.79686752e+02  1.33478683e+03  1.33478683e+03  1.33478683e+03
  2.74790900e+03  3.02872668e+03  3.02872668e+03  3.02872668e+03
  6.64895848e+03  6.64895848e+03  6.64895848e+03  9.14726586e+03
  2.54982062e+04  7.62348683e+04]
E1 = -728.2933020116698  E_coul = 201.54438700056951
Extra cycle  E= -526.7489150111  delta_E= -1.14e-12  |g|= 3.73e-07  |ddm|= 3.11e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114382.00129011262
E1 = -728.2933020116698  E_coul = 201.54438700056951
init E= -526.7489150111
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.5830866103822  LUMO = 0.992844415611726
  mo_energy =
[-1.18583330e+02 -1.23125345e+01 -9.56229965e+00 -9.56229965e+00
 -9.56229965e+00 -1.27024102e+00 -5.83086610e-01 -5.83086610e-01
 -5.83086610e-01  9.92844416e-01  9.99169131e-01  9.99169131e-01
  9.99169131e-01  7.00208373e+00  7.00208373e+00  7.00208373e+00
  9.05477009e+00  3.27642515e+01  3.27642515e+01  3.27642515e+01
  4.50607605e+01  1.28526955e+02  1.28526955e+02  1.28526955e+02
  1.76303820e+02  4.83102690e+02  4.83102690e+02  4.83102690e+02
  6.79686752e+02  1.33478683e+03  1.33478683e+03  1.33478683e+03
  2.74790900e+03  3.02872668e+03  3.02872668e+03  3.02872668e+03
  6.64895848e+03  6.64895848e+03  6.64895848e+03  9.14726586e+03
  2.54982062e+04  7.62348683e+04]
E1 = -728.2933025481778  E_coul = 201.5443875370773
cycle= 1 E= -526.748915011101  delta_E= -2.27e-13  |g|= 8.35e-08  |ddm|= 5.84e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2933025481778  E_coul = 201.5443875370773
  HOMO = -0.583086602690775  LUMO = 0.992844436746783
  mo_energy =
[-1.18583330e+02 -1.23125344e+01 -9.56229961e+00 -9.56229961e+00
 -9.56229961e+00 -1.27024099e+00 -5.83086603e-01 -5.83086603e-01
 -5.83086603e-01  9.92844437e-01  9.99169139e-01  9.99169139e-01
  9.99169139e-01  7.00208376e+00  7.00208376e+00  7.00208376e+00
  9.05477012e+00  3.27642516e+01  3.27642516e+01  3.27642516e+01
  4.50607605e+01  1.28526955e+02  1.28526955e+02  1.28526955e+02
  1.76303820e+02  4.83102690e+02  4.83102690e+02  4.83102690e+02
  6.79686752e+02  1.33478683e+03  1.33478683e+03  1.33478683e+03
  2.74790900e+03  3.02872668e+03  3.02872668e+03  3.02872668e+03
  6.64895848e+03  6.64895848e+03  6.64895848e+03  9.14726586e+03
  2.54982062e+04  7.62348683e+04]
E1 = -728.2933023744436  E_coul = 201.54438736334265
Extra cycle  E= -526.748915011101  delta_E= -4.55e-13  |g|= 1.76e-08  |ddm|= 1.3e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826641e+04 7.61750422e+03 3.61735951e+03 1.59745996e+03
 3.82585636e+02 1.14647325e+02 4.08141488e+01 1.68158377e+01
 6.43220990e+00 6.89492794e-01 2.69815208e+00 2.42539809e-01
 1.36278596e+03 6.64718608e+02 3.00834362e+02 3.13932237e+02
 6.16907385e+01 7.23274825e+00 2.03411012e+01 7.65372212e-01
 2.69062916e+00 2.21204983e-01]
grad_E = [-1.55777305e-06  3.77074672e-06 -1.27358690e-06  8.62174193e-05
 -3.67661458e-04 -1.87487073e-04 -6.78702426e-04  3.02043764e-04
 -4.22417450e-04  4.87862492e-03  1.26907769e-03 -1.21998615e-03
 -4.77295254e-07  5.41261662e-06  2.60967790e-05  2.24849523e-05
 -2.94108051e-04  6.47086922e-04  1.63738527e-03 -6.81564539e-03
 -8.88154079e-03  2.37255623e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:23 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6645448        1
[INPUT] 0    0    [1    /1   ]  7617.5031573         1
[INPUT] 0    0    [1    /1   ]  3617.36002082        1
[INPUT] 0    0    [1    /1   ]  1597.43774387        1
[INPUT] 0    0    [1    /1   ]  382.579700397        1
[INPUT] 0    0    [1    /1   ]  115.023133651        1
[INPUT] 0    0    [1    /1   ]  41.1289398869        1
[INPUT] 0    0    [1    /1   ]  17.2830773275        1
[INPUT] 0    0    [1    /1   ]  6.562802195          1
[INPUT] 0    0    [1    /1   ]  0.695974334298       1
[INPUT] 0    0    [1    /1   ]  2.7391967499         1
[INPUT] 0    0    [1    /1   ]  0.245674622291       1
[INPUT] 1    0    [1    /1   ]  1362.78612115        1
[INPUT] 1    0    [1    /1   ]  664.716997279        1
[INPUT] 1    0    [1    /1   ]  300.826771371        1
[INPUT] 1    0    [1    /1   ]  313.925693152        1
[INPUT] 1    0    [1    /1   ]  61.694982665         1
[INPUT] 1    0    [1    /1   ]  7.22121639202        1
[INPUT] 1    0    [1    /1   ]  20.3456621651        1
[INPUT] 1    0    [1    /1   ]  0.765684276545       1
[INPUT] 1    0    [1    /1   ]  2.70607731512        1
[INPUT] 1    0    [1    /1   ]  0.220502216753       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.6645447639, 1.0]], [0, [7617.503157304549, 1.0]], [0, [3617.3600208178827, 1.0]], [0, [1597.4377438651484, 1.0]], [0, [382.5797003968509, 1.0]], [0, [115.02313365063054, 1.0]], [0, [41.128939886907254, 1.0]], [0, [17.283077327510256, 1.0]], [0, [6.562802195004806, 1.0]], [0, [0.695974334297721, 1.0]], [0, [2.7391967499009793, 1.0]], [0, [0.24567462229054615, 1.0]], [1, [1362.786121146634, 1.0]], [1, [664.7169972791373, 1.0]], [1, [300.82677137074484, 1.0]], [1, [313.9256931524631, 1.0]], [1, [61.694982664962225, 1.0]], [1, [7.22121639201984, 1.0]], [1, [20.345662165081716, 1.0]], [1, [0.765684276544842, 1.0]], [1, [2.7060773151180606, 1.0]], [1, [0.22050221675288106, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66454476]
bas 1, expnt(s) = [7617.5031573]
bas 2, expnt(s) = [3617.36002082]
bas 3, expnt(s) = [1597.43774387]
bas 4, expnt(s) = [382.5797004]
bas 5, expnt(s) = [115.02313365]
bas 6, expnt(s) = [41.12893989]
bas 7, expnt(s) = [17.28307733]
bas 8, expnt(s) = [6.5628022]
bas 9, expnt(s) = [0.69597433]
bas 10, expnt(s) = [2.73919675]
bas 11, expnt(s) = [0.24567462]
bas 12, expnt(s) = [1362.78612115]
bas 13, expnt(s) = [664.71699728]
bas 14, expnt(s) = [300.82677137]
bas 15, expnt(s) = [313.92569315]
bas 16, expnt(s) = [61.69498266]
bas 17, expnt(s) = [7.22121639]
bas 18, expnt(s) = [20.34566217]
bas 19, expnt(s) = [0.76568428]
bas 20, expnt(s) = [2.70607732]
bas 21, expnt(s) = [0.22050222]
CPU time:       306.15
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826645e+04 5.20026416e+03 7.61750316e+03 2.06003456e+03
 3.61736002e+03 1.17844366e+03 1.59743774e+03 6.38385451e+02
 3.82579700e+02 2.18552846e+02 1.15023134e+02 8.87368322e+01
 4.11289399e+01 4.10322811e+01 1.72830773e+01 2.14156287e+01
 6.56280220e+00 1.03593382e+01 6.95974334e-01 1.92512947e+00
 2.73919675e+00 5.37938274e+00 2.45674622e-01 8.81627741e-01
 1.36278612e+03 2.41556662e+04 6.64716997e+02 9.84646571e+03
 3.00826771e+02 3.65493785e+03 3.13925693e+02 3.85494308e+03
 6.16949827e+01 5.04425114e+02 7.22121639e+00 3.45340363e+01
 2.03456622e+01 1.26059093e+02 7.65684277e-01 2.08952010e+00
 2.70607732e+00 1.01253407e+01 2.20502217e-01 4.40809142e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99404036906658
cond(S) = 114573.6272362889
E1 = -729.540258644151  E_coul = 203.17471761578847
init E= -526.365541028362
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555891442168823  LUMO = 1.01521532971821
  mo_energy =
[-1.18332254e+02 -1.22070163e+01 -9.44703329e+00 -9.44703329e+00
 -9.44703329e+00 -1.24014831e+00 -5.55891442e-01 -5.55891442e-01
 -5.55891442e-01  1.01521533e+00  1.01521533e+00  1.01521533e+00
  1.03417100e+00  7.09272807e+00  7.09272807e+00  7.09272807e+00
  9.36251468e+00  3.29148062e+01  3.29148062e+01  3.29148062e+01
  4.64406561e+01  1.28735781e+02  1.28735781e+02  1.28735781e+02
  1.79600766e+02  4.83380161e+02  4.83380161e+02  4.83380161e+02
  6.84566285e+02  1.33510279e+03  1.33510279e+03  1.33510279e+03
  2.75313334e+03  3.02908565e+03  3.02908565e+03  3.02908565e+03
  6.64941417e+03  6.64941417e+03  6.64941417e+03  9.15233273e+03
  2.55031321e+04  7.62395909e+04]
E1 = -727.8354268259667  E_coul = 201.08713282196723
cycle= 1 E= -526.748294003999  delta_E= -0.383  |g|= 0.188  |ddm|= 0.323
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.564672
diis-c [-0.31885392  1.        ]
  HOMO = -0.591118530526551  LUMO = 0.991117552930473
  mo_energy =
[-1.18642178e+02 -1.23455879e+01 -9.59666060e+00 -9.59666060e+00
 -9.59666060e+00 -1.27998442e+00 -5.91118531e-01 -5.91118531e-01
 -5.91118531e-01  9.91117553e-01  9.91117553e-01  9.91117553e-01
  1.00587171e+00  7.00300587e+00  7.00300587e+00  7.00300587e+00
  9.27107534e+00  3.27594383e+01  3.27594383e+01  3.27594383e+01
  4.62857132e+01  1.28505381e+02  1.28505381e+02  1.28505381e+02
  1.79366313e+02  4.83071356e+02  4.83071356e+02  4.83071356e+02
  6.84219429e+02  1.33473725e+03  1.33473725e+03  1.33473725e+03
  2.75263521e+03  3.02865419e+03  3.02865419e+03  3.02865419e+03
  6.64886922e+03  6.64886922e+03  6.64886922e+03  9.15171330e+03
  2.55024179e+04  7.62387862e+04]
E1 = -728.4164846904554  E_coul = 201.66745693617304
cycle= 2 E= -526.749027754282  delta_E= -0.000734  |g|= 0.0382  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0775854
diis-c [-0.00375713  0.07811526  0.92188474]
  HOMO = -0.581868386463592  LUMO = 0.997808809171045
  mo_energy =
[-1.18573316e+02 -1.23068840e+01 -9.55626035e+00 -9.55626035e+00
 -9.55626035e+00 -1.26891037e+00 -5.81868386e-01 -5.81868386e-01
 -5.81868386e-01  9.97808809e-01  9.97808809e-01  9.97808809e-01
  1.01401138e+00  7.02670200e+00  7.02670200e+00  7.02670200e+00
  9.29626064e+00  3.28001635e+01  3.28001635e+01  3.28001635e+01
  4.63278116e+01  1.28562297e+02  1.28562297e+02  1.28562297e+02
  1.79424798e+02  4.83139403e+02  4.83139403e+02  4.83139403e+02
  6.84289609e+02  1.33480940e+03  1.33480940e+03  1.33480940e+03
  2.75271061e+03  3.02872861e+03  3.02872861e+03  3.02872861e+03
  6.64894542e+03  6.64894542e+03  6.64894542e+03  9.15179030e+03
  2.55024955e+04  7.62388641e+04]
E1 = -728.2626159843013  E_coul = 201.5135275866456
cycle= 3 E= -526.749088397656  delta_E= -6.06e-05  |g|= 0.00664  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140115
diis-c [-8.21883318e-07 -1.30791386e-03  1.48499908e-01  8.52808006e-01]
  HOMO = -0.583444041212577  LUMO = 0.99669320150449
  mo_energy =
[-1.18583814e+02 -1.23130037e+01 -9.56274352e+00 -9.56274352e+00
 -9.56274352e+00 -1.27069417e+00 -5.83444041e-01 -5.83444041e-01
 -5.83444041e-01  9.96693202e-01  9.96693202e-01  9.96693202e-01
  1.01271831e+00  7.02279684e+00  7.02279684e+00  7.02279684e+00
  9.29220092e+00  3.27936667e+01  3.27936667e+01  3.27936667e+01
  4.63211763e+01  1.28553489e+02  1.28553489e+02  1.28553489e+02
  1.79415793e+02  4.83129025e+02  4.83129025e+02  4.83129025e+02
  6.84278890e+02  1.33479840e+03  1.33479840e+03  1.33479840e+03
  2.75269897e+03  3.02871721e+03  3.02871721e+03  3.02871721e+03
  6.64893361e+03  6.64893361e+03  6.64893361e+03  9.15177827e+03
  2.55024833e+04  7.62388517e+04]
E1 = -728.2867879210705  E_coul = 201.53769738051184
cycle= 4 E= -526.749090540559  delta_E= -2.14e-06  |g|= 0.0001  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000107116
diis-c [-5.16190452e-09  7.81044061e-05 -1.11637788e-02 -6.70495935e-02
  1.07813527e+00]
  HOMO = -0.583421875316412  LUMO = 0.996711451820236
  mo_energy =
[-1.18583753e+02 -1.23129254e+01 -9.56267829e+00 -9.56267829e+00
 -9.56267829e+00 -1.27064900e+00 -5.83421875e-01 -5.83421875e-01
 -5.83421875e-01  9.96711452e-01  9.96711452e-01  9.96711452e-01
  1.01275496e+00  7.02284692e+00  7.02284692e+00  7.02284692e+00
  9.29226559e+00  3.27937296e+01  3.27937296e+01  3.27937296e+01
  4.63212471e+01  1.28553555e+02  1.28553555e+02  1.28553555e+02
  1.79415860e+02  4.83129086e+02  4.83129086e+02  4.83129086e+02
  6.84278943e+02  1.33479845e+03  1.33479845e+03  1.33479845e+03
  2.75269901e+03  3.02871726e+03  3.02871726e+03  3.02871726e+03
  6.64893364e+03  6.64893364e+03  6.64893364e+03  9.15177829e+03
  2.55024833e+04  7.62388517e+04]
E1 = -728.2865243382023  E_coul = 201.53743379595684
cycle= 5 E= -526.749090542245  delta_E= -1.69e-09  |g|= 2.08e-05  |ddm|= 0.000157
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.94425e-05
diis-c [-8.51066503e-11  1.28961476e-05 -1.74263565e-03 -1.26418013e-02
  4.04893075e-02  9.73882233e-01]
  HOMO = -0.583429535013292  LUMO = 0.996706449413765
  mo_energy =
[-1.18583785e+02 -1.23129488e+01 -9.56270357e+00 -9.56270357e+00
 -9.56270357e+00 -1.27065530e+00 -5.83429535e-01 -5.83429535e-01
 -5.83429535e-01  9.96706449e-01  9.96706449e-01  9.96706449e-01
  1.01275082e+00  7.02283003e+00  7.02283003e+00  7.02283003e+00
  9.29224913e+00  3.27937051e+01  3.27937051e+01  3.27937051e+01
  4.63212227e+01  1.28553526e+02  1.28553526e+02  1.28553526e+02
  1.79415831e+02  4.83129055e+02  4.83129055e+02  4.83129055e+02
  6.84278911e+02  1.33479842e+03  1.33479842e+03  1.33479842e+03
  2.75269897e+03  3.02871722e+03  3.02871722e+03  3.02871722e+03
  6.64893361e+03  6.64893361e+03  6.64893361e+03  9.15177826e+03
  2.55024832e+04  7.62388517e+04]
E1 = -728.2866097581451  E_coul = 201.53751921584205
cycle= 6 E= -526.749090542303  delta_E= -5.76e-11  |g|= 1.79e-06  |ddm|= 1.8e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2866097581451  E_coul = 201.53751921584205
  HOMO = -0.583429472875138  LUMO = 0.996706549386647
  mo_energy =
[-1.18583784e+02 -1.23129484e+01 -9.56270327e+00 -9.56270327e+00
 -9.56270327e+00 -1.27065484e+00 -5.83429473e-01 -5.83429473e-01
 -5.83429473e-01  9.96706549e-01  9.96706549e-01  9.96706549e-01
  1.01275122e+00  7.02283026e+00  7.02283026e+00  7.02283026e+00
  9.29224951e+00  3.27937055e+01  3.27937055e+01  3.27937055e+01
  4.63212230e+01  1.28553526e+02  1.28553526e+02  1.28553526e+02
  1.79415831e+02  4.83129055e+02  4.83129055e+02  4.83129055e+02
  6.84278912e+02  1.33479842e+03  1.33479842e+03  1.33479842e+03
  2.75269897e+03  3.02871722e+03  3.02871722e+03  3.02871722e+03
  6.64893361e+03  6.64893361e+03  6.64893361e+03  9.15177826e+03
  2.55024832e+04  7.62388517e+04]
E1 = -728.2866079471689  E_coul = 201.53751740486416
Extra cycle  E= -526.749090542305  delta_E= -1.71e-12  |g|= 3.66e-07  |ddm|= 3.07e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826645e+04 7.61750316e+03 3.61736002e+03 1.59743774e+03
 3.82579700e+02 1.15023134e+02 4.11289399e+01 1.72830773e+01
 6.56280220e+00 6.95974334e-01 2.73919675e+00 2.45674622e-01
 1.36278612e+03 6.64716997e+02 3.00826771e+02 3.13925693e+02
 6.16949827e+01 7.22121639e+00 2.03456622e+01 7.65684277e-01
 2.70607732e+00 2.20502217e-01]
E = -526.7490905423048
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:23 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6645448        1
[INPUT] 0    0    [1    /1   ]  7617.5031573         1
[INPUT] 0    0    [1    /1   ]  3617.36002082        1
[INPUT] 0    0    [1    /1   ]  1597.43774387        1
[INPUT] 0    0    [1    /1   ]  382.579700397        1
[INPUT] 0    0    [1    /1   ]  115.023133651        1
[INPUT] 0    0    [1    /1   ]  41.1289398869        1
[INPUT] 0    0    [1    /1   ]  17.2830773275        1
[INPUT] 0    0    [1    /1   ]  6.562802195          1
[INPUT] 0    0    [1    /1   ]  0.695974334298       1
[INPUT] 0    0    [1    /1   ]  2.7391967499         1
[INPUT] 0    0    [1    /1   ]  0.245674622291       1
[INPUT] 1    0    [1    /1   ]  1362.78612115        1
[INPUT] 1    0    [1    /1   ]  664.716997279        1
[INPUT] 1    0    [1    /1   ]  300.826771371        1
[INPUT] 1    0    [1    /1   ]  313.925693152        1
[INPUT] 1    0    [1    /1   ]  61.694982665         1
[INPUT] 1    0    [1    /1   ]  7.22121639202        1
[INPUT] 1    0    [1    /1   ]  20.3456621651        1
[INPUT] 1    0    [1    /1   ]  0.765684276545       1
[INPUT] 1    0    [1    /1   ]  2.70607731512        1
[INPUT] 1    0    [1    /1   ]  0.220502216753       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.6645447639, 1.0]], [0, [7617.503157304549, 1.0]], [0, [3617.3600208178827, 1.0]], [0, [1597.4377438651484, 1.0]], [0, [382.5797003968509, 1.0]], [0, [115.02313365063054, 1.0]], [0, [41.128939886907254, 1.0]], [0, [17.283077327510256, 1.0]], [0, [6.562802195004806, 1.0]], [0, [0.695974334297721, 1.0]], [0, [2.7391967499009793, 1.0]], [0, [0.24567462229054615, 1.0]], [1, [1362.786121146634, 1.0]], [1, [664.7169972791373, 1.0]], [1, [300.82677137074484, 1.0]], [1, [313.9256931524631, 1.0]], [1, [61.694982664962225, 1.0]], [1, [7.22121639201984, 1.0]], [1, [20.345662165081716, 1.0]], [1, [0.765684276544842, 1.0]], [1, [2.7060773151180606, 1.0]], [1, [0.22050221675288106, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66454476]
bas 1, expnt(s) = [7617.5031573]
bas 2, expnt(s) = [3617.36002082]
bas 3, expnt(s) = [1597.43774387]
bas 4, expnt(s) = [382.5797004]
bas 5, expnt(s) = [115.02313365]
bas 6, expnt(s) = [41.12893989]
bas 7, expnt(s) = [17.28307733]
bas 8, expnt(s) = [6.5628022]
bas 9, expnt(s) = [0.69597433]
bas 10, expnt(s) = [2.73919675]
bas 11, expnt(s) = [0.24567462]
bas 12, expnt(s) = [1362.78612115]
bas 13, expnt(s) = [664.71699728]
bas 14, expnt(s) = [300.82677137]
bas 15, expnt(s) = [313.92569315]
bas 16, expnt(s) = [61.69498266]
bas 17, expnt(s) = [7.22121639]
bas 18, expnt(s) = [20.34566217]
bas 19, expnt(s) = [0.76568428]
bas 20, expnt(s) = [2.70607732]
bas 21, expnt(s) = [0.22050222]
CPU time:       306.59
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826645e+04 5.20026416e+03 7.61750316e+03 2.06003456e+03
 3.61736002e+03 1.17844366e+03 1.59743774e+03 6.38385451e+02
 3.82579700e+02 2.18552846e+02 1.15023134e+02 8.87368322e+01
 4.11289399e+01 4.10322811e+01 1.72830773e+01 2.14156287e+01
 6.56280220e+00 1.03593382e+01 6.95974334e-01 1.92512947e+00
 2.73919675e+00 5.37938274e+00 2.45674622e-01 8.81627741e-01
 1.36278612e+03 2.41556662e+04 6.64716997e+02 9.84646571e+03
 3.00826771e+02 3.65493785e+03 3.13925693e+02 3.85494308e+03
 6.16949827e+01 5.04425114e+02 7.22121639e+00 3.45340363e+01
 2.03456622e+01 1.26059093e+02 7.65684277e-01 2.08952010e+00
 2.70607732e+00 1.01253407e+01 2.20502217e-01 4.40809142e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99404036906658
cond(S) = 114573.6272362889
E1 = -729.540258644151  E_coul = 203.17471761578847
init E= -526.365541028362
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555891442168823  LUMO = 1.01521532971821
  mo_energy =
[-1.18332254e+02 -1.22070163e+01 -9.44703329e+00 -9.44703329e+00
 -9.44703329e+00 -1.24014831e+00 -5.55891442e-01 -5.55891442e-01
 -5.55891442e-01  1.01521533e+00  1.01521533e+00  1.01521533e+00
  1.03417100e+00  7.09272807e+00  7.09272807e+00  7.09272807e+00
  9.36251468e+00  3.29148062e+01  3.29148062e+01  3.29148062e+01
  4.64406561e+01  1.28735781e+02  1.28735781e+02  1.28735781e+02
  1.79600766e+02  4.83380161e+02  4.83380161e+02  4.83380161e+02
  6.84566285e+02  1.33510279e+03  1.33510279e+03  1.33510279e+03
  2.75313334e+03  3.02908565e+03  3.02908565e+03  3.02908565e+03
  6.64941417e+03  6.64941417e+03  6.64941417e+03  9.15233273e+03
  2.55031321e+04  7.62395909e+04]
E1 = -727.8354268259667  E_coul = 201.08713282196723
cycle= 1 E= -526.748294003999  delta_E= -0.383  |g|= 0.188  |ddm|= 0.323
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.564672
diis-c [-0.31885392  1.        ]
  HOMO = -0.591118530526551  LUMO = 0.991117552930473
  mo_energy =
[-1.18642178e+02 -1.23455879e+01 -9.59666060e+00 -9.59666060e+00
 -9.59666060e+00 -1.27998442e+00 -5.91118531e-01 -5.91118531e-01
 -5.91118531e-01  9.91117553e-01  9.91117553e-01  9.91117553e-01
  1.00587171e+00  7.00300587e+00  7.00300587e+00  7.00300587e+00
  9.27107534e+00  3.27594383e+01  3.27594383e+01  3.27594383e+01
  4.62857132e+01  1.28505381e+02  1.28505381e+02  1.28505381e+02
  1.79366313e+02  4.83071356e+02  4.83071356e+02  4.83071356e+02
  6.84219429e+02  1.33473725e+03  1.33473725e+03  1.33473725e+03
  2.75263521e+03  3.02865419e+03  3.02865419e+03  3.02865419e+03
  6.64886922e+03  6.64886922e+03  6.64886922e+03  9.15171330e+03
  2.55024179e+04  7.62387862e+04]
E1 = -728.4164846904554  E_coul = 201.66745693617304
cycle= 2 E= -526.749027754282  delta_E= -0.000734  |g|= 0.0382  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0775854
diis-c [-0.00375713  0.07811526  0.92188474]
  HOMO = -0.581868386463592  LUMO = 0.997808809171045
  mo_energy =
[-1.18573316e+02 -1.23068840e+01 -9.55626035e+00 -9.55626035e+00
 -9.55626035e+00 -1.26891037e+00 -5.81868386e-01 -5.81868386e-01
 -5.81868386e-01  9.97808809e-01  9.97808809e-01  9.97808809e-01
  1.01401138e+00  7.02670200e+00  7.02670200e+00  7.02670200e+00
  9.29626064e+00  3.28001635e+01  3.28001635e+01  3.28001635e+01
  4.63278116e+01  1.28562297e+02  1.28562297e+02  1.28562297e+02
  1.79424798e+02  4.83139403e+02  4.83139403e+02  4.83139403e+02
  6.84289609e+02  1.33480940e+03  1.33480940e+03  1.33480940e+03
  2.75271061e+03  3.02872861e+03  3.02872861e+03  3.02872861e+03
  6.64894542e+03  6.64894542e+03  6.64894542e+03  9.15179030e+03
  2.55024955e+04  7.62388641e+04]
E1 = -728.2626159843013  E_coul = 201.5135275866456
cycle= 3 E= -526.749088397656  delta_E= -6.06e-05  |g|= 0.00664  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140115
diis-c [-8.21883318e-07 -1.30791386e-03  1.48499908e-01  8.52808006e-01]
  HOMO = -0.583444041212577  LUMO = 0.99669320150449
  mo_energy =
[-1.18583814e+02 -1.23130037e+01 -9.56274352e+00 -9.56274352e+00
 -9.56274352e+00 -1.27069417e+00 -5.83444041e-01 -5.83444041e-01
 -5.83444041e-01  9.96693202e-01  9.96693202e-01  9.96693202e-01
  1.01271831e+00  7.02279684e+00  7.02279684e+00  7.02279684e+00
  9.29220092e+00  3.27936667e+01  3.27936667e+01  3.27936667e+01
  4.63211763e+01  1.28553489e+02  1.28553489e+02  1.28553489e+02
  1.79415793e+02  4.83129025e+02  4.83129025e+02  4.83129025e+02
  6.84278890e+02  1.33479840e+03  1.33479840e+03  1.33479840e+03
  2.75269897e+03  3.02871721e+03  3.02871721e+03  3.02871721e+03
  6.64893361e+03  6.64893361e+03  6.64893361e+03  9.15177827e+03
  2.55024833e+04  7.62388517e+04]
E1 = -728.2867879210705  E_coul = 201.53769738051184
cycle= 4 E= -526.749090540559  delta_E= -2.14e-06  |g|= 0.0001  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000107116
diis-c [-5.16190452e-09  7.81044061e-05 -1.11637788e-02 -6.70495935e-02
  1.07813527e+00]
  HOMO = -0.583421875316412  LUMO = 0.996711451820236
  mo_energy =
[-1.18583753e+02 -1.23129254e+01 -9.56267829e+00 -9.56267829e+00
 -9.56267829e+00 -1.27064900e+00 -5.83421875e-01 -5.83421875e-01
 -5.83421875e-01  9.96711452e-01  9.96711452e-01  9.96711452e-01
  1.01275496e+00  7.02284692e+00  7.02284692e+00  7.02284692e+00
  9.29226559e+00  3.27937296e+01  3.27937296e+01  3.27937296e+01
  4.63212471e+01  1.28553555e+02  1.28553555e+02  1.28553555e+02
  1.79415860e+02  4.83129086e+02  4.83129086e+02  4.83129086e+02
  6.84278943e+02  1.33479845e+03  1.33479845e+03  1.33479845e+03
  2.75269901e+03  3.02871726e+03  3.02871726e+03  3.02871726e+03
  6.64893364e+03  6.64893364e+03  6.64893364e+03  9.15177829e+03
  2.55024833e+04  7.62388517e+04]
E1 = -728.2865243382023  E_coul = 201.53743379595684
cycle= 5 E= -526.749090542245  delta_E= -1.69e-09  |g|= 2.08e-05  |ddm|= 0.000157
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.94425e-05
diis-c [-8.51066503e-11  1.28961476e-05 -1.74263565e-03 -1.26418013e-02
  4.04893075e-02  9.73882233e-01]
  HOMO = -0.583429535013292  LUMO = 0.996706449413765
  mo_energy =
[-1.18583785e+02 -1.23129488e+01 -9.56270357e+00 -9.56270357e+00
 -9.56270357e+00 -1.27065530e+00 -5.83429535e-01 -5.83429535e-01
 -5.83429535e-01  9.96706449e-01  9.96706449e-01  9.96706449e-01
  1.01275082e+00  7.02283003e+00  7.02283003e+00  7.02283003e+00
  9.29224913e+00  3.27937051e+01  3.27937051e+01  3.27937051e+01
  4.63212227e+01  1.28553526e+02  1.28553526e+02  1.28553526e+02
  1.79415831e+02  4.83129055e+02  4.83129055e+02  4.83129055e+02
  6.84278911e+02  1.33479842e+03  1.33479842e+03  1.33479842e+03
  2.75269897e+03  3.02871722e+03  3.02871722e+03  3.02871722e+03
  6.64893361e+03  6.64893361e+03  6.64893361e+03  9.15177826e+03
  2.55024832e+04  7.62388517e+04]
E1 = -728.2866097581451  E_coul = 201.53751921584205
cycle= 6 E= -526.749090542303  delta_E= -5.76e-11  |g|= 1.79e-06  |ddm|= 1.8e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2866097581451  E_coul = 201.53751921584205
  HOMO = -0.583429472875138  LUMO = 0.996706549386647
  mo_energy =
[-1.18583784e+02 -1.23129484e+01 -9.56270327e+00 -9.56270327e+00
 -9.56270327e+00 -1.27065484e+00 -5.83429473e-01 -5.83429473e-01
 -5.83429473e-01  9.96706549e-01  9.96706549e-01  9.96706549e-01
  1.01275122e+00  7.02283026e+00  7.02283026e+00  7.02283026e+00
  9.29224951e+00  3.27937055e+01  3.27937055e+01  3.27937055e+01
  4.63212230e+01  1.28553526e+02  1.28553526e+02  1.28553526e+02
  1.79415831e+02  4.83129055e+02  4.83129055e+02  4.83129055e+02
  6.84278912e+02  1.33479842e+03  1.33479842e+03  1.33479842e+03
  2.75269897e+03  3.02871722e+03  3.02871722e+03  3.02871722e+03
  6.64893361e+03  6.64893361e+03  6.64893361e+03  9.15177826e+03
  2.55024832e+04  7.62388517e+04]
E1 = -728.2866079471689  E_coul = 201.53751740486416
Extra cycle  E= -526.749090542305  delta_E= -1.71e-12  |g|= 3.66e-07  |ddm|= 3.07e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114573.6272362889
E1 = -728.2866079471689  E_coul = 201.53751740486416
init E= -526.749090542305
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583429519683997  LUMO = 0.996706528292954
  mo_energy =
[-1.18583784e+02 -1.23129486e+01 -9.56270342e+00 -9.56270342e+00
 -9.56270342e+00 -1.27065482e+00 -5.83429520e-01 -5.83429520e-01
 -5.83429520e-01  9.96706528e-01  9.96706528e-01  9.96706528e-01
  1.01275126e+00  7.02283016e+00  7.02283016e+00  7.02283016e+00
  9.29224945e+00  3.27937053e+01  3.27937053e+01  3.27937053e+01
  4.63212229e+01  1.28553526e+02  1.28553526e+02  1.28553526e+02
  1.79415831e+02  4.83129055e+02  4.83129055e+02  4.83129055e+02
  6.84278912e+02  1.33479842e+03  1.33479842e+03  1.33479842e+03
  2.75269897e+03  3.02871722e+03  3.02871722e+03  3.02871722e+03
  6.64893361e+03  6.64893361e+03  6.64893361e+03  9.15177826e+03
  2.55024832e+04  7.62388517e+04]
E1 = -728.2866083602472  E_coul = 201.53751781794307
cycle= 1 E= -526.749090542304  delta_E= 5.68e-13  |g|= 7.98e-08  |ddm|= 5.83e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2866083602472  E_coul = 201.53751781794307
  HOMO = -0.583429514167517  LUMO = 0.996706534670229
  mo_energy =
[-1.18583784e+02 -1.23129485e+01 -9.56270339e+00 -9.56270339e+00
 -9.56270339e+00 -1.27065479e+00 -5.83429514e-01 -5.83429514e-01
 -5.83429514e-01  9.96706535e-01  9.96706535e-01  9.96706535e-01
  1.01275128e+00  7.02283018e+00  7.02283018e+00  7.02283018e+00
  9.29224947e+00  3.27937053e+01  3.27937053e+01  3.27937053e+01
  4.63212229e+01  1.28553526e+02  1.28553526e+02  1.28553526e+02
  1.79415831e+02  4.83129055e+02  4.83129055e+02  4.83129055e+02
  6.84278912e+02  1.33479842e+03  1.33479842e+03  1.33479842e+03
  2.75269897e+03  3.02871722e+03  3.02871722e+03  3.02871722e+03
  6.64893361e+03  6.64893361e+03  6.64893361e+03  9.15177826e+03
  2.55024832e+04  7.62388517e+04]
E1 = -728.2866082229285  E_coul = 201.53751768062355
Extra cycle  E= -526.749090542305  delta_E= -7.96e-13  |g|= 1.64e-08  |ddm|= 1.27e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61826645e+04 7.61750316e+03 3.61736002e+03 1.59743774e+03
 3.82579700e+02 1.15023134e+02 4.11289399e+01 1.72830773e+01
 6.56280220e+00 6.95974334e-01 2.73919675e+00 2.45674622e-01
 1.36278612e+03 6.64716997e+02 3.00826771e+02 3.13925693e+02
 6.16949827e+01 7.22121639e+00 2.03456622e+01 7.65684277e-01
 2.70607732e+00 2.20502217e-01]
grad_E = [-1.56043761e-06  3.80311277e-06 -1.24800773e-06  8.74103015e-05
 -3.92725307e-04 -1.07724079e-04 -7.26569460e-04  3.10991756e-04
 -1.35672931e-04  4.49033562e-03  9.58501374e-04  2.48632135e-03
 -4.67106859e-07  5.54330547e-06  2.68979766e-05  2.31729460e-05
 -3.91112738e-04 -3.38913108e-03  2.62981424e-03 -8.45470343e-04
 -3.77943580e-03  1.76352279e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:27 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.664585         1
[INPUT] 0    0    [1    /1   ]  7617.50306964        1
[INPUT] 0    0    [1    /1   ]  3617.36006238        1
[INPUT] 0    0    [1    /1   ]  1597.43591576        1
[INPUT] 0    0    [1    /1   ]  382.578971696        1
[INPUT] 0    0    [1    /1   ]  115.059018588        1
[INPUT] 0    0    [1    /1   ]  41.1412461325        1
[INPUT] 0    0    [1    /1   ]  17.324867078         1
[INPUT] 0    0    [1    /1   ]  6.54766594874        1
[INPUT] 0    0    [1    /1   ]  0.690064956866       1
[INPUT] 0    0    [1    /1   ]  2.73716558045        1
[INPUT] 0    0    [1    /1   ]  0.24438599832        1
[INPUT] 1    0    [1    /1   ]  1362.78613452        1
[INPUT] 1    0    [1    /1   ]  664.716863553        1
[INPUT] 1    0    [1    /1   ]  300.826139179        1
[INPUT] 1    0    [1    /1   ]  313.925148153        1
[INPUT] 1    0    [1    /1   ]  61.6962014784        1
[INPUT] 1    0    [1    /1   ]  7.22459748108        1
[INPUT] 1    0    [1    /1   ]  20.3403247491        1
[INPUT] 1    0    [1    /1   ]  0.766658381748       1
[INPUT] 1    0    [1    /1   ]  2.72313218315        1
[INPUT] 1    0    [1    /1   ]  0.22024803178        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.664584986614, 1.0]], [0, [7617.503069640463, 1.0]], [0, [3617.360062377555, 1.0]], [0, [1597.4359157638862, 1.0]], [0, [382.5789716962591, 1.0]], [0, [115.05901858804748, 1.0]], [0, [41.14124613252375, 1.0]], [0, [17.324867078013856, 1.0]], [0, [6.547665948744294, 1.0]], [0, [0.6900649568664081, 1.0]], [0, [2.7371655804529453, 1.0]], [0, [0.24438599832024188, 1.0]], [1, [1362.7861345169067, 1.0]], [1, [664.7168635528251, 1.0]], [1, [300.82613917935237, 1.0]], [1, [313.92514815349557, 1.0]], [1, [61.696201478350595, 1.0]], [1, [7.224597481079251, 1.0]], [1, [20.340324749082292, 1.0]], [1, [0.7666583817478143, 1.0]], [1, [2.723132183148811, 1.0]], [1, [0.22024803177965113, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66458499]
bas 1, expnt(s) = [7617.50306964]
bas 2, expnt(s) = [3617.36006238]
bas 3, expnt(s) = [1597.43591576]
bas 4, expnt(s) = [382.5789717]
bas 5, expnt(s) = [115.05901859]
bas 6, expnt(s) = [41.14124613]
bas 7, expnt(s) = [17.32486708]
bas 8, expnt(s) = [6.54766595]
bas 9, expnt(s) = [0.69006496]
bas 10, expnt(s) = [2.73716558]
bas 11, expnt(s) = [0.244386]
bas 12, expnt(s) = [1362.78613452]
bas 13, expnt(s) = [664.71686355]
bas 14, expnt(s) = [300.82613918]
bas 15, expnt(s) = [313.92514815]
bas 16, expnt(s) = [61.69620148]
bas 17, expnt(s) = [7.22459748]
bas 18, expnt(s) = [20.34032475]
bas 19, expnt(s) = [0.76665838]
bas 20, expnt(s) = [2.72313218]
bas 21, expnt(s) = [0.22024803]
CPU time:       312.28
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826646e+04 5.20026417e+03 7.61750307e+03 2.06003454e+03
 3.61736006e+03 1.17844367e+03 1.59743592e+03 6.38384903e+02
 3.82578972e+02 2.18552534e+02 1.15059019e+02 8.87575944e+01
 4.11412461e+01 4.10414887e+01 1.73248671e+01 2.14544536e+01
 6.54766595e+00 1.03414136e+01 6.90064957e-01 1.91285700e+00
 2.73716558e+00 5.37639077e+00 2.44385998e-01 8.78157196e-01
 1.36278613e+03 2.41556665e+04 6.64716864e+02 9.84646323e+03
 3.00826139e+02 3.65492824e+03 3.13925148e+02 3.85493471e+03
 6.16962015e+01 5.04437570e+02 7.22459748e+00 3.45542493e+01
 2.03403247e+01 1.26017757e+02 7.66658382e-01 2.09284350e+00
 2.72313218e+00 1.02051712e+01 2.20248032e-01 4.40174052e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994059925501887
cond(S) = 114537.18974813558
E1 = -729.5399771920687  E_coul = 203.17451983646518
init E= -526.365457355604
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555907045362229  LUMO = 1.01521219009362
  mo_energy =
[-1.18332251e+02 -1.22070251e+01 -9.44705682e+00 -9.44705682e+00
 -9.44705682e+00 -1.24017519e+00 -5.55907045e-01 -5.55907045e-01
 -5.55907045e-01  1.01521219e+00  1.01521219e+00  1.01521219e+00
  1.02294978e+00  7.12524685e+00  7.12524685e+00  7.12524685e+00
  9.31812070e+00  3.29830871e+01  3.29830871e+01  3.29830871e+01
  4.64087943e+01  1.28792988e+02  1.28792988e+02  1.28792988e+02
  1.79681487e+02  4.83421700e+02  4.83421700e+02  4.83421700e+02
  6.84769659e+02  1.33513757e+03  1.33513757e+03  1.33513757e+03
  2.75337410e+03  3.02911596e+03  3.02911596e+03  3.02911596e+03
  6.64944036e+03  6.64944036e+03  6.64944036e+03  9.15256381e+03
  2.55033515e+04  7.62397952e+04]
E1 = -727.8289269396466  E_coul = 201.08054396377167
cycle= 1 E= -526.748382975875  delta_E= -0.383  |g|= 0.188  |ddm|= 0.331
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.565159
diis-c [-0.31940465  1.        ]
  HOMO = -0.591379215058223  LUMO = 0.990895876104452
  mo_energy =
[-1.18642656e+02 -1.23460084e+01 -9.59710893e+00 -9.59710893e+00
 -9.59710893e+00 -1.28030111e+00 -5.91379215e-01 -5.91379215e-01
 -5.91379215e-01  9.90895876e-01  9.90895876e-01  9.90895876e-01
  9.94663538e-01  7.03491961e+00  7.03491961e+00  7.03491961e+00
  9.22643092e+00  3.28273009e+01  3.28273009e+01  3.28273009e+01
  4.62533859e+01  1.28562165e+02  1.28562165e+02  1.28562165e+02
  1.79446510e+02  4.83112418e+02  4.83112418e+02  4.83112418e+02
  6.84422315e+02  1.33477156e+03  1.33477156e+03  1.33477156e+03
  2.75287550e+03  3.02868403e+03  3.02868403e+03  3.02868403e+03
  6.64889493e+03  6.64889493e+03  6.64889493e+03  9.15194390e+03
  2.55026367e+04  7.62389899e+04]
E1 = -728.4120491806609  E_coul = 201.66292837192526
cycle= 2 E= -526.749120808736  delta_E= -0.000738  |g|= 0.0383  |ddm|= 0.0535
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0778268
diis-c [-0.0037737   0.07838664  0.92161336]
  HOMO = -0.582090248548891  LUMO = 0.99762488111121
  mo_energy =
[-1.18573616e+02 -1.23071744e+01 -9.55657413e+00 -9.55657413e+00
 -9.55657413e+00 -1.26918417e+00 -5.82090249e-01 -5.82090249e-01
 -5.82090249e-01  9.97624881e-01  9.97624881e-01  9.97624881e-01
  1.00276800e+00  7.05876582e+00  7.05876582e+00  7.05876582e+00
  9.25168696e+00  3.28681586e+01  3.28681586e+01  3.28681586e+01
  4.62956354e+01  1.28619237e+02  1.28619237e+02  1.28619237e+02
  1.79505169e+02  4.83180642e+02  4.83180642e+02  4.83180642e+02
  6.84492676e+02  1.33484389e+03  1.33484389e+03  1.33484389e+03
  2.75295109e+03  3.02875863e+03  3.02875863e+03  3.02875863e+03
  6.64897132e+03  6.64897132e+03  6.64897132e+03  9.15202108e+03
  2.55027145e+04  7.62390680e+04]
E1 = -728.2576055308278  E_coul = 201.50842365145346
cycle= 3 E= -526.749181879374  delta_E= -6.11e-05  |g|= 0.00664  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140394
diis-c [-8.19217084e-07 -1.30783595e-03  1.48360481e-01  8.52947355e-01]
  HOMO = -0.58367118823129  LUMO = 0.996503613802287
  mo_energy =
[-1.18584131e+02 -1.23133077e+01 -9.56307114e+00 -9.56307114e+00
 -9.56307114e+00 -1.27097503e+00 -5.83671188e-01 -5.83671188e-01
 -5.83671188e-01  9.96503614e-01  9.96503614e-01  9.96503614e-01
  1.00148011e+00  7.05484040e+00  7.05484040e+00  7.05484040e+00
  9.24762034e+00  3.28616482e+01  3.28616482e+01  3.28616482e+01
  4.62889843e+01  1.28610414e+02  1.28610414e+02  1.28610414e+02
  1.79496146e+02  4.83170247e+02  4.83170247e+02  4.83170247e+02
  6.84481939e+02  1.33483287e+03  1.33483287e+03  1.33483287e+03
  2.75293943e+03  3.02874721e+03  3.02874721e+03  3.02874721e+03
  6.64895949e+03  6.64895949e+03  6.64895949e+03  9.15200904e+03
  2.55027023e+04  7.62390557e+04]
E1 = -728.2818450851247  E_coul = 201.5326610527495
cycle= 4 E= -526.749184032375  delta_E= -2.15e-06  |g|= 9.9e-05  |ddm|= 0.00237
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000106406
diis-c [-5.11966736e-09  7.75043911e-05 -1.10722916e-02 -6.65569229e-02
  1.07755171e+00]
  HOMO = -0.583649009441543  LUMO = 0.996521854521182
  mo_energy =
[-1.18584070e+02 -1.23132293e+01 -9.56300577e+00 -9.56300577e+00
 -9.56300577e+00 -1.27093012e+00 -5.83649009e-01 -5.83649009e-01
 -5.83649009e-01  9.96521855e-01  9.96521855e-01  9.96521855e-01
  1.00151627e+00  7.05489061e+00  7.05489061e+00  7.05489061e+00
  9.24768497e+00  3.28617113e+01  3.28617113e+01  3.28617113e+01
  4.62890553e+01  1.28610480e+02  1.28610480e+02  1.28610480e+02
  1.79496213e+02  4.83170308e+02  4.83170308e+02  4.83170308e+02
  6.84481993e+02  1.33483292e+03  1.33483292e+03  1.33483292e+03
  2.75293947e+03  3.02874726e+03  3.02874726e+03  3.02874726e+03
  6.64895952e+03  6.64895952e+03  6.64895952e+03  9.15200906e+03
  2.55027023e+04  7.62390557e+04]
E1 = -728.2815806951972  E_coul = 201.5323966611776
cycle= 5 E= -526.74918403402  delta_E= -1.64e-09  |g|= 2.07e-05  |ddm|= 0.000155
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93475e-05
diis-c [-8.41616700e-11  1.28295803e-05 -1.73439718e-03 -1.25948943e-02
  4.16242934e-02  9.72692168e-01]
  HOMO = -0.583656662941671  LUMO = 0.996516843218084
  mo_energy =
[-1.18584101e+02 -1.23132527e+01 -9.56303100e+00 -9.56303100e+00
 -9.56303100e+00 -1.27093644e+00 -5.83656663e-01 -5.83656663e-01
 -5.83656663e-01  9.96516843e-01  9.96516843e-01  9.96516843e-01
  1.00151214e+00  7.05487371e+00  7.05487371e+00  7.05487371e+00
  9.24766854e+00  3.28616868e+01  3.28616868e+01  3.28616868e+01
  4.62890309e+01  1.28610451e+02  1.28610451e+02  1.28610451e+02
  1.79496184e+02  4.83170276e+02  4.83170276e+02  4.83170276e+02
  6.84481961e+02  1.33483289e+03  1.33483289e+03  1.33483289e+03
  2.75293943e+03  3.02874722e+03  3.02874722e+03  3.02874722e+03
  6.64895949e+03  6.64895949e+03  6.64895949e+03  9.15200903e+03
  2.55027023e+04  7.62390556e+04]
E1 = -728.2816659931295  E_coul = 201.5324819590533
cycle= 6 E= -526.749184034076  delta_E= -5.66e-11  |g|= 1.79e-06  |ddm|= 1.79e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2816659931295  E_coul = 201.5324819590533
  HOMO = -0.583656609906847  LUMO = 0.996516937089692
  mo_energy =
[-1.18584101e+02 -1.23132523e+01 -9.56303072e+00 -9.56303072e+00
 -9.56303072e+00 -1.27093599e+00 -5.83656610e-01 -5.83656610e-01
 -5.83656610e-01  9.96516937e-01  9.96516937e-01  9.96516937e-01
  1.00151254e+00  7.05487391e+00  7.05487391e+00  7.05487391e+00
  9.24766891e+00  3.28616871e+01  3.28616871e+01  3.28616871e+01
  4.62890312e+01  1.28610451e+02  1.28610451e+02  1.28610451e+02
  1.79496185e+02  4.83170277e+02  4.83170277e+02  4.83170277e+02
  6.84481962e+02  1.33483289e+03  1.33483289e+03  1.33483289e+03
  2.75293943e+03  3.02874723e+03  3.02874723e+03  3.02874723e+03
  6.64895949e+03  6.64895949e+03  6.64895949e+03  9.15200903e+03
  2.55027023e+04  7.62390556e+04]
E1 = -728.2816642635379  E_coul = 201.53248022945954
Extra cycle  E= -526.749184034078  delta_E= -2.05e-12  |g|= 3.67e-07  |ddm|= 3.08e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826646e+04 7.61750307e+03 3.61736006e+03 1.59743592e+03
 3.82578972e+02 1.15059019e+02 4.11412461e+01 1.73248671e+01
 6.54766595e+00 6.90064957e-01 2.73716558e+00 2.44385998e-01
 1.36278613e+03 6.64716864e+02 3.00826139e+02 3.13925148e+02
 6.16962015e+01 7.22459748e+00 2.03403247e+01 7.66658382e-01
 2.72313218e+00 2.20248032e-01]
E = -526.7491840340783
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:28 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.664585         1
[INPUT] 0    0    [1    /1   ]  7617.50306964        1
[INPUT] 0    0    [1    /1   ]  3617.36006238        1
[INPUT] 0    0    [1    /1   ]  1597.43591576        1
[INPUT] 0    0    [1    /1   ]  382.578971696        1
[INPUT] 0    0    [1    /1   ]  115.059018588        1
[INPUT] 0    0    [1    /1   ]  41.1412461325        1
[INPUT] 0    0    [1    /1   ]  17.324867078         1
[INPUT] 0    0    [1    /1   ]  6.54766594874        1
[INPUT] 0    0    [1    /1   ]  0.690064956866       1
[INPUT] 0    0    [1    /1   ]  2.73716558045        1
[INPUT] 0    0    [1    /1   ]  0.24438599832        1
[INPUT] 1    0    [1    /1   ]  1362.78613452        1
[INPUT] 1    0    [1    /1   ]  664.716863553        1
[INPUT] 1    0    [1    /1   ]  300.826139179        1
[INPUT] 1    0    [1    /1   ]  313.925148153        1
[INPUT] 1    0    [1    /1   ]  61.6962014784        1
[INPUT] 1    0    [1    /1   ]  7.22459748108        1
[INPUT] 1    0    [1    /1   ]  20.3403247491        1
[INPUT] 1    0    [1    /1   ]  0.766658381748       1
[INPUT] 1    0    [1    /1   ]  2.72313218315        1
[INPUT] 1    0    [1    /1   ]  0.22024803178        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.664584986614, 1.0]], [0, [7617.503069640463, 1.0]], [0, [3617.360062377555, 1.0]], [0, [1597.4359157638862, 1.0]], [0, [382.5789716962591, 1.0]], [0, [115.05901858804748, 1.0]], [0, [41.14124613252375, 1.0]], [0, [17.324867078013856, 1.0]], [0, [6.547665948744294, 1.0]], [0, [0.6900649568664081, 1.0]], [0, [2.7371655804529453, 1.0]], [0, [0.24438599832024188, 1.0]], [1, [1362.7861345169067, 1.0]], [1, [664.7168635528251, 1.0]], [1, [300.82613917935237, 1.0]], [1, [313.92514815349557, 1.0]], [1, [61.696201478350595, 1.0]], [1, [7.224597481079251, 1.0]], [1, [20.340324749082292, 1.0]], [1, [0.7666583817478143, 1.0]], [1, [2.723132183148811, 1.0]], [1, [0.22024803177965113, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66458499]
bas 1, expnt(s) = [7617.50306964]
bas 2, expnt(s) = [3617.36006238]
bas 3, expnt(s) = [1597.43591576]
bas 4, expnt(s) = [382.5789717]
bas 5, expnt(s) = [115.05901859]
bas 6, expnt(s) = [41.14124613]
bas 7, expnt(s) = [17.32486708]
bas 8, expnt(s) = [6.54766595]
bas 9, expnt(s) = [0.69006496]
bas 10, expnt(s) = [2.73716558]
bas 11, expnt(s) = [0.244386]
bas 12, expnt(s) = [1362.78613452]
bas 13, expnt(s) = [664.71686355]
bas 14, expnt(s) = [300.82613918]
bas 15, expnt(s) = [313.92514815]
bas 16, expnt(s) = [61.69620148]
bas 17, expnt(s) = [7.22459748]
bas 18, expnt(s) = [20.34032475]
bas 19, expnt(s) = [0.76665838]
bas 20, expnt(s) = [2.72313218]
bas 21, expnt(s) = [0.22024803]
CPU time:       312.72
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826646e+04 5.20026417e+03 7.61750307e+03 2.06003454e+03
 3.61736006e+03 1.17844367e+03 1.59743592e+03 6.38384903e+02
 3.82578972e+02 2.18552534e+02 1.15059019e+02 8.87575944e+01
 4.11412461e+01 4.10414887e+01 1.73248671e+01 2.14544536e+01
 6.54766595e+00 1.03414136e+01 6.90064957e-01 1.91285700e+00
 2.73716558e+00 5.37639077e+00 2.44385998e-01 8.78157196e-01
 1.36278613e+03 2.41556665e+04 6.64716864e+02 9.84646323e+03
 3.00826139e+02 3.65492824e+03 3.13925148e+02 3.85493471e+03
 6.16962015e+01 5.04437570e+02 7.22459748e+00 3.45542493e+01
 2.03403247e+01 1.26017757e+02 7.66658382e-01 2.09284350e+00
 2.72313218e+00 1.02051712e+01 2.20248032e-01 4.40174052e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994059925501887
cond(S) = 114537.18974813558
E1 = -729.5399771920687  E_coul = 203.17451983646518
init E= -526.365457355604
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555907045362229  LUMO = 1.01521219009362
  mo_energy =
[-1.18332251e+02 -1.22070251e+01 -9.44705682e+00 -9.44705682e+00
 -9.44705682e+00 -1.24017519e+00 -5.55907045e-01 -5.55907045e-01
 -5.55907045e-01  1.01521219e+00  1.01521219e+00  1.01521219e+00
  1.02294978e+00  7.12524685e+00  7.12524685e+00  7.12524685e+00
  9.31812070e+00  3.29830871e+01  3.29830871e+01  3.29830871e+01
  4.64087943e+01  1.28792988e+02  1.28792988e+02  1.28792988e+02
  1.79681487e+02  4.83421700e+02  4.83421700e+02  4.83421700e+02
  6.84769659e+02  1.33513757e+03  1.33513757e+03  1.33513757e+03
  2.75337410e+03  3.02911596e+03  3.02911596e+03  3.02911596e+03
  6.64944036e+03  6.64944036e+03  6.64944036e+03  9.15256381e+03
  2.55033515e+04  7.62397952e+04]
E1 = -727.8289269396466  E_coul = 201.08054396377167
cycle= 1 E= -526.748382975875  delta_E= -0.383  |g|= 0.188  |ddm|= 0.331
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.565159
diis-c [-0.31940465  1.        ]
  HOMO = -0.591379215058223  LUMO = 0.990895876104452
  mo_energy =
[-1.18642656e+02 -1.23460084e+01 -9.59710893e+00 -9.59710893e+00
 -9.59710893e+00 -1.28030111e+00 -5.91379215e-01 -5.91379215e-01
 -5.91379215e-01  9.90895876e-01  9.90895876e-01  9.90895876e-01
  9.94663538e-01  7.03491961e+00  7.03491961e+00  7.03491961e+00
  9.22643092e+00  3.28273009e+01  3.28273009e+01  3.28273009e+01
  4.62533859e+01  1.28562165e+02  1.28562165e+02  1.28562165e+02
  1.79446510e+02  4.83112418e+02  4.83112418e+02  4.83112418e+02
  6.84422315e+02  1.33477156e+03  1.33477156e+03  1.33477156e+03
  2.75287550e+03  3.02868403e+03  3.02868403e+03  3.02868403e+03
  6.64889493e+03  6.64889493e+03  6.64889493e+03  9.15194390e+03
  2.55026367e+04  7.62389899e+04]
E1 = -728.4120491806609  E_coul = 201.66292837192526
cycle= 2 E= -526.749120808736  delta_E= -0.000738  |g|= 0.0383  |ddm|= 0.0535
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0778268
diis-c [-0.0037737   0.07838664  0.92161336]
  HOMO = -0.582090248548891  LUMO = 0.99762488111121
  mo_energy =
[-1.18573616e+02 -1.23071744e+01 -9.55657413e+00 -9.55657413e+00
 -9.55657413e+00 -1.26918417e+00 -5.82090249e-01 -5.82090249e-01
 -5.82090249e-01  9.97624881e-01  9.97624881e-01  9.97624881e-01
  1.00276800e+00  7.05876582e+00  7.05876582e+00  7.05876582e+00
  9.25168696e+00  3.28681586e+01  3.28681586e+01  3.28681586e+01
  4.62956354e+01  1.28619237e+02  1.28619237e+02  1.28619237e+02
  1.79505169e+02  4.83180642e+02  4.83180642e+02  4.83180642e+02
  6.84492676e+02  1.33484389e+03  1.33484389e+03  1.33484389e+03
  2.75295109e+03  3.02875863e+03  3.02875863e+03  3.02875863e+03
  6.64897132e+03  6.64897132e+03  6.64897132e+03  9.15202108e+03
  2.55027145e+04  7.62390680e+04]
E1 = -728.2576055308278  E_coul = 201.50842365145346
cycle= 3 E= -526.749181879374  delta_E= -6.11e-05  |g|= 0.00664  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140394
diis-c [-8.19217084e-07 -1.30783595e-03  1.48360481e-01  8.52947355e-01]
  HOMO = -0.58367118823129  LUMO = 0.996503613802287
  mo_energy =
[-1.18584131e+02 -1.23133077e+01 -9.56307114e+00 -9.56307114e+00
 -9.56307114e+00 -1.27097503e+00 -5.83671188e-01 -5.83671188e-01
 -5.83671188e-01  9.96503614e-01  9.96503614e-01  9.96503614e-01
  1.00148011e+00  7.05484040e+00  7.05484040e+00  7.05484040e+00
  9.24762034e+00  3.28616482e+01  3.28616482e+01  3.28616482e+01
  4.62889843e+01  1.28610414e+02  1.28610414e+02  1.28610414e+02
  1.79496146e+02  4.83170247e+02  4.83170247e+02  4.83170247e+02
  6.84481939e+02  1.33483287e+03  1.33483287e+03  1.33483287e+03
  2.75293943e+03  3.02874721e+03  3.02874721e+03  3.02874721e+03
  6.64895949e+03  6.64895949e+03  6.64895949e+03  9.15200904e+03
  2.55027023e+04  7.62390557e+04]
E1 = -728.2818450851247  E_coul = 201.5326610527495
cycle= 4 E= -526.749184032375  delta_E= -2.15e-06  |g|= 9.9e-05  |ddm|= 0.00237
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000106406
diis-c [-5.11966736e-09  7.75043911e-05 -1.10722916e-02 -6.65569229e-02
  1.07755171e+00]
  HOMO = -0.583649009441543  LUMO = 0.996521854521182
  mo_energy =
[-1.18584070e+02 -1.23132293e+01 -9.56300577e+00 -9.56300577e+00
 -9.56300577e+00 -1.27093012e+00 -5.83649009e-01 -5.83649009e-01
 -5.83649009e-01  9.96521855e-01  9.96521855e-01  9.96521855e-01
  1.00151627e+00  7.05489061e+00  7.05489061e+00  7.05489061e+00
  9.24768497e+00  3.28617113e+01  3.28617113e+01  3.28617113e+01
  4.62890553e+01  1.28610480e+02  1.28610480e+02  1.28610480e+02
  1.79496213e+02  4.83170308e+02  4.83170308e+02  4.83170308e+02
  6.84481993e+02  1.33483292e+03  1.33483292e+03  1.33483292e+03
  2.75293947e+03  3.02874726e+03  3.02874726e+03  3.02874726e+03
  6.64895952e+03  6.64895952e+03  6.64895952e+03  9.15200906e+03
  2.55027023e+04  7.62390557e+04]
E1 = -728.2815806951972  E_coul = 201.5323966611776
cycle= 5 E= -526.74918403402  delta_E= -1.64e-09  |g|= 2.07e-05  |ddm|= 0.000155
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93475e-05
diis-c [-8.41616700e-11  1.28295803e-05 -1.73439718e-03 -1.25948943e-02
  4.16242934e-02  9.72692168e-01]
  HOMO = -0.583656662941671  LUMO = 0.996516843218084
  mo_energy =
[-1.18584101e+02 -1.23132527e+01 -9.56303100e+00 -9.56303100e+00
 -9.56303100e+00 -1.27093644e+00 -5.83656663e-01 -5.83656663e-01
 -5.83656663e-01  9.96516843e-01  9.96516843e-01  9.96516843e-01
  1.00151214e+00  7.05487371e+00  7.05487371e+00  7.05487371e+00
  9.24766854e+00  3.28616868e+01  3.28616868e+01  3.28616868e+01
  4.62890309e+01  1.28610451e+02  1.28610451e+02  1.28610451e+02
  1.79496184e+02  4.83170276e+02  4.83170276e+02  4.83170276e+02
  6.84481961e+02  1.33483289e+03  1.33483289e+03  1.33483289e+03
  2.75293943e+03  3.02874722e+03  3.02874722e+03  3.02874722e+03
  6.64895949e+03  6.64895949e+03  6.64895949e+03  9.15200903e+03
  2.55027023e+04  7.62390556e+04]
E1 = -728.2816659931295  E_coul = 201.5324819590533
cycle= 6 E= -526.749184034076  delta_E= -5.66e-11  |g|= 1.79e-06  |ddm|= 1.79e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2816659931295  E_coul = 201.5324819590533
  HOMO = -0.583656609906847  LUMO = 0.996516937089692
  mo_energy =
[-1.18584101e+02 -1.23132523e+01 -9.56303072e+00 -9.56303072e+00
 -9.56303072e+00 -1.27093599e+00 -5.83656610e-01 -5.83656610e-01
 -5.83656610e-01  9.96516937e-01  9.96516937e-01  9.96516937e-01
  1.00151254e+00  7.05487391e+00  7.05487391e+00  7.05487391e+00
  9.24766891e+00  3.28616871e+01  3.28616871e+01  3.28616871e+01
  4.62890312e+01  1.28610451e+02  1.28610451e+02  1.28610451e+02
  1.79496185e+02  4.83170277e+02  4.83170277e+02  4.83170277e+02
  6.84481962e+02  1.33483289e+03  1.33483289e+03  1.33483289e+03
  2.75293943e+03  3.02874723e+03  3.02874723e+03  3.02874723e+03
  6.64895949e+03  6.64895949e+03  6.64895949e+03  9.15200903e+03
  2.55027023e+04  7.62390556e+04]
E1 = -728.2816642635379  E_coul = 201.53248022945954
Extra cycle  E= -526.749184034078  delta_E= -2.05e-12  |g|= 3.67e-07  |ddm|= 3.08e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114537.18974813558
E1 = -728.2816642635379  E_coul = 201.53248022945954
init E= -526.749184034078
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583656655438557  LUMO = 0.996516916930336
  mo_energy =
[-1.18584101e+02 -1.23132524e+01 -9.56303087e+00 -9.56303087e+00
 -9.56303087e+00 -1.27093596e+00 -5.83656655e-01 -5.83656655e-01
 -5.83656655e-01  9.96516917e-01  9.96516917e-01  9.96516917e-01
  1.00151258e+00  7.05487382e+00  7.05487382e+00  7.05487382e+00
  9.24766885e+00  3.28616870e+01  3.28616870e+01  3.28616870e+01
  4.62890311e+01  1.28610451e+02  1.28610451e+02  1.28610451e+02
  1.79496184e+02  4.83170277e+02  4.83170277e+02  4.83170277e+02
  6.84481961e+02  1.33483289e+03  1.33483289e+03  1.33483289e+03
  2.75293943e+03  3.02874723e+03  3.02874723e+03  3.02874723e+03
  6.64895949e+03  6.64895949e+03  6.64895949e+03  9.15200903e+03
  2.55027023e+04  7.62390556e+04]
E1 = -728.2816646495108  E_coul = 201.53248061543337
cycle= 1 E= -526.749184034077  delta_E= 9.09e-13  |g|= 7.96e-08  |ddm|= 5.89e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2816646495108  E_coul = 201.53248061543337
  HOMO = -0.583656650485183  LUMO = 0.9965169229308
  mo_energy =
[-1.18584101e+02 -1.23132524e+01 -9.56303084e+00 -9.56303084e+00
 -9.56303084e+00 -1.27093594e+00 -5.83656650e-01 -5.83656650e-01
 -5.83656650e-01  9.96516923e-01  9.96516923e-01  9.96516923e-01
  1.00151259e+00  7.05487384e+00  7.05487384e+00  7.05487384e+00
  9.24766887e+00  3.28616870e+01  3.28616870e+01  3.28616870e+01
  4.62890311e+01  1.28610451e+02  1.28610451e+02  1.28610451e+02
  1.79496184e+02  4.83170277e+02  4.83170277e+02  4.83170277e+02
  6.84481961e+02  1.33483289e+03  1.33483289e+03  1.33483289e+03
  2.75293943e+03  3.02874723e+03  3.02874723e+03  3.02874723e+03
  6.64895949e+03  6.64895949e+03  6.64895949e+03  9.15200903e+03
  2.55027023e+04  7.62390556e+04]
E1 = -728.2816645189222  E_coul = 201.53248048484403
Extra cycle  E= -526.749184034078  delta_E= -6.82e-13  |g|= 1.64e-08  |ddm|= 1.28e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61826646e+04 7.61750307e+03 3.61736006e+03 1.59743592e+03
 3.82578972e+02 1.15059019e+02 4.11412461e+01 1.73248671e+01
 6.54766595e+00 6.90064957e-01 2.73716558e+00 2.44385998e-01
 1.36278613e+03 6.64716864e+02 3.00826139e+02 3.13925148e+02
 6.16962015e+01 7.22459748e+00 2.03403247e+01 7.66658382e-01
 2.72313218e+00 2.20248032e-01]
grad_E = [-1.56081251e-06  3.80770662e-06 -1.24435076e-06  8.75814087e-05
 -3.96598650e-04 -9.23694758e-05 -7.37024072e-04  3.20319280e-04
 -2.47132818e-04  3.59485204e-03  1.10250726e-03  3.90373648e-03
 -4.65647946e-07  5.56187202e-06  2.70150514e-05  2.32731783e-05
 -4.09968010e-04 -5.16827221e-03  2.92110386e-03  2.68836084e-03
 -8.31953823e-04 -1.11368792e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:32 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6646101        1
[INPUT] 0    0    [1    /1   ]  7617.50301418        1
[INPUT] 0    0    [1    /1   ]  3617.36008749        1
[INPUT] 0    0    [1    /1   ]  1597.43474466        1
[INPUT] 0    0    [1    /1   ]  382.579090109        1
[INPUT] 0    0    [1    /1   ]  115.083037903        1
[INPUT] 0    0    [1    /1   ]  41.1374573938        1
[INPUT] 0    0    [1    /1   ]  17.3341358285        1
[INPUT] 0    0    [1    /1   ]  6.55922422214        1
[INPUT] 0    0    [1    /1   ]  0.674657917149       1
[INPUT] 0    0    [1    /1   ]  2.73512167557        1
[INPUT] 0    0    [1    /1   ]  0.240626669835       1
[INPUT] 1    0    [1    /1   ]  1362.78614267        1
[INPUT] 1    0    [1    /1   ]  664.71677828         1
[INPUT] 1    0    [1    /1   ]  300.825733138        1
[INPUT] 1    0    [1    /1   ]  313.924798168        1
[INPUT] 1    0    [1    /1   ]  61.6983940351        1
[INPUT] 1    0    [1    /1   ]  7.23864725194        1
[INPUT] 1    0    [1    /1   ]  20.3270842252        1
[INPUT] 1    0    [1    /1   ]  0.768705313178       1
[INPUT] 1    0    [1    /1   ]  2.75010227887        1
[INPUT] 1    0    [1    /1   ]  0.220188711367       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.664610074997, 1.0]], [0, [7617.503014175763, 1.0]], [0, [3617.3600874904587, 1.0]], [0, [1597.434744663816, 1.0]], [0, [382.5790901093386, 1.0]], [0, [115.08303790259446, 1.0]], [0, [41.13745739375137, 1.0]], [0, [17.33413582852745, 1.0]], [0, [6.559224222136371, 1.0]], [0, [0.6746579171491391, 1.0]], [0, [2.73512167557104, 1.0]], [0, [0.24062666983522374, 1.0]], [1, [1362.7861426690488, 1.0]], [1, [664.7167782798074, 1.0]], [1, [300.8257331383375, 1.0]], [1, [313.9247981680971, 1.0]], [1, [61.69839403507307, 1.0]], [1, [7.238647251941194, 1.0]], [1, [20.327084225196113, 1.0]], [1, [0.7687053131782962, 1.0]], [1, [2.7501022788676828, 1.0]], [1, [0.2201887113669712, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66461007]
bas 1, expnt(s) = [7617.50301418]
bas 2, expnt(s) = [3617.36008749]
bas 3, expnt(s) = [1597.43474466]
bas 4, expnt(s) = [382.57909011]
bas 5, expnt(s) = [115.0830379]
bas 6, expnt(s) = [41.13745739]
bas 7, expnt(s) = [17.33413583]
bas 8, expnt(s) = [6.55922422]
bas 9, expnt(s) = [0.67465792]
bas 10, expnt(s) = [2.73512168]
bas 11, expnt(s) = [0.24062667]
bas 12, expnt(s) = [1362.78614267]
bas 13, expnt(s) = [664.71677828]
bas 14, expnt(s) = [300.82573314]
bas 15, expnt(s) = [313.92479817]
bas 16, expnt(s) = [61.69839404]
bas 17, expnt(s) = [7.23864725]
bas 18, expnt(s) = [20.32708423]
bas 19, expnt(s) = [0.76870531]
bas 20, expnt(s) = [2.75010228]
bas 21, expnt(s) = [0.22018871]
CPU time:       318.45
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826646e+04 5.20026417e+03 7.61750301e+03 2.06003453e+03
 3.61736009e+03 1.17844368e+03 1.59743474e+03 6.38384552e+02
 3.82579090e+02 2.18552585e+02 1.15083038e+02 8.87714906e+01
 4.11374574e+01 4.10386540e+01 1.73341358e+01 2.14630615e+01
 6.55922422e+00 1.03551020e+01 6.74657917e-01 1.88073558e+00
 2.73512168e+00 5.37337948e+00 2.40626670e-01 8.68006235e-01
 1.36278614e+03 2.41556667e+04 6.64716778e+02 9.84646165e+03
 3.00825733e+02 3.65492208e+03 3.13924798e+02 3.85492934e+03
 6.16983940e+01 5.04459979e+02 7.23864725e+00 3.46382673e+01
 2.03270842e+01 1.25915226e+02 7.68705313e-01 2.09983053e+00
 2.75010228e+00 1.03316682e+01 2.20188711e-01 4.40025864e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.9940631875309
cond(S) = 114461.7926253448
E1 = -729.5396094470649  E_coul = 203.1741210447972
init E= -526.365488402268
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.55592252168627  LUMO = 0.992566702999112
  mo_energy =
[-1.18332259e+02 -1.22070459e+01 -9.44710638e+00 -9.44710638e+00
 -9.44710638e+00 -1.24023005e+00 -5.55922522e-01 -5.55922522e-01
 -5.55922522e-01  9.92566703e-01  1.01691657e+00  1.01691657e+00
  1.01691657e+00  7.18242046e+00  7.18242046e+00  7.18242046e+00
  9.23429761e+00  3.31113474e+01  3.31113474e+01  3.31113474e+01
  4.63588170e+01  1.28903116e+02  1.28903116e+02  1.28903116e+02
  1.79677749e+02  4.83500638e+02  4.83500638e+02  4.83500638e+02
  6.84821747e+02  1.33520485e+03  1.33520485e+03  1.33520485e+03
  2.75345409e+03  3.02917677e+03  3.02917677e+03  3.02917677e+03
  6.64949475e+03  6.64949475e+03  6.64949475e+03  9.15264339e+03
  2.55034272e+04  7.62398656e+04]
E1 = -727.8220923590854  E_coul = 201.0735667519779
cycle= 1 E= -526.748525607108  delta_E= -0.383  |g|= 0.188  |ddm|= 0.336
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.565737
diis-c [-0.32005842  1.        ]
  HOMO = -0.591628949048508  LUMO = 0.964738902539808
  mo_energy =
[-1.18643165e+02 -1.23464637e+01 -9.59762004e+00 -9.59762004e+00
 -9.59762004e+00 -1.28061657e+00 -5.91628949e-01 -5.91628949e-01
 -5.91628949e-01  9.64738903e-01  9.92334346e-01  9.92334346e-01
  9.92334346e-01  7.09130925e+00  7.09130925e+00  7.09130925e+00
  9.14234996e+00  3.29551176e+01  3.29551176e+01  3.29551176e+01
  4.62029086e+01  1.28671856e+02  1.28671856e+02  1.28671856e+02
  1.79442275e+02  4.83190879e+02  4.83190879e+02  4.83190879e+02
  6.84473888e+02  1.33483833e+03  1.33483833e+03  1.33483833e+03
  2.75295498e+03  3.02874433e+03  3.02874433e+03  3.02874433e+03
  6.64894881e+03  6.64894881e+03  6.64894881e+03  9.15202297e+03
  2.55027119e+04  7.62390599e+04]
E1 = -728.4071515397421  E_coul = 201.657884018412
cycle= 2 E= -526.74926752133  delta_E= -0.000742  |g|= 0.0383  |ddm|= 0.0538
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0780496
diis-c [-0.00378751  0.07864318  0.92135682]
  HOMO = -0.582299576489066  LUMO = 0.972697769425269
  mo_energy =
[-1.18573966e+02 -1.23075075e+01 -9.55696172e+00 -9.55696172e+00
 -9.55696172e+00 -1.26945623e+00 -5.82299576e-01 -5.82299576e-01
 -5.82299576e-01  9.72697769e-01  9.99115946e-01  9.99115946e-01
  9.99115946e-01  7.11534467e+00  7.11534467e+00  7.11534467e+00
  9.16768528e+00  3.29961024e+01  3.29961024e+01  3.29961024e+01
  4.62453020e+01  1.28729063e+02  1.28729063e+02  1.28729063e+02
  1.79501086e+02  4.83259258e+02  4.83259258e+02  4.83259258e+02
  6.84544409e+02  1.33491082e+03  1.33491082e+03  1.33491082e+03
  2.75303074e+03  3.02881910e+03  3.02881910e+03  3.02881910e+03
  6.64902536e+03  6.64902536e+03  6.64902536e+03  9.15210032e+03
  2.55027899e+04  7.62391381e+04]
E1 = -728.2522567513872  E_coul = 201.502927804017
cycle= 3 E= -526.74932894737  delta_E= -6.14e-05  |g|= 0.00665  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140627
diis-c [-8.18275694e-07 -1.30827580e-03  1.48204276e-01  8.53104000e-01]
  HOMO = -0.583884137213922  LUMO = 0.971434903190294
  mo_energy =
[-1.18584489e+02 -1.23136477e+01 -9.56346612e+00 -9.56346612e+00
 -9.56346612e+00 -1.27125146e+00 -5.83884137e-01 -5.83884137e-01
 -5.83884137e-01  9.71434903e-01  9.97987888e-01  9.97987888e-01
  9.97987888e-01  7.11139664e+00  7.11139664e+00  7.11139664e+00
  9.16361585e+00  3.29895841e+01  3.29895841e+01  3.29895841e+01
  4.62386415e+01  1.28720234e+02  1.28720234e+02  1.28720234e+02
  1.79492055e+02  4.83248855e+02  4.83248855e+02  4.83248855e+02
  6.84533663e+02  1.33489979e+03  1.33489979e+03  1.33489979e+03
  2.75301907e+03  3.02880767e+03  3.02880767e+03  3.02880767e+03
  6.64901352e+03  6.64901352e+03  6.64901352e+03  9.15208826e+03
  2.55027776e+04  7.62391257e+04]
E1 = -728.2765223437342  E_coul = 201.527191239059
cycle= 4 E= -526.749331104675  delta_E= -2.16e-06  |g|= 9.83e-05  |ddm|= 0.00238
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000107089
diis-c [-5.06603876e-09  7.79640055e-05 -1.11165802e-02 -6.70162521e-02
  1.07805487e+00]
  HOMO = -0.583862388740143  LUMO = 0.971469923322616
  mo_energy =
[-1.18584430e+02 -1.23135705e+01 -9.56340198e+00 -9.56340198e+00
 -9.56340198e+00 -1.27120716e+00 -5.83862389e-01 -5.83862389e-01
 -5.83862389e-01  9.71469923e-01  9.98005850e-01  9.98005850e-01
  9.98005850e-01  7.11144612e+00  7.11144612e+00  7.11144612e+00
  9.16367967e+00  3.29896459e+01  3.29896459e+01  3.29896459e+01
  4.62387112e+01  1.28720299e+02  1.28720299e+02  1.28720299e+02
  1.79492121e+02  4.83248914e+02  4.83248914e+02  4.83248914e+02
  6.84533715e+02  1.33489984e+03  1.33489984e+03  1.33489984e+03
  2.75301910e+03  3.02880771e+03  3.02880771e+03  3.02880771e+03
  6.64901355e+03  6.64901355e+03  6.64901355e+03  9.15208828e+03
  2.55027776e+04  7.62391257e+04]
E1 = -728.2762609260133  E_coul = 201.52692981971634
cycle= 5 E= -526.749331106297  delta_E= -1.62e-09  |g|= 2.06e-05  |ddm|= 0.000154
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.91268e-05
diis-c [-8.41123439e-11  1.27507205e-05 -1.72324417e-03 -1.25302487e-02
  4.25695974e-02  9.71671145e-01]
  HOMO = -0.583870048415628  LUMO = 0.971465871687304
  mo_energy =
[-1.18584461e+02 -1.23135939e+01 -9.56342715e+00 -9.56342715e+00
 -9.56342715e+00 -1.27121350e+00 -5.83870048e-01 -5.83870048e-01
 -5.83870048e-01  9.71465872e-01  9.98000811e-01  9.98000811e-01
  9.98000811e-01  7.11142918e+00  7.11142918e+00  7.11142918e+00
  9.16366328e+00  3.29896215e+01  3.29896215e+01  3.29896215e+01
  4.62386869e+01  1.28720270e+02  1.28720270e+02  1.28720270e+02
  1.79492092e+02  4.83248883e+02  4.83248883e+02  4.83248883e+02
  6.84533684e+02  1.33489981e+03  1.33489981e+03  1.33489981e+03
  2.75301907e+03  3.02880768e+03  3.02880768e+03  3.02880768e+03
  6.64901351e+03  6.64901351e+03  6.64901351e+03  9.15208825e+03
  2.55027776e+04  7.62391257e+04]
E1 = -728.2763457655217  E_coul = 201.5270146591681
cycle= 6 E= -526.749331106354  delta_E= -5.66e-11  |g|= 1.8e-06  |ddm|= 1.78e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2763457655217  E_coul = 201.5270146591681
  HOMO = -0.583870002361738  LUMO = 0.9714662616501
  mo_energy =
[-1.18584461e+02 -1.23135935e+01 -9.56342688e+00 -9.56342688e+00
 -9.56342688e+00 -1.27121305e+00 -5.83870002e-01 -5.83870002e-01
 -5.83870002e-01  9.71466262e-01  9.98000901e-01  9.98000901e-01
  9.98000901e-01  7.11142937e+00  7.11142937e+00  7.11142937e+00
  9.16366363e+00  3.29896218e+01  3.29896218e+01  3.29896218e+01
  4.62386872e+01  1.28720270e+02  1.28720270e+02  1.28720270e+02
  1.79492092e+02  4.83248883e+02  4.83248883e+02  4.83248883e+02
  6.84533684e+02  1.33489981e+03  1.33489981e+03  1.33489981e+03
  2.75301907e+03  3.02880768e+03  3.02880768e+03  3.02880768e+03
  6.64901351e+03  6.64901351e+03  6.64901351e+03  9.15208825e+03
  2.55027776e+04  7.62391257e+04]
E1 = -728.276344011256  E_coul = 201.52701290490091
Extra cycle  E= -526.749331106355  delta_E= -1.59e-12  |g|= 3.71e-07  |ddm|= 3.13e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826646e+04 7.61750301e+03 3.61736009e+03 1.59743474e+03
 3.82579090e+02 1.15083038e+02 4.11374574e+01 1.73341358e+01
 6.55922422e+00 6.74657917e-01 2.73512168e+00 2.40626670e-01
 1.36278614e+03 6.64716778e+02 3.00825733e+02 3.13924798e+02
 6.16983940e+01 7.23864725e+00 2.03270842e+01 7.68705313e-01
 2.75010228e+00 2.20188711e-01]
E = -526.7493311063552
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:33 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6646101        1
[INPUT] 0    0    [1    /1   ]  7617.50301418        1
[INPUT] 0    0    [1    /1   ]  3617.36008749        1
[INPUT] 0    0    [1    /1   ]  1597.43474466        1
[INPUT] 0    0    [1    /1   ]  382.579090109        1
[INPUT] 0    0    [1    /1   ]  115.083037903        1
[INPUT] 0    0    [1    /1   ]  41.1374573938        1
[INPUT] 0    0    [1    /1   ]  17.3341358285        1
[INPUT] 0    0    [1    /1   ]  6.55922422214        1
[INPUT] 0    0    [1    /1   ]  0.674657917149       1
[INPUT] 0    0    [1    /1   ]  2.73512167557        1
[INPUT] 0    0    [1    /1   ]  0.240626669835       1
[INPUT] 1    0    [1    /1   ]  1362.78614267        1
[INPUT] 1    0    [1    /1   ]  664.71677828         1
[INPUT] 1    0    [1    /1   ]  300.825733138        1
[INPUT] 1    0    [1    /1   ]  313.924798168        1
[INPUT] 1    0    [1    /1   ]  61.6983940351        1
[INPUT] 1    0    [1    /1   ]  7.23864725194        1
[INPUT] 1    0    [1    /1   ]  20.3270842252        1
[INPUT] 1    0    [1    /1   ]  0.768705313178       1
[INPUT] 1    0    [1    /1   ]  2.75010227887        1
[INPUT] 1    0    [1    /1   ]  0.220188711367       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.664610074997, 1.0]], [0, [7617.503014175763, 1.0]], [0, [3617.3600874904587, 1.0]], [0, [1597.434744663816, 1.0]], [0, [382.5790901093386, 1.0]], [0, [115.08303790259446, 1.0]], [0, [41.13745739375137, 1.0]], [0, [17.33413582852745, 1.0]], [0, [6.559224222136371, 1.0]], [0, [0.6746579171491391, 1.0]], [0, [2.73512167557104, 1.0]], [0, [0.24062666983522374, 1.0]], [1, [1362.7861426690488, 1.0]], [1, [664.7167782798074, 1.0]], [1, [300.8257331383375, 1.0]], [1, [313.9247981680971, 1.0]], [1, [61.69839403507307, 1.0]], [1, [7.238647251941194, 1.0]], [1, [20.327084225196113, 1.0]], [1, [0.7687053131782962, 1.0]], [1, [2.7501022788676828, 1.0]], [1, [0.2201887113669712, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66461007]
bas 1, expnt(s) = [7617.50301418]
bas 2, expnt(s) = [3617.36008749]
bas 3, expnt(s) = [1597.43474466]
bas 4, expnt(s) = [382.57909011]
bas 5, expnt(s) = [115.0830379]
bas 6, expnt(s) = [41.13745739]
bas 7, expnt(s) = [17.33413583]
bas 8, expnt(s) = [6.55922422]
bas 9, expnt(s) = [0.67465792]
bas 10, expnt(s) = [2.73512168]
bas 11, expnt(s) = [0.24062667]
bas 12, expnt(s) = [1362.78614267]
bas 13, expnt(s) = [664.71677828]
bas 14, expnt(s) = [300.82573314]
bas 15, expnt(s) = [313.92479817]
bas 16, expnt(s) = [61.69839404]
bas 17, expnt(s) = [7.23864725]
bas 18, expnt(s) = [20.32708423]
bas 19, expnt(s) = [0.76870531]
bas 20, expnt(s) = [2.75010228]
bas 21, expnt(s) = [0.22018871]
CPU time:       318.90
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826646e+04 5.20026417e+03 7.61750301e+03 2.06003453e+03
 3.61736009e+03 1.17844368e+03 1.59743474e+03 6.38384552e+02
 3.82579090e+02 2.18552585e+02 1.15083038e+02 8.87714906e+01
 4.11374574e+01 4.10386540e+01 1.73341358e+01 2.14630615e+01
 6.55922422e+00 1.03551020e+01 6.74657917e-01 1.88073558e+00
 2.73512168e+00 5.37337948e+00 2.40626670e-01 8.68006235e-01
 1.36278614e+03 2.41556667e+04 6.64716778e+02 9.84646165e+03
 3.00825733e+02 3.65492208e+03 3.13924798e+02 3.85492934e+03
 6.16983940e+01 5.04459979e+02 7.23864725e+00 3.46382673e+01
 2.03270842e+01 1.25915226e+02 7.68705313e-01 2.09983053e+00
 2.75010228e+00 1.03316682e+01 2.20188711e-01 4.40025864e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.9940631875309
cond(S) = 114461.7926253448
E1 = -729.5396094470649  E_coul = 203.1741210447972
init E= -526.365488402268
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.55592252168627  LUMO = 0.992566702999112
  mo_energy =
[-1.18332259e+02 -1.22070459e+01 -9.44710638e+00 -9.44710638e+00
 -9.44710638e+00 -1.24023005e+00 -5.55922522e-01 -5.55922522e-01
 -5.55922522e-01  9.92566703e-01  1.01691657e+00  1.01691657e+00
  1.01691657e+00  7.18242046e+00  7.18242046e+00  7.18242046e+00
  9.23429761e+00  3.31113474e+01  3.31113474e+01  3.31113474e+01
  4.63588170e+01  1.28903116e+02  1.28903116e+02  1.28903116e+02
  1.79677749e+02  4.83500638e+02  4.83500638e+02  4.83500638e+02
  6.84821747e+02  1.33520485e+03  1.33520485e+03  1.33520485e+03
  2.75345409e+03  3.02917677e+03  3.02917677e+03  3.02917677e+03
  6.64949475e+03  6.64949475e+03  6.64949475e+03  9.15264339e+03
  2.55034272e+04  7.62398656e+04]
E1 = -727.8220923590854  E_coul = 201.0735667519779
cycle= 1 E= -526.748525607108  delta_E= -0.383  |g|= 0.188  |ddm|= 0.336
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.565737
diis-c [-0.32005842  1.        ]
  HOMO = -0.591628949048508  LUMO = 0.964738902539808
  mo_energy =
[-1.18643165e+02 -1.23464637e+01 -9.59762004e+00 -9.59762004e+00
 -9.59762004e+00 -1.28061657e+00 -5.91628949e-01 -5.91628949e-01
 -5.91628949e-01  9.64738903e-01  9.92334346e-01  9.92334346e-01
  9.92334346e-01  7.09130925e+00  7.09130925e+00  7.09130925e+00
  9.14234996e+00  3.29551176e+01  3.29551176e+01  3.29551176e+01
  4.62029086e+01  1.28671856e+02  1.28671856e+02  1.28671856e+02
  1.79442275e+02  4.83190879e+02  4.83190879e+02  4.83190879e+02
  6.84473888e+02  1.33483833e+03  1.33483833e+03  1.33483833e+03
  2.75295498e+03  3.02874433e+03  3.02874433e+03  3.02874433e+03
  6.64894881e+03  6.64894881e+03  6.64894881e+03  9.15202297e+03
  2.55027119e+04  7.62390599e+04]
E1 = -728.4071515397421  E_coul = 201.657884018412
cycle= 2 E= -526.74926752133  delta_E= -0.000742  |g|= 0.0383  |ddm|= 0.0538
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0780496
diis-c [-0.00378751  0.07864318  0.92135682]
  HOMO = -0.582299576489066  LUMO = 0.972697769425269
  mo_energy =
[-1.18573966e+02 -1.23075075e+01 -9.55696172e+00 -9.55696172e+00
 -9.55696172e+00 -1.26945623e+00 -5.82299576e-01 -5.82299576e-01
 -5.82299576e-01  9.72697769e-01  9.99115946e-01  9.99115946e-01
  9.99115946e-01  7.11534467e+00  7.11534467e+00  7.11534467e+00
  9.16768528e+00  3.29961024e+01  3.29961024e+01  3.29961024e+01
  4.62453020e+01  1.28729063e+02  1.28729063e+02  1.28729063e+02
  1.79501086e+02  4.83259258e+02  4.83259258e+02  4.83259258e+02
  6.84544409e+02  1.33491082e+03  1.33491082e+03  1.33491082e+03
  2.75303074e+03  3.02881910e+03  3.02881910e+03  3.02881910e+03
  6.64902536e+03  6.64902536e+03  6.64902536e+03  9.15210032e+03
  2.55027899e+04  7.62391381e+04]
E1 = -728.2522567513872  E_coul = 201.502927804017
cycle= 3 E= -526.74932894737  delta_E= -6.14e-05  |g|= 0.00665  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140627
diis-c [-8.18275694e-07 -1.30827580e-03  1.48204276e-01  8.53104000e-01]
  HOMO = -0.583884137213922  LUMO = 0.971434903190294
  mo_energy =
[-1.18584489e+02 -1.23136477e+01 -9.56346612e+00 -9.56346612e+00
 -9.56346612e+00 -1.27125146e+00 -5.83884137e-01 -5.83884137e-01
 -5.83884137e-01  9.71434903e-01  9.97987888e-01  9.97987888e-01
  9.97987888e-01  7.11139664e+00  7.11139664e+00  7.11139664e+00
  9.16361585e+00  3.29895841e+01  3.29895841e+01  3.29895841e+01
  4.62386415e+01  1.28720234e+02  1.28720234e+02  1.28720234e+02
  1.79492055e+02  4.83248855e+02  4.83248855e+02  4.83248855e+02
  6.84533663e+02  1.33489979e+03  1.33489979e+03  1.33489979e+03
  2.75301907e+03  3.02880767e+03  3.02880767e+03  3.02880767e+03
  6.64901352e+03  6.64901352e+03  6.64901352e+03  9.15208826e+03
  2.55027776e+04  7.62391257e+04]
E1 = -728.2765223437342  E_coul = 201.527191239059
cycle= 4 E= -526.749331104675  delta_E= -2.16e-06  |g|= 9.83e-05  |ddm|= 0.00238
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000107089
diis-c [-5.06603876e-09  7.79640055e-05 -1.11165802e-02 -6.70162521e-02
  1.07805487e+00]
  HOMO = -0.583862388740143  LUMO = 0.971469923322616
  mo_energy =
[-1.18584430e+02 -1.23135705e+01 -9.56340198e+00 -9.56340198e+00
 -9.56340198e+00 -1.27120716e+00 -5.83862389e-01 -5.83862389e-01
 -5.83862389e-01  9.71469923e-01  9.98005850e-01  9.98005850e-01
  9.98005850e-01  7.11144612e+00  7.11144612e+00  7.11144612e+00
  9.16367967e+00  3.29896459e+01  3.29896459e+01  3.29896459e+01
  4.62387112e+01  1.28720299e+02  1.28720299e+02  1.28720299e+02
  1.79492121e+02  4.83248914e+02  4.83248914e+02  4.83248914e+02
  6.84533715e+02  1.33489984e+03  1.33489984e+03  1.33489984e+03
  2.75301910e+03  3.02880771e+03  3.02880771e+03  3.02880771e+03
  6.64901355e+03  6.64901355e+03  6.64901355e+03  9.15208828e+03
  2.55027776e+04  7.62391257e+04]
E1 = -728.2762609260133  E_coul = 201.52692981971634
cycle= 5 E= -526.749331106297  delta_E= -1.62e-09  |g|= 2.06e-05  |ddm|= 0.000154
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.91268e-05
diis-c [-8.41123439e-11  1.27507205e-05 -1.72324417e-03 -1.25302487e-02
  4.25695974e-02  9.71671145e-01]
  HOMO = -0.583870048415628  LUMO = 0.971465871687304
  mo_energy =
[-1.18584461e+02 -1.23135939e+01 -9.56342715e+00 -9.56342715e+00
 -9.56342715e+00 -1.27121350e+00 -5.83870048e-01 -5.83870048e-01
 -5.83870048e-01  9.71465872e-01  9.98000811e-01  9.98000811e-01
  9.98000811e-01  7.11142918e+00  7.11142918e+00  7.11142918e+00
  9.16366328e+00  3.29896215e+01  3.29896215e+01  3.29896215e+01
  4.62386869e+01  1.28720270e+02  1.28720270e+02  1.28720270e+02
  1.79492092e+02  4.83248883e+02  4.83248883e+02  4.83248883e+02
  6.84533684e+02  1.33489981e+03  1.33489981e+03  1.33489981e+03
  2.75301907e+03  3.02880768e+03  3.02880768e+03  3.02880768e+03
  6.64901351e+03  6.64901351e+03  6.64901351e+03  9.15208825e+03
  2.55027776e+04  7.62391257e+04]
E1 = -728.2763457655217  E_coul = 201.5270146591681
cycle= 6 E= -526.749331106354  delta_E= -5.66e-11  |g|= 1.8e-06  |ddm|= 1.78e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2763457655217  E_coul = 201.5270146591681
  HOMO = -0.583870002361738  LUMO = 0.9714662616501
  mo_energy =
[-1.18584461e+02 -1.23135935e+01 -9.56342688e+00 -9.56342688e+00
 -9.56342688e+00 -1.27121305e+00 -5.83870002e-01 -5.83870002e-01
 -5.83870002e-01  9.71466262e-01  9.98000901e-01  9.98000901e-01
  9.98000901e-01  7.11142937e+00  7.11142937e+00  7.11142937e+00
  9.16366363e+00  3.29896218e+01  3.29896218e+01  3.29896218e+01
  4.62386872e+01  1.28720270e+02  1.28720270e+02  1.28720270e+02
  1.79492092e+02  4.83248883e+02  4.83248883e+02  4.83248883e+02
  6.84533684e+02  1.33489981e+03  1.33489981e+03  1.33489981e+03
  2.75301907e+03  3.02880768e+03  3.02880768e+03  3.02880768e+03
  6.64901351e+03  6.64901351e+03  6.64901351e+03  9.15208825e+03
  2.55027776e+04  7.62391257e+04]
E1 = -728.276344011256  E_coul = 201.52701290490091
Extra cycle  E= -526.749331106355  delta_E= -1.59e-12  |g|= 3.71e-07  |ddm|= 3.13e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114461.7926253448
E1 = -728.276344011256  E_coul = 201.52701290490091
init E= -526.749331106355
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583870049257998  LUMO = 0.971466295223116
  mo_energy =
[-1.18584461e+02 -1.23135936e+01 -9.56342703e+00 -9.56342703e+00
 -9.56342703e+00 -1.27121302e+00 -5.83870049e-01 -5.83870049e-01
 -5.83870049e-01  9.71466295e-01  9.98000880e-01  9.98000880e-01
  9.98000880e-01  7.11142928e+00  7.11142928e+00  7.11142928e+00
  9.16366357e+00  3.29896217e+01  3.29896217e+01  3.29896217e+01
  4.62386871e+01  1.28720270e+02  1.28720270e+02  1.28720270e+02
  1.79492092e+02  4.83248883e+02  4.83248883e+02  4.83248883e+02
  6.84533684e+02  1.33489981e+03  1.33489981e+03  1.33489981e+03
  2.75301907e+03  3.02880768e+03  3.02880768e+03  3.02880768e+03
  6.64901351e+03  6.64901351e+03  6.64901351e+03  9.15208825e+03
  2.55027776e+04  7.62391257e+04]
E1 = -728.2763443914632  E_coul = 201.52701328510892
cycle= 1 E= -526.749331106354  delta_E= 9.09e-13  |g|= 8.06e-08  |ddm|= 6.01e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2763443914632  E_coul = 201.52701328510892
  HOMO = -0.583870044594895  LUMO = 0.971466313833763
  mo_energy =
[-1.18584461e+02 -1.23135936e+01 -9.56342701e+00 -9.56342701e+00
 -9.56342701e+00 -1.27121300e+00 -5.83870045e-01 -5.83870045e-01
 -5.83870045e-01  9.71466314e-01  9.98000885e-01  9.98000885e-01
  9.98000885e-01  7.11142929e+00  7.11142929e+00  7.11142929e+00
  9.16366360e+00  3.29896217e+01  3.29896217e+01  3.29896217e+01
  4.62386871e+01  1.28720270e+02  1.28720270e+02  1.28720270e+02
  1.79492092e+02  4.83248883e+02  4.83248883e+02  4.83248883e+02
  6.84533684e+02  1.33489981e+03  1.33489981e+03  1.33489981e+03
  2.75301907e+03  3.02880768e+03  3.02880768e+03  3.02880768e+03
  6.64901351e+03  6.64901351e+03  6.64901351e+03  9.15208825e+03
  2.55027776e+04  7.62391257e+04]
E1 = -728.2763442598729  E_coul = 201.52701315351774
Extra cycle  E= -526.749331106355  delta_E= -9.09e-13  |g|= 1.66e-08  |ddm|= 1.31e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826646e+04 7.61750301e+03 3.61736009e+03 1.59743474e+03
 3.82579090e+02 1.15083038e+02 4.11374574e+01 1.73341358e+01
 6.55922422e+00 6.74657917e-01 2.73512168e+00 2.40626670e-01
 1.36278614e+03 6.64716778e+02 3.00825733e+02 3.13924798e+02
 6.16983940e+01 7.23864725e+00 2.03270842e+01 7.68705313e-01
 2.75010228e+00 2.20188711e-01]
grad_E = [-1.56119286e-06  3.81240699e-06 -1.24064345e-06  8.77590537e-05
 -4.01002052e-04 -6.96229691e-05 -7.74649038e-04  3.24358886e-04
 -2.37732145e-05  1.04293056e-03  5.05303246e-04  7.29272103e-03
 -4.68687388e-07  5.52380983e-06  2.67900127e-05  2.30788338e-05
 -3.94031528e-04 -6.56597059e-03  2.96343951e-03  6.75207123e-03
  2.40294492e-03 -2.53383347e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:37 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6647601        1
[INPUT] 0    0    [1    /1   ]  7617.50268507        1
[INPUT] 0    0    [1    /1   ]  3617.36024104        1
[INPUT] 0    0    [1    /1   ]  1597.42783521        1
[INPUT] 0    0    [1    /1   ]  382.579481662        1
[INPUT] 0    0    [1    /1   ]  115.194317644        1
[INPUT] 0    0    [1    /1   ]  41.2267306593        1
[INPUT] 0    0    [1    /1   ]  17.471180504         1
[INPUT] 0    0    [1    /1   ]  6.5833167871         1
[INPUT] 0    0    [1    /1   ]  0.656166592266       1
[INPUT] 0    0    [1    /1   ]  2.74092202366        1
[INPUT] 0    0    [1    /1   ]  0.235405596558       1
[INPUT] 1    0    [1    /1   ]  1362.78619253        1
[INPUT] 1    0    [1    /1   ]  664.716280847        1
[INPUT] 1    0    [1    /1   ]  300.82338239         1
[INPUT] 1    0    [1    /1   ]  313.922771635        1
[INPUT] 1    0    [1    /1   ]  61.7025616938        1
[INPUT] 1    0    [1    /1   ]  7.26318586971        1
[INPUT] 1    0    [1    /1   ]  20.3082669233        1
[INPUT] 1    0    [1    /1   ]  0.771309317026       1
[INPUT] 1    0    [1    /1   ]  2.77845970878        1
[INPUT] 1    0    [1    /1   ]  0.22057671943        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.664760137006, 1.0]], [0, [7617.502685073402, 1.0]], [0, [3617.3602410361937, 1.0]], [0, [1597.4278352051529, 1.0]], [0, [382.57948166203107, 1.0]], [0, [115.19431764405051, 1.0]], [0, [41.22673065932177, 1.0]], [0, [17.47118050403442, 1.0]], [0, [6.583316787098961, 1.0]], [0, [0.6561665922661165, 1.0]], [0, [2.740922023658557, 1.0]], [0, [0.235405596557673, 1.0]], [1, [1362.7861925271698, 1.0]], [1, [664.716280846943, 1.0]], [1, [300.82338238982095, 1.0]], [1, [313.9227716347857, 1.0]], [1, [61.70256169375693, 1.0]], [1, [7.263185869712267, 1.0]], [1, [20.308266923315912, 1.0]], [1, [0.7713093170262066, 1.0]], [1, [2.7784597087776586, 1.0]], [1, [0.22057671942993262, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66476014]
bas 1, expnt(s) = [7617.50268507]
bas 2, expnt(s) = [3617.36024104]
bas 3, expnt(s) = [1597.42783521]
bas 4, expnt(s) = [382.57948166]
bas 5, expnt(s) = [115.19431764]
bas 6, expnt(s) = [41.22673066]
bas 7, expnt(s) = [17.4711805]
bas 8, expnt(s) = [6.58331679]
bas 9, expnt(s) = [0.65616659]
bas 10, expnt(s) = [2.74092202]
bas 11, expnt(s) = [0.2354056]
bas 12, expnt(s) = [1362.78619253]
bas 13, expnt(s) = [664.71628085]
bas 14, expnt(s) = [300.82338239]
bas 15, expnt(s) = [313.92277163]
bas 16, expnt(s) = [61.70256169]
bas 17, expnt(s) = [7.26318587]
bas 18, expnt(s) = [20.30826692]
bas 19, expnt(s) = [0.77130932]
bas 20, expnt(s) = [2.77845971]
bas 21, expnt(s) = [0.22057672]
CPU time:       324.72
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826648e+04 5.20026419e+03 7.61750269e+03 2.06003446e+03
 3.61736024e+03 1.17844372e+03 1.59742784e+03 6.38382481e+02
 3.82579482e+02 2.18552752e+02 1.15194318e+02 8.88358612e+01
 4.12267307e+01 4.11054301e+01 1.74711805e+01 2.15902023e+01
 6.58331679e+00 1.03836153e+01 6.56166592e-01 1.84194056e+00
 2.74092202e+00 5.38192368e+00 2.35405597e-01 8.53842193e-01
 1.36278619e+03 2.41556678e+04 6.64716281e+02 9.84645244e+03
 3.00823382e+02 3.65488638e+03 3.13922772e+02 3.85489824e+03
 6.17025617e+01 5.04502574e+02 7.26318587e+00 3.47851067e+01
 2.03082669e+01 1.25769540e+02 7.71309317e-01 2.10872581e+00
 2.77845971e+00 1.04650070e+01 2.20576719e-01 4.40995324e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994023770183095
cond(S) = 114387.9817076312
E1 = -729.539275217066  E_coul = 203.1737312901139
init E= -526.365543926952
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555920908183839  LUMO = 0.954510338832676
  mo_energy =
[-1.18332296e+02 -1.22070582e+01 -9.44717097e+00 -9.44717097e+00
 -9.44717097e+00 -1.24027496e+00 -5.55920908e-01 -5.55920908e-01
 -5.55920908e-01  9.54510339e-01  1.02080534e+00  1.02080534e+00
  1.02080534e+00  7.24892862e+00  7.24892862e+00  7.24892862e+00
  9.16015368e+00  3.32689717e+01  3.32689717e+01  3.32689717e+01
  4.65397092e+01  1.29043569e+02  1.29043569e+02  1.29043569e+02
  1.80391380e+02  4.83602737e+02  4.83602737e+02  4.83602737e+02
  6.85988181e+02  1.33528921e+03  1.33528921e+03  1.33528921e+03
  2.75470670e+03  3.02924816e+03  3.02924816e+03  3.02924816e+03
  6.64955460e+03  6.64955460e+03  6.64955460e+03  9.15382972e+03
  2.55045523e+04  7.62409134e+04]
E1 = -727.8202592256972  E_coul = 201.07155851488113
cycle= 1 E= -526.748700710816  delta_E= -0.383  |g|= 0.188  |ddm|= 0.333
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.566354
diis-c [-0.32075722  1.        ]
  HOMO = -0.591688250230623  LUMO = 0.927496863276232
  mo_energy =
[-1.18643300e+02 -1.23465924e+01 -9.59781237e+00 -9.59781237e+00
 -9.59781237e+00 -1.28069060e+00 -5.91688250e-01 -5.91688250e-01
 -5.91688250e-01  9.27496863e-01  9.96051431e-01  9.96051431e-01
  9.96051431e-01  7.15726931e+00  7.15726931e+00  7.15726931e+00
  9.06806096e+00  3.31126084e+01  3.31126084e+01  3.31126084e+01
  4.63833248e+01  1.28812266e+02  1.28812266e+02  1.28812266e+02
  1.80155618e+02  4.83292906e+02  4.83292906e+02  4.83292906e+02
  6.85640191e+02  1.33492258e+03  1.33492258e+03  1.33492258e+03
  2.75420751e+03  3.02881563e+03  3.02881563e+03  3.02881563e+03
  6.64900857e+03  6.64900857e+03  6.64900857e+03  9.15320920e+03
  2.55038369e+04  7.62401076e+04]
E1 = -728.4054041527804  E_coul = 201.6559606544588
cycle= 2 E= -526.749443498322  delta_E= -0.000743  |g|= 0.0383  |ddm|= 0.0539
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0780946
diis-c [-0.00379181  0.07860648  0.92139352]
  HOMO = -0.582351092529399  LUMO = 0.935242496216805
  mo_energy =
[-1.18574102e+02 -1.23076284e+01 -9.55715004e+00 -9.55715004e+00
 -9.55715004e+00 -1.26952227e+00 -5.82351093e-01 -5.82351093e-01
 -5.82351093e-01  9.35242496e-01  1.00287310e+00  1.00287310e+00
  1.00287310e+00  7.18142878e+00  7.18142878e+00  7.18142878e+00
  9.09344394e+00  3.31536083e+01  3.31536083e+01  3.31536083e+01
  4.64258240e+01  1.28869464e+02  1.28869464e+02  1.28869464e+02
  1.80214469e+02  4.83361281e+02  4.83361281e+02  4.83361281e+02
  6.85710710e+02  1.33499506e+03  1.33499506e+03  1.33499506e+03
  2.75428326e+03  3.02889039e+03  3.02889039e+03  3.02889039e+03
  6.64908511e+03  6.64908511e+03  6.64908511e+03  9.15328654e+03
  2.55039148e+04  7.62401858e+04]
E1 = -728.2506479479895  E_coul = 201.5011430906745
cycle= 3 E= -526.749504857315  delta_E= -6.14e-05  |g|= 0.00664  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140671
diis-c [-8.23224572e-07 -1.30888099e-03  1.48163298e-01  8.53145583e-01]
  HOMO = -0.583934337744869  LUMO = 0.934017396555586
  mo_energy =
[-1.18584615e+02 -1.23137607e+01 -9.56364681e+00 -9.56364681e+00
 -9.56364681e+00 -1.27131408e+00 -5.83934338e-01 -5.83934338e-01
 -5.83934338e-01  9.34017397e-01  1.00174035e+00  1.00174035e+00
  1.00174035e+00  7.17746728e+00  7.17746728e+00  7.17746728e+00
  9.08937635e+00  3.31470961e+01  3.31470961e+01  3.31470961e+01
  4.64191573e+01  1.28860647e+02  1.28860647e+02  1.28860647e+02
  1.80205442e+02  4.83350889e+02  4.83350889e+02  4.83350889e+02
  6.85699975e+02  1.33498405e+03  1.33498405e+03  1.33498405e+03
  2.75427160e+03  3.02887898e+03  3.02887898e+03  3.02887898e+03
  6.64907328e+03  6.64907328e+03  6.64907328e+03  9.15327450e+03
  2.55039026e+04  7.62401734e+04]
E1 = -728.2748528363147  E_coul = 201.5253458294478
cycle= 4 E= -526.749507006867  delta_E= -2.15e-06  |g|= 9.93e-05  |ddm|= 0.00237
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000109764
diis-c [-5.05984404e-09  8.01497380e-05 -1.13920806e-02 -6.88956260e-02
  1.08020756e+00]
  HOMO = -0.583913385357545  LUMO = 0.934051329154548
  mo_energy =
[-1.18584558e+02 -1.23136855e+01 -9.56358495e+00 -9.56358495e+00
 -9.56358495e+00 -1.27127025e+00 -5.83913385e-01 -5.83913385e-01
 -5.83913385e-01  9.34051329e-01  1.00175786e+00  1.00175786e+00
  1.00175786e+00  7.17751536e+00  7.17751536e+00  7.17751536e+00
  9.08943898e+00  3.31471558e+01  3.31471558e+01  3.31471558e+01
  4.64192249e+01  1.28860709e+02  1.28860709e+02  1.28860709e+02
  1.80205505e+02  4.83350946e+02  4.83350946e+02  4.83350946e+02
  6.85700024e+02  1.33498410e+03  1.33498410e+03  1.33498410e+03
  2.75427163e+03  3.02887901e+03  3.02887901e+03  3.02887901e+03
  6.64907330e+03  6.64907330e+03  6.64907330e+03  9.15327452e+03
  2.55039026e+04  7.62401734e+04]
E1 = -728.2745968345832  E_coul = 201.5250898260301
cycle= 5 E= -526.749507008553  delta_E= -1.69e-09  |g|= 2.06e-05  |ddm|= 0.000157
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.90268e-05
diis-c [-8.66774709e-11  1.27596275e-05 -1.72289336e-03 -1.25311577e-02
  4.18727461e-02  9.72368545e-01]
  HOMO = -0.583921097851531  LUMO = 0.934047397188604
  mo_energy =
[-1.18584590e+02 -1.23137089e+01 -9.56361017e+00 -9.56361017e+00
 -9.56361017e+00 -1.27127660e+00 -5.83921098e-01 -5.83921098e-01
 -5.83921098e-01  9.34047397e-01  1.00175277e+00  1.00175277e+00
  1.00175277e+00  7.17749830e+00  7.17749830e+00  7.17749830e+00
  9.08942254e+00  3.31471314e+01  3.31471314e+01  3.31471314e+01
  4.64192005e+01  1.28860680e+02  1.28860680e+02  1.28860680e+02
  1.80205476e+02  4.83350915e+02  4.83350915e+02  4.83350915e+02
  6.85699993e+02  1.33498407e+03  1.33498407e+03  1.33498407e+03
  2.75427159e+03  3.02887898e+03  3.02887898e+03  3.02887898e+03
  6.64907327e+03  6.64907327e+03  6.64907327e+03  9.15327448e+03
  2.55039026e+04  7.62401734e+04]
E1 = -728.2746812742654  E_coul = 201.52517426565439
cycle= 6 E= -526.749507008611  delta_E= -5.79e-11  |g|= 1.82e-06  |ddm|= 1.82e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2746812742654  E_coul = 201.52517426565439
  HOMO = -0.583921046999145  LUMO = 0.934047787977166
  mo_energy =
[-1.18584589e+02 -1.23137085e+01 -9.56360986e+00 -9.56360986e+00
 -9.56360986e+00 -1.27127614e+00 -5.83921047e-01 -5.83921047e-01
 -5.83921047e-01  9.34047788e-01  1.00175286e+00  1.00175286e+00
  1.00175286e+00  7.17749851e+00  7.17749851e+00  7.17749851e+00
  9.08942292e+00  3.31471317e+01  3.31471317e+01  3.31471317e+01
  4.64192009e+01  1.28860680e+02  1.28860680e+02  1.28860680e+02
  1.80205477e+02  4.83350915e+02  4.83350915e+02  4.83350915e+02
  6.85699993e+02  1.33498407e+03  1.33498407e+03  1.33498407e+03
  2.75427160e+03  3.02887898e+03  3.02887898e+03  3.02887898e+03
  6.64907327e+03  6.64907327e+03  6.64907327e+03  9.15327448e+03
  2.55039026e+04  7.62401734e+04]
E1 = -728.2746792962241  E_coul = 201.52517228761178
Extra cycle  E= -526.749507008612  delta_E= -1.36e-12  |g|= 3.78e-07  |ddm|= 3.21e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826648e+04 7.61750269e+03 3.61736024e+03 1.59742784e+03
 3.82579482e+02 1.15194318e+02 4.12267307e+01 1.74711805e+01
 6.58331679e+00 6.56166592e-01 2.74092202e+00 2.35405597e-01
 1.36278619e+03 6.64716281e+02 3.00823382e+02 3.13922772e+02
 6.17025617e+01 7.26318587e+00 2.03082669e+01 7.71309317e-01
 2.77845971e+00 2.20576719e-01]
E = -526.7495070086123
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:38 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6647601        1
[INPUT] 0    0    [1    /1   ]  7617.50268507        1
[INPUT] 0    0    [1    /1   ]  3617.36024104        1
[INPUT] 0    0    [1    /1   ]  1597.42783521        1
[INPUT] 0    0    [1    /1   ]  382.579481662        1
[INPUT] 0    0    [1    /1   ]  115.194317644        1
[INPUT] 0    0    [1    /1   ]  41.2267306593        1
[INPUT] 0    0    [1    /1   ]  17.471180504         1
[INPUT] 0    0    [1    /1   ]  6.5833167871         1
[INPUT] 0    0    [1    /1   ]  0.656166592266       1
[INPUT] 0    0    [1    /1   ]  2.74092202366        1
[INPUT] 0    0    [1    /1   ]  0.235405596558       1
[INPUT] 1    0    [1    /1   ]  1362.78619253        1
[INPUT] 1    0    [1    /1   ]  664.716280847        1
[INPUT] 1    0    [1    /1   ]  300.82338239         1
[INPUT] 1    0    [1    /1   ]  313.922771635        1
[INPUT] 1    0    [1    /1   ]  61.7025616938        1
[INPUT] 1    0    [1    /1   ]  7.26318586971        1
[INPUT] 1    0    [1    /1   ]  20.3082669233        1
[INPUT] 1    0    [1    /1   ]  0.771309317026       1
[INPUT] 1    0    [1    /1   ]  2.77845970878        1
[INPUT] 1    0    [1    /1   ]  0.22057671943        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.664760137006, 1.0]], [0, [7617.502685073402, 1.0]], [0, [3617.3602410361937, 1.0]], [0, [1597.4278352051529, 1.0]], [0, [382.57948166203107, 1.0]], [0, [115.19431764405051, 1.0]], [0, [41.22673065932177, 1.0]], [0, [17.47118050403442, 1.0]], [0, [6.583316787098961, 1.0]], [0, [0.6561665922661165, 1.0]], [0, [2.740922023658557, 1.0]], [0, [0.235405596557673, 1.0]], [1, [1362.7861925271698, 1.0]], [1, [664.716280846943, 1.0]], [1, [300.82338238982095, 1.0]], [1, [313.9227716347857, 1.0]], [1, [61.70256169375693, 1.0]], [1, [7.263185869712267, 1.0]], [1, [20.308266923315912, 1.0]], [1, [0.7713093170262066, 1.0]], [1, [2.7784597087776586, 1.0]], [1, [0.22057671942993262, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66476014]
bas 1, expnt(s) = [7617.50268507]
bas 2, expnt(s) = [3617.36024104]
bas 3, expnt(s) = [1597.42783521]
bas 4, expnt(s) = [382.57948166]
bas 5, expnt(s) = [115.19431764]
bas 6, expnt(s) = [41.22673066]
bas 7, expnt(s) = [17.4711805]
bas 8, expnt(s) = [6.58331679]
bas 9, expnt(s) = [0.65616659]
bas 10, expnt(s) = [2.74092202]
bas 11, expnt(s) = [0.2354056]
bas 12, expnt(s) = [1362.78619253]
bas 13, expnt(s) = [664.71628085]
bas 14, expnt(s) = [300.82338239]
bas 15, expnt(s) = [313.92277163]
bas 16, expnt(s) = [61.70256169]
bas 17, expnt(s) = [7.26318587]
bas 18, expnt(s) = [20.30826692]
bas 19, expnt(s) = [0.77130932]
bas 20, expnt(s) = [2.77845971]
bas 21, expnt(s) = [0.22057672]
CPU time:       325.18
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826648e+04 5.20026419e+03 7.61750269e+03 2.06003446e+03
 3.61736024e+03 1.17844372e+03 1.59742784e+03 6.38382481e+02
 3.82579482e+02 2.18552752e+02 1.15194318e+02 8.88358612e+01
 4.12267307e+01 4.11054301e+01 1.74711805e+01 2.15902023e+01
 6.58331679e+00 1.03836153e+01 6.56166592e-01 1.84194056e+00
 2.74092202e+00 5.38192368e+00 2.35405597e-01 8.53842193e-01
 1.36278619e+03 2.41556678e+04 6.64716281e+02 9.84645244e+03
 3.00823382e+02 3.65488638e+03 3.13922772e+02 3.85489824e+03
 6.17025617e+01 5.04502574e+02 7.26318587e+00 3.47851067e+01
 2.03082669e+01 1.25769540e+02 7.71309317e-01 2.10872581e+00
 2.77845971e+00 1.04650070e+01 2.20576719e-01 4.40995324e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994023770183095
cond(S) = 114387.9817076312
E1 = -729.539275217066  E_coul = 203.1737312901139
init E= -526.365543926952
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555920908183839  LUMO = 0.954510338832676
  mo_energy =
[-1.18332296e+02 -1.22070582e+01 -9.44717097e+00 -9.44717097e+00
 -9.44717097e+00 -1.24027496e+00 -5.55920908e-01 -5.55920908e-01
 -5.55920908e-01  9.54510339e-01  1.02080534e+00  1.02080534e+00
  1.02080534e+00  7.24892862e+00  7.24892862e+00  7.24892862e+00
  9.16015368e+00  3.32689717e+01  3.32689717e+01  3.32689717e+01
  4.65397092e+01  1.29043569e+02  1.29043569e+02  1.29043569e+02
  1.80391380e+02  4.83602737e+02  4.83602737e+02  4.83602737e+02
  6.85988181e+02  1.33528921e+03  1.33528921e+03  1.33528921e+03
  2.75470670e+03  3.02924816e+03  3.02924816e+03  3.02924816e+03
  6.64955460e+03  6.64955460e+03  6.64955460e+03  9.15382972e+03
  2.55045523e+04  7.62409134e+04]
E1 = -727.8202592256972  E_coul = 201.07155851488113
cycle= 1 E= -526.748700710816  delta_E= -0.383  |g|= 0.188  |ddm|= 0.333
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.566354
diis-c [-0.32075722  1.        ]
  HOMO = -0.591688250230623  LUMO = 0.927496863276232
  mo_energy =
[-1.18643300e+02 -1.23465924e+01 -9.59781237e+00 -9.59781237e+00
 -9.59781237e+00 -1.28069060e+00 -5.91688250e-01 -5.91688250e-01
 -5.91688250e-01  9.27496863e-01  9.96051431e-01  9.96051431e-01
  9.96051431e-01  7.15726931e+00  7.15726931e+00  7.15726931e+00
  9.06806096e+00  3.31126084e+01  3.31126084e+01  3.31126084e+01
  4.63833248e+01  1.28812266e+02  1.28812266e+02  1.28812266e+02
  1.80155618e+02  4.83292906e+02  4.83292906e+02  4.83292906e+02
  6.85640191e+02  1.33492258e+03  1.33492258e+03  1.33492258e+03
  2.75420751e+03  3.02881563e+03  3.02881563e+03  3.02881563e+03
  6.64900857e+03  6.64900857e+03  6.64900857e+03  9.15320920e+03
  2.55038369e+04  7.62401076e+04]
E1 = -728.4054041527804  E_coul = 201.6559606544588
cycle= 2 E= -526.749443498322  delta_E= -0.000743  |g|= 0.0383  |ddm|= 0.0539
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0780946
diis-c [-0.00379181  0.07860648  0.92139352]
  HOMO = -0.582351092529399  LUMO = 0.935242496216805
  mo_energy =
[-1.18574102e+02 -1.23076284e+01 -9.55715004e+00 -9.55715004e+00
 -9.55715004e+00 -1.26952227e+00 -5.82351093e-01 -5.82351093e-01
 -5.82351093e-01  9.35242496e-01  1.00287310e+00  1.00287310e+00
  1.00287310e+00  7.18142878e+00  7.18142878e+00  7.18142878e+00
  9.09344394e+00  3.31536083e+01  3.31536083e+01  3.31536083e+01
  4.64258240e+01  1.28869464e+02  1.28869464e+02  1.28869464e+02
  1.80214469e+02  4.83361281e+02  4.83361281e+02  4.83361281e+02
  6.85710710e+02  1.33499506e+03  1.33499506e+03  1.33499506e+03
  2.75428326e+03  3.02889039e+03  3.02889039e+03  3.02889039e+03
  6.64908511e+03  6.64908511e+03  6.64908511e+03  9.15328654e+03
  2.55039148e+04  7.62401858e+04]
E1 = -728.2506479479895  E_coul = 201.5011430906745
cycle= 3 E= -526.749504857315  delta_E= -6.14e-05  |g|= 0.00664  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140671
diis-c [-8.23224572e-07 -1.30888099e-03  1.48163298e-01  8.53145583e-01]
  HOMO = -0.583934337744869  LUMO = 0.934017396555586
  mo_energy =
[-1.18584615e+02 -1.23137607e+01 -9.56364681e+00 -9.56364681e+00
 -9.56364681e+00 -1.27131408e+00 -5.83934338e-01 -5.83934338e-01
 -5.83934338e-01  9.34017397e-01  1.00174035e+00  1.00174035e+00
  1.00174035e+00  7.17746728e+00  7.17746728e+00  7.17746728e+00
  9.08937635e+00  3.31470961e+01  3.31470961e+01  3.31470961e+01
  4.64191573e+01  1.28860647e+02  1.28860647e+02  1.28860647e+02
  1.80205442e+02  4.83350889e+02  4.83350889e+02  4.83350889e+02
  6.85699975e+02  1.33498405e+03  1.33498405e+03  1.33498405e+03
  2.75427160e+03  3.02887898e+03  3.02887898e+03  3.02887898e+03
  6.64907328e+03  6.64907328e+03  6.64907328e+03  9.15327450e+03
  2.55039026e+04  7.62401734e+04]
E1 = -728.2748528363147  E_coul = 201.5253458294478
cycle= 4 E= -526.749507006867  delta_E= -2.15e-06  |g|= 9.93e-05  |ddm|= 0.00237
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000109764
diis-c [-5.05984404e-09  8.01497380e-05 -1.13920806e-02 -6.88956260e-02
  1.08020756e+00]
  HOMO = -0.583913385357545  LUMO = 0.934051329154548
  mo_energy =
[-1.18584558e+02 -1.23136855e+01 -9.56358495e+00 -9.56358495e+00
 -9.56358495e+00 -1.27127025e+00 -5.83913385e-01 -5.83913385e-01
 -5.83913385e-01  9.34051329e-01  1.00175786e+00  1.00175786e+00
  1.00175786e+00  7.17751536e+00  7.17751536e+00  7.17751536e+00
  9.08943898e+00  3.31471558e+01  3.31471558e+01  3.31471558e+01
  4.64192249e+01  1.28860709e+02  1.28860709e+02  1.28860709e+02
  1.80205505e+02  4.83350946e+02  4.83350946e+02  4.83350946e+02
  6.85700024e+02  1.33498410e+03  1.33498410e+03  1.33498410e+03
  2.75427163e+03  3.02887901e+03  3.02887901e+03  3.02887901e+03
  6.64907330e+03  6.64907330e+03  6.64907330e+03  9.15327452e+03
  2.55039026e+04  7.62401734e+04]
E1 = -728.2745968345832  E_coul = 201.5250898260301
cycle= 5 E= -526.749507008553  delta_E= -1.69e-09  |g|= 2.06e-05  |ddm|= 0.000157
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.90268e-05
diis-c [-8.66774709e-11  1.27596275e-05 -1.72289336e-03 -1.25311577e-02
  4.18727461e-02  9.72368545e-01]
  HOMO = -0.583921097851531  LUMO = 0.934047397188604
  mo_energy =
[-1.18584590e+02 -1.23137089e+01 -9.56361017e+00 -9.56361017e+00
 -9.56361017e+00 -1.27127660e+00 -5.83921098e-01 -5.83921098e-01
 -5.83921098e-01  9.34047397e-01  1.00175277e+00  1.00175277e+00
  1.00175277e+00  7.17749830e+00  7.17749830e+00  7.17749830e+00
  9.08942254e+00  3.31471314e+01  3.31471314e+01  3.31471314e+01
  4.64192005e+01  1.28860680e+02  1.28860680e+02  1.28860680e+02
  1.80205476e+02  4.83350915e+02  4.83350915e+02  4.83350915e+02
  6.85699993e+02  1.33498407e+03  1.33498407e+03  1.33498407e+03
  2.75427159e+03  3.02887898e+03  3.02887898e+03  3.02887898e+03
  6.64907327e+03  6.64907327e+03  6.64907327e+03  9.15327448e+03
  2.55039026e+04  7.62401734e+04]
E1 = -728.2746812742654  E_coul = 201.52517426565439
cycle= 6 E= -526.749507008611  delta_E= -5.79e-11  |g|= 1.82e-06  |ddm|= 1.82e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2746812742654  E_coul = 201.52517426565439
  HOMO = -0.583921046999145  LUMO = 0.934047787977166
  mo_energy =
[-1.18584589e+02 -1.23137085e+01 -9.56360986e+00 -9.56360986e+00
 -9.56360986e+00 -1.27127614e+00 -5.83921047e-01 -5.83921047e-01
 -5.83921047e-01  9.34047788e-01  1.00175286e+00  1.00175286e+00
  1.00175286e+00  7.17749851e+00  7.17749851e+00  7.17749851e+00
  9.08942292e+00  3.31471317e+01  3.31471317e+01  3.31471317e+01
  4.64192009e+01  1.28860680e+02  1.28860680e+02  1.28860680e+02
  1.80205477e+02  4.83350915e+02  4.83350915e+02  4.83350915e+02
  6.85699993e+02  1.33498407e+03  1.33498407e+03  1.33498407e+03
  2.75427160e+03  3.02887898e+03  3.02887898e+03  3.02887898e+03
  6.64907327e+03  6.64907327e+03  6.64907327e+03  9.15327448e+03
  2.55039026e+04  7.62401734e+04]
E1 = -728.2746792962241  E_coul = 201.52517228761178
Extra cycle  E= -526.749507008612  delta_E= -1.36e-12  |g|= 3.78e-07  |ddm|= 3.21e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114387.9817076312
E1 = -728.2746792962241  E_coul = 201.52517228761178
init E= -526.749507008612
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583921099491542  LUMO = 0.934047818033731
  mo_energy =
[-1.18584589e+02 -1.23137086e+01 -9.56361003e+00 -9.56361003e+00
 -9.56361003e+00 -1.27127611e+00 -5.83921099e-01 -5.83921099e-01
 -5.83921099e-01  9.34047818e-01  1.00175284e+00  1.00175284e+00
  1.00175284e+00  7.17749841e+00  7.17749841e+00  7.17749841e+00
  9.08942285e+00  3.31471316e+01  3.31471316e+01  3.31471316e+01
  4.64192007e+01  1.28860680e+02  1.28860680e+02  1.28860680e+02
  1.80205477e+02  4.83350915e+02  4.83350915e+02  4.83350915e+02
  6.85699993e+02  1.33498407e+03  1.33498407e+03  1.33498407e+03
  2.75427159e+03  3.02887898e+03  3.02887898e+03  3.02887898e+03
  6.64907327e+03  6.64907327e+03  6.64907327e+03  9.15327448e+03
  2.55039026e+04  7.62401734e+04]
E1 = -728.2746797217453  E_coul = 201.52517271313297
cycle= 1 E= -526.749507008612  delta_E=    0  |g|= 8.32e-08  |ddm|= 6.15e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2746797217453  E_coul = 201.52517271313297
  HOMO = -0.583921094237366  LUMO = 0.934047837063219
  mo_energy =
[-1.18584589e+02 -1.23137086e+01 -9.56361000e+00 -9.56361000e+00
 -9.56361000e+00 -1.27127609e+00 -5.83921094e-01 -5.83921094e-01
 -5.83921094e-01  9.34047837e-01  1.00175284e+00  1.00175284e+00
  1.00175284e+00  7.17749843e+00  7.17749843e+00  7.17749843e+00
  9.08942288e+00  3.31471316e+01  3.31471316e+01  3.31471316e+01
  4.64192007e+01  1.28860680e+02  1.28860680e+02  1.28860680e+02
  1.80205477e+02  4.83350915e+02  4.83350915e+02  4.83350915e+02
  6.85699993e+02  1.33498407e+03  1.33498407e+03  1.33498407e+03
  2.75427159e+03  3.02887898e+03  3.02887898e+03  3.02887898e+03
  6.64907327e+03  6.64907327e+03  6.64907327e+03  9.15327448e+03
  2.55039026e+04  7.62401734e+04]
E1 = -728.2746795738175  E_coul = 201.525172565205
Extra cycle  E= -526.749507008612  delta_E= -1.14e-13  |g|= 1.73e-08  |ddm|= 1.36e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826648e+04 7.61750269e+03 3.61736024e+03 1.59742784e+03
 3.82579482e+02 1.15194318e+02 4.12267307e+01 1.74711805e+01
 6.58331679e+00 6.56166592e-01 2.74092202e+00 2.35405597e-01
 1.36278619e+03 6.64716281e+02 3.00823382e+02 3.13922772e+02
 6.17025617e+01 7.26318587e+00 2.03082669e+01 7.71309317e-01
 2.77845971e+00 2.20576719e-01]
grad_E = [-1.56198675e-06  3.82220040e-06 -1.23275708e-06  8.81211476e-05
 -4.08684383e-04 -4.40334119e-05 -7.91549697e-04  3.33116110e-04
  8.36425677e-05 -1.81429843e-03  1.92606144e-04  9.06498139e-03
 -4.77660136e-07  5.40978746e-06  2.61039811e-05  2.24878954e-05
 -3.27057851e-04 -6.52525433e-03  2.55505204e-03  8.53198076e-03
  4.28440784e-03 -3.07395958e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:43 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6652781        1
[INPUT] 0    0    [1    /1   ]  7617.50154668        1
[INPUT] 0    0    [1    /1   ]  3617.3607698         1
[INPUT] 0    0    [1    /1   ]  1597.40387662        1
[INPUT] 0    0    [1    /1   ]  382.585068739        1
[INPUT] 0    0    [1    /1   ]  115.546968548        1
[INPUT] 0    0    [1    /1   ]  41.6011801655        1
[INPUT] 0    0    [1    /1   ]  17.953792666         1
[INPUT] 0    0    [1    /1   ]  6.63975900283        1
[INPUT] 0    0    [1    /1   ]  0.642528732487       1
[INPUT] 0    0    [1    /1   ]  2.74385655506        1
[INPUT] 0    0    [1    /1   ]  0.23082515764        1
[INPUT] 1    0    [1    /1   ]  1362.78636518        1
[INPUT] 1    0    [1    /1   ]  664.714573578        1
[INPUT] 1    0    [1    /1   ]  300.815325755        1
[INPUT] 1    0    [1    /1   ]  313.915826042        1
[INPUT] 1    0    [1    /1   ]  61.7113899538        1
[INPUT] 1    0    [1    /1   ]  7.30319176277        1
[INPUT] 1    0    [1    /1   ]  20.2812174567        1
[INPUT] 1    0    [1    /1   ]  0.77474179092        1
[INPUT] 1    0    [1    /1   ]  2.81133060914        1
[INPUT] 1    0    [1    /1   ]  0.221479720005       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.66527810404, 1.0]], [0, [7617.501546675653, 1.0]], [0, [3617.3607698019573, 1.0]], [0, [1597.4038766224994, 1.0]], [0, [382.5850687394384, 1.0]], [0, [115.54696854807297, 1.0]], [0, [41.601180165515245, 1.0]], [0, [17.95379266604969, 1.0]], [0, [6.639759002832549, 1.0]], [0, [0.6425287324866581, 1.0]], [0, [2.7438565550560456, 1.0]], [0, [0.23082515763996628, 1.0]], [1, [1362.7863651818411, 1.0]], [1, [664.7145735776396, 1.0]], [1, [300.81532575470465, 1.0]], [1, [313.91582604152916, 1.0]], [1, [61.71138995375373, 1.0]], [1, [7.303191762769688, 1.0]], [1, [20.281217456697767, 1.0]], [1, [0.7747417909202757, 1.0]], [1, [2.8113306091397225, 1.0]], [1, [0.2214797200049493, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6652781]
bas 1, expnt(s) = [7617.50154668]
bas 2, expnt(s) = [3617.3607698]
bas 3, expnt(s) = [1597.40387662]
bas 4, expnt(s) = [382.58506874]
bas 5, expnt(s) = [115.54696855]
bas 6, expnt(s) = [41.60118017]
bas 7, expnt(s) = [17.95379267]
bas 8, expnt(s) = [6.639759]
bas 9, expnt(s) = [0.64252873]
bas 10, expnt(s) = [2.74385656]
bas 11, expnt(s) = [0.23082516]
bas 12, expnt(s) = [1362.78636518]
bas 13, expnt(s) = [664.71457358]
bas 14, expnt(s) = [300.81532575]
bas 15, expnt(s) = [313.91582604]
bas 16, expnt(s) = [61.71138995]
bas 17, expnt(s) = [7.30319176]
bas 18, expnt(s) = [20.28121746]
bas 19, expnt(s) = [0.77474179]
bas 20, expnt(s) = [2.81133061]
bas 21, expnt(s) = [0.22147972]
CPU time:       330.93
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826653e+04 5.20026427e+03 7.61750155e+03 2.06003423e+03
 3.61736077e+03 1.17844385e+03 1.59740388e+03 6.38375300e+02
 3.82585069e+02 2.18555146e+02 1.15546969e+02 8.90397519e+01
 4.16011802e+01 4.13851242e+01 1.79537927e+01 2.20359703e+01
 6.63975900e+00 1.04503121e+01 6.42528732e-01 1.81315294e+00
 2.74385656e+00 5.38624466e+00 2.30825158e-01 8.41351319e-01
 1.36278637e+03 2.41556716e+04 6.64714574e+02 9.84642083e+03
 3.00815326e+02 3.65476402e+03 3.13915826e+02 3.85479162e+03
 6.17113900e+01 5.04592804e+02 7.30319176e+00 3.50247685e+01
 2.02812175e+01 1.25560177e+02 7.74741791e-01 2.12046262e+00
 2.81133061e+00 1.06199946e+01 2.21479720e-01 4.43253170e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993920301813844
cond(S) = 114372.03089181763
E1 = -729.5393819446318  E_coul = 203.17358050919006
init E= -526.365801435442
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555892464518976  LUMO = 0.924256216473051
  mo_energy =
[-1.18332381e+02 -1.22070623e+01 -9.44723663e+00 -9.44723663e+00
 -9.44723663e+00 -1.24027913e+00 -5.55892465e-01 -5.55892465e-01
 -5.55892465e-01  9.24256216e-01  1.02740330e+00  1.02740330e+00
  1.02740330e+00  7.33297103e+00  7.33297103e+00  7.33297103e+00
  9.14375380e+00  3.34781572e+01  3.34781572e+01  3.34781572e+01
  4.73291218e+01  1.29238274e+02  1.29238274e+02  1.29238274e+02
  1.83070840e+02  4.83748271e+02  4.83748271e+02  4.83748271e+02
  6.90266414e+02  1.33540255e+03  1.33540255e+03  1.33540255e+03
  2.75925484e+03  3.02933114e+03  3.02933114e+03  3.02933114e+03
  6.64961279e+03  6.64961279e+03  6.64961279e+03  9.15813143e+03
  2.55086319e+04  7.62447131e+04]
E1 = -727.8243751635599  E_coul = 201.07540482778742
cycle= 1 E= -526.748970335772  delta_E= -0.383  |g|= 0.188  |ddm|= 0.322
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.567442
diis-c [-0.32199065  1.        ]
  HOMO = -0.591508520631804  LUMO = 0.898094717934547
  mo_energy =
[-1.18643050e+02 -1.23463414e+01 -9.59763763e+00 -9.59763763e+00
 -9.59763763e+00 -1.28046380e+00 -5.91508521e-01 -5.91508521e-01
 -5.91508521e-01  8.98094718e-01  1.00258854e+00  1.00258854e+00
  1.00258854e+00  7.24097787e+00  7.24097787e+00  7.24097787e+00
  9.05152339e+00  3.33220132e+01  3.33220132e+01  3.33220132e+01
  4.71718206e+01  1.29007342e+02  1.29007342e+02  1.29007342e+02
  1.82834702e+02  4.83438816e+02  4.83438816e+02  4.83438816e+02
  6.89918659e+02  1.33503626e+03  1.33503626e+03  1.33503626e+03
  2.75875606e+03  3.02889897e+03  3.02889897e+03  3.02889897e+03
  6.64906711e+03  6.64906711e+03  6.64906711e+03  9.15751130e+03
  2.55079168e+04  7.62439076e+04]
E1 = -728.4076114890374  E_coul = 201.6579010054201
cycle= 2 E= -526.749710483617  delta_E= -0.00074  |g|= 0.0382  |ddm|= 0.0538
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0779844
diis-c [-0.00379408  0.07816043  0.92183957]
  HOMO = -0.582199622989531  LUMO = 0.905646842626302
  mo_energy =
[-1.18574016e+02 -1.23074881e+01 -9.55709478e+00 -9.55709478e+00
 -9.55709478e+00 -1.26932669e+00 -5.82199623e-01 -5.82199623e-01
 -5.82199623e-01  9.05646843e-01  1.00943823e+00  1.00943823e+00
  1.00943823e+00  7.26520510e+00  7.26520510e+00  7.26520510e+00
  9.07695376e+00  3.33629153e+01  3.33629153e+01  3.33629153e+01
  4.72145059e+01  1.29064381e+02  1.29064381e+02  1.29064381e+02
  1.82893534e+02  4.83507027e+02  4.83507027e+02  4.83507027e+02
  6.89989017e+02  1.33510857e+03  1.33510857e+03  1.33510857e+03
  2.75883163e+03  3.02897356e+03  3.02897356e+03  3.02897356e+03
  6.64914347e+03  6.64914347e+03  6.64914347e+03  9.15758846e+03
  2.55079946e+04  7.62439856e+04]
E1 = -728.2535923870014  E_coul = 201.50382104759427
cycle= 3 E= -526.749771339407  delta_E= -6.09e-05  |g|= 0.00662  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140672
diis-c [-8.34805333e-07 -1.31044168e-03  1.48337502e-01  8.52972939e-01]
  HOMO = -0.583776999277552  LUMO = 0.904456794642917
  mo_energy =
[-1.18584507e+02 -1.23136016e+01 -9.56357336e+00 -9.56357336e+00
 -9.56357336e+00 -1.27110857e+00 -5.83776999e-01 -5.83776999e-01
 -5.83776999e-01  9.04456795e-01  1.00830198e+00  1.00830198e+00
  1.00830198e+00  7.26123468e+00  7.26123468e+00  7.26123468e+00
  9.07288434e+00  3.33564185e+01  3.33564185e+01  3.33564185e+01
  4.72078136e+01  1.29055586e+02  1.29055586e+02  1.29055586e+02
  1.82884510e+02  4.83496657e+02  4.83496657e+02  4.83496657e+02
  6.89978302e+02  1.33509758e+03  1.33509758e+03  1.33509758e+03
  2.75881999e+03  3.02896216e+03  3.02896216e+03  3.02896216e+03
  6.64913166e+03  6.64913166e+03  6.64913166e+03  9.15757644e+03
  2.55079824e+04  7.62439733e+04]
E1 = -728.277670445515  E_coul = 201.52789697282952
cycle= 4 E= -526.749773472686  delta_E= -2.13e-06  |g|= 0.000102  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000113882
diis-c [-5.07698493e-09  8.34159743e-05 -1.18252435e-02 -7.16648108e-02
  1.08340664e+00]
  HOMO = -0.583757047160341  LUMO = 0.90448998027694
  mo_energy =
[-1.18584455e+02 -1.23135289e+01 -9.56351443e+00 -9.56351443e+00
 -9.56351443e+00 -1.27106507e+00 -5.83757047e-01 -5.83757047e-01
 -5.83757047e-01  9.04489980e-01  1.00831898e+00  1.00831898e+00
  1.00831898e+00  7.26128097e+00  7.26128097e+00  7.26128097e+00
  9.07294559e+00  3.33564754e+01  3.33564754e+01  3.33564754e+01
  4.72078787e+01  1.29055644e+02  1.29055644e+02  1.29055644e+02
  1.82884569e+02  4.83496710e+02  4.83496710e+02  4.83496710e+02
  6.89978348e+02  1.33509763e+03  1.33509763e+03  1.33509763e+03
  2.75882001e+03  3.02896219e+03  3.02896219e+03  3.02896219e+03
  6.64913168e+03  6.64913168e+03  6.64913168e+03  9.15757645e+03
  2.55079824e+04  7.62439733e+04]
E1 = -728.2774217707515  E_coul = 201.52764829625244
cycle= 5 E= -526.749773474499  delta_E= -1.81e-09  |g|= 2.07e-05  |ddm|= 0.000163
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.90013e-05
diis-c [-9.05146607e-11  1.27700856e-05 -1.72532873e-03 -1.25362874e-02
  3.98946743e-02  9.74354172e-01]
  HOMO = -0.583764825801562  LUMO = 0.904486162252798
  mo_energy =
[-1.18584486e+02 -1.23135524e+01 -9.56353975e+00 -9.56353975e+00
 -9.56353975e+00 -1.27107141e+00 -5.83764826e-01 -5.83764826e-01
 -5.83764826e-01  9.04486162e-01  1.00831381e+00  1.00831381e+00
  1.00831381e+00  7.26126373e+00  7.26126373e+00  7.26126373e+00
  9.07292905e+00  3.33564509e+01  3.33564509e+01  3.33564509e+01
  4.72078540e+01  1.29055615e+02  1.29055615e+02  1.29055615e+02
  1.82884540e+02  4.83496678e+02  4.83496678e+02  4.83496678e+02
  6.89978316e+02  1.33509759e+03  1.33509759e+03  1.33509759e+03
  2.75881998e+03  3.02896216e+03  3.02896216e+03  3.02896216e+03
  6.64913165e+03  6.64913165e+03  6.64913165e+03  9.15757641e+03
  2.55079823e+04  7.62439733e+04]
E1 = -728.2775058044879  E_coul = 201.52773232992953
cycle= 6 E= -526.749773474558  delta_E= -5.92e-11  |g|= 1.85e-06  |ddm|= 1.88e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2775058044879  E_coul = 201.52773232992953
  HOMO = -0.583764758990741  LUMO = 0.904486562607678
  mo_energy =
[-1.18584485e+02 -1.23135519e+01 -9.56353936e+00 -9.56353936e+00
 -9.56353936e+00 -1.27107092e+00 -5.83764759e-01 -5.83764759e-01
 -5.83764759e-01  9.04486563e-01  1.00831391e+00  1.00831391e+00
  1.00831391e+00  7.26126400e+00  7.26126400e+00  7.26126400e+00
  9.07292949e+00  3.33564513e+01  3.33564513e+01  3.33564513e+01
  4.72078545e+01  1.29055616e+02  1.29055616e+02  1.29055616e+02
  1.82884541e+02  4.83496679e+02  4.83496679e+02  4.83496679e+02
  6.89978317e+02  1.33509760e+03  1.33509760e+03  1.33509760e+03
  2.75881998e+03  3.02896216e+03  3.02896216e+03  3.02896216e+03
  6.64913165e+03  6.64913165e+03  6.64913165e+03  9.15757641e+03
  2.55079823e+04  7.62439733e+04]
E1 = -728.277503468861  E_coul = 201.52772999430243
Extra cycle  E= -526.749773474559  delta_E= -3.41e-13  |g|= 3.87e-07  |ddm|= 3.29e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.25 sec
exp = [2.61826653e+04 7.61750155e+03 3.61736077e+03 1.59740388e+03
 3.82585069e+02 1.15546969e+02 4.16011802e+01 1.79537927e+01
 6.63975900e+00 6.42528732e-01 2.74385656e+00 2.30825158e-01
 1.36278637e+03 6.64714574e+02 3.00815326e+02 3.13915826e+02
 6.17113900e+01 7.30319176e+00 2.02812175e+01 7.74741791e-01
 2.81133061e+00 2.21479720e-01]
E = -526.7497734745587
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:43 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6652781        1
[INPUT] 0    0    [1    /1   ]  7617.50154668        1
[INPUT] 0    0    [1    /1   ]  3617.3607698         1
[INPUT] 0    0    [1    /1   ]  1597.40387662        1
[INPUT] 0    0    [1    /1   ]  382.585068739        1
[INPUT] 0    0    [1    /1   ]  115.546968548        1
[INPUT] 0    0    [1    /1   ]  41.6011801655        1
[INPUT] 0    0    [1    /1   ]  17.953792666         1
[INPUT] 0    0    [1    /1   ]  6.63975900283        1
[INPUT] 0    0    [1    /1   ]  0.642528732487       1
[INPUT] 0    0    [1    /1   ]  2.74385655506        1
[INPUT] 0    0    [1    /1   ]  0.23082515764        1
[INPUT] 1    0    [1    /1   ]  1362.78636518        1
[INPUT] 1    0    [1    /1   ]  664.714573578        1
[INPUT] 1    0    [1    /1   ]  300.815325755        1
[INPUT] 1    0    [1    /1   ]  313.915826042        1
[INPUT] 1    0    [1    /1   ]  61.7113899538        1
[INPUT] 1    0    [1    /1   ]  7.30319176277        1
[INPUT] 1    0    [1    /1   ]  20.2812174567        1
[INPUT] 1    0    [1    /1   ]  0.77474179092        1
[INPUT] 1    0    [1    /1   ]  2.81133060914        1
[INPUT] 1    0    [1    /1   ]  0.221479720005       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.66527810404, 1.0]], [0, [7617.501546675653, 1.0]], [0, [3617.3607698019573, 1.0]], [0, [1597.4038766224994, 1.0]], [0, [382.5850687394384, 1.0]], [0, [115.54696854807297, 1.0]], [0, [41.601180165515245, 1.0]], [0, [17.95379266604969, 1.0]], [0, [6.639759002832549, 1.0]], [0, [0.6425287324866581, 1.0]], [0, [2.7438565550560456, 1.0]], [0, [0.23082515763996628, 1.0]], [1, [1362.7863651818411, 1.0]], [1, [664.7145735776396, 1.0]], [1, [300.81532575470465, 1.0]], [1, [313.91582604152916, 1.0]], [1, [61.71138995375373, 1.0]], [1, [7.303191762769688, 1.0]], [1, [20.281217456697767, 1.0]], [1, [0.7747417909202757, 1.0]], [1, [2.8113306091397225, 1.0]], [1, [0.2214797200049493, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6652781]
bas 1, expnt(s) = [7617.50154668]
bas 2, expnt(s) = [3617.3607698]
bas 3, expnt(s) = [1597.40387662]
bas 4, expnt(s) = [382.58506874]
bas 5, expnt(s) = [115.54696855]
bas 6, expnt(s) = [41.60118017]
bas 7, expnt(s) = [17.95379267]
bas 8, expnt(s) = [6.639759]
bas 9, expnt(s) = [0.64252873]
bas 10, expnt(s) = [2.74385656]
bas 11, expnt(s) = [0.23082516]
bas 12, expnt(s) = [1362.78636518]
bas 13, expnt(s) = [664.71457358]
bas 14, expnt(s) = [300.81532575]
bas 15, expnt(s) = [313.91582604]
bas 16, expnt(s) = [61.71138995]
bas 17, expnt(s) = [7.30319176]
bas 18, expnt(s) = [20.28121746]
bas 19, expnt(s) = [0.77474179]
bas 20, expnt(s) = [2.81133061]
bas 21, expnt(s) = [0.22147972]
CPU time:       331.37
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826653e+04 5.20026427e+03 7.61750155e+03 2.06003423e+03
 3.61736077e+03 1.17844385e+03 1.59740388e+03 6.38375300e+02
 3.82585069e+02 2.18555146e+02 1.15546969e+02 8.90397519e+01
 4.16011802e+01 4.13851242e+01 1.79537927e+01 2.20359703e+01
 6.63975900e+00 1.04503121e+01 6.42528732e-01 1.81315294e+00
 2.74385656e+00 5.38624466e+00 2.30825158e-01 8.41351319e-01
 1.36278637e+03 2.41556716e+04 6.64714574e+02 9.84642083e+03
 3.00815326e+02 3.65476402e+03 3.13915826e+02 3.85479162e+03
 6.17113900e+01 5.04592804e+02 7.30319176e+00 3.50247685e+01
 2.02812175e+01 1.25560177e+02 7.74741791e-01 2.12046262e+00
 2.81133061e+00 1.06199946e+01 2.21479720e-01 4.43253170e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993920301813844
cond(S) = 114372.03089181763
E1 = -729.5393819446318  E_coul = 203.17358050919006
init E= -526.365801435442
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555892464518976  LUMO = 0.924256216473051
  mo_energy =
[-1.18332381e+02 -1.22070623e+01 -9.44723663e+00 -9.44723663e+00
 -9.44723663e+00 -1.24027913e+00 -5.55892465e-01 -5.55892465e-01
 -5.55892465e-01  9.24256216e-01  1.02740330e+00  1.02740330e+00
  1.02740330e+00  7.33297103e+00  7.33297103e+00  7.33297103e+00
  9.14375380e+00  3.34781572e+01  3.34781572e+01  3.34781572e+01
  4.73291218e+01  1.29238274e+02  1.29238274e+02  1.29238274e+02
  1.83070840e+02  4.83748271e+02  4.83748271e+02  4.83748271e+02
  6.90266414e+02  1.33540255e+03  1.33540255e+03  1.33540255e+03
  2.75925484e+03  3.02933114e+03  3.02933114e+03  3.02933114e+03
  6.64961279e+03  6.64961279e+03  6.64961279e+03  9.15813143e+03
  2.55086319e+04  7.62447131e+04]
E1 = -727.8243751635599  E_coul = 201.07540482778742
cycle= 1 E= -526.748970335772  delta_E= -0.383  |g|= 0.188  |ddm|= 0.322
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.567442
diis-c [-0.32199065  1.        ]
  HOMO = -0.591508520631804  LUMO = 0.898094717934547
  mo_energy =
[-1.18643050e+02 -1.23463414e+01 -9.59763763e+00 -9.59763763e+00
 -9.59763763e+00 -1.28046380e+00 -5.91508521e-01 -5.91508521e-01
 -5.91508521e-01  8.98094718e-01  1.00258854e+00  1.00258854e+00
  1.00258854e+00  7.24097787e+00  7.24097787e+00  7.24097787e+00
  9.05152339e+00  3.33220132e+01  3.33220132e+01  3.33220132e+01
  4.71718206e+01  1.29007342e+02  1.29007342e+02  1.29007342e+02
  1.82834702e+02  4.83438816e+02  4.83438816e+02  4.83438816e+02
  6.89918659e+02  1.33503626e+03  1.33503626e+03  1.33503626e+03
  2.75875606e+03  3.02889897e+03  3.02889897e+03  3.02889897e+03
  6.64906711e+03  6.64906711e+03  6.64906711e+03  9.15751130e+03
  2.55079168e+04  7.62439076e+04]
E1 = -728.4076114890374  E_coul = 201.6579010054201
cycle= 2 E= -526.749710483617  delta_E= -0.00074  |g|= 0.0382  |ddm|= 0.0538
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0779844
diis-c [-0.00379408  0.07816043  0.92183957]
  HOMO = -0.582199622989531  LUMO = 0.905646842626302
  mo_energy =
[-1.18574016e+02 -1.23074881e+01 -9.55709478e+00 -9.55709478e+00
 -9.55709478e+00 -1.26932669e+00 -5.82199623e-01 -5.82199623e-01
 -5.82199623e-01  9.05646843e-01  1.00943823e+00  1.00943823e+00
  1.00943823e+00  7.26520510e+00  7.26520510e+00  7.26520510e+00
  9.07695376e+00  3.33629153e+01  3.33629153e+01  3.33629153e+01
  4.72145059e+01  1.29064381e+02  1.29064381e+02  1.29064381e+02
  1.82893534e+02  4.83507027e+02  4.83507027e+02  4.83507027e+02
  6.89989017e+02  1.33510857e+03  1.33510857e+03  1.33510857e+03
  2.75883163e+03  3.02897356e+03  3.02897356e+03  3.02897356e+03
  6.64914347e+03  6.64914347e+03  6.64914347e+03  9.15758846e+03
  2.55079946e+04  7.62439856e+04]
E1 = -728.2535923870014  E_coul = 201.50382104759427
cycle= 3 E= -526.749771339407  delta_E= -6.09e-05  |g|= 0.00662  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140672
diis-c [-8.34805333e-07 -1.31044168e-03  1.48337502e-01  8.52972939e-01]
  HOMO = -0.583776999277552  LUMO = 0.904456794642917
  mo_energy =
[-1.18584507e+02 -1.23136016e+01 -9.56357336e+00 -9.56357336e+00
 -9.56357336e+00 -1.27110857e+00 -5.83776999e-01 -5.83776999e-01
 -5.83776999e-01  9.04456795e-01  1.00830198e+00  1.00830198e+00
  1.00830198e+00  7.26123468e+00  7.26123468e+00  7.26123468e+00
  9.07288434e+00  3.33564185e+01  3.33564185e+01  3.33564185e+01
  4.72078136e+01  1.29055586e+02  1.29055586e+02  1.29055586e+02
  1.82884510e+02  4.83496657e+02  4.83496657e+02  4.83496657e+02
  6.89978302e+02  1.33509758e+03  1.33509758e+03  1.33509758e+03
  2.75881999e+03  3.02896216e+03  3.02896216e+03  3.02896216e+03
  6.64913166e+03  6.64913166e+03  6.64913166e+03  9.15757644e+03
  2.55079824e+04  7.62439733e+04]
E1 = -728.277670445515  E_coul = 201.52789697282952
cycle= 4 E= -526.749773472686  delta_E= -2.13e-06  |g|= 0.000102  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000113882
diis-c [-5.07698493e-09  8.34159743e-05 -1.18252435e-02 -7.16648108e-02
  1.08340664e+00]
  HOMO = -0.583757047160341  LUMO = 0.90448998027694
  mo_energy =
[-1.18584455e+02 -1.23135289e+01 -9.56351443e+00 -9.56351443e+00
 -9.56351443e+00 -1.27106507e+00 -5.83757047e-01 -5.83757047e-01
 -5.83757047e-01  9.04489980e-01  1.00831898e+00  1.00831898e+00
  1.00831898e+00  7.26128097e+00  7.26128097e+00  7.26128097e+00
  9.07294559e+00  3.33564754e+01  3.33564754e+01  3.33564754e+01
  4.72078787e+01  1.29055644e+02  1.29055644e+02  1.29055644e+02
  1.82884569e+02  4.83496710e+02  4.83496710e+02  4.83496710e+02
  6.89978348e+02  1.33509763e+03  1.33509763e+03  1.33509763e+03
  2.75882001e+03  3.02896219e+03  3.02896219e+03  3.02896219e+03
  6.64913168e+03  6.64913168e+03  6.64913168e+03  9.15757645e+03
  2.55079824e+04  7.62439733e+04]
E1 = -728.2774217707515  E_coul = 201.52764829625244
cycle= 5 E= -526.749773474499  delta_E= -1.81e-09  |g|= 2.07e-05  |ddm|= 0.000163
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.90013e-05
diis-c [-9.05146607e-11  1.27700856e-05 -1.72532873e-03 -1.25362874e-02
  3.98946743e-02  9.74354172e-01]
  HOMO = -0.583764825801562  LUMO = 0.904486162252798
  mo_energy =
[-1.18584486e+02 -1.23135524e+01 -9.56353975e+00 -9.56353975e+00
 -9.56353975e+00 -1.27107141e+00 -5.83764826e-01 -5.83764826e-01
 -5.83764826e-01  9.04486162e-01  1.00831381e+00  1.00831381e+00
  1.00831381e+00  7.26126373e+00  7.26126373e+00  7.26126373e+00
  9.07292905e+00  3.33564509e+01  3.33564509e+01  3.33564509e+01
  4.72078540e+01  1.29055615e+02  1.29055615e+02  1.29055615e+02
  1.82884540e+02  4.83496678e+02  4.83496678e+02  4.83496678e+02
  6.89978316e+02  1.33509759e+03  1.33509759e+03  1.33509759e+03
  2.75881998e+03  3.02896216e+03  3.02896216e+03  3.02896216e+03
  6.64913165e+03  6.64913165e+03  6.64913165e+03  9.15757641e+03
  2.55079823e+04  7.62439733e+04]
E1 = -728.2775058044879  E_coul = 201.52773232992953
cycle= 6 E= -526.749773474558  delta_E= -5.92e-11  |g|= 1.85e-06  |ddm|= 1.88e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2775058044879  E_coul = 201.52773232992953
  HOMO = -0.583764758990741  LUMO = 0.904486562607678
  mo_energy =
[-1.18584485e+02 -1.23135519e+01 -9.56353936e+00 -9.56353936e+00
 -9.56353936e+00 -1.27107092e+00 -5.83764759e-01 -5.83764759e-01
 -5.83764759e-01  9.04486563e-01  1.00831391e+00  1.00831391e+00
  1.00831391e+00  7.26126400e+00  7.26126400e+00  7.26126400e+00
  9.07292949e+00  3.33564513e+01  3.33564513e+01  3.33564513e+01
  4.72078545e+01  1.29055616e+02  1.29055616e+02  1.29055616e+02
  1.82884541e+02  4.83496679e+02  4.83496679e+02  4.83496679e+02
  6.89978317e+02  1.33509760e+03  1.33509760e+03  1.33509760e+03
  2.75881998e+03  3.02896216e+03  3.02896216e+03  3.02896216e+03
  6.64913165e+03  6.64913165e+03  6.64913165e+03  9.15757641e+03
  2.55079823e+04  7.62439733e+04]
E1 = -728.277503468861  E_coul = 201.52772999430243
Extra cycle  E= -526.749773474559  delta_E= -3.41e-13  |g|= 3.87e-07  |ddm|= 3.29e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.24 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114372.03089181763
E1 = -728.277503468861  E_coul = 201.52772999430243
init E= -526.749773474559
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583764819593697  LUMO = 0.904486587072937
  mo_energy =
[-1.18584486e+02 -1.23135521e+01 -9.56353955e+00 -9.56353955e+00
 -9.56353955e+00 -1.27107091e+00 -5.83764820e-01 -5.83764820e-01
 -5.83764820e-01  9.04486587e-01  1.00831388e+00  1.00831388e+00
  1.00831388e+00  7.26126388e+00  7.26126388e+00  7.26126388e+00
  9.07292939e+00  3.33564511e+01  3.33564511e+01  3.33564511e+01
  4.72078543e+01  1.29055616e+02  1.29055616e+02  1.29055616e+02
  1.82884541e+02  4.83496679e+02  4.83496679e+02  4.83496679e+02
  6.89978316e+02  1.33509760e+03  1.33509760e+03  1.33509760e+03
  2.75881998e+03  3.02896216e+03  3.02896216e+03  3.02896216e+03
  6.64913165e+03  6.64913165e+03  6.64913165e+03  9.15757641e+03
  2.55079823e+04  7.62439733e+04]
E1 = -728.2775039780389  E_coul = 201.52773050347977
cycle= 1 E= -526.749773474559  delta_E= -4.55e-13  |g|= 8.65e-08  |ddm|= 6.26e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2775039780389  E_coul = 201.52773050347977
  HOMO = -0.583764813012351  LUMO = 0.904486607065793
  mo_energy =
[-1.18584486e+02 -1.23135520e+01 -9.56353951e+00 -9.56353951e+00
 -9.56353951e+00 -1.27107089e+00 -5.83764813e-01 -5.83764813e-01
 -5.83764813e-01  9.04486607e-01  1.00831389e+00  1.00831389e+00
  1.00831389e+00  7.26126390e+00  7.26126390e+00  7.26126390e+00
  9.07292943e+00  3.33564511e+01  3.33564511e+01  3.33564511e+01
  4.72078543e+01  1.29055616e+02  1.29055616e+02  1.29055616e+02
  1.82884541e+02  4.83496679e+02  4.83496679e+02  4.83496679e+02
  6.89978316e+02  1.33509760e+03  1.33509760e+03  1.33509760e+03
  2.75881998e+03  3.02896216e+03  3.02896216e+03  3.02896216e+03
  6.64913165e+03  6.64913165e+03  6.64913165e+03  9.15757641e+03
  2.55079823e+04  7.62439733e+04]
E1 = -728.2775038033809  E_coul = 201.52773032882075
Extra cycle  E= -526.74977347456  delta_E= -1.02e-12  |g|= 1.83e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826653e+04 7.61750155e+03 3.61736077e+03 1.59740388e+03
 3.82585069e+02 1.15546969e+02 4.16011802e+01 1.79537927e+01
 6.63975900e+00 6.42528732e-01 2.74385656e+00 2.30825158e-01
 1.36278637e+03 6.64714574e+02 3.00815326e+02 3.13915826e+02
 6.17113900e+01 7.30319176e+00 2.02812175e+01 7.74741791e-01
 2.81133061e+00 2.21479720e-01]
grad_E = [-1.56375447e-06  3.84400189e-06 -1.21492397e-06  8.89162706e-05
 -4.23640784e-04 -1.66172735e-05 -7.61717504e-04  3.45548196e-04
  4.01668896e-04 -4.19061340e-03 -7.14796325e-04  9.53855162e-03
 -4.94109247e-07  5.19561211e-06  2.48115008e-05  2.13756846e-05
 -1.92327872e-04 -4.87863057e-03  1.58613088e-03  7.89287038e-03
  4.78908149e-03 -2.70029284e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:47 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6661402        1
[INPUT] 0    0    [1    /1   ]  7617.49965056        1
[INPUT] 0    0    [1    /1   ]  3617.36164914        1
[INPUT] 0    0    [1    /1   ]  1597.36393471        1
[INPUT] 0    0    [1    /1   ]  382.597393898        1
[INPUT] 0    0    [1    /1   ]  116.102988145        1
[INPUT] 0    0    [1    /1   ]  42.2984190936        1
[INPUT] 0    0    [1    /1   ]  18.7886778048        1
[INPUT] 0    0    [1    /1   ]  6.73213974693        1
[INPUT] 0    0    [1    /1   ]  0.64237488297        1
[INPUT] 0    0    [1    /1   ]  2.76491060619        1
[INPUT] 0    0    [1    /1   ]  0.22909835777        1
[INPUT] 1    0    [1    /1   ]  1362.78665277        1
[INPUT] 1    0    [1    /1   ]  664.711736394        1
[INPUT] 1    0    [1    /1   ]  300.801942178        1
[INPUT] 1    0    [1    /1   ]  313.904288032        1
[INPUT] 1    0    [1    /1   ]  61.7235829031        1
[INPUT] 1    0    [1    /1   ]  7.34866074798        1
[INPUT] 1    0    [1    /1   ]  20.2535878536        1
[INPUT] 1    0    [1    /1   ]  0.777682593788       1
[INPUT] 1    0    [1    /1   ]  2.83671933434        1
[INPUT] 1    0    [1    /1   ]  0.222687581955       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.666140190468, 1.0]], [0, [7617.499650560632, 1.0]], [0, [3617.3616491411303, 1.0]], [0, [1597.3639347094775, 1.0]], [0, [382.59739389845726, 1.0]], [0, [116.10298814529014, 1.0]], [0, [42.29841909356533, 1.0]], [0, [18.788677804844017, 1.0]], [0, [6.732139746930795, 1.0]], [0, [0.6423748829695042, 1.0]], [0, [2.764910606187195, 1.0]], [0, [0.22909835777016307, 1.0]], [1, [1362.7866527736505, 1.0]], [1, [664.7117363939948, 1.0]], [1, [300.80194217782633, 1.0]], [1, [313.9042880322626, 1.0]], [1, [61.72358290306705, 1.0]], [1, [7.348660747983929, 1.0]], [1, [20.253587853628837, 1.0]], [1, [0.777682593788086, 1.0]], [1, [2.836719334335072, 1.0]], [1, [0.22268758195481195, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66614019]
bas 1, expnt(s) = [7617.49965056]
bas 2, expnt(s) = [3617.36164914]
bas 3, expnt(s) = [1597.36393471]
bas 4, expnt(s) = [382.5973939]
bas 5, expnt(s) = [116.10298815]
bas 6, expnt(s) = [42.29841909]
bas 7, expnt(s) = [18.7886778]
bas 8, expnt(s) = [6.73213975]
bas 9, expnt(s) = [0.64237488]
bas 10, expnt(s) = [2.76491061]
bas 11, expnt(s) = [0.22909836]
bas 12, expnt(s) = [1362.78665277]
bas 13, expnt(s) = [664.71173639]
bas 14, expnt(s) = [300.80194218]
bas 15, expnt(s) = [313.90428803]
bas 16, expnt(s) = [61.7235829]
bas 17, expnt(s) = [7.34866075]
bas 18, expnt(s) = [20.25358785]
bas 19, expnt(s) = [0.77768259]
bas 20, expnt(s) = [2.83671933]
bas 21, expnt(s) = [0.22268758]
CPU time:       337.06
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826661e+04 5.20026440e+03 7.61749965e+03 2.06003385e+03
 3.61736165e+03 1.17844406e+03 1.59736393e+03 6.38363328e+02
 3.82597394e+02 2.18560427e+02 1.16102988e+02 8.93609078e+01
 4.22984191e+01 4.19042552e+01 1.87886778e+01 2.28001229e+01
 6.73213975e+00 1.05591720e+01 6.42374883e-01 1.81282732e+00
 2.76491061e+00 5.41721217e+00 2.29098358e-01 8.36626287e-01
 1.36278665e+03 2.41556780e+04 6.64711736e+02 9.84636830e+03
 3.00801942e+02 3.65456077e+03 3.13904288e+02 3.85461452e+03
 6.17235829e+01 5.04717429e+02 7.34866075e+00 3.52975564e+01
 2.02535879e+01 1.25346396e+02 7.77682594e-01 2.13052859e+00
 2.83671933e+00 1.07400141e+01 2.22687582e-01 4.46276884e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993774688807818
cond(S) = 114497.18249768548
E1 = -729.5410022942282  E_coul = 203.1747078642506
init E= -526.366294429978
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555809645886996  LUMO = 0.919464948621455
  mo_energy =
[-1.18332430e+02 -1.22069640e+01 -9.44720576e+00 -9.44720576e+00
 -9.44720576e+00 -1.24023768e+00 -5.55809646e-01 -5.55809646e-01
 -5.55809646e-01  9.19464949e-01  1.03471142e+00  1.03471142e+00
  1.03471142e+00  7.40565655e+00  7.40565655e+00  7.40565655e+00
  9.28282878e+00  3.36720157e+01  3.36720157e+01  3.36720157e+01
  4.88911155e+01  1.29427922e+02  1.29427922e+02  1.29427922e+02
  1.87922681e+02  4.83894563e+02  4.83894563e+02  4.83894563e+02
  6.97847588e+02  1.33550874e+03  1.33550874e+03  1.33550874e+03
  2.76725318e+03  3.02939346e+03  3.02939346e+03  3.02939346e+03
  6.64964084e+03  6.64964084e+03  6.64964084e+03  9.16568869e+03
  2.55157993e+04  7.62513894e+04]
E1 = -727.8353591982784  E_coul = 201.08609809921018
cycle= 1 E= -526.749261099068  delta_E= -0.383  |g|= 0.187  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.568748
diis-c [-0.32347402  1.        ]
  HOMO = -0.591120909630388  LUMO = 0.893683511945244
  mo_energy =
[-1.18642271e+02 -1.23456118e+01 -9.59694665e+00 -9.59694665e+00
 -9.59694665e+00 -1.28000216e+00 -5.91120910e-01 -5.91120910e-01
 -5.91120910e-01  8.93683512e-01  1.00997797e+00  1.00997797e+00
  1.00997797e+00  7.31371848e+00  7.31371848e+00  7.31371848e+00
  9.19012787e+00  3.35164639e+01  3.35164639e+01  3.35164639e+01
  4.87325058e+01  1.29197829e+02  1.29197829e+02  1.29197829e+02
  1.87686129e+02  4.83585968e+02  4.83585968e+02  4.83585968e+02
  6.97500523e+02  1.33514330e+03  1.33514330e+03  1.33514330e+03
  2.76675540e+03  3.02896217e+03  3.02896217e+03  3.02896217e+03
  6.64909604e+03  6.64909604e+03  6.64909604e+03  9.16506952e+03
  2.55150852e+04  7.62505847e+04]
E1 = -728.4147545968526  E_coul = 201.66475979275552
cycle= 2 E= -526.749994804097  delta_E= -0.000734  |g|= 0.038  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0777068
diis-c [-0.0037948   0.07729863  0.92270137]
  HOMO = -0.58187906929404  LUMO = 0.901181981833326
  mo_energy =
[-1.18573554e+02 -1.23069841e+01 -9.55663884e+00 -9.55663884e+00
 -9.55663884e+00 -1.26893528e+00 -5.81879069e-01 -5.81879069e-01
 -5.81879069e-01  9.01181982e-01  1.01682523e+00  1.01682523e+00
  1.01682523e+00  7.33790954e+00  7.33790954e+00  7.33790954e+00
  9.21566442e+00  3.35571571e+01  3.35571571e+01  3.35571571e+01
  4.87754539e+01  1.29254571e+02  1.29254571e+02  1.29254571e+02
  1.87744884e+02  4.83653861e+02  4.83653861e+02  4.83653861e+02
  6.97570569e+02  1.33521529e+03  1.33521529e+03  1.33521529e+03
  2.76683062e+03  3.02903643e+03  3.02903643e+03  3.02903643e+03
  6.64917207e+03  6.64917207e+03  6.64917207e+03  9.16514634e+03
  2.55151626e+04  7.62506624e+04]
E1 = -728.2618799518656  E_coul = 201.51182513261776
cycle= 3 E= -526.750054819248  delta_E= -6e-05  |g|= 0.00661  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140673
diis-c [-8.49051893e-07 -1.31056032e-03  1.48801778e-01  8.52508782e-01]
  HOMO = -0.583449856286299  LUMO = 0.900002294042308
  mo_energy =
[-1.18584027e+02 -1.23130793e+01 -9.56309952e+00 -9.56309952e+00
 -9.56309952e+00 -1.27070498e+00 -5.83449856e-01 -5.83449856e-01
 -5.83449856e-01  9.00002294e-01  1.01568688e+00  1.01568688e+00
  1.01568688e+00  7.33393439e+00  7.33393439e+00  7.33393439e+00
  9.21156986e+00  3.35506746e+01  3.35506746e+01  3.35506746e+01
  4.87687063e+01  1.29245796e+02  1.29245796e+02  1.29245796e+02
  1.87735848e+02  4.83643510e+02  4.83643510e+02  4.83643510e+02
  6.97559870e+02  1.33520431e+03  1.33520431e+03  1.33520431e+03
  2.76681900e+03  3.02902505e+03  3.02902505e+03  3.02902505e+03
  6.64916028e+03  6.64916028e+03  6.64916028e+03  9.16513433e+03
  2.55151504e+04  7.62506501e+04]
E1 = -728.2858292159134  E_coul = 201.53577227859085
cycle= 4 E= -526.750056937323  delta_E= -2.12e-06  |g|= 0.000106  |ddm|= 0.00234
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000117962
diis-c [-5.18942251e-09  8.69059652e-05 -1.23139377e-02 -7.44800802e-02
  1.08670711e+00]
  HOMO = -0.583430627993477  LUMO = 0.900035993965551
  mo_energy =
[-1.18583976e+02 -1.23130080e+01 -9.56304237e+00 -9.56304237e+00
 -9.56304237e+00 -1.27066099e+00 -5.83430628e-01 -5.83430628e-01
 -5.83430628e-01  9.00035994e-01  1.01570362e+00  1.01570362e+00
  1.01570362e+00  7.33397959e+00  7.33397959e+00  7.33397959e+00
  9.21163068e+00  3.35507300e+01  3.35507300e+01  3.35507300e+01
  4.87687698e+01  1.29245853e+02  1.29245853e+02  1.29245853e+02
  1.87735905e+02  4.83643561e+02  4.83643561e+02  4.83643561e+02
  6.97559914e+02  1.33520435e+03  1.33520435e+03  1.33520435e+03
  2.76681903e+03  3.02902508e+03  3.02902508e+03  3.02902508e+03
  6.64916030e+03  6.64916030e+03  6.64916030e+03  9.16513434e+03
  2.55151504e+04  7.62506501e+04]
E1 = -728.2855835458695  E_coul = 201.53552660651118
cycle= 5 E= -526.750056939358  delta_E= -2.04e-09  |g|= 2.1e-05  |ddm|= 0.000172
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.94409e-05
diis-c [-9.59374050e-11  1.28921528e-05 -1.74586629e-03 -1.26423618e-02
  3.56467288e-02  9.78728607e-01]
  HOMO = -0.583438528025192  LUMO = 0.900032212937796
  mo_energy =
[-1.18584008e+02 -1.23130318e+01 -9.56306801e+00 -9.56306801e+00
 -9.56306801e+00 -1.27066731e+00 -5.83438528e-01 -5.83438528e-01
 -5.83438528e-01  9.00032213e-01  1.01569835e+00  1.01569835e+00
  1.01569835e+00  7.33396206e+00  7.33396206e+00  7.33396206e+00
  9.21161383e+00  3.35507051e+01  3.35507051e+01  3.35507051e+01
  4.87687447e+01  1.29245824e+02  1.29245824e+02  1.29245824e+02
  1.87735876e+02  4.83643529e+02  4.83643529e+02  4.83643529e+02
  6.97559882e+02  1.33520432e+03  1.33520432e+03  1.33520432e+03
  2.76681899e+03  3.02902505e+03  3.02902505e+03  3.02902505e+03
  6.64916026e+03  6.64916026e+03  6.64916026e+03  9.16513431e+03
  2.55151503e+04  7.62506501e+04]
E1 = -728.2856680297867  E_coul = 201.535611090365
cycle= 6 E= -526.750056939422  delta_E= -6.34e-11  |g|= 1.87e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2856680297867  E_coul = 201.535611090365
  HOMO = -0.583438428993109  LUMO = 0.900032638059135
  mo_energy =
[-1.18584007e+02 -1.23130312e+01 -9.56306750e+00 -9.56306750e+00
 -9.56306750e+00 -1.27066679e+00 -5.83438429e-01 -5.83438429e-01
 -5.83438429e-01  9.00032638e-01  1.01569848e+00  1.01569848e+00
  1.01569848e+00  7.33396241e+00  7.33396241e+00  7.33396241e+00
  9.21161435e+00  3.35507056e+01  3.35507056e+01  3.35507056e+01
  4.87687452e+01  1.29245824e+02  1.29245824e+02  1.29245824e+02
  1.87735876e+02  4.83643530e+02  4.83643530e+02  4.83643530e+02
  6.97559882e+02  1.33520432e+03  1.33520432e+03  1.33520432e+03
  2.76681899e+03  3.02902505e+03  3.02902505e+03  3.02902505e+03
  6.64916026e+03  6.64916026e+03  6.64916026e+03  9.16513431e+03
  2.55151503e+04  7.62506501e+04]
E1 = -728.2856652328085  E_coul = 201.5356082933848
Extra cycle  E= -526.750056939424  delta_E= -1.93e-12  |g|= 3.93e-07  |ddm|= 3.31e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826661e+04 7.61749965e+03 3.61736165e+03 1.59736393e+03
 3.82597394e+02 1.16102988e+02 4.22984191e+01 1.87886778e+01
 6.73213975e+00 6.42374883e-01 2.76491061e+00 2.29098358e-01
 1.36278665e+03 6.64711736e+02 3.00801942e+02 3.13904288e+02
 6.17235829e+01 7.34866075e+00 2.02535879e+01 7.77682594e-01
 2.83671933e+00 2.22687582e-01]
E = -526.7500569394236
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:48 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6661402        1
[INPUT] 0    0    [1    /1   ]  7617.49965056        1
[INPUT] 0    0    [1    /1   ]  3617.36164914        1
[INPUT] 0    0    [1    /1   ]  1597.36393471        1
[INPUT] 0    0    [1    /1   ]  382.597393898        1
[INPUT] 0    0    [1    /1   ]  116.102988145        1
[INPUT] 0    0    [1    /1   ]  42.2984190936        1
[INPUT] 0    0    [1    /1   ]  18.7886778048        1
[INPUT] 0    0    [1    /1   ]  6.73213974693        1
[INPUT] 0    0    [1    /1   ]  0.64237488297        1
[INPUT] 0    0    [1    /1   ]  2.76491060619        1
[INPUT] 0    0    [1    /1   ]  0.22909835777        1
[INPUT] 1    0    [1    /1   ]  1362.78665277        1
[INPUT] 1    0    [1    /1   ]  664.711736394        1
[INPUT] 1    0    [1    /1   ]  300.801942178        1
[INPUT] 1    0    [1    /1   ]  313.904288032        1
[INPUT] 1    0    [1    /1   ]  61.7235829031        1
[INPUT] 1    0    [1    /1   ]  7.34866074798        1
[INPUT] 1    0    [1    /1   ]  20.2535878536        1
[INPUT] 1    0    [1    /1   ]  0.777682593788       1
[INPUT] 1    0    [1    /1   ]  2.83671933434        1
[INPUT] 1    0    [1    /1   ]  0.222687581955       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.666140190468, 1.0]], [0, [7617.499650560632, 1.0]], [0, [3617.3616491411303, 1.0]], [0, [1597.3639347094775, 1.0]], [0, [382.59739389845726, 1.0]], [0, [116.10298814529014, 1.0]], [0, [42.29841909356533, 1.0]], [0, [18.788677804844017, 1.0]], [0, [6.732139746930795, 1.0]], [0, [0.6423748829695042, 1.0]], [0, [2.764910606187195, 1.0]], [0, [0.22909835777016307, 1.0]], [1, [1362.7866527736505, 1.0]], [1, [664.7117363939948, 1.0]], [1, [300.80194217782633, 1.0]], [1, [313.9042880322626, 1.0]], [1, [61.72358290306705, 1.0]], [1, [7.348660747983929, 1.0]], [1, [20.253587853628837, 1.0]], [1, [0.777682593788086, 1.0]], [1, [2.836719334335072, 1.0]], [1, [0.22268758195481195, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66614019]
bas 1, expnt(s) = [7617.49965056]
bas 2, expnt(s) = [3617.36164914]
bas 3, expnt(s) = [1597.36393471]
bas 4, expnt(s) = [382.5973939]
bas 5, expnt(s) = [116.10298815]
bas 6, expnt(s) = [42.29841909]
bas 7, expnt(s) = [18.7886778]
bas 8, expnt(s) = [6.73213975]
bas 9, expnt(s) = [0.64237488]
bas 10, expnt(s) = [2.76491061]
bas 11, expnt(s) = [0.22909836]
bas 12, expnt(s) = [1362.78665277]
bas 13, expnt(s) = [664.71173639]
bas 14, expnt(s) = [300.80194218]
bas 15, expnt(s) = [313.90428803]
bas 16, expnt(s) = [61.7235829]
bas 17, expnt(s) = [7.34866075]
bas 18, expnt(s) = [20.25358785]
bas 19, expnt(s) = [0.77768259]
bas 20, expnt(s) = [2.83671933]
bas 21, expnt(s) = [0.22268758]
CPU time:       337.51
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826661e+04 5.20026440e+03 7.61749965e+03 2.06003385e+03
 3.61736165e+03 1.17844406e+03 1.59736393e+03 6.38363328e+02
 3.82597394e+02 2.18560427e+02 1.16102988e+02 8.93609078e+01
 4.22984191e+01 4.19042552e+01 1.87886778e+01 2.28001229e+01
 6.73213975e+00 1.05591720e+01 6.42374883e-01 1.81282732e+00
 2.76491061e+00 5.41721217e+00 2.29098358e-01 8.36626287e-01
 1.36278665e+03 2.41556780e+04 6.64711736e+02 9.84636830e+03
 3.00801942e+02 3.65456077e+03 3.13904288e+02 3.85461452e+03
 6.17235829e+01 5.04717429e+02 7.34866075e+00 3.52975564e+01
 2.02535879e+01 1.25346396e+02 7.77682594e-01 2.13052859e+00
 2.83671933e+00 1.07400141e+01 2.22687582e-01 4.46276884e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993774688807818
cond(S) = 114497.18249768548
E1 = -729.5410022942282  E_coul = 203.1747078642506
init E= -526.366294429978
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555809645886996  LUMO = 0.919464948621455
  mo_energy =
[-1.18332430e+02 -1.22069640e+01 -9.44720576e+00 -9.44720576e+00
 -9.44720576e+00 -1.24023768e+00 -5.55809646e-01 -5.55809646e-01
 -5.55809646e-01  9.19464949e-01  1.03471142e+00  1.03471142e+00
  1.03471142e+00  7.40565655e+00  7.40565655e+00  7.40565655e+00
  9.28282878e+00  3.36720157e+01  3.36720157e+01  3.36720157e+01
  4.88911155e+01  1.29427922e+02  1.29427922e+02  1.29427922e+02
  1.87922681e+02  4.83894563e+02  4.83894563e+02  4.83894563e+02
  6.97847588e+02  1.33550874e+03  1.33550874e+03  1.33550874e+03
  2.76725318e+03  3.02939346e+03  3.02939346e+03  3.02939346e+03
  6.64964084e+03  6.64964084e+03  6.64964084e+03  9.16568869e+03
  2.55157993e+04  7.62513894e+04]
E1 = -727.8353591982784  E_coul = 201.08609809921018
cycle= 1 E= -526.749261099068  delta_E= -0.383  |g|= 0.187  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.568748
diis-c [-0.32347402  1.        ]
  HOMO = -0.591120909630388  LUMO = 0.893683511945244
  mo_energy =
[-1.18642271e+02 -1.23456118e+01 -9.59694665e+00 -9.59694665e+00
 -9.59694665e+00 -1.28000216e+00 -5.91120910e-01 -5.91120910e-01
 -5.91120910e-01  8.93683512e-01  1.00997797e+00  1.00997797e+00
  1.00997797e+00  7.31371848e+00  7.31371848e+00  7.31371848e+00
  9.19012787e+00  3.35164639e+01  3.35164639e+01  3.35164639e+01
  4.87325058e+01  1.29197829e+02  1.29197829e+02  1.29197829e+02
  1.87686129e+02  4.83585968e+02  4.83585968e+02  4.83585968e+02
  6.97500523e+02  1.33514330e+03  1.33514330e+03  1.33514330e+03
  2.76675540e+03  3.02896217e+03  3.02896217e+03  3.02896217e+03
  6.64909604e+03  6.64909604e+03  6.64909604e+03  9.16506952e+03
  2.55150852e+04  7.62505847e+04]
E1 = -728.4147545968526  E_coul = 201.66475979275552
cycle= 2 E= -526.749994804097  delta_E= -0.000734  |g|= 0.038  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0777068
diis-c [-0.0037948   0.07729863  0.92270137]
  HOMO = -0.58187906929404  LUMO = 0.901181981833326
  mo_energy =
[-1.18573554e+02 -1.23069841e+01 -9.55663884e+00 -9.55663884e+00
 -9.55663884e+00 -1.26893528e+00 -5.81879069e-01 -5.81879069e-01
 -5.81879069e-01  9.01181982e-01  1.01682523e+00  1.01682523e+00
  1.01682523e+00  7.33790954e+00  7.33790954e+00  7.33790954e+00
  9.21566442e+00  3.35571571e+01  3.35571571e+01  3.35571571e+01
  4.87754539e+01  1.29254571e+02  1.29254571e+02  1.29254571e+02
  1.87744884e+02  4.83653861e+02  4.83653861e+02  4.83653861e+02
  6.97570569e+02  1.33521529e+03  1.33521529e+03  1.33521529e+03
  2.76683062e+03  3.02903643e+03  3.02903643e+03  3.02903643e+03
  6.64917207e+03  6.64917207e+03  6.64917207e+03  9.16514634e+03
  2.55151626e+04  7.62506624e+04]
E1 = -728.2618799518656  E_coul = 201.51182513261776
cycle= 3 E= -526.750054819248  delta_E= -6e-05  |g|= 0.00661  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140673
diis-c [-8.49051893e-07 -1.31056032e-03  1.48801778e-01  8.52508782e-01]
  HOMO = -0.583449856286299  LUMO = 0.900002294042308
  mo_energy =
[-1.18584027e+02 -1.23130793e+01 -9.56309952e+00 -9.56309952e+00
 -9.56309952e+00 -1.27070498e+00 -5.83449856e-01 -5.83449856e-01
 -5.83449856e-01  9.00002294e-01  1.01568688e+00  1.01568688e+00
  1.01568688e+00  7.33393439e+00  7.33393439e+00  7.33393439e+00
  9.21156986e+00  3.35506746e+01  3.35506746e+01  3.35506746e+01
  4.87687063e+01  1.29245796e+02  1.29245796e+02  1.29245796e+02
  1.87735848e+02  4.83643510e+02  4.83643510e+02  4.83643510e+02
  6.97559870e+02  1.33520431e+03  1.33520431e+03  1.33520431e+03
  2.76681900e+03  3.02902505e+03  3.02902505e+03  3.02902505e+03
  6.64916028e+03  6.64916028e+03  6.64916028e+03  9.16513433e+03
  2.55151504e+04  7.62506501e+04]
E1 = -728.2858292159134  E_coul = 201.53577227859085
cycle= 4 E= -526.750056937323  delta_E= -2.12e-06  |g|= 0.000106  |ddm|= 0.00234
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000117962
diis-c [-5.18942251e-09  8.69059652e-05 -1.23139377e-02 -7.44800802e-02
  1.08670711e+00]
  HOMO = -0.583430627993477  LUMO = 0.900035993965551
  mo_energy =
[-1.18583976e+02 -1.23130080e+01 -9.56304237e+00 -9.56304237e+00
 -9.56304237e+00 -1.27066099e+00 -5.83430628e-01 -5.83430628e-01
 -5.83430628e-01  9.00035994e-01  1.01570362e+00  1.01570362e+00
  1.01570362e+00  7.33397959e+00  7.33397959e+00  7.33397959e+00
  9.21163068e+00  3.35507300e+01  3.35507300e+01  3.35507300e+01
  4.87687698e+01  1.29245853e+02  1.29245853e+02  1.29245853e+02
  1.87735905e+02  4.83643561e+02  4.83643561e+02  4.83643561e+02
  6.97559914e+02  1.33520435e+03  1.33520435e+03  1.33520435e+03
  2.76681903e+03  3.02902508e+03  3.02902508e+03  3.02902508e+03
  6.64916030e+03  6.64916030e+03  6.64916030e+03  9.16513434e+03
  2.55151504e+04  7.62506501e+04]
E1 = -728.2855835458695  E_coul = 201.53552660651118
cycle= 5 E= -526.750056939358  delta_E= -2.04e-09  |g|= 2.1e-05  |ddm|= 0.000172
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.94409e-05
diis-c [-9.59374050e-11  1.28921528e-05 -1.74586629e-03 -1.26423618e-02
  3.56467288e-02  9.78728607e-01]
  HOMO = -0.583438528025192  LUMO = 0.900032212937796
  mo_energy =
[-1.18584008e+02 -1.23130318e+01 -9.56306801e+00 -9.56306801e+00
 -9.56306801e+00 -1.27066731e+00 -5.83438528e-01 -5.83438528e-01
 -5.83438528e-01  9.00032213e-01  1.01569835e+00  1.01569835e+00
  1.01569835e+00  7.33396206e+00  7.33396206e+00  7.33396206e+00
  9.21161383e+00  3.35507051e+01  3.35507051e+01  3.35507051e+01
  4.87687447e+01  1.29245824e+02  1.29245824e+02  1.29245824e+02
  1.87735876e+02  4.83643529e+02  4.83643529e+02  4.83643529e+02
  6.97559882e+02  1.33520432e+03  1.33520432e+03  1.33520432e+03
  2.76681899e+03  3.02902505e+03  3.02902505e+03  3.02902505e+03
  6.64916026e+03  6.64916026e+03  6.64916026e+03  9.16513431e+03
  2.55151503e+04  7.62506501e+04]
E1 = -728.2856680297867  E_coul = 201.535611090365
cycle= 6 E= -526.750056939422  delta_E= -6.34e-11  |g|= 1.87e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2856680297867  E_coul = 201.535611090365
  HOMO = -0.583438428993109  LUMO = 0.900032638059135
  mo_energy =
[-1.18584007e+02 -1.23130312e+01 -9.56306750e+00 -9.56306750e+00
 -9.56306750e+00 -1.27066679e+00 -5.83438429e-01 -5.83438429e-01
 -5.83438429e-01  9.00032638e-01  1.01569848e+00  1.01569848e+00
  1.01569848e+00  7.33396241e+00  7.33396241e+00  7.33396241e+00
  9.21161435e+00  3.35507056e+01  3.35507056e+01  3.35507056e+01
  4.87687452e+01  1.29245824e+02  1.29245824e+02  1.29245824e+02
  1.87735876e+02  4.83643530e+02  4.83643530e+02  4.83643530e+02
  6.97559882e+02  1.33520432e+03  1.33520432e+03  1.33520432e+03
  2.76681899e+03  3.02902505e+03  3.02902505e+03  3.02902505e+03
  6.64916026e+03  6.64916026e+03  6.64916026e+03  9.16513431e+03
  2.55151503e+04  7.62506501e+04]
E1 = -728.2856652328085  E_coul = 201.5356082933848
Extra cycle  E= -526.750056939424  delta_E= -1.93e-12  |g|= 3.93e-07  |ddm|= 3.31e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114497.18249768548
E1 = -728.2856652328085  E_coul = 201.5356082933848
init E= -526.750056939424
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583438498953561  LUMO = 0.900032655221681
  mo_energy =
[-1.18584008e+02 -1.23130314e+01 -9.56306773e+00 -9.56306773e+00
 -9.56306773e+00 -1.27066678e+00 -5.83438499e-01 -5.83438499e-01
 -5.83438499e-01  9.00032655e-01  1.01569844e+00  1.01569844e+00
  1.01569844e+00  7.33396227e+00  7.33396227e+00  7.33396227e+00
  9.21161423e+00  3.35507054e+01  3.35507054e+01  3.35507054e+01
  4.87687450e+01  1.29245824e+02  1.29245824e+02  1.29245824e+02
  1.87735876e+02  4.83643530e+02  4.83643530e+02  4.83643530e+02
  6.97559882e+02  1.33520432e+03  1.33520432e+03  1.33520432e+03
  2.76681899e+03  3.02902505e+03  3.02902505e+03  3.02902505e+03
  6.64916026e+03  6.64916026e+03  6.64916026e+03  9.16513431e+03
  2.55151503e+04  7.62506501e+04]
E1 = -728.2856658654257  E_coul = 201.53560892600214
cycle= 1 E= -526.750056939424  delta_E= 1.14e-13  |g|= 9e-08  |ddm|= 6.21e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2856658654257  E_coul = 201.53560892600214
  HOMO = -0.58343849014343  LUMO = 0.900032676959642
  mo_energy =
[-1.18584007e+02 -1.23130313e+01 -9.56306768e+00 -9.56306768e+00
 -9.56306768e+00 -1.27066675e+00 -5.83438490e-01 -5.83438490e-01
 -5.83438490e-01  9.00032677e-01  1.01569845e+00  1.01569845e+00
  1.01569845e+00  7.33396230e+00  7.33396230e+00  7.33396230e+00
  9.21161427e+00  3.35507054e+01  3.35507054e+01  3.35507054e+01
  4.87687451e+01  1.29245824e+02  1.29245824e+02  1.29245824e+02
  1.87735876e+02  4.83643530e+02  4.83643530e+02  4.83643530e+02
  6.97559882e+02  1.33520432e+03  1.33520432e+03  1.33520432e+03
  2.76681899e+03  3.02902505e+03  3.02902505e+03  3.02902505e+03
  6.64916026e+03  6.64916026e+03  6.64916026e+03  9.16513431e+03
  2.55151503e+04  7.62506501e+04]
E1 = -728.2856656551934  E_coul = 201.5356087157706
Extra cycle  E= -526.750056939423  delta_E= 6.82e-13  |g|= 1.94e-08  |ddm|= 1.42e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826661e+04 7.61749965e+03 3.61736165e+03 1.59736393e+03
 3.82597394e+02 1.16102988e+02 4.22984191e+01 1.87886778e+01
 6.73213975e+00 6.42374883e-01 2.76491061e+00 2.29098358e-01
 1.36278665e+03 6.64711736e+02 3.00801942e+02 3.13904288e+02
 6.17235829e+01 7.34866075e+00 2.02535879e+01 7.77682594e-01
 2.83671933e+00 2.22687582e-01]
grad_E = [-1.56578912e-06  3.86912545e-06 -1.19392506e-06  8.98175422e-05
 -4.37945309e-04 -2.27804649e-05 -6.35116123e-04  3.51922879e-04
  4.27213984e-04 -2.15562240e-03 -7.69864706e-04  3.06075242e-03
 -5.13678642e-07  4.93046554e-06  2.32082508e-05  1.99979069e-05
 -1.59727548e-05 -1.71287450e-03  2.31253633e-04  3.69263104e-03
  3.11797998e-03 -1.09910510e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:52 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6668392        1
[INPUT] 0    0    [1    /1   ]  7617.49810717        1
[INPUT] 0    0    [1    /1   ]  3617.3623577         1
[INPUT] 0    0    [1    /1   ]  1597.3312945         1
[INPUT] 0    0    [1    /1   ]  382.615513692        1
[INPUT] 0    0    [1    /1   ]  116.504640601        1
[INPUT] 0    0    [1    /1   ]  42.9513464061        1
[INPUT] 0    0    [1    /1   ]  19.4813402886        1
[INPUT] 0    0    [1    /1   ]  6.78263396715        1
[INPUT] 0    0    [1    /1   ]  0.647902295626       1
[INPUT] 0    0    [1    /1   ]  2.76982419554        1
[INPUT] 0    0    [1    /1   ]  0.230014801731       1
[INPUT] 1    0    [1    /1   ]  1362.78688605        1
[INPUT] 1    0    [1    /1   ]  664.709441917        1
[INPUT] 1    0    [1    /1   ]  300.7911236          1
[INPUT] 1    0    [1    /1   ]  313.894961311        1
[INPUT] 1    0    [1    /1   ]  61.7311520139        1
[INPUT] 1    0    [1    /1   ]  7.36440692027        1
[INPUT] 1    0    [1    /1   ]  20.247096012         1
[INPUT] 1    0    [1    /1   ]  0.777625093999       1
[INPUT] 1    0    [1    /1   ]  2.83537800041        1
[INPUT] 1    0    [1    /1   ]  0.223156632244       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.66683922059, 1.0]], [0, [7617.49810716845, 1.0]], [0, [3617.3623577003614, 1.0]], [0, [1597.3312945014811, 1.0]], [0, [382.6155136923156, 1.0]], [0, [116.50464060061948, 1.0]], [0, [42.95134640610588, 1.0]], [0, [19.481340288605, 1.0]], [0, [6.782633967147308, 1.0]], [0, [0.6479022956262724, 1.0]], [0, [2.769824195535966, 1.0]], [0, [0.2300148017309372, 1.0]], [1, [1362.7868860460883, 1.0]], [1, [664.7094419168694, 1.0]], [1, [300.79112360021185, 1.0]], [1, [313.89496131077186, 1.0]], [1, [61.73115201385494, 1.0]], [1, [7.364406920269965, 1.0]], [1, [20.24709601203905, 1.0]], [1, [0.7776250939985672, 1.0]], [1, [2.8353780004058136, 1.0]], [1, [0.22315663224415563, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66683922]
bas 1, expnt(s) = [7617.49810717]
bas 2, expnt(s) = [3617.3623577]
bas 3, expnt(s) = [1597.3312945]
bas 4, expnt(s) = [382.61551369]
bas 5, expnt(s) = [116.5046406]
bas 6, expnt(s) = [42.95134641]
bas 7, expnt(s) = [19.48134029]
bas 8, expnt(s) = [6.78263397]
bas 9, expnt(s) = [0.6479023]
bas 10, expnt(s) = [2.7698242]
bas 11, expnt(s) = [0.2300148]
bas 12, expnt(s) = [1362.78688605]
bas 13, expnt(s) = [664.70944192]
bas 14, expnt(s) = [300.7911236]
bas 15, expnt(s) = [313.89496131]
bas 16, expnt(s) = [61.73115201]
bas 17, expnt(s) = [7.36440692]
bas 18, expnt(s) = [20.24709601]
bas 19, expnt(s) = [0.77762509]
bas 20, expnt(s) = [2.835378]
bas 21, expnt(s) = [0.22315663]
CPU time:       343.26
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826668e+04 5.20026450e+03 7.61749811e+03 2.06003354e+03
 3.61736236e+03 1.17844423e+03 1.59733129e+03 6.38353545e+02
 3.82615514e+02 2.18568190e+02 1.16504641e+02 8.95926624e+01
 4.29513464e+01 4.23884573e+01 1.94813403e+01 2.34276727e+01
 6.78263397e+00 1.06185156e+01 6.47902296e-01 1.82451385e+00
 2.76982420e+00 5.42443086e+00 2.30014802e-01 8.39135052e-01
 1.36278689e+03 2.41556832e+04 6.64709442e+02 9.84632581e+03
 3.00791124e+02 3.65439647e+03 3.13894961e+02 3.85447136e+03
 6.17311520e+01 5.04794797e+02 7.36440692e+00 3.53921230e+01
 2.02470960e+01 1.25296177e+02 7.77625094e-01 2.13033168e+00
 2.83537800e+00 1.07336665e+01 2.23156632e-01 4.47452193e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993728054650703
cond(S) = 114590.96485088735
E1 = -729.5419019727879  E_coul = 203.17527348731045
init E= -526.366628485477
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555762660466523  LUMO = 0.929093794064823
  mo_energy =
[-1.18332499e+02 -1.22069186e+01 -9.44718588e+00 -9.44718588e+00
 -9.44718588e+00 -1.24020278e+00 -5.55762660e-01 -5.55762660e-01
 -5.55762660e-01  9.29093794e-01  1.03643413e+00  1.03643413e+00
  1.03643413e+00  7.40983420e+00  7.40983420e+00  7.40983420e+00
  9.39136370e+00  3.37013233e+01  3.37013233e+01  3.37013233e+01
  5.01089976e+01  1.29468180e+02  1.29468180e+02  1.29468180e+02
  1.91916504e+02  4.83931852e+02  4.83931852e+02  4.83931852e+02
  7.04128819e+02  1.33552483e+03  1.33552483e+03  1.33552483e+03
  2.77387045e+03  3.02937964e+03  3.02937964e+03  3.02937964e+03
  6.64960514e+03  6.64960514e+03  6.64960514e+03  9.17194246e+03
  2.55217317e+04  7.62569158e+04]
E1 = -727.8423792188721  E_coul = 201.09296097610473
cycle= 1 E= -526.749418242767  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.569668
diis-c [-0.32452119  1.        ]
  HOMO = -0.590826795554212  LUMO = 0.903305123418176
  mo_energy =
[-1.18641884e+02 -1.23451652e+01 -9.59651304e+00 -9.59651304e+00
 -9.59651304e+00 -1.27966252e+00 -5.90826796e-01 -5.90826796e-01
 -5.90826796e-01  9.03305123e-01  1.01187640e+00  1.01187640e+00
  1.01187640e+00  7.31823432e+00  7.31823432e+00  7.31823432e+00
  9.29839239e+00  3.35461530e+01  3.35461530e+01  3.35461530e+01
  4.99492243e+01  1.29238534e+02  1.29238534e+02  1.29238534e+02
  1.91679381e+02  4.83623721e+02  4.83623721e+02  4.83623721e+02
  7.03782092e+02  1.33515987e+03  1.33515987e+03  1.33515987e+03
  2.77337323e+03  3.02894883e+03  3.02894883e+03  3.02894883e+03
  6.64906082e+03  6.64906082e+03  6.64906082e+03  9.17132382e+03
  2.55210180e+04  7.62561116e+04]
E1 = -728.4195512748812  E_coul = 201.66940334045896
cycle= 2 E= -526.750147934422  delta_E= -0.00073  |g|= 0.0379  |ddm|= 0.053
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0775278
diis-c [-0.00379928  0.0766681   0.9233319 ]
  HOMO = -0.581623087345001  LUMO = 0.910844601840683
  mo_energy =
[-1.18573334e+02 -1.23066647e+01 -9.55633645e+00 -9.55633645e+00
 -9.55633645e+00 -1.26863623e+00 -5.81623087e-01 -5.81623087e-01
 -5.81623087e-01  9.10844602e-01  1.01870061e+00  1.01870061e+00
  1.01870061e+00  7.34234468e+00  7.34234468e+00  7.34234468e+00
  9.32400095e+00  3.35867271e+01  3.35867271e+01  3.35867271e+01
  4.99924307e+01  1.29295122e+02  1.29295122e+02  1.29295122e+02
  1.91738160e+02  4.83691448e+02  4.83691448e+02  4.83691448e+02
  7.03851977e+02  1.33523169e+03  1.33523169e+03  1.33523169e+03
  2.77344828e+03  3.02902292e+03  3.02902292e+03  3.02902292e+03
  6.64913667e+03  6.64913667e+03  6.64913667e+03  9.17140046e+03
  2.55210953e+04  7.62561892e+04]
E1 = -728.2672798134477  E_coul = 201.51707233703203
cycle= 3 E= -526.750207476416  delta_E= -5.95e-05  |g|= 0.00662  |ddm|= 0.0162
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140784
diis-c [-8.54110066e-07 -1.31103583e-03  1.49210242e-01  8.52100794e-01]
  HOMO = -0.583191249162837  LUMO = 0.909657834071252
  mo_energy =
[-1.18583811e+02 -1.23127571e+01 -9.56279473e+00 -9.56279473e+00
 -9.56279473e+00 -1.27040114e+00 -5.83191249e-01 -5.83191249e-01
 -5.83191249e-01  9.09657834e-01  1.01756375e+00  1.01756375e+00
  1.01756375e+00  7.33837219e+00  7.33837219e+00  7.33837219e+00
  9.31988495e+00  3.35802454e+01  3.35802454e+01  3.35802454e+01
  4.99856275e+01  1.29286347e+02  1.29286347e+02  1.29286347e+02
  1.91729096e+02  4.83681093e+02  4.83681093e+02  4.83681093e+02
  7.03841274e+02  1.33522071e+03  1.33522071e+03  1.33522071e+03
  2.77343665e+03  3.02901153e+03  3.02901153e+03  3.02901153e+03
  6.64912488e+03  6.64912488e+03  6.64912488e+03  9.17138845e+03
  2.55210831e+04  7.62561768e+04]
E1 = -728.2911941356485  E_coul = 201.5409845442063
cycle= 4 E= -526.750209591442  delta_E= -2.12e-06  |g|= 0.000108  |ddm|= 0.00233
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00011923
diis-c [-5.23349732e-09  8.79995015e-05 -1.24796186e-02 -7.52754708e-02
  1.08766709e+00]
  HOMO = -0.583172160458504  LUMO = 0.909692147972015
  mo_energy =
[-1.18583760e+02 -1.23126861e+01 -9.56273798e+00 -9.56273798e+00
 -9.56273798e+00 -1.27035677e+00 -5.83172160e-01 -5.83172160e-01
 -5.83172160e-01  9.09692148e-01  1.01758049e+00  1.01758049e+00
  1.01758049e+00  7.33841715e+00  7.33841715e+00  7.33841715e+00
  9.31994584e+00  3.35803004e+01  3.35803004e+01  3.35803004e+01
  4.99856907e+01  1.29286403e+02  1.29286403e+02  1.29286403e+02
  1.91729153e+02  4.83681144e+02  4.83681144e+02  4.83681144e+02
  7.03841317e+02  1.33522075e+03  1.33522075e+03  1.33522075e+03
  2.77343668e+03  3.02901156e+03  3.02901156e+03  3.02901156e+03
  6.64912490e+03  6.64912490e+03  6.64912490e+03  9.17138846e+03
  2.55210831e+04  7.62561768e+04]
E1 = -728.2909492984197  E_coul = 201.54073970484367
cycle= 5 E= -526.750209593576  delta_E= -2.13e-09  |g|= 2.12e-05  |ddm|= 0.000176
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.9686e-05
diis-c [-9.75853694e-11  1.29548245e-05 -1.75900288e-03 -1.26956326e-02
  3.35911212e-02  9.80850559e-01]
  HOMO = -0.583180093922548  LUMO = 0.909688358944888
  mo_energy =
[-1.18583792e+02 -1.23127099e+01 -9.56276374e+00 -9.56276374e+00
 -9.56276374e+00 -1.27036307e+00 -5.83180094e-01 -5.83180094e-01
 -5.83180094e-01  9.09688359e-01  1.01757520e+00  1.01757520e+00
  1.01757520e+00  7.33839955e+00  7.33839955e+00  7.33839955e+00
  9.31992886e+00  3.35802754e+01  3.35802754e+01  3.35802754e+01
  4.99856653e+01  1.29286374e+02  1.29286374e+02  1.29286374e+02
  1.91729123e+02  4.83681112e+02  4.83681112e+02  4.83681112e+02
  7.03841285e+02  1.33522072e+03  1.33522072e+03  1.33522072e+03
  2.77343664e+03  3.02901153e+03  3.02901153e+03  3.02901153e+03
  6.64912486e+03  6.64912486e+03  6.64912486e+03  9.17138842e+03
  2.55210830e+04  7.62561768e+04]
E1 = -728.2910340162606  E_coul = 201.54082442262006
cycle= 6 E= -526.750209593641  delta_E= -6.45e-11  |g|= 1.87e-06  |ddm|= 2.02e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2910340162606  E_coul = 201.54082442262006
  HOMO = -0.583179980302768  LUMO = 0.909688796335965
  mo_energy =
[-1.18583791e+02 -1.23127092e+01 -9.56276318e+00 -9.56276318e+00
 -9.56276318e+00 -1.27036252e+00 -5.83179980e-01 -5.83179980e-01
 -5.83179980e-01  9.09688796e-01  1.01757533e+00  1.01757533e+00
  1.01757533e+00  7.33839993e+00  7.33839993e+00  7.33839993e+00
  9.31992941e+00  3.35802760e+01  3.35802760e+01  3.35802760e+01
  4.99856660e+01  1.29286374e+02  1.29286374e+02  1.29286374e+02
  1.91729124e+02  4.83681113e+02  4.83681113e+02  4.83681113e+02
  7.03841286e+02  1.33522072e+03  1.33522072e+03  1.33522072e+03
  2.77343664e+03  3.02901153e+03  3.02901153e+03  3.02901153e+03
  6.64912486e+03  6.64912486e+03  6.64912486e+03  9.17138842e+03
  2.55210830e+04  7.62561768e+04]
E1 = -728.2910310628631  E_coul = 201.5408214692213
Extra cycle  E= -526.750209593642  delta_E= -1.25e-12  |g|= 3.94e-07  |ddm|= 3.29e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826668e+04 7.61749811e+03 3.61736236e+03 1.59733129e+03
 3.82615514e+02 1.16504641e+02 4.29513464e+01 1.94813403e+01
 6.78263397e+00 6.47902296e-01 2.76982420e+00 2.30014802e-01
 1.36278689e+03 6.64709442e+02 3.00791124e+02 3.13894961e+02
 6.17311520e+01 7.36440692e+00 2.02470960e+01 7.77625094e-01
 2.83537800e+00 2.23156632e-01]
E = -526.7502095936418
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:53 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6668392        1
[INPUT] 0    0    [1    /1   ]  7617.49810717        1
[INPUT] 0    0    [1    /1   ]  3617.3623577         1
[INPUT] 0    0    [1    /1   ]  1597.3312945         1
[INPUT] 0    0    [1    /1   ]  382.615513692        1
[INPUT] 0    0    [1    /1   ]  116.504640601        1
[INPUT] 0    0    [1    /1   ]  42.9513464061        1
[INPUT] 0    0    [1    /1   ]  19.4813402886        1
[INPUT] 0    0    [1    /1   ]  6.78263396715        1
[INPUT] 0    0    [1    /1   ]  0.647902295626       1
[INPUT] 0    0    [1    /1   ]  2.76982419554        1
[INPUT] 0    0    [1    /1   ]  0.230014801731       1
[INPUT] 1    0    [1    /1   ]  1362.78688605        1
[INPUT] 1    0    [1    /1   ]  664.709441917        1
[INPUT] 1    0    [1    /1   ]  300.7911236          1
[INPUT] 1    0    [1    /1   ]  313.894961311        1
[INPUT] 1    0    [1    /1   ]  61.7311520139        1
[INPUT] 1    0    [1    /1   ]  7.36440692027        1
[INPUT] 1    0    [1    /1   ]  20.247096012         1
[INPUT] 1    0    [1    /1   ]  0.777625093999       1
[INPUT] 1    0    [1    /1   ]  2.83537800041        1
[INPUT] 1    0    [1    /1   ]  0.223156632244       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.66683922059, 1.0]], [0, [7617.49810716845, 1.0]], [0, [3617.3623577003614, 1.0]], [0, [1597.3312945014811, 1.0]], [0, [382.6155136923156, 1.0]], [0, [116.50464060061948, 1.0]], [0, [42.95134640610588, 1.0]], [0, [19.481340288605, 1.0]], [0, [6.782633967147308, 1.0]], [0, [0.6479022956262724, 1.0]], [0, [2.769824195535966, 1.0]], [0, [0.2300148017309372, 1.0]], [1, [1362.7868860460883, 1.0]], [1, [664.7094419168694, 1.0]], [1, [300.79112360021185, 1.0]], [1, [313.89496131077186, 1.0]], [1, [61.73115201385494, 1.0]], [1, [7.364406920269965, 1.0]], [1, [20.24709601203905, 1.0]], [1, [0.7776250939985672, 1.0]], [1, [2.8353780004058136, 1.0]], [1, [0.22315663224415563, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66683922]
bas 1, expnt(s) = [7617.49810717]
bas 2, expnt(s) = [3617.3623577]
bas 3, expnt(s) = [1597.3312945]
bas 4, expnt(s) = [382.61551369]
bas 5, expnt(s) = [116.5046406]
bas 6, expnt(s) = [42.95134641]
bas 7, expnt(s) = [19.48134029]
bas 8, expnt(s) = [6.78263397]
bas 9, expnt(s) = [0.6479023]
bas 10, expnt(s) = [2.7698242]
bas 11, expnt(s) = [0.2300148]
bas 12, expnt(s) = [1362.78688605]
bas 13, expnt(s) = [664.70944192]
bas 14, expnt(s) = [300.7911236]
bas 15, expnt(s) = [313.89496131]
bas 16, expnt(s) = [61.73115201]
bas 17, expnt(s) = [7.36440692]
bas 18, expnt(s) = [20.24709601]
bas 19, expnt(s) = [0.77762509]
bas 20, expnt(s) = [2.835378]
bas 21, expnt(s) = [0.22315663]
CPU time:       343.72
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826668e+04 5.20026450e+03 7.61749811e+03 2.06003354e+03
 3.61736236e+03 1.17844423e+03 1.59733129e+03 6.38353545e+02
 3.82615514e+02 2.18568190e+02 1.16504641e+02 8.95926624e+01
 4.29513464e+01 4.23884573e+01 1.94813403e+01 2.34276727e+01
 6.78263397e+00 1.06185156e+01 6.47902296e-01 1.82451385e+00
 2.76982420e+00 5.42443086e+00 2.30014802e-01 8.39135052e-01
 1.36278689e+03 2.41556832e+04 6.64709442e+02 9.84632581e+03
 3.00791124e+02 3.65439647e+03 3.13894961e+02 3.85447136e+03
 6.17311520e+01 5.04794797e+02 7.36440692e+00 3.53921230e+01
 2.02470960e+01 1.25296177e+02 7.77625094e-01 2.13033168e+00
 2.83537800e+00 1.07336665e+01 2.23156632e-01 4.47452193e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993728054650703
cond(S) = 114590.96485088735
E1 = -729.5419019727879  E_coul = 203.17527348731045
init E= -526.366628485477
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555762660466523  LUMO = 0.929093794064823
  mo_energy =
[-1.18332499e+02 -1.22069186e+01 -9.44718588e+00 -9.44718588e+00
 -9.44718588e+00 -1.24020278e+00 -5.55762660e-01 -5.55762660e-01
 -5.55762660e-01  9.29093794e-01  1.03643413e+00  1.03643413e+00
  1.03643413e+00  7.40983420e+00  7.40983420e+00  7.40983420e+00
  9.39136370e+00  3.37013233e+01  3.37013233e+01  3.37013233e+01
  5.01089976e+01  1.29468180e+02  1.29468180e+02  1.29468180e+02
  1.91916504e+02  4.83931852e+02  4.83931852e+02  4.83931852e+02
  7.04128819e+02  1.33552483e+03  1.33552483e+03  1.33552483e+03
  2.77387045e+03  3.02937964e+03  3.02937964e+03  3.02937964e+03
  6.64960514e+03  6.64960514e+03  6.64960514e+03  9.17194246e+03
  2.55217317e+04  7.62569158e+04]
E1 = -727.8423792188721  E_coul = 201.09296097610473
cycle= 1 E= -526.749418242767  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.569668
diis-c [-0.32452119  1.        ]
  HOMO = -0.590826795554212  LUMO = 0.903305123418176
  mo_energy =
[-1.18641884e+02 -1.23451652e+01 -9.59651304e+00 -9.59651304e+00
 -9.59651304e+00 -1.27966252e+00 -5.90826796e-01 -5.90826796e-01
 -5.90826796e-01  9.03305123e-01  1.01187640e+00  1.01187640e+00
  1.01187640e+00  7.31823432e+00  7.31823432e+00  7.31823432e+00
  9.29839239e+00  3.35461530e+01  3.35461530e+01  3.35461530e+01
  4.99492243e+01  1.29238534e+02  1.29238534e+02  1.29238534e+02
  1.91679381e+02  4.83623721e+02  4.83623721e+02  4.83623721e+02
  7.03782092e+02  1.33515987e+03  1.33515987e+03  1.33515987e+03
  2.77337323e+03  3.02894883e+03  3.02894883e+03  3.02894883e+03
  6.64906082e+03  6.64906082e+03  6.64906082e+03  9.17132382e+03
  2.55210180e+04  7.62561116e+04]
E1 = -728.4195512748812  E_coul = 201.66940334045896
cycle= 2 E= -526.750147934422  delta_E= -0.00073  |g|= 0.0379  |ddm|= 0.053
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0775278
diis-c [-0.00379928  0.0766681   0.9233319 ]
  HOMO = -0.581623087345001  LUMO = 0.910844601840683
  mo_energy =
[-1.18573334e+02 -1.23066647e+01 -9.55633645e+00 -9.55633645e+00
 -9.55633645e+00 -1.26863623e+00 -5.81623087e-01 -5.81623087e-01
 -5.81623087e-01  9.10844602e-01  1.01870061e+00  1.01870061e+00
  1.01870061e+00  7.34234468e+00  7.34234468e+00  7.34234468e+00
  9.32400095e+00  3.35867271e+01  3.35867271e+01  3.35867271e+01
  4.99924307e+01  1.29295122e+02  1.29295122e+02  1.29295122e+02
  1.91738160e+02  4.83691448e+02  4.83691448e+02  4.83691448e+02
  7.03851977e+02  1.33523169e+03  1.33523169e+03  1.33523169e+03
  2.77344828e+03  3.02902292e+03  3.02902292e+03  3.02902292e+03
  6.64913667e+03  6.64913667e+03  6.64913667e+03  9.17140046e+03
  2.55210953e+04  7.62561892e+04]
E1 = -728.2672798134477  E_coul = 201.51707233703203
cycle= 3 E= -526.750207476416  delta_E= -5.95e-05  |g|= 0.00662  |ddm|= 0.0162
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140784
diis-c [-8.54110066e-07 -1.31103583e-03  1.49210242e-01  8.52100794e-01]
  HOMO = -0.583191249162837  LUMO = 0.909657834071252
  mo_energy =
[-1.18583811e+02 -1.23127571e+01 -9.56279473e+00 -9.56279473e+00
 -9.56279473e+00 -1.27040114e+00 -5.83191249e-01 -5.83191249e-01
 -5.83191249e-01  9.09657834e-01  1.01756375e+00  1.01756375e+00
  1.01756375e+00  7.33837219e+00  7.33837219e+00  7.33837219e+00
  9.31988495e+00  3.35802454e+01  3.35802454e+01  3.35802454e+01
  4.99856275e+01  1.29286347e+02  1.29286347e+02  1.29286347e+02
  1.91729096e+02  4.83681093e+02  4.83681093e+02  4.83681093e+02
  7.03841274e+02  1.33522071e+03  1.33522071e+03  1.33522071e+03
  2.77343665e+03  3.02901153e+03  3.02901153e+03  3.02901153e+03
  6.64912488e+03  6.64912488e+03  6.64912488e+03  9.17138845e+03
  2.55210831e+04  7.62561768e+04]
E1 = -728.2911941356485  E_coul = 201.5409845442063
cycle= 4 E= -526.750209591442  delta_E= -2.12e-06  |g|= 0.000108  |ddm|= 0.00233
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00011923
diis-c [-5.23349732e-09  8.79995015e-05 -1.24796186e-02 -7.52754708e-02
  1.08766709e+00]
  HOMO = -0.583172160458504  LUMO = 0.909692147972015
  mo_energy =
[-1.18583760e+02 -1.23126861e+01 -9.56273798e+00 -9.56273798e+00
 -9.56273798e+00 -1.27035677e+00 -5.83172160e-01 -5.83172160e-01
 -5.83172160e-01  9.09692148e-01  1.01758049e+00  1.01758049e+00
  1.01758049e+00  7.33841715e+00  7.33841715e+00  7.33841715e+00
  9.31994584e+00  3.35803004e+01  3.35803004e+01  3.35803004e+01
  4.99856907e+01  1.29286403e+02  1.29286403e+02  1.29286403e+02
  1.91729153e+02  4.83681144e+02  4.83681144e+02  4.83681144e+02
  7.03841317e+02  1.33522075e+03  1.33522075e+03  1.33522075e+03
  2.77343668e+03  3.02901156e+03  3.02901156e+03  3.02901156e+03
  6.64912490e+03  6.64912490e+03  6.64912490e+03  9.17138846e+03
  2.55210831e+04  7.62561768e+04]
E1 = -728.2909492984197  E_coul = 201.54073970484367
cycle= 5 E= -526.750209593576  delta_E= -2.13e-09  |g|= 2.12e-05  |ddm|= 0.000176
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.9686e-05
diis-c [-9.75853694e-11  1.29548245e-05 -1.75900288e-03 -1.26956326e-02
  3.35911212e-02  9.80850559e-01]
  HOMO = -0.583180093922548  LUMO = 0.909688358944888
  mo_energy =
[-1.18583792e+02 -1.23127099e+01 -9.56276374e+00 -9.56276374e+00
 -9.56276374e+00 -1.27036307e+00 -5.83180094e-01 -5.83180094e-01
 -5.83180094e-01  9.09688359e-01  1.01757520e+00  1.01757520e+00
  1.01757520e+00  7.33839955e+00  7.33839955e+00  7.33839955e+00
  9.31992886e+00  3.35802754e+01  3.35802754e+01  3.35802754e+01
  4.99856653e+01  1.29286374e+02  1.29286374e+02  1.29286374e+02
  1.91729123e+02  4.83681112e+02  4.83681112e+02  4.83681112e+02
  7.03841285e+02  1.33522072e+03  1.33522072e+03  1.33522072e+03
  2.77343664e+03  3.02901153e+03  3.02901153e+03  3.02901153e+03
  6.64912486e+03  6.64912486e+03  6.64912486e+03  9.17138842e+03
  2.55210830e+04  7.62561768e+04]
E1 = -728.2910340162606  E_coul = 201.54082442262006
cycle= 6 E= -526.750209593641  delta_E= -6.45e-11  |g|= 1.87e-06  |ddm|= 2.02e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2910340162606  E_coul = 201.54082442262006
  HOMO = -0.583179980302768  LUMO = 0.909688796335965
  mo_energy =
[-1.18583791e+02 -1.23127092e+01 -9.56276318e+00 -9.56276318e+00
 -9.56276318e+00 -1.27036252e+00 -5.83179980e-01 -5.83179980e-01
 -5.83179980e-01  9.09688796e-01  1.01757533e+00  1.01757533e+00
  1.01757533e+00  7.33839993e+00  7.33839993e+00  7.33839993e+00
  9.31992941e+00  3.35802760e+01  3.35802760e+01  3.35802760e+01
  4.99856660e+01  1.29286374e+02  1.29286374e+02  1.29286374e+02
  1.91729124e+02  4.83681113e+02  4.83681113e+02  4.83681113e+02
  7.03841286e+02  1.33522072e+03  1.33522072e+03  1.33522072e+03
  2.77343664e+03  3.02901153e+03  3.02901153e+03  3.02901153e+03
  6.64912486e+03  6.64912486e+03  6.64912486e+03  9.17138842e+03
  2.55210830e+04  7.62561768e+04]
E1 = -728.2910310628631  E_coul = 201.5408214692213
Extra cycle  E= -526.750209593642  delta_E= -1.25e-12  |g|= 3.94e-07  |ddm|= 3.29e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114590.96485088735
E1 = -728.2910310628631  E_coul = 201.5408214692213
init E= -526.750209593642
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583180053038614  LUMO = 0.909688810768699
  mo_energy =
[-1.18583792e+02 -1.23127094e+01 -9.56276342e+00 -9.56276342e+00
 -9.56276342e+00 -1.27036253e+00 -5.83180053e-01 -5.83180053e-01
 -5.83180053e-01  9.09688811e-01  1.01757529e+00  1.01757529e+00
  1.01757529e+00  7.33839978e+00  7.33839978e+00  7.33839978e+00
  9.31992929e+00  3.35802757e+01  3.35802757e+01  3.35802757e+01
  4.99856658e+01  1.29286374e+02  1.29286374e+02  1.29286374e+02
  1.91729124e+02  4.83681113e+02  4.83681113e+02  4.83681113e+02
  7.03841286e+02  1.33522072e+03  1.33522072e+03  1.33522072e+03
  2.77343664e+03  3.02901153e+03  3.02901153e+03  3.02901153e+03
  6.64912486e+03  6.64912486e+03  6.64912486e+03  9.17138842e+03
  2.55210830e+04  7.62561768e+04]
E1 = -728.2910317424119  E_coul = 201.54082214877053
cycle= 1 E= -526.750209593641  delta_E= 4.55e-13  |g|= 9.09e-08  |ddm|= 6.13e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2910317424119  E_coul = 201.54082214877053
  HOMO = -0.583180043301721  LUMO = 0.909688833274749
  mo_energy =
[-1.18583792e+02 -1.23127094e+01 -9.56276337e+00 -9.56276337e+00
 -9.56276337e+00 -1.27036250e+00 -5.83180043e-01 -5.83180043e-01
 -5.83180043e-01  9.09688833e-01  1.01757530e+00  1.01757530e+00
  1.01757530e+00  7.33839981e+00  7.33839981e+00  7.33839981e+00
  9.31992933e+00  3.35802758e+01  3.35802758e+01  3.35802758e+01
  4.99856658e+01  1.29286374e+02  1.29286374e+02  1.29286374e+02
  1.91729124e+02  4.83681113e+02  4.83681113e+02  4.83681113e+02
  7.03841286e+02  1.33522072e+03  1.33522072e+03  1.33522072e+03
  2.77343664e+03  3.02901153e+03  3.02901153e+03  3.02901153e+03
  6.64912486e+03  6.64912486e+03  6.64912486e+03  9.17138842e+03
  2.55210830e+04  7.62561768e+04]
E1 = -728.2910315199007  E_coul = 201.54082192625893
Extra cycle  E= -526.750209593642  delta_E= -4.55e-13  |g|= 1.98e-08  |ddm|= 1.41e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826668e+04 7.61749811e+03 3.61736236e+03 1.59733129e+03
 3.82615514e+02 1.16504641e+02 4.29513464e+01 1.94813403e+01
 6.78263397e+00 6.47902296e-01 2.76982420e+00 2.30014802e-01
 1.36278689e+03 6.64709442e+02 3.00791124e+02 3.13894961e+02
 6.17311520e+01 7.36440692e+00 2.02470960e+01 7.77625094e-01
 2.83537800e+00 2.23156632e-01]
grad_E = [-1.56631850e-06  3.87568422e-06 -1.18812639e-06  9.00320286e-05
 -4.37412192e-04 -8.01689179e-05 -4.73558019e-04  3.38746649e-04
  4.68496270e-04 -3.80294802e-04 -1.01537620e-03 -1.44629327e-04
 -5.22115244e-07  4.81232330e-06  2.24922297e-05  1.93831915e-05
  6.77147000e-05  5.96764559e-04 -4.89505252e-04 -6.96834668e-04
  5.97883999e-04  3.63098263e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:57 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.667382         1
[INPUT] 0    0    [1    /1   ]  7617.49690693        1
[INPUT] 0    0    [1    /1   ]  3617.3629067         1
[INPUT] 0    0    [1    /1   ]  1597.30586966        1
[INPUT] 0    0    [1    /1   ]  382.632738265        1
[INPUT] 0    0    [1    /1   ]  116.78683426         1
[INPUT] 0    0    [1    /1   ]  43.526200038         1
[INPUT] 0    0    [1    /1   ]  20.0463093953        1
[INPUT] 0    0    [1    /1   ]  6.83972933573        1
[INPUT] 0    0    [1    /1   ]  0.651023794818       1
[INPUT] 0    0    [1    /1   ]  2.79383286087        1
[INPUT] 0    0    [1    /1   ]  0.231063206706       1
[INPUT] 1    0    [1    /1   ]  1362.78706728        1
[INPUT] 1    0    [1    /1   ]  664.707662817        1
[INPUT] 1    0    [1    /1   ]  300.782737804        1
[INPUT] 1    0    [1    /1   ]  313.887731851        1
[INPUT] 1    0    [1    /1   ]  61.7356764003        1
[INPUT] 1    0    [1    /1   ]  7.36174564996        1
[INPUT] 1    0    [1    /1   ]  20.2518440676        1
[INPUT] 1    0    [1    /1   ]  0.776582953685       1
[INPUT] 1    0    [1    /1   ]  2.825394595          1
[INPUT] 1    0    [1    /1   ]  0.2231001171         1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.667382043608, 1.0]], [0, [7617.496906928407, 1.0]], [0, [3617.362906703653, 1.0]], [0, [1597.305869658232, 1.0]], [0, [382.63273826517434, 1.0]], [0, [116.78683426037814, 1.0]], [0, [43.52620003801794, 1.0]], [0, [20.04630939529996, 1.0]], [0, [6.839729335731038, 1.0]], [0, [0.6510237948176297, 1.0]], [0, [2.793832860874116, 1.0]], [0, [0.23106320670572633, 1.0]], [1, [1362.7870672782485, 1.0]], [1, [664.7076628168345, 1.0]], [1, [300.7827378036768, 1.0]], [1, [313.8877318512411, 1.0]], [1, [61.735676400272844, 1.0]], [1, [7.361745649961288, 1.0]], [1, [20.25184406764553, 1.0]], [1, [0.7765829536845501, 1.0]], [1, [2.8253945950040653, 1.0]], [1, [0.2231001171002085, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66738204]
bas 1, expnt(s) = [7617.49690693]
bas 2, expnt(s) = [3617.3629067]
bas 3, expnt(s) = [1597.30586966]
bas 4, expnt(s) = [382.63273827]
bas 5, expnt(s) = [116.78683426]
bas 6, expnt(s) = [43.52620004]
bas 7, expnt(s) = [20.0463094]
bas 8, expnt(s) = [6.83972934]
bas 9, expnt(s) = [0.65102379]
bas 10, expnt(s) = [2.79383286]
bas 11, expnt(s) = [0.23106321]
bas 12, expnt(s) = [1362.78706728]
bas 13, expnt(s) = [664.70766282]
bas 14, expnt(s) = [300.7827378]
bas 15, expnt(s) = [313.88773185]
bas 16, expnt(s) = [61.7356764]
bas 17, expnt(s) = [7.36174565]
bas 18, expnt(s) = [20.25184407]
bas 19, expnt(s) = [0.77658295]
bas 20, expnt(s) = [2.8253946]
bas 21, expnt(s) = [0.22310012]
CPU time:       349.43
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826674e+04 5.20026458e+03 7.61749691e+03 2.06003329e+03
 3.61736291e+03 1.17844437e+03 1.59730587e+03 6.38345924e+02
 3.82632738e+02 2.18575569e+02 1.16786834e+02 8.97553694e+01
 4.35262000e+01 4.28132394e+01 2.00463094e+01 2.39354086e+01
 6.83972934e+00 1.06854843e+01 6.51023795e-01 1.83110256e+00
 2.79383286e+00 5.45965676e+00 2.31063207e-01 8.42001997e-01
 1.36278707e+03 2.41556872e+04 6.64707663e+02 9.84629287e+03
 3.00782738e+02 3.65426912e+03 3.13887732e+02 3.85436039e+03
 6.17356764e+01 5.04841044e+02 7.36174565e+00 3.53761367e+01
 2.02518441e+01 1.25332906e+02 7.76582954e-01 2.12676355e+00
 2.82539460e+00 1.06864456e+01 2.23100117e-01 4.47310549e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993741897878536
cond(S) = 114693.66409551188
E1 = -729.5422726710754  E_coul = 203.17549452280966
init E= -526.366778148266
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555750248369565  LUMO = 0.937422532189294
  mo_energy =
[-1.18332560e+02 -1.22068793e+01 -9.44716973e+00 -9.44716973e+00
 -9.44716973e+00 -1.24019726e+00 -5.55750248e-01 -5.55750248e-01
 -5.55750248e-01  9.37422532e-01  1.03524283e+00  1.03524283e+00
  1.03524283e+00  7.38795642e+00  7.38795642e+00  7.38795642e+00
  9.52933254e+00  3.36587578e+01  3.36587578e+01  3.36587578e+01
  5.12421550e+01  1.29439495e+02  1.29439495e+02  1.29439495e+02
  1.95366311e+02  4.83918009e+02  4.83918009e+02  4.83918009e+02
  7.09420338e+02  1.33550048e+03  1.33550048e+03  1.33550048e+03
  2.77939302e+03  3.02933503e+03  3.02933503e+03  3.02933503e+03
  6.64954666e+03  6.64954666e+03  6.64954666e+03  9.17715460e+03
  2.55266761e+04  7.62615223e+04]
E1 = -727.8445200471554  E_coul = 201.0950172258279
cycle= 1 E= -526.749502821327  delta_E= -0.383  |g|= 0.187  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.570388
diis-c [-0.32534301  1.        ]
  HOMO = -0.590751039820912  LUMO = 0.911455587862178
  mo_energy =
[-1.18641788e+02 -1.23450246e+01 -9.59636294e+00 -9.59636294e+00
 -9.59636294e+00 -1.27959021e+00 -5.90751040e-01 -5.90751040e-01
 -5.90751040e-01  9.11455588e-01  1.01077861e+00  1.01077861e+00
  1.01077861e+00  7.29660078e+00  7.29660078e+00  7.29660078e+00
  9.43572705e+00  3.35037003e+01  3.35037003e+01  3.35037003e+01
  5.10811862e+01  1.29209993e+02  1.29209993e+02  1.29209993e+02
  1.95128503e+02  4.83610018e+02  4.83610018e+02  4.83610018e+02
  7.09073688e+02  1.33513571e+03  1.33513571e+03  1.33513571e+03
  2.77889603e+03  3.02890439e+03  3.02890439e+03  3.02890439e+03
  6.64900250e+03  6.64900250e+03  6.64900250e+03  9.17653616e+03
  2.55259627e+04  7.62607183e+04]
E1 = -728.4211371111331  E_coul = 201.67090592787784
cycle= 2 E= -526.750231183255  delta_E= -0.000728  |g|= 0.0379  |ddm|= 0.053
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0774654
diis-c [-0.00381001  0.07625169  0.92374831]
  HOMO = -0.58155323124612  LUMO = 0.919052819502666
  mo_energy =
[-1.18573263e+02 -1.23065464e+01 -9.55620782e+00 -9.55620782e+00
 -9.55620782e+00 -1.26857006e+00 -5.81553231e-01 -5.81553231e-01
 -5.81553231e-01  9.19052820e-01  1.01758667e+00  1.01758667e+00
  1.01758667e+00  7.32066192e+00  7.32066192e+00  7.32066192e+00
  9.46151532e+00  3.35442540e+01  3.35442540e+01  3.35442540e+01
  5.11246961e+01  1.29266561e+02  1.29266561e+02  1.29266561e+02
  1.95187400e+02  4.83677721e+02  4.83677721e+02  4.83677721e+02
  7.09143553e+02  1.33520750e+03  1.33520750e+03  1.33520750e+03
  2.77897105e+03  3.02897845e+03  3.02897845e+03  3.02897845e+03
  6.64907832e+03  6.64907832e+03  6.64907832e+03  9.17661278e+03
  2.55260399e+04  7.62607958e+04]
E1 = -728.268947863285  E_coul = 201.51865726114414
cycle= 3 E= -526.750290602141  delta_E= -5.94e-05  |g|= 0.00663  |ddm|= 0.0162
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141026
diis-c [-8.48665758e-07 -1.30997193e-03  1.49557060e-01  8.51752912e-01]
  HOMO = -0.58312379419981  LUMO = 0.917854268562184
  mo_energy =
[-1.18583762e+02 -1.23126509e+01 -9.56267817e+00 -9.56267817e+00
 -9.56267817e+00 -1.27033786e+00 -5.83123794e-01 -5.83123794e-01
 -5.83123794e-01  9.17854269e-01  1.01645009e+00  1.01645009e+00
  1.01645009e+00  7.31668819e+00  7.31668819e+00  7.31668819e+00
  9.45736108e+00  3.35377599e+01  3.35377599e+01  3.35377599e+01
  5.11178316e+01  1.29257767e+02  1.29257767e+02  1.29257767e+02
  1.95178296e+02  4.83667344e+02  4.83667344e+02  4.83667344e+02
  7.09132827e+02  1.33519650e+03  1.33519650e+03  1.33519650e+03
  2.77895941e+03  3.02896704e+03  3.02896704e+03  3.02896704e+03
  6.64906651e+03  6.64906651e+03  6.64906651e+03  9.17660075e+03
  2.55260277e+04  7.62607835e+04]
E1 = -728.2929081703352  E_coul = 201.5426154453513
cycle= 4 E= -526.750292724984  delta_E= -2.12e-06  |g|= 0.000108  |ddm|= 0.00234
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000118303
diis-c [-5.20795028e-09  8.74652661e-05 -1.24230096e-02 -7.47004733e-02
  1.08703602e+00]
  HOMO = -0.583104572390847  LUMO = 0.91788893751365
  mo_energy =
[-1.18583711e+02 -1.23125795e+01 -9.56262102e+00 -9.56262102e+00
 -9.56262102e+00 -1.27029332e+00 -5.83104572e-01 -5.83104572e-01
 -5.83104572e-01  9.17888938e-01  1.01646691e+00  1.01646691e+00
  1.01646691e+00  7.31673339e+00  7.31673339e+00  7.31673339e+00
  9.45742238e+00  3.35378152e+01  3.35378152e+01  3.35378152e+01
  5.11178951e+01  1.29257824e+02  1.29257824e+02  1.29257824e+02
  1.95178353e+02  4.83667395e+02  4.83667395e+02  4.83667395e+02
  7.09132871e+02  1.33519654e+03  1.33519654e+03  1.33519654e+03
  2.77895943e+03  3.02896708e+03  3.02896708e+03  3.02896708e+03
  6.64906653e+03  6.64906653e+03  6.64906653e+03  9.17660076e+03
  2.55260277e+04  7.62607835e+04]
E1 = -728.2926624257625  E_coul = 201.54236969863715
cycle= 5 E= -526.750292727125  delta_E= -2.14e-09  |g|= 2.13e-05  |ddm|= 0.000176
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.97691e-05
diis-c [-9.70671401e-11  1.30075475e-05 -1.77228672e-03 -1.27420435e-02
  3.30386308e-02  9.81462692e-01]
  HOMO = -0.583112491762956  LUMO = 0.917885138768274
  mo_energy =
[-1.18583743e+02 -1.23126033e+01 -9.56264676e+00 -9.56264676e+00
 -9.56264676e+00 -1.27029959e+00 -5.83112492e-01 -5.83112492e-01
 -5.83112492e-01  9.17885139e-01  1.01646164e+00  1.01646164e+00
  1.01646164e+00  7.31671583e+00  7.31671583e+00  7.31671583e+00
  9.45740532e+00  3.35377903e+01  3.35377903e+01  3.35377903e+01
  5.11178697e+01  1.29257794e+02  1.29257794e+02  1.29257794e+02
  1.95178324e+02  4.83667364e+02  4.83667364e+02  4.83667364e+02
  7.09132838e+02  1.33519651e+03  1.33519651e+03  1.33519651e+03
  2.77895940e+03  3.02896704e+03  3.02896704e+03  3.02896704e+03
  6.64906649e+03  6.64906649e+03  6.64906649e+03  9.17660072e+03
  2.55260276e+04  7.62607834e+04]
E1 = -728.2927471268482  E_coul = 201.54245439966053
cycle= 6 E= -526.750292727188  delta_E= -6.23e-11  |g|= 1.86e-06  |ddm|= 2.02e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2927471268482  E_coul = 201.54245439966053
  HOMO = -0.583112378750584  LUMO = 0.917885577138663
  mo_energy =
[-1.18583742e+02 -1.23126026e+01 -9.56264621e+00 -9.56264621e+00
 -9.56264621e+00 -1.27029905e+00 -5.83112379e-01 -5.83112379e-01
 -5.83112379e-01  9.17885577e-01  1.01646178e+00  1.01646178e+00
  1.01646178e+00  7.31671621e+00  7.31671621e+00  7.31671621e+00
  9.45740587e+00  3.35377909e+01  3.35377909e+01  3.35377909e+01
  5.11178703e+01  1.29257795e+02  1.29257795e+02  1.29257795e+02
  1.95178325e+02  4.83667365e+02  4.83667365e+02  4.83667365e+02
  7.09132839e+02  1.33519651e+03  1.33519651e+03  1.33519651e+03
  2.77895940e+03  3.02896704e+03  3.02896704e+03  3.02896704e+03
  6.64906649e+03  6.64906649e+03  6.64906649e+03  9.17660072e+03
  2.55260276e+04  7.62607834e+04]
E1 = -728.292744216794  E_coul = 201.5424514896047
Extra cycle  E= -526.750292727189  delta_E= -1.59e-12  |g|= 3.92e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826674e+04 7.61749691e+03 3.61736291e+03 1.59730587e+03
 3.82632738e+02 1.16786834e+02 4.35262000e+01 2.00463094e+01
 6.83972934e+00 6.51023795e-01 2.79383286e+00 2.31063207e-01
 1.36278707e+03 6.64707663e+02 3.00782738e+02 3.13887732e+02
 6.17356764e+01 7.36174565e+00 2.02518441e+01 7.76582954e-01
 2.82539460e+00 2.23100117e-01]
E = -526.7502927271893
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:25:58 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.667382         1
[INPUT] 0    0    [1    /1   ]  7617.49690693        1
[INPUT] 0    0    [1    /1   ]  3617.3629067         1
[INPUT] 0    0    [1    /1   ]  1597.30586966        1
[INPUT] 0    0    [1    /1   ]  382.632738265        1
[INPUT] 0    0    [1    /1   ]  116.78683426         1
[INPUT] 0    0    [1    /1   ]  43.526200038         1
[INPUT] 0    0    [1    /1   ]  20.0463093953        1
[INPUT] 0    0    [1    /1   ]  6.83972933573        1
[INPUT] 0    0    [1    /1   ]  0.651023794818       1
[INPUT] 0    0    [1    /1   ]  2.79383286087        1
[INPUT] 0    0    [1    /1   ]  0.231063206706       1
[INPUT] 1    0    [1    /1   ]  1362.78706728        1
[INPUT] 1    0    [1    /1   ]  664.707662817        1
[INPUT] 1    0    [1    /1   ]  300.782737804        1
[INPUT] 1    0    [1    /1   ]  313.887731851        1
[INPUT] 1    0    [1    /1   ]  61.7356764003        1
[INPUT] 1    0    [1    /1   ]  7.36174564996        1
[INPUT] 1    0    [1    /1   ]  20.2518440676        1
[INPUT] 1    0    [1    /1   ]  0.776582953685       1
[INPUT] 1    0    [1    /1   ]  2.825394595          1
[INPUT] 1    0    [1    /1   ]  0.2231001171         1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.667382043608, 1.0]], [0, [7617.496906928407, 1.0]], [0, [3617.362906703653, 1.0]], [0, [1597.305869658232, 1.0]], [0, [382.63273826517434, 1.0]], [0, [116.78683426037814, 1.0]], [0, [43.52620003801794, 1.0]], [0, [20.04630939529996, 1.0]], [0, [6.839729335731038, 1.0]], [0, [0.6510237948176297, 1.0]], [0, [2.793832860874116, 1.0]], [0, [0.23106320670572633, 1.0]], [1, [1362.7870672782485, 1.0]], [1, [664.7076628168345, 1.0]], [1, [300.7827378036768, 1.0]], [1, [313.8877318512411, 1.0]], [1, [61.735676400272844, 1.0]], [1, [7.361745649961288, 1.0]], [1, [20.25184406764553, 1.0]], [1, [0.7765829536845501, 1.0]], [1, [2.8253945950040653, 1.0]], [1, [0.2231001171002085, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66738204]
bas 1, expnt(s) = [7617.49690693]
bas 2, expnt(s) = [3617.3629067]
bas 3, expnt(s) = [1597.30586966]
bas 4, expnt(s) = [382.63273827]
bas 5, expnt(s) = [116.78683426]
bas 6, expnt(s) = [43.52620004]
bas 7, expnt(s) = [20.0463094]
bas 8, expnt(s) = [6.83972934]
bas 9, expnt(s) = [0.65102379]
bas 10, expnt(s) = [2.79383286]
bas 11, expnt(s) = [0.23106321]
bas 12, expnt(s) = [1362.78706728]
bas 13, expnt(s) = [664.70766282]
bas 14, expnt(s) = [300.7827378]
bas 15, expnt(s) = [313.88773185]
bas 16, expnt(s) = [61.7356764]
bas 17, expnt(s) = [7.36174565]
bas 18, expnt(s) = [20.25184407]
bas 19, expnt(s) = [0.77658295]
bas 20, expnt(s) = [2.8253946]
bas 21, expnt(s) = [0.22310012]
CPU time:       349.90
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826674e+04 5.20026458e+03 7.61749691e+03 2.06003329e+03
 3.61736291e+03 1.17844437e+03 1.59730587e+03 6.38345924e+02
 3.82632738e+02 2.18575569e+02 1.16786834e+02 8.97553694e+01
 4.35262000e+01 4.28132394e+01 2.00463094e+01 2.39354086e+01
 6.83972934e+00 1.06854843e+01 6.51023795e-01 1.83110256e+00
 2.79383286e+00 5.45965676e+00 2.31063207e-01 8.42001997e-01
 1.36278707e+03 2.41556872e+04 6.64707663e+02 9.84629287e+03
 3.00782738e+02 3.65426912e+03 3.13887732e+02 3.85436039e+03
 6.17356764e+01 5.04841044e+02 7.36174565e+00 3.53761367e+01
 2.02518441e+01 1.25332906e+02 7.76582954e-01 2.12676355e+00
 2.82539460e+00 1.06864456e+01 2.23100117e-01 4.47310549e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993741897878536
cond(S) = 114693.66409551188
E1 = -729.5422726710754  E_coul = 203.17549452280966
init E= -526.366778148266
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555750248369565  LUMO = 0.937422532189294
  mo_energy =
[-1.18332560e+02 -1.22068793e+01 -9.44716973e+00 -9.44716973e+00
 -9.44716973e+00 -1.24019726e+00 -5.55750248e-01 -5.55750248e-01
 -5.55750248e-01  9.37422532e-01  1.03524283e+00  1.03524283e+00
  1.03524283e+00  7.38795642e+00  7.38795642e+00  7.38795642e+00
  9.52933254e+00  3.36587578e+01  3.36587578e+01  3.36587578e+01
  5.12421550e+01  1.29439495e+02  1.29439495e+02  1.29439495e+02
  1.95366311e+02  4.83918009e+02  4.83918009e+02  4.83918009e+02
  7.09420338e+02  1.33550048e+03  1.33550048e+03  1.33550048e+03
  2.77939302e+03  3.02933503e+03  3.02933503e+03  3.02933503e+03
  6.64954666e+03  6.64954666e+03  6.64954666e+03  9.17715460e+03
  2.55266761e+04  7.62615223e+04]
E1 = -727.8445200471554  E_coul = 201.0950172258279
cycle= 1 E= -526.749502821327  delta_E= -0.383  |g|= 0.187  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.570388
diis-c [-0.32534301  1.        ]
  HOMO = -0.590751039820912  LUMO = 0.911455587862178
  mo_energy =
[-1.18641788e+02 -1.23450246e+01 -9.59636294e+00 -9.59636294e+00
 -9.59636294e+00 -1.27959021e+00 -5.90751040e-01 -5.90751040e-01
 -5.90751040e-01  9.11455588e-01  1.01077861e+00  1.01077861e+00
  1.01077861e+00  7.29660078e+00  7.29660078e+00  7.29660078e+00
  9.43572705e+00  3.35037003e+01  3.35037003e+01  3.35037003e+01
  5.10811862e+01  1.29209993e+02  1.29209993e+02  1.29209993e+02
  1.95128503e+02  4.83610018e+02  4.83610018e+02  4.83610018e+02
  7.09073688e+02  1.33513571e+03  1.33513571e+03  1.33513571e+03
  2.77889603e+03  3.02890439e+03  3.02890439e+03  3.02890439e+03
  6.64900250e+03  6.64900250e+03  6.64900250e+03  9.17653616e+03
  2.55259627e+04  7.62607183e+04]
E1 = -728.4211371111331  E_coul = 201.67090592787784
cycle= 2 E= -526.750231183255  delta_E= -0.000728  |g|= 0.0379  |ddm|= 0.053
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0774654
diis-c [-0.00381001  0.07625169  0.92374831]
  HOMO = -0.58155323124612  LUMO = 0.919052819502666
  mo_energy =
[-1.18573263e+02 -1.23065464e+01 -9.55620782e+00 -9.55620782e+00
 -9.55620782e+00 -1.26857006e+00 -5.81553231e-01 -5.81553231e-01
 -5.81553231e-01  9.19052820e-01  1.01758667e+00  1.01758667e+00
  1.01758667e+00  7.32066192e+00  7.32066192e+00  7.32066192e+00
  9.46151532e+00  3.35442540e+01  3.35442540e+01  3.35442540e+01
  5.11246961e+01  1.29266561e+02  1.29266561e+02  1.29266561e+02
  1.95187400e+02  4.83677721e+02  4.83677721e+02  4.83677721e+02
  7.09143553e+02  1.33520750e+03  1.33520750e+03  1.33520750e+03
  2.77897105e+03  3.02897845e+03  3.02897845e+03  3.02897845e+03
  6.64907832e+03  6.64907832e+03  6.64907832e+03  9.17661278e+03
  2.55260399e+04  7.62607958e+04]
E1 = -728.268947863285  E_coul = 201.51865726114414
cycle= 3 E= -526.750290602141  delta_E= -5.94e-05  |g|= 0.00663  |ddm|= 0.0162
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141026
diis-c [-8.48665758e-07 -1.30997193e-03  1.49557060e-01  8.51752912e-01]
  HOMO = -0.58312379419981  LUMO = 0.917854268562184
  mo_energy =
[-1.18583762e+02 -1.23126509e+01 -9.56267817e+00 -9.56267817e+00
 -9.56267817e+00 -1.27033786e+00 -5.83123794e-01 -5.83123794e-01
 -5.83123794e-01  9.17854269e-01  1.01645009e+00  1.01645009e+00
  1.01645009e+00  7.31668819e+00  7.31668819e+00  7.31668819e+00
  9.45736108e+00  3.35377599e+01  3.35377599e+01  3.35377599e+01
  5.11178316e+01  1.29257767e+02  1.29257767e+02  1.29257767e+02
  1.95178296e+02  4.83667344e+02  4.83667344e+02  4.83667344e+02
  7.09132827e+02  1.33519650e+03  1.33519650e+03  1.33519650e+03
  2.77895941e+03  3.02896704e+03  3.02896704e+03  3.02896704e+03
  6.64906651e+03  6.64906651e+03  6.64906651e+03  9.17660075e+03
  2.55260277e+04  7.62607835e+04]
E1 = -728.2929081703352  E_coul = 201.5426154453513
cycle= 4 E= -526.750292724984  delta_E= -2.12e-06  |g|= 0.000108  |ddm|= 0.00234
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000118303
diis-c [-5.20795028e-09  8.74652661e-05 -1.24230096e-02 -7.47004733e-02
  1.08703602e+00]
  HOMO = -0.583104572390847  LUMO = 0.91788893751365
  mo_energy =
[-1.18583711e+02 -1.23125795e+01 -9.56262102e+00 -9.56262102e+00
 -9.56262102e+00 -1.27029332e+00 -5.83104572e-01 -5.83104572e-01
 -5.83104572e-01  9.17888938e-01  1.01646691e+00  1.01646691e+00
  1.01646691e+00  7.31673339e+00  7.31673339e+00  7.31673339e+00
  9.45742238e+00  3.35378152e+01  3.35378152e+01  3.35378152e+01
  5.11178951e+01  1.29257824e+02  1.29257824e+02  1.29257824e+02
  1.95178353e+02  4.83667395e+02  4.83667395e+02  4.83667395e+02
  7.09132871e+02  1.33519654e+03  1.33519654e+03  1.33519654e+03
  2.77895943e+03  3.02896708e+03  3.02896708e+03  3.02896708e+03
  6.64906653e+03  6.64906653e+03  6.64906653e+03  9.17660076e+03
  2.55260277e+04  7.62607835e+04]
E1 = -728.2926624257625  E_coul = 201.54236969863715
cycle= 5 E= -526.750292727125  delta_E= -2.14e-09  |g|= 2.13e-05  |ddm|= 0.000176
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.97691e-05
diis-c [-9.70671401e-11  1.30075475e-05 -1.77228672e-03 -1.27420435e-02
  3.30386308e-02  9.81462692e-01]
  HOMO = -0.583112491762956  LUMO = 0.917885138768274
  mo_energy =
[-1.18583743e+02 -1.23126033e+01 -9.56264676e+00 -9.56264676e+00
 -9.56264676e+00 -1.27029959e+00 -5.83112492e-01 -5.83112492e-01
 -5.83112492e-01  9.17885139e-01  1.01646164e+00  1.01646164e+00
  1.01646164e+00  7.31671583e+00  7.31671583e+00  7.31671583e+00
  9.45740532e+00  3.35377903e+01  3.35377903e+01  3.35377903e+01
  5.11178697e+01  1.29257794e+02  1.29257794e+02  1.29257794e+02
  1.95178324e+02  4.83667364e+02  4.83667364e+02  4.83667364e+02
  7.09132838e+02  1.33519651e+03  1.33519651e+03  1.33519651e+03
  2.77895940e+03  3.02896704e+03  3.02896704e+03  3.02896704e+03
  6.64906649e+03  6.64906649e+03  6.64906649e+03  9.17660072e+03
  2.55260276e+04  7.62607834e+04]
E1 = -728.2927471268482  E_coul = 201.54245439966053
cycle= 6 E= -526.750292727188  delta_E= -6.23e-11  |g|= 1.86e-06  |ddm|= 2.02e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2927471268482  E_coul = 201.54245439966053
  HOMO = -0.583112378750584  LUMO = 0.917885577138663
  mo_energy =
[-1.18583742e+02 -1.23126026e+01 -9.56264621e+00 -9.56264621e+00
 -9.56264621e+00 -1.27029905e+00 -5.83112379e-01 -5.83112379e-01
 -5.83112379e-01  9.17885577e-01  1.01646178e+00  1.01646178e+00
  1.01646178e+00  7.31671621e+00  7.31671621e+00  7.31671621e+00
  9.45740587e+00  3.35377909e+01  3.35377909e+01  3.35377909e+01
  5.11178703e+01  1.29257795e+02  1.29257795e+02  1.29257795e+02
  1.95178325e+02  4.83667365e+02  4.83667365e+02  4.83667365e+02
  7.09132839e+02  1.33519651e+03  1.33519651e+03  1.33519651e+03
  2.77895940e+03  3.02896704e+03  3.02896704e+03  3.02896704e+03
  6.64906649e+03  6.64906649e+03  6.64906649e+03  9.17660072e+03
  2.55260276e+04  7.62607834e+04]
E1 = -728.292744216794  E_coul = 201.5424514896047
Extra cycle  E= -526.750292727189  delta_E= -1.59e-12  |g|= 3.92e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114693.66409551188
E1 = -728.292744216794  E_coul = 201.5424514896047
init E= -526.750292727189
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.58311245035864  LUMO = 0.917885592110241
  mo_energy =
[-1.18583742e+02 -1.23126028e+01 -9.56264644e+00 -9.56264644e+00
 -9.56264644e+00 -1.27029905e+00 -5.83112450e-01 -5.83112450e-01
 -5.83112450e-01  9.17885592e-01  1.01646174e+00  1.01646174e+00
  1.01646174e+00  7.31671606e+00  7.31671606e+00  7.31671606e+00
  9.45740575e+00  3.35377906e+01  3.35377906e+01  3.35377906e+01
  5.11178701e+01  1.29257795e+02  1.29257795e+02  1.29257795e+02
  1.95178324e+02  4.83667364e+02  4.83667364e+02  4.83667364e+02
  7.09132839e+02  1.33519651e+03  1.33519651e+03  1.33519651e+03
  2.77895940e+03  3.02896704e+03  3.02896704e+03  3.02896704e+03
  6.64906649e+03  6.64906649e+03  6.64906649e+03  9.17660072e+03
  2.55260276e+04  7.62607834e+04]
E1 = -728.2927448881483  E_coul = 201.54245216095757
cycle= 1 E= -526.750292727191  delta_E= -1.48e-12  |g|= 9.03e-08  |ddm|= 6.09e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2927448881483  E_coul = 201.54245216095757
  HOMO = -0.583112440718857  LUMO = 0.917885614612272
  mo_energy =
[-1.18583742e+02 -1.23126028e+01 -9.56264639e+00 -9.56264639e+00
 -9.56264639e+00 -1.27029902e+00 -5.83112441e-01 -5.83112441e-01
 -5.83112441e-01  9.17885615e-01  1.01646175e+00  1.01646175e+00
  1.01646175e+00  7.31671609e+00  7.31671609e+00  7.31671609e+00
  9.45740579e+00  3.35377907e+01  3.35377907e+01  3.35377907e+01
  5.11178702e+01  1.29257795e+02  1.29257795e+02  1.29257795e+02
  1.95178324e+02  4.83667364e+02  4.83667364e+02  4.83667364e+02
  7.09132839e+02  1.33519651e+03  1.33519651e+03  1.33519651e+03
  2.77895940e+03  3.02896704e+03  3.02896704e+03  3.02896704e+03
  6.64906649e+03  6.64906649e+03  6.64906649e+03  9.17660072e+03
  2.55260276e+04  7.62607834e+04]
E1 = -728.2927446687854  E_coul = 201.54245194159628
Extra cycle  E= -526.750292727189  delta_E= 1.59e-12  |g|= 1.96e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826674e+04 7.61749691e+03 3.61736291e+03 1.59730587e+03
 3.82632738e+02 1.16786834e+02 4.35262000e+01 2.00463094e+01
 6.83972934e+00 6.51023795e-01 2.79383286e+00 2.31063207e-01
 1.36278707e+03 6.64707663e+02 3.00782738e+02 3.13887732e+02
 6.17356764e+01 7.36174565e+00 2.02518441e+01 7.76582954e-01
 2.82539460e+00 2.23100117e-01]
grad_E = [-1.56603193e-06  3.87212990e-06 -1.19072188e-06  8.98751341e-05
 -4.29430868e-04 -1.56660909e-04 -3.07661059e-04  3.08898476e-04
  1.68433412e-04  6.56478512e-04 -2.37778846e-04 -1.73232421e-03
 -5.22972462e-07  4.80075083e-06  2.24223130e-05  1.93228460e-05
  7.73056587e-05  1.49244408e-03 -6.35420902e-04 -2.66387312e-03
 -9.64617441e-04  9.33657930e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:02 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6678767        1
[INPUT] 0    0    [1    /1   ]  7617.49581082        1
[INPUT] 0    0    [1    /1   ]  3617.36340501        1
[INPUT] 0    0    [1    /1   ]  1597.28260182        1
[INPUT] 0    0    [1    /1   ]  382.651107799        1
[INPUT] 0    0    [1    /1   ]  117.036262713        1
[INPUT] 0    0    [1    /1   ]  44.0513824997        1
[INPUT] 0    0    [1    /1   ]  20.5465121486        1
[INPUT] 0    0    [1    /1   ]  6.87509007256        1
[INPUT] 0    0    [1    /1   ]  0.653634219349       1
[INPUT] 0    0    [1    /1   ]  2.79444916088        1
[INPUT] 0    0    [1    /1   ]  0.232281848023       1
[INPUT] 1    0    [1    /1   ]  1362.78723245        1
[INPUT] 1    0    [1    /1   ]  664.706044115        1
[INPUT] 1    0    [1    /1   ]  300.775109906        1
[INPUT] 1    0    [1    /1   ]  313.881155806        1
[INPUT] 1    0    [1    /1   ]  61.7389519178        1
[INPUT] 1    0    [1    /1   ]  7.34911306114        1
[INPUT] 1    0    [1    /1   ]  20.2620184145        1
[INPUT] 1    0    [1    /1   ]  0.775540006071       1
[INPUT] 1    0    [1    /1   ]  2.8152295101         1
[INPUT] 1    0    [1    /1   ]  0.222770530711       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.667876673833, 1.0]], [0, [7617.495810822036, 1.0]], [0, [3617.3634050079763, 1.0]], [0, [1597.282601821673, 1.0]], [0, [382.6511077993704, 1.0]], [0, [117.03626271284521, 1.0]], [0, [44.05138249974852, 1.0]], [0, [20.546512148628924, 1.0]], [0, [6.875090072560416, 1.0]], [0, [0.6536342193492337, 1.0]], [0, [2.794449160884021, 1.0]], [0, [0.23228184802300197, 1.0]], [1, [1362.787232448511, 1.0]], [1, [664.7060441145127, 1.0]], [1, [300.7751099055575, 1.0]], [1, [313.88115580578653, 1.0]], [1, [61.73895191775761, 1.0]], [1, [7.3491130611392474, 1.0]], [1, [20.262018414547345, 1.0]], [1, [0.7755400060712411, 1.0]], [1, [2.815229510095564, 1.0]], [1, [0.2227705307106484, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66787667]
bas 1, expnt(s) = [7617.49581082]
bas 2, expnt(s) = [3617.36340501]
bas 3, expnt(s) = [1597.28260182]
bas 4, expnt(s) = [382.6511078]
bas 5, expnt(s) = [117.03626271]
bas 6, expnt(s) = [44.0513825]
bas 7, expnt(s) = [20.54651215]
bas 8, expnt(s) = [6.87509007]
bas 9, expnt(s) = [0.65363422]
bas 10, expnt(s) = [2.79444916]
bas 11, expnt(s) = [0.23228185]
bas 12, expnt(s) = [1362.78723245]
bas 13, expnt(s) = [664.70604411]
bas 14, expnt(s) = [300.77510991]
bas 15, expnt(s) = [313.88115581]
bas 16, expnt(s) = [61.73895192]
bas 17, expnt(s) = [7.34911306]
bas 18, expnt(s) = [20.26201841]
bas 19, expnt(s) = [0.77554001]
bas 20, expnt(s) = [2.81522951]
bas 21, expnt(s) = [0.22277053]
CPU time:       355.66
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826679e+04 5.20026466e+03 7.61749581e+03 2.06003307e+03
 3.61736341e+03 1.17844449e+03 1.59728260e+03 6.38338950e+02
 3.82651108e+02 2.18583439e+02 1.17036263e+02 8.98991029e+01
 4.40513825e+01 4.32000930e+01 2.05465121e+01 2.43819595e+01
 6.87509007e+00 1.07268898e+01 6.53634219e-01 1.83660647e+00
 2.79444916e+00 5.46056001e+00 2.32281848e-01 8.45330383e-01
 1.36278723e+03 2.41556908e+04 6.64706044e+02 9.84626290e+03
 3.00775110e+02 3.65415328e+03 3.13881156e+02 3.85425946e+03
 6.17389519e+01 5.04874526e+02 7.34911306e+00 3.53002721e+01
 2.02620184e+01 1.25411619e+02 7.75540006e-01 2.12319386e+00
 2.81522951e+00 1.06384082e+01 2.22770531e-01 4.46484685e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993784895998935
cond(S) = 114743.32401754957
E1 = -729.542239429425  E_coul = 203.17530418485
init E= -526.366935244575
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555771298122351  LUMO = 0.944622501950534
  mo_energy =
[-1.18332604e+02 -1.22068860e+01 -9.44717123e+00 -9.44717123e+00
 -9.44717123e+00 -1.24019697e+00 -5.55771298e-01 -5.55771298e-01
 -5.55771298e-01  9.44622502e-01  1.03301121e+00  1.03301121e+00
  1.03301121e+00  7.36163922e+00  7.36163922e+00  7.36163922e+00
  9.59674478e+00  3.35947131e+01  3.35947131e+01  3.35947131e+01
  5.21166263e+01  1.29388657e+02  1.29388657e+02  1.29388657e+02
  1.98292610e+02  4.83887999e+02  4.83887999e+02  4.83887999e+02
  7.14019662e+02  1.33546334e+03  1.33546334e+03  1.33546334e+03
  2.78423070e+03  3.02928062e+03  3.02928062e+03  3.02928062e+03
  6.64948086e+03  6.64948086e+03  6.64948086e+03  9.18172772e+03
  2.55310154e+04  7.62655652e+04]
E1 = -727.841952954749  E_coul = 201.09241138517945
cycle= 1 E= -526.74954156957  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.571226
diis-c [-0.32629966  1.        ]
  HOMO = -0.590825118440056  LUMO = 0.918420462319666
  mo_energy =
[-1.18642063e+02 -1.23452005e+01 -9.59655237e+00 -9.59655237e+00
 -9.59655237e+00 -1.27967281e+00 -5.90825118e-01 -5.90825118e-01
 -5.90825118e-01  9.18420462e-01  1.00855624e+00  1.00855624e+00
  1.00855624e+00  7.27032344e+00  7.27032344e+00  7.27032344e+00
  9.50264892e+00  3.34394959e+01  3.34394959e+01  3.34394959e+01
  5.19543350e+01  1.29158905e+02  1.29158905e+02  1.29158905e+02
  1.98053836e+02  4.83579774e+02  4.83579774e+02  4.83579774e+02
  7.13672696e+02  1.33509835e+03  1.33509835e+03  1.33509835e+03
  2.78373355e+03  3.02884974e+03  3.02884974e+03  3.02884974e+03
  6.64893646e+03  6.64893646e+03  6.64893646e+03  9.18110908e+03
  2.55303017e+04  7.62647610e+04]
E1 = -728.4195612565469  E_coul = 201.66928970339868
cycle= 2 E= -526.750271553148  delta_E= -0.00073  |g|= 0.038  |ddm|= 0.0531
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0775534
diis-c [-0.00382921  0.07605993  0.92394007]
  HOMO = -0.581605208157862  LUMO = 0.92607802823119
  mo_energy =
[-1.18573425e+02 -1.23066469e+01 -9.55631932e+00 -9.55631932e+00
 -9.55631932e+00 -1.26862881e+00 -5.81605208e-01 -5.81605208e-01
 -5.81605208e-01  9.26078028e-01  1.01536467e+00  1.01536467e+00
  1.01536467e+00  7.29439256e+00  7.29439256e+00  7.29439256e+00
  9.52859733e+00  3.34801225e+01  3.34801225e+01  3.34801225e+01
  5.19982013e+01  1.29215577e+02  1.29215577e+02  1.29215577e+02
  1.98112961e+02  4.83647590e+02  4.83647590e+02  4.83647590e+02
  7.13742681e+02  1.33517027e+03  1.33517027e+03  1.33517027e+03
  2.78380869e+03  3.02892393e+03  3.02892393e+03  3.02892393e+03
  6.64901241e+03  6.64901241e+03  6.64901241e+03  9.18118582e+03
  2.55303790e+04  7.62648386e+04]
E1 = -728.2670177307541  E_coul = 201.51668655834482
cycle= 3 E= -526.750331172409  delta_E= -5.96e-05  |g|= 0.00666  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141458
diis-c [-8.44916240e-07 -1.31106539e-03  1.49820907e-01  8.51490159e-01]
  HOMO = -0.583181140756792  LUMO = 0.924866850292018
  mo_energy =
[-1.18583958e+02 -1.23127728e+01 -9.56281195e+00 -9.56281195e+00
 -9.56281195e+00 -1.27040433e+00 -5.83181141e-01 -5.83181141e-01
 -5.83181141e-01  9.24866850e-01  1.01422653e+00  1.01422653e+00
  1.01422653e+00  7.29041177e+00  7.29041177e+00  7.29041177e+00
  9.52441182e+00  3.34736067e+01  3.34736067e+01  3.34736067e+01
  5.19912727e+01  1.29206752e+02  1.29206752e+02  1.29206752e+02
  1.98103808e+02  4.83637179e+02  4.83637179e+02  4.83637179e+02
  7.13731918e+02  1.33515923e+03  1.33515923e+03  1.33515923e+03
  2.78379701e+03  3.02891248e+03  3.02891248e+03  3.02891248e+03
  6.64900056e+03  6.64900056e+03  6.64900056e+03  9.18117375e+03
  2.55303668e+04  7.62648262e+04]
E1 = -728.2910782645673  E_coul = 201.54074495361252
cycle= 4 E= -526.750333310955  delta_E= -2.14e-06  |g|= 0.000107  |ddm|= 0.00235
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00011698
diis-c [-5.13819309e-09  8.61524795e-05 -1.22527536e-02 -7.35320288e-02
  1.08569863e+00]
  HOMO = -0.58316172484718  LUMO = 0.924901505010593
  mo_energy =
[-1.18583907e+02 -1.23127011e+01 -9.56275444e+00 -9.56275444e+00
 -9.56275444e+00 -1.27035997e+00 -5.83161725e-01 -5.83161725e-01
 -5.83161725e-01  9.24901505e-01  1.01424340e+00  1.01424340e+00
  1.01424340e+00  7.29045718e+00  7.29045718e+00  7.29045718e+00
  9.52447335e+00  3.34736623e+01  3.34736623e+01  3.34736623e+01
  5.19913365e+01  1.29206810e+02  1.29206810e+02  1.29206810e+02
  1.98103866e+02  4.83637230e+02  4.83637230e+02  4.83637230e+02
  7.13731962e+02  1.33515927e+03  1.33515927e+03  1.33515927e+03
  2.78379703e+03  3.02891252e+03  3.02891252e+03  3.02891252e+03
  6.64900058e+03  6.64900058e+03  6.64900058e+03  9.18117376e+03
  2.55303668e+04  7.62648262e+04]
E1 = -728.2908325539884  E_coul = 201.54049924096591
cycle= 5 E= -526.750333313022  delta_E= -2.07e-09  |g|= 2.12e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96755e-05
diis-c [-9.51186047e-11  1.29586557e-05 -1.77147548e-03 -1.27042444e-02
  3.40253496e-02  9.80437412e-01]
  HOMO = -0.583169590624997  LUMO = 0.924897690680116
  mo_energy =
[-1.18583939e+02 -1.23127248e+01 -9.56278005e+00 -9.56278005e+00
 -9.56278005e+00 -1.27036621e+00 -5.83169591e-01 -5.83169591e-01
 -5.83169591e-01  9.24897691e-01  1.01423818e+00  1.01423818e+00
  1.01423818e+00  7.29043974e+00  7.29043974e+00  7.29043974e+00
  9.52445632e+00  3.34736375e+01  3.34736375e+01  3.34736375e+01
  5.19913111e+01  1.29206780e+02  1.29206780e+02  1.29206780e+02
  1.98103836e+02  4.83637199e+02  4.83637199e+02  4.83637199e+02
  7.13731930e+02  1.33515924e+03  1.33515924e+03  1.33515924e+03
  2.78379700e+03  3.02891248e+03  3.02891248e+03  3.02891248e+03
  6.64900054e+03  6.64900054e+03  6.64900054e+03  9.18117373e+03
  2.55303667e+04  7.62648262e+04]
E1 = -728.2909170184266  E_coul = 201.54058370534042
cycle= 6 E= -526.750333313086  delta_E= -6.38e-11  |g|= 1.86e-06  |ddm|= 2e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2909170184266  E_coul = 201.54058370534042
  HOMO = -0.583169487761432  LUMO = 0.924898123145689
  mo_energy =
[-1.18583938e+02 -1.23127242e+01 -9.56277953e+00 -9.56277953e+00
 -9.56277953e+00 -1.27036569e+00 -5.83169488e-01 -5.83169488e-01
 -5.83169488e-01  9.24898123e-01  1.01423831e+00  1.01423831e+00
  1.01423831e+00  7.29044010e+00  7.29044010e+00  7.29044010e+00
  9.52445685e+00  3.34736380e+01  3.34736380e+01  3.34736380e+01
  5.19913117e+01  1.29206781e+02  1.29206781e+02  1.29206781e+02
  1.98103837e+02  4.83637200e+02  4.83637200e+02  4.83637200e+02
  7.13731931e+02  1.33515924e+03  1.33515924e+03  1.33515924e+03
  2.78379700e+03  3.02891248e+03  3.02891248e+03  3.02891248e+03
  6.64900054e+03  6.64900054e+03  6.64900054e+03  9.18117373e+03
  2.55303667e+04  7.62648262e+04]
E1 = -728.2909142672522  E_coul = 201.54058095416502
Extra cycle  E= -526.750333313087  delta_E= -9.09e-13  |g|= 3.9e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826679e+04 7.61749581e+03 3.61736341e+03 1.59728260e+03
 3.82651108e+02 1.17036263e+02 4.40513825e+01 2.05465121e+01
 6.87509007e+00 6.53634219e-01 2.79444916e+00 2.32281848e-01
 1.36278723e+03 6.64706044e+02 3.00775110e+02 3.13881156e+02
 6.17389519e+01 7.34911306e+00 2.02620184e+01 7.75540006e-01
 2.81522951e+00 2.22770531e-01]
E = -526.7503333130871
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:03 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6678767        1
[INPUT] 0    0    [1    /1   ]  7617.49581082        1
[INPUT] 0    0    [1    /1   ]  3617.36340501        1
[INPUT] 0    0    [1    /1   ]  1597.28260182        1
[INPUT] 0    0    [1    /1   ]  382.651107799        1
[INPUT] 0    0    [1    /1   ]  117.036262713        1
[INPUT] 0    0    [1    /1   ]  44.0513824997        1
[INPUT] 0    0    [1    /1   ]  20.5465121486        1
[INPUT] 0    0    [1    /1   ]  6.87509007256        1
[INPUT] 0    0    [1    /1   ]  0.653634219349       1
[INPUT] 0    0    [1    /1   ]  2.79444916088        1
[INPUT] 0    0    [1    /1   ]  0.232281848023       1
[INPUT] 1    0    [1    /1   ]  1362.78723245        1
[INPUT] 1    0    [1    /1   ]  664.706044115        1
[INPUT] 1    0    [1    /1   ]  300.775109906        1
[INPUT] 1    0    [1    /1   ]  313.881155806        1
[INPUT] 1    0    [1    /1   ]  61.7389519178        1
[INPUT] 1    0    [1    /1   ]  7.34911306114        1
[INPUT] 1    0    [1    /1   ]  20.2620184145        1
[INPUT] 1    0    [1    /1   ]  0.775540006071       1
[INPUT] 1    0    [1    /1   ]  2.8152295101         1
[INPUT] 1    0    [1    /1   ]  0.222770530711       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.667876673833, 1.0]], [0, [7617.495810822036, 1.0]], [0, [3617.3634050079763, 1.0]], [0, [1597.282601821673, 1.0]], [0, [382.6511077993704, 1.0]], [0, [117.03626271284521, 1.0]], [0, [44.05138249974852, 1.0]], [0, [20.546512148628924, 1.0]], [0, [6.875090072560416, 1.0]], [0, [0.6536342193492337, 1.0]], [0, [2.794449160884021, 1.0]], [0, [0.23228184802300197, 1.0]], [1, [1362.787232448511, 1.0]], [1, [664.7060441145127, 1.0]], [1, [300.7751099055575, 1.0]], [1, [313.88115580578653, 1.0]], [1, [61.73895191775761, 1.0]], [1, [7.3491130611392474, 1.0]], [1, [20.262018414547345, 1.0]], [1, [0.7755400060712411, 1.0]], [1, [2.815229510095564, 1.0]], [1, [0.2227705307106484, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66787667]
bas 1, expnt(s) = [7617.49581082]
bas 2, expnt(s) = [3617.36340501]
bas 3, expnt(s) = [1597.28260182]
bas 4, expnt(s) = [382.6511078]
bas 5, expnt(s) = [117.03626271]
bas 6, expnt(s) = [44.0513825]
bas 7, expnt(s) = [20.54651215]
bas 8, expnt(s) = [6.87509007]
bas 9, expnt(s) = [0.65363422]
bas 10, expnt(s) = [2.79444916]
bas 11, expnt(s) = [0.23228185]
bas 12, expnt(s) = [1362.78723245]
bas 13, expnt(s) = [664.70604411]
bas 14, expnt(s) = [300.77510991]
bas 15, expnt(s) = [313.88115581]
bas 16, expnt(s) = [61.73895192]
bas 17, expnt(s) = [7.34911306]
bas 18, expnt(s) = [20.26201841]
bas 19, expnt(s) = [0.77554001]
bas 20, expnt(s) = [2.81522951]
bas 21, expnt(s) = [0.22277053]
CPU time:       356.13
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826679e+04 5.20026466e+03 7.61749581e+03 2.06003307e+03
 3.61736341e+03 1.17844449e+03 1.59728260e+03 6.38338950e+02
 3.82651108e+02 2.18583439e+02 1.17036263e+02 8.98991029e+01
 4.40513825e+01 4.32000930e+01 2.05465121e+01 2.43819595e+01
 6.87509007e+00 1.07268898e+01 6.53634219e-01 1.83660647e+00
 2.79444916e+00 5.46056001e+00 2.32281848e-01 8.45330383e-01
 1.36278723e+03 2.41556908e+04 6.64706044e+02 9.84626290e+03
 3.00775110e+02 3.65415328e+03 3.13881156e+02 3.85425946e+03
 6.17389519e+01 5.04874526e+02 7.34911306e+00 3.53002721e+01
 2.02620184e+01 1.25411619e+02 7.75540006e-01 2.12319386e+00
 2.81522951e+00 1.06384082e+01 2.22770531e-01 4.46484685e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993784895998935
cond(S) = 114743.32401754957
E1 = -729.542239429425  E_coul = 203.17530418485
init E= -526.366935244575
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555771298122351  LUMO = 0.944622501950534
  mo_energy =
[-1.18332604e+02 -1.22068860e+01 -9.44717123e+00 -9.44717123e+00
 -9.44717123e+00 -1.24019697e+00 -5.55771298e-01 -5.55771298e-01
 -5.55771298e-01  9.44622502e-01  1.03301121e+00  1.03301121e+00
  1.03301121e+00  7.36163922e+00  7.36163922e+00  7.36163922e+00
  9.59674478e+00  3.35947131e+01  3.35947131e+01  3.35947131e+01
  5.21166263e+01  1.29388657e+02  1.29388657e+02  1.29388657e+02
  1.98292610e+02  4.83887999e+02  4.83887999e+02  4.83887999e+02
  7.14019662e+02  1.33546334e+03  1.33546334e+03  1.33546334e+03
  2.78423070e+03  3.02928062e+03  3.02928062e+03  3.02928062e+03
  6.64948086e+03  6.64948086e+03  6.64948086e+03  9.18172772e+03
  2.55310154e+04  7.62655652e+04]
E1 = -727.841952954749  E_coul = 201.09241138517945
cycle= 1 E= -526.74954156957  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571226
diis-c [-0.32629966  1.        ]
  HOMO = -0.590825118440056  LUMO = 0.918420462319666
  mo_energy =
[-1.18642063e+02 -1.23452005e+01 -9.59655237e+00 -9.59655237e+00
 -9.59655237e+00 -1.27967281e+00 -5.90825118e-01 -5.90825118e-01
 -5.90825118e-01  9.18420462e-01  1.00855624e+00  1.00855624e+00
  1.00855624e+00  7.27032344e+00  7.27032344e+00  7.27032344e+00
  9.50264892e+00  3.34394959e+01  3.34394959e+01  3.34394959e+01
  5.19543350e+01  1.29158905e+02  1.29158905e+02  1.29158905e+02
  1.98053836e+02  4.83579774e+02  4.83579774e+02  4.83579774e+02
  7.13672696e+02  1.33509835e+03  1.33509835e+03  1.33509835e+03
  2.78373355e+03  3.02884974e+03  3.02884974e+03  3.02884974e+03
  6.64893646e+03  6.64893646e+03  6.64893646e+03  9.18110908e+03
  2.55303017e+04  7.62647610e+04]
E1 = -728.4195612565469  E_coul = 201.66928970339868
cycle= 2 E= -526.750271553148  delta_E= -0.00073  |g|= 0.038  |ddm|= 0.0531
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0775534
diis-c [-0.00382921  0.07605993  0.92394007]
  HOMO = -0.581605208157862  LUMO = 0.92607802823119
  mo_energy =
[-1.18573425e+02 -1.23066469e+01 -9.55631932e+00 -9.55631932e+00
 -9.55631932e+00 -1.26862881e+00 -5.81605208e-01 -5.81605208e-01
 -5.81605208e-01  9.26078028e-01  1.01536467e+00  1.01536467e+00
  1.01536467e+00  7.29439256e+00  7.29439256e+00  7.29439256e+00
  9.52859733e+00  3.34801225e+01  3.34801225e+01  3.34801225e+01
  5.19982013e+01  1.29215577e+02  1.29215577e+02  1.29215577e+02
  1.98112961e+02  4.83647590e+02  4.83647590e+02  4.83647590e+02
  7.13742681e+02  1.33517027e+03  1.33517027e+03  1.33517027e+03
  2.78380869e+03  3.02892393e+03  3.02892393e+03  3.02892393e+03
  6.64901241e+03  6.64901241e+03  6.64901241e+03  9.18118582e+03
  2.55303790e+04  7.62648386e+04]
E1 = -728.2670177307541  E_coul = 201.51668655834482
cycle= 3 E= -526.750331172409  delta_E= -5.96e-05  |g|= 0.00666  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141458
diis-c [-8.44916240e-07 -1.31106539e-03  1.49820907e-01  8.51490159e-01]
  HOMO = -0.583181140756792  LUMO = 0.924866850292018
  mo_energy =
[-1.18583958e+02 -1.23127728e+01 -9.56281195e+00 -9.56281195e+00
 -9.56281195e+00 -1.27040433e+00 -5.83181141e-01 -5.83181141e-01
 -5.83181141e-01  9.24866850e-01  1.01422653e+00  1.01422653e+00
  1.01422653e+00  7.29041177e+00  7.29041177e+00  7.29041177e+00
  9.52441182e+00  3.34736067e+01  3.34736067e+01  3.34736067e+01
  5.19912727e+01  1.29206752e+02  1.29206752e+02  1.29206752e+02
  1.98103808e+02  4.83637179e+02  4.83637179e+02  4.83637179e+02
  7.13731918e+02  1.33515923e+03  1.33515923e+03  1.33515923e+03
  2.78379701e+03  3.02891248e+03  3.02891248e+03  3.02891248e+03
  6.64900056e+03  6.64900056e+03  6.64900056e+03  9.18117375e+03
  2.55303668e+04  7.62648262e+04]
E1 = -728.2910782645673  E_coul = 201.54074495361252
cycle= 4 E= -526.750333310955  delta_E= -2.14e-06  |g|= 0.000107  |ddm|= 0.00235
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.00011698
diis-c [-5.13819309e-09  8.61524795e-05 -1.22527536e-02 -7.35320288e-02
  1.08569863e+00]
  HOMO = -0.58316172484718  LUMO = 0.924901505010593
  mo_energy =
[-1.18583907e+02 -1.23127011e+01 -9.56275444e+00 -9.56275444e+00
 -9.56275444e+00 -1.27035997e+00 -5.83161725e-01 -5.83161725e-01
 -5.83161725e-01  9.24901505e-01  1.01424340e+00  1.01424340e+00
  1.01424340e+00  7.29045718e+00  7.29045718e+00  7.29045718e+00
  9.52447335e+00  3.34736623e+01  3.34736623e+01  3.34736623e+01
  5.19913365e+01  1.29206810e+02  1.29206810e+02  1.29206810e+02
  1.98103866e+02  4.83637230e+02  4.83637230e+02  4.83637230e+02
  7.13731962e+02  1.33515927e+03  1.33515927e+03  1.33515927e+03
  2.78379703e+03  3.02891252e+03  3.02891252e+03  3.02891252e+03
  6.64900058e+03  6.64900058e+03  6.64900058e+03  9.18117376e+03
  2.55303668e+04  7.62648262e+04]
E1 = -728.2908325539884  E_coul = 201.54049924096591
cycle= 5 E= -526.750333313022  delta_E= -2.07e-09  |g|= 2.12e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96755e-05
diis-c [-9.51186047e-11  1.29586557e-05 -1.77147548e-03 -1.27042444e-02
  3.40253496e-02  9.80437412e-01]
  HOMO = -0.583169590624997  LUMO = 0.924897690680116
  mo_energy =
[-1.18583939e+02 -1.23127248e+01 -9.56278005e+00 -9.56278005e+00
 -9.56278005e+00 -1.27036621e+00 -5.83169591e-01 -5.83169591e-01
 -5.83169591e-01  9.24897691e-01  1.01423818e+00  1.01423818e+00
  1.01423818e+00  7.29043974e+00  7.29043974e+00  7.29043974e+00
  9.52445632e+00  3.34736375e+01  3.34736375e+01  3.34736375e+01
  5.19913111e+01  1.29206780e+02  1.29206780e+02  1.29206780e+02
  1.98103836e+02  4.83637199e+02  4.83637199e+02  4.83637199e+02
  7.13731930e+02  1.33515924e+03  1.33515924e+03  1.33515924e+03
  2.78379700e+03  3.02891248e+03  3.02891248e+03  3.02891248e+03
  6.64900054e+03  6.64900054e+03  6.64900054e+03  9.18117373e+03
  2.55303667e+04  7.62648262e+04]
E1 = -728.2909170184266  E_coul = 201.54058370534042
cycle= 6 E= -526.750333313086  delta_E= -6.38e-11  |g|= 1.86e-06  |ddm|= 2e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2909170184266  E_coul = 201.54058370534042
  HOMO = -0.583169487761432  LUMO = 0.924898123145689
  mo_energy =
[-1.18583938e+02 -1.23127242e+01 -9.56277953e+00 -9.56277953e+00
 -9.56277953e+00 -1.27036569e+00 -5.83169488e-01 -5.83169488e-01
 -5.83169488e-01  9.24898123e-01  1.01423831e+00  1.01423831e+00
  1.01423831e+00  7.29044010e+00  7.29044010e+00  7.29044010e+00
  9.52445685e+00  3.34736380e+01  3.34736380e+01  3.34736380e+01
  5.19913117e+01  1.29206781e+02  1.29206781e+02  1.29206781e+02
  1.98103837e+02  4.83637200e+02  4.83637200e+02  4.83637200e+02
  7.13731931e+02  1.33515924e+03  1.33515924e+03  1.33515924e+03
  2.78379700e+03  3.02891248e+03  3.02891248e+03  3.02891248e+03
  6.64900054e+03  6.64900054e+03  6.64900054e+03  9.18117373e+03
  2.55303667e+04  7.62648262e+04]
E1 = -728.2909142672522  E_coul = 201.54058095416502
Extra cycle  E= -526.750333313087  delta_E= -9.09e-13  |g|= 3.9e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114743.32401754957
E1 = -728.2909142672522  E_coul = 201.54058095416502
init E= -526.750333313087
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583169556062281  LUMO = 0.924898140730833
  mo_energy =
[-1.18583938e+02 -1.23127244e+01 -9.56277975e+00 -9.56277975e+00
 -9.56277975e+00 -1.27036568e+00 -5.83169556e-01 -5.83169556e-01
 -5.83169556e-01  9.24898141e-01  1.01423827e+00  1.01423827e+00
  1.01423827e+00  7.29043995e+00  7.29043995e+00  7.29043995e+00
  9.52445673e+00  3.34736378e+01  3.34736378e+01  3.34736378e+01
  5.19913115e+01  1.29206781e+02  1.29206781e+02  1.29206781e+02
  1.98103837e+02  4.83637199e+02  4.83637199e+02  4.83637199e+02
  7.13731930e+02  1.33515924e+03  1.33515924e+03  1.33515924e+03
  2.78379700e+03  3.02891248e+03  3.02891248e+03  3.02891248e+03
  6.64900054e+03  6.64900054e+03  6.64900054e+03  9.18117373e+03
  2.55303667e+04  7.62648262e+04]
E1 = -728.2909148975483  E_coul = 201.5405815844615
cycle= 1 E= -526.750333313087  delta_E= 3.41e-13  |g|= 8.9e-08  |ddm|= 6.1e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2909148975483  E_coul = 201.5405815844615
  HOMO = -0.583169547141673  LUMO = 0.924898162750082
  mo_energy =
[-1.18583938e+02 -1.23127244e+01 -9.56277971e+00 -9.56277971e+00
 -9.56277971e+00 -1.27036566e+00 -5.83169547e-01 -5.83169547e-01
 -5.83169547e-01  9.24898163e-01  1.01423828e+00  1.01423828e+00
  1.01423828e+00  7.29043998e+00  7.29043998e+00  7.29043998e+00
  9.52445677e+00  3.34736379e+01  3.34736379e+01  3.34736379e+01
  5.19913116e+01  1.29206781e+02  1.29206781e+02  1.29206781e+02
  1.98103837e+02  4.83637199e+02  4.83637199e+02  4.83637199e+02
  7.13731930e+02  1.33515924e+03  1.33515924e+03  1.33515924e+03
  2.78379700e+03  3.02891248e+03  3.02891248e+03  3.02891248e+03
  6.64900054e+03  6.64900054e+03  6.64900054e+03  9.18117373e+03
  2.55303667e+04  7.62648262e+04]
E1 = -728.2909146903802  E_coul = 201.5405813772919
Extra cycle  E= -526.750333313088  delta_E= -1.48e-12  |g|= 1.92e-08  |ddm|= 1.39e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826679e+04 7.61749581e+03 3.61736341e+03 1.59728260e+03
 3.82651108e+02 1.17036263e+02 4.40513825e+01 2.05465121e+01
 6.87509007e+00 6.53634219e-01 2.79444916e+00 2.32281848e-01
 1.36278723e+03 6.64706044e+02 3.00775110e+02 3.13881156e+02
 6.17389519e+01 7.34911306e+00 2.02620184e+01 7.75540006e-01
 2.81522951e+00 2.22770531e-01]
grad_E = [-1.56585517e-06  3.86995973e-06 -1.19231091e-06  8.97768466e-05
 -4.23871973e-04 -2.09909276e-04 -1.97411061e-04  2.86652601e-04
  3.29185185e-04  2.57187464e-04 -8.13091752e-04  2.84047552e-04
 -5.18870803e-07  4.85993898e-06  2.27830274e-05  1.96316409e-05
  3.51263748e-05  1.01285090e-03 -3.39654166e-04 -2.06793253e-03
 -1.08412819e-03  6.67479743e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:07 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6681071        1
[INPUT] 0    0    [1    /1   ]  7617.49530055        1
[INPUT] 0    0    [1    /1   ]  3617.3636373         1
[INPUT] 0    0    [1    /1   ]  1597.27177381        1
[INPUT] 0    0    [1    /1   ]  382.659694239        1
[INPUT] 0    0    [1    /1   ]  117.145375307        1
[INPUT] 0    0    [1    /1   ]  44.3181265923        1
[INPUT] 0    0    [1    /1   ]  20.7953111923        1
[INPUT] 0    0    [1    /1   ]  6.91174764786        1
[INPUT] 0    0    [1    /1   ]  0.652057319243       1
[INPUT] 0    0    [1    /1   ]  2.816757977          1
[INPUT] 0    0    [1    /1   ]  0.232013590473       1
[INPUT] 1    0    [1    /1   ]  1362.78730937        1
[INPUT] 1    0    [1    /1   ]  664.705289668        1
[INPUT] 1    0    [1    /1   ]  300.771554303        1
[INPUT] 1    0    [1    /1   ]  313.878090492        1
[INPUT] 1    0    [1    /1   ]  61.7406340432        1
[INPUT] 1    0    [1    /1   ]  7.34300107526        1
[INPUT] 1    0    [1    /1   ]  20.2659871749        1
[INPUT] 1    0    [1    /1   ]  0.775488311961       1
[INPUT] 1    0    [1    /1   ]  2.81420860008        1
[INPUT] 1    0    [1    /1   ]  0.222597408032       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668107066085, 1.0]], [0, [7617.495300552329, 1.0]], [0, [3617.363637301886, 1.0]], [0, [1597.271773814578, 1.0]], [0, [382.6596942390862, 1.0]], [0, [117.14537530655804, 1.0]], [0, [44.318126592310726, 1.0]], [0, [20.79531119225482, 1.0]], [0, [6.911747647859668, 1.0]], [0, [0.6520573192431892, 1.0]], [0, [2.8167579769982267, 1.0]], [0, [0.23201359047300774, 1.0]], [1, [1362.7873093680262, 1.0]], [1, [664.705289668336, 1.0]], [1, [300.7715543029978, 1.0]], [1, [313.8780904920905, 1.0]], [1, [61.74063404322858, 1.0]], [1, [7.34300107526389, 1.0]], [1, [20.26598717485707, 1.0]], [1, [0.7754883119611183, 1.0]], [1, [2.814208600082725, 1.0]], [1, [0.22259740803153247, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66810707]
bas 1, expnt(s) = [7617.49530055]
bas 2, expnt(s) = [3617.3636373]
bas 3, expnt(s) = [1597.27177381]
bas 4, expnt(s) = [382.65969424]
bas 5, expnt(s) = [117.14537531]
bas 6, expnt(s) = [44.31812659]
bas 7, expnt(s) = [20.79531119]
bas 8, expnt(s) = [6.91174765]
bas 9, expnt(s) = [0.65205732]
bas 10, expnt(s) = [2.81675798]
bas 11, expnt(s) = [0.23201359]
bas 12, expnt(s) = [1362.78730937]
bas 13, expnt(s) = [664.70528967]
bas 14, expnt(s) = [300.7715543]
bas 15, expnt(s) = [313.87809049]
bas 16, expnt(s) = [61.74063404]
bas 17, expnt(s) = [7.34300108]
bas 18, expnt(s) = [20.26598717]
bas 19, expnt(s) = [0.77548831]
bas 20, expnt(s) = [2.8142086]
bas 21, expnt(s) = [0.22259741]
CPU time:       361.86
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826681e+04 5.20026469e+03 7.61749530e+03 2.06003297e+03
 3.61736364e+03 1.17844455e+03 1.59727177e+03 6.38335705e+02
 3.82659694e+02 2.18587118e+02 1.17145375e+02 8.99619551e+01
 4.43181266e+01 4.33961368e+01 2.07953112e+01 2.46030581e+01
 6.91174765e+00 1.07697576e+01 6.52057319e-01 1.83328234e+00
 2.81675798e+00 5.49322229e+00 2.32013590e-01 8.44598086e-01
 1.36278731e+03 2.41556926e+04 6.64705290e+02 9.84624893e+03
 3.00771554e+02 3.65409928e+03 3.13878090e+02 3.85421241e+03
 6.17406340e+01 5.04891721e+02 7.34300108e+00 3.52635785e+01
 2.02659872e+01 1.25442326e+02 7.75488312e-01 2.12301696e+00
 2.81420860e+00 1.06335861e+01 2.22597408e-01 4.46051004e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99379958726459
cond(S) = 114796.92849235094
E1 = -729.5422790507664  E_coul = 203.17538590338654
init E= -526.36689314738
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555780830690964  LUMO = 0.943075219704029
  mo_energy =
[-1.18332611e+02 -1.22068538e+01 -9.44715527e+00 -9.44715527e+00
 -9.44715527e+00 -1.24020781e+00 -5.55780831e-01 -5.55780831e-01
 -5.55780831e-01  9.43075220e-01  1.03230105e+00  1.03230105e+00
  1.03230105e+00  7.35721525e+00  7.35721525e+00  7.35721525e+00
  9.67465171e+00  3.35785576e+01  3.35785576e+01  3.35785576e+01
  5.26893773e+01  1.29375830e+02  1.29375830e+02  1.29375830e+02
  1.99903976e+02  4.83881885e+02  4.83881885e+02  4.83881885e+02
  7.16433569e+02  1.33545280e+03  1.33545280e+03  1.33545280e+03
  2.78673321e+03  3.02926149e+03  3.02926149e+03  3.02926149e+03
  6.64945586e+03  6.64945586e+03  6.64945586e+03  9.18408758e+03
  2.55332542e+04  7.62676513e+04]
E1 = -727.839943661448  E_coul = 201.09039248016296
cycle= 1 E= -526.749551181285  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571642
diis-c [-0.32677439  1.        ]
  HOMO = -0.590947146580371  LUMO = 0.916770277875267
  mo_energy =
[-1.18642163e+02 -1.23453080e+01 -9.59665153e+00 -9.59665153e+00
 -9.59665153e+00 -1.27981614e+00 -5.90947147e-01 -5.90947147e-01
 -5.90947147e-01  9.16770278e-01  1.00777412e+00  1.00777412e+00
  1.00777412e+00  7.26579723e+00  7.26579723e+00  7.26579723e+00
  9.57998220e+00  3.34232205e+01  3.34232205e+01  3.34232205e+01
  5.25263689e+01  1.29145984e+02  1.29145984e+02  1.29145984e+02
  1.99664734e+02  4.83573551e+02  4.83573551e+02  4.83573551e+02
  7.16086480e+02  1.33508774e+03  1.33508774e+03  1.33508774e+03
  2.78623600e+03  3.02883054e+03  3.02883054e+03  3.02883054e+03
  6.64891138e+03  6.64891138e+03  6.64891138e+03  9.18346887e+03
  2.55325405e+04  7.62668470e+04]
E1 = -728.418223995629  E_coul = 201.66794170852796
cycle= 2 E= -526.750282287101  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776111
diis-c [-0.00384029  0.07597522  0.92402478]
  HOMO = -0.581712536696958  LUMO = 0.924438841855548
  mo_energy =
[-1.18573458e+02 -1.23067047e+01 -9.55636619e+00 -9.55636619e+00
 -9.55636619e+00 -1.26875512e+00 -5.81712537e-01 -5.81712537e-01
 -5.81712537e-01  9.24438842e-01  1.01459080e+00  1.01459080e+00
  1.01459080e+00  7.28989316e+00  7.28989316e+00  7.28989316e+00
  9.60609047e+00  3.34638954e+01  3.34638954e+01  3.34638954e+01
  5.25704364e+01  1.29202719e+02  1.29202719e+02  1.29202719e+02
  1.99723983e+02  4.83641433e+02  4.83641433e+02  4.83641433e+02
  7.16156534e+02  1.33515972e+03  1.33515972e+03  1.33515972e+03
  2.78631121e+03  3.02890479e+03  3.02890479e+03  3.02890479e+03
  6.64898740e+03  6.64898740e+03  6.64898740e+03  9.18354568e+03
  2.55326179e+04  7.62669247e+04]
E1 = -728.2654313862646  E_coul = 201.51508933815398
cycle= 3 E= -526.750342048111  delta_E= -5.98e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.014169
diis-c [-8.40240707e-07 -1.30994643e-03  1.49951126e-01  8.51358821e-01]
  HOMO = -0.583292860982657  LUMO = 0.923223817448679
  mo_energy =
[-1.18584013e+02 -1.23128445e+01 -9.56287271e+00 -9.56287271e+00
 -9.56287271e+00 -1.27053613e+00 -5.83292861e-01 -5.83292861e-01
 -5.83292861e-01  9.23223817e-01  1.01344983e+00  1.01344983e+00
  1.01344983e+00  7.28590410e+00  7.28590410e+00  7.28590410e+00
  9.60187550e+00  3.34573660e+01  3.34573660e+01  3.34573660e+01
  5.25634711e+01  1.29193876e+02  1.29193876e+02  1.29193876e+02
  1.99714802e+02  4.83631001e+02  4.83631001e+02  4.83631001e+02
  7.16145750e+02  1.33514866e+03  1.33514866e+03  1.33514866e+03
  2.78629951e+03  3.02889332e+03  3.02889332e+03  3.02889332e+03
  6.64897552e+03  6.64897552e+03  6.64897552e+03  9.18353359e+03
  2.55326056e+04  7.62669123e+04]
E1 = -728.2895551936498  E_coul = 201.5392109970026
cycle= 4 E= -526.750344196647  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116059
diis-c [-5.11604247e-09  8.55490238e-05 -1.21747464e-02 -7.29548885e-02
  1.08504409e+00]
  HOMO = -0.583273357652106  LUMO = 0.923258454071828
  mo_energy =
[-1.18583961e+02 -1.23127726e+01 -9.56281479e+00 -9.56281479e+00
 -9.56281479e+00 -1.27049175e+00 -5.83273358e-01 -5.83273358e-01
 -5.83273358e-01  9.23258454e-01  1.01346675e+00  1.01346675e+00
  1.01346675e+00  7.28594974e+00  7.28594974e+00  7.28594974e+00
  9.60193735e+00  3.34574221e+01  3.34574221e+01  3.34574221e+01
  5.25635353e+01  1.29193933e+02  1.29193933e+02  1.29193933e+02
  1.99714860e+02  4.83631053e+02  4.83631053e+02  4.83631053e+02
  7.16145794e+02  1.33514871e+03  1.33514871e+03  1.33514871e+03
  2.78629953e+03  3.02889336e+03  3.02889336e+03  3.02889336e+03
  6.64897554e+03  6.64897554e+03  6.64897554e+03  9.18353360e+03
  2.55326056e+04  7.62669123e+04]
E1 = -728.2893080033908  E_coul = 201.53896380468905
cycle= 5 E= -526.750344198702  delta_E= -2.05e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.97156e-05
diis-c [-9.46568165e-11  1.29871445e-05 -1.77880841e-03 -1.27325829e-02
  3.41446802e-02  9.80353724e-01]
  HOMO = -0.583281223029083  LUMO = 0.923254640649231
  mo_energy =
[-1.18583993e+02 -1.23127962e+01 -9.56284039e+00 -9.56284039e+00
 -9.56284039e+00 -1.27049799e+00 -5.83281223e-01 -5.83281223e-01
 -5.83281223e-01  9.23254641e-01  1.01346153e+00  1.01346153e+00
  1.01346153e+00  7.28593231e+00  7.28593231e+00  7.28593231e+00
  9.60192027e+00  3.34573972e+01  3.34573972e+01  3.34573972e+01
  5.25635099e+01  1.29193904e+02  1.29193904e+02  1.29193904e+02
  1.99714831e+02  4.83631022e+02  4.83631022e+02  4.83631022e+02
  7.16145762e+02  1.33514868e+03  1.33514868e+03  1.33514868e+03
  2.78629950e+03  3.02889332e+03  3.02889332e+03  3.02889332e+03
  6.64897551e+03  6.64897551e+03  6.64897551e+03  9.18353357e+03
  2.55326056e+04  7.62669122e+04]
E1 = -728.2893924960255  E_coul = 201.53904829726025
cycle= 6 E= -526.750344198765  delta_E= -6.34e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2893924960255  E_coul = 201.53904829726025
  HOMO = -0.583281124753879  LUMO = 0.923255069983776
  mo_energy =
[-1.18583992e+02 -1.23127956e+01 -9.56283989e+00 -9.56283989e+00
 -9.56283989e+00 -1.27049747e+00 -5.83281125e-01 -5.83281125e-01
 -5.83281125e-01  9.23255070e-01  1.01346166e+00  1.01346166e+00
  1.01346166e+00  7.28593266e+00  7.28593266e+00  7.28593266e+00
  9.60192078e+00  3.34573978e+01  3.34573978e+01  3.34573978e+01
  5.25635105e+01  1.29193905e+02  1.29193905e+02  1.29193905e+02
  1.99714831e+02  4.83631023e+02  4.83631023e+02  4.83631023e+02
  7.16145763e+02  1.33514868e+03  1.33514868e+03  1.33514868e+03
  2.78629950e+03  3.02889332e+03  3.02889332e+03  3.02889332e+03
  6.64897551e+03  6.64897551e+03  6.64897551e+03  9.18353357e+03
  2.55326056e+04  7.62669122e+04]
E1 = -728.2893898017641  E_coul = 201.53904560299708
Extra cycle  E= -526.750344198767  delta_E= -1.71e-12  |g|= 3.89e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826681e+04 7.61749530e+03 3.61736364e+03 1.59727177e+03
 3.82659694e+02 1.17145375e+02 4.43181266e+01 2.07953112e+01
 6.91174765e+00 6.52057319e-01 2.81675798e+00 2.32013590e-01
 1.36278731e+03 6.64705290e+02 3.00771554e+02 3.13878090e+02
 6.17406340e+01 7.34300108e+00 2.02659872e+01 7.75488312e-01
 2.81420860e+00 2.22597408e-01]
E = -526.7503441987669
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:08 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6681071        1
[INPUT] 0    0    [1    /1   ]  7617.49530055        1
[INPUT] 0    0    [1    /1   ]  3617.3636373         1
[INPUT] 0    0    [1    /1   ]  1597.27177381        1
[INPUT] 0    0    [1    /1   ]  382.659694239        1
[INPUT] 0    0    [1    /1   ]  117.145375307        1
[INPUT] 0    0    [1    /1   ]  44.3181265923        1
[INPUT] 0    0    [1    /1   ]  20.7953111923        1
[INPUT] 0    0    [1    /1   ]  6.91174764786        1
[INPUT] 0    0    [1    /1   ]  0.652057319243       1
[INPUT] 0    0    [1    /1   ]  2.816757977          1
[INPUT] 0    0    [1    /1   ]  0.232013590473       1
[INPUT] 1    0    [1    /1   ]  1362.78730937        1
[INPUT] 1    0    [1    /1   ]  664.705289668        1
[INPUT] 1    0    [1    /1   ]  300.771554303        1
[INPUT] 1    0    [1    /1   ]  313.878090492        1
[INPUT] 1    0    [1    /1   ]  61.7406340432        1
[INPUT] 1    0    [1    /1   ]  7.34300107526        1
[INPUT] 1    0    [1    /1   ]  20.2659871749        1
[INPUT] 1    0    [1    /1   ]  0.775488311961       1
[INPUT] 1    0    [1    /1   ]  2.81420860008        1
[INPUT] 1    0    [1    /1   ]  0.222597408032       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668107066085, 1.0]], [0, [7617.495300552329, 1.0]], [0, [3617.363637301886, 1.0]], [0, [1597.271773814578, 1.0]], [0, [382.6596942390862, 1.0]], [0, [117.14537530655804, 1.0]], [0, [44.318126592310726, 1.0]], [0, [20.79531119225482, 1.0]], [0, [6.911747647859668, 1.0]], [0, [0.6520573192431892, 1.0]], [0, [2.8167579769982267, 1.0]], [0, [0.23201359047300774, 1.0]], [1, [1362.7873093680262, 1.0]], [1, [664.705289668336, 1.0]], [1, [300.7715543029978, 1.0]], [1, [313.8780904920905, 1.0]], [1, [61.74063404322858, 1.0]], [1, [7.34300107526389, 1.0]], [1, [20.26598717485707, 1.0]], [1, [0.7754883119611183, 1.0]], [1, [2.814208600082725, 1.0]], [1, [0.22259740803153247, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66810707]
bas 1, expnt(s) = [7617.49530055]
bas 2, expnt(s) = [3617.3636373]
bas 3, expnt(s) = [1597.27177381]
bas 4, expnt(s) = [382.65969424]
bas 5, expnt(s) = [117.14537531]
bas 6, expnt(s) = [44.31812659]
bas 7, expnt(s) = [20.79531119]
bas 8, expnt(s) = [6.91174765]
bas 9, expnt(s) = [0.65205732]
bas 10, expnt(s) = [2.81675798]
bas 11, expnt(s) = [0.23201359]
bas 12, expnt(s) = [1362.78730937]
bas 13, expnt(s) = [664.70528967]
bas 14, expnt(s) = [300.7715543]
bas 15, expnt(s) = [313.87809049]
bas 16, expnt(s) = [61.74063404]
bas 17, expnt(s) = [7.34300108]
bas 18, expnt(s) = [20.26598717]
bas 19, expnt(s) = [0.77548831]
bas 20, expnt(s) = [2.8142086]
bas 21, expnt(s) = [0.22259741]
CPU time:       362.33
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826681e+04 5.20026469e+03 7.61749530e+03 2.06003297e+03
 3.61736364e+03 1.17844455e+03 1.59727177e+03 6.38335705e+02
 3.82659694e+02 2.18587118e+02 1.17145375e+02 8.99619551e+01
 4.43181266e+01 4.33961368e+01 2.07953112e+01 2.46030581e+01
 6.91174765e+00 1.07697576e+01 6.52057319e-01 1.83328234e+00
 2.81675798e+00 5.49322229e+00 2.32013590e-01 8.44598086e-01
 1.36278731e+03 2.41556926e+04 6.64705290e+02 9.84624893e+03
 3.00771554e+02 3.65409928e+03 3.13878090e+02 3.85421241e+03
 6.17406340e+01 5.04891721e+02 7.34300108e+00 3.52635785e+01
 2.02659872e+01 1.25442326e+02 7.75488312e-01 2.12301696e+00
 2.81420860e+00 1.06335861e+01 2.22597408e-01 4.46051004e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99379958726459
cond(S) = 114796.92849235094
E1 = -729.5422790507664  E_coul = 203.17538590338654
init E= -526.36689314738
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555780830690964  LUMO = 0.943075219704029
  mo_energy =
[-1.18332611e+02 -1.22068538e+01 -9.44715527e+00 -9.44715527e+00
 -9.44715527e+00 -1.24020781e+00 -5.55780831e-01 -5.55780831e-01
 -5.55780831e-01  9.43075220e-01  1.03230105e+00  1.03230105e+00
  1.03230105e+00  7.35721525e+00  7.35721525e+00  7.35721525e+00
  9.67465171e+00  3.35785576e+01  3.35785576e+01  3.35785576e+01
  5.26893773e+01  1.29375830e+02  1.29375830e+02  1.29375830e+02
  1.99903976e+02  4.83881885e+02  4.83881885e+02  4.83881885e+02
  7.16433569e+02  1.33545280e+03  1.33545280e+03  1.33545280e+03
  2.78673321e+03  3.02926149e+03  3.02926149e+03  3.02926149e+03
  6.64945586e+03  6.64945586e+03  6.64945586e+03  9.18408758e+03
  2.55332542e+04  7.62676513e+04]
E1 = -727.839943661448  E_coul = 201.09039248016296
cycle= 1 E= -526.749551181285  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571642
diis-c [-0.32677439  1.        ]
  HOMO = -0.590947146580371  LUMO = 0.916770277875267
  mo_energy =
[-1.18642163e+02 -1.23453080e+01 -9.59665153e+00 -9.59665153e+00
 -9.59665153e+00 -1.27981614e+00 -5.90947147e-01 -5.90947147e-01
 -5.90947147e-01  9.16770278e-01  1.00777412e+00  1.00777412e+00
  1.00777412e+00  7.26579723e+00  7.26579723e+00  7.26579723e+00
  9.57998220e+00  3.34232205e+01  3.34232205e+01  3.34232205e+01
  5.25263689e+01  1.29145984e+02  1.29145984e+02  1.29145984e+02
  1.99664734e+02  4.83573551e+02  4.83573551e+02  4.83573551e+02
  7.16086480e+02  1.33508774e+03  1.33508774e+03  1.33508774e+03
  2.78623600e+03  3.02883054e+03  3.02883054e+03  3.02883054e+03
  6.64891138e+03  6.64891138e+03  6.64891138e+03  9.18346887e+03
  2.55325405e+04  7.62668470e+04]
E1 = -728.418223995629  E_coul = 201.66794170852796
cycle= 2 E= -526.750282287101  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776111
diis-c [-0.00384029  0.07597522  0.92402478]
  HOMO = -0.581712536696958  LUMO = 0.924438841855548
  mo_energy =
[-1.18573458e+02 -1.23067047e+01 -9.55636619e+00 -9.55636619e+00
 -9.55636619e+00 -1.26875512e+00 -5.81712537e-01 -5.81712537e-01
 -5.81712537e-01  9.24438842e-01  1.01459080e+00  1.01459080e+00
  1.01459080e+00  7.28989316e+00  7.28989316e+00  7.28989316e+00
  9.60609047e+00  3.34638954e+01  3.34638954e+01  3.34638954e+01
  5.25704364e+01  1.29202719e+02  1.29202719e+02  1.29202719e+02
  1.99723983e+02  4.83641433e+02  4.83641433e+02  4.83641433e+02
  7.16156534e+02  1.33515972e+03  1.33515972e+03  1.33515972e+03
  2.78631121e+03  3.02890479e+03  3.02890479e+03  3.02890479e+03
  6.64898740e+03  6.64898740e+03  6.64898740e+03  9.18354568e+03
  2.55326179e+04  7.62669247e+04]
E1 = -728.2654313862646  E_coul = 201.51508933815398
cycle= 3 E= -526.750342048111  delta_E= -5.98e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.014169
diis-c [-8.40240707e-07 -1.30994643e-03  1.49951126e-01  8.51358821e-01]
  HOMO = -0.583292860982657  LUMO = 0.923223817448679
  mo_energy =
[-1.18584013e+02 -1.23128445e+01 -9.56287271e+00 -9.56287271e+00
 -9.56287271e+00 -1.27053613e+00 -5.83292861e-01 -5.83292861e-01
 -5.83292861e-01  9.23223817e-01  1.01344983e+00  1.01344983e+00
  1.01344983e+00  7.28590410e+00  7.28590410e+00  7.28590410e+00
  9.60187550e+00  3.34573660e+01  3.34573660e+01  3.34573660e+01
  5.25634711e+01  1.29193876e+02  1.29193876e+02  1.29193876e+02
  1.99714802e+02  4.83631001e+02  4.83631001e+02  4.83631001e+02
  7.16145750e+02  1.33514866e+03  1.33514866e+03  1.33514866e+03
  2.78629951e+03  3.02889332e+03  3.02889332e+03  3.02889332e+03
  6.64897552e+03  6.64897552e+03  6.64897552e+03  9.18353359e+03
  2.55326056e+04  7.62669123e+04]
E1 = -728.2895551936498  E_coul = 201.5392109970026
cycle= 4 E= -526.750344196647  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116059
diis-c [-5.11604247e-09  8.55490238e-05 -1.21747464e-02 -7.29548885e-02
  1.08504409e+00]
  HOMO = -0.583273357652106  LUMO = 0.923258454071828
  mo_energy =
[-1.18583961e+02 -1.23127726e+01 -9.56281479e+00 -9.56281479e+00
 -9.56281479e+00 -1.27049175e+00 -5.83273358e-01 -5.83273358e-01
 -5.83273358e-01  9.23258454e-01  1.01346675e+00  1.01346675e+00
  1.01346675e+00  7.28594974e+00  7.28594974e+00  7.28594974e+00
  9.60193735e+00  3.34574221e+01  3.34574221e+01  3.34574221e+01
  5.25635353e+01  1.29193933e+02  1.29193933e+02  1.29193933e+02
  1.99714860e+02  4.83631053e+02  4.83631053e+02  4.83631053e+02
  7.16145794e+02  1.33514871e+03  1.33514871e+03  1.33514871e+03
  2.78629953e+03  3.02889336e+03  3.02889336e+03  3.02889336e+03
  6.64897554e+03  6.64897554e+03  6.64897554e+03  9.18353360e+03
  2.55326056e+04  7.62669123e+04]
E1 = -728.2893080033908  E_coul = 201.53896380468905
cycle= 5 E= -526.750344198702  delta_E= -2.05e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.97156e-05
diis-c [-9.46568165e-11  1.29871445e-05 -1.77880841e-03 -1.27325829e-02
  3.41446802e-02  9.80353724e-01]
  HOMO = -0.583281223029083  LUMO = 0.923254640649231
  mo_energy =
[-1.18583993e+02 -1.23127962e+01 -9.56284039e+00 -9.56284039e+00
 -9.56284039e+00 -1.27049799e+00 -5.83281223e-01 -5.83281223e-01
 -5.83281223e-01  9.23254641e-01  1.01346153e+00  1.01346153e+00
  1.01346153e+00  7.28593231e+00  7.28593231e+00  7.28593231e+00
  9.60192027e+00  3.34573972e+01  3.34573972e+01  3.34573972e+01
  5.25635099e+01  1.29193904e+02  1.29193904e+02  1.29193904e+02
  1.99714831e+02  4.83631022e+02  4.83631022e+02  4.83631022e+02
  7.16145762e+02  1.33514868e+03  1.33514868e+03  1.33514868e+03
  2.78629950e+03  3.02889332e+03  3.02889332e+03  3.02889332e+03
  6.64897551e+03  6.64897551e+03  6.64897551e+03  9.18353357e+03
  2.55326056e+04  7.62669122e+04]
E1 = -728.2893924960255  E_coul = 201.53904829726025
cycle= 6 E= -526.750344198765  delta_E= -6.34e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2893924960255  E_coul = 201.53904829726025
  HOMO = -0.583281124753879  LUMO = 0.923255069983776
  mo_energy =
[-1.18583992e+02 -1.23127956e+01 -9.56283989e+00 -9.56283989e+00
 -9.56283989e+00 -1.27049747e+00 -5.83281125e-01 -5.83281125e-01
 -5.83281125e-01  9.23255070e-01  1.01346166e+00  1.01346166e+00
  1.01346166e+00  7.28593266e+00  7.28593266e+00  7.28593266e+00
  9.60192078e+00  3.34573978e+01  3.34573978e+01  3.34573978e+01
  5.25635105e+01  1.29193905e+02  1.29193905e+02  1.29193905e+02
  1.99714831e+02  4.83631023e+02  4.83631023e+02  4.83631023e+02
  7.16145763e+02  1.33514868e+03  1.33514868e+03  1.33514868e+03
  2.78629950e+03  3.02889332e+03  3.02889332e+03  3.02889332e+03
  6.64897551e+03  6.64897551e+03  6.64897551e+03  9.18353357e+03
  2.55326056e+04  7.62669122e+04]
E1 = -728.2893898017641  E_coul = 201.53904560299708
Extra cycle  E= -526.750344198767  delta_E= -1.71e-12  |g|= 3.89e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114796.92849235094
E1 = -728.2893898017641  E_coul = 201.53904560299708
init E= -526.750344198767
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583281191996739  LUMO = 0.92325508856074
  mo_energy =
[-1.18583992e+02 -1.23127958e+01 -9.56284011e+00 -9.56284011e+00
 -9.56284011e+00 -1.27049746e+00 -5.83281192e-01 -5.83281192e-01
 -5.83281192e-01  9.23255089e-01  1.01346162e+00  1.01346162e+00
  1.01346162e+00  7.28593252e+00  7.28593252e+00  7.28593252e+00
  9.60192067e+00  3.34573975e+01  3.34573975e+01  3.34573975e+01
  5.25635103e+01  1.29193905e+02  1.29193905e+02  1.29193905e+02
  1.99714831e+02  4.83631022e+02  4.83631022e+02  4.83631022e+02
  7.16145762e+02  1.33514868e+03  1.33514868e+03  1.33514868e+03
  2.78629950e+03  3.02889332e+03  3.02889332e+03  3.02889332e+03
  6.64897551e+03  6.64897551e+03  6.64897551e+03  9.18353357e+03
  2.55326056e+04  7.62669122e+04]
E1 = -728.2893904158122  E_coul = 201.53904621704527
cycle= 1 E= -526.750344198767  delta_E=    0  |g|= 8.87e-08  |ddm|= 6.12e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2893904158122  E_coul = 201.53904621704527
  HOMO = -0.583281183385818  LUMO = 0.923255110364298
  mo_energy =
[-1.18583992e+02 -1.23127958e+01 -9.56284007e+00 -9.56284007e+00
 -9.56284007e+00 -1.27049744e+00 -5.83281183e-01 -5.83281183e-01
 -5.83281183e-01  9.23255110e-01  1.01346163e+00  1.01346163e+00
  1.01346163e+00  7.28593254e+00  7.28593254e+00  7.28593254e+00
  9.60192071e+00  3.34573976e+01  3.34573976e+01  3.34573976e+01
  5.25635103e+01  1.29193905e+02  1.29193905e+02  1.29193905e+02
  1.99714831e+02  4.83631022e+02  4.83631022e+02  4.83631022e+02
  7.16145762e+02  1.33514868e+03  1.33514868e+03  1.33514868e+03
  2.78629950e+03  3.02889332e+03  3.02889332e+03  3.02889332e+03
  6.64897551e+03  6.64897551e+03  6.64897551e+03  9.18353357e+03
  2.55326056e+04  7.62669122e+04]
E1 = -728.2893902130178  E_coul = 201.53904601425057
Extra cycle  E= -526.750344198767  delta_E= -2.27e-13  |g|= 1.91e-08  |ddm|= 1.39e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61826681e+04 7.61749530e+03 3.61736364e+03 1.59727177e+03
 3.82659694e+02 1.17145375e+02 4.43181266e+01 2.07953112e+01
 6.91174765e+00 6.52057319e-01 2.81675798e+00 2.32013590e-01
 1.36278731e+03 6.64705290e+02 3.00771554e+02 3.13878090e+02
 6.17406340e+01 7.34300108e+00 2.02659872e+01 7.75488312e-01
 2.81420860e+00 2.22597408e-01]
grad_E = [-1.56557389e-06  3.86648020e-06 -1.19504377e-06  8.96380054e-05
 -4.19015555e-04 -2.45276265e-04 -1.27073282e-04  2.66117915e-04
  3.03256866e-05  4.17081633e-04  7.15430461e-05 -5.22462064e-04
 -5.16152280e-07  4.89872646e-06  2.30202579e-05  1.98347399e-05
  5.97821894e-06  2.75975991e-04 -9.26775672e-05 -5.80219183e-04
 -3.82338259e-04  1.86349664e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:12 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6681564        1
[INPUT] 0    0    [1    /1   ]  7617.49519013        1
[INPUT] 0    0    [1    /1   ]  3617.36368603        1
[INPUT] 0    0    [1    /1   ]  1597.26940863        1
[INPUT] 0    0    [1    /1   ]  382.662569204        1
[INPUT] 0    0    [1    /1   ]  117.168991366        1
[INPUT] 0    0    [1    /1   ]  44.3653190443        1
[INPUT] 0    0    [1    /1   ]  20.8384174046        1
[INPUT] 0    0    [1    /1   ]  6.90643047295        1
[INPUT] 0    0    [1    /1   ]  0.651762070408       1
[INPUT] 0    0    [1    /1   ]  2.81012817576        1
[INPUT] 0    0    [1    /1   ]  0.231931472647       1
[INPUT] 1    0    [1    /1   ]  1362.7873258         1
[INPUT] 1    0    [1    /1   ]  664.70512853         1
[INPUT] 1    0    [1    /1   ]  300.770794736        1
[INPUT] 1    0    [1    /1   ]  313.877435696        1
[INPUT] 1    0    [1    /1   ]  61.7411048672        1
[INPUT] 1    0    [1    /1   ]  7.34284681294        1
[INPUT] 1    0    [1    /1   ]  20.2658842208        1
[INPUT] 1    0    [1    /1   ]  0.775630648309       1
[INPUT] 1    0    [1    /1   ]  2.81581361017        1
[INPUT] 1    0    [1    /1   ]  0.222565360274       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.66815640211, 1.0]], [0, [7617.495190127696, 1.0]], [0, [3617.3636860288298, 1.0]], [0, [1597.2694086339634, 1.0]], [0, [382.6625692041925, 1.0]], [0, [117.16899136590983, 1.0]], [0, [44.365319044331805, 1.0]], [0, [20.838417404587123, 1.0]], [0, [6.906430472950285, 1.0]], [0, [0.6517620704084441, 1.0]], [0, [2.8101281757604775, 1.0]], [0, [0.23193147264660705, 1.0]], [1, [1362.7873257987178, 1.0]], [1, [664.7051285299472, 1.0]], [1, [300.7707947359543, 1.0]], [1, [313.8774356963767, 1.0]], [1, [61.74110486722568, 1.0]], [1, [7.342846812942651, 1.0]], [1, [20.26588422081949, 1.0]], [1, [0.7756306483093112, 1.0]], [1, [2.8158136101725093, 1.0]], [1, [0.22256536027433624, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6681564]
bas 1, expnt(s) = [7617.49519013]
bas 2, expnt(s) = [3617.36368603]
bas 3, expnt(s) = [1597.26940863]
bas 4, expnt(s) = [382.6625692]
bas 5, expnt(s) = [117.16899137]
bas 6, expnt(s) = [44.36531904]
bas 7, expnt(s) = [20.8384174]
bas 8, expnt(s) = [6.90643047]
bas 9, expnt(s) = [0.65176207]
bas 10, expnt(s) = [2.81012818]
bas 11, expnt(s) = [0.23193147]
bas 12, expnt(s) = [1362.7873258]
bas 13, expnt(s) = [664.70512853]
bas 14, expnt(s) = [300.77079474]
bas 15, expnt(s) = [313.8774357]
bas 16, expnt(s) = [61.74110487]
bas 17, expnt(s) = [7.34284681]
bas 18, expnt(s) = [20.26588422]
bas 19, expnt(s) = [0.77563065]
bas 20, expnt(s) = [2.81581361]
bas 21, expnt(s) = [0.22256536]
CPU time:       368.08
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826682e+04 5.20026470e+03 7.61749519e+03 2.06003294e+03
 3.61736369e+03 1.17844456e+03 1.59726941e+03 6.38334996e+02
 3.82662569e+02 2.18588350e+02 1.17168991e+02 8.99755568e+01
 4.43653190e+01 4.34307902e+01 2.08384174e+01 2.46412976e+01
 6.90643047e+00 1.07635432e+01 6.51762070e-01 1.83265973e+00
 2.81012818e+00 5.48352239e+00 2.31931473e-01 8.44373876e-01
 1.36278733e+03 2.41556929e+04 6.64705129e+02 9.84624594e+03
 3.00770795e+02 3.65408774e+03 3.13877436e+02 3.85420235e+03
 6.17411049e+01 5.04896533e+02 7.34284681e+00 3.52626525e+01
 2.02658842e+01 1.25441529e+02 7.75630648e-01 2.12350405e+00
 2.81581361e+00 1.06411673e+01 2.22565360e-01 4.45970732e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993801702800695
cond(S) = 114785.4535409936
E1 = -729.5422118201571  E_coul = 203.17529670800744
init E= -526.36691511215
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555786690343901  LUMO = 0.942151132279706
  mo_energy =
[-1.18332614e+02 -1.22068639e+01 -9.44716028e+00 -9.44716028e+00
 -9.44716028e+00 -1.24020855e+00 -5.55786690e-01 -5.55786690e-01
 -5.55786690e-01  9.42151132e-01  1.03231128e+00  1.03231128e+00
  1.03231128e+00  7.36029165e+00  7.36029165e+00  7.36029165e+00
  9.65648323e+00  3.35842456e+01  3.35842456e+01  3.35842456e+01
  5.27075264e+01  1.29381143e+02  1.29381143e+02  1.29381143e+02
  2.00094825e+02  4.83886343e+02  4.83886343e+02  4.83886343e+02
  7.16781461e+02  1.33545550e+03  1.33545550e+03  1.33545550e+03
  2.78711454e+03  3.02926196e+03  3.02926196e+03  3.02926196e+03
  6.64945465e+03  6.64945465e+03  6.64945465e+03  9.18445099e+03
  2.55335994e+04  7.62679729e+04]
E1 = -727.8388479942101  E_coul = 201.0892957060762
cycle= 1 E= -526.749552288134  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571782
diis-c [-0.32693448  1.        ]
  HOMO = -0.590978748269604  LUMO = 0.915851119936265
  mo_energy =
[-1.18642262e+02 -1.23453822e+01 -9.59673486e+00 -9.59673486e+00
 -9.59673486e+00 -1.27984797e+00 -5.90978748e-01 -5.90978748e-01
 -5.90978748e-01  9.15851120e-01  1.00775905e+00  1.00775905e+00
  1.00775905e+00  7.26879793e+00  7.26879793e+00  7.26879793e+00
  9.56183295e+00  3.34288394e+01  3.34288394e+01  3.34288394e+01
  5.25443609e+01  1.29151206e+02  1.29151206e+02  1.29151206e+02
  1.99855426e+02  4.83577918e+02  4.83577918e+02  4.83577918e+02
  7.16434264e+02  1.33509035e+03  1.33509035e+03  1.33509035e+03
  2.78661723e+03  3.02883090e+03  3.02883090e+03  3.02883090e+03
  6.64891007e+03  6.64891007e+03  6.64891007e+03  9.18383219e+03
  2.55328855e+04  7.62671684e+04]
E1 = -728.4174662334526  E_coul = 201.66718212706465
cycle= 2 E= -526.750284106388  delta_E= -0.000732  |g|= 0.038  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776507
diis-c [-0.00384379  0.07600083  0.92399917]
  HOMO = -0.58173785138703  LUMO = 0.92351650844918
  mo_energy =
[-1.18573524e+02 -1.23067565e+01 -9.55642690e+00 -9.55642690e+00
 -9.55642690e+00 -1.26878006e+00 -5.81737851e-01 -5.81737851e-01
 -5.81737851e-01  9.23516508e-01  1.01458142e+00  1.01458142e+00
  1.01458142e+00  7.29291389e+00  7.29291389e+00  7.29291389e+00
  9.58794079e+00  3.34695366e+01  3.34695366e+01  3.34695366e+01
  5.25884720e+01  1.29207969e+02  1.29207969e+02  1.29207969e+02
  1.99914716e+02  4.83645832e+02  4.83645832e+02  4.83645832e+02
  7.16504352e+02  1.33516236e+03  1.33516236e+03  1.33516236e+03
  2.78669248e+03  3.02890519e+03  3.02890519e+03  3.02890519e+03
  6.64898612e+03  6.64898612e+03  6.64898612e+03  9.18390903e+03
  2.55329630e+04  7.62672462e+04]
E1 = -728.2645810826572  E_coul = 201.51423714634282
cycle= 3 E= -526.750343936314  delta_E= -5.98e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141762
diis-c [-8.41320804e-07 -1.31060459e-03  1.49949722e-01  8.51360882e-01]
  HOMO = -0.583318956500943  LUMO = 0.922301935746244
  mo_energy =
[-1.18584083e+02 -1.23128989e+01 -9.56293631e+00 -9.56293631e+00
 -9.56293631e+00 -1.27056217e+00 -5.83318957e-01 -5.83318957e-01
 -5.83318957e-01  9.22301936e-01  1.01343963e+00  1.01343963e+00
  1.01343963e+00  7.28892206e+00  7.28892206e+00  7.28892206e+00
  9.58372663e+00  3.34630044e+01  3.34630044e+01  3.34630044e+01
  5.25815010e+01  1.29199123e+02  1.29199123e+02  1.29199123e+02
  1.99905529e+02  4.83635396e+02  4.83635396e+02  4.83635396e+02
  7.16493563e+02  1.33515130e+03  1.33515130e+03  1.33515130e+03
  2.78668077e+03  3.02889372e+03  3.02889372e+03  3.02889372e+03
  6.64897424e+03  6.64897424e+03  6.64897424e+03  9.18389694e+03
  2.55329507e+04  7.62672337e+04]
E1 = -728.2887177459563  E_coul = 201.53837165900927
cycle= 4 E= -526.750346086947  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116119
diis-c [-5.10761103e-09  8.54767486e-05 -1.21629593e-02 -7.29013639e-02
  1.08497885e+00]
  HOMO = -0.583299468385827  LUMO = 0.922336479496216
  mo_energy =
[-1.18584031e+02 -1.23128270e+01 -9.56287848e+00 -9.56287848e+00
 -9.56287848e+00 -1.27051787e+00 -5.83299468e-01 -5.83299468e-01
 -5.83299468e-01  9.22336479e-01  1.01345654e+00  1.01345654e+00
  1.01345654e+00  7.28896765e+00  7.28896765e+00  7.28896765e+00
  9.58378840e+00  3.34630604e+01  3.34630604e+01  3.34630604e+01
  5.25815651e+01  1.29199180e+02  1.29199180e+02  1.29199180e+02
  1.99905587e+02  4.83635448e+02  4.83635448e+02  4.83635448e+02
  7.16493608e+02  1.33515134e+03  1.33515134e+03  1.33515134e+03
  2.78668079e+03  3.02889375e+03  3.02889375e+03  3.02889375e+03
  6.64897426e+03  6.64897426e+03  6.64897426e+03  9.18389695e+03
  2.55329507e+04  7.62672337e+04]
E1 = -728.288470933504  E_coul = 201.5381248445121
cycle= 5 E= -526.750346088992  delta_E= -2.04e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96872e-05
diis-c [-9.44617168e-11  1.29626655e-05 -1.77565067e-03 -1.27127053e-02
  3.44129599e-02  9.80062433e-01]
  HOMO = -0.583307328466061  LUMO = 0.922332666855601
  mo_energy =
[-1.18584063e+02 -1.23128507e+01 -9.56290406e+00 -9.56290406e+00
 -9.56290406e+00 -1.27052411e+00 -5.83307328e-01 -5.83307328e-01
 -5.83307328e-01  9.22332667e-01  1.01345132e+00  1.01345132e+00
  1.01345132e+00  7.28895023e+00  7.28895023e+00  7.28895023e+00
  9.58377134e+00  3.34630356e+01  3.34630356e+01  3.34630356e+01
  5.25815397e+01  1.29199151e+02  1.29199151e+02  1.29199151e+02
  1.99905558e+02  4.83635417e+02  4.83635417e+02  4.83635417e+02
  7.16493575e+02  1.33515131e+03  1.33515131e+03  1.33515131e+03
  2.78668076e+03  3.02889372e+03  3.02889372e+03  3.02889372e+03
  6.64897423e+03  6.64897423e+03  6.64897423e+03  9.18389691e+03
  2.55329506e+04  7.62672337e+04]
E1 = -728.2885553850957  E_coul = 201.5382092960407
cycle= 6 E= -526.750346089055  delta_E= -6.32e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2885553850957  E_coul = 201.5382092960407
  HOMO = -0.583307231676479  LUMO = 0.922333095083109
  mo_energy =
[-1.18584062e+02 -1.23128501e+01 -9.56290357e+00 -9.56290357e+00
 -9.56290357e+00 -1.27052359e+00 -5.83307232e-01 -5.83307232e-01
 -5.83307232e-01  9.22333095e-01  1.01345144e+00  1.01345144e+00
  1.01345144e+00  7.28895057e+00  7.28895057e+00  7.28895057e+00
  9.58377185e+00  3.34630361e+01  3.34630361e+01  3.34630361e+01
  5.25815402e+01  1.29199152e+02  1.29199152e+02  1.29199152e+02
  1.99905559e+02  4.83635417e+02  4.83635417e+02  4.83635417e+02
  7.16493576e+02  1.33515131e+03  1.33515131e+03  1.33515131e+03
  2.78668076e+03  3.02889372e+03  3.02889372e+03  3.02889372e+03
  6.64897423e+03  6.64897423e+03  6.64897423e+03  9.18389691e+03
  2.55329506e+04  7.62672337e+04]
E1 = -728.2885527049566  E_coul = 201.5382066159015
Extra cycle  E= -526.750346089055  delta_E= -1.14e-13  |g|= 3.89e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
exp = [2.61826682e+04 7.61749519e+03 3.61736369e+03 1.59726941e+03
 3.82662569e+02 1.17168991e+02 4.43653190e+01 2.08384174e+01
 6.90643047e+00 6.51762070e-01 2.81012818e+00 2.31931473e-01
 1.36278733e+03 6.64705129e+02 3.00770795e+02 3.13877436e+02
 6.17411049e+01 7.34284681e+00 2.02658842e+01 7.75630648e-01
 2.81581361e+00 2.22565360e-01]
E = -526.7503460890551
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:13 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6681564        1
[INPUT] 0    0    [1    /1   ]  7617.49519013        1
[INPUT] 0    0    [1    /1   ]  3617.36368603        1
[INPUT] 0    0    [1    /1   ]  1597.26940863        1
[INPUT] 0    0    [1    /1   ]  382.662569204        1
[INPUT] 0    0    [1    /1   ]  117.168991366        1
[INPUT] 0    0    [1    /1   ]  44.3653190443        1
[INPUT] 0    0    [1    /1   ]  20.8384174046        1
[INPUT] 0    0    [1    /1   ]  6.90643047295        1
[INPUT] 0    0    [1    /1   ]  0.651762070408       1
[INPUT] 0    0    [1    /1   ]  2.81012817576        1
[INPUT] 0    0    [1    /1   ]  0.231931472647       1
[INPUT] 1    0    [1    /1   ]  1362.7873258         1
[INPUT] 1    0    [1    /1   ]  664.70512853         1
[INPUT] 1    0    [1    /1   ]  300.770794736        1
[INPUT] 1    0    [1    /1   ]  313.877435696        1
[INPUT] 1    0    [1    /1   ]  61.7411048672        1
[INPUT] 1    0    [1    /1   ]  7.34284681294        1
[INPUT] 1    0    [1    /1   ]  20.2658842208        1
[INPUT] 1    0    [1    /1   ]  0.775630648309       1
[INPUT] 1    0    [1    /1   ]  2.81581361017        1
[INPUT] 1    0    [1    /1   ]  0.222565360274       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.66815640211, 1.0]], [0, [7617.495190127696, 1.0]], [0, [3617.3636860288298, 1.0]], [0, [1597.2694086339634, 1.0]], [0, [382.6625692041925, 1.0]], [0, [117.16899136590983, 1.0]], [0, [44.365319044331805, 1.0]], [0, [20.838417404587123, 1.0]], [0, [6.906430472950285, 1.0]], [0, [0.6517620704084441, 1.0]], [0, [2.8101281757604775, 1.0]], [0, [0.23193147264660705, 1.0]], [1, [1362.7873257987178, 1.0]], [1, [664.7051285299472, 1.0]], [1, [300.7707947359543, 1.0]], [1, [313.8774356963767, 1.0]], [1, [61.74110486722568, 1.0]], [1, [7.342846812942651, 1.0]], [1, [20.26588422081949, 1.0]], [1, [0.7756306483093112, 1.0]], [1, [2.8158136101725093, 1.0]], [1, [0.22256536027433624, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6681564]
bas 1, expnt(s) = [7617.49519013]
bas 2, expnt(s) = [3617.36368603]
bas 3, expnt(s) = [1597.26940863]
bas 4, expnt(s) = [382.6625692]
bas 5, expnt(s) = [117.16899137]
bas 6, expnt(s) = [44.36531904]
bas 7, expnt(s) = [20.8384174]
bas 8, expnt(s) = [6.90643047]
bas 9, expnt(s) = [0.65176207]
bas 10, expnt(s) = [2.81012818]
bas 11, expnt(s) = [0.23193147]
bas 12, expnt(s) = [1362.7873258]
bas 13, expnt(s) = [664.70512853]
bas 14, expnt(s) = [300.77079474]
bas 15, expnt(s) = [313.8774357]
bas 16, expnt(s) = [61.74110487]
bas 17, expnt(s) = [7.34284681]
bas 18, expnt(s) = [20.26588422]
bas 19, expnt(s) = [0.77563065]
bas 20, expnt(s) = [2.81581361]
bas 21, expnt(s) = [0.22256536]
CPU time:       368.55
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826682e+04 5.20026470e+03 7.61749519e+03 2.06003294e+03
 3.61736369e+03 1.17844456e+03 1.59726941e+03 6.38334996e+02
 3.82662569e+02 2.18588350e+02 1.17168991e+02 8.99755568e+01
 4.43653190e+01 4.34307902e+01 2.08384174e+01 2.46412976e+01
 6.90643047e+00 1.07635432e+01 6.51762070e-01 1.83265973e+00
 2.81012818e+00 5.48352239e+00 2.31931473e-01 8.44373876e-01
 1.36278733e+03 2.41556929e+04 6.64705129e+02 9.84624594e+03
 3.00770795e+02 3.65408774e+03 3.13877436e+02 3.85420235e+03
 6.17411049e+01 5.04896533e+02 7.34284681e+00 3.52626525e+01
 2.02658842e+01 1.25441529e+02 7.75630648e-01 2.12350405e+00
 2.81581361e+00 1.06411673e+01 2.22565360e-01 4.45970732e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993801702800695
cond(S) = 114785.4535409936
E1 = -729.5422118201571  E_coul = 203.17529670800744
init E= -526.36691511215
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555786690343901  LUMO = 0.942151132279706
  mo_energy =
[-1.18332614e+02 -1.22068639e+01 -9.44716028e+00 -9.44716028e+00
 -9.44716028e+00 -1.24020855e+00 -5.55786690e-01 -5.55786690e-01
 -5.55786690e-01  9.42151132e-01  1.03231128e+00  1.03231128e+00
  1.03231128e+00  7.36029165e+00  7.36029165e+00  7.36029165e+00
  9.65648323e+00  3.35842456e+01  3.35842456e+01  3.35842456e+01
  5.27075264e+01  1.29381143e+02  1.29381143e+02  1.29381143e+02
  2.00094825e+02  4.83886343e+02  4.83886343e+02  4.83886343e+02
  7.16781461e+02  1.33545550e+03  1.33545550e+03  1.33545550e+03
  2.78711454e+03  3.02926196e+03  3.02926196e+03  3.02926196e+03
  6.64945465e+03  6.64945465e+03  6.64945465e+03  9.18445099e+03
  2.55335994e+04  7.62679729e+04]
E1 = -727.8388479942101  E_coul = 201.0892957060762
cycle= 1 E= -526.749552288134  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571782
diis-c [-0.32693448  1.        ]
  HOMO = -0.590978748269604  LUMO = 0.915851119936265
  mo_energy =
[-1.18642262e+02 -1.23453822e+01 -9.59673486e+00 -9.59673486e+00
 -9.59673486e+00 -1.27984797e+00 -5.90978748e-01 -5.90978748e-01
 -5.90978748e-01  9.15851120e-01  1.00775905e+00  1.00775905e+00
  1.00775905e+00  7.26879793e+00  7.26879793e+00  7.26879793e+00
  9.56183295e+00  3.34288394e+01  3.34288394e+01  3.34288394e+01
  5.25443609e+01  1.29151206e+02  1.29151206e+02  1.29151206e+02
  1.99855426e+02  4.83577918e+02  4.83577918e+02  4.83577918e+02
  7.16434264e+02  1.33509035e+03  1.33509035e+03  1.33509035e+03
  2.78661723e+03  3.02883090e+03  3.02883090e+03  3.02883090e+03
  6.64891007e+03  6.64891007e+03  6.64891007e+03  9.18383219e+03
  2.55328855e+04  7.62671684e+04]
E1 = -728.4174662334526  E_coul = 201.66718212706465
cycle= 2 E= -526.750284106388  delta_E= -0.000732  |g|= 0.038  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776507
diis-c [-0.00384379  0.07600083  0.92399917]
  HOMO = -0.58173785138703  LUMO = 0.92351650844918
  mo_energy =
[-1.18573524e+02 -1.23067565e+01 -9.55642690e+00 -9.55642690e+00
 -9.55642690e+00 -1.26878006e+00 -5.81737851e-01 -5.81737851e-01
 -5.81737851e-01  9.23516508e-01  1.01458142e+00  1.01458142e+00
  1.01458142e+00  7.29291389e+00  7.29291389e+00  7.29291389e+00
  9.58794079e+00  3.34695366e+01  3.34695366e+01  3.34695366e+01
  5.25884720e+01  1.29207969e+02  1.29207969e+02  1.29207969e+02
  1.99914716e+02  4.83645832e+02  4.83645832e+02  4.83645832e+02
  7.16504352e+02  1.33516236e+03  1.33516236e+03  1.33516236e+03
  2.78669248e+03  3.02890519e+03  3.02890519e+03  3.02890519e+03
  6.64898612e+03  6.64898612e+03  6.64898612e+03  9.18390903e+03
  2.55329630e+04  7.62672462e+04]
E1 = -728.2645810826572  E_coul = 201.51423714634282
cycle= 3 E= -526.750343936314  delta_E= -5.98e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141762
diis-c [-8.41320804e-07 -1.31060459e-03  1.49949722e-01  8.51360882e-01]
  HOMO = -0.583318956500943  LUMO = 0.922301935746244
  mo_energy =
[-1.18584083e+02 -1.23128989e+01 -9.56293631e+00 -9.56293631e+00
 -9.56293631e+00 -1.27056217e+00 -5.83318957e-01 -5.83318957e-01
 -5.83318957e-01  9.22301936e-01  1.01343963e+00  1.01343963e+00
  1.01343963e+00  7.28892206e+00  7.28892206e+00  7.28892206e+00
  9.58372663e+00  3.34630044e+01  3.34630044e+01  3.34630044e+01
  5.25815010e+01  1.29199123e+02  1.29199123e+02  1.29199123e+02
  1.99905529e+02  4.83635396e+02  4.83635396e+02  4.83635396e+02
  7.16493563e+02  1.33515130e+03  1.33515130e+03  1.33515130e+03
  2.78668077e+03  3.02889372e+03  3.02889372e+03  3.02889372e+03
  6.64897424e+03  6.64897424e+03  6.64897424e+03  9.18389694e+03
  2.55329507e+04  7.62672337e+04]
E1 = -728.2887177459563  E_coul = 201.53837165900927
cycle= 4 E= -526.750346086947  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116119
diis-c [-5.10761103e-09  8.54767486e-05 -1.21629593e-02 -7.29013639e-02
  1.08497885e+00]
  HOMO = -0.583299468385827  LUMO = 0.922336479496216
  mo_energy =
[-1.18584031e+02 -1.23128270e+01 -9.56287848e+00 -9.56287848e+00
 -9.56287848e+00 -1.27051787e+00 -5.83299468e-01 -5.83299468e-01
 -5.83299468e-01  9.22336479e-01  1.01345654e+00  1.01345654e+00
  1.01345654e+00  7.28896765e+00  7.28896765e+00  7.28896765e+00
  9.58378840e+00  3.34630604e+01  3.34630604e+01  3.34630604e+01
  5.25815651e+01  1.29199180e+02  1.29199180e+02  1.29199180e+02
  1.99905587e+02  4.83635448e+02  4.83635448e+02  4.83635448e+02
  7.16493608e+02  1.33515134e+03  1.33515134e+03  1.33515134e+03
  2.78668079e+03  3.02889375e+03  3.02889375e+03  3.02889375e+03
  6.64897426e+03  6.64897426e+03  6.64897426e+03  9.18389695e+03
  2.55329507e+04  7.62672337e+04]
E1 = -728.288470933504  E_coul = 201.5381248445121
cycle= 5 E= -526.750346088992  delta_E= -2.04e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96872e-05
diis-c [-9.44617168e-11  1.29626655e-05 -1.77565067e-03 -1.27127053e-02
  3.44129599e-02  9.80062433e-01]
  HOMO = -0.583307328466061  LUMO = 0.922332666855601
  mo_energy =
[-1.18584063e+02 -1.23128507e+01 -9.56290406e+00 -9.56290406e+00
 -9.56290406e+00 -1.27052411e+00 -5.83307328e-01 -5.83307328e-01
 -5.83307328e-01  9.22332667e-01  1.01345132e+00  1.01345132e+00
  1.01345132e+00  7.28895023e+00  7.28895023e+00  7.28895023e+00
  9.58377134e+00  3.34630356e+01  3.34630356e+01  3.34630356e+01
  5.25815397e+01  1.29199151e+02  1.29199151e+02  1.29199151e+02
  1.99905558e+02  4.83635417e+02  4.83635417e+02  4.83635417e+02
  7.16493575e+02  1.33515131e+03  1.33515131e+03  1.33515131e+03
  2.78668076e+03  3.02889372e+03  3.02889372e+03  3.02889372e+03
  6.64897423e+03  6.64897423e+03  6.64897423e+03  9.18389691e+03
  2.55329506e+04  7.62672337e+04]
E1 = -728.2885553850957  E_coul = 201.5382092960407
cycle= 6 E= -526.750346089055  delta_E= -6.32e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2885553850957  E_coul = 201.5382092960407
  HOMO = -0.583307231676479  LUMO = 0.922333095083109
  mo_energy =
[-1.18584062e+02 -1.23128501e+01 -9.56290357e+00 -9.56290357e+00
 -9.56290357e+00 -1.27052359e+00 -5.83307232e-01 -5.83307232e-01
 -5.83307232e-01  9.22333095e-01  1.01345144e+00  1.01345144e+00
  1.01345144e+00  7.28895057e+00  7.28895057e+00  7.28895057e+00
  9.58377185e+00  3.34630361e+01  3.34630361e+01  3.34630361e+01
  5.25815402e+01  1.29199152e+02  1.29199152e+02  1.29199152e+02
  1.99905559e+02  4.83635417e+02  4.83635417e+02  4.83635417e+02
  7.16493576e+02  1.33515131e+03  1.33515131e+03  1.33515131e+03
  2.78668076e+03  3.02889372e+03  3.02889372e+03  3.02889372e+03
  6.64897423e+03  6.64897423e+03  6.64897423e+03  9.18389691e+03
  2.55329506e+04  7.62672337e+04]
E1 = -728.2885527049566  E_coul = 201.5382066159015
Extra cycle  E= -526.750346089055  delta_E= -1.14e-13  |g|= 3.89e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114785.4535409936
E1 = -728.2885527049566  E_coul = 201.5382066159015
init E= -526.750346089055
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583307298686907  LUMO = 0.922333113936774
  mo_energy =
[-1.18584063e+02 -1.23128503e+01 -9.56290379e+00 -9.56290379e+00
 -9.56290379e+00 -1.27052359e+00 -5.83307299e-01 -5.83307299e-01
 -5.83307299e-01  9.22333114e-01  1.01345141e+00  1.01345141e+00
  1.01345141e+00  7.28895043e+00  7.28895043e+00  7.28895043e+00
  9.58377174e+00  3.34630359e+01  3.34630359e+01  3.34630359e+01
  5.25815400e+01  1.29199152e+02  1.29199152e+02  1.29199152e+02
  1.99905558e+02  4.83635417e+02  4.83635417e+02  4.83635417e+02
  7.16493576e+02  1.33515131e+03  1.33515131e+03  1.33515131e+03
  2.78668076e+03  3.02889372e+03  3.02889372e+03  3.02889372e+03
  6.64897423e+03  6.64897423e+03  6.64897423e+03  9.18389691e+03
  2.55329506e+04  7.62672337e+04]
E1 = -728.2885533145419  E_coul = 201.5382072254861
cycle= 1 E= -526.750346089056  delta_E= -6.82e-13  |g|= 8.87e-08  |ddm|= 6.13e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2885533145419  E_coul = 201.5382072254861
  HOMO = -0.583307290166714  LUMO = 0.922333135669008
  mo_energy =
[-1.18584063e+02 -1.23128502e+01 -9.56290375e+00 -9.56290375e+00
 -9.56290375e+00 -1.27052356e+00 -5.83307290e-01 -5.83307290e-01
 -5.83307290e-01  9.22333136e-01  1.01345142e+00  1.01345142e+00
  1.01345142e+00  7.28895046e+00  7.28895046e+00  7.28895046e+00
  9.58377177e+00  3.34630359e+01  3.34630359e+01  3.34630359e+01
  5.25815401e+01  1.29199152e+02  1.29199152e+02  1.29199152e+02
  1.99905558e+02  4.83635417e+02  4.83635417e+02  4.83635417e+02
  7.16493576e+02  1.33515131e+03  1.33515131e+03  1.33515131e+03
  2.78668076e+03  3.02889372e+03  3.02889372e+03  3.02889372e+03
  6.64897423e+03  6.64897423e+03  6.64897423e+03  9.18389691e+03
  2.55329506e+04  7.62672337e+04]
E1 = -728.2885531128641  E_coul = 201.53820702380736
Extra cycle  E= -526.750346089057  delta_E= -9.09e-13  |g|= 1.9e-08  |ddm|= 1.39e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826682e+04 7.61749519e+03 3.61736369e+03 1.59726941e+03
 3.82662569e+02 1.17168991e+02 4.43653190e+01 2.08384174e+01
 6.90643047e+00 6.51762070e-01 2.81012818e+00 2.31931473e-01
 1.36278733e+03 6.64705129e+02 3.00770795e+02 3.13877436e+02
 6.17411049e+01 7.34284681e+00 2.02658842e+01 7.75630648e-01
 2.81581361e+00 2.22565360e-01]
grad_E = [-1.56558378e-06  3.86661525e-06 -1.19493401e-06  8.96423307e-05
 -4.18913107e-04 -2.47420438e-04 -1.22639861e-04  2.66384526e-04
  1.32702805e-04  8.69625978e-05 -2.84900891e-04  2.07162481e-04
 -5.15785474e-07  4.90402553e-06  2.30531399e-05  1.98628273e-05
  1.30719836e-06  3.90413659e-05 -4.05783484e-05 -8.68579426e-06
 -3.41634504e-05 -2.96466708e-05]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:18 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6681655        1
[INPUT] 0    0    [1    /1   ]  7617.49516926        1
[INPUT] 0    0    [1    /1   ]  3617.36369457        1
[INPUT] 0    0    [1    /1   ]  1597.26895287        1
[INPUT] 0    0    [1    /1   ]  382.663514671        1
[INPUT] 0    0    [1    /1   ]  117.172839579        1
[INPUT] 0    0    [1    /1   ]  44.3718138345        1
[INPUT] 0    0    [1    /1   ]  20.8431066047        1
[INPUT] 0    0    [1    /1   ]  6.90834427648        1
[INPUT] 0    0    [1    /1   ]  0.651484171005       1
[INPUT] 0    0    [1    /1   ]  2.81017349298        1
[INPUT] 0    0    [1    /1   ]  0.231832308166       1
[INPUT] 1    0    [1    /1   ]  1362.78732881        1
[INPUT] 1    0    [1    /1   ]  664.70509886         1
[INPUT] 1    0    [1    /1   ]  300.770654732        1
[INPUT] 1    0    [1    /1   ]  313.87731502         1
[INPUT] 1    0    [1    /1   ]  61.7412818847        1
[INPUT] 1    0    [1    /1   ]  7.34374088214        1
[INPUT] 1    0    [1    /1   ]  20.2651597032        1
[INPUT] 1    0    [1    /1   ]  0.775756173652       1
[INPUT] 1    0    [1    /1   ]  2.8171893264         1
[INPUT] 1    0    [1    /1   ]  0.222570304485       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668165515835, 1.0]], [0, [7617.495169259306, 1.0]], [0, [3617.363694567243, 1.0]], [0, [1597.2689528670805, 1.0]], [0, [382.66351467127544, 1.0]], [0, [117.17283957939068, 1.0]], [0, [44.371813834503875, 1.0]], [0, [20.843106604650153, 1.0]], [0, [6.90834427648251, 1.0]], [0, [0.651484171004592, 1.0]], [0, [2.810173492979092, 1.0]], [0, [0.23183230816607034, 1.0]], [1, [1362.7873288136418, 1.0]], [1, [664.7050988604157, 1.0]], [1, [300.77065473167147, 1.0]], [1, [313.8773150198348, 1.0]], [1, [61.74128188474692, 1.0]], [1, [7.343740882144642, 1.0]], [1, [20.26515970316825, 1.0]], [1, [0.7757561736516226, 1.0]], [1, [2.8171893264046997, 1.0]], [1, [0.22257030448492132, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66816552]
bas 1, expnt(s) = [7617.49516926]
bas 2, expnt(s) = [3617.36369457]
bas 3, expnt(s) = [1597.26895287]
bas 4, expnt(s) = [382.66351467]
bas 5, expnt(s) = [117.17283958]
bas 6, expnt(s) = [44.37181383]
bas 7, expnt(s) = [20.8431066]
bas 8, expnt(s) = [6.90834428]
bas 9, expnt(s) = [0.65148417]
bas 10, expnt(s) = [2.81017349]
bas 11, expnt(s) = [0.23183231]
bas 12, expnt(s) = [1362.78732881]
bas 13, expnt(s) = [664.70509886]
bas 14, expnt(s) = [300.77065473]
bas 15, expnt(s) = [313.87731502]
bas 16, expnt(s) = [61.74128188]
bas 17, expnt(s) = [7.34374088]
bas 18, expnt(s) = [20.2651597]
bas 19, expnt(s) = [0.77575617]
bas 20, expnt(s) = [2.81718933]
bas 21, expnt(s) = [0.2225703]
CPU time:       374.35
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826682e+04 5.20026470e+03 7.61749517e+03 2.06003294e+03
 3.61736369e+03 1.17844456e+03 1.59726895e+03 6.38334859e+02
 3.82663515e+02 2.18588755e+02 1.17172840e+02 8.99777731e+01
 4.43718138e+01 4.34355586e+01 2.08431066e+01 2.46454562e+01
 6.90834428e+00 1.07657801e+01 6.51484171e-01 1.83207364e+00
 2.81017349e+00 5.48358871e+00 2.31832308e-01 8.44103097e-01
 1.36278733e+03 2.41556930e+04 6.64705099e+02 9.84624539e+03
 3.00770655e+02 3.65408562e+03 3.13877315e+02 3.85420050e+03
 6.17412819e+01 5.04898343e+02 7.34374088e+00 3.52680196e+01
 2.02651597e+01 1.25435923e+02 7.75756174e-01 2.12393364e+00
 2.81718933e+00 1.06476664e+01 2.22570304e-01 4.45983116e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99379960991523
cond(S) = 114786.0529521109
E1 = -729.5422173235105  E_coul = 203.1753005235082
init E= -526.366916800002
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555787224549954  LUMO = 0.941500060215561
  mo_energy =
[-1.18332613e+02 -1.22068631e+01 -9.44715984e+00 -9.44715984e+00
 -9.44715984e+00 -1.24020894e+00 -5.55787225e-01 -5.55787225e-01
 -5.55787225e-01  9.41500060e-01  1.03244725e+00  1.03244725e+00
  1.03244725e+00  7.36338736e+00  7.36338736e+00  7.36338736e+00
  9.65637597e+00  3.35912440e+01  3.35912440e+01  3.35912440e+01
  5.27195359e+01  1.29387404e+02  1.29387404e+02  1.29387404e+02
  2.00131054e+02  4.83890943e+02  4.83890943e+02  4.83890943e+02
  7.16839287e+02  1.33545924e+03  1.33545924e+03  1.33545924e+03
  2.78717748e+03  3.02926502e+03  3.02926502e+03  3.02926502e+03
  6.64945714e+03  6.64945714e+03  6.64945714e+03  9.18451116e+03
  2.55336565e+04  7.62680261e+04]
E1 = -727.8385678553913  E_coul = 201.089015136722
cycle= 1 E= -526.749552718669  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571814
diis-c [-0.32697158  1.        ]
  HOMO = -0.590990225209697  LUMO = 0.915205431558738
  mo_energy =
[-1.18642280e+02 -1.23453996e+01 -9.59675435e+00 -9.59675435e+00
 -9.59675435e+00 -1.27986018e+00 -5.90990225e-01 -5.90990225e-01
 -5.90990225e-01  9.15205432e-01  1.00788169e+00  1.00788169e+00
  1.00788169e+00  7.27185529e+00  7.27185529e+00  7.27185529e+00
  9.56170183e+00  3.34358187e+01  3.34358187e+01  3.34358187e+01
  5.25563368e+01  1.29157450e+02  1.29157450e+02  1.29157450e+02
  1.99891627e+02  4.83582499e+02  4.83582499e+02  4.83582499e+02
  7.16492069e+02  1.33509407e+03  1.33509407e+03  1.33509407e+03
  2.78668017e+03  3.02883395e+03  3.02883395e+03  3.02883395e+03
  6.64891254e+03  6.64891254e+03  6.64891254e+03  9.18389234e+03
  2.55329426e+04  7.62672216e+04]
E1 = -728.4172619834048  E_coul = 201.66697727276178
cycle= 2 E= -526.750284710643  delta_E= -0.000732  |g|= 0.038  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776602
diis-c [-0.00384454  0.07600854  0.92399146]
  HOMO = -0.581747829018349  LUMO = 0.922868277231305
  mo_energy =
[-1.18573536e+02 -1.23067690e+01 -9.55644135e+00 -9.55644135e+00
 -9.55644135e+00 -1.26879051e+00 -5.81747829e-01 -5.81747829e-01
 -5.81747829e-01  9.22868277e-01  1.01470662e+00  1.01470662e+00
  1.01470662e+00  7.29597994e+00  7.29597994e+00  7.29597994e+00
  9.58781597e+00  3.34765213e+01  3.34765213e+01  3.34765213e+01
  5.26004567e+01  1.29214218e+02  1.29214218e+02  1.29214218e+02
  1.99950925e+02  4.83650420e+02  4.83650420e+02  4.83650420e+02
  7.16562163e+02  1.33516609e+03  1.33516609e+03  1.33516609e+03
  2.78675541e+03  3.02890824e+03  3.02890824e+03  3.02890824e+03
  6.64898860e+03  6.64898860e+03  6.64898860e+03  9.18396919e+03
  2.55330201e+04  7.62672994e+04]
E1 = -728.2643579625909  E_coul = 201.51401340699252
cycle= 3 E= -526.750344555598  delta_E= -5.98e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141777
diis-c [-8.41538457e-07 -1.31064954e-03  1.49946947e-01  8.51363702e-01]
  HOMO = -0.583329116611091  LUMO = 0.921654164034233
  mo_energy =
[-1.18584095e+02 -1.23129118e+01 -9.56295121e+00 -9.56295121e+00
 -9.56295121e+00 -1.27057282e+00 -5.83329117e-01 -5.83329117e-01
 -5.83329117e-01  9.21654164e-01  1.01356445e+00  1.01356445e+00
  1.01356445e+00  7.29198692e+00  7.29198692e+00  7.29198692e+00
  9.58360112e+00  3.34699886e+01  3.34699886e+01  3.34699886e+01
  5.25934847e+01  1.29205371e+02  1.29205371e+02  1.29205371e+02
  1.99941738e+02  4.83639983e+02  4.83639983e+02  4.83639983e+02
  7.16551374e+02  1.33515503e+03  1.33515503e+03  1.33515503e+03
  2.78674371e+03  3.02889677e+03  3.02889677e+03  3.02889677e+03
  6.64897672e+03  6.64897672e+03  6.64897672e+03  9.18395709e+03
  2.55330078e+04  7.62672870e+04]
E1 = -728.2884963041733  E_coul = 201.53814959761291
cycle= 4 E= -526.75034670656  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116185
diis-c [-5.10688050e-09  8.55137313e-05 -1.21675603e-02 -7.29355236e-02
  1.08501757e+00]
  HOMO = -0.583309647712415  LUMO = 0.921688680646024
  mo_energy =
[-1.18584044e+02 -1.23128399e+01 -9.56289343e+00 -9.56289343e+00
 -9.56289343e+00 -1.27052854e+00 -5.83309648e-01 -5.83309648e-01
 -5.83309648e-01  9.21688681e-01  1.01358134e+00  1.01358134e+00
  1.01358134e+00  7.29203248e+00  7.29203248e+00  7.29203248e+00
  9.58366286e+00  3.34700445e+01  3.34700445e+01  3.34700445e+01
  5.25935487e+01  1.29205429e+02  1.29205429e+02  1.29205429e+02
  1.99941796e+02  4.83640035e+02  4.83640035e+02  4.83640035e+02
  7.16551418e+02  1.33515507e+03  1.33515507e+03  1.33515507e+03
  2.78674373e+03  3.02889681e+03  3.02889681e+03  3.02889681e+03
  6.64897674e+03  6.64897674e+03  6.64897674e+03  9.18395710e+03
  2.55330078e+04  7.62672870e+04]
E1 = -728.2882496164954  E_coul = 201.53790290788913
cycle= 5 E= -526.750346708606  delta_E= -2.05e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96836e-05
diis-c [-9.44882792e-11  1.29586739e-05 -1.77513583e-03 -1.27097135e-02
  3.44201599e-02  9.80051731e-01]
  HOMO = -0.583317508720953  LUMO = 0.921684869196849
  mo_energy =
[-1.18584075e+02 -1.23128636e+01 -9.56291902e+00 -9.56291902e+00
 -9.56291902e+00 -1.27053479e+00 -5.83317509e-01 -5.83317509e-01
 -5.83317509e-01  9.21684869e-01  1.01357612e+00  1.01357612e+00
  1.01357612e+00  7.29201505e+00  7.29201505e+00  7.29201505e+00
  9.58364579e+00  3.34700197e+01  3.34700197e+01  3.34700197e+01
  5.25935233e+01  1.29205399e+02  1.29205399e+02  1.29205399e+02
  1.99941766e+02  4.83640004e+02  4.83640004e+02  4.83640004e+02
  7.16551386e+02  1.33515504e+03  1.33515504e+03  1.33515504e+03
  2.78674369e+03  3.02889677e+03  3.02889677e+03  3.02889677e+03
  6.64897670e+03  6.64897670e+03  6.64897670e+03  9.18395707e+03
  2.55330078e+04  7.62672869e+04]
E1 = -728.2883340634364  E_coul = 201.53798735476616
cycle= 6 E= -526.75034670867  delta_E= -6.4e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2883340634364  E_coul = 201.53798735476616
  HOMO = -0.583317411819019  LUMO = 0.921685297446001
  mo_energy =
[-1.18584075e+02 -1.23128630e+01 -9.56291852e+00 -9.56291852e+00
 -9.56291852e+00 -1.27053427e+00 -5.83317412e-01 -5.83317412e-01
 -5.83317412e-01  9.21685297e-01  1.01357625e+00  1.01357625e+00
  1.01357625e+00  7.29201539e+00  7.29201539e+00  7.29201539e+00
  9.58364630e+00  3.34700202e+01  3.34700202e+01  3.34700202e+01
  5.25935239e+01  1.29205400e+02  1.29205400e+02  1.29205400e+02
  1.99941767e+02  4.83640005e+02  4.83640005e+02  4.83640005e+02
  7.16551387e+02  1.33515504e+03  1.33515504e+03  1.33515504e+03
  2.78674370e+03  3.02889677e+03  3.02889677e+03  3.02889677e+03
  6.64897670e+03  6.64897670e+03  6.64897670e+03  9.18395707e+03
  2.55330078e+04  7.62672869e+04]
E1 = -728.2883313790117  E_coul = 201.53798467034196
Extra cycle  E= -526.75034670867  delta_E= 5.68e-13  |g|= 3.9e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826682e+04 7.61749517e+03 3.61736369e+03 1.59726895e+03
 3.82663515e+02 1.17172840e+02 4.43718138e+01 2.08431066e+01
 6.90834428e+00 6.51484171e-01 2.81017349e+00 2.31832308e-01
 1.36278733e+03 6.64705099e+02 3.00770655e+02 3.13877315e+02
 6.17412819e+01 7.34374088e+00 2.02651597e+01 7.75756174e-01
 2.81718933e+00 2.22570304e-01]
E = -526.7503467086697
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:18 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6681655        1
[INPUT] 0    0    [1    /1   ]  7617.49516926        1
[INPUT] 0    0    [1    /1   ]  3617.36369457        1
[INPUT] 0    0    [1    /1   ]  1597.26895287        1
[INPUT] 0    0    [1    /1   ]  382.663514671        1
[INPUT] 0    0    [1    /1   ]  117.172839579        1
[INPUT] 0    0    [1    /1   ]  44.3718138345        1
[INPUT] 0    0    [1    /1   ]  20.8431066047        1
[INPUT] 0    0    [1    /1   ]  6.90834427648        1
[INPUT] 0    0    [1    /1   ]  0.651484171005       1
[INPUT] 0    0    [1    /1   ]  2.81017349298        1
[INPUT] 0    0    [1    /1   ]  0.231832308166       1
[INPUT] 1    0    [1    /1   ]  1362.78732881        1
[INPUT] 1    0    [1    /1   ]  664.70509886         1
[INPUT] 1    0    [1    /1   ]  300.770654732        1
[INPUT] 1    0    [1    /1   ]  313.87731502         1
[INPUT] 1    0    [1    /1   ]  61.7412818847        1
[INPUT] 1    0    [1    /1   ]  7.34374088214        1
[INPUT] 1    0    [1    /1   ]  20.2651597032        1
[INPUT] 1    0    [1    /1   ]  0.775756173652       1
[INPUT] 1    0    [1    /1   ]  2.8171893264         1
[INPUT] 1    0    [1    /1   ]  0.222570304485       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668165515835, 1.0]], [0, [7617.495169259306, 1.0]], [0, [3617.363694567243, 1.0]], [0, [1597.2689528670805, 1.0]], [0, [382.66351467127544, 1.0]], [0, [117.17283957939068, 1.0]], [0, [44.371813834503875, 1.0]], [0, [20.843106604650153, 1.0]], [0, [6.90834427648251, 1.0]], [0, [0.651484171004592, 1.0]], [0, [2.810173492979092, 1.0]], [0, [0.23183230816607034, 1.0]], [1, [1362.7873288136418, 1.0]], [1, [664.7050988604157, 1.0]], [1, [300.77065473167147, 1.0]], [1, [313.8773150198348, 1.0]], [1, [61.74128188474692, 1.0]], [1, [7.343740882144642, 1.0]], [1, [20.26515970316825, 1.0]], [1, [0.7757561736516226, 1.0]], [1, [2.8171893264046997, 1.0]], [1, [0.22257030448492132, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66816552]
bas 1, expnt(s) = [7617.49516926]
bas 2, expnt(s) = [3617.36369457]
bas 3, expnt(s) = [1597.26895287]
bas 4, expnt(s) = [382.66351467]
bas 5, expnt(s) = [117.17283958]
bas 6, expnt(s) = [44.37181383]
bas 7, expnt(s) = [20.8431066]
bas 8, expnt(s) = [6.90834428]
bas 9, expnt(s) = [0.65148417]
bas 10, expnt(s) = [2.81017349]
bas 11, expnt(s) = [0.23183231]
bas 12, expnt(s) = [1362.78732881]
bas 13, expnt(s) = [664.70509886]
bas 14, expnt(s) = [300.77065473]
bas 15, expnt(s) = [313.87731502]
bas 16, expnt(s) = [61.74128188]
bas 17, expnt(s) = [7.34374088]
bas 18, expnt(s) = [20.2651597]
bas 19, expnt(s) = [0.77575617]
bas 20, expnt(s) = [2.81718933]
bas 21, expnt(s) = [0.2225703]
CPU time:       374.83
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826682e+04 5.20026470e+03 7.61749517e+03 2.06003294e+03
 3.61736369e+03 1.17844456e+03 1.59726895e+03 6.38334859e+02
 3.82663515e+02 2.18588755e+02 1.17172840e+02 8.99777731e+01
 4.43718138e+01 4.34355586e+01 2.08431066e+01 2.46454562e+01
 6.90834428e+00 1.07657801e+01 6.51484171e-01 1.83207364e+00
 2.81017349e+00 5.48358871e+00 2.31832308e-01 8.44103097e-01
 1.36278733e+03 2.41556930e+04 6.64705099e+02 9.84624539e+03
 3.00770655e+02 3.65408562e+03 3.13877315e+02 3.85420050e+03
 6.17412819e+01 5.04898343e+02 7.34374088e+00 3.52680196e+01
 2.02651597e+01 1.25435923e+02 7.75756174e-01 2.12393364e+00
 2.81718933e+00 1.06476664e+01 2.22570304e-01 4.45983116e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99379960991523
cond(S) = 114786.0529521109
E1 = -729.5422173235105  E_coul = 203.1753005235082
init E= -526.366916800002
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555787224549954  LUMO = 0.941500060215561
  mo_energy =
[-1.18332613e+02 -1.22068631e+01 -9.44715984e+00 -9.44715984e+00
 -9.44715984e+00 -1.24020894e+00 -5.55787225e-01 -5.55787225e-01
 -5.55787225e-01  9.41500060e-01  1.03244725e+00  1.03244725e+00
  1.03244725e+00  7.36338736e+00  7.36338736e+00  7.36338736e+00
  9.65637597e+00  3.35912440e+01  3.35912440e+01  3.35912440e+01
  5.27195359e+01  1.29387404e+02  1.29387404e+02  1.29387404e+02
  2.00131054e+02  4.83890943e+02  4.83890943e+02  4.83890943e+02
  7.16839287e+02  1.33545924e+03  1.33545924e+03  1.33545924e+03
  2.78717748e+03  3.02926502e+03  3.02926502e+03  3.02926502e+03
  6.64945714e+03  6.64945714e+03  6.64945714e+03  9.18451116e+03
  2.55336565e+04  7.62680261e+04]
E1 = -727.8385678553913  E_coul = 201.089015136722
cycle= 1 E= -526.749552718669  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571814
diis-c [-0.32697158  1.        ]
  HOMO = -0.590990225209697  LUMO = 0.915205431558738
  mo_energy =
[-1.18642280e+02 -1.23453996e+01 -9.59675435e+00 -9.59675435e+00
 -9.59675435e+00 -1.27986018e+00 -5.90990225e-01 -5.90990225e-01
 -5.90990225e-01  9.15205432e-01  1.00788169e+00  1.00788169e+00
  1.00788169e+00  7.27185529e+00  7.27185529e+00  7.27185529e+00
  9.56170183e+00  3.34358187e+01  3.34358187e+01  3.34358187e+01
  5.25563368e+01  1.29157450e+02  1.29157450e+02  1.29157450e+02
  1.99891627e+02  4.83582499e+02  4.83582499e+02  4.83582499e+02
  7.16492069e+02  1.33509407e+03  1.33509407e+03  1.33509407e+03
  2.78668017e+03  3.02883395e+03  3.02883395e+03  3.02883395e+03
  6.64891254e+03  6.64891254e+03  6.64891254e+03  9.18389234e+03
  2.55329426e+04  7.62672216e+04]
E1 = -728.4172619834048  E_coul = 201.66697727276178
cycle= 2 E= -526.750284710643  delta_E= -0.000732  |g|= 0.038  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776602
diis-c [-0.00384454  0.07600854  0.92399146]
  HOMO = -0.581747829018349  LUMO = 0.922868277231305
  mo_energy =
[-1.18573536e+02 -1.23067690e+01 -9.55644135e+00 -9.55644135e+00
 -9.55644135e+00 -1.26879051e+00 -5.81747829e-01 -5.81747829e-01
 -5.81747829e-01  9.22868277e-01  1.01470662e+00  1.01470662e+00
  1.01470662e+00  7.29597994e+00  7.29597994e+00  7.29597994e+00
  9.58781597e+00  3.34765213e+01  3.34765213e+01  3.34765213e+01
  5.26004567e+01  1.29214218e+02  1.29214218e+02  1.29214218e+02
  1.99950925e+02  4.83650420e+02  4.83650420e+02  4.83650420e+02
  7.16562163e+02  1.33516609e+03  1.33516609e+03  1.33516609e+03
  2.78675541e+03  3.02890824e+03  3.02890824e+03  3.02890824e+03
  6.64898860e+03  6.64898860e+03  6.64898860e+03  9.18396919e+03
  2.55330201e+04  7.62672994e+04]
E1 = -728.2643579625909  E_coul = 201.51401340699252
cycle= 3 E= -526.750344555598  delta_E= -5.98e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141777
diis-c [-8.41538457e-07 -1.31064954e-03  1.49946947e-01  8.51363702e-01]
  HOMO = -0.583329116611091  LUMO = 0.921654164034233
  mo_energy =
[-1.18584095e+02 -1.23129118e+01 -9.56295121e+00 -9.56295121e+00
 -9.56295121e+00 -1.27057282e+00 -5.83329117e-01 -5.83329117e-01
 -5.83329117e-01  9.21654164e-01  1.01356445e+00  1.01356445e+00
  1.01356445e+00  7.29198692e+00  7.29198692e+00  7.29198692e+00
  9.58360112e+00  3.34699886e+01  3.34699886e+01  3.34699886e+01
  5.25934847e+01  1.29205371e+02  1.29205371e+02  1.29205371e+02
  1.99941738e+02  4.83639983e+02  4.83639983e+02  4.83639983e+02
  7.16551374e+02  1.33515503e+03  1.33515503e+03  1.33515503e+03
  2.78674371e+03  3.02889677e+03  3.02889677e+03  3.02889677e+03
  6.64897672e+03  6.64897672e+03  6.64897672e+03  9.18395709e+03
  2.55330078e+04  7.62672870e+04]
E1 = -728.2884963041733  E_coul = 201.53814959761291
cycle= 4 E= -526.75034670656  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116185
diis-c [-5.10688050e-09  8.55137313e-05 -1.21675603e-02 -7.29355236e-02
  1.08501757e+00]
  HOMO = -0.583309647712415  LUMO = 0.921688680646024
  mo_energy =
[-1.18584044e+02 -1.23128399e+01 -9.56289343e+00 -9.56289343e+00
 -9.56289343e+00 -1.27052854e+00 -5.83309648e-01 -5.83309648e-01
 -5.83309648e-01  9.21688681e-01  1.01358134e+00  1.01358134e+00
  1.01358134e+00  7.29203248e+00  7.29203248e+00  7.29203248e+00
  9.58366286e+00  3.34700445e+01  3.34700445e+01  3.34700445e+01
  5.25935487e+01  1.29205429e+02  1.29205429e+02  1.29205429e+02
  1.99941796e+02  4.83640035e+02  4.83640035e+02  4.83640035e+02
  7.16551418e+02  1.33515507e+03  1.33515507e+03  1.33515507e+03
  2.78674373e+03  3.02889681e+03  3.02889681e+03  3.02889681e+03
  6.64897674e+03  6.64897674e+03  6.64897674e+03  9.18395710e+03
  2.55330078e+04  7.62672870e+04]
E1 = -728.2882496164954  E_coul = 201.53790290788913
cycle= 5 E= -526.750346708606  delta_E= -2.05e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96836e-05
diis-c [-9.44882792e-11  1.29586739e-05 -1.77513583e-03 -1.27097135e-02
  3.44201599e-02  9.80051731e-01]
  HOMO = -0.583317508720953  LUMO = 0.921684869196849
  mo_energy =
[-1.18584075e+02 -1.23128636e+01 -9.56291902e+00 -9.56291902e+00
 -9.56291902e+00 -1.27053479e+00 -5.83317509e-01 -5.83317509e-01
 -5.83317509e-01  9.21684869e-01  1.01357612e+00  1.01357612e+00
  1.01357612e+00  7.29201505e+00  7.29201505e+00  7.29201505e+00
  9.58364579e+00  3.34700197e+01  3.34700197e+01  3.34700197e+01
  5.25935233e+01  1.29205399e+02  1.29205399e+02  1.29205399e+02
  1.99941766e+02  4.83640004e+02  4.83640004e+02  4.83640004e+02
  7.16551386e+02  1.33515504e+03  1.33515504e+03  1.33515504e+03
  2.78674369e+03  3.02889677e+03  3.02889677e+03  3.02889677e+03
  6.64897670e+03  6.64897670e+03  6.64897670e+03  9.18395707e+03
  2.55330078e+04  7.62672869e+04]
E1 = -728.2883340634364  E_coul = 201.53798735476616
cycle= 6 E= -526.75034670867  delta_E= -6.4e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2883340634364  E_coul = 201.53798735476616
  HOMO = -0.583317411819019  LUMO = 0.921685297446001
  mo_energy =
[-1.18584075e+02 -1.23128630e+01 -9.56291852e+00 -9.56291852e+00
 -9.56291852e+00 -1.27053427e+00 -5.83317412e-01 -5.83317412e-01
 -5.83317412e-01  9.21685297e-01  1.01357625e+00  1.01357625e+00
  1.01357625e+00  7.29201539e+00  7.29201539e+00  7.29201539e+00
  9.58364630e+00  3.34700202e+01  3.34700202e+01  3.34700202e+01
  5.25935239e+01  1.29205400e+02  1.29205400e+02  1.29205400e+02
  1.99941767e+02  4.83640005e+02  4.83640005e+02  4.83640005e+02
  7.16551387e+02  1.33515504e+03  1.33515504e+03  1.33515504e+03
  2.78674370e+03  3.02889677e+03  3.02889677e+03  3.02889677e+03
  6.64897670e+03  6.64897670e+03  6.64897670e+03  9.18395707e+03
  2.55330078e+04  7.62672869e+04]
E1 = -728.2883313790117  E_coul = 201.53798467034196
Extra cycle  E= -526.75034670867  delta_E= 5.68e-13  |g|= 3.9e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114786.0529521109
E1 = -728.2883313790117  E_coul = 201.53798467034196
init E= -526.75034670867
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583317478938156  LUMO = 0.921685316237293
  mo_energy =
[-1.18584075e+02 -1.23128632e+01 -9.56291874e+00 -9.56291874e+00
 -9.56291874e+00 -1.27053426e+00 -5.83317479e-01 -5.83317479e-01
 -5.83317479e-01  9.21685316e-01  1.01357621e+00  1.01357621e+00
  1.01357621e+00  7.29201525e+00  7.29201525e+00  7.29201525e+00
  9.58364619e+00  3.34700200e+01  3.34700200e+01  3.34700200e+01
  5.25935237e+01  1.29205400e+02  1.29205400e+02  1.29205400e+02
  1.99941766e+02  4.83640004e+02  4.83640004e+02  4.83640004e+02
  7.16551386e+02  1.33515504e+03  1.33515504e+03  1.33515504e+03
  2.78674369e+03  3.02889677e+03  3.02889677e+03  3.02889677e+03
  6.64897670e+03  6.64897670e+03  6.64897670e+03  9.18395707e+03
  2.55330078e+04  7.62672869e+04]
E1 = -728.28833198946  E_coul = 201.53798528079
cycle= 1 E= -526.75034670867  delta_E= -2.27e-13  |g|= 8.87e-08  |ddm|= 6.13e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.28833198946  E_coul = 201.53798528079
  HOMO = -0.583317470406518  LUMO = 0.921685337976385
  mo_energy =
[-1.18584075e+02 -1.23128631e+01 -9.56291870e+00 -9.56291870e+00
 -9.56291870e+00 -1.27053423e+00 -5.83317470e-01 -5.83317470e-01
 -5.83317470e-01  9.21685338e-01  1.01357622e+00  1.01357622e+00
  1.01357622e+00  7.29201528e+00  7.29201528e+00  7.29201528e+00
  9.58364623e+00  3.34700200e+01  3.34700200e+01  3.34700200e+01
  5.25935237e+01  1.29205400e+02  1.29205400e+02  1.29205400e+02
  1.99941767e+02  4.83640004e+02  4.83640004e+02  4.83640004e+02
  7.16551387e+02  1.33515504e+03  1.33515504e+03  1.33515504e+03
  2.78674369e+03  3.02889677e+03  3.02889677e+03  3.02889677e+03
  6.64897670e+03  6.64897670e+03  6.64897670e+03  9.18395707e+03
  2.55330078e+04  7.62672869e+04]
E1 = -728.2883317874841  E_coul = 201.53798507881453
Extra cycle  E= -526.75034670867  delta_E= 2.27e-13  |g|= 1.9e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.45 sec
exp = [2.61826682e+04 7.61749517e+03 3.61736369e+03 1.59726895e+03
 3.82663515e+02 1.17172840e+02 4.43718138e+01 2.08431066e+01
 6.90834428e+00 6.51484171e-01 2.81017349e+00 2.31832308e-01
 1.36278733e+03 6.64705099e+02 3.00770655e+02 3.13877315e+02
 6.17412819e+01 7.34374088e+00 2.02651597e+01 7.75756174e-01
 2.81718933e+00 2.22570304e-01]
grad_E = [-1.56558659e-06  3.86664993e-06 -1.19491415e-06  8.96437024e-05
 -4.18930856e-04 -2.47538530e-04 -1.22499984e-04  2.66212378e-04
  1.53455428e-04  3.76977305e-05 -3.34216919e-04  2.28257337e-04
 -5.15973846e-07  4.90142007e-06  2.30376311e-05  1.98494826e-05
  2.67144745e-06 -1.52665673e-05 -4.27487799e-05  1.94831542e-04
  1.08246768e-04 -7.01848638e-04]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:23 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6681782        1
[INPUT] 0    0    [1    /1   ]  7617.49513777        1
[INPUT] 0    0    [1    /1   ]  3617.36370413        1
[INPUT] 0    0    [1    /1   ]  1597.26821891        1
[INPUT] 0    0    [1    /1   ]  382.667207678        1
[INPUT] 0    0    [1    /1   ]  117.173055265        1
[INPUT] 0    0    [1    /1   ]  44.3758158512        1
[INPUT] 0    0    [1    /1   ]  20.8382847307        1
[INPUT] 0    0    [1    /1   ]  6.90971778533        1
[INPUT] 0    0    [1    /1   ]  0.65075978921        1
[INPUT] 0    0    [1    /1   ]  2.80968238134        1
[INPUT] 0    0    [1    /1   ]  0.231564419051       1
[INPUT] 1    0    [1    /1   ]  1362.78733294        1
[INPUT] 1    0    [1    /1   ]  664.705058688        1
[INPUT] 1    0    [1    /1   ]  300.770465155        1
[INPUT] 1    0    [1    /1   ]  313.877151682        1
[INPUT] 1    0    [1    /1   ]  61.7416156024        1
[INPUT] 1    0    [1    /1   ]  7.34635171146        1
[INPUT] 1    0    [1    /1   ]  20.2631572439        1
[INPUT] 1    0    [1    /1   ]  0.776087687098       1
[INPUT] 1    0    [1    /1   ]  2.8207781068         1
[INPUT] 1    0    [1    /1   ]  0.222594201242       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668178188498, 1.0]], [0, [7617.495137771058, 1.0]], [0, [3617.3637041339884, 1.0]], [0, [1597.2682189107807, 1.0]], [0, [382.6672076784694, 1.0]], [0, [117.17305526525065, 1.0]], [0, [44.375815851208145, 1.0]], [0, [20.838284730718012, 1.0]], [0, [6.909717785333647, 1.0]], [0, [0.6507597892103776, 1.0]], [0, [2.8096823813362706, 1.0]], [0, [0.23156441905060265, 1.0]], [1, [1362.7873329388547, 1.0]], [1, [664.7050586877176, 1.0]], [1, [300.7704651546544, 1.0]], [1, [313.8771516817312, 1.0]], [1, [61.74161560235968, 1.0]], [1, [7.346351711460375, 1.0]], [1, [20.26315724387411, 1.0]], [1, [0.7760876870982535, 1.0]], [1, [2.820778106798718, 1.0]], [1, [0.22259420124245352, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66817819]
bas 1, expnt(s) = [7617.49513777]
bas 2, expnt(s) = [3617.36370413]
bas 3, expnt(s) = [1597.26821891]
bas 4, expnt(s) = [382.66720768]
bas 5, expnt(s) = [117.17305527]
bas 6, expnt(s) = [44.37581585]
bas 7, expnt(s) = [20.83828473]
bas 8, expnt(s) = [6.90971779]
bas 9, expnt(s) = [0.65075979]
bas 10, expnt(s) = [2.80968238]
bas 11, expnt(s) = [0.23156442]
bas 12, expnt(s) = [1362.78733294]
bas 13, expnt(s) = [664.70505869]
bas 14, expnt(s) = [300.77046515]
bas 15, expnt(s) = [313.87715168]
bas 16, expnt(s) = [61.7416156]
bas 17, expnt(s) = [7.34635171]
bas 18, expnt(s) = [20.26315724]
bas 19, expnt(s) = [0.77608769]
bas 20, expnt(s) = [2.82077811]
bas 21, expnt(s) = [0.2225942]
CPU time:       380.69
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826682e+04 5.20026470e+03 7.61749514e+03 2.06003293e+03
 3.61736370e+03 1.17844456e+03 1.59726822e+03 6.38334639e+02
 3.82667208e+02 2.18590337e+02 1.17173055e+02 8.99778973e+01
 4.43758159e+01 4.34384967e+01 2.08382847e+01 2.46411799e+01
 6.90971779e+00 1.07673854e+01 6.50759789e-01 1.83054562e+00
 2.80968238e+00 5.48286996e+00 2.31564419e-01 8.43371451e-01
 1.36278733e+03 2.41556931e+04 6.64705059e+02 9.84624465e+03
 3.00770465e+02 3.65408274e+03 3.13877152e+02 3.85419800e+03
 6.17416156e+01 5.04901754e+02 7.34635171e+00 3.52836933e+01
 2.02631572e+01 1.25420430e+02 7.76087687e-01 2.12506826e+00
 2.82077811e+00 1.06646240e+01 2.22594201e-01 4.46042972e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99379314406207
cond(S) = 114783.74956301018
E1 = -729.5422258992913  E_coul = 203.17530693470587
init E= -526.366918964585
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555787785867424  LUMO = 0.939744274476949
  mo_energy =
[-1.18332611e+02 -1.22068612e+01 -9.44715949e+00 -9.44715949e+00
 -9.44715949e+00 -1.24021007e+00 -5.55787786e-01 -5.55787786e-01
 -5.55787786e-01  9.39744274e-01  1.03284767e+00  1.03284767e+00
  1.03284767e+00  7.37160541e+00  7.37160541e+00  7.37160541e+00
  9.65138622e+00  3.36101290e+01  3.36101290e+01  3.36101290e+01
  5.27128740e+01  1.29404314e+02  1.29404314e+02  1.29404314e+02
  2.00123289e+02  4.83903202e+02  4.83903202e+02  4.83903202e+02
  7.16837939e+02  1.33546947e+03  1.33546947e+03  1.33546947e+03
  2.78718498e+03  3.02927391e+03  3.02927391e+03  3.02927391e+03
  6.64946480e+03  6.64946480e+03  6.64946480e+03  9.18452119e+03
  2.55336663e+04  7.62680352e+04]
E1 = -727.838021331725  E_coul = 201.08846692371915
cycle= 1 E= -526.749554408006  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571862
diis-c [-0.32702601  1.        ]
  HOMO = -0.591013566516592  LUMO = 0.913471634486466
  mo_energy =
[-1.18642314e+02 -1.23454325e+01 -9.59679201e+00 -9.59679201e+00
 -9.59679201e+00 -1.27988518e+00 -5.91013567e-01 -5.91013567e-01
 -5.91013567e-01  9.13471634e-01  1.00825119e+00  1.00825119e+00
  1.00825119e+00  7.27998379e+00  7.27998379e+00  7.27998379e+00
  9.55668663e+00  3.34546659e+01  3.34546659e+01  3.34546659e+01
  5.25496415e+01  1.29174331e+02  1.29174331e+02  1.29174331e+02
  1.99883827e+02  4.83594724e+02  4.83594724e+02  4.83594724e+02
  7.16490683e+02  1.33510426e+03  1.33510426e+03  1.33510426e+03
  2.78668762e+03  3.02884280e+03  3.02884280e+03  3.02884280e+03
  6.64892016e+03  6.64892016e+03  6.64892016e+03  9.18390233e+03
  2.55329524e+04  7.62672307e+04]
E1 = -728.4168540357198  E_coul = 201.6665672948233
cycle= 2 E= -526.750286740897  delta_E= -0.000732  |g|= 0.038  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776796
diis-c [-0.00384565  0.0760334   0.9239666 ]
  HOMO = -0.581768578148608  LUMO = 0.921126125572918
  mo_energy =
[-1.18573560e+02 -1.23067931e+01 -9.55647024e+00 -9.55647024e+00
 -9.55647024e+00 -1.26881244e+00 -5.81768578e-01 -5.81768578e-01
 -5.81768578e-01  9.21126126e-01  1.01508201e+00  1.01508201e+00
  1.01508201e+00  7.30412837e+00  7.30412837e+00  7.30412837e+00
  9.58280651e+00  3.34953782e+01  3.34953782e+01  3.34953782e+01
  5.25937703e+01  1.29231108e+02  1.29231108e+02  1.29231108e+02
  1.99943135e+02  4.83662656e+02  4.83662656e+02  4.83662656e+02
  7.16560788e+02  1.33517629e+03  1.33517629e+03  1.33517629e+03
  2.78676288e+03  3.02891710e+03  3.02891710e+03  3.02891710e+03
  6.64899624e+03  6.64899624e+03  6.64899624e+03  9.18397919e+03
  2.55330299e+04  7.62673085e+04]
E1 = -728.263919586873  E_coul = 201.51357297374253
cycle= 3 E= -526.750346613131  delta_E= -5.99e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141795
diis-c [-8.42132579e-07 -1.31073158e-03  1.49930103e-01  8.51380628e-01]
  HOMO = -0.583350081149089  LUMO = 0.919913563869034
  mo_energy =
[-1.18584119e+02 -1.23129360e+01 -9.56298033e+00 -9.56298033e+00
 -9.56298033e+00 -1.27059492e+00 -5.83350081e-01 -5.83350081e-01
 -5.83350081e-01  9.19913564e-01  1.01393901e+00  1.01393901e+00
  1.01393901e+00  7.30013282e+00  7.30013282e+00  7.30013282e+00
  9.57859165e+00  3.34888451e+01  3.34888451e+01  3.34888451e+01
  5.25867982e+01  1.29222261e+02  1.29222261e+02  1.29222261e+02
  1.99933948e+02  4.83652219e+02  4.83652219e+02  4.83652219e+02
  7.16549999e+02  1.33516522e+03  1.33516522e+03  1.33516522e+03
  2.78675117e+03  3.02890563e+03  3.02890563e+03  3.02890563e+03
  6.64898436e+03  6.64898436e+03  6.64898436e+03  9.18396709e+03
  2.55330176e+04  7.62672960e+04]
E1 = -728.2880581742972  E_coul = 201.53770941002747
cycle= 4 E= -526.75034876427  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116365
diis-c [-5.10726853e-09  8.56327990e-05 -1.21822812e-02 -7.30437518e-02
  1.08514040e+00]
  HOMO = -0.583330659264936  LUMO = 0.919948017709621
  mo_energy =
[-1.18584067e+02 -1.23128643e+01 -9.56292268e+00 -9.56292268e+00
 -9.56292268e+00 -1.27055068e+00 -5.83330659e-01 -5.83330659e-01
 -5.83330659e-01  9.19948018e-01  1.01395588e+00  1.01395588e+00
  1.01395588e+00  7.30017831e+00  7.30017831e+00  7.30017831e+00
  9.57865332e+00  3.34889009e+01  3.34889009e+01  3.34889009e+01
  5.25868621e+01  1.29222318e+02  1.29222318e+02  1.29222318e+02
  1.99934006e+02  4.83652271e+02  4.83652271e+02  4.83652271e+02
  7.16550043e+02  1.33516527e+03  1.33516527e+03  1.33516527e+03
  2.78675120e+03  3.02890566e+03  3.02890566e+03  3.02890566e+03
  6.64898437e+03  6.64898437e+03  6.64898437e+03  9.18396710e+03
  2.55330176e+04  7.62672960e+04]
E1 = -728.2878117426819  E_coul = 201.53746297636366
cycle= 5 E= -526.750348766318  delta_E= -2.05e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96786e-05
diis-c [-9.46066743e-11  1.29511693e-05 -1.77395658e-03 -1.27041270e-02
  3.44141163e-02  9.80051016e-01]
  HOMO = -0.583338524071332  LUMO = 0.91994420959763
  mo_energy =
[-1.18584099e+02 -1.23128879e+01 -9.56294827e+00 -9.56294827e+00
 -9.56294827e+00 -1.27055693e+00 -5.83338524e-01 -5.83338524e-01
 -5.83338524e-01  9.19944210e-01  1.01395065e+00  1.01395065e+00
  1.01395065e+00  7.30016087e+00  7.30016087e+00  7.30016087e+00
  9.57863625e+00  3.34888761e+01  3.34888761e+01  3.34888761e+01
  5.25868367e+01  1.29222289e+02  1.29222289e+02  1.29222289e+02
  1.99933976e+02  4.83652239e+02  4.83652239e+02  4.83652239e+02
  7.16550011e+02  1.33516523e+03  1.33516523e+03  1.33516523e+03
  2.78675116e+03  3.02890563e+03  3.02890563e+03  3.02890563e+03
  6.64898434e+03  6.64898434e+03  6.64898434e+03  9.18396706e+03
  2.55330176e+04  7.62672960e+04]
E1 = -728.2878961865229  E_coul = 201.53754742014203
cycle= 6 E= -526.750348766381  delta_E= -6.26e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2878961865229  E_coul = 201.53754742014203
  HOMO = -0.583338426698878  LUMO = 0.919944637994968
  mo_energy =
[-1.18584098e+02 -1.23128874e+01 -9.56294777e+00 -9.56294777e+00
 -9.56294777e+00 -1.27055640e+00 -5.83338427e-01 -5.83338427e-01
 -5.83338427e-01  9.19944638e-01  1.01395078e+00  1.01395078e+00
  1.01395078e+00  7.30016121e+00  7.30016121e+00  7.30016121e+00
  9.57863676e+00  3.34888766e+01  3.34888766e+01  3.34888766e+01
  5.25868373e+01  1.29222290e+02  1.29222290e+02  1.29222290e+02
  1.99933977e+02  4.83652240e+02  4.83652240e+02  4.83652240e+02
  7.16550012e+02  1.33516524e+03  1.33516524e+03  1.33516524e+03
  2.78675116e+03  3.02890563e+03  3.02890563e+03  3.02890563e+03
  6.64898434e+03  6.64898434e+03  6.64898434e+03  9.18396707e+03
  2.55330176e+04  7.62672960e+04]
E1 = -728.2878934883885  E_coul = 201.53754472200777
Extra cycle  E= -526.750348766381  delta_E= 1.14e-13  |g|= 3.9e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826682e+04 7.61749514e+03 3.61736370e+03 1.59726822e+03
 3.82667208e+02 1.17173055e+02 4.43758159e+01 2.08382847e+01
 6.90971779e+00 6.50759789e-01 2.80968238e+00 2.31564419e-01
 1.36278733e+03 6.64705059e+02 3.00770465e+02 3.13877152e+02
 6.17416156e+01 7.34635171e+00 2.02631572e+01 7.76087687e-01
 2.82077811e+00 2.22594201e-01]
E = -526.7503487663807
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:23 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6681782        1
[INPUT] 0    0    [1    /1   ]  7617.49513777        1
[INPUT] 0    0    [1    /1   ]  3617.36370413        1
[INPUT] 0    0    [1    /1   ]  1597.26821891        1
[INPUT] 0    0    [1    /1   ]  382.667207678        1
[INPUT] 0    0    [1    /1   ]  117.173055265        1
[INPUT] 0    0    [1    /1   ]  44.3758158512        1
[INPUT] 0    0    [1    /1   ]  20.8382847307        1
[INPUT] 0    0    [1    /1   ]  6.90971778533        1
[INPUT] 0    0    [1    /1   ]  0.65075978921        1
[INPUT] 0    0    [1    /1   ]  2.80968238134        1
[INPUT] 0    0    [1    /1   ]  0.231564419051       1
[INPUT] 1    0    [1    /1   ]  1362.78733294        1
[INPUT] 1    0    [1    /1   ]  664.705058688        1
[INPUT] 1    0    [1    /1   ]  300.770465155        1
[INPUT] 1    0    [1    /1   ]  313.877151682        1
[INPUT] 1    0    [1    /1   ]  61.7416156024        1
[INPUT] 1    0    [1    /1   ]  7.34635171146        1
[INPUT] 1    0    [1    /1   ]  20.2631572439        1
[INPUT] 1    0    [1    /1   ]  0.776087687098       1
[INPUT] 1    0    [1    /1   ]  2.8207781068         1
[INPUT] 1    0    [1    /1   ]  0.222594201242       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668178188498, 1.0]], [0, [7617.495137771058, 1.0]], [0, [3617.3637041339884, 1.0]], [0, [1597.2682189107807, 1.0]], [0, [382.6672076784694, 1.0]], [0, [117.17305526525065, 1.0]], [0, [44.375815851208145, 1.0]], [0, [20.838284730718012, 1.0]], [0, [6.909717785333647, 1.0]], [0, [0.6507597892103776, 1.0]], [0, [2.8096823813362706, 1.0]], [0, [0.23156441905060265, 1.0]], [1, [1362.7873329388547, 1.0]], [1, [664.7050586877176, 1.0]], [1, [300.7704651546544, 1.0]], [1, [313.8771516817312, 1.0]], [1, [61.74161560235968, 1.0]], [1, [7.346351711460375, 1.0]], [1, [20.26315724387411, 1.0]], [1, [0.7760876870982535, 1.0]], [1, [2.820778106798718, 1.0]], [1, [0.22259420124245352, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66817819]
bas 1, expnt(s) = [7617.49513777]
bas 2, expnt(s) = [3617.36370413]
bas 3, expnt(s) = [1597.26821891]
bas 4, expnt(s) = [382.66720768]
bas 5, expnt(s) = [117.17305527]
bas 6, expnt(s) = [44.37581585]
bas 7, expnt(s) = [20.83828473]
bas 8, expnt(s) = [6.90971779]
bas 9, expnt(s) = [0.65075979]
bas 10, expnt(s) = [2.80968238]
bas 11, expnt(s) = [0.23156442]
bas 12, expnt(s) = [1362.78733294]
bas 13, expnt(s) = [664.70505869]
bas 14, expnt(s) = [300.77046515]
bas 15, expnt(s) = [313.87715168]
bas 16, expnt(s) = [61.7416156]
bas 17, expnt(s) = [7.34635171]
bas 18, expnt(s) = [20.26315724]
bas 19, expnt(s) = [0.77608769]
bas 20, expnt(s) = [2.82077811]
bas 21, expnt(s) = [0.2225942]
CPU time:       381.17
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826682e+04 5.20026470e+03 7.61749514e+03 2.06003293e+03
 3.61736370e+03 1.17844456e+03 1.59726822e+03 6.38334639e+02
 3.82667208e+02 2.18590337e+02 1.17173055e+02 8.99778973e+01
 4.43758159e+01 4.34384967e+01 2.08382847e+01 2.46411799e+01
 6.90971779e+00 1.07673854e+01 6.50759789e-01 1.83054562e+00
 2.80968238e+00 5.48286996e+00 2.31564419e-01 8.43371451e-01
 1.36278733e+03 2.41556931e+04 6.64705059e+02 9.84624465e+03
 3.00770465e+02 3.65408274e+03 3.13877152e+02 3.85419800e+03
 6.17416156e+01 5.04901754e+02 7.34635171e+00 3.52836933e+01
 2.02631572e+01 1.25420430e+02 7.76087687e-01 2.12506826e+00
 2.82077811e+00 1.06646240e+01 2.22594201e-01 4.46042972e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99379314406207
cond(S) = 114783.74956301018
E1 = -729.5422258992913  E_coul = 203.17530693470587
init E= -526.366918964585
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555787785867424  LUMO = 0.939744274476949
  mo_energy =
[-1.18332611e+02 -1.22068612e+01 -9.44715949e+00 -9.44715949e+00
 -9.44715949e+00 -1.24021007e+00 -5.55787786e-01 -5.55787786e-01
 -5.55787786e-01  9.39744274e-01  1.03284767e+00  1.03284767e+00
  1.03284767e+00  7.37160541e+00  7.37160541e+00  7.37160541e+00
  9.65138622e+00  3.36101290e+01  3.36101290e+01  3.36101290e+01
  5.27128740e+01  1.29404314e+02  1.29404314e+02  1.29404314e+02
  2.00123289e+02  4.83903202e+02  4.83903202e+02  4.83903202e+02
  7.16837939e+02  1.33546947e+03  1.33546947e+03  1.33546947e+03
  2.78718498e+03  3.02927391e+03  3.02927391e+03  3.02927391e+03
  6.64946480e+03  6.64946480e+03  6.64946480e+03  9.18452119e+03
  2.55336663e+04  7.62680352e+04]
E1 = -727.838021331725  E_coul = 201.08846692371915
cycle= 1 E= -526.749554408006  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.571862
diis-c [-0.32702601  1.        ]
  HOMO = -0.591013566516592  LUMO = 0.913471634486466
  mo_energy =
[-1.18642314e+02 -1.23454325e+01 -9.59679201e+00 -9.59679201e+00
 -9.59679201e+00 -1.27988518e+00 -5.91013567e-01 -5.91013567e-01
 -5.91013567e-01  9.13471634e-01  1.00825119e+00  1.00825119e+00
  1.00825119e+00  7.27998379e+00  7.27998379e+00  7.27998379e+00
  9.55668663e+00  3.34546659e+01  3.34546659e+01  3.34546659e+01
  5.25496415e+01  1.29174331e+02  1.29174331e+02  1.29174331e+02
  1.99883827e+02  4.83594724e+02  4.83594724e+02  4.83594724e+02
  7.16490683e+02  1.33510426e+03  1.33510426e+03  1.33510426e+03
  2.78668762e+03  3.02884280e+03  3.02884280e+03  3.02884280e+03
  6.64892016e+03  6.64892016e+03  6.64892016e+03  9.18390233e+03
  2.55329524e+04  7.62672307e+04]
E1 = -728.4168540357198  E_coul = 201.6665672948233
cycle= 2 E= -526.750286740897  delta_E= -0.000732  |g|= 0.038  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776796
diis-c [-0.00384565  0.0760334   0.9239666 ]
  HOMO = -0.581768578148608  LUMO = 0.921126125572918
  mo_energy =
[-1.18573560e+02 -1.23067931e+01 -9.55647024e+00 -9.55647024e+00
 -9.55647024e+00 -1.26881244e+00 -5.81768578e-01 -5.81768578e-01
 -5.81768578e-01  9.21126126e-01  1.01508201e+00  1.01508201e+00
  1.01508201e+00  7.30412837e+00  7.30412837e+00  7.30412837e+00
  9.58280651e+00  3.34953782e+01  3.34953782e+01  3.34953782e+01
  5.25937703e+01  1.29231108e+02  1.29231108e+02  1.29231108e+02
  1.99943135e+02  4.83662656e+02  4.83662656e+02  4.83662656e+02
  7.16560788e+02  1.33517629e+03  1.33517629e+03  1.33517629e+03
  2.78676288e+03  3.02891710e+03  3.02891710e+03  3.02891710e+03
  6.64899624e+03  6.64899624e+03  6.64899624e+03  9.18397919e+03
  2.55330299e+04  7.62673085e+04]
E1 = -728.263919586873  E_coul = 201.51357297374253
cycle= 3 E= -526.750346613131  delta_E= -5.99e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141795
diis-c [-8.42132579e-07 -1.31073158e-03  1.49930103e-01  8.51380628e-01]
  HOMO = -0.583350081149089  LUMO = 0.919913563869034
  mo_energy =
[-1.18584119e+02 -1.23129360e+01 -9.56298033e+00 -9.56298033e+00
 -9.56298033e+00 -1.27059492e+00 -5.83350081e-01 -5.83350081e-01
 -5.83350081e-01  9.19913564e-01  1.01393901e+00  1.01393901e+00
  1.01393901e+00  7.30013282e+00  7.30013282e+00  7.30013282e+00
  9.57859165e+00  3.34888451e+01  3.34888451e+01  3.34888451e+01
  5.25867982e+01  1.29222261e+02  1.29222261e+02  1.29222261e+02
  1.99933948e+02  4.83652219e+02  4.83652219e+02  4.83652219e+02
  7.16549999e+02  1.33516522e+03  1.33516522e+03  1.33516522e+03
  2.78675117e+03  3.02890563e+03  3.02890563e+03  3.02890563e+03
  6.64898436e+03  6.64898436e+03  6.64898436e+03  9.18396709e+03
  2.55330176e+04  7.62672960e+04]
E1 = -728.2880581742972  E_coul = 201.53770941002747
cycle= 4 E= -526.75034876427  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116365
diis-c [-5.10726853e-09  8.56327990e-05 -1.21822812e-02 -7.30437518e-02
  1.08514040e+00]
  HOMO = -0.583330659264936  LUMO = 0.919948017709621
  mo_energy =
[-1.18584067e+02 -1.23128643e+01 -9.56292268e+00 -9.56292268e+00
 -9.56292268e+00 -1.27055068e+00 -5.83330659e-01 -5.83330659e-01
 -5.83330659e-01  9.19948018e-01  1.01395588e+00  1.01395588e+00
  1.01395588e+00  7.30017831e+00  7.30017831e+00  7.30017831e+00
  9.57865332e+00  3.34889009e+01  3.34889009e+01  3.34889009e+01
  5.25868621e+01  1.29222318e+02  1.29222318e+02  1.29222318e+02
  1.99934006e+02  4.83652271e+02  4.83652271e+02  4.83652271e+02
  7.16550043e+02  1.33516527e+03  1.33516527e+03  1.33516527e+03
  2.78675120e+03  3.02890566e+03  3.02890566e+03  3.02890566e+03
  6.64898437e+03  6.64898437e+03  6.64898437e+03  9.18396710e+03
  2.55330176e+04  7.62672960e+04]
E1 = -728.2878117426819  E_coul = 201.53746297636366
cycle= 5 E= -526.750348766318  delta_E= -2.05e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96786e-05
diis-c [-9.46066743e-11  1.29511693e-05 -1.77395658e-03 -1.27041270e-02
  3.44141163e-02  9.80051016e-01]
  HOMO = -0.583338524071332  LUMO = 0.91994420959763
  mo_energy =
[-1.18584099e+02 -1.23128879e+01 -9.56294827e+00 -9.56294827e+00
 -9.56294827e+00 -1.27055693e+00 -5.83338524e-01 -5.83338524e-01
 -5.83338524e-01  9.19944210e-01  1.01395065e+00  1.01395065e+00
  1.01395065e+00  7.30016087e+00  7.30016087e+00  7.30016087e+00
  9.57863625e+00  3.34888761e+01  3.34888761e+01  3.34888761e+01
  5.25868367e+01  1.29222289e+02  1.29222289e+02  1.29222289e+02
  1.99933976e+02  4.83652239e+02  4.83652239e+02  4.83652239e+02
  7.16550011e+02  1.33516523e+03  1.33516523e+03  1.33516523e+03
  2.78675116e+03  3.02890563e+03  3.02890563e+03  3.02890563e+03
  6.64898434e+03  6.64898434e+03  6.64898434e+03  9.18396706e+03
  2.55330176e+04  7.62672960e+04]
E1 = -728.2878961865229  E_coul = 201.53754742014203
cycle= 6 E= -526.750348766381  delta_E= -6.26e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2878961865229  E_coul = 201.53754742014203
  HOMO = -0.583338426698878  LUMO = 0.919944637994968
  mo_energy =
[-1.18584098e+02 -1.23128874e+01 -9.56294777e+00 -9.56294777e+00
 -9.56294777e+00 -1.27055640e+00 -5.83338427e-01 -5.83338427e-01
 -5.83338427e-01  9.19944638e-01  1.01395078e+00  1.01395078e+00
  1.01395078e+00  7.30016121e+00  7.30016121e+00  7.30016121e+00
  9.57863676e+00  3.34888766e+01  3.34888766e+01  3.34888766e+01
  5.25868373e+01  1.29222290e+02  1.29222290e+02  1.29222290e+02
  1.99933977e+02  4.83652240e+02  4.83652240e+02  4.83652240e+02
  7.16550012e+02  1.33516524e+03  1.33516524e+03  1.33516524e+03
  2.78675116e+03  3.02890563e+03  3.02890563e+03  3.02890563e+03
  6.64898434e+03  6.64898434e+03  6.64898434e+03  9.18396707e+03
  2.55330176e+04  7.62672960e+04]
E1 = -728.2878934883885  E_coul = 201.53754472200777
Extra cycle  E= -526.750348766381  delta_E= 1.14e-13  |g|= 3.9e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114783.74956301018
E1 = -728.2878934883885  E_coul = 201.53754472200777
init E= -526.750348766381
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583338494151003  LUMO = 0.919944656580588
  mo_energy =
[-1.18584099e+02 -1.23128876e+01 -9.56294799e+00 -9.56294799e+00
 -9.56294799e+00 -1.27055640e+00 -5.83338494e-01 -5.83338494e-01
 -5.83338494e-01  9.19944657e-01  1.01395075e+00  1.01395075e+00
  1.01395075e+00  7.30016107e+00  7.30016107e+00  7.30016107e+00
  9.57863665e+00  3.34888764e+01  3.34888764e+01  3.34888764e+01
  5.25868371e+01  1.29222290e+02  1.29222290e+02  1.29222290e+02
  1.99933977e+02  4.83652240e+02  4.83652240e+02  4.83652240e+02
  7.16550011e+02  1.33516524e+03  1.33516524e+03  1.33516524e+03
  2.78675116e+03  3.02890563e+03  3.02890563e+03  3.02890563e+03
  6.64898434e+03  6.64898434e+03  6.64898434e+03  9.18396706e+03
  2.55330176e+04  7.62672960e+04]
E1 = -728.2878941017707  E_coul = 201.53754533538924
cycle= 1 E= -526.750348766381  delta_E= -6.82e-13  |g|= 8.89e-08  |ddm|= 6.14e-07
    CPU time for cycle= 1      0.03 sec, wall time      0.03 sec
E1 = -728.2878941017707  E_coul = 201.53754533538924
  HOMO = -0.583338485576688  LUMO = 0.919944678344604
  mo_energy =
[-1.18584099e+02 -1.23128875e+01 -9.56294795e+00 -9.56294795e+00
 -9.56294795e+00 -1.27055637e+00 -5.83338486e-01 -5.83338486e-01
 -5.83338486e-01  9.19944678e-01  1.01395075e+00  1.01395075e+00
  1.01395075e+00  7.30016110e+00  7.30016110e+00  7.30016110e+00
  9.57863669e+00  3.34888765e+01  3.34888765e+01  3.34888765e+01
  5.25868372e+01  1.29222290e+02  1.29222290e+02  1.29222290e+02
  1.99933977e+02  4.83652240e+02  4.83652240e+02  4.83652240e+02
  7.16550011e+02  1.33516524e+03  1.33516524e+03  1.33516524e+03
  2.78675116e+03  3.02890563e+03  3.02890563e+03  3.02890563e+03
  6.64898434e+03  6.64898434e+03  6.64898434e+03  9.18396706e+03
  2.55330176e+04  7.62672960e+04]
E1 = -728.2878938987604  E_coul = 201.53754513237834
Extra cycle  E= -526.750348766382  delta_E= -6.82e-13  |g|= 1.91e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.46 sec
exp = [2.61826682e+04 7.61749514e+03 3.61736370e+03 1.59726822e+03
 3.82667208e+02 1.17173055e+02 4.43758159e+01 2.08382847e+01
 6.90971779e+00 6.50759789e-01 2.80968238e+00 2.31564419e-01
 1.36278733e+03 6.64705059e+02 3.00770465e+02 3.13877152e+02
 6.17416156e+01 7.34635171e+00 2.02631572e+01 7.76087687e-01
 2.82077811e+00 2.22594201e-01]
grad_E = [-1.56552773e-06  3.86592420e-06 -1.19554516e-06  8.96175708e-05
 -4.18388842e-04 -2.49892111e-04 -1.19967529e-04  2.64800301e-04
  1.82937713e-04 -7.18542697e-05 -4.10670667e-04  2.31618996e-04
 -5.16576739e-07  4.89302004e-06  2.29873106e-05  1.98062347e-05
  7.50501695e-06 -1.18914329e-04 -5.99507850e-05  6.44036163e-04
  4.39200628e-04 -2.16781254e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:28 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6682089        1
[INPUT] 0    0    [1    /1   ]  7617.49506275        1
[INPUT] 0    0    [1    /1   ]  3617.36372853        1
[INPUT] 0    0    [1    /1   ]  1597.26649465        1
[INPUT] 0    0    [1    /1   ]  382.674702926        1
[INPUT] 0    0    [1    /1   ]  117.178499597        1
[INPUT] 0    0    [1    /1   ]  44.3828536616        1
[INPUT] 0    0    [1    /1   ]  20.8319576839        1
[INPUT] 0    0    [1    /1   ]  6.91374671819        1
[INPUT] 0    0    [1    /1   ]  0.650010499784       1
[INPUT] 0    0    [1    /1   ]  2.80998703232        1
[INPUT] 0    0    [1    /1   ]  0.231276576941       1
[INPUT] 1    0    [1    /1   ]  1362.78734302        1
[INPUT] 1    0    [1    /1   ]  664.704961196        1
[INPUT] 1    0    [1    /1   ]  300.770005784        1
[INPUT] 1    0    [1    /1   ]  313.876755856        1
[INPUT] 1    0    [1    /1   ]  61.7420539076        1
[INPUT] 1    0    [1    /1   ]  7.34954694911        1
[INPUT] 1    0    [1    /1   ]  20.2609556516        1
[INPUT] 1    0    [1    /1   ]  0.776480825152       1
[INPUT] 1    0    [1    /1   ]  2.82501809492        1
[INPUT] 1    0    [1    /1   ]  0.222625999251       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668208926538, 1.0]], [0, [7617.495062754848, 1.0]], [0, [3617.363728532549, 1.0]], [0, [1597.266494649236, 1.0]], [0, [382.67470292622227, 1.0]], [0, [117.17849959739931, 1.0]], [0, [44.382853661568056, 1.0]], [0, [20.831957683867774, 1.0]], [0, [6.913746718192785, 1.0]], [0, [0.6500104997837083, 1.0]], [0, [2.8099870323151865, 1.0]], [0, [0.2312765769406151, 1.0]], [1, [1362.7873430247855, 1.0]], [1, [664.7049611955915, 1.0]], [1, [300.7700057837336, 1.0]], [1, [313.8767558559127, 1.0]], [1, [61.742053907553945, 1.0]], [1, [7.349546949108151, 1.0]], [1, [20.260955651641257, 1.0]], [1, [0.7764808251516803, 1.0]], [1, [2.8250180949220383, 1.0]], [1, [0.22262599925094426, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66820893]
bas 1, expnt(s) = [7617.49506275]
bas 2, expnt(s) = [3617.36372853]
bas 3, expnt(s) = [1597.26649465]
bas 4, expnt(s) = [382.67470293]
bas 5, expnt(s) = [117.1784996]
bas 6, expnt(s) = [44.38285366]
bas 7, expnt(s) = [20.83195768]
bas 8, expnt(s) = [6.91374672]
bas 9, expnt(s) = [0.6500105]
bas 10, expnt(s) = [2.80998703]
bas 11, expnt(s) = [0.23127658]
bas 12, expnt(s) = [1362.78734302]
bas 13, expnt(s) = [664.7049612]
bas 14, expnt(s) = [300.77000578]
bas 15, expnt(s) = [313.87675586]
bas 16, expnt(s) = [61.74205391]
bas 17, expnt(s) = [7.34954695]
bas 18, expnt(s) = [20.26095565]
bas 19, expnt(s) = [0.77648083]
bas 20, expnt(s) = [2.82501809]
bas 21, expnt(s) = [0.222626]
CPU time:       387.00
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826682e+04 5.20026471e+03 7.61749506e+03 2.06003292e+03
 3.61736373e+03 1.17844457e+03 1.59726649e+03 6.38334123e+02
 3.82674703e+02 2.18593548e+02 1.17178500e+02 8.99810328e+01
 4.43828537e+01 4.34436635e+01 2.08319577e+01 2.46355684e+01
 6.91374672e+00 1.07720937e+01 6.50010500e-01 1.82896461e+00
 2.80998703e+00 5.48331583e+00 2.31276577e-01 8.42585076e-01
 1.36278734e+03 2.41556933e+04 6.64704961e+02 9.84624284e+03
 3.00770006e+02 3.65407576e+03 3.13876756e+02 3.85419192e+03
 6.17420539e+01 5.04906234e+02 7.34954695e+00 3.53028773e+01
 2.02609557e+01 1.25403397e+02 7.76480825e-01 2.12641395e+00
 2.82501809e+00 1.06846656e+01 2.22625999e-01 4.46122621e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99378476056664
cond(S) = 114783.51104893647
E1 = -729.5422544815459  E_coul = 203.1753313516635
init E= -526.366923129882
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555787975619575  LUMO = 0.937927322918879
  mo_energy =
[-1.18332609e+02 -1.22068574e+01 -9.44715755e+00 -9.44715755e+00
 -9.44715755e+00 -1.24021093e+00 -5.55787976e-01 -5.55787976e-01
 -5.55787976e-01  9.37927323e-01  1.03333590e+00  1.03333590e+00
  1.03333590e+00  7.38136722e+00  7.38136722e+00  7.38136722e+00
  9.64975982e+00  3.36328227e+01  3.36328227e+01  3.36328227e+01
  5.27169343e+01  1.29425179e+02  1.29425179e+02  1.29425179e+02
  2.00133494e+02  4.83918545e+02  4.83918545e+02  4.83918545e+02
  7.16870340e+02  1.33548189e+03  1.33548189e+03  1.33548189e+03
  2.78723827e+03  3.02928408e+03  3.02928408e+03  3.02928408e+03
  6.64947305e+03  6.64947305e+03  6.64947305e+03  9.18457777e+03
  2.55337206e+04  7.62680857e+04]
E1 = -727.8374522089756  E_coul = 201.0878942381729
cycle= 1 E= -526.749557970803  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571917
diis-c [-0.3270886  1.       ]
  HOMO = -0.591039542881755  LUMO = 0.911674810020152
  mo_energy =
[-1.18642348e+02 -1.23454662e+01 -9.59683054e+00 -9.59683054e+00
 -9.59683054e+00 -1.27991285e+00 -5.91039543e-01 -5.91039543e-01
 -5.91039543e-01  9.11674810e-01  1.00870372e+00  1.00870372e+00
  1.00870372e+00  7.28964209e+00  7.28964209e+00  7.28964209e+00
  9.55501422e+00  3.34773188e+01  3.34773188e+01  3.34773188e+01
  5.25536617e+01  1.29195168e+02  1.29195168e+02  1.29195168e+02
  1.99893994e+02  4.83610034e+02  4.83610034e+02  4.83610034e+02
  7.16523045e+02  1.33511664e+03  1.33511664e+03  1.33511664e+03
  2.78674088e+03  3.02885293e+03  3.02885293e+03  3.02885293e+03
  6.64892837e+03  6.64892837e+03  6.64892837e+03  9.18395887e+03
  2.55330067e+04  7.62672812e+04]
E1 = -728.4164272818202  E_coul = 201.66613662020717
cycle= 2 E= -526.750290661613  delta_E= -0.000733  |g|= 0.038  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0777
diis-c [-0.00384684  0.07605832  0.92394168]
  HOMO = -0.581791839294503  LUMO = 0.919321110337169
  mo_energy =
[-1.18573582e+02 -1.23068176e+01 -9.55649971e+00 -9.55649971e+00
 -9.55649971e+00 -1.26883682e+00 -5.81791839e-01 -5.81791839e-01
 -5.81791839e-01  9.19321110e-01  1.01554131e+00  1.01554131e+00
  1.01554131e+00  7.31380946e+00  7.31380946e+00  7.31380946e+00
  9.58114483e+00  3.35180413e+01  3.35180413e+01  3.35180413e+01
  5.25978007e+01  1.29251953e+02  1.29251953e+02  1.29251953e+02
  1.99953313e+02  4.83677976e+02  4.83677976e+02  4.83677976e+02
  7.16593161e+02  1.33518869e+03  1.33518869e+03  1.33518869e+03
  2.78681615e+03  3.02892725e+03  3.02892725e+03  3.02892725e+03
  6.64900446e+03  6.64900446e+03  6.64900446e+03  9.18403575e+03
  2.55330842e+04  7.62673590e+04]
E1 = -728.2634619921503  E_coul = 201.51311143024398
cycle= 3 E= -526.750350561906  delta_E= -5.99e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141815
diis-c [-8.42779952e-07 -1.31077402e-03  1.49913742e-01  8.51397032e-01]
  HOMO = -0.583373580523765  LUMO = 0.918110098805721
  mo_energy =
[-1.18584142e+02 -1.23129608e+01 -9.56301002e+00 -9.56301002e+00
 -9.56301002e+00 -1.27061948e+00 -5.83373581e-01 -5.83373581e-01
 -5.83373581e-01  9.18110099e-01  1.01439734e+00  1.01439734e+00
  1.01439734e+00  7.30981095e+00  7.30981095e+00  7.30981095e+00
  9.57692924e+00  3.35115079e+01  3.35115079e+01  3.35115079e+01
  5.25908283e+01  1.29243106e+02  1.29243106e+02  1.29243106e+02
  1.99944125e+02  4.83667539e+02  4.83667539e+02  4.83667539e+02
  7.16582372e+02  1.33517762e+03  1.33517762e+03  1.33517762e+03
  2.78680444e+03  3.02891578e+03  3.02891578e+03  3.02891578e+03
  6.64899258e+03  6.64899258e+03  6.64899258e+03  9.18402365e+03
  2.55330719e+04  7.62673465e+04]
E1 = -728.2876006205465  E_coul = 201.5372479073185
cycle= 4 E= -526.750352713228  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116582
diis-c [-5.10821501e-09  8.57795484e-05 -1.22008696e-02 -7.31766284e-02
  1.08529172e+00]
  HOMO = -0.583354214146267  LUMO = 0.918144489576642
  mo_energy =
[-1.18584090e+02 -1.23128891e+01 -9.56295251e+00 -9.56295251e+00
 -9.56295251e+00 -1.27057526e+00 -5.83354214e-01 -5.83354214e-01
 -5.83354214e-01  9.18144490e-01  1.01441418e+00  1.01441418e+00
  1.01441418e+00  7.30985635e+00  7.30985635e+00  7.30985635e+00
  9.57699083e+00  3.35115635e+01  3.35115635e+01  3.35115635e+01
  5.25908921e+01  1.29243164e+02  1.29243164e+02  1.29243164e+02
  1.99944183e+02  4.83667591e+02  4.83667591e+02  4.83667591e+02
  7.16582416e+02  1.33517767e+03  1.33517767e+03  1.33517767e+03
  2.78680446e+03  3.02891581e+03  3.02891581e+03  3.02891581e+03
  6.64899259e+03  6.64899259e+03  6.64899259e+03  9.18402366e+03
  2.55330719e+04  7.62673465e+04]
E1 = -728.2873544877658  E_coul = 201.53700177248484
cycle= 5 E= -526.750352715281  delta_E= -2.05e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96751e-05
diis-c [-9.47542659e-11  1.29432986e-05 -1.77276284e-03 -1.26985127e-02
  3.43853286e-02  9.80073004e-01]
  HOMO = -0.583362083631788  LUMO = 0.918140684681634
  mo_energy =
[-1.18584122e+02 -1.23129128e+01 -9.56297811e+00 -9.56297811e+00
 -9.56297811e+00 -1.27058152e+00 -5.83362084e-01 -5.83362084e-01
 -5.83362084e-01  9.18140685e-01  1.01440895e+00  1.01440895e+00
  1.01440895e+00  7.30983889e+00  7.30983889e+00  7.30983889e+00
  9.57697375e+00  3.35115387e+01  3.35115387e+01  3.35115387e+01
  5.25908667e+01  1.29243134e+02  1.29243134e+02  1.29243134e+02
  1.99944154e+02  4.83667559e+02  4.83667559e+02  4.83667559e+02
  7.16582384e+02  1.33517763e+03  1.33517763e+03  1.33517763e+03
  2.78680443e+03  3.02891578e+03  3.02891578e+03  3.02891578e+03
  6.64899256e+03  6.64899256e+03  6.64899256e+03  9.18402362e+03
  2.55330718e+04  7.62673465e+04]
E1 = -728.2874389324295  E_coul = 201.53708621708594
cycle= 6 E= -526.750352715344  delta_E= -6.25e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2874389324295  E_coul = 201.53708621708594
  HOMO = -0.583361985523297  LUMO = 0.918141113425714
  mo_energy =
[-1.18584121e+02 -1.23129122e+01 -9.56297761e+00 -9.56297761e+00
 -9.56297761e+00 -1.27058099e+00 -5.83361986e-01 -5.83361986e-01
 -5.83361986e-01  9.18141113e-01  1.01440908e+00  1.01440908e+00
  1.01440908e+00  7.30983924e+00  7.30983924e+00  7.30983924e+00
  9.57697427e+00  3.35115392e+01  3.35115392e+01  3.35115392e+01
  5.25908673e+01  1.29243135e+02  1.29243135e+02  1.29243135e+02
  1.99944154e+02  4.83667560e+02  4.83667560e+02  4.83667560e+02
  7.16582384e+02  1.33517763e+03  1.33517763e+03  1.33517763e+03
  2.78680443e+03  3.02891578e+03  3.02891578e+03  3.02891578e+03
  6.64899256e+03  6.64899256e+03  6.64899256e+03  9.18402362e+03
  2.55330718e+04  7.62673465e+04]
E1 = -728.2874362167798  E_coul = 201.5370835014348
Extra cycle  E= -526.750352715345  delta_E= -1.48e-12  |g|= 3.9e-07  |ddm|= 3.28e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826682e+04 7.61749506e+03 3.61736373e+03 1.59726649e+03
 3.82674703e+02 1.17178500e+02 4.43828537e+01 2.08319577e+01
 6.91374672e+00 6.50010500e-01 2.80998703e+00 2.31276577e-01
 1.36278734e+03 6.64704961e+02 3.00770006e+02 3.13876756e+02
 6.17420539e+01 7.34954695e+00 2.02609557e+01 7.76480825e-01
 2.82501809e+00 2.22625999e-01]
E = -526.750352715345
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:28 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6682089        1
[INPUT] 0    0    [1    /1   ]  7617.49506275        1
[INPUT] 0    0    [1    /1   ]  3617.36372853        1
[INPUT] 0    0    [1    /1   ]  1597.26649465        1
[INPUT] 0    0    [1    /1   ]  382.674702926        1
[INPUT] 0    0    [1    /1   ]  117.178499597        1
[INPUT] 0    0    [1    /1   ]  44.3828536616        1
[INPUT] 0    0    [1    /1   ]  20.8319576839        1
[INPUT] 0    0    [1    /1   ]  6.91374671819        1
[INPUT] 0    0    [1    /1   ]  0.650010499784       1
[INPUT] 0    0    [1    /1   ]  2.80998703232        1
[INPUT] 0    0    [1    /1   ]  0.231276576941       1
[INPUT] 1    0    [1    /1   ]  1362.78734302        1
[INPUT] 1    0    [1    /1   ]  664.704961196        1
[INPUT] 1    0    [1    /1   ]  300.770005784        1
[INPUT] 1    0    [1    /1   ]  313.876755856        1
[INPUT] 1    0    [1    /1   ]  61.7420539076        1
[INPUT] 1    0    [1    /1   ]  7.34954694911        1
[INPUT] 1    0    [1    /1   ]  20.2609556516        1
[INPUT] 1    0    [1    /1   ]  0.776480825152       1
[INPUT] 1    0    [1    /1   ]  2.82501809492        1
[INPUT] 1    0    [1    /1   ]  0.222625999251       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668208926538, 1.0]], [0, [7617.495062754848, 1.0]], [0, [3617.363728532549, 1.0]], [0, [1597.266494649236, 1.0]], [0, [382.67470292622227, 1.0]], [0, [117.17849959739931, 1.0]], [0, [44.382853661568056, 1.0]], [0, [20.831957683867774, 1.0]], [0, [6.913746718192785, 1.0]], [0, [0.6500104997837083, 1.0]], [0, [2.8099870323151865, 1.0]], [0, [0.2312765769406151, 1.0]], [1, [1362.7873430247855, 1.0]], [1, [664.7049611955915, 1.0]], [1, [300.7700057837336, 1.0]], [1, [313.8767558559127, 1.0]], [1, [61.742053907553945, 1.0]], [1, [7.349546949108151, 1.0]], [1, [20.260955651641257, 1.0]], [1, [0.7764808251516803, 1.0]], [1, [2.8250180949220383, 1.0]], [1, [0.22262599925094426, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66820893]
bas 1, expnt(s) = [7617.49506275]
bas 2, expnt(s) = [3617.36372853]
bas 3, expnt(s) = [1597.26649465]
bas 4, expnt(s) = [382.67470293]
bas 5, expnt(s) = [117.1784996]
bas 6, expnt(s) = [44.38285366]
bas 7, expnt(s) = [20.83195768]
bas 8, expnt(s) = [6.91374672]
bas 9, expnt(s) = [0.6500105]
bas 10, expnt(s) = [2.80998703]
bas 11, expnt(s) = [0.23127658]
bas 12, expnt(s) = [1362.78734302]
bas 13, expnt(s) = [664.7049612]
bas 14, expnt(s) = [300.77000578]
bas 15, expnt(s) = [313.87675586]
bas 16, expnt(s) = [61.74205391]
bas 17, expnt(s) = [7.34954695]
bas 18, expnt(s) = [20.26095565]
bas 19, expnt(s) = [0.77648083]
bas 20, expnt(s) = [2.82501809]
bas 21, expnt(s) = [0.222626]
CPU time:       387.48
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826682e+04 5.20026471e+03 7.61749506e+03 2.06003292e+03
 3.61736373e+03 1.17844457e+03 1.59726649e+03 6.38334123e+02
 3.82674703e+02 2.18593548e+02 1.17178500e+02 8.99810328e+01
 4.43828537e+01 4.34436635e+01 2.08319577e+01 2.46355684e+01
 6.91374672e+00 1.07720937e+01 6.50010500e-01 1.82896461e+00
 2.80998703e+00 5.48331583e+00 2.31276577e-01 8.42585076e-01
 1.36278734e+03 2.41556933e+04 6.64704961e+02 9.84624284e+03
 3.00770006e+02 3.65407576e+03 3.13876756e+02 3.85419192e+03
 6.17420539e+01 5.04906234e+02 7.34954695e+00 3.53028773e+01
 2.02609557e+01 1.25403397e+02 7.76480825e-01 2.12641395e+00
 2.82501809e+00 1.06846656e+01 2.22625999e-01 4.46122621e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99378476056664
cond(S) = 114783.51104893647
E1 = -729.5422544815459  E_coul = 203.1753313516635
init E= -526.366923129882
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555787975619575  LUMO = 0.937927322918879
  mo_energy =
[-1.18332609e+02 -1.22068574e+01 -9.44715755e+00 -9.44715755e+00
 -9.44715755e+00 -1.24021093e+00 -5.55787976e-01 -5.55787976e-01
 -5.55787976e-01  9.37927323e-01  1.03333590e+00  1.03333590e+00
  1.03333590e+00  7.38136722e+00  7.38136722e+00  7.38136722e+00
  9.64975982e+00  3.36328227e+01  3.36328227e+01  3.36328227e+01
  5.27169343e+01  1.29425179e+02  1.29425179e+02  1.29425179e+02
  2.00133494e+02  4.83918545e+02  4.83918545e+02  4.83918545e+02
  7.16870340e+02  1.33548189e+03  1.33548189e+03  1.33548189e+03
  2.78723827e+03  3.02928408e+03  3.02928408e+03  3.02928408e+03
  6.64947305e+03  6.64947305e+03  6.64947305e+03  9.18457777e+03
  2.55337206e+04  7.62680857e+04]
E1 = -727.8374522089756  E_coul = 201.0878942381729
cycle= 1 E= -526.749557970803  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571917
diis-c [-0.3270886  1.       ]
  HOMO = -0.591039542881755  LUMO = 0.911674810020152
  mo_energy =
[-1.18642348e+02 -1.23454662e+01 -9.59683054e+00 -9.59683054e+00
 -9.59683054e+00 -1.27991285e+00 -5.91039543e-01 -5.91039543e-01
 -5.91039543e-01  9.11674810e-01  1.00870372e+00  1.00870372e+00
  1.00870372e+00  7.28964209e+00  7.28964209e+00  7.28964209e+00
  9.55501422e+00  3.34773188e+01  3.34773188e+01  3.34773188e+01
  5.25536617e+01  1.29195168e+02  1.29195168e+02  1.29195168e+02
  1.99893994e+02  4.83610034e+02  4.83610034e+02  4.83610034e+02
  7.16523045e+02  1.33511664e+03  1.33511664e+03  1.33511664e+03
  2.78674088e+03  3.02885293e+03  3.02885293e+03  3.02885293e+03
  6.64892837e+03  6.64892837e+03  6.64892837e+03  9.18395887e+03
  2.55330067e+04  7.62672812e+04]
E1 = -728.4164272818202  E_coul = 201.66613662020717
cycle= 2 E= -526.750290661613  delta_E= -0.000733  |g|= 0.038  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0777
diis-c [-0.00384684  0.07605832  0.92394168]
  HOMO = -0.581791839294503  LUMO = 0.919321110337169
  mo_energy =
[-1.18573582e+02 -1.23068176e+01 -9.55649971e+00 -9.55649971e+00
 -9.55649971e+00 -1.26883682e+00 -5.81791839e-01 -5.81791839e-01
 -5.81791839e-01  9.19321110e-01  1.01554131e+00  1.01554131e+00
  1.01554131e+00  7.31380946e+00  7.31380946e+00  7.31380946e+00
  9.58114483e+00  3.35180413e+01  3.35180413e+01  3.35180413e+01
  5.25978007e+01  1.29251953e+02  1.29251953e+02  1.29251953e+02
  1.99953313e+02  4.83677976e+02  4.83677976e+02  4.83677976e+02
  7.16593161e+02  1.33518869e+03  1.33518869e+03  1.33518869e+03
  2.78681615e+03  3.02892725e+03  3.02892725e+03  3.02892725e+03
  6.64900446e+03  6.64900446e+03  6.64900446e+03  9.18403575e+03
  2.55330842e+04  7.62673590e+04]
E1 = -728.2634619921503  E_coul = 201.51311143024398
cycle= 3 E= -526.750350561906  delta_E= -5.99e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141815
diis-c [-8.42779952e-07 -1.31077402e-03  1.49913742e-01  8.51397032e-01]
  HOMO = -0.583373580523765  LUMO = 0.918110098805721
  mo_energy =
[-1.18584142e+02 -1.23129608e+01 -9.56301002e+00 -9.56301002e+00
 -9.56301002e+00 -1.27061948e+00 -5.83373581e-01 -5.83373581e-01
 -5.83373581e-01  9.18110099e-01  1.01439734e+00  1.01439734e+00
  1.01439734e+00  7.30981095e+00  7.30981095e+00  7.30981095e+00
  9.57692924e+00  3.35115079e+01  3.35115079e+01  3.35115079e+01
  5.25908283e+01  1.29243106e+02  1.29243106e+02  1.29243106e+02
  1.99944125e+02  4.83667539e+02  4.83667539e+02  4.83667539e+02
  7.16582372e+02  1.33517762e+03  1.33517762e+03  1.33517762e+03
  2.78680444e+03  3.02891578e+03  3.02891578e+03  3.02891578e+03
  6.64899258e+03  6.64899258e+03  6.64899258e+03  9.18402365e+03
  2.55330719e+04  7.62673465e+04]
E1 = -728.2876006205465  E_coul = 201.5372479073185
cycle= 4 E= -526.750352713228  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116582
diis-c [-5.10821501e-09  8.57795484e-05 -1.22008696e-02 -7.31766284e-02
  1.08529172e+00]
  HOMO = -0.583354214146267  LUMO = 0.918144489576642
  mo_energy =
[-1.18584090e+02 -1.23128891e+01 -9.56295251e+00 -9.56295251e+00
 -9.56295251e+00 -1.27057526e+00 -5.83354214e-01 -5.83354214e-01
 -5.83354214e-01  9.18144490e-01  1.01441418e+00  1.01441418e+00
  1.01441418e+00  7.30985635e+00  7.30985635e+00  7.30985635e+00
  9.57699083e+00  3.35115635e+01  3.35115635e+01  3.35115635e+01
  5.25908921e+01  1.29243164e+02  1.29243164e+02  1.29243164e+02
  1.99944183e+02  4.83667591e+02  4.83667591e+02  4.83667591e+02
  7.16582416e+02  1.33517767e+03  1.33517767e+03  1.33517767e+03
  2.78680446e+03  3.02891581e+03  3.02891581e+03  3.02891581e+03
  6.64899259e+03  6.64899259e+03  6.64899259e+03  9.18402366e+03
  2.55330719e+04  7.62673465e+04]
E1 = -728.2873544877658  E_coul = 201.53700177248484
cycle= 5 E= -526.750352715281  delta_E= -2.05e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96751e-05
diis-c [-9.47542659e-11  1.29432986e-05 -1.77276284e-03 -1.26985127e-02
  3.43853286e-02  9.80073004e-01]
  HOMO = -0.583362083631788  LUMO = 0.918140684681634
  mo_energy =
[-1.18584122e+02 -1.23129128e+01 -9.56297811e+00 -9.56297811e+00
 -9.56297811e+00 -1.27058152e+00 -5.83362084e-01 -5.83362084e-01
 -5.83362084e-01  9.18140685e-01  1.01440895e+00  1.01440895e+00
  1.01440895e+00  7.30983889e+00  7.30983889e+00  7.30983889e+00
  9.57697375e+00  3.35115387e+01  3.35115387e+01  3.35115387e+01
  5.25908667e+01  1.29243134e+02  1.29243134e+02  1.29243134e+02
  1.99944154e+02  4.83667559e+02  4.83667559e+02  4.83667559e+02
  7.16582384e+02  1.33517763e+03  1.33517763e+03  1.33517763e+03
  2.78680443e+03  3.02891578e+03  3.02891578e+03  3.02891578e+03
  6.64899256e+03  6.64899256e+03  6.64899256e+03  9.18402362e+03
  2.55330718e+04  7.62673465e+04]
E1 = -728.2874389324295  E_coul = 201.53708621708594
cycle= 6 E= -526.750352715344  delta_E= -6.25e-11  |g|= 1.86e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2874389324295  E_coul = 201.53708621708594
  HOMO = -0.583361985523297  LUMO = 0.918141113425714
  mo_energy =
[-1.18584121e+02 -1.23129122e+01 -9.56297761e+00 -9.56297761e+00
 -9.56297761e+00 -1.27058099e+00 -5.83361986e-01 -5.83361986e-01
 -5.83361986e-01  9.18141113e-01  1.01440908e+00  1.01440908e+00
  1.01440908e+00  7.30983924e+00  7.30983924e+00  7.30983924e+00
  9.57697427e+00  3.35115392e+01  3.35115392e+01  3.35115392e+01
  5.25908673e+01  1.29243135e+02  1.29243135e+02  1.29243135e+02
  1.99944154e+02  4.83667560e+02  4.83667560e+02  4.83667560e+02
  7.16582384e+02  1.33517763e+03  1.33517763e+03  1.33517763e+03
  2.78680443e+03  3.02891578e+03  3.02891578e+03  3.02891578e+03
  6.64899256e+03  6.64899256e+03  6.64899256e+03  9.18402362e+03
  2.55330718e+04  7.62673465e+04]
E1 = -728.2874362167798  E_coul = 201.5370835014348
Extra cycle  E= -526.750352715345  delta_E= -1.48e-12  |g|= 3.9e-07  |ddm|= 3.28e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114783.51104893647
E1 = -728.2874362167798  E_coul = 201.5370835014348
init E= -526.750352715345
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583362053387023  LUMO = 0.918141131741185
  mo_energy =
[-1.18584122e+02 -1.23129124e+01 -9.56297783e+00 -9.56297783e+00
 -9.56297783e+00 -1.27058099e+00 -5.83362053e-01 -5.83362053e-01
 -5.83362053e-01  9.18141132e-01  1.01440904e+00  1.01440904e+00
  1.01440904e+00  7.30983909e+00  7.30983909e+00  7.30983909e+00
  9.57697416e+00  3.35115390e+01  3.35115390e+01  3.35115390e+01
  5.25908671e+01  1.29243135e+02  1.29243135e+02  1.29243135e+02
  1.99944154e+02  4.83667560e+02  4.83667560e+02  4.83667560e+02
  7.16582384e+02  1.33517763e+03  1.33517763e+03  1.33517763e+03
  2.78680443e+03  3.02891578e+03  3.02891578e+03  3.02891578e+03
  6.64899256e+03  6.64899256e+03  6.64899256e+03  9.18402362e+03
  2.55330718e+04  7.62673465e+04]
E1 = -728.2874368341083  E_coul = 201.53708411876306
cycle= 1 E= -526.750352715345  delta_E= -3.41e-13  |g|= 8.91e-08  |ddm|= 6.15e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2874368341083  E_coul = 201.53708411876306
  HOMO = -0.583362044751271  LUMO = 0.918141153544808
  mo_energy =
[-1.18584121e+02 -1.23129124e+01 -9.56297778e+00 -9.56297778e+00
 -9.56297778e+00 -1.27058096e+00 -5.83362045e-01 -5.83362045e-01
 -5.83362045e-01  9.18141154e-01  1.01440905e+00  1.01440905e+00
  1.01440905e+00  7.30983912e+00  7.30983912e+00  7.30983912e+00
  9.57697419e+00  3.35115391e+01  3.35115391e+01  3.35115391e+01
  5.25908671e+01  1.29243135e+02  1.29243135e+02  1.29243135e+02
  1.99944154e+02  4.83667560e+02  4.83667560e+02  4.83667560e+02
  7.16582384e+02  1.33517763e+03  1.33517763e+03  1.33517763e+03
  2.78680443e+03  3.02891578e+03  3.02891578e+03  3.02891578e+03
  6.64899256e+03  6.64899256e+03  6.64899256e+03  9.18402362e+03
  2.55330718e+04  7.62673465e+04]
E1 = -728.2874366298114  E_coul = 201.53708391446617
Extra cycle  E= -526.750352715345  delta_E= 1.14e-13  |g|= 1.91e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826682e+04 7.61749506e+03 3.61736373e+03 1.59726649e+03
 3.82674703e+02 1.17178500e+02 4.43828537e+01 2.08319577e+01
 6.91374672e+00 6.50010500e-01 2.80998703e+00 2.31276577e-01
 1.36278734e+03 6.64704961e+02 3.00770006e+02 3.13876756e+02
 6.17420539e+01 7.34954695e+00 2.02609557e+01 7.76480825e-01
 2.82501809e+00 2.22625999e-01]
grad_E = [-1.56547434e-06  3.86526312e-06 -1.19616269e-06  8.95948456e-05
 -4.17983825e-04 -2.51761030e-04 -1.17810492e-04  2.63065962e-04
  2.22185951e-04 -1.60038012e-04 -4.96678130e-04  1.64321012e-04
 -5.17288081e-07  4.88310257e-06  2.29278969e-05  1.97551657e-05
  1.32586873e-05 -2.33493177e-04 -8.15569917e-05  1.14797426e-03
  8.19755630e-04 -3.81418240e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:33 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6682991        1
[INPUT] 0    0    [1    /1   ]  7617.49484119        1
[INPUT] 0    0    [1    /1   ]  3617.36379851        1
[INPUT] 0    0    [1    /1   ]  1597.26137466        1
[INPUT] 0    0    [1    /1   ]  382.69806314         1
[INPUT] 0    0    [1    /1   ]  117.193430894        1
[INPUT] 0    0    [1    /1   ]  44.3943573003        1
[INPUT] 0    0    [1    /1   ]  20.8067491998        1
[INPUT] 0    0    [1    /1   ]  6.91902146738        1
[INPUT] 0    0    [1    /1   ]  0.648614816277       1
[INPUT] 0    0    [1    /1   ]  2.80984459933        1
[INPUT] 0    0    [1    /1   ]  0.230739241236       1
[INPUT] 1    0    [1    /1   ]  1362.78737262        1
[INPUT] 1    0    [1    /1   ]  664.704676885        1
[INPUT] 1    0    [1    /1   ]  300.768667245        1
[INPUT] 1    0    [1    /1   ]  313.875602522        1
[INPUT] 1    0    [1    /1   ]  61.7428809085        1
[INPUT] 1    0    [1    /1   ]  7.35581184009        1
[INPUT] 1    0    [1    /1   ]  20.2572654819        1
[INPUT] 1    0    [1    /1   ]  0.777229353718       1
[INPUT] 1    0    [1    /1   ]  2.83302515568        1
[INPUT] 1    0    [1    /1   ]  0.222693187071       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668299055742, 1.0]], [0, [7617.494841191496, 1.0]], [0, [3617.3637985080536, 1.0]], [0, [1597.2613746619252, 1.0]], [0, [382.69806313990784, 1.0]], [0, [117.19343089375774, 1.0]], [0, [44.39435730027337, 1.0]], [0, [20.806749199833437, 1.0]], [0, [6.919021467378281, 1.0]], [0, [0.6486148162767593, 1.0]], [0, [2.8098445993287973, 1.0]], [0, [0.23073924123562303, 1.0]], [1, [1362.7873726210616, 1.0]], [1, [664.7046768848609, 1.0]], [1, [300.76866724470307, 1.0]], [1, [313.8756025224533, 1.0]], [1, [61.742880908535234, 1.0]], [1, [7.355811840086189, 1.0]], [1, [20.257265481912793, 1.0]], [1, [0.7772293537182653, 1.0]], [1, [2.833025155682203, 1.0]], [1, [0.22269318707107158, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66829906]
bas 1, expnt(s) = [7617.49484119]
bas 2, expnt(s) = [3617.36379851]
bas 3, expnt(s) = [1597.26137466]
bas 4, expnt(s) = [382.69806314]
bas 5, expnt(s) = [117.19343089]
bas 6, expnt(s) = [44.3943573]
bas 7, expnt(s) = [20.8067492]
bas 8, expnt(s) = [6.91902147]
bas 9, expnt(s) = [0.64861482]
bas 10, expnt(s) = [2.8098446]
bas 11, expnt(s) = [0.23073924]
bas 12, expnt(s) = [1362.78737262]
bas 13, expnt(s) = [664.70467688]
bas 14, expnt(s) = [300.76866724]
bas 15, expnt(s) = [313.87560252]
bas 16, expnt(s) = [61.74288091]
bas 17, expnt(s) = [7.35581184]
bas 18, expnt(s) = [20.25726548]
bas 19, expnt(s) = [0.77722935]
bas 20, expnt(s) = [2.83302516]
bas 21, expnt(s) = [0.22269319]
CPU time:       393.26
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826683e+04 5.20026472e+03 7.61749484e+03 2.06003287e+03
 3.61736380e+03 1.17844459e+03 1.59726137e+03 6.38332588e+02
 3.82698063e+02 2.18603556e+02 1.17193431e+02 8.99896320e+01
 4.43943573e+01 4.34521084e+01 2.08067492e+01 2.46132067e+01
 6.91902147e+00 1.07782569e+01 6.48614816e-01 1.82601850e+00
 2.80984460e+00 5.48310737e+00 2.30739241e-01 8.41116436e-01
 1.36278737e+03 2.41556940e+04 6.64704677e+02 9.84623758e+03
 3.00768667e+02 3.65405544e+03 3.13875603e+02 3.85417422e+03
 6.17428809e+01 5.04914688e+02 7.35581184e+00 3.53404973e+01
 2.02572655e+01 1.25374847e+02 7.77229354e-01 2.12897659e+00
 2.83302516e+00 1.07225340e+01 2.22693187e-01 4.46290925e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993768002005638
cond(S) = 114778.31237546599
E1 = -729.5423004217909  E_coul = 203.17536793956683
init E= -526.366932482224
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555788170894089  LUMO = 0.934507994872908
  mo_energy =
[-1.18332611e+02 -1.22068515e+01 -9.44715431e+00 -9.44715431e+00
 -9.44715431e+00 -1.24021267e+00 -5.55788171e-01 -5.55788171e-01
 -5.55788171e-01  9.34507995e-01  1.03429101e+00  1.03429101e+00
  1.03429101e+00  7.39991789e+00  7.39991789e+00  7.39991789e+00
  9.64301779e+00  3.36765600e+01  3.36765600e+01  3.36765600e+01
  5.26981610e+01  1.29466692e+02  1.29466692e+02  1.29466692e+02
  2.00096925e+02  4.83949487e+02  4.83949487e+02  4.83949487e+02
  7.16879577e+02  1.33550621e+03  1.33550621e+03  1.33550621e+03
  2.78731325e+03  3.02930277e+03  3.02930277e+03  3.02930277e+03
  6.64948712e+03  6.64948712e+03  6.64948712e+03  9.18466898e+03
  2.55338092e+04  7.62681679e+04]
E1 = -727.8364990952917  E_coul = 201.08693002986777
cycle= 1 E= -526.749569065424  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571998
diis-c [-0.32718139  1.        ]
  HOMO = -0.591083915143017  LUMO = 0.908298722815254
  mo_energy =
[-1.18642406e+02 -1.23455220e+01 -9.59689502e+00 -9.59689502e+00
 -9.59689502e+00 -1.27996003e+00 -5.91083915e-01 -5.91083915e-01
 -5.91083915e-01  9.08298723e-01  1.00959422e+00  1.00959422e+00
  1.00959422e+00  7.30800460e+00  7.30800460e+00  7.30800460e+00
  9.54821361e+00  3.35209855e+01  3.35209855e+01  3.35209855e+01
  5.25348468e+01  1.29236637e+02  1.29236637e+02  1.29236637e+02
  1.99857369e+02  4.83640923e+02  4.83640923e+02  4.83640923e+02
  7.16532216e+02  1.33514091e+03  1.33514091e+03  1.33514091e+03
  2.78681580e+03  3.02887157e+03  3.02887157e+03  3.02887157e+03
  6.64894238e+03  6.64894238e+03  6.64894238e+03  9.18405002e+03
  2.55330952e+04  7.62673633e+04]
E1 = -728.415705849214  E_coul = 201.66540348666106
cycle= 2 E= -526.750302362553  delta_E= -0.000733  |g|= 0.038  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0777348
diis-c [-0.0038485   0.07610856  0.92389144]
  HOMO = -0.581831916382227  LUMO = 0.915928529575073
  mo_energy =
[-1.18573624e+02 -1.23068590e+01 -9.55654983e+00 -9.55654983e+00
 -9.55654983e+00 -1.26887878e+00 -5.81831916e-01 -5.81831916e-01
 -5.81831916e-01  9.15928530e-01  1.01644412e+00  1.01644412e+00
  1.01644412e+00  7.33221326e+00  7.33221326e+00  7.33221326e+00
  9.57435679e+00  3.35617252e+01  3.35617252e+01  3.35617252e+01
  5.25789962e+01  1.29293435e+02  1.29293435e+02  1.29293435e+02
  1.99916704e+02  4.83708880e+02  4.83708880e+02  4.83708880e+02
  7.16602349e+02  1.33521297e+03  1.33521297e+03  1.33521297e+03
  2.78689109e+03  3.02894590e+03  3.02894590e+03  3.02894590e+03
  6.64901848e+03  6.64901848e+03  6.64901848e+03  9.18412691e+03
  2.55331727e+04  7.62674411e+04]
E1 = -728.2626945351617  E_coul = 201.51233222694313
cycle= 3 E= -526.750362308219  delta_E= -5.99e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.014184
diis-c [-8.44046822e-07 -1.31084333e-03  1.49876882e-01  8.51433962e-01]
  HOMO = -0.583413922429939  LUMO = 0.91472065269335
  mo_energy =
[-1.18584183e+02 -1.23130017e+01 -9.56305991e+00 -9.56305991e+00
 -9.56305991e+00 -1.27066155e+00 -5.83413922e-01 -5.83413922e-01
 -5.83413922e-01  9.14720653e-01  1.01529843e+00  1.01529843e+00
  1.01529843e+00  7.32820956e+00  7.32820956e+00  7.32820956e+00
  9.57014114e+00  3.35551916e+01  3.35551916e+01  3.35551916e+01
  5.25720249e+01  1.29284590e+02  1.29284590e+02  1.29284590e+02
  1.99907518e+02  4.83698445e+02  4.83698445e+02  4.83698445e+02
  7.16591560e+02  1.33520191e+03  1.33520191e+03  1.33520191e+03
  2.78687938e+03  3.02893443e+03  3.02893443e+03  3.02893443e+03
  6.64900660e+03  6.64900660e+03  6.64900660e+03  9.18411481e+03
  2.55331604e+04  7.62674287e+04]
E1 = -728.2868305414496  E_coul = 201.53646608201637
cycle= 4 E= -526.750364459433  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116995
diis-c [-5.11080779e-09  8.60624273e-05 -1.22364986e-02 -7.34336301e-02
  1.08558407e+00]
  HOMO = -0.58339465844673  LUMO = 0.914754925537328
  mo_energy =
[-1.18584131e+02 -1.23129303e+01 -9.56300267e+00 -9.56300267e+00
 -9.56300267e+00 -1.27061740e+00 -5.83394658e-01 -5.83394658e-01
 -5.83394658e-01  9.14754926e-01  1.01531522e+00  1.01531522e+00
  1.01531522e+00  7.32825481e+00  7.32825481e+00  7.32825481e+00
  9.57020258e+00  3.35552470e+01  3.35552470e+01  3.35552470e+01
  5.25720884e+01  1.29284647e+02  1.29284647e+02  1.29284647e+02
  1.99907575e+02  4.83698496e+02  4.83698496e+02  4.83698496e+02
  7.16591604e+02  1.33520195e+03  1.33520195e+03  1.33520195e+03
  2.78687940e+03  3.02893446e+03  3.02893446e+03  3.02893446e+03
  6.64900662e+03  6.64900662e+03  6.64900662e+03  9.18411482e+03
  2.55331604e+04  7.62674287e+04]
E1 = -728.2865849596682  E_coul = 201.53622049817508
cycle= 5 E= -526.750364461493  delta_E= -2.06e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96681e-05
diis-c [-9.50418181e-11  1.29284498e-05 -1.77039399e-03 -1.26879296e-02
  3.43385591e-02  9.80106836e-01]
  HOMO = -0.583402536867377  LUMO = 0.914751126699577
  mo_energy =
[-1.18584163e+02 -1.23129540e+01 -9.56302828e+00 -9.56302828e+00
 -9.56302828e+00 -1.27062367e+00 -5.83402537e-01 -5.83402537e-01
 -5.83402537e-01  9.14751127e-01  1.01530997e+00  1.01530997e+00
  1.01530997e+00  7.32823732e+00  7.32823732e+00  7.32823732e+00
  9.57018548e+00  3.35552222e+01  3.35552222e+01  3.35552222e+01
  5.25720630e+01  1.29284618e+02  1.29284618e+02  1.29284618e+02
  1.99907546e+02  4.83698464e+02  4.83698464e+02  4.83698464e+02
  7.16591572e+02  1.33520192e+03  1.33520192e+03  1.33520192e+03
  2.78687937e+03  3.02893443e+03  3.02893443e+03  3.02893443e+03
  6.64900659e+03  6.64900659e+03  6.64900659e+03  9.18411479e+03
  2.55331604e+04  7.62674286e+04]
E1 = -728.2866694060796  E_coul = 201.53630494452267
cycle= 6 E= -526.750364461557  delta_E= -6.39e-11  |g|= 1.86e-06  |ddm|= 2e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2866694060796  E_coul = 201.53630494452267
  HOMO = -0.583402437389165  LUMO = 0.914751556054497
  mo_energy =
[-1.18584163e+02 -1.23129534e+01 -9.56302778e+00 -9.56302778e+00
 -9.56302778e+00 -1.27062314e+00 -5.83402437e-01 -5.83402437e-01
 -5.83402437e-01  9.14751556e-01  1.01531010e+00  1.01531010e+00
  1.01531010e+00  7.32823766e+00  7.32823766e+00  7.32823766e+00
  9.57018601e+00  3.35552227e+01  3.35552227e+01  3.35552227e+01
  5.25720636e+01  1.29284618e+02  1.29284618e+02  1.29284618e+02
  1.99907546e+02  4.83698465e+02  4.83698465e+02  4.83698465e+02
  7.16591573e+02  1.33520192e+03  1.33520192e+03  1.33520192e+03
  2.78687937e+03  3.02893443e+03  3.02893443e+03  3.02893443e+03
  6.64900659e+03  6.64900659e+03  6.64900659e+03  9.18411479e+03
  2.55331604e+04  7.62674286e+04]
E1 = -728.2866666574645  E_coul = 201.53630219590653
Extra cycle  E= -526.750364461558  delta_E= -1.02e-12  |g|= 3.91e-07  |ddm|= 3.28e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
exp = [2.61826683e+04 7.61749484e+03 3.61736380e+03 1.59726137e+03
 3.82698063e+02 1.17193431e+02 4.43943573e+01 2.08067492e+01
 6.91902147e+00 6.48614816e-01 2.80984460e+00 2.30739241e-01
 1.36278737e+03 6.64704677e+02 3.00768667e+02 3.13875603e+02
 6.17428809e+01 7.35581184e+00 2.02572655e+01 7.77229354e-01
 2.83302516e+00 2.22693187e-01]
E = -526.750364461558
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:33 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6682991        1
[INPUT] 0    0    [1    /1   ]  7617.49484119        1
[INPUT] 0    0    [1    /1   ]  3617.36379851        1
[INPUT] 0    0    [1    /1   ]  1597.26137466        1
[INPUT] 0    0    [1    /1   ]  382.69806314         1
[INPUT] 0    0    [1    /1   ]  117.193430894        1
[INPUT] 0    0    [1    /1   ]  44.3943573003        1
[INPUT] 0    0    [1    /1   ]  20.8067491998        1
[INPUT] 0    0    [1    /1   ]  6.91902146738        1
[INPUT] 0    0    [1    /1   ]  0.648614816277       1
[INPUT] 0    0    [1    /1   ]  2.80984459933        1
[INPUT] 0    0    [1    /1   ]  0.230739241236       1
[INPUT] 1    0    [1    /1   ]  1362.78737262        1
[INPUT] 1    0    [1    /1   ]  664.704676885        1
[INPUT] 1    0    [1    /1   ]  300.768667245        1
[INPUT] 1    0    [1    /1   ]  313.875602522        1
[INPUT] 1    0    [1    /1   ]  61.7428809085        1
[INPUT] 1    0    [1    /1   ]  7.35581184009        1
[INPUT] 1    0    [1    /1   ]  20.2572654819        1
[INPUT] 1    0    [1    /1   ]  0.777229353718       1
[INPUT] 1    0    [1    /1   ]  2.83302515568        1
[INPUT] 1    0    [1    /1   ]  0.222693187071       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668299055742, 1.0]], [0, [7617.494841191496, 1.0]], [0, [3617.3637985080536, 1.0]], [0, [1597.2613746619252, 1.0]], [0, [382.69806313990784, 1.0]], [0, [117.19343089375774, 1.0]], [0, [44.39435730027337, 1.0]], [0, [20.806749199833437, 1.0]], [0, [6.919021467378281, 1.0]], [0, [0.6486148162767593, 1.0]], [0, [2.8098445993287973, 1.0]], [0, [0.23073924123562303, 1.0]], [1, [1362.7873726210616, 1.0]], [1, [664.7046768848609, 1.0]], [1, [300.76866724470307, 1.0]], [1, [313.8756025224533, 1.0]], [1, [61.742880908535234, 1.0]], [1, [7.355811840086189, 1.0]], [1, [20.257265481912793, 1.0]], [1, [0.7772293537182653, 1.0]], [1, [2.833025155682203, 1.0]], [1, [0.22269318707107158, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66829906]
bas 1, expnt(s) = [7617.49484119]
bas 2, expnt(s) = [3617.36379851]
bas 3, expnt(s) = [1597.26137466]
bas 4, expnt(s) = [382.69806314]
bas 5, expnt(s) = [117.19343089]
bas 6, expnt(s) = [44.3943573]
bas 7, expnt(s) = [20.8067492]
bas 8, expnt(s) = [6.91902147]
bas 9, expnt(s) = [0.64861482]
bas 10, expnt(s) = [2.8098446]
bas 11, expnt(s) = [0.23073924]
bas 12, expnt(s) = [1362.78737262]
bas 13, expnt(s) = [664.70467688]
bas 14, expnt(s) = [300.76866724]
bas 15, expnt(s) = [313.87560252]
bas 16, expnt(s) = [61.74288091]
bas 17, expnt(s) = [7.35581184]
bas 18, expnt(s) = [20.25726548]
bas 19, expnt(s) = [0.77722935]
bas 20, expnt(s) = [2.83302516]
bas 21, expnt(s) = [0.22269319]
CPU time:       393.74
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826683e+04 5.20026472e+03 7.61749484e+03 2.06003287e+03
 3.61736380e+03 1.17844459e+03 1.59726137e+03 6.38332588e+02
 3.82698063e+02 2.18603556e+02 1.17193431e+02 8.99896320e+01
 4.43943573e+01 4.34521084e+01 2.08067492e+01 2.46132067e+01
 6.91902147e+00 1.07782569e+01 6.48614816e-01 1.82601850e+00
 2.80984460e+00 5.48310737e+00 2.30739241e-01 8.41116436e-01
 1.36278737e+03 2.41556940e+04 6.64704677e+02 9.84623758e+03
 3.00768667e+02 3.65405544e+03 3.13875603e+02 3.85417422e+03
 6.17428809e+01 5.04914688e+02 7.35581184e+00 3.53404973e+01
 2.02572655e+01 1.25374847e+02 7.77229354e-01 2.12897659e+00
 2.83302516e+00 1.07225340e+01 2.22693187e-01 4.46290925e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993768002005638
cond(S) = 114778.31237546599
E1 = -729.5423004217909  E_coul = 203.17536793956683
init E= -526.366932482224
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555788170894089  LUMO = 0.934507994872908
  mo_energy =
[-1.18332611e+02 -1.22068515e+01 -9.44715431e+00 -9.44715431e+00
 -9.44715431e+00 -1.24021267e+00 -5.55788171e-01 -5.55788171e-01
 -5.55788171e-01  9.34507995e-01  1.03429101e+00  1.03429101e+00
  1.03429101e+00  7.39991789e+00  7.39991789e+00  7.39991789e+00
  9.64301779e+00  3.36765600e+01  3.36765600e+01  3.36765600e+01
  5.26981610e+01  1.29466692e+02  1.29466692e+02  1.29466692e+02
  2.00096925e+02  4.83949487e+02  4.83949487e+02  4.83949487e+02
  7.16879577e+02  1.33550621e+03  1.33550621e+03  1.33550621e+03
  2.78731325e+03  3.02930277e+03  3.02930277e+03  3.02930277e+03
  6.64948712e+03  6.64948712e+03  6.64948712e+03  9.18466898e+03
  2.55338092e+04  7.62681679e+04]
E1 = -727.8364990952917  E_coul = 201.08693002986777
cycle= 1 E= -526.749569065424  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571998
diis-c [-0.32718139  1.        ]
  HOMO = -0.591083915143017  LUMO = 0.908298722815254
  mo_energy =
[-1.18642406e+02 -1.23455220e+01 -9.59689502e+00 -9.59689502e+00
 -9.59689502e+00 -1.27996003e+00 -5.91083915e-01 -5.91083915e-01
 -5.91083915e-01  9.08298723e-01  1.00959422e+00  1.00959422e+00
  1.00959422e+00  7.30800460e+00  7.30800460e+00  7.30800460e+00
  9.54821361e+00  3.35209855e+01  3.35209855e+01  3.35209855e+01
  5.25348468e+01  1.29236637e+02  1.29236637e+02  1.29236637e+02
  1.99857369e+02  4.83640923e+02  4.83640923e+02  4.83640923e+02
  7.16532216e+02  1.33514091e+03  1.33514091e+03  1.33514091e+03
  2.78681580e+03  3.02887157e+03  3.02887157e+03  3.02887157e+03
  6.64894238e+03  6.64894238e+03  6.64894238e+03  9.18405002e+03
  2.55330952e+04  7.62673633e+04]
E1 = -728.415705849214  E_coul = 201.66540348666106
cycle= 2 E= -526.750302362553  delta_E= -0.000733  |g|= 0.038  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0777348
diis-c [-0.0038485   0.07610856  0.92389144]
  HOMO = -0.581831916382227  LUMO = 0.915928529575073
  mo_energy =
[-1.18573624e+02 -1.23068590e+01 -9.55654983e+00 -9.55654983e+00
 -9.55654983e+00 -1.26887878e+00 -5.81831916e-01 -5.81831916e-01
 -5.81831916e-01  9.15928530e-01  1.01644412e+00  1.01644412e+00
  1.01644412e+00  7.33221326e+00  7.33221326e+00  7.33221326e+00
  9.57435679e+00  3.35617252e+01  3.35617252e+01  3.35617252e+01
  5.25789962e+01  1.29293435e+02  1.29293435e+02  1.29293435e+02
  1.99916704e+02  4.83708880e+02  4.83708880e+02  4.83708880e+02
  7.16602349e+02  1.33521297e+03  1.33521297e+03  1.33521297e+03
  2.78689109e+03  3.02894590e+03  3.02894590e+03  3.02894590e+03
  6.64901848e+03  6.64901848e+03  6.64901848e+03  9.18412691e+03
  2.55331727e+04  7.62674411e+04]
E1 = -728.2626945351617  E_coul = 201.51233222694313
cycle= 3 E= -526.750362308219  delta_E= -5.99e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.014184
diis-c [-8.44046822e-07 -1.31084333e-03  1.49876882e-01  8.51433962e-01]
  HOMO = -0.583413922429939  LUMO = 0.91472065269335
  mo_energy =
[-1.18584183e+02 -1.23130017e+01 -9.56305991e+00 -9.56305991e+00
 -9.56305991e+00 -1.27066155e+00 -5.83413922e-01 -5.83413922e-01
 -5.83413922e-01  9.14720653e-01  1.01529843e+00  1.01529843e+00
  1.01529843e+00  7.32820956e+00  7.32820956e+00  7.32820956e+00
  9.57014114e+00  3.35551916e+01  3.35551916e+01  3.35551916e+01
  5.25720249e+01  1.29284590e+02  1.29284590e+02  1.29284590e+02
  1.99907518e+02  4.83698445e+02  4.83698445e+02  4.83698445e+02
  7.16591560e+02  1.33520191e+03  1.33520191e+03  1.33520191e+03
  2.78687938e+03  3.02893443e+03  3.02893443e+03  3.02893443e+03
  6.64900660e+03  6.64900660e+03  6.64900660e+03  9.18411481e+03
  2.55331604e+04  7.62674287e+04]
E1 = -728.2868305414496  E_coul = 201.53646608201637
cycle= 4 E= -526.750364459433  delta_E= -2.15e-06  |g|= 0.000106  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116995
diis-c [-5.11080779e-09  8.60624273e-05 -1.22364986e-02 -7.34336301e-02
  1.08558407e+00]
  HOMO = -0.58339465844673  LUMO = 0.914754925537328
  mo_energy =
[-1.18584131e+02 -1.23129303e+01 -9.56300267e+00 -9.56300267e+00
 -9.56300267e+00 -1.27061740e+00 -5.83394658e-01 -5.83394658e-01
 -5.83394658e-01  9.14754926e-01  1.01531522e+00  1.01531522e+00
  1.01531522e+00  7.32825481e+00  7.32825481e+00  7.32825481e+00
  9.57020258e+00  3.35552470e+01  3.35552470e+01  3.35552470e+01
  5.25720884e+01  1.29284647e+02  1.29284647e+02  1.29284647e+02
  1.99907575e+02  4.83698496e+02  4.83698496e+02  4.83698496e+02
  7.16591604e+02  1.33520195e+03  1.33520195e+03  1.33520195e+03
  2.78687940e+03  3.02893446e+03  3.02893446e+03  3.02893446e+03
  6.64900662e+03  6.64900662e+03  6.64900662e+03  9.18411482e+03
  2.55331604e+04  7.62674287e+04]
E1 = -728.2865849596682  E_coul = 201.53622049817508
cycle= 5 E= -526.750364461493  delta_E= -2.06e-09  |g|= 2.12e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96681e-05
diis-c [-9.50418181e-11  1.29284498e-05 -1.77039399e-03 -1.26879296e-02
  3.43385591e-02  9.80106836e-01]
  HOMO = -0.583402536867377  LUMO = 0.914751126699577
  mo_energy =
[-1.18584163e+02 -1.23129540e+01 -9.56302828e+00 -9.56302828e+00
 -9.56302828e+00 -1.27062367e+00 -5.83402537e-01 -5.83402537e-01
 -5.83402537e-01  9.14751127e-01  1.01530997e+00  1.01530997e+00
  1.01530997e+00  7.32823732e+00  7.32823732e+00  7.32823732e+00
  9.57018548e+00  3.35552222e+01  3.35552222e+01  3.35552222e+01
  5.25720630e+01  1.29284618e+02  1.29284618e+02  1.29284618e+02
  1.99907546e+02  4.83698464e+02  4.83698464e+02  4.83698464e+02
  7.16591572e+02  1.33520192e+03  1.33520192e+03  1.33520192e+03
  2.78687937e+03  3.02893443e+03  3.02893443e+03  3.02893443e+03
  6.64900659e+03  6.64900659e+03  6.64900659e+03  9.18411479e+03
  2.55331604e+04  7.62674286e+04]
E1 = -728.2866694060796  E_coul = 201.53630494452267
cycle= 6 E= -526.750364461557  delta_E= -6.39e-11  |g|= 1.86e-06  |ddm|= 2e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2866694060796  E_coul = 201.53630494452267
  HOMO = -0.583402437389165  LUMO = 0.914751556054497
  mo_energy =
[-1.18584163e+02 -1.23129534e+01 -9.56302778e+00 -9.56302778e+00
 -9.56302778e+00 -1.27062314e+00 -5.83402437e-01 -5.83402437e-01
 -5.83402437e-01  9.14751556e-01  1.01531010e+00  1.01531010e+00
  1.01531010e+00  7.32823766e+00  7.32823766e+00  7.32823766e+00
  9.57018601e+00  3.35552227e+01  3.35552227e+01  3.35552227e+01
  5.25720636e+01  1.29284618e+02  1.29284618e+02  1.29284618e+02
  1.99907546e+02  4.83698465e+02  4.83698465e+02  4.83698465e+02
  7.16591573e+02  1.33520192e+03  1.33520192e+03  1.33520192e+03
  2.78687937e+03  3.02893443e+03  3.02893443e+03  3.02893443e+03
  6.64900659e+03  6.64900659e+03  6.64900659e+03  9.18411479e+03
  2.55331604e+04  7.62674286e+04]
E1 = -728.2866666574645  E_coul = 201.53630219590653
Extra cycle  E= -526.750364461558  delta_E= -1.02e-12  |g|= 3.91e-07  |ddm|= 3.28e-06
    CPU time for scf_cycle      0.28 sec, wall time      0.25 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114778.31237546599
E1 = -728.2866666574645  E_coul = 201.53630219590653
init E= -526.750364461558
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.58340250602767  LUMO = 0.914751573863093
  mo_energy =
[-1.18584163e+02 -1.23129536e+01 -9.56302800e+00 -9.56302800e+00
 -9.56302800e+00 -1.27062314e+00 -5.83402506e-01 -5.83402506e-01
 -5.83402506e-01  9.14751574e-01  1.01531006e+00  1.01531006e+00
  1.01531006e+00  7.32823752e+00  7.32823752e+00  7.32823752e+00
  9.57018589e+00  3.35552225e+01  3.35552225e+01  3.35552225e+01
  5.25720634e+01  1.29284618e+02  1.29284618e+02  1.29284618e+02
  1.99907546e+02  4.83698465e+02  4.83698465e+02  4.83698465e+02
  7.16591572e+02  1.33520192e+03  1.33520192e+03  1.33520192e+03
  2.78687937e+03  3.02893443e+03  3.02893443e+03  3.02893443e+03
  6.64900659e+03  6.64900659e+03  6.64900659e+03  9.18411479e+03
  2.55331604e+04  7.62674286e+04]
E1 = -728.2866672821895  E_coul = 201.53630282063182
cycle= 1 E= -526.750364461558  delta_E= 3.41e-13  |g|= 8.94e-08  |ddm|= 6.16e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2866672821895  E_coul = 201.53630282063182
  HOMO = -0.583402497278713  LUMO = 0.914751595738145
  mo_energy =
[-1.18584163e+02 -1.23129536e+01 -9.56302796e+00 -9.56302796e+00
 -9.56302796e+00 -1.27062311e+00 -5.83402497e-01 -5.83402497e-01
 -5.83402497e-01  9.14751596e-01  1.01531007e+00  1.01531007e+00
  1.01531007e+00  7.32823755e+00  7.32823755e+00  7.32823755e+00
  9.57018593e+00  3.35552225e+01  3.35552225e+01  3.35552225e+01
  5.25720634e+01  1.29284618e+02  1.29284618e+02  1.29284618e+02
  1.99907546e+02  4.83698465e+02  4.83698465e+02  4.83698465e+02
  7.16591572e+02  1.33520192e+03  1.33520192e+03  1.33520192e+03
  2.78687937e+03  3.02893443e+03  3.02893443e+03  3.02893443e+03
  6.64900659e+03  6.64900659e+03  6.64900659e+03  9.18411479e+03
  2.55331604e+04  7.62674286e+04]
E1 = -728.2866670754128  E_coul = 201.53630261385536
Extra cycle  E= -526.750364461557  delta_E= 2.27e-13  |g|= 1.93e-08  |ddm|= 1.41e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61826683e+04 7.61749484e+03 3.61736380e+03 1.59726137e+03
 3.82698063e+02 1.17193431e+02 4.43943573e+01 2.08067492e+01
 6.91902147e+00 6.48614816e-01 2.80984460e+00 2.30739241e-01
 1.36278737e+03 6.64704677e+02 3.00768667e+02 3.13875603e+02
 6.17428809e+01 7.35581184e+00 2.02572655e+01 7.77229354e-01
 2.83302516e+00 2.22693187e-01]
grad_E = [-1.56533591e-06  3.86354978e-06 -1.19779843e-06  8.95372295e-05
 -4.17065669e-04 -2.55952051e-04 -1.11987511e-04  2.58828346e-04
  2.87476888e-04 -3.37645745e-04 -6.48014665e-04  6.84140285e-05
 -5.18583999e-07  4.86501024e-06  2.28194846e-05  1.96619710e-05
  2.38575199e-05 -4.38474348e-04 -1.22697260e-04  2.05972040e-03
  1.52036689e-03 -6.78138295e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:38 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6685352        1
[INPUT] 0    0    [1    /1   ]  7617.49426213        1
[INPUT] 0    0    [1    /1   ]  3617.36398312        1
[INPUT] 0    0    [1    /1   ]  1597.24802105        1
[INPUT] 0    0    [1    /1   ]  382.757554007        1
[INPUT] 0    0    [1    /1   ]  117.239718255        1
[INPUT] 0    0    [1    /1   ]  44.4170032468        1
[INPUT] 0    0    [1    /1   ]  20.7471245669        1
[INPUT] 0    0    [1    /1   ]  6.92817631014        1
[INPUT] 0    0    [1    /1   ]  0.646580043573       1
[INPUT] 0    0    [1    /1   ]  2.80993383327        1
[INPUT] 0    0    [1    /1   ]  0.229942202742       1
[INPUT] 1    0    [1    /1   ]  1362.7874503         1
[INPUT] 1    0    [1    /1   ]  664.703932442        1
[INPUT] 1    0    [1    /1   ]  300.765163902        1
[INPUT] 1    0    [1    /1   ]  313.872583878        1
[INPUT] 1    0    [1    /1   ]  61.744297169         1
[INPUT] 1    0    [1    /1   ]  7.36607078085        1
[INPUT] 1    0    [1    /1   ]  20.2527884813        1
[INPUT] 1    0    [1    /1   ]  0.778410654137       1
[INPUT] 1    0    [1    /1   ]  2.84553126079        1
[INPUT] 1    0    [1    /1   ]  0.222808075663       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668535214143, 1.0]], [0, [7617.494262134599, 1.0]], [0, [3617.3639831194714, 1.0]], [0, [1597.2480210497015, 1.0]], [0, [382.7575540070975, 1.0]], [0, [117.23971825490914, 1.0]], [0, [44.41700324680445, 1.0]], [0, [20.747124566925983, 1.0]], [0, [6.928176310140725, 1.0]], [0, [0.6465800435729994, 1.0]], [0, [2.8099338332705814, 1.0]], [0, [0.22994220274157473, 1.0]], [1, [1362.7874503017902, 1.0]], [1, [664.7039324422965, 1.0]], [1, [300.76516390171366, 1.0]], [1, [313.8725838775938, 1.0]], [1, [61.744297169001605, 1.0]], [1, [7.366070780845368, 1.0]], [1, [20.252788481290704, 1.0]], [1, [0.7784106541368738, 1.0]], [1, [2.845531260789843, 1.0]], [1, [0.22280807566306446, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66853521]
bas 1, expnt(s) = [7617.49426213]
bas 2, expnt(s) = [3617.36398312]
bas 3, expnt(s) = [1597.24802105]
bas 4, expnt(s) = [382.75755401]
bas 5, expnt(s) = [117.23971825]
bas 6, expnt(s) = [44.41700325]
bas 7, expnt(s) = [20.74712457]
bas 8, expnt(s) = [6.92817631]
bas 9, expnt(s) = [0.64658004]
bas 10, expnt(s) = [2.80993383]
bas 11, expnt(s) = [0.2299422]
bas 12, expnt(s) = [1362.7874503]
bas 13, expnt(s) = [664.70393244]
bas 14, expnt(s) = [300.7651639]
bas 15, expnt(s) = [313.87258388]
bas 16, expnt(s) = [61.74429717]
bas 17, expnt(s) = [7.36607078]
bas 18, expnt(s) = [20.25278848]
bas 19, expnt(s) = [0.77841065]
bas 20, expnt(s) = [2.84553126]
bas 21, expnt(s) = [0.22280808]
CPU time:       399.47
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826685e+04 5.20026476e+03 7.61749426e+03 2.06003276e+03
 3.61736398e+03 1.17844463e+03 1.59724802e+03 6.38328585e+02
 3.82757554e+02 2.18629042e+02 1.17239718e+02 9.00162878e+01
 4.44170032e+01 4.34687313e+01 2.07471246e+01 2.45602883e+01
 6.92817631e+00 1.07889510e+01 6.46580044e-01 1.82172050e+00
 2.80993383e+00 5.48323797e+00 2.29942203e-01 8.38936403e-01
 1.36278745e+03 2.41556957e+04 6.64703932e+02 9.84622380e+03
 3.00765164e+02 3.65400223e+03 3.13872584e+02 3.85412788e+03
 6.17442972e+01 5.04929165e+02 7.36607078e+00 3.54021186e+01
 2.02527885e+01 1.25340212e+02 7.78410654e-01 2.13302211e+00
 2.84553126e+00 1.07817335e+01 2.22808076e-01 4.46578748e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993739757301604
cond(S) = 114766.0401625142
E1 = -729.5423854124479  E_coul = 203.1754331047118
init E= -526.366952307736
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555788114006547  LUMO = 0.929489648870201
  mo_energy =
[-1.18332622e+02 -1.22068421e+01 -9.44714716e+00 -9.44714716e+00
 -9.44714716e+00 -1.24021512e+00 -5.55788114e-01 -5.55788114e-01
 -5.55788114e-01  9.29489649e-01  1.03583248e+00  1.03583248e+00
  1.03583248e+00  7.42911144e+00  7.42911144e+00  7.42911144e+00
  9.63386984e+00  3.37468770e+01  3.37468770e+01  3.37468770e+01
  5.26513942e+01  1.29536866e+02  1.29536866e+02  1.29536866e+02
  2.00002104e+02  4.84002993e+02  4.84002993e+02  4.84002993e+02
  7.16909657e+02  1.33554623e+03  1.33554623e+03  1.33554623e+03
  2.78751853e+03  3.02932994e+03  3.02932994e+03  3.02932994e+03
  6.64950417e+03  6.64950417e+03  6.64950417e+03  9.18491612e+03
  2.55340489e+04  7.62683904e+04]
E1 = -727.8352021054997  E_coul = 201.0856047621242
cycle= 1 E= -526.749597343375  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.572096
diis-c [-0.32729336  1.        ]
  HOMO = -0.591147821024366  LUMO = 0.903345528823494
  mo_energy =
[-1.18642489e+02 -1.23455972e+01 -9.59698165e+00 -9.59698165e+00
 -9.59698165e+00 -1.28002771e+00 -5.91147821e-01 -5.91147821e-01
 -5.91147821e-01  9.03345529e-01  1.01103781e+00  1.01103781e+00
  1.01103781e+00  7.33691253e+00  7.33691253e+00  7.33691253e+00
  9.53898316e+00  3.35912003e+01  3.35912003e+01  3.35912003e+01
  5.24880524e+01  1.29306757e+02  1.29306757e+02  1.29306757e+02
  1.99762477e+02  4.83694364e+02  4.83694364e+02  4.83694364e+02
  7.16562197e+02  1.33518086e+03  1.33518086e+03  1.33518086e+03
  2.78702100e+03  3.02889867e+03  3.02889867e+03  3.02889867e+03
  6.64895936e+03  6.64895936e+03  6.64895936e+03  9.18429709e+03
  2.55333349e+04  7.62675858e+04]
E1 = -728.4147162856398  E_coul = 201.66438480649984
cycle= 2 E= -526.75033147914  delta_E= -0.000734  |g|= 0.038  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0777824
diis-c [-0.00385027  0.07618685  0.92381315]
  HOMO = -0.581890198011626  LUMO = 0.910950622334839
  mo_energy =
[-1.18573687e+02 -1.23069152e+01 -9.55661785e+00 -9.55661785e+00
 -9.55661785e+00 -1.26893954e+00 -5.81890198e-01 -5.81890198e-01
 -5.81890198e-01  9.10950622e-01  1.01790638e+00  1.01790638e+00
  1.01790638e+00  7.36118345e+00  7.36118345e+00  7.36118345e+00
  9.56514310e+00  3.36319639e+01  3.36319639e+01  3.36319639e+01
  5.25322076e+01  1.29363571e+02  1.29363571e+02  1.29363571e+02
  1.99821831e+02  4.83762341e+02  4.83762341e+02  4.83762341e+02
  7.16632353e+02  1.33525294e+03  1.33525294e+03  1.33525294e+03
  2.78709630e+03  3.02897302e+03  3.02897302e+03  3.02897302e+03
  6.64903548e+03  6.64903548e+03  6.64903548e+03  9.18437400e+03
  2.55334124e+04  7.62676636e+04]
E1 = -728.2616490733752  E_coul = 201.51125758851066
cycle= 3 E= -526.750391484865  delta_E= -6e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141864
diis-c [-8.46014104e-07 -1.31086001e-03  1.49817232e-01  8.51493628e-01]
  HOMO = -0.583472421966931  LUMO = 0.909747498820084
  mo_energy =
[-1.18584242e+02 -1.23130568e+01 -9.56312692e+00 -9.56312692e+00
 -9.56312692e+00 -1.27072226e+00 -5.83472422e-01 -5.83472422e-01
 -5.83472422e-01  9.09747499e-01  1.01675810e+00  1.01675810e+00
  1.01675810e+00  7.35717205e+00  7.35717205e+00  7.35717205e+00
  9.56092783e+00  3.36254305e+01  3.36254305e+01  3.36254305e+01
  5.25252396e+01  1.29354728e+02  1.29354728e+02  1.29354728e+02
  1.99812647e+02  4.83751908e+02  4.83751908e+02  4.83751908e+02
  7.16621566e+02  1.33524188e+03  1.33524188e+03  1.33524188e+03
  2.78708460e+03  3.02896155e+03  3.02896155e+03  3.02896155e+03
  6.64902360e+03  6.64902360e+03  6.64902360e+03  9.18436190e+03
  2.55334001e+04  7.62676512e+04]
E1 = -728.2857781836456  E_coul = 201.53538454818636
cycle= 4 E= -526.750393635459  delta_E= -2.15e-06  |g|= 0.000107  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000117656
diis-c [-5.11590653e-09  8.65145480e-05 -1.22937718e-02 -7.38463409e-02
  1.08605360e+00]
  HOMO = -0.583453316962796  LUMO = 0.909781597914917
  mo_energy =
[-1.18584192e+02 -1.23129858e+01 -9.56307009e+00 -9.56307009e+00
 -9.56307009e+00 -1.27067821e+00 -5.83453317e-01 -5.83453317e-01
 -5.83453317e-01  9.09781598e-01  1.01677481e+00  1.01677481e+00
  1.01677481e+00  7.35721706e+00  7.35721706e+00  7.35721706e+00
  9.56098904e+00  3.36254856e+01  3.36254856e+01  3.36254856e+01
  5.25253028e+01  1.29354784e+02  1.29354784e+02  1.29354784e+02
  1.99812704e+02  4.83751958e+02  4.83751958e+02  4.83751958e+02
  7.16621610e+02  1.33524192e+03  1.33524192e+03  1.33524192e+03
  2.78708462e+03  3.02896158e+03  3.02896158e+03  3.02896158e+03
  6.64902362e+03  6.64902362e+03  6.64902362e+03  9.18436191e+03
  2.55334001e+04  7.62676512e+04]
E1 = -728.2855334734711  E_coul = 201.53513983593913
cycle= 5 E= -526.750393637532  delta_E= -2.07e-09  |g|= 2.12e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96564e-05
diis-c [-9.54983707e-11  1.29050735e-05 -1.76663159e-03 -1.26714187e-02
  3.42578623e-02  9.80167283e-01]
  HOMO = -0.583461209186986  LUMO = 0.909777807619123
  mo_energy =
[-1.18584224e+02 -1.23130095e+01 -9.56309573e+00 -9.56309573e+00
 -9.56309573e+00 -1.27068448e+00 -5.83461209e-01 -5.83461209e-01
 -5.83461209e-01  9.09777808e-01  1.01676954e+00  1.01676954e+00
  1.01676954e+00  7.35719951e+00  7.35719951e+00  7.35719951e+00
  9.56097192e+00  3.36254607e+01  3.36254607e+01  3.36254607e+01
  5.25252773e+01  1.29354755e+02  1.29354755e+02  1.29354755e+02
  1.99812675e+02  4.83751927e+02  4.83751927e+02  4.83751927e+02
  7.16621577e+02  1.33524189e+03  1.33524189e+03  1.33524189e+03
  2.78708459e+03  3.02896155e+03  3.02896155e+03  3.02896155e+03
  6.64902359e+03  6.64902359e+03  6.64902359e+03  9.18436188e+03
  2.55334001e+04  7.62676511e+04]
E1 = -728.2856179243125  E_coul = 201.53522428671783
cycle= 6 E= -526.750393637595  delta_E= -6.28e-11  |g|= 1.87e-06  |ddm|= 2e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2856179243125  E_coul = 201.53522428671783
  HOMO = -0.583461107404224  LUMO = 0.909778238059494
  mo_energy =
[-1.18584223e+02 -1.23130089e+01 -9.56309521e+00 -9.56309521e+00
 -9.56309521e+00 -1.27068395e+00 -5.83461107e-01 -5.83461107e-01
 -5.83461107e-01  9.09778238e-01  1.01676968e+00  1.01676968e+00
  1.01676968e+00  7.35719987e+00  7.35719987e+00  7.35719987e+00
  9.56097245e+00  3.36254612e+01  3.36254612e+01  3.36254612e+01
  5.25252779e+01  1.29354756e+02  1.29354756e+02  1.29354756e+02
  1.99812675e+02  4.83751928e+02  4.83751928e+02  4.83751928e+02
  7.16621578e+02  1.33524189e+03  1.33524189e+03  1.33524189e+03
  2.78708459e+03  3.02896155e+03  3.02896155e+03  3.02896155e+03
  6.64902359e+03  6.64902359e+03  6.64902359e+03  9.18436188e+03
  2.55334001e+04  7.62676511e+04]
E1 = -728.2856151230546  E_coul = 201.53522148545895
Extra cycle  E= -526.750393637596  delta_E= -1.02e-12  |g|= 3.93e-07  |ddm|= 3.3e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
exp = [2.61826685e+04 7.61749426e+03 3.61736398e+03 1.59724802e+03
 3.82757554e+02 1.17239718e+02 4.44170032e+01 2.07471246e+01
 6.92817631e+00 6.46580044e-01 2.80993383e+00 2.29942203e-01
 1.36278745e+03 6.64703932e+02 3.00765164e+02 3.13872584e+02
 6.17442972e+01 7.36607078e+00 2.02527885e+01 7.78410654e-01
 2.84553126e+00 2.22808076e-01]
E = -526.7503936375957
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:38 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6685352        1
[INPUT] 0    0    [1    /1   ]  7617.49426213        1
[INPUT] 0    0    [1    /1   ]  3617.36398312        1
[INPUT] 0    0    [1    /1   ]  1597.24802105        1
[INPUT] 0    0    [1    /1   ]  382.757554007        1
[INPUT] 0    0    [1    /1   ]  117.239718255        1
[INPUT] 0    0    [1    /1   ]  44.4170032468        1
[INPUT] 0    0    [1    /1   ]  20.7471245669        1
[INPUT] 0    0    [1    /1   ]  6.92817631014        1
[INPUT] 0    0    [1    /1   ]  0.646580043573       1
[INPUT] 0    0    [1    /1   ]  2.80993383327        1
[INPUT] 0    0    [1    /1   ]  0.229942202742       1
[INPUT] 1    0    [1    /1   ]  1362.7874503         1
[INPUT] 1    0    [1    /1   ]  664.703932442        1
[INPUT] 1    0    [1    /1   ]  300.765163902        1
[INPUT] 1    0    [1    /1   ]  313.872583878        1
[INPUT] 1    0    [1    /1   ]  61.744297169         1
[INPUT] 1    0    [1    /1   ]  7.36607078085        1
[INPUT] 1    0    [1    /1   ]  20.2527884813        1
[INPUT] 1    0    [1    /1   ]  0.778410654137       1
[INPUT] 1    0    [1    /1   ]  2.84553126079        1
[INPUT] 1    0    [1    /1   ]  0.222808075663       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.668535214143, 1.0]], [0, [7617.494262134599, 1.0]], [0, [3617.3639831194714, 1.0]], [0, [1597.2480210497015, 1.0]], [0, [382.7575540070975, 1.0]], [0, [117.23971825490914, 1.0]], [0, [44.41700324680445, 1.0]], [0, [20.747124566925983, 1.0]], [0, [6.928176310140725, 1.0]], [0, [0.6465800435729994, 1.0]], [0, [2.8099338332705814, 1.0]], [0, [0.22994220274157473, 1.0]], [1, [1362.7874503017902, 1.0]], [1, [664.7039324422965, 1.0]], [1, [300.76516390171366, 1.0]], [1, [313.8725838775938, 1.0]], [1, [61.744297169001605, 1.0]], [1, [7.366070780845368, 1.0]], [1, [20.252788481290704, 1.0]], [1, [0.7784106541368738, 1.0]], [1, [2.845531260789843, 1.0]], [1, [0.22280807566306446, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66853521]
bas 1, expnt(s) = [7617.49426213]
bas 2, expnt(s) = [3617.36398312]
bas 3, expnt(s) = [1597.24802105]
bas 4, expnt(s) = [382.75755401]
bas 5, expnt(s) = [117.23971825]
bas 6, expnt(s) = [44.41700325]
bas 7, expnt(s) = [20.74712457]
bas 8, expnt(s) = [6.92817631]
bas 9, expnt(s) = [0.64658004]
bas 10, expnt(s) = [2.80993383]
bas 11, expnt(s) = [0.2299422]
bas 12, expnt(s) = [1362.7874503]
bas 13, expnt(s) = [664.70393244]
bas 14, expnt(s) = [300.7651639]
bas 15, expnt(s) = [313.87258388]
bas 16, expnt(s) = [61.74429717]
bas 17, expnt(s) = [7.36607078]
bas 18, expnt(s) = [20.25278848]
bas 19, expnt(s) = [0.77841065]
bas 20, expnt(s) = [2.84553126]
bas 21, expnt(s) = [0.22280808]
CPU time:       399.95
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826685e+04 5.20026476e+03 7.61749426e+03 2.06003276e+03
 3.61736398e+03 1.17844463e+03 1.59724802e+03 6.38328585e+02
 3.82757554e+02 2.18629042e+02 1.17239718e+02 9.00162878e+01
 4.44170032e+01 4.34687313e+01 2.07471246e+01 2.45602883e+01
 6.92817631e+00 1.07889510e+01 6.46580044e-01 1.82172050e+00
 2.80993383e+00 5.48323797e+00 2.29942203e-01 8.38936403e-01
 1.36278745e+03 2.41556957e+04 6.64703932e+02 9.84622380e+03
 3.00765164e+02 3.65400223e+03 3.13872584e+02 3.85412788e+03
 6.17442972e+01 5.04929165e+02 7.36607078e+00 3.54021186e+01
 2.02527885e+01 1.25340212e+02 7.78410654e-01 2.13302211e+00
 2.84553126e+00 1.07817335e+01 2.22808076e-01 4.46578748e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993739757301604
cond(S) = 114766.0401625142
E1 = -729.5423854124479  E_coul = 203.1754331047118
init E= -526.366952307736
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555788114006547  LUMO = 0.929489648870201
  mo_energy =
[-1.18332622e+02 -1.22068421e+01 -9.44714716e+00 -9.44714716e+00
 -9.44714716e+00 -1.24021512e+00 -5.55788114e-01 -5.55788114e-01
 -5.55788114e-01  9.29489649e-01  1.03583248e+00  1.03583248e+00
  1.03583248e+00  7.42911144e+00  7.42911144e+00  7.42911144e+00
  9.63386984e+00  3.37468770e+01  3.37468770e+01  3.37468770e+01
  5.26513942e+01  1.29536866e+02  1.29536866e+02  1.29536866e+02
  2.00002104e+02  4.84002993e+02  4.84002993e+02  4.84002993e+02
  7.16909657e+02  1.33554623e+03  1.33554623e+03  1.33554623e+03
  2.78751853e+03  3.02932994e+03  3.02932994e+03  3.02932994e+03
  6.64950417e+03  6.64950417e+03  6.64950417e+03  9.18491612e+03
  2.55340489e+04  7.62683904e+04]
E1 = -727.8352021054997  E_coul = 201.0856047621242
cycle= 1 E= -526.749597343375  delta_E= -0.383  |g|= 0.187  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.572096
diis-c [-0.32729336  1.        ]
  HOMO = -0.591147821024366  LUMO = 0.903345528823494
  mo_energy =
[-1.18642489e+02 -1.23455972e+01 -9.59698165e+00 -9.59698165e+00
 -9.59698165e+00 -1.28002771e+00 -5.91147821e-01 -5.91147821e-01
 -5.91147821e-01  9.03345529e-01  1.01103781e+00  1.01103781e+00
  1.01103781e+00  7.33691253e+00  7.33691253e+00  7.33691253e+00
  9.53898316e+00  3.35912003e+01  3.35912003e+01  3.35912003e+01
  5.24880524e+01  1.29306757e+02  1.29306757e+02  1.29306757e+02
  1.99762477e+02  4.83694364e+02  4.83694364e+02  4.83694364e+02
  7.16562197e+02  1.33518086e+03  1.33518086e+03  1.33518086e+03
  2.78702100e+03  3.02889867e+03  3.02889867e+03  3.02889867e+03
  6.64895936e+03  6.64895936e+03  6.64895936e+03  9.18429709e+03
  2.55333349e+04  7.62675858e+04]
E1 = -728.4147162856398  E_coul = 201.66438480649984
cycle= 2 E= -526.75033147914  delta_E= -0.000734  |g|= 0.038  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0777824
diis-c [-0.00385027  0.07618685  0.92381315]
  HOMO = -0.581890198011626  LUMO = 0.910950622334839
  mo_energy =
[-1.18573687e+02 -1.23069152e+01 -9.55661785e+00 -9.55661785e+00
 -9.55661785e+00 -1.26893954e+00 -5.81890198e-01 -5.81890198e-01
 -5.81890198e-01  9.10950622e-01  1.01790638e+00  1.01790638e+00
  1.01790638e+00  7.36118345e+00  7.36118345e+00  7.36118345e+00
  9.56514310e+00  3.36319639e+01  3.36319639e+01  3.36319639e+01
  5.25322076e+01  1.29363571e+02  1.29363571e+02  1.29363571e+02
  1.99821831e+02  4.83762341e+02  4.83762341e+02  4.83762341e+02
  7.16632353e+02  1.33525294e+03  1.33525294e+03  1.33525294e+03
  2.78709630e+03  3.02897302e+03  3.02897302e+03  3.02897302e+03
  6.64903548e+03  6.64903548e+03  6.64903548e+03  9.18437400e+03
  2.55334124e+04  7.62676636e+04]
E1 = -728.2616490733752  E_coul = 201.51125758851066
cycle= 3 E= -526.750391484865  delta_E= -6e-05  |g|= 0.00667  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141864
diis-c [-8.46014104e-07 -1.31086001e-03  1.49817232e-01  8.51493628e-01]
  HOMO = -0.583472421966931  LUMO = 0.909747498820084
  mo_energy =
[-1.18584242e+02 -1.23130568e+01 -9.56312692e+00 -9.56312692e+00
 -9.56312692e+00 -1.27072226e+00 -5.83472422e-01 -5.83472422e-01
 -5.83472422e-01  9.09747499e-01  1.01675810e+00  1.01675810e+00
  1.01675810e+00  7.35717205e+00  7.35717205e+00  7.35717205e+00
  9.56092783e+00  3.36254305e+01  3.36254305e+01  3.36254305e+01
  5.25252396e+01  1.29354728e+02  1.29354728e+02  1.29354728e+02
  1.99812647e+02  4.83751908e+02  4.83751908e+02  4.83751908e+02
  7.16621566e+02  1.33524188e+03  1.33524188e+03  1.33524188e+03
  2.78708460e+03  3.02896155e+03  3.02896155e+03  3.02896155e+03
  6.64902360e+03  6.64902360e+03  6.64902360e+03  9.18436190e+03
  2.55334001e+04  7.62676512e+04]
E1 = -728.2857781836456  E_coul = 201.53538454818636
cycle= 4 E= -526.750393635459  delta_E= -2.15e-06  |g|= 0.000107  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000117656
diis-c [-5.11590653e-09  8.65145480e-05 -1.22937718e-02 -7.38463409e-02
  1.08605360e+00]
  HOMO = -0.583453316962796  LUMO = 0.909781597914917
  mo_energy =
[-1.18584192e+02 -1.23129858e+01 -9.56307009e+00 -9.56307009e+00
 -9.56307009e+00 -1.27067821e+00 -5.83453317e-01 -5.83453317e-01
 -5.83453317e-01  9.09781598e-01  1.01677481e+00  1.01677481e+00
  1.01677481e+00  7.35721706e+00  7.35721706e+00  7.35721706e+00
  9.56098904e+00  3.36254856e+01  3.36254856e+01  3.36254856e+01
  5.25253028e+01  1.29354784e+02  1.29354784e+02  1.29354784e+02
  1.99812704e+02  4.83751958e+02  4.83751958e+02  4.83751958e+02
  7.16621610e+02  1.33524192e+03  1.33524192e+03  1.33524192e+03
  2.78708462e+03  3.02896158e+03  3.02896158e+03  3.02896158e+03
  6.64902362e+03  6.64902362e+03  6.64902362e+03  9.18436191e+03
  2.55334001e+04  7.62676512e+04]
E1 = -728.2855334734711  E_coul = 201.53513983593913
cycle= 5 E= -526.750393637532  delta_E= -2.07e-09  |g|= 2.12e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96564e-05
diis-c [-9.54983707e-11  1.29050735e-05 -1.76663159e-03 -1.26714187e-02
  3.42578623e-02  9.80167283e-01]
  HOMO = -0.583461209186986  LUMO = 0.909777807619123
  mo_energy =
[-1.18584224e+02 -1.23130095e+01 -9.56309573e+00 -9.56309573e+00
 -9.56309573e+00 -1.27068448e+00 -5.83461209e-01 -5.83461209e-01
 -5.83461209e-01  9.09777808e-01  1.01676954e+00  1.01676954e+00
  1.01676954e+00  7.35719951e+00  7.35719951e+00  7.35719951e+00
  9.56097192e+00  3.36254607e+01  3.36254607e+01  3.36254607e+01
  5.25252773e+01  1.29354755e+02  1.29354755e+02  1.29354755e+02
  1.99812675e+02  4.83751927e+02  4.83751927e+02  4.83751927e+02
  7.16621577e+02  1.33524189e+03  1.33524189e+03  1.33524189e+03
  2.78708459e+03  3.02896155e+03  3.02896155e+03  3.02896155e+03
  6.64902359e+03  6.64902359e+03  6.64902359e+03  9.18436188e+03
  2.55334001e+04  7.62676511e+04]
E1 = -728.2856179243125  E_coul = 201.53522428671783
cycle= 6 E= -526.750393637595  delta_E= -6.28e-11  |g|= 1.87e-06  |ddm|= 2e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2856179243125  E_coul = 201.53522428671783
  HOMO = -0.583461107404224  LUMO = 0.909778238059494
  mo_energy =
[-1.18584223e+02 -1.23130089e+01 -9.56309521e+00 -9.56309521e+00
 -9.56309521e+00 -1.27068395e+00 -5.83461107e-01 -5.83461107e-01
 -5.83461107e-01  9.09778238e-01  1.01676968e+00  1.01676968e+00
  1.01676968e+00  7.35719987e+00  7.35719987e+00  7.35719987e+00
  9.56097245e+00  3.36254612e+01  3.36254612e+01  3.36254612e+01
  5.25252779e+01  1.29354756e+02  1.29354756e+02  1.29354756e+02
  1.99812675e+02  4.83751928e+02  4.83751928e+02  4.83751928e+02
  7.16621578e+02  1.33524189e+03  1.33524189e+03  1.33524189e+03
  2.78708459e+03  3.02896155e+03  3.02896155e+03  3.02896155e+03
  6.64902359e+03  6.64902359e+03  6.64902359e+03  9.18436188e+03
  2.55334001e+04  7.62676511e+04]
E1 = -728.2856151230546  E_coul = 201.53522148545895
Extra cycle  E= -526.750393637596  delta_E= -1.02e-12  |g|= 3.93e-07  |ddm|= 3.3e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114766.0401625142
E1 = -728.2856151230546  E_coul = 201.53522148545895
init E= -526.750393637596
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583461177264153  LUMO = 0.909778255053005
  mo_energy =
[-1.18584223e+02 -1.23130091e+01 -9.56309544e+00 -9.56309544e+00
 -9.56309544e+00 -1.27068395e+00 -5.83461177e-01 -5.83461177e-01
 -5.83461177e-01  9.09778255e-01  1.01676964e+00  1.01676964e+00
  1.01676964e+00  7.35719972e+00  7.35719972e+00  7.35719972e+00
  9.56097233e+00  3.36254610e+01  3.36254610e+01  3.36254610e+01
  5.25252777e+01  1.29354755e+02  1.29354755e+02  1.29354755e+02
  1.99812675e+02  4.83751927e+02  4.83751927e+02  4.83751927e+02
  7.16621578e+02  1.33524189e+03  1.33524189e+03  1.33524189e+03
  2.78708459e+03  3.02896155e+03  3.02896155e+03  3.02896155e+03
  6.64902359e+03  6.64902359e+03  6.64902359e+03  9.18436188e+03
  2.55334001e+04  7.62676511e+04]
E1 = -728.2856157597785  E_coul = 201.5352221221825
cycle= 1 E= -526.750393637596  delta_E= -2.27e-13  |g|= 8.99e-08  |ddm|= 6.17e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2856157597785  E_coul = 201.5352221221825
  HOMO = -0.583461168328762  LUMO = 0.909778277047005
  mo_energy =
[-1.18584223e+02 -1.23130090e+01 -9.56309539e+00 -9.56309539e+00
 -9.56309539e+00 -1.27068392e+00 -5.83461168e-01 -5.83461168e-01
 -5.83461168e-01  9.09778277e-01  1.01676965e+00  1.01676965e+00
  1.01676965e+00  7.35719975e+00  7.35719975e+00  7.35719975e+00
  9.56097237e+00  3.36254611e+01  3.36254611e+01  3.36254611e+01
  5.25252778e+01  1.29354755e+02  1.29354755e+02  1.29354755e+02
  1.99812675e+02  4.83751927e+02  4.83751927e+02  4.83751927e+02
  7.16621578e+02  1.33524189e+03  1.33524189e+03  1.33524189e+03
  2.78708459e+03  3.02896155e+03  3.02896155e+03  3.02896155e+03
  6.64902359e+03  6.64902359e+03  6.64902359e+03  9.18436188e+03
  2.55334001e+04  7.62676511e+04]
E1 = -728.2856155490366  E_coul = 201.53522191144052
Extra cycle  E= -526.750393637596  delta_E= -1.14e-13  |g|= 1.94e-08  |ddm|= 1.41e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.44 sec
exp = [2.61826685e+04 7.61749426e+03 3.61736398e+03 1.59724802e+03
 3.82757554e+02 1.17239718e+02 4.44170032e+01 2.07471246e+01
 6.92817631e+00 6.46580044e-01 2.80993383e+00 2.29942203e-01
 1.36278745e+03 6.64703932e+02 3.00765164e+02 3.13872584e+02
 6.17442972e+01 7.36607078e+00 2.02527885e+01 7.78410654e-01
 2.84553126e+00 2.22808076e-01]
grad_E = [-1.56511681e-06  3.86083222e-06 -1.20061271e-06  8.94520518e-05
 -4.16154971e-04 -2.60589288e-04 -1.02719436e-04  2.50982727e-04
  3.90159497e-04 -5.87232052e-04 -8.78954029e-04 -1.10775977e-04
 -5.20437389e-07  4.83912001e-06  2.26644436e-05  1.95286370e-05
  3.90964294e-05 -7.47509500e-04 -1.82170604e-04  3.43452974e-03
  2.58748586e-03 -1.12568588e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:43 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6691631        1
[INPUT] 0    0    [1    /1   ]  7617.49272162        1
[INPUT] 0    0    [1    /1   ]  3617.36447296        1
[INPUT] 0    0    [1    /1   ]  1597.21248254        1
[INPUT] 0    0    [1    /1   ]  382.916103978        1
[INPUT] 0    0    [1    /1   ]  117.367722762        1
[INPUT] 0    0    [1    /1   ]  44.4580377166        1
[INPUT] 0    0    [1    /1   ]  20.5845680714        1
[INPUT] 0    0    [1    /1   ]  6.94053650008        1
[INPUT] 0    0    [1    /1   ]  0.64338352361        1
[INPUT] 0    0    [1    /1   ]  2.80916452779        1
[INPUT] 0    0    [1    /1   ]  0.228670800618       1
[INPUT] 1    0    [1    /1   ]  1362.78765698        1
[INPUT] 1    0    [1    /1   ]  664.70195547         1
[INPUT] 1    0    [1    /1   ]  300.755862908        1
[INPUT] 1    0    [1    /1   ]  313.864569733        1
[INPUT] 1    0    [1    /1   ]  61.7468731359        1
[INPUT] 1    0    [1    /1   ]  7.3843937722         1
[INPUT] 1    0    [1    /1   ]  20.248592897         1
[INPUT] 1    0    [1    /1   ]  0.78041461257        1
[INPUT] 1    0    [1    /1   ]  2.86638097917        1
[INPUT] 1    0    [1    /1   ]  0.223024268383       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.66916313207, 1.0]], [0, [7617.492721619045, 1.0]], [0, [3617.3644729629714, 1.0]], [0, [1597.2124825385354, 1.0]], [0, [382.9161039779055, 1.0]], [0, [117.36772276240703, 1.0]], [0, [44.45803771655456, 1.0]], [0, [20.58456807137613, 1.0]], [0, [6.940536500075525, 1.0]], [0, [0.6433835236104355, 1.0]], [0, [2.8091645277879347, 1.0]], [0, [0.22867080061785167, 1.0]], [1, [1362.7876569813338, 1.0]], [1, [664.7019554695089, 1.0]], [1, [300.7558629078463, 1.0]], [1, [313.86456973303, 1.0]], [1, [61.74687313587123, 1.0]], [1, [7.384393772197307, 1.0]], [1, [20.24859289695124, 1.0]], [1, [0.7804146125699813, 1.0]], [1, [2.8663809791686314, 1.0]], [1, [0.22302426838277353, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66916313]
bas 1, expnt(s) = [7617.49272162]
bas 2, expnt(s) = [3617.36447296]
bas 3, expnt(s) = [1597.21248254]
bas 4, expnt(s) = [382.91610398]
bas 5, expnt(s) = [117.36772276]
bas 6, expnt(s) = [44.45803772]
bas 7, expnt(s) = [20.58456807]
bas 8, expnt(s) = [6.9405365]
bas 9, expnt(s) = [0.64338352]
bas 10, expnt(s) = [2.80916453]
bas 11, expnt(s) = [0.2286708]
bas 12, expnt(s) = [1362.78765698]
bas 13, expnt(s) = [664.70195547]
bas 14, expnt(s) = [300.75586291]
bas 15, expnt(s) = [313.86456973]
bas 16, expnt(s) = [61.74687314]
bas 17, expnt(s) = [7.38439377]
bas 18, expnt(s) = [20.2485929]
bas 19, expnt(s) = [0.78041461]
bas 20, expnt(s) = [2.86638098]
bas 21, expnt(s) = [0.22302427]
CPU time:       405.61
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826692e+04 5.20026485e+03 7.61749272e+03 2.06003244e+03
 3.61736447e+03 1.17844475e+03 1.59721248e+03 6.38317933e+02
 3.82916104e+02 2.18696961e+02 1.17367723e+02 9.00899888e+01
 4.44580377e+01 4.34988466e+01 2.05845681e+01 2.44158216e+01
 6.94053650e+00 1.08033838e+01 6.43383524e-01 1.81496174e+00
 2.80916453e+00 5.48211203e+00 2.28670801e-01 8.35454992e-01
 1.36278766e+03 2.41557003e+04 6.64701955e+02 9.84618719e+03
 3.00755863e+02 3.65386099e+03 3.13864570e+02 3.85400487e+03
 6.17468731e+01 5.04955498e+02 7.38439377e+00 3.55122306e+01
 2.02485929e+01 1.25307756e+02 7.80414613e-01 2.13988844e+00
 2.86638098e+00 1.08805734e+01 2.23024268e-01 4.47120463e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993687957555544
cond(S) = 114727.89593865165
E1 = -729.5425292825536  E_coul = 203.17553263593246
init E= -526.366996646621
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555787650751094  LUMO = 0.921502201763043
  mo_energy =
[-1.18332666e+02 -1.22068284e+01 -9.44713253e+00 -9.44713253e+00
 -9.44713253e+00 -1.24021943e+00 -5.55787651e-01 -5.55787651e-01
 -5.55787651e-01  9.21502202e-01  1.03852973e+00  1.03852973e+00
  1.03852973e+00  7.47836061e+00  7.47836061e+00  7.47836061e+00
  9.61302172e+00  3.38692424e+01  3.38692424e+01  3.38692424e+01
  5.24872757e+01  1.29667381e+02  1.29667381e+02  1.29667381e+02
  1.99659622e+02  4.84105218e+02  4.84105218e+02  4.84105218e+02
  7.16877604e+02  1.33561817e+03  1.33561817e+03  1.33561817e+03
  2.78796113e+03  3.02937047e+03  3.02937047e+03  3.02937047e+03
  6.64952070e+03  6.64952070e+03  6.64952070e+03  9.18547852e+03
  2.55345967e+04  7.62688986e+04]
E1 = -727.8334888775375  E_coul = 201.0838163880093
cycle= 1 E= -526.749672489528  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.572164
diis-c [-0.32737213  1.        ]
  HOMO = -0.591240550286575  LUMO = 0.895473534729901
  mo_energy =
[-1.18642611e+02 -1.23456950e+01 -9.59709383e+00 -9.59709383e+00
 -9.59709383e+00 -1.28012542e+00 -5.91240550e-01 -5.91240550e-01
 -5.91240550e-01  8.95473535e-01  1.01357975e+00  1.01357975e+00
  1.01357975e+00  7.38570737e+00  7.38570737e+00  7.38570737e+00
  9.51806399e+00  3.37134140e+01  3.37134140e+01  3.37134140e+01
  5.23240165e+01  1.29437217e+02  1.29437217e+02  1.29437217e+02
  1.99419928e+02  4.83796521e+02  4.83796521e+02  4.83796521e+02
  7.16529994e+02  1.33525273e+03  1.33525273e+03  1.33525273e+03
  2.78746351e+03  3.02893913e+03  3.02893913e+03  3.02893913e+03
  6.64897582e+03  6.64897582e+03  6.64897582e+03  9.18485942e+03
  2.55338826e+04  7.62680939e+04]
E1 = -728.4133851711182  E_coul = 201.66297740221185
cycle= 2 E= -526.750407768906  delta_E= -0.000735  |g|= 0.0381  |ddm|= 0.0534
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0778459
diis-c [-0.0038508   0.07632762  0.92367238]
  HOMO = -0.581976343673509  LUMO = 0.903036600524976
  mo_energy =
[-1.18573788e+02 -1.23069907e+01 -9.55670859e+00 -9.55670859e+00
 -9.55670859e+00 -1.26902897e+00 -5.81976344e-01 -5.81976344e-01
 -5.81976344e-01  9.03036601e-01  1.02047798e+00  1.02047798e+00
  1.02047798e+00  7.41007634e+00  7.41007634e+00  7.41007634e+00
  9.54423300e+00  3.37542103e+01  3.37542103e+01  3.37542103e+01
  5.23681470e+01  1.29494045e+02  1.29494045e+02  1.29494045e+02
  1.99479300e+02  4.83864516e+02  4.83864516e+02  4.83864516e+02
  7.16600175e+02  1.33532483e+03  1.33532483e+03  1.33532483e+03
  2.78753883e+03  3.02901350e+03  3.02901350e+03  3.02901350e+03
  6.64905196e+03  6.64905196e+03  6.64905196e+03  9.18493634e+03
  2.55339601e+04  7.62681717e+04]
E1 = -728.2602655712487  E_coul = 201.50979772244506
cycle= 3 E= -526.750467848804  delta_E= -6.01e-05  |g|= 0.00666  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.014186
diis-c [-8.49365478e-07 -1.31071199e-03  1.49701911e-01  8.51608801e-01]
  HOMO = -0.583558330688494  LUMO = 0.901841657792292
  mo_energy =
[-1.18584337e+02 -1.23131284e+01 -9.56321386e+00 -9.56321386e+00
 -9.56321386e+00 -1.27081088e+00 -5.83558331e-01 -5.83558331e-01
 -5.83558331e-01  9.01841658e-01  1.01932576e+00  1.01932576e+00
  1.01932576e+00  7.40605342e+00  7.40605342e+00  7.40605342e+00
  9.54002164e+00  3.37476791e+01  3.37476791e+01  3.37476791e+01
  5.23611904e+01  1.29485209e+02  1.29485209e+02  1.29485209e+02
  1.99470123e+02  4.83854090e+02  4.83854090e+02  4.83854090e+02
  7.16589396e+02  1.33531378e+03  1.33531378e+03  1.33531378e+03
  2.78752714e+03  3.02900203e+03  3.02900203e+03  3.02900203e+03
  6.64904009e+03  6.64904009e+03  6.64904009e+03  9.18492425e+03
  2.55339478e+04  7.62681593e+04]
E1 = -728.2843744569293  E_coul = 201.53390446001086
cycle= 4 E= -526.750469996918  delta_E= -2.15e-06  |g|= 0.000107  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000118794
diis-c [-5.12737241e-09  8.72966269e-05 -1.23929070e-02 -7.45662743e-02
  1.08687188e+00]
  HOMO = -0.583539488239992  LUMO = 0.901875477850395
  mo_energy =
[-1.18584287e+02 -1.23130579e+01 -9.56315772e+00 -9.56315772e+00
 -9.56315772e+00 -1.27076699e+00 -5.83539488e-01 -5.83539488e-01
 -5.83539488e-01  9.01875478e-01  1.01934234e+00  1.01934234e+00
  1.01934234e+00  7.40609802e+00  7.40609802e+00  7.40609802e+00
  9.54008245e+00  3.37477335e+01  3.37477335e+01  3.37477335e+01
  5.23612529e+01  1.29485265e+02  1.29485265e+02  1.29485265e+02
  1.99470180e+02  4.83854140e+02  4.83854140e+02  4.83854140e+02
  7.16589438e+02  1.33531382e+03  1.33531382e+03  1.33531382e+03
  2.78752716e+03  3.02900207e+03  3.02900207e+03  3.02900207e+03
  6.64904010e+03  6.64904010e+03  6.64904010e+03  9.18492426e+03
  2.55339478e+04  7.62681593e+04]
E1 = -728.2841312187162  E_coul = 201.53366121970296
cycle= 5 E= -526.750469999013  delta_E= -2.09e-09  |g|= 2.12e-05  |ddm|= 0.000175
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96319e-05
diis-c [-9.62868966e-11  1.28648527e-05 -1.75986347e-03 -1.26428466e-02
  3.41302295e-02  9.80259616e-01]
  HOMO = -0.583547403251252  LUMO = 0.901871700702774
  mo_energy =
[-1.18584319e+02 -1.23130816e+01 -9.56318340e+00 -9.56318340e+00
 -9.56318340e+00 -1.27077329e+00 -5.83547403e-01 -5.83547403e-01
 -5.83547403e-01  9.01871701e-01  1.01933703e+00  1.01933703e+00
  1.01933703e+00  7.40608039e+00  7.40608039e+00  7.40608039e+00
  9.54006530e+00  3.37477086e+01  3.37477086e+01  3.37477086e+01
  5.23612274e+01  1.29485236e+02  1.29485236e+02  1.29485236e+02
  1.99470150e+02  4.83854109e+02  4.83854109e+02  4.83854109e+02
  7.16589406e+02  1.33531379e+03  1.33531379e+03  1.33531379e+03
  2.78752712e+03  3.02900203e+03  3.02900203e+03  3.02900203e+03
  6.64904007e+03  6.64904007e+03  6.64904007e+03  9.18492423e+03
  2.55339478e+04  7.62681592e+04]
E1 = -728.284215676877  E_coul = 201.53374567779846
cycle= 6 E= -526.750469999079  delta_E= -6.53e-11  |g|= 1.87e-06  |ddm|= 2.01e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.284215676877  E_coul = 201.53374567779846
  HOMO = -0.583547297398852  LUMO = 0.901872133050524
  mo_energy =
[-1.18584318e+02 -1.23130810e+01 -9.56318286e+00 -9.56318286e+00
 -9.56318286e+00 -1.27077275e+00 -5.83547297e-01 -5.83547297e-01
 -5.83547297e-01  9.01872133e-01  1.01933717e+00  1.01933717e+00
  1.01933717e+00  7.40608076e+00  7.40608076e+00  7.40608076e+00
  9.54006584e+00  3.37477092e+01  3.37477092e+01  3.37477092e+01
  5.23612281e+01  1.29485237e+02  1.29485237e+02  1.29485237e+02
  1.99470151e+02  4.83854110e+02  4.83854110e+02  4.83854110e+02
  7.16589407e+02  1.33531379e+03  1.33531379e+03  1.33531379e+03
  2.78752712e+03  3.02900203e+03  3.02900203e+03  3.02900203e+03
  6.64904007e+03  6.64904007e+03  6.64904007e+03  9.18492423e+03
  2.55339478e+04  7.62681592e+04]
E1 = -728.2842127857745  E_coul = 201.53374278669594
Extra cycle  E= -526.750469999079  delta_E=    0  |g|= 3.95e-07  |ddm|= 3.31e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
exp = [2.61826692e+04 7.61749272e+03 3.61736447e+03 1.59721248e+03
 3.82916104e+02 1.17367723e+02 4.44580377e+01 2.05845681e+01
 6.94053650e+00 6.43383524e-01 2.80916453e+00 2.28670801e-01
 1.36278766e+03 6.64701955e+02 3.00755863e+02 3.13864570e+02
 6.17468731e+01 7.38439377e+00 2.02485929e+01 7.80414613e-01
 2.86638098e+00 2.23024268e-01]
E = -526.7504699990785
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:43 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6691631        1
[INPUT] 0    0    [1    /1   ]  7617.49272162        1
[INPUT] 0    0    [1    /1   ]  3617.36447296        1
[INPUT] 0    0    [1    /1   ]  1597.21248254        1
[INPUT] 0    0    [1    /1   ]  382.916103978        1
[INPUT] 0    0    [1    /1   ]  117.367722762        1
[INPUT] 0    0    [1    /1   ]  44.4580377166        1
[INPUT] 0    0    [1    /1   ]  20.5845680714        1
[INPUT] 0    0    [1    /1   ]  6.94053650008        1
[INPUT] 0    0    [1    /1   ]  0.64338352361        1
[INPUT] 0    0    [1    /1   ]  2.80916452779        1
[INPUT] 0    0    [1    /1   ]  0.228670800618       1
[INPUT] 1    0    [1    /1   ]  1362.78765698        1
[INPUT] 1    0    [1    /1   ]  664.70195547         1
[INPUT] 1    0    [1    /1   ]  300.755862908        1
[INPUT] 1    0    [1    /1   ]  313.864569733        1
[INPUT] 1    0    [1    /1   ]  61.7468731359        1
[INPUT] 1    0    [1    /1   ]  7.3843937722         1
[INPUT] 1    0    [1    /1   ]  20.248592897         1
[INPUT] 1    0    [1    /1   ]  0.78041461257        1
[INPUT] 1    0    [1    /1   ]  2.86638097917        1
[INPUT] 1    0    [1    /1   ]  0.223024268383       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.66916313207, 1.0]], [0, [7617.492721619045, 1.0]], [0, [3617.3644729629714, 1.0]], [0, [1597.2124825385354, 1.0]], [0, [382.9161039779055, 1.0]], [0, [117.36772276240703, 1.0]], [0, [44.45803771655456, 1.0]], [0, [20.58456807137613, 1.0]], [0, [6.940536500075525, 1.0]], [0, [0.6433835236104355, 1.0]], [0, [2.8091645277879347, 1.0]], [0, [0.22867080061785167, 1.0]], [1, [1362.7876569813338, 1.0]], [1, [664.7019554695089, 1.0]], [1, [300.7558629078463, 1.0]], [1, [313.86456973303, 1.0]], [1, [61.74687313587123, 1.0]], [1, [7.384393772197307, 1.0]], [1, [20.24859289695124, 1.0]], [1, [0.7804146125699813, 1.0]], [1, [2.8663809791686314, 1.0]], [1, [0.22302426838277353, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.66916313]
bas 1, expnt(s) = [7617.49272162]
bas 2, expnt(s) = [3617.36447296]
bas 3, expnt(s) = [1597.21248254]
bas 4, expnt(s) = [382.91610398]
bas 5, expnt(s) = [117.36772276]
bas 6, expnt(s) = [44.45803772]
bas 7, expnt(s) = [20.58456807]
bas 8, expnt(s) = [6.9405365]
bas 9, expnt(s) = [0.64338352]
bas 10, expnt(s) = [2.80916453]
bas 11, expnt(s) = [0.2286708]
bas 12, expnt(s) = [1362.78765698]
bas 13, expnt(s) = [664.70195547]
bas 14, expnt(s) = [300.75586291]
bas 15, expnt(s) = [313.86456973]
bas 16, expnt(s) = [61.74687314]
bas 17, expnt(s) = [7.38439377]
bas 18, expnt(s) = [20.2485929]
bas 19, expnt(s) = [0.78041461]
bas 20, expnt(s) = [2.86638098]
bas 21, expnt(s) = [0.22302427]
CPU time:       406.09
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826692e+04 5.20026485e+03 7.61749272e+03 2.06003244e+03
 3.61736447e+03 1.17844475e+03 1.59721248e+03 6.38317933e+02
 3.82916104e+02 2.18696961e+02 1.17367723e+02 9.00899888e+01
 4.44580377e+01 4.34988466e+01 2.05845681e+01 2.44158216e+01
 6.94053650e+00 1.08033838e+01 6.43383524e-01 1.81496174e+00
 2.80916453e+00 5.48211203e+00 2.28670801e-01 8.35454992e-01
 1.36278766e+03 2.41557003e+04 6.64701955e+02 9.84618719e+03
 3.00755863e+02 3.65386099e+03 3.13864570e+02 3.85400487e+03
 6.17468731e+01 5.04955498e+02 7.38439377e+00 3.55122306e+01
 2.02485929e+01 1.25307756e+02 7.80414613e-01 2.13988844e+00
 2.86638098e+00 1.08805734e+01 2.23024268e-01 4.47120463e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993687957555544
cond(S) = 114727.89593865165
E1 = -729.5425292825536  E_coul = 203.17553263593246
init E= -526.366996646621
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555787650751094  LUMO = 0.921502201763043
  mo_energy =
[-1.18332666e+02 -1.22068284e+01 -9.44713253e+00 -9.44713253e+00
 -9.44713253e+00 -1.24021943e+00 -5.55787651e-01 -5.55787651e-01
 -5.55787651e-01  9.21502202e-01  1.03852973e+00  1.03852973e+00
  1.03852973e+00  7.47836061e+00  7.47836061e+00  7.47836061e+00
  9.61302172e+00  3.38692424e+01  3.38692424e+01  3.38692424e+01
  5.24872757e+01  1.29667381e+02  1.29667381e+02  1.29667381e+02
  1.99659622e+02  4.84105218e+02  4.84105218e+02  4.84105218e+02
  7.16877604e+02  1.33561817e+03  1.33561817e+03  1.33561817e+03
  2.78796113e+03  3.02937047e+03  3.02937047e+03  3.02937047e+03
  6.64952070e+03  6.64952070e+03  6.64952070e+03  9.18547852e+03
  2.55345967e+04  7.62688986e+04]
E1 = -727.8334888775375  E_coul = 201.0838163880093
cycle= 1 E= -526.749672489528  delta_E= -0.383  |g|= 0.187  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.572164
diis-c [-0.32737213  1.        ]
  HOMO = -0.591240550286575  LUMO = 0.895473534729901
  mo_energy =
[-1.18642611e+02 -1.23456950e+01 -9.59709383e+00 -9.59709383e+00
 -9.59709383e+00 -1.28012542e+00 -5.91240550e-01 -5.91240550e-01
 -5.91240550e-01  8.95473535e-01  1.01357975e+00  1.01357975e+00
  1.01357975e+00  7.38570737e+00  7.38570737e+00  7.38570737e+00
  9.51806399e+00  3.37134140e+01  3.37134140e+01  3.37134140e+01
  5.23240165e+01  1.29437217e+02  1.29437217e+02  1.29437217e+02
  1.99419928e+02  4.83796521e+02  4.83796521e+02  4.83796521e+02
  7.16529994e+02  1.33525273e+03  1.33525273e+03  1.33525273e+03
  2.78746351e+03  3.02893913e+03  3.02893913e+03  3.02893913e+03
  6.64897582e+03  6.64897582e+03  6.64897582e+03  9.18485942e+03
  2.55338826e+04  7.62680939e+04]
E1 = -728.4133851711182  E_coul = 201.66297740221185
cycle= 2 E= -526.750407768906  delta_E= -0.000735  |g|= 0.0381  |ddm|= 0.0534
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0778459
diis-c [-0.0038508   0.07632762  0.92367238]
  HOMO = -0.581976343673509  LUMO = 0.903036600524976
  mo_energy =
[-1.18573788e+02 -1.23069907e+01 -9.55670859e+00 -9.55670859e+00
 -9.55670859e+00 -1.26902897e+00 -5.81976344e-01 -5.81976344e-01
 -5.81976344e-01  9.03036601e-01  1.02047798e+00  1.02047798e+00
  1.02047798e+00  7.41007634e+00  7.41007634e+00  7.41007634e+00
  9.54423300e+00  3.37542103e+01  3.37542103e+01  3.37542103e+01
  5.23681470e+01  1.29494045e+02  1.29494045e+02  1.29494045e+02
  1.99479300e+02  4.83864516e+02  4.83864516e+02  4.83864516e+02
  7.16600175e+02  1.33532483e+03  1.33532483e+03  1.33532483e+03
  2.78753883e+03  3.02901350e+03  3.02901350e+03  3.02901350e+03
  6.64905196e+03  6.64905196e+03  6.64905196e+03  9.18493634e+03
  2.55339601e+04  7.62681717e+04]
E1 = -728.2602655712487  E_coul = 201.50979772244506
cycle= 3 E= -526.750467848804  delta_E= -6.01e-05  |g|= 0.00666  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.014186
diis-c [-8.49365478e-07 -1.31071199e-03  1.49701911e-01  8.51608801e-01]
  HOMO = -0.583558330688494  LUMO = 0.901841657792292
  mo_energy =
[-1.18584337e+02 -1.23131284e+01 -9.56321386e+00 -9.56321386e+00
 -9.56321386e+00 -1.27081088e+00 -5.83558331e-01 -5.83558331e-01
 -5.83558331e-01  9.01841658e-01  1.01932576e+00  1.01932576e+00
  1.01932576e+00  7.40605342e+00  7.40605342e+00  7.40605342e+00
  9.54002164e+00  3.37476791e+01  3.37476791e+01  3.37476791e+01
  5.23611904e+01  1.29485209e+02  1.29485209e+02  1.29485209e+02
  1.99470123e+02  4.83854090e+02  4.83854090e+02  4.83854090e+02
  7.16589396e+02  1.33531378e+03  1.33531378e+03  1.33531378e+03
  2.78752714e+03  3.02900203e+03  3.02900203e+03  3.02900203e+03
  6.64904009e+03  6.64904009e+03  6.64904009e+03  9.18492425e+03
  2.55339478e+04  7.62681593e+04]
E1 = -728.2843744569293  E_coul = 201.53390446001086
cycle= 4 E= -526.750469996918  delta_E= -2.15e-06  |g|= 0.000107  |ddm|= 0.00236
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000118794
diis-c [-5.12737241e-09  8.72966269e-05 -1.23929070e-02 -7.45662743e-02
  1.08687188e+00]
  HOMO = -0.583539488239992  LUMO = 0.901875477850395
  mo_energy =
[-1.18584287e+02 -1.23130579e+01 -9.56315772e+00 -9.56315772e+00
 -9.56315772e+00 -1.27076699e+00 -5.83539488e-01 -5.83539488e-01
 -5.83539488e-01  9.01875478e-01  1.01934234e+00  1.01934234e+00
  1.01934234e+00  7.40609802e+00  7.40609802e+00  7.40609802e+00
  9.54008245e+00  3.37477335e+01  3.37477335e+01  3.37477335e+01
  5.23612529e+01  1.29485265e+02  1.29485265e+02  1.29485265e+02
  1.99470180e+02  4.83854140e+02  4.83854140e+02  4.83854140e+02
  7.16589438e+02  1.33531382e+03  1.33531382e+03  1.33531382e+03
  2.78752716e+03  3.02900207e+03  3.02900207e+03  3.02900207e+03
  6.64904010e+03  6.64904010e+03  6.64904010e+03  9.18492426e+03
  2.55339478e+04  7.62681593e+04]
E1 = -728.2841312187162  E_coul = 201.53366121970296
cycle= 5 E= -526.750469999013  delta_E= -2.09e-09  |g|= 2.12e-05  |ddm|= 0.000175
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96319e-05
diis-c [-9.62868966e-11  1.28648527e-05 -1.75986347e-03 -1.26428466e-02
  3.41302295e-02  9.80259616e-01]
  HOMO = -0.583547403251252  LUMO = 0.901871700702774
  mo_energy =
[-1.18584319e+02 -1.23130816e+01 -9.56318340e+00 -9.56318340e+00
 -9.56318340e+00 -1.27077329e+00 -5.83547403e-01 -5.83547403e-01
 -5.83547403e-01  9.01871701e-01  1.01933703e+00  1.01933703e+00
  1.01933703e+00  7.40608039e+00  7.40608039e+00  7.40608039e+00
  9.54006530e+00  3.37477086e+01  3.37477086e+01  3.37477086e+01
  5.23612274e+01  1.29485236e+02  1.29485236e+02  1.29485236e+02
  1.99470150e+02  4.83854109e+02  4.83854109e+02  4.83854109e+02
  7.16589406e+02  1.33531379e+03  1.33531379e+03  1.33531379e+03
  2.78752712e+03  3.02900203e+03  3.02900203e+03  3.02900203e+03
  6.64904007e+03  6.64904007e+03  6.64904007e+03  9.18492423e+03
  2.55339478e+04  7.62681592e+04]
E1 = -728.284215676877  E_coul = 201.53374567779846
cycle= 6 E= -526.750469999079  delta_E= -6.53e-11  |g|= 1.87e-06  |ddm|= 2.01e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.284215676877  E_coul = 201.53374567779846
  HOMO = -0.583547297398852  LUMO = 0.901872133050524
  mo_energy =
[-1.18584318e+02 -1.23130810e+01 -9.56318286e+00 -9.56318286e+00
 -9.56318286e+00 -1.27077275e+00 -5.83547297e-01 -5.83547297e-01
 -5.83547297e-01  9.01872133e-01  1.01933717e+00  1.01933717e+00
  1.01933717e+00  7.40608076e+00  7.40608076e+00  7.40608076e+00
  9.54006584e+00  3.37477092e+01  3.37477092e+01  3.37477092e+01
  5.23612281e+01  1.29485237e+02  1.29485237e+02  1.29485237e+02
  1.99470151e+02  4.83854110e+02  4.83854110e+02  4.83854110e+02
  7.16589407e+02  1.33531379e+03  1.33531379e+03  1.33531379e+03
  2.78752712e+03  3.02900203e+03  3.02900203e+03  3.02900203e+03
  6.64904007e+03  6.64904007e+03  6.64904007e+03  9.18492423e+03
  2.55339478e+04  7.62681592e+04]
E1 = -728.2842127857745  E_coul = 201.53374278669594
Extra cycle  E= -526.750469999079  delta_E=    0  |g|= 3.95e-07  |ddm|= 3.31e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.24 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114727.89593865165
E1 = -728.2842127857745  E_coul = 201.53374278669594
init E= -526.750469999079
    CPU time for initialize scf      0.80 sec, wall time      0.32 sec
  HOMO = -0.583547369327486  LUMO = 0.90187214864929
  mo_energy =
[-1.18584318e+02 -1.23130812e+01 -9.56318310e+00 -9.56318310e+00
 -9.56318310e+00 -1.27077275e+00 -5.83547369e-01 -5.83547369e-01
 -5.83547369e-01  9.01872149e-01  1.01933713e+00  1.01933713e+00
  1.01933713e+00  7.40608061e+00  7.40608061e+00  7.40608061e+00
  9.54006572e+00  3.37477089e+01  3.37477089e+01  3.37477089e+01
  5.23612278e+01  1.29485236e+02  1.29485236e+02  1.29485236e+02
  1.99470150e+02  4.83854109e+02  4.83854109e+02  4.83854109e+02
  7.16589406e+02  1.33531379e+03  1.33531379e+03  1.33531379e+03
  2.78752712e+03  3.02900203e+03  3.02900203e+03  3.02900203e+03
  6.64904007e+03  6.64904007e+03  6.64904007e+03  9.18492423e+03
  2.55339478e+04  7.62681592e+04]
E1 = -728.2842134431918  E_coul = 201.53374344411424
cycle= 1 E= -526.750469999077  delta_E= 1.02e-12  |g|= 9.08e-08  |ddm|= 6.2e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2842134431918  E_coul = 201.53374344411424
  HOMO = -0.583547360064571  LUMO = 0.901872170847708
  mo_energy =
[-1.18584318e+02 -1.23130812e+01 -9.56318305e+00 -9.56318305e+00
 -9.56318305e+00 -1.27077272e+00 -5.83547360e-01 -5.83547360e-01
 -5.83547360e-01  9.01872171e-01  1.01933713e+00  1.01933713e+00
  1.01933713e+00  7.40608064e+00  7.40608064e+00  7.40608064e+00
  9.54006576e+00  3.37477090e+01  3.37477090e+01  3.37477090e+01
  5.23612279e+01  1.29485236e+02  1.29485236e+02  1.29485236e+02
  1.99470150e+02  4.83854109e+02  4.83854109e+02  4.83854109e+02
  7.16589406e+02  1.33531379e+03  1.33531379e+03  1.33531379e+03
  2.78752712e+03  3.02900203e+03  3.02900203e+03  3.02900203e+03
  6.64904007e+03  6.64904007e+03  6.64904007e+03  9.18492423e+03
  2.55339478e+04  7.62681592e+04]
E1 = -728.2842132257072  E_coul = 201.5337432266289
Extra cycle  E= -526.750469999078  delta_E= -7.96e-13  |g|= 1.97e-08  |ddm|= 1.42e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.44 sec
exp = [2.61826692e+04 7.61749272e+03 3.61736447e+03 1.59721248e+03
 3.82916104e+02 1.17367723e+02 4.44580377e+01 2.05845681e+01
 6.94053650e+00 6.43383524e-01 2.80916453e+00 2.28670801e-01
 1.36278766e+03 6.64701955e+02 3.00755863e+02 3.13864570e+02
 6.17468731e+01 7.38439377e+00 2.02485929e+01 7.80414613e-01
 2.86638098e+00 2.23024268e-01]
grad_E = [-1.56468553e-06  3.85547768e-06 -1.20655347e-06  8.92959086e-05
 -4.15414333e-04 -2.65587857e-04 -8.39759175e-05  2.33772029e-04
  5.47587600e-04 -9.94958787e-04 -1.23971960e-03 -3.83314307e-04
 -5.23089826e-07  4.80209284e-06  2.24429358e-05  1.93379879e-05
  6.10824420e-05 -1.23566807e-03 -2.68773583e-04  5.61867553e-03
  4.29970666e-03 -1.83550376e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:48 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6707498        1
[INPUT] 0    0    [1    /1   ]  7617.48882987        1
[INPUT] 0    0    [1    /1   ]  3617.36571117        1
[INPUT] 0    0    [1    /1   ]  1597.12272195        1
[INPUT] 0    0    [1    /1   ]  383.315136972        1
[INPUT] 0    0    [1    /1   ]  117.704104189        1
[INPUT] 0    0    [1    /1   ]  44.534479918         1
[INPUT] 0    0    [1    /1   ]  20.1760661601        1
[INPUT] 0    0    [1    /1   ]  6.95725081255        1
[INPUT] 0    0    [1    /1   ]  0.63886310429        1
[INPUT] 0    0    [1    /1   ]  2.80704399716        1
[INPUT] 0    0    [1    /1   ]  0.226815998809       1
[INPUT] 1    0    [1    /1   ]  1362.78817948        1
[INPUT] 1    0    [1    /1   ]  664.696962648        1
[INPUT] 1    0    [1    /1   ]  300.732377237        1
[INPUT] 1    0    [1    /1   ]  313.844333435        1
[INPUT] 1    0    [1    /1   ]  61.7515559353        1
[INPUT] 1    0    [1    /1   ]  7.41636605766        1
[INPUT] 1    0    [1    /1   ]  20.2501741029        1
[INPUT] 1    0    [1    /1   ]  0.783665533674       1
[INPUT] 1    0    [1    /1   ]  2.89932264515        1
[INPUT] 1    0    [1    /1   ]  0.223421415846       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.670749767476, 1.0]], [0, [7617.488829870208, 1.0]], [0, [3617.365711168076, 1.0]], [0, [1597.122721950706, 1.0]], [0, [383.3151369724851, 1.0]], [0, [117.70410418858599, 1.0]], [0, [44.53447991800752, 1.0]], [0, [20.176066160097527, 1.0]], [0, [6.957250812546538, 1.0]], [0, [0.6388631042903437, 1.0]], [0, [2.8070439971551098, 1.0]], [0, [0.22681599880891326, 1.0]], [1, [1362.78817948295, 1.0]], [1, [664.696962647905, 1.0]], [1, [300.7323772365565, 1.0]], [1, [313.84433343479924, 1.0]], [1, [61.75155593533559, 1.0]], [1, [7.416366057659039, 1.0]], [1, [20.25017410287929, 1.0]], [1, [0.7836655336737944, 1.0]], [1, [2.899322645151506, 1.0]], [1, [0.22342141584615716, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.67074977]
bas 1, expnt(s) = [7617.48882987]
bas 2, expnt(s) = [3617.36571117]
bas 3, expnt(s) = [1597.12272195]
bas 4, expnt(s) = [383.31513697]
bas 5, expnt(s) = [117.70410419]
bas 6, expnt(s) = [44.53447992]
bas 7, expnt(s) = [20.17606616]
bas 8, expnt(s) = [6.95725081]
bas 9, expnt(s) = [0.6388631]
bas 10, expnt(s) = [2.807044]
bas 11, expnt(s) = [0.226816]
bas 12, expnt(s) = [1362.78817948]
bas 13, expnt(s) = [664.69696265]
bas 14, expnt(s) = [300.73237724]
bas 15, expnt(s) = [313.84433343]
bas 16, expnt(s) = [61.75155594]
bas 17, expnt(s) = [7.41636606]
bas 18, expnt(s) = [20.2501741]
bas 19, expnt(s) = [0.78366553]
bas 20, expnt(s) = [2.89932265]
bas 21, expnt(s) = [0.22342142]
CPU time:       411.66
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826707e+04 5.20026509e+03 7.61748883e+03 2.06003165e+03
 3.61736571e+03 1.17844505e+03 1.59712272e+03 6.38291029e+02
 3.83315137e+02 2.18867865e+02 1.17704104e+02 9.02835711e+01
 4.45344799e+01 4.35549293e+01 2.01760662e+01 2.40515126e+01
 6.95725081e+00 1.08228906e+01 6.38863104e-01 1.80538936e+00
 2.80704400e+00 5.47900806e+00 2.26815999e-01 8.30367395e-01
 1.36278818e+03 2.41557118e+04 6.64696963e+02 9.84609474e+03
 3.00732377e+02 3.65350433e+03 3.13844333e+02 3.85369427e+03
 6.17515559e+01 5.05003367e+02 7.41636606e+00 3.57045316e+01
 2.02501741e+01 1.25319988e+02 7.83665534e-01 2.15103673e+00
 2.89932265e+00 1.10371025e+01 2.23421416e-01 4.48115940e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99359500286758
cond(S) = 114627.89940571917
E1 = -729.5427852236548  E_coul = 203.17569165637514
init E= -526.36709356728
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555785844624968  LUMO = 0.909967223073299
  mo_energy =
[-1.18332791e+02 -1.22068097e+01 -9.44710131e+00 -9.44710131e+00
 -9.44710131e+00 -1.24022661e+00 -5.55785845e-01 -5.55785845e-01
 -5.55785845e-01  9.09967223e-01  1.04308675e+00  1.04308675e+00
  1.04308675e+00  7.55760901e+00  7.55760901e+00  7.55760901e+00
  9.57238266e+00  3.40753646e+01  3.40753646e+01  3.40753646e+01
  5.20370470e+01  1.29907468e+02  1.29907468e+02  1.29907468e+02
  1.98706045e+02  4.84299468e+02  4.84299468e+02  4.84299468e+02
  7.16697007e+02  1.33574483e+03  1.33574483e+03  1.33574483e+03
  2.78899272e+03  3.02942219e+03  3.02942219e+03  3.02942219e+03
  6.64951641e+03  6.64951641e+03  6.64951641e+03  9.18682053e+03
  2.55359062e+04  7.62701131e+04]
E1 = -727.8318220979121  E_coul = 201.081961915711
cycle= 1 E= -526.749860182201  delta_E= -0.383  |g|= 0.187  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.572046
diis-c [-0.32723615  1.        ]
  HOMO = -0.591357556721594  LUMO = 0.884127463674714
  mo_energy =
[-1.18642763e+02 -1.23457861e+01 -9.59719586e+00 -9.59719586e+00
 -9.59719586e+00 -1.28024761e+00 -5.91357557e-01 -5.91357557e-01
 -5.91357557e-01  8.84127464e-01  1.01790779e+00  1.01790779e+00
  1.01790779e+00  7.46428510e+00  7.46428510e+00  7.46428510e+00
  9.47744099e+00  3.39193374e+01  3.39193374e+01  3.39193374e+01
  5.18742180e+01  1.29677299e+02  1.29677299e+02  1.29677299e+02
  1.98466363e+02  4.83990760e+02  4.83990760e+02  4.83990760e+02
  7.16349194e+02  1.33537940e+03  1.33537940e+03  1.33537940e+03
  2.78849504e+03  3.02899083e+03  3.02899083e+03  3.02899083e+03
  6.64897153e+03  6.64897153e+03  6.64897153e+03  9.18620143e+03
  2.55351921e+04  7.62693083e+04]
E1 = -728.4120248863843  E_coul = 201.6614282094904
cycle= 2 E= -526.750596676894  delta_E= -0.000736  |g|= 0.0381  |ddm|= 0.0535
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.077907
diis-c [-0.00384586  0.07657227  0.92342773]
  HOMO = -0.582089237908513  LUMO = 0.891624321053716
  mo_energy =
[-1.18573938e+02 -1.23070675e+01 -9.55679847e+00 -9.55679847e+00
 -9.55679847e+00 -1.26914536e+00 -5.82089238e-01 -5.82089238e-01
 -5.82089238e-01  8.91624321e-01  1.02484965e+00  1.02484965e+00
  1.02484965e+00  7.48879601e+00  7.48879601e+00  7.48879601e+00
  9.50358674e+00  3.39601699e+01  3.39601699e+01  3.39601699e+01
  5.19182288e+01  1.29734124e+02  1.29734124e+02  1.29734124e+02
  1.98525728e+02  4.84058752e+02  4.84058752e+02  4.84058752e+02
  7.16419389e+02  1.33545149e+03  1.33545149e+03  1.33545149e+03
  2.78857037e+03  3.02906520e+03  3.02906520e+03  3.02906520e+03
  6.64904766e+03  6.64904766e+03  6.64904766e+03  9.18627835e+03
  2.55352696e+04  7.62693862e+04]
E1 = -728.2589132375604  E_coul = 201.50825642203614
cycle= 3 E= -526.750656815524  delta_E= -6.01e-05  |g|= 0.00665  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141748
diis-c [-8.54643197e-07 -1.30993080e-03  1.49487902e-01  8.51822029e-01]
  HOMO = -0.583669543815643  LUMO = 0.890442521769833
  mo_energy =
[-1.18584468e+02 -1.23131944e+01 -9.56329310e+00 -9.56329310e+00
 -9.56329310e+00 -1.27092444e+00 -5.83669544e-01 -5.83669544e-01
 -5.83669544e-01  8.90442522e-01  1.02369194e+00  1.02369194e+00
  1.02369194e+00  7.48475778e+00  7.48475778e+00  7.48475778e+00
  9.49938807e+00  3.39536459e+01  3.39536459e+01  3.39536459e+01
  5.19113035e+01  1.29725306e+02  1.29725306e+02  1.29725306e+02
  1.98516570e+02  4.84048346e+02  4.84048346e+02  4.84048346e+02
  7.16408627e+02  1.33544046e+03  1.33544046e+03  1.33544046e+03
  2.78855869e+03  3.02905376e+03  3.02905376e+03  3.02905376e+03
  6.64903581e+03  6.64903581e+03  6.64903581e+03  9.18626628e+03
  2.55352573e+04  7.62693738e+04]
E1 = -728.2829711124739  E_coul = 201.53231215588696
cycle= 4 E= -526.750658956587  delta_E= -2.14e-06  |g|= 0.000108  |ddm|= 0.00235
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000120692
diis-c [-5.15288054e-09  8.86028272e-05 -1.25592220e-02 -7.57844764e-02
  1.08825510e+00]
  HOMO = -0.583651114172684  LUMO = 0.89047593241516
  mo_energy =
[-1.18584419e+02 -1.23131249e+01 -9.56323806e+00 -9.56323806e+00
 -9.56323806e+00 -1.27088079e+00 -5.83651114e-01 -5.83651114e-01
 -5.83651114e-01  8.90475932e-01  1.02370832e+00  1.02370832e+00
  1.02370832e+00  7.48480174e+00  7.48480174e+00  7.48480174e+00
  9.49944822e+00  3.39536992e+01  3.39536992e+01  3.39536992e+01
  5.19113650e+01  1.29725360e+02  1.29725360e+02  1.29725360e+02
  1.98516625e+02  4.84048395e+02  4.84048395e+02  4.84048395e+02
  7.16408668e+02  1.33544050e+03  1.33544050e+03  1.33544050e+03
  2.78855871e+03  3.02905379e+03  3.02905379e+03  3.02905379e+03
  6.64903583e+03  6.64903583e+03  6.64903583e+03  9.18626628e+03
  2.55352573e+04  7.62693738e+04]
E1 = -728.282730263598  E_coul = 201.53207130488096
cycle= 5 E= -526.750658958717  delta_E= -2.13e-09  |g|= 2.12e-05  |ddm|= 0.000177
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.9582e-05
diis-c [-9.76023187e-11  1.27991189e-05 -1.74819961e-03 -1.25958899e-02
  3.39195141e-02  9.80411776e-01]
  HOMO = -0.583659064817383  LUMO = 0.890472172762847
  mo_energy =
[-1.18584451e+02 -1.23131487e+01 -9.56326379e+00 -9.56326379e+00
 -9.56326379e+00 -1.27088711e+00 -5.83659065e-01 -5.83659065e-01
 -5.83659065e-01  8.90472173e-01  1.02370296e+00  1.02370296e+00
  1.02370296e+00  7.48478397e+00  7.48478397e+00  7.48478397e+00
  9.49943104e+00  3.39536743e+01  3.39536743e+01  3.39536743e+01
  5.19113395e+01  1.29725331e+02  1.29725331e+02  1.29725331e+02
  1.98516595e+02  4.84048363e+02  4.84048363e+02  4.84048363e+02
  7.16408635e+02  1.33544047e+03  1.33544047e+03  1.33544047e+03
  2.78855867e+03  3.02905376e+03  3.02905376e+03  3.02905376e+03
  6.64903579e+03  6.64903579e+03  6.64903579e+03  9.18626625e+03
  2.55352573e+04  7.62693737e+04]
E1 = -728.2828147379838  E_coul = 201.53215577920324
cycle= 6 E= -526.750658958781  delta_E= -6.37e-11  |g|= 1.88e-06  |ddm|= 2.02e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2828147379838  E_coul = 201.53215577920324
  HOMO = -0.583658951755893  LUMO = 0.890472608554271
  mo_energy =
[-1.18584450e+02 -1.23131480e+01 -9.56326322e+00 -9.56326322e+00
 -9.56326322e+00 -1.27088656e+00 -5.83658952e-01 -5.83658952e-01
 -5.83658952e-01  8.90472609e-01  1.02370310e+00  1.02370310e+00
  1.02370310e+00  7.48478436e+00  7.48478436e+00  7.48478436e+00
  9.49943160e+00  3.39536748e+01  3.39536748e+01  3.39536748e+01
  5.19113402e+01  1.29725332e+02  1.29725332e+02  1.29725332e+02
  1.98516596e+02  4.84048364e+02  4.84048364e+02  4.84048364e+02
  7.16408636e+02  1.33544047e+03  1.33544047e+03  1.33544047e+03
  2.78855867e+03  3.02905376e+03  3.02905376e+03  3.02905376e+03
  6.64903579e+03  6.64903579e+03  6.64903579e+03  9.18626625e+03
  2.55352573e+04  7.62693737e+04]
E1 = -728.2828116982447  E_coul = 201.5321527394634
Extra cycle  E= -526.750658958781  delta_E= -6.82e-13  |g|= 3.99e-07  |ddm|= 3.34e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.24 sec
exp = [2.61826707e+04 7.61748883e+03 3.61736571e+03 1.59712272e+03
 3.83315137e+02 1.17704104e+02 4.45344799e+01 2.01760662e+01
 6.95725081e+00 6.38863104e-01 2.80704400e+00 2.26815999e-01
 1.36278818e+03 6.64696963e+02 3.00732377e+02 3.13844333e+02
 6.17515559e+01 7.41636606e+00 2.02501741e+01 7.83665534e-01
 2.89932265e+00 2.23421416e-01]
E = -526.7506589587813
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:48 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6707498        1
[INPUT] 0    0    [1    /1   ]  7617.48882987        1
[INPUT] 0    0    [1    /1   ]  3617.36571117        1
[INPUT] 0    0    [1    /1   ]  1597.12272195        1
[INPUT] 0    0    [1    /1   ]  383.315136972        1
[INPUT] 0    0    [1    /1   ]  117.704104189        1
[INPUT] 0    0    [1    /1   ]  44.534479918         1
[INPUT] 0    0    [1    /1   ]  20.1760661601        1
[INPUT] 0    0    [1    /1   ]  6.95725081255        1
[INPUT] 0    0    [1    /1   ]  0.63886310429        1
[INPUT] 0    0    [1    /1   ]  2.80704399716        1
[INPUT] 0    0    [1    /1   ]  0.226815998809       1
[INPUT] 1    0    [1    /1   ]  1362.78817948        1
[INPUT] 1    0    [1    /1   ]  664.696962648        1
[INPUT] 1    0    [1    /1   ]  300.732377237        1
[INPUT] 1    0    [1    /1   ]  313.844333435        1
[INPUT] 1    0    [1    /1   ]  61.7515559353        1
[INPUT] 1    0    [1    /1   ]  7.41636605766        1
[INPUT] 1    0    [1    /1   ]  20.2501741029        1
[INPUT] 1    0    [1    /1   ]  0.783665533674       1
[INPUT] 1    0    [1    /1   ]  2.89932264515        1
[INPUT] 1    0    [1    /1   ]  0.223421415846       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.670749767476, 1.0]], [0, [7617.488829870208, 1.0]], [0, [3617.365711168076, 1.0]], [0, [1597.122721950706, 1.0]], [0, [383.3151369724851, 1.0]], [0, [117.70410418858599, 1.0]], [0, [44.53447991800752, 1.0]], [0, [20.176066160097527, 1.0]], [0, [6.957250812546538, 1.0]], [0, [0.6388631042903437, 1.0]], [0, [2.8070439971551098, 1.0]], [0, [0.22681599880891326, 1.0]], [1, [1362.78817948295, 1.0]], [1, [664.696962647905, 1.0]], [1, [300.7323772365565, 1.0]], [1, [313.84433343479924, 1.0]], [1, [61.75155593533559, 1.0]], [1, [7.416366057659039, 1.0]], [1, [20.25017410287929, 1.0]], [1, [0.7836655336737944, 1.0]], [1, [2.899322645151506, 1.0]], [1, [0.22342141584615716, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.67074977]
bas 1, expnt(s) = [7617.48882987]
bas 2, expnt(s) = [3617.36571117]
bas 3, expnt(s) = [1597.12272195]
bas 4, expnt(s) = [383.31513697]
bas 5, expnt(s) = [117.70410419]
bas 6, expnt(s) = [44.53447992]
bas 7, expnt(s) = [20.17606616]
bas 8, expnt(s) = [6.95725081]
bas 9, expnt(s) = [0.6388631]
bas 10, expnt(s) = [2.807044]
bas 11, expnt(s) = [0.226816]
bas 12, expnt(s) = [1362.78817948]
bas 13, expnt(s) = [664.69696265]
bas 14, expnt(s) = [300.73237724]
bas 15, expnt(s) = [313.84433343]
bas 16, expnt(s) = [61.75155594]
bas 17, expnt(s) = [7.41636606]
bas 18, expnt(s) = [20.2501741]
bas 19, expnt(s) = [0.78366553]
bas 20, expnt(s) = [2.89932265]
bas 21, expnt(s) = [0.22342142]
CPU time:       412.13
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826707e+04 5.20026509e+03 7.61748883e+03 2.06003165e+03
 3.61736571e+03 1.17844505e+03 1.59712272e+03 6.38291029e+02
 3.83315137e+02 2.18867865e+02 1.17704104e+02 9.02835711e+01
 4.45344799e+01 4.35549293e+01 2.01760662e+01 2.40515126e+01
 6.95725081e+00 1.08228906e+01 6.38863104e-01 1.80538936e+00
 2.80704400e+00 5.47900806e+00 2.26815999e-01 8.30367395e-01
 1.36278818e+03 2.41557118e+04 6.64696963e+02 9.84609474e+03
 3.00732377e+02 3.65350433e+03 3.13844333e+02 3.85369427e+03
 6.17515559e+01 5.05003367e+02 7.41636606e+00 3.57045316e+01
 2.02501741e+01 1.25319988e+02 7.83665534e-01 2.15103673e+00
 2.89932265e+00 1.10371025e+01 2.23421416e-01 4.48115940e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99359500286758
cond(S) = 114627.89940571917
E1 = -729.5427852236548  E_coul = 203.17569165637514
init E= -526.36709356728
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555785844624968  LUMO = 0.909967223073299
  mo_energy =
[-1.18332791e+02 -1.22068097e+01 -9.44710131e+00 -9.44710131e+00
 -9.44710131e+00 -1.24022661e+00 -5.55785845e-01 -5.55785845e-01
 -5.55785845e-01  9.09967223e-01  1.04308675e+00  1.04308675e+00
  1.04308675e+00  7.55760901e+00  7.55760901e+00  7.55760901e+00
  9.57238266e+00  3.40753646e+01  3.40753646e+01  3.40753646e+01
  5.20370470e+01  1.29907468e+02  1.29907468e+02  1.29907468e+02
  1.98706045e+02  4.84299468e+02  4.84299468e+02  4.84299468e+02
  7.16697007e+02  1.33574483e+03  1.33574483e+03  1.33574483e+03
  2.78899272e+03  3.02942219e+03  3.02942219e+03  3.02942219e+03
  6.64951641e+03  6.64951641e+03  6.64951641e+03  9.18682053e+03
  2.55359062e+04  7.62701131e+04]
E1 = -727.8318220979121  E_coul = 201.081961915711
cycle= 1 E= -526.749860182201  delta_E= -0.383  |g|= 0.187  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.572046
diis-c [-0.32723615  1.        ]
  HOMO = -0.591357556721594  LUMO = 0.884127463674714
  mo_energy =
[-1.18642763e+02 -1.23457861e+01 -9.59719586e+00 -9.59719586e+00
 -9.59719586e+00 -1.28024761e+00 -5.91357557e-01 -5.91357557e-01
 -5.91357557e-01  8.84127464e-01  1.01790779e+00  1.01790779e+00
  1.01790779e+00  7.46428510e+00  7.46428510e+00  7.46428510e+00
  9.47744099e+00  3.39193374e+01  3.39193374e+01  3.39193374e+01
  5.18742180e+01  1.29677299e+02  1.29677299e+02  1.29677299e+02
  1.98466363e+02  4.83990760e+02  4.83990760e+02  4.83990760e+02
  7.16349194e+02  1.33537940e+03  1.33537940e+03  1.33537940e+03
  2.78849504e+03  3.02899083e+03  3.02899083e+03  3.02899083e+03
  6.64897153e+03  6.64897153e+03  6.64897153e+03  9.18620143e+03
  2.55351921e+04  7.62693083e+04]
E1 = -728.4120248863843  E_coul = 201.6614282094904
cycle= 2 E= -526.750596676894  delta_E= -0.000736  |g|= 0.0381  |ddm|= 0.0535
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.077907
diis-c [-0.00384586  0.07657227  0.92342773]
  HOMO = -0.582089237908513  LUMO = 0.891624321053716
  mo_energy =
[-1.18573938e+02 -1.23070675e+01 -9.55679847e+00 -9.55679847e+00
 -9.55679847e+00 -1.26914536e+00 -5.82089238e-01 -5.82089238e-01
 -5.82089238e-01  8.91624321e-01  1.02484965e+00  1.02484965e+00
  1.02484965e+00  7.48879601e+00  7.48879601e+00  7.48879601e+00
  9.50358674e+00  3.39601699e+01  3.39601699e+01  3.39601699e+01
  5.19182288e+01  1.29734124e+02  1.29734124e+02  1.29734124e+02
  1.98525728e+02  4.84058752e+02  4.84058752e+02  4.84058752e+02
  7.16419389e+02  1.33545149e+03  1.33545149e+03  1.33545149e+03
  2.78857037e+03  3.02906520e+03  3.02906520e+03  3.02906520e+03
  6.64904766e+03  6.64904766e+03  6.64904766e+03  9.18627835e+03
  2.55352696e+04  7.62693862e+04]
E1 = -728.2589132375604  E_coul = 201.50825642203614
cycle= 3 E= -526.750656815524  delta_E= -6.01e-05  |g|= 0.00665  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0141748
diis-c [-8.54643197e-07 -1.30993080e-03  1.49487902e-01  8.51822029e-01]
  HOMO = -0.583669543815643  LUMO = 0.890442521769833
  mo_energy =
[-1.18584468e+02 -1.23131944e+01 -9.56329310e+00 -9.56329310e+00
 -9.56329310e+00 -1.27092444e+00 -5.83669544e-01 -5.83669544e-01
 -5.83669544e-01  8.90442522e-01  1.02369194e+00  1.02369194e+00
  1.02369194e+00  7.48475778e+00  7.48475778e+00  7.48475778e+00
  9.49938807e+00  3.39536459e+01  3.39536459e+01  3.39536459e+01
  5.19113035e+01  1.29725306e+02  1.29725306e+02  1.29725306e+02
  1.98516570e+02  4.84048346e+02  4.84048346e+02  4.84048346e+02
  7.16408627e+02  1.33544046e+03  1.33544046e+03  1.33544046e+03
  2.78855869e+03  3.02905376e+03  3.02905376e+03  3.02905376e+03
  6.64903581e+03  6.64903581e+03  6.64903581e+03  9.18626628e+03
  2.55352573e+04  7.62693738e+04]
E1 = -728.2829711124739  E_coul = 201.53231215588696
cycle= 4 E= -526.750658956587  delta_E= -2.14e-06  |g|= 0.000108  |ddm|= 0.00235
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000120692
diis-c [-5.15288054e-09  8.86028272e-05 -1.25592220e-02 -7.57844764e-02
  1.08825510e+00]
  HOMO = -0.583651114172684  LUMO = 0.89047593241516
  mo_energy =
[-1.18584419e+02 -1.23131249e+01 -9.56323806e+00 -9.56323806e+00
 -9.56323806e+00 -1.27088079e+00 -5.83651114e-01 -5.83651114e-01
 -5.83651114e-01  8.90475932e-01  1.02370832e+00  1.02370832e+00
  1.02370832e+00  7.48480174e+00  7.48480174e+00  7.48480174e+00
  9.49944822e+00  3.39536992e+01  3.39536992e+01  3.39536992e+01
  5.19113650e+01  1.29725360e+02  1.29725360e+02  1.29725360e+02
  1.98516625e+02  4.84048395e+02  4.84048395e+02  4.84048395e+02
  7.16408668e+02  1.33544050e+03  1.33544050e+03  1.33544050e+03
  2.78855871e+03  3.02905379e+03  3.02905379e+03  3.02905379e+03
  6.64903583e+03  6.64903583e+03  6.64903583e+03  9.18626628e+03
  2.55352573e+04  7.62693738e+04]
E1 = -728.282730263598  E_coul = 201.53207130488096
cycle= 5 E= -526.750658958717  delta_E= -2.13e-09  |g|= 2.12e-05  |ddm|= 0.000177
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.9582e-05
diis-c [-9.76023187e-11  1.27991189e-05 -1.74819961e-03 -1.25958899e-02
  3.39195141e-02  9.80411776e-01]
  HOMO = -0.583659064817383  LUMO = 0.890472172762847
  mo_energy =
[-1.18584451e+02 -1.23131487e+01 -9.56326379e+00 -9.56326379e+00
 -9.56326379e+00 -1.27088711e+00 -5.83659065e-01 -5.83659065e-01
 -5.83659065e-01  8.90472173e-01  1.02370296e+00  1.02370296e+00
  1.02370296e+00  7.48478397e+00  7.48478397e+00  7.48478397e+00
  9.49943104e+00  3.39536743e+01  3.39536743e+01  3.39536743e+01
  5.19113395e+01  1.29725331e+02  1.29725331e+02  1.29725331e+02
  1.98516595e+02  4.84048363e+02  4.84048363e+02  4.84048363e+02
  7.16408635e+02  1.33544047e+03  1.33544047e+03  1.33544047e+03
  2.78855867e+03  3.02905376e+03  3.02905376e+03  3.02905376e+03
  6.64903579e+03  6.64903579e+03  6.64903579e+03  9.18626625e+03
  2.55352573e+04  7.62693737e+04]
E1 = -728.2828147379838  E_coul = 201.53215577920324
cycle= 6 E= -526.750658958781  delta_E= -6.37e-11  |g|= 1.88e-06  |ddm|= 2.02e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2828147379838  E_coul = 201.53215577920324
  HOMO = -0.583658951755893  LUMO = 0.890472608554271
  mo_energy =
[-1.18584450e+02 -1.23131480e+01 -9.56326322e+00 -9.56326322e+00
 -9.56326322e+00 -1.27088656e+00 -5.83658952e-01 -5.83658952e-01
 -5.83658952e-01  8.90472609e-01  1.02370310e+00  1.02370310e+00
  1.02370310e+00  7.48478436e+00  7.48478436e+00  7.48478436e+00
  9.49943160e+00  3.39536748e+01  3.39536748e+01  3.39536748e+01
  5.19113402e+01  1.29725332e+02  1.29725332e+02  1.29725332e+02
  1.98516596e+02  4.84048364e+02  4.84048364e+02  4.84048364e+02
  7.16408636e+02  1.33544047e+03  1.33544047e+03  1.33544047e+03
  2.78855867e+03  3.02905376e+03  3.02905376e+03  3.02905376e+03
  6.64903579e+03  6.64903579e+03  6.64903579e+03  9.18626625e+03
  2.55352573e+04  7.62693737e+04]
E1 = -728.2828116982447  E_coul = 201.5321527394634
Extra cycle  E= -526.750658958781  delta_E= -6.82e-13  |g|= 3.99e-07  |ddm|= 3.34e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114627.89940571917
E1 = -728.2828116982447  E_coul = 201.5321527394634
init E= -526.750658958781
    CPU time for initialize scf      0.79 sec, wall time      0.31 sec
  HOMO = -0.583659027047273  LUMO = 0.890472621832582
  mo_energy =
[-1.18584451e+02 -1.23131482e+01 -9.56326347e+00 -9.56326347e+00
 -9.56326347e+00 -1.27088657e+00 -5.83659027e-01 -5.83659027e-01
 -5.83659027e-01  8.90472622e-01  1.02370305e+00  1.02370305e+00
  1.02370305e+00  7.48478420e+00  7.48478420e+00  7.48478420e+00
  9.49943147e+00  3.39536746e+01  3.39536746e+01  3.39536746e+01
  5.19113399e+01  1.29725331e+02  1.29725331e+02  1.29725331e+02
  1.98516596e+02  4.84048363e+02  4.84048363e+02  4.84048363e+02
  7.16408636e+02  1.33544047e+03  1.33544047e+03  1.33544047e+03
  2.78855867e+03  3.02905376e+03  3.02905376e+03  3.02905376e+03
  6.64903579e+03  6.64903579e+03  6.64903579e+03  9.18626625e+03
  2.55352573e+04  7.62693737e+04]
E1 = -728.2828123905276  E_coul = 201.53215343174475
cycle= 1 E= -526.750658958783  delta_E= -1.59e-12  |g|= 9.23e-08  |ddm|= 6.23e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2828123905276  E_coul = 201.53215343174475
  HOMO = -0.58365901722086  LUMO = 0.890472644376269
  mo_energy =
[-1.18584451e+02 -1.23131482e+01 -9.56326342e+00 -9.56326342e+00
 -9.56326342e+00 -1.27088654e+00 -5.83659017e-01 -5.83659017e-01
 -5.83659017e-01  8.90472644e-01  1.02370306e+00  1.02370306e+00
  1.02370306e+00  7.48478423e+00  7.48478423e+00  7.48478423e+00
  9.49943151e+00  3.39536747e+01  3.39536747e+01  3.39536747e+01
  5.19113400e+01  1.29725332e+02  1.29725332e+02  1.29725332e+02
  1.98516596e+02  4.84048364e+02  4.84048364e+02  4.84048364e+02
  7.16408636e+02  1.33544047e+03  1.33544047e+03  1.33544047e+03
  2.78855867e+03  3.02905376e+03  3.02905376e+03  3.02905376e+03
  6.64903579e+03  6.64903579e+03  6.64903579e+03  9.18626625e+03
  2.55352573e+04  7.62693737e+04]
E1 = -728.2828121618658  E_coul = 201.53215320308348
Extra cycle  E= -526.750658958782  delta_E= 5.68e-13  |g|= 2.01e-08  |ddm|= 1.44e-07
    CPU time for scf_cycle      0.90 sec, wall time      0.42 sec
exp = [2.61826707e+04 7.61748883e+03 3.61736571e+03 1.59712272e+03
 3.83315137e+02 1.17704104e+02 4.45344799e+01 2.01760662e+01
 6.95725081e+00 6.38863104e-01 2.80704400e+00 2.26815999e-01
 1.36278818e+03 6.64696963e+02 3.00732377e+02 3.13844333e+02
 6.17515559e+01 7.41636606e+00 2.02501741e+01 7.83665534e-01
 2.89932265e+00 2.23421416e-01]
grad_E = [-1.56390165e-06  3.84572998e-06 -1.21841411e-06  8.90421457e-05
 -4.16754164e-04 -2.64621310e-04 -4.66078806e-05  1.95074146e-04
  7.70779520e-04 -1.56660619e-03 -1.75496471e-03 -8.49229557e-04
 -5.26201236e-07  4.75906604e-06  2.21863089e-05  1.91166002e-05
  8.69184283e-05 -1.95332713e-03 -3.71204897e-04  8.83954167e-03
  6.85905185e-03 -2.87961851e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:53 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6744874        1
[INPUT] 0    0    [1    /1   ]  7617.47966494        1
[INPUT] 0    0    [1    /1   ]  3617.36863018        1
[INPUT] 0    0    [1    /1   ]  1596.91139658        1
[INPUT] 0    0    [1    /1   ]  384.25107544         1
[INPUT] 0    0    [1    /1   ]  118.521126521        1
[INPUT] 0    0    [1    /1   ]  44.6719951833        1
[INPUT] 0    0    [1    /1   ]  19.2225726782        1
[INPUT] 0    0    [1    /1   ]  6.97644994395        1
[INPUT] 0    0    [1    /1   ]  0.633399024072       1
[INPUT] 0    0    [1    /1   ]  2.80235554234        1
[INPUT] 0    0    [1    /1   ]  0.224472418073       1
[INPUT] 1    0    [1    /1   ]  1362.78941078        1
[INPUT] 1    0    [1    /1   ]  664.685204169        1
[INPUT] 1    0    [1    /1   ]  300.677072385        1
[INPUT] 1    0    [1    /1   ]  313.796680259        1
[INPUT] 1    0    [1    /1   ]  61.7598465093        1
[INPUT] 1    0    [1    /1   ]  7.46974579646        1
[INPUT] 1    0    [1    /1   ]  20.2724410143        1
[INPUT] 1    0    [1    /1   ]  0.788533907309       1
[INPUT] 1    0    [1    /1   ]  2.94661694848        1
[INPUT] 1    0    [1    /1   ]  0.224119305863       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.674487423443, 1.0]], [0, [7617.479664941146, 1.0]], [0, [3617.3686301807825, 1.0]], [0, [1596.911396584689, 1.0]], [0, [384.25107543993107, 1.0]], [0, [118.52112652131663, 1.0]], [0, [44.671995183325095, 1.0]], [0, [19.222572678157363, 1.0]], [0, [6.976449943948547, 1.0]], [0, [0.6333990240718571, 1.0]], [0, [2.802355542336466, 1.0]], [0, [0.2244724180731513, 1.0]], [1, [1362.789410776383, 1.0]], [1, [664.6852041686285, 1.0]], [1, [300.6770723846493, 1.0]], [1, [313.7966802591458, 1.0]], [1, [61.759846509336796, 1.0]], [1, [7.469745796456952, 1.0]], [1, [20.27244101431332, 1.0]], [1, [0.7885339073091178, 1.0]], [1, [2.9466169484771236, 1.0]], [1, [0.22411930586323886, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.67448742]
bas 1, expnt(s) = [7617.47966494]
bas 2, expnt(s) = [3617.36863018]
bas 3, expnt(s) = [1596.91139658]
bas 4, expnt(s) = [384.25107544]
bas 5, expnt(s) = [118.52112652]
bas 6, expnt(s) = [44.67199518]
bas 7, expnt(s) = [19.22257268]
bas 8, expnt(s) = [6.97644994]
bas 9, expnt(s) = [0.63339902]
bas 10, expnt(s) = [2.80235554]
bas 11, expnt(s) = [0.22447242]
bas 12, expnt(s) = [1362.78941078]
bas 13, expnt(s) = [664.68520417]
bas 14, expnt(s) = [300.67707238]
bas 15, expnt(s) = [313.79668026]
bas 16, expnt(s) = [61.75984651]
bas 17, expnt(s) = [7.4697458]
bas 18, expnt(s) = [20.27244101]
bas 19, expnt(s) = [0.78853391]
bas 20, expnt(s) = [2.94661695]
bas 21, expnt(s) = [0.22411931]
CPU time:       417.53
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826745e+04 5.20026564e+03 7.61747966e+03 2.06002980e+03
 3.61736863e+03 1.17844577e+03 1.59691140e+03 6.38227686e+02
 3.84251075e+02 2.19268549e+02 1.18521127e+02 9.07531801e+01
 4.46719952e+01 4.36557583e+01 1.92225727e+01 2.31938935e+01
 6.97644994e+00 1.08452829e+01 6.33399024e-01 1.79379606e+00
 2.80235554e+00 5.47214315e+00 2.24472418e-01 8.23924207e-01
 1.36278941e+03 2.41557391e+04 6.64685204e+02 9.84587702e+03
 3.00677072e+02 3.65266450e+03 3.13796680e+02 3.85296287e+03
 6.17598465e+01 5.05088119e+02 7.46974580e+00 3.60260519e+01
 2.02724410e+01 1.25492263e+02 7.88533907e-01 2.16775331e+00
 2.94661695e+00 1.12626087e+01 2.24119306e-01 4.49866318e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993438335982603
cond(S) = 114386.9780321264
E1 = -729.5432239215124  E_coul = 203.1759299926882
init E= -526.367293928824
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555779654765411  LUMO = 0.895558373291332
  mo_energy =
[-1.18333084e+02 -1.22067904e+01 -9.44704343e+00 -9.44704343e+00
 -9.44704343e+00 -1.24023852e+00 -5.55779655e-01 -5.55779655e-01
 -5.55779655e-01  8.95558373e-01  1.05031830e+00  1.05031830e+00
  1.05031830e+00  7.67493499e+00  7.67493499e+00  7.67493499e+00
  9.49429243e+00  3.44027901e+01  3.44027901e+01  3.44027901e+01
  5.09146409e+01  1.30335017e+02  1.30335017e+02  1.30335017e+02
  1.96320626e+02  4.84658516e+02  4.84658516e+02  4.84658516e+02
  7.16151330e+02  1.33595845e+03  1.33595845e+03  1.33595845e+03
  2.79132963e+03  3.02946603e+03  3.02946603e+03  3.02946603e+03
  6.64943548e+03  6.64943548e+03  6.64943548e+03  9.18990006e+03
  2.55389148e+04  7.62729035e+04]
E1 = -727.8318281723925  E_coul = 201.0815379946813
cycle= 1 E= -526.750290177711  delta_E= -0.383  |g|= 0.187  |ddm|= 0.314
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571309
diis-c [-0.32639395  1.        ]
  HOMO = -0.591457370813194  LUMO = 0.870008705122391
  mo_energy =
[-1.18642867e+02 -1.23457720e+01 -9.59717416e+00 -9.59717416e+00
 -9.59717416e+00 -1.28035051e+00 -5.91457371e-01 -5.91457371e-01
 -5.91457371e-01  8.70008705e-01  1.02484782e+00  1.02484782e+00
  1.02484782e+00  7.58075523e+00  7.58075523e+00  7.58075523e+00
  9.39968314e+00  3.42465698e+01  3.42465698e+01  3.42465698e+01
  5.07531761e+01  1.30105033e+02  1.30105033e+02  1.30105033e+02
  1.96081224e+02  4.84350019e+02  4.84350019e+02  4.84350019e+02
  7.15803290e+02  1.33559326e+03  1.33559326e+03  1.33559326e+03
  2.79083210e+03  3.02903493e+03  3.02903493e+03  3.02903493e+03
  6.64889086e+03  6.64889086e+03  6.64889086e+03  9.18928124e+03
  2.55382009e+04  7.62720990e+04]
E1 = -728.4117845493819  E_coul = 201.66075751350292
cycle= 2 E= -526.751027035879  delta_E= -0.000737  |g|= 0.038  |ddm|= 0.0535
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0778986
diis-c [-0.00382429  0.07698385  0.92301615]
  HOMO = -0.582197789800098  LUMO = 0.87740934039997
  mo_energy =
[-1.18574113e+02 -1.23070817e+01 -9.55680983e+00 -9.55680983e+00
 -9.55680983e+00 -1.26925689e+00 -5.82197790e-01 -5.82197790e-01
 -5.82197790e-01  8.77409340e-01  1.03184461e+00  1.03184461e+00
  1.03184461e+00  7.60544002e+00  7.60544002e+00  7.60544002e+00
  9.42570393e+00  3.42874183e+01  3.42874183e+01  3.42874183e+01
  5.07968139e+01  1.30161794e+02  1.30161794e+02  1.30161794e+02
  1.96140501e+02  4.84417934e+02  4.84417934e+02  4.84417934e+02
  7.15873447e+02  1.33566528e+03  1.33566528e+03  1.33566528e+03
  2.79090735e+03  3.02910921e+03  3.02910921e+03  3.02910921e+03
  6.64896690e+03  6.64896690e+03  6.64896690e+03  9.18935806e+03
  2.55382784e+04  7.62721768e+04]
E1 = -728.2588946498025  E_coul = 201.50780752626224
cycle= 3 E= -526.75108712354  delta_E= -6.01e-05  |g|= 0.00662  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.014133
diis-c [-8.61180809e-07 -1.30704979e-03  1.49101222e-01  8.52205828e-01]
  HOMO = -0.583772614628173  LUMO = 0.876247197473662
  mo_energy =
[-1.18584598e+02 -1.23131826e+01 -9.56327810e+00 -9.56327810e+00
 -9.56327810e+00 -1.27102824e+00 -5.83772615e-01 -5.83772615e-01
 -5.83772615e-01  8.76247197e-01  1.03068084e+00  1.03068084e+00
  1.03068084e+00  7.60138662e+00  7.60138662e+00  7.60138662e+00
  9.42153927e+00  3.42809137e+01  3.42809137e+01  3.42809137e+01
  5.07899670e+01  1.30153014e+02  1.30153014e+02  1.30153014e+02
  1.96131386e+02  4.84407573e+02  4.84407573e+02  4.84407573e+02
  7.15862724e+02  1.33565429e+03  1.33565429e+03  1.33565429e+03
  2.79089572e+03  3.02909782e+03  3.02909782e+03  3.02909782e+03
  6.64895510e+03  6.64895510e+03  6.64895510e+03  9.18934605e+03
  2.55382661e+04  7.62721644e+04]
E1 = -728.282833869951  E_coul = 201.5317446229245
cycle= 4 E= -526.751089247026  delta_E= -2.12e-06  |g|= 0.000109  |ddm|= 0.00234
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000123643
diis-c [-5.20785944e-09  9.06444724e-05 -1.28209330e-02 -7.77345177e-02
  1.09046481e+00]
  HOMO = -0.583754779153846  LUMO = 0.876280081014069
  mo_energy =
[-1.18584552e+02 -1.23131144e+01 -9.56322465e+00 -9.56322465e+00
 -9.56322465e+00 -1.27098492e+00 -5.83754779e-01 -5.83754779e-01
 -5.83754779e-01  8.76280081e-01  1.03069693e+00  1.03069693e+00
  1.03069693e+00  7.60142963e+00  7.60142963e+00  7.60142963e+00
  9.42159843e+00  3.42809656e+01  3.42809656e+01  3.42809656e+01
  5.07900269e+01  1.30153067e+02  1.30153067e+02  1.30153067e+02
  1.96131439e+02  4.84407620e+02  4.84407620e+02  4.84407620e+02
  7.15862763e+02  1.33565433e+03  1.33565433e+03  1.33565433e+03
  2.79089573e+03  3.02909785e+03  3.02909785e+03  3.02909785e+03
  6.64895511e+03  6.64895511e+03  6.64895511e+03  9.18934605e+03
  2.55382661e+04  7.62721644e+04]
E1 = -728.2825966326564  E_coul = 201.53150738344553
cycle= 5 E= -526.751089249211  delta_E= -2.18e-09  |g|= 2.12e-05  |ddm|= 0.000179
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.94842e-05
diis-c [-9.96533429e-11  1.27043802e-05 -1.72988556e-03 -1.25290058e-02
  3.35965243e-02  9.80649663e-01]
  HOMO = -0.58376278103893  LUMO = 0.876276339300835
  mo_energy =
[-1.18584584e+02 -1.23131383e+01 -9.56325048e+00 -9.56325048e+00
 -9.56325048e+00 -1.27099129e+00 -5.83762781e-01 -5.83762781e-01
 -5.83762781e-01  8.76276339e-01  1.03069148e+00  1.03069148e+00
  1.03069148e+00  7.60141166e+00  7.60141166e+00  7.60141166e+00
  9.42158120e+00  3.42809405e+01  3.42809405e+01  3.42809405e+01
  5.07900014e+01  1.30153037e+02  1.30153037e+02  1.30153037e+02
  1.96131410e+02  4.84407588e+02  4.84407588e+02  4.84407588e+02
  7.15862730e+02  1.33565430e+03  1.33565430e+03  1.33565430e+03
  2.79089570e+03  3.02909781e+03  3.02909781e+03  3.02909781e+03
  6.64895507e+03  6.64895507e+03  6.64895507e+03  9.18934601e+03
  2.55382661e+04  7.62721644e+04]
E1 = -728.2826811445658  E_coul = 201.53159189529018
cycle= 6 E= -526.751089249276  delta_E= -6.48e-11  |g|= 1.89e-06  |ddm|= 2.03e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2826811445658  E_coul = 201.53159189529018
  HOMO = -0.583762655871564  LUMO = 0.876276780885322
  mo_energy =
[-1.18584583e+02 -1.23131376e+01 -9.56324986e+00 -9.56324986e+00
 -9.56324986e+00 -1.27099073e+00 -5.83762656e-01 -5.83762656e-01
 -5.83762656e-01  8.76276781e-01  1.03069163e+00  1.03069163e+00
  1.03069163e+00  7.60141209e+00  7.60141209e+00  7.60141209e+00
  9.42158180e+00  3.42809411e+01  3.42809411e+01  3.42809411e+01
  5.07900021e+01  1.30153038e+02  1.30153038e+02  1.30153038e+02
  1.96131411e+02  4.84407589e+02  4.84407589e+02  4.84407589e+02
  7.15862731e+02  1.33565430e+03  1.33565430e+03  1.33565430e+03
  2.79089570e+03  3.02909782e+03  3.02909782e+03  3.02909782e+03
  6.64895508e+03  6.64895508e+03  6.64895508e+03  9.18934601e+03
  2.55382661e+04  7.62721644e+04]
E1 = -728.2826778759674  E_coul = 201.53158862669116
Extra cycle  E= -526.751089249276  delta_E= -5.68e-13  |g|= 4.03e-07  |ddm|= 3.37e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
exp = [2.61826745e+04 7.61747966e+03 3.61736863e+03 1.59691140e+03
 3.84251075e+02 1.18521127e+02 4.46719952e+01 1.92225727e+01
 6.97644994e+00 6.33399024e-01 2.80235554e+00 2.24472418e-01
 1.36278941e+03 6.64685204e+02 3.00677072e+02 3.13796680e+02
 6.17598465e+01 7.46974580e+00 2.02724410e+01 7.88533907e-01
 2.94661695e+00 2.24119306e-01]
E = -526.7510892492762
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:53 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6744874        1
[INPUT] 0    0    [1    /1   ]  7617.47966494        1
[INPUT] 0    0    [1    /1   ]  3617.36863018        1
[INPUT] 0    0    [1    /1   ]  1596.91139658        1
[INPUT] 0    0    [1    /1   ]  384.25107544         1
[INPUT] 0    0    [1    /1   ]  118.521126521        1
[INPUT] 0    0    [1    /1   ]  44.6719951833        1
[INPUT] 0    0    [1    /1   ]  19.2225726782        1
[INPUT] 0    0    [1    /1   ]  6.97644994395        1
[INPUT] 0    0    [1    /1   ]  0.633399024072       1
[INPUT] 0    0    [1    /1   ]  2.80235554234        1
[INPUT] 0    0    [1    /1   ]  0.224472418073       1
[INPUT] 1    0    [1    /1   ]  1362.78941078        1
[INPUT] 1    0    [1    /1   ]  664.685204169        1
[INPUT] 1    0    [1    /1   ]  300.677072385        1
[INPUT] 1    0    [1    /1   ]  313.796680259        1
[INPUT] 1    0    [1    /1   ]  61.7598465093        1
[INPUT] 1    0    [1    /1   ]  7.46974579646        1
[INPUT] 1    0    [1    /1   ]  20.2724410143        1
[INPUT] 1    0    [1    /1   ]  0.788533907309       1
[INPUT] 1    0    [1    /1   ]  2.94661694848        1
[INPUT] 1    0    [1    /1   ]  0.224119305863       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.674487423443, 1.0]], [0, [7617.479664941146, 1.0]], [0, [3617.3686301807825, 1.0]], [0, [1596.911396584689, 1.0]], [0, [384.25107543993107, 1.0]], [0, [118.52112652131663, 1.0]], [0, [44.671995183325095, 1.0]], [0, [19.222572678157363, 1.0]], [0, [6.976449943948547, 1.0]], [0, [0.6333990240718571, 1.0]], [0, [2.802355542336466, 1.0]], [0, [0.2244724180731513, 1.0]], [1, [1362.789410776383, 1.0]], [1, [664.6852041686285, 1.0]], [1, [300.6770723846493, 1.0]], [1, [313.7966802591458, 1.0]], [1, [61.759846509336796, 1.0]], [1, [7.469745796456952, 1.0]], [1, [20.27244101431332, 1.0]], [1, [0.7885339073091178, 1.0]], [1, [2.9466169484771236, 1.0]], [1, [0.22411930586323886, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.67448742]
bas 1, expnt(s) = [7617.47966494]
bas 2, expnt(s) = [3617.36863018]
bas 3, expnt(s) = [1596.91139658]
bas 4, expnt(s) = [384.25107544]
bas 5, expnt(s) = [118.52112652]
bas 6, expnt(s) = [44.67199518]
bas 7, expnt(s) = [19.22257268]
bas 8, expnt(s) = [6.97644994]
bas 9, expnt(s) = [0.63339902]
bas 10, expnt(s) = [2.80235554]
bas 11, expnt(s) = [0.22447242]
bas 12, expnt(s) = [1362.78941078]
bas 13, expnt(s) = [664.68520417]
bas 14, expnt(s) = [300.67707238]
bas 15, expnt(s) = [313.79668026]
bas 16, expnt(s) = [61.75984651]
bas 17, expnt(s) = [7.4697458]
bas 18, expnt(s) = [20.27244101]
bas 19, expnt(s) = [0.78853391]
bas 20, expnt(s) = [2.94661695]
bas 21, expnt(s) = [0.22411931]
CPU time:       417.97
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826745e+04 5.20026564e+03 7.61747966e+03 2.06002980e+03
 3.61736863e+03 1.17844577e+03 1.59691140e+03 6.38227686e+02
 3.84251075e+02 2.19268549e+02 1.18521127e+02 9.07531801e+01
 4.46719952e+01 4.36557583e+01 1.92225727e+01 2.31938935e+01
 6.97644994e+00 1.08452829e+01 6.33399024e-01 1.79379606e+00
 2.80235554e+00 5.47214315e+00 2.24472418e-01 8.23924207e-01
 1.36278941e+03 2.41557391e+04 6.64685204e+02 9.84587702e+03
 3.00677072e+02 3.65266450e+03 3.13796680e+02 3.85296287e+03
 6.17598465e+01 5.05088119e+02 7.46974580e+00 3.60260519e+01
 2.02724410e+01 1.25492263e+02 7.88533907e-01 2.16775331e+00
 2.94661695e+00 1.12626087e+01 2.24119306e-01 4.49866318e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993438335982603
cond(S) = 114386.9780321264
E1 = -729.5432239215124  E_coul = 203.1759299926882
init E= -526.367293928824
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555779654765411  LUMO = 0.895558373291332
  mo_energy =
[-1.18333084e+02 -1.22067904e+01 -9.44704343e+00 -9.44704343e+00
 -9.44704343e+00 -1.24023852e+00 -5.55779655e-01 -5.55779655e-01
 -5.55779655e-01  8.95558373e-01  1.05031830e+00  1.05031830e+00
  1.05031830e+00  7.67493499e+00  7.67493499e+00  7.67493499e+00
  9.49429243e+00  3.44027901e+01  3.44027901e+01  3.44027901e+01
  5.09146409e+01  1.30335017e+02  1.30335017e+02  1.30335017e+02
  1.96320626e+02  4.84658516e+02  4.84658516e+02  4.84658516e+02
  7.16151330e+02  1.33595845e+03  1.33595845e+03  1.33595845e+03
  2.79132963e+03  3.02946603e+03  3.02946603e+03  3.02946603e+03
  6.64943548e+03  6.64943548e+03  6.64943548e+03  9.18990006e+03
  2.55389148e+04  7.62729035e+04]
E1 = -727.8318281723925  E_coul = 201.0815379946813
cycle= 1 E= -526.750290177711  delta_E= -0.383  |g|= 0.187  |ddm|= 0.314
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571309
diis-c [-0.32639395  1.        ]
  HOMO = -0.591457370813194  LUMO = 0.870008705122391
  mo_energy =
[-1.18642867e+02 -1.23457720e+01 -9.59717416e+00 -9.59717416e+00
 -9.59717416e+00 -1.28035051e+00 -5.91457371e-01 -5.91457371e-01
 -5.91457371e-01  8.70008705e-01  1.02484782e+00  1.02484782e+00
  1.02484782e+00  7.58075523e+00  7.58075523e+00  7.58075523e+00
  9.39968314e+00  3.42465698e+01  3.42465698e+01  3.42465698e+01
  5.07531761e+01  1.30105033e+02  1.30105033e+02  1.30105033e+02
  1.96081224e+02  4.84350019e+02  4.84350019e+02  4.84350019e+02
  7.15803290e+02  1.33559326e+03  1.33559326e+03  1.33559326e+03
  2.79083210e+03  3.02903493e+03  3.02903493e+03  3.02903493e+03
  6.64889086e+03  6.64889086e+03  6.64889086e+03  9.18928124e+03
  2.55382009e+04  7.62720990e+04]
E1 = -728.4117845493819  E_coul = 201.66075751350292
cycle= 2 E= -526.751027035879  delta_E= -0.000737  |g|= 0.038  |ddm|= 0.0535
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0778986
diis-c [-0.00382429  0.07698385  0.92301615]
  HOMO = -0.582197789800098  LUMO = 0.87740934039997
  mo_energy =
[-1.18574113e+02 -1.23070817e+01 -9.55680983e+00 -9.55680983e+00
 -9.55680983e+00 -1.26925689e+00 -5.82197790e-01 -5.82197790e-01
 -5.82197790e-01  8.77409340e-01  1.03184461e+00  1.03184461e+00
  1.03184461e+00  7.60544002e+00  7.60544002e+00  7.60544002e+00
  9.42570393e+00  3.42874183e+01  3.42874183e+01  3.42874183e+01
  5.07968139e+01  1.30161794e+02  1.30161794e+02  1.30161794e+02
  1.96140501e+02  4.84417934e+02  4.84417934e+02  4.84417934e+02
  7.15873447e+02  1.33566528e+03  1.33566528e+03  1.33566528e+03
  2.79090735e+03  3.02910921e+03  3.02910921e+03  3.02910921e+03
  6.64896690e+03  6.64896690e+03  6.64896690e+03  9.18935806e+03
  2.55382784e+04  7.62721768e+04]
E1 = -728.2588946498025  E_coul = 201.50780752626224
cycle= 3 E= -526.75108712354  delta_E= -6.01e-05  |g|= 0.00662  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.014133
diis-c [-8.61180809e-07 -1.30704979e-03  1.49101222e-01  8.52205828e-01]
  HOMO = -0.583772614628173  LUMO = 0.876247197473662
  mo_energy =
[-1.18584598e+02 -1.23131826e+01 -9.56327810e+00 -9.56327810e+00
 -9.56327810e+00 -1.27102824e+00 -5.83772615e-01 -5.83772615e-01
 -5.83772615e-01  8.76247197e-01  1.03068084e+00  1.03068084e+00
  1.03068084e+00  7.60138662e+00  7.60138662e+00  7.60138662e+00
  9.42153927e+00  3.42809137e+01  3.42809137e+01  3.42809137e+01
  5.07899670e+01  1.30153014e+02  1.30153014e+02  1.30153014e+02
  1.96131386e+02  4.84407573e+02  4.84407573e+02  4.84407573e+02
  7.15862724e+02  1.33565429e+03  1.33565429e+03  1.33565429e+03
  2.79089572e+03  3.02909782e+03  3.02909782e+03  3.02909782e+03
  6.64895510e+03  6.64895510e+03  6.64895510e+03  9.18934605e+03
  2.55382661e+04  7.62721644e+04]
E1 = -728.282833869951  E_coul = 201.5317446229245
cycle= 4 E= -526.751089247026  delta_E= -2.12e-06  |g|= 0.000109  |ddm|= 0.00234
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000123643
diis-c [-5.20785944e-09  9.06444724e-05 -1.28209330e-02 -7.77345177e-02
  1.09046481e+00]
  HOMO = -0.583754779153846  LUMO = 0.876280081014069
  mo_energy =
[-1.18584552e+02 -1.23131144e+01 -9.56322465e+00 -9.56322465e+00
 -9.56322465e+00 -1.27098492e+00 -5.83754779e-01 -5.83754779e-01
 -5.83754779e-01  8.76280081e-01  1.03069693e+00  1.03069693e+00
  1.03069693e+00  7.60142963e+00  7.60142963e+00  7.60142963e+00
  9.42159843e+00  3.42809656e+01  3.42809656e+01  3.42809656e+01
  5.07900269e+01  1.30153067e+02  1.30153067e+02  1.30153067e+02
  1.96131439e+02  4.84407620e+02  4.84407620e+02  4.84407620e+02
  7.15862763e+02  1.33565433e+03  1.33565433e+03  1.33565433e+03
  2.79089573e+03  3.02909785e+03  3.02909785e+03  3.02909785e+03
  6.64895511e+03  6.64895511e+03  6.64895511e+03  9.18934605e+03
  2.55382661e+04  7.62721644e+04]
E1 = -728.2825966326564  E_coul = 201.53150738344553
cycle= 5 E= -526.751089249211  delta_E= -2.18e-09  |g|= 2.12e-05  |ddm|= 0.000179
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.94842e-05
diis-c [-9.96533429e-11  1.27043802e-05 -1.72988556e-03 -1.25290058e-02
  3.35965243e-02  9.80649663e-01]
  HOMO = -0.58376278103893  LUMO = 0.876276339300835
  mo_energy =
[-1.18584584e+02 -1.23131383e+01 -9.56325048e+00 -9.56325048e+00
 -9.56325048e+00 -1.27099129e+00 -5.83762781e-01 -5.83762781e-01
 -5.83762781e-01  8.76276339e-01  1.03069148e+00  1.03069148e+00
  1.03069148e+00  7.60141166e+00  7.60141166e+00  7.60141166e+00
  9.42158120e+00  3.42809405e+01  3.42809405e+01  3.42809405e+01
  5.07900014e+01  1.30153037e+02  1.30153037e+02  1.30153037e+02
  1.96131410e+02  4.84407588e+02  4.84407588e+02  4.84407588e+02
  7.15862730e+02  1.33565430e+03  1.33565430e+03  1.33565430e+03
  2.79089570e+03  3.02909781e+03  3.02909781e+03  3.02909781e+03
  6.64895507e+03  6.64895507e+03  6.64895507e+03  9.18934601e+03
  2.55382661e+04  7.62721644e+04]
E1 = -728.2826811445658  E_coul = 201.53159189529018
cycle= 6 E= -526.751089249276  delta_E= -6.48e-11  |g|= 1.89e-06  |ddm|= 2.03e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2826811445658  E_coul = 201.53159189529018
  HOMO = -0.583762655871564  LUMO = 0.876276780885322
  mo_energy =
[-1.18584583e+02 -1.23131376e+01 -9.56324986e+00 -9.56324986e+00
 -9.56324986e+00 -1.27099073e+00 -5.83762656e-01 -5.83762656e-01
 -5.83762656e-01  8.76276781e-01  1.03069163e+00  1.03069163e+00
  1.03069163e+00  7.60141209e+00  7.60141209e+00  7.60141209e+00
  9.42158180e+00  3.42809411e+01  3.42809411e+01  3.42809411e+01
  5.07900021e+01  1.30153038e+02  1.30153038e+02  1.30153038e+02
  1.96131411e+02  4.84407589e+02  4.84407589e+02  4.84407589e+02
  7.15862731e+02  1.33565430e+03  1.33565430e+03  1.33565430e+03
  2.79089570e+03  3.02909782e+03  3.02909782e+03  3.02909782e+03
  6.64895508e+03  6.64895508e+03  6.64895508e+03  9.18934601e+03
  2.55382661e+04  7.62721644e+04]
E1 = -728.2826778759674  E_coul = 201.53158862669116
Extra cycle  E= -526.751089249276  delta_E= -5.68e-13  |g|= 4.03e-07  |ddm|= 3.37e-06
    CPU time for scf_cycle      0.23 sec, wall time      0.21 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 114386.9780321264
E1 = -728.2826778759674  E_coul = 201.53158862669116
init E= -526.751089249276
    CPU time for initialize scf      0.79 sec, wall time      0.31 sec
  HOMO = -0.583762736209228  LUMO = 0.876276790548324
  mo_energy =
[-1.18584583e+02 -1.23131379e+01 -9.56325012e+00 -9.56325012e+00
 -9.56325012e+00 -1.27099074e+00 -5.83762736e-01 -5.83762736e-01
 -5.83762736e-01  8.76276791e-01  1.03069158e+00  1.03069158e+00
  1.03069158e+00  7.60141191e+00  7.60141191e+00  7.60141191e+00
  9.42158166e+00  3.42809408e+01  3.42809408e+01  3.42809408e+01
  5.07900019e+01  1.30153038e+02  1.30153038e+02  1.30153038e+02
  1.96131410e+02  4.84407589e+02  4.84407589e+02  4.84407589e+02
  7.15862731e+02  1.33565430e+03  1.33565430e+03  1.33565430e+03
  2.79089570e+03  3.02909782e+03  3.02909782e+03  3.02909782e+03
  6.64895508e+03  6.64895508e+03  6.64895508e+03  9.18934601e+03
  2.55382661e+04  7.62721644e+04]
E1 = -728.2826786233619  E_coul = 201.531589374086
cycle= 1 E= -526.751089249276  delta_E= 3.41e-13  |g|= 9.43e-08  |ddm|= 6.26e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2826786233619  E_coul = 201.531589374086
  HOMO = -0.583762725467613  LUMO = 0.876276813638735
  mo_energy =
[-1.18584583e+02 -1.23131378e+01 -9.56325007e+00 -9.56325007e+00
 -9.56325007e+00 -1.27099071e+00 -5.83762725e-01 -5.83762725e-01
 -5.83762725e-01  8.76276814e-01  1.03069159e+00  1.03069159e+00
  1.03069159e+00  7.60141195e+00  7.60141195e+00  7.60141195e+00
  9.42158170e+00  3.42809409e+01  3.42809409e+01  3.42809409e+01
  5.07900019e+01  1.30153038e+02  1.30153038e+02  1.30153038e+02
  1.96131410e+02  4.84407589e+02  4.84407589e+02  4.84407589e+02
  7.15862731e+02  1.33565430e+03  1.33565430e+03  1.33565430e+03
  2.79089570e+03  3.02909782e+03  3.02909782e+03  3.02909782e+03
  6.64895508e+03  6.64895508e+03  6.64895508e+03  9.18934601e+03
  2.55382661e+04  7.62721644e+04]
E1 = -728.2826783774738  E_coul = 201.53158912819754
Extra cycle  E= -526.751089249276  delta_E= -3.41e-13  |g|= 2.08e-08  |ddm|= 1.46e-07
    CPU time for scf_cycle      0.89 sec, wall time      0.41 sec
exp = [2.61826745e+04 7.61747966e+03 3.61736863e+03 1.59691140e+03
 3.84251075e+02 1.18521127e+02 4.46719952e+01 1.92225727e+01
 6.97644994e+00 6.33399024e-01 2.80235554e+00 2.24472418e-01
 1.36278941e+03 6.64685204e+02 3.00677072e+02 3.13796680e+02
 6.17598465e+01 7.46974580e+00 2.02724410e+01 7.88533907e-01
 2.94661695e+00 2.24119306e-01]
grad_E = [-1.56259616e-06  3.82945845e-06 -1.24070871e-06  8.86904249e-05
 -4.25100157e-04 -2.41484188e-04  3.67829078e-05  1.01045157e-04
  1.01173496e-03 -2.20751014e-03 -2.34510105e-03 -1.62820884e-03
 -5.28226444e-07  4.73326289e-06  2.20349598e-05  1.89842204e-05
  1.03025909e-04 -2.86825807e-03 -4.40400373e-04  1.29393044e-02
  1.02183591e-02 -4.19105303e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:57 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6815245        1
[INPUT] 0    0    [1    /1   ]  7617.46243471        1
[INPUT] 0    0    [1    /1   ]  3617.37414858        1
[INPUT] 0    0    [1    /1   ]  1596.51455027        1
[INPUT] 0    0    [1    /1   ]  385.987188347        1
[INPUT] 0    0    [1    /1   ]  120.139274504        1
[INPUT] 0    0    [1    /1   ]  44.9087521554        1
[INPUT] 0    0    [1    /1   ]  17.5295837338        1
[INPUT] 0    0    [1    /1   ]  7.00656417534        1
[INPUT] 0    0    [1    /1   ]  0.629939676174       1
[INPUT] 0    0    [1    /1   ]  2.80128988372        1
[INPUT] 0    0    [1    /1   ]  0.222890285576       1
[INPUT] 1    0    [1    /1   ]  1362.79173003        1
[INPUT] 1    0    [1    /1   ]  664.663059048        1
[INPUT] 1    0    [1    /1   ]  300.57292029         1
[INPUT] 1    0    [1    /1   ]  313.706937436        1
[INPUT] 1    0    [1    /1   ]  61.7721308655        1
[INPUT] 1    0    [1    /1   ]  7.53815013063        1
[INPUT] 1    0    [1    /1   ]  20.3403239552        1
[INPUT] 1    0    [1    /1   ]  0.793565247228       1
[INPUT] 1    0    [1    /1   ]  2.99163814228        1
[INPUT] 1    0    [1    /1   ]  0.225034425127       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.681524523545, 1.0]], [0, [7617.462434709476, 1.0]], [0, [3617.374148583474, 1.0]], [0, [1596.5145502740063, 1.0]], [0, [385.98718834695393, 1.0]], [0, [120.13927450358278, 1.0]], [0, [44.9087521553807, 1.0]], [0, [17.52958373383295, 1.0]], [0, [7.006564175343076, 1.0]], [0, [0.6299396761743593, 1.0]], [0, [2.801289883718184, 1.0]], [0, [0.22289028557556073, 1.0]], [1, [1362.7917300291563, 1.0]], [1, [664.6630590483894, 1.0]], [1, [300.57292029039803, 1.0]], [1, [313.7069374363261, 1.0]], [1, [61.772130865512274, 1.0]], [1, [7.538150130633924, 1.0]], [1, [20.340323955154613, 1.0]], [1, [0.7935652472278621, 1.0]], [1, [2.9916381422765537, 1.0]], [1, [0.22503442512663305, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.68152452]
bas 1, expnt(s) = [7617.46243471]
bas 2, expnt(s) = [3617.37414858]
bas 3, expnt(s) = [1596.51455027]
bas 4, expnt(s) = [385.98718835]
bas 5, expnt(s) = [120.1392745]
bas 6, expnt(s) = [44.90875216]
bas 7, expnt(s) = [17.52958373]
bas 8, expnt(s) = [7.00656418]
bas 9, expnt(s) = [0.62993968]
bas 10, expnt(s) = [2.80128988]
bas 11, expnt(s) = [0.22289029]
bas 12, expnt(s) = [1362.79173003]
bas 13, expnt(s) = [664.66305905]
bas 14, expnt(s) = [300.57292029]
bas 15, expnt(s) = [313.70693744]
bas 16, expnt(s) = [61.77213087]
bas 17, expnt(s) = [7.53815013]
bas 18, expnt(s) = [20.34032396]
bas 19, expnt(s) = [0.79356525]
bas 20, expnt(s) = [2.99163814]
bas 21, expnt(s) = [0.22503443]
CPU time:       423.46
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826815e+04 5.20026669e+03 7.61746243e+03 2.06002630e+03
 3.61737415e+03 1.17844711e+03 1.59651455e+03 6.38108728e+02
 3.85987188e+02 2.20011150e+02 1.20139275e+02 9.16808810e+01
 4.49087522e+01 4.38291719e+01 1.75295837e+01 2.16443091e+01
 7.00656418e+00 1.08803747e+01 6.29939676e-01 1.78644334e+00
 2.80128988e+00 5.47058240e+00 2.22890286e-01 8.19564955e-01
 1.36279173e+03 2.41557905e+04 6.64663059e+02 9.84546698e+03
 3.00572920e+02 3.65108300e+03 3.13706937e+02 3.85158553e+03
 6.17721309e+01 5.05213703e+02 7.53815013e+00 3.64389095e+01
 2.03403240e+01 1.26017751e+02 7.93565247e-01 2.18505661e+00
 2.99163814e+00 1.14781189e+01 2.25034425e-01 4.52163595e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993253483027303
cond(S) = 113953.83666799616
E1 = -729.5439357151511  E_coul = 203.17627100498888
init E= -526.367664710162
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555759285739245  LUMO = 0.885973772220751
  mo_energy =
[-1.18333518e+02 -1.22067822e+01 -9.44698311e+00 -9.44698311e+00
 -9.44698311e+00 -1.24025314e+00 -5.55759286e-01 -5.55759286e-01
 -5.55759286e-01  8.85973772e-01  1.05854805e+00  1.05854805e+00
  1.05854805e+00  7.79443774e+00  7.79443774e+00  7.79443774e+00
  9.39729351e+00  3.47885978e+01  3.47885978e+01  3.47885978e+01
  4.88696323e+01  1.30935631e+02  1.30935631e+02  1.30935631e+02
  1.92050652e+02  4.85188409e+02  4.85188409e+02  4.85188409e+02
  7.15635672e+02  1.33623521e+03  1.33623521e+03  1.33623521e+03
  2.79628224e+03  3.02943316e+03  3.02943316e+03  3.02943316e+03
  6.64917816e+03  6.64917816e+03  6.64917816e+03  9.19622056e+03
  2.55450783e+04  7.62786242e+04]
E1 = -727.8365005545095  E_coul = 201.08545496797748
cycle= 1 E= -526.751045586532  delta_E= -0.383  |g|= 0.187  |ddm|= 0.32
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.569426
diis-c [-0.32424632  1.        ]
  HOMO = -0.591413154969814  LUMO = 0.860721591538661
  mo_energy =
[-1.18642698e+02 -1.23454888e+01 -9.59685532e+00 -9.59685532e+00
 -9.59685532e+00 -1.28030914e+00 -5.91413155e-01 -5.91413155e-01
 -5.91413155e-01  8.60721592e-01  1.03287287e+00  1.03287287e+00
  1.03287287e+00  7.69963284e+00  7.69963284e+00  7.69963284e+00
  9.30354826e+00  3.46323418e+01  3.46323418e+01  3.46323418e+01
  4.87110535e+01  1.30706175e+02  1.30706175e+02  1.30706175e+02
  1.91811939e+02  4.84880542e+02  4.84880542e+02  4.84880542e+02
  7.15287461e+02  1.33587075e+03  1.33587075e+03  1.33587075e+03
  2.79578532e+03  3.02900283e+03  3.02900283e+03  3.02900283e+03
  6.64863437e+03  6.64863437e+03  6.64863437e+03  9.19560261e+03
  2.55443654e+04  7.62778206e+04]
E1 = -728.4148858139338  E_coul = 201.66310573215856
cycle= 2 E= -526.751780081775  delta_E= -0.000734  |g|= 0.038  |ddm|= 0.0534
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776865
diis-c [-0.00377215  0.07751899  0.92248101]
  HOMO = -0.582190740230975  LUMO = 0.868030974203433
  mo_energy =
[-1.18574154e+02 -1.23069220e+01 -9.55662198e+00 -9.55662198e+00
 -9.55662198e+00 -1.26925734e+00 -5.82190740e-01 -5.82190740e-01
 -5.82190740e-01  8.68030974e-01  1.03990642e+00  1.03990642e+00
  1.03990642e+00  7.72442799e+00  7.72442799e+00  7.72442799e+00
  9.32928200e+00  3.46731397e+01  3.46731397e+01  3.46731397e+01
  4.87539023e+01  1.30762756e+02  1.30762756e+02  1.30762756e+02
  1.91870986e+02  4.84948241e+02  4.84948241e+02  4.84948241e+02
  7.15357472e+02  1.33594254e+03  1.33594254e+03  1.33594254e+03
  2.79586034e+03  3.02907688e+03  3.02907688e+03  3.02907688e+03
  6.64871018e+03  6.64871018e+03  6.64871018e+03  9.19567920e+03
  2.55444425e+04  7.62778981e+04]
E1 = -728.2626256877942  E_coul = 201.5107858330686
cycle= 3 E= -526.751839854726  delta_E= -5.98e-05  |g|= 0.00657  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140368
diis-c [-8.60473483e-07 -1.29847738e-03  1.48554755e-01  8.52743723e-01]
  HOMO = -0.583754151104719  LUMO = 0.866888849271866
  mo_energy =
[-1.18584560e+02 -1.23129763e+01 -9.56304221e+00 -9.56304221e+00
 -9.56304221e+00 -1.27101394e+00 -5.83754151e-01 -5.83754151e-01
 -5.83754151e-01  8.66888849e-01  1.03874064e+00  1.03874064e+00
  1.03874064e+00  7.72037352e+00  7.72037352e+00  7.72037352e+00
  9.32517915e+00  3.46666717e+01  3.46666717e+01  3.46666717e+01
  4.87472016e+01  1.30754044e+02  1.30754044e+02  1.30754044e+02
  1.91861949e+02  4.84937959e+02  4.84937959e+02  4.84937959e+02
  7.15346819e+02  1.33593164e+03  1.33593164e+03  1.33593164e+03
  2.79584879e+03  3.02906558e+03  3.02906558e+03  3.02906558e+03
  6.64869846e+03  6.64869846e+03  6.64869846e+03  9.19566726e+03
  2.55444304e+04  7.62778859e+04]
E1 = -728.2863571665935  E_coul = 201.53451522063543
cycle= 4 E= -526.751841945958  delta_E= -2.09e-06  |g|= 0.00011  |ddm|= 0.00232
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000126815
diis-c [-5.29847038e-09  9.28840541e-05 -1.31129683e-02 -8.00065011e-02
  1.09302659e+00]
  HOMO = -0.583736891704223  LUMO = 0.866921343699723
  mo_energy =
[-1.18584516e+02 -1.23129095e+01 -9.56299037e+00 -9.56299037e+00
 -9.56299037e+00 -1.27097091e+00 -5.83736892e-01 -5.83736892e-01
 -5.83736892e-01  8.66921344e-01  1.03875646e+00  1.03875646e+00
  1.03875646e+00  7.72041558e+00  7.72041558e+00  7.72041558e+00
  9.32523720e+00  3.46667220e+01  3.46667220e+01  3.46667220e+01
  4.87472600e+01  1.30754094e+02  1.30754094e+02  1.30754094e+02
  1.91862000e+02  4.84938003e+02  4.84938003e+02  4.84938003e+02
  7.15346855e+02  1.33593167e+03  1.33593167e+03  1.33593167e+03
  2.79584880e+03  3.02906560e+03  3.02906560e+03  3.02906560e+03
  6.64869847e+03  6.64869847e+03  6.64869847e+03  9.19566726e+03
  2.55444304e+04  7.62778858e+04]
E1 = -728.2861238709189  E_coul = 201.5342819227192
cycle= 5 E= -526.7518419482  delta_E= -2.24e-09  |g|= 2.11e-05  |ddm|= 0.000182
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93465e-05
diis-c [-1.01802527e-10  1.26433312e-05 -1.71360850e-03 -1.24952431e-02
  3.32864330e-02  9.80909775e-01]
  HOMO = -0.583744945086215  LUMO = 0.86691760181949
  mo_energy =
[-1.18584548e+02 -1.23129335e+01 -9.56301632e+00 -9.56301632e+00
 -9.56301632e+00 -1.27097733e+00 -5.83744945e-01 -5.83744945e-01
 -5.83744945e-01  8.66917602e-01  1.03875092e+00  1.03875092e+00
  1.03875092e+00  7.72039740e+00  7.72039740e+00  7.72039740e+00
  9.32521997e+00  3.46666968e+01  3.46666968e+01  3.46666968e+01
  4.87472346e+01  1.30754065e+02  1.30754065e+02  1.30754065e+02
  1.91861970e+02  4.84937971e+02  4.84937971e+02  4.84937971e+02
  7.15346823e+02  1.33593164e+03  1.33593164e+03  1.33593164e+03
  2.79584877e+03  3.02906557e+03  3.02906557e+03  3.02906557e+03
  6.64869844e+03  6.64869844e+03  6.64869844e+03  9.19566723e+03
  2.55444304e+04  7.62778858e+04]
E1 = -728.286208465635  E_coul = 201.53436651736982
cycle= 6 E= -526.751841948265  delta_E= -6.55e-11  |g|= 1.9e-06  |ddm|= 2.04e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.286208465635  E_coul = 201.53436651736982
  HOMO = -0.58374480544242  LUMO = 0.866918050121201
  mo_energy =
[-1.18584547e+02 -1.23129328e+01 -9.56301563e+00 -9.56301563e+00
 -9.56301563e+00 -1.27097675e+00 -5.83744805e-01 -5.83744805e-01
 -5.83744805e-01  8.66918050e-01  1.03875108e+00  1.03875108e+00
  1.03875108e+00  7.72039787e+00  7.72039787e+00  7.72039787e+00
  9.32522060e+00  3.46666975e+01  3.46666975e+01  3.46666975e+01
  4.87472354e+01  1.30754066e+02  1.30754066e+02  1.30754066e+02
  1.91861971e+02  4.84937972e+02  4.84937972e+02  4.84937972e+02
  7.15346824e+02  1.33593164e+03  1.33593164e+03  1.33593164e+03
  2.79584877e+03  3.02906557e+03  3.02906557e+03  3.02906557e+03
  6.64869844e+03  6.64869844e+03  6.64869844e+03  9.19566723e+03
  2.55444304e+04  7.62778858e+04]
E1 = -728.2862049574499  E_coul = 201.53436300918352
Extra cycle  E= -526.751841948266  delta_E= -1.14e-12  |g|= 4.07e-07  |ddm|= 3.38e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
exp = [2.61826815e+04 7.61746243e+03 3.61737415e+03 1.59651455e+03
 3.85987188e+02 1.20139275e+02 4.49087522e+01 1.75295837e+01
 7.00656418e+00 6.29939676e-01 2.80128988e+00 2.22890286e-01
 1.36279173e+03 6.64663059e+02 3.00572920e+02 3.13706937e+02
 6.17721309e+01 7.53815013e+00 2.03403240e+01 7.93565247e-01
 2.99163814e+00 2.25034425e-01]
E = -526.7518419482664
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:26:58 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6815245        1
[INPUT] 0    0    [1    /1   ]  7617.46243471        1
[INPUT] 0    0    [1    /1   ]  3617.37414858        1
[INPUT] 0    0    [1    /1   ]  1596.51455027        1
[INPUT] 0    0    [1    /1   ]  385.987188347        1
[INPUT] 0    0    [1    /1   ]  120.139274504        1
[INPUT] 0    0    [1    /1   ]  44.9087521554        1
[INPUT] 0    0    [1    /1   ]  17.5295837338        1
[INPUT] 0    0    [1    /1   ]  7.00656417534        1
[INPUT] 0    0    [1    /1   ]  0.629939676174       1
[INPUT] 0    0    [1    /1   ]  2.80128988372        1
[INPUT] 0    0    [1    /1   ]  0.222890285576       1
[INPUT] 1    0    [1    /1   ]  1362.79173003        1
[INPUT] 1    0    [1    /1   ]  664.663059048        1
[INPUT] 1    0    [1    /1   ]  300.57292029         1
[INPUT] 1    0    [1    /1   ]  313.706937436        1
[INPUT] 1    0    [1    /1   ]  61.7721308655        1
[INPUT] 1    0    [1    /1   ]  7.53815013063        1
[INPUT] 1    0    [1    /1   ]  20.3403239552        1
[INPUT] 1    0    [1    /1   ]  0.793565247228       1
[INPUT] 1    0    [1    /1   ]  2.99163814228        1
[INPUT] 1    0    [1    /1   ]  0.225034425127       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.681524523545, 1.0]], [0, [7617.462434709476, 1.0]], [0, [3617.374148583474, 1.0]], [0, [1596.5145502740063, 1.0]], [0, [385.98718834695393, 1.0]], [0, [120.13927450358278, 1.0]], [0, [44.9087521553807, 1.0]], [0, [17.52958373383295, 1.0]], [0, [7.006564175343076, 1.0]], [0, [0.6299396761743593, 1.0]], [0, [2.801289883718184, 1.0]], [0, [0.22289028557556073, 1.0]], [1, [1362.7917300291563, 1.0]], [1, [664.6630590483894, 1.0]], [1, [300.57292029039803, 1.0]], [1, [313.7069374363261, 1.0]], [1, [61.772130865512274, 1.0]], [1, [7.538150130633924, 1.0]], [1, [20.340323955154613, 1.0]], [1, [0.7935652472278621, 1.0]], [1, [2.9916381422765537, 1.0]], [1, [0.22503442512663305, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.68152452]
bas 1, expnt(s) = [7617.46243471]
bas 2, expnt(s) = [3617.37414858]
bas 3, expnt(s) = [1596.51455027]
bas 4, expnt(s) = [385.98718835]
bas 5, expnt(s) = [120.1392745]
bas 6, expnt(s) = [44.90875216]
bas 7, expnt(s) = [17.52958373]
bas 8, expnt(s) = [7.00656418]
bas 9, expnt(s) = [0.62993968]
bas 10, expnt(s) = [2.80128988]
bas 11, expnt(s) = [0.22289029]
bas 12, expnt(s) = [1362.79173003]
bas 13, expnt(s) = [664.66305905]
bas 14, expnt(s) = [300.57292029]
bas 15, expnt(s) = [313.70693744]
bas 16, expnt(s) = [61.77213087]
bas 17, expnt(s) = [7.53815013]
bas 18, expnt(s) = [20.34032396]
bas 19, expnt(s) = [0.79356525]
bas 20, expnt(s) = [2.99163814]
bas 21, expnt(s) = [0.22503443]
CPU time:       423.93
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826815e+04 5.20026669e+03 7.61746243e+03 2.06002630e+03
 3.61737415e+03 1.17844711e+03 1.59651455e+03 6.38108728e+02
 3.85987188e+02 2.20011150e+02 1.20139275e+02 9.16808810e+01
 4.49087522e+01 4.38291719e+01 1.75295837e+01 2.16443091e+01
 7.00656418e+00 1.08803747e+01 6.29939676e-01 1.78644334e+00
 2.80128988e+00 5.47058240e+00 2.22890286e-01 8.19564955e-01
 1.36279173e+03 2.41557905e+04 6.64663059e+02 9.84546698e+03
 3.00572920e+02 3.65108300e+03 3.13706937e+02 3.85158553e+03
 6.17721309e+01 5.05213703e+02 7.53815013e+00 3.64389095e+01
 2.03403240e+01 1.26017751e+02 7.93565247e-01 2.18505661e+00
 2.99163814e+00 1.14781189e+01 2.25034425e-01 4.52163595e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993253483027303
cond(S) = 113953.83666799616
E1 = -729.5439357151511  E_coul = 203.17627100498888
init E= -526.367664710162
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555759285739245  LUMO = 0.885973772220751
  mo_energy =
[-1.18333518e+02 -1.22067822e+01 -9.44698311e+00 -9.44698311e+00
 -9.44698311e+00 -1.24025314e+00 -5.55759286e-01 -5.55759286e-01
 -5.55759286e-01  8.85973772e-01  1.05854805e+00  1.05854805e+00
  1.05854805e+00  7.79443774e+00  7.79443774e+00  7.79443774e+00
  9.39729351e+00  3.47885978e+01  3.47885978e+01  3.47885978e+01
  4.88696323e+01  1.30935631e+02  1.30935631e+02  1.30935631e+02
  1.92050652e+02  4.85188409e+02  4.85188409e+02  4.85188409e+02
  7.15635672e+02  1.33623521e+03  1.33623521e+03  1.33623521e+03
  2.79628224e+03  3.02943316e+03  3.02943316e+03  3.02943316e+03
  6.64917816e+03  6.64917816e+03  6.64917816e+03  9.19622056e+03
  2.55450783e+04  7.62786242e+04]
E1 = -727.8365005545095  E_coul = 201.08545496797748
cycle= 1 E= -526.751045586532  delta_E= -0.383  |g|= 0.187  |ddm|= 0.32
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.569426
diis-c [-0.32424632  1.        ]
  HOMO = -0.591413154969814  LUMO = 0.860721591538661
  mo_energy =
[-1.18642698e+02 -1.23454888e+01 -9.59685532e+00 -9.59685532e+00
 -9.59685532e+00 -1.28030914e+00 -5.91413155e-01 -5.91413155e-01
 -5.91413155e-01  8.60721592e-01  1.03287287e+00  1.03287287e+00
  1.03287287e+00  7.69963284e+00  7.69963284e+00  7.69963284e+00
  9.30354826e+00  3.46323418e+01  3.46323418e+01  3.46323418e+01
  4.87110535e+01  1.30706175e+02  1.30706175e+02  1.30706175e+02
  1.91811939e+02  4.84880542e+02  4.84880542e+02  4.84880542e+02
  7.15287461e+02  1.33587075e+03  1.33587075e+03  1.33587075e+03
  2.79578532e+03  3.02900283e+03  3.02900283e+03  3.02900283e+03
  6.64863437e+03  6.64863437e+03  6.64863437e+03  9.19560261e+03
  2.55443654e+04  7.62778206e+04]
E1 = -728.4148858139338  E_coul = 201.66310573215856
cycle= 2 E= -526.751780081775  delta_E= -0.000734  |g|= 0.038  |ddm|= 0.0534
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0776865
diis-c [-0.00377215  0.07751899  0.92248101]
  HOMO = -0.582190740230975  LUMO = 0.868030974203433
  mo_energy =
[-1.18574154e+02 -1.23069220e+01 -9.55662198e+00 -9.55662198e+00
 -9.55662198e+00 -1.26925734e+00 -5.82190740e-01 -5.82190740e-01
 -5.82190740e-01  8.68030974e-01  1.03990642e+00  1.03990642e+00
  1.03990642e+00  7.72442799e+00  7.72442799e+00  7.72442799e+00
  9.32928200e+00  3.46731397e+01  3.46731397e+01  3.46731397e+01
  4.87539023e+01  1.30762756e+02  1.30762756e+02  1.30762756e+02
  1.91870986e+02  4.84948241e+02  4.84948241e+02  4.84948241e+02
  7.15357472e+02  1.33594254e+03  1.33594254e+03  1.33594254e+03
  2.79586034e+03  3.02907688e+03  3.02907688e+03  3.02907688e+03
  6.64871018e+03  6.64871018e+03  6.64871018e+03  9.19567920e+03
  2.55444425e+04  7.62778981e+04]
E1 = -728.2626256877942  E_coul = 201.5107858330686
cycle= 3 E= -526.751839854726  delta_E= -5.98e-05  |g|= 0.00657  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140368
diis-c [-8.60473483e-07 -1.29847738e-03  1.48554755e-01  8.52743723e-01]
  HOMO = -0.583754151104719  LUMO = 0.866888849271866
  mo_energy =
[-1.18584560e+02 -1.23129763e+01 -9.56304221e+00 -9.56304221e+00
 -9.56304221e+00 -1.27101394e+00 -5.83754151e-01 -5.83754151e-01
 -5.83754151e-01  8.66888849e-01  1.03874064e+00  1.03874064e+00
  1.03874064e+00  7.72037352e+00  7.72037352e+00  7.72037352e+00
  9.32517915e+00  3.46666717e+01  3.46666717e+01  3.46666717e+01
  4.87472016e+01  1.30754044e+02  1.30754044e+02  1.30754044e+02
  1.91861949e+02  4.84937959e+02  4.84937959e+02  4.84937959e+02
  7.15346819e+02  1.33593164e+03  1.33593164e+03  1.33593164e+03
  2.79584879e+03  3.02906558e+03  3.02906558e+03  3.02906558e+03
  6.64869846e+03  6.64869846e+03  6.64869846e+03  9.19566726e+03
  2.55444304e+04  7.62778859e+04]
E1 = -728.2863571665935  E_coul = 201.53451522063543
cycle= 4 E= -526.751841945958  delta_E= -2.09e-06  |g|= 0.00011  |ddm|= 0.00232
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000126815
diis-c [-5.29847038e-09  9.28840541e-05 -1.31129683e-02 -8.00065011e-02
  1.09302659e+00]
  HOMO = -0.583736891704223  LUMO = 0.866921343699723
  mo_energy =
[-1.18584516e+02 -1.23129095e+01 -9.56299037e+00 -9.56299037e+00
 -9.56299037e+00 -1.27097091e+00 -5.83736892e-01 -5.83736892e-01
 -5.83736892e-01  8.66921344e-01  1.03875646e+00  1.03875646e+00
  1.03875646e+00  7.72041558e+00  7.72041558e+00  7.72041558e+00
  9.32523720e+00  3.46667220e+01  3.46667220e+01  3.46667220e+01
  4.87472600e+01  1.30754094e+02  1.30754094e+02  1.30754094e+02
  1.91862000e+02  4.84938003e+02  4.84938003e+02  4.84938003e+02
  7.15346855e+02  1.33593167e+03  1.33593167e+03  1.33593167e+03
  2.79584880e+03  3.02906560e+03  3.02906560e+03  3.02906560e+03
  6.64869847e+03  6.64869847e+03  6.64869847e+03  9.19566726e+03
  2.55444304e+04  7.62778858e+04]
E1 = -728.2861238709189  E_coul = 201.5342819227192
cycle= 5 E= -526.7518419482  delta_E= -2.24e-09  |g|= 2.11e-05  |ddm|= 0.000182
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93465e-05
diis-c [-1.01802527e-10  1.26433312e-05 -1.71360850e-03 -1.24952431e-02
  3.32864330e-02  9.80909775e-01]
  HOMO = -0.583744945086215  LUMO = 0.86691760181949
  mo_energy =
[-1.18584548e+02 -1.23129335e+01 -9.56301632e+00 -9.56301632e+00
 -9.56301632e+00 -1.27097733e+00 -5.83744945e-01 -5.83744945e-01
 -5.83744945e-01  8.66917602e-01  1.03875092e+00  1.03875092e+00
  1.03875092e+00  7.72039740e+00  7.72039740e+00  7.72039740e+00
  9.32521997e+00  3.46666968e+01  3.46666968e+01  3.46666968e+01
  4.87472346e+01  1.30754065e+02  1.30754065e+02  1.30754065e+02
  1.91861970e+02  4.84937971e+02  4.84937971e+02  4.84937971e+02
  7.15346823e+02  1.33593164e+03  1.33593164e+03  1.33593164e+03
  2.79584877e+03  3.02906557e+03  3.02906557e+03  3.02906557e+03
  6.64869844e+03  6.64869844e+03  6.64869844e+03  9.19566723e+03
  2.55444304e+04  7.62778858e+04]
E1 = -728.286208465635  E_coul = 201.53436651736982
cycle= 6 E= -526.751841948265  delta_E= -6.55e-11  |g|= 1.9e-06  |ddm|= 2.04e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.286208465635  E_coul = 201.53436651736982
  HOMO = -0.58374480544242  LUMO = 0.866918050121201
  mo_energy =
[-1.18584547e+02 -1.23129328e+01 -9.56301563e+00 -9.56301563e+00
 -9.56301563e+00 -1.27097675e+00 -5.83744805e-01 -5.83744805e-01
 -5.83744805e-01  8.66918050e-01  1.03875108e+00  1.03875108e+00
  1.03875108e+00  7.72039787e+00  7.72039787e+00  7.72039787e+00
  9.32522060e+00  3.46666975e+01  3.46666975e+01  3.46666975e+01
  4.87472354e+01  1.30754066e+02  1.30754066e+02  1.30754066e+02
  1.91861971e+02  4.84937972e+02  4.84937972e+02  4.84937972e+02
  7.15346824e+02  1.33593164e+03  1.33593164e+03  1.33593164e+03
  2.79584877e+03  3.02906557e+03  3.02906557e+03  3.02906557e+03
  6.64869844e+03  6.64869844e+03  6.64869844e+03  9.19566723e+03
  2.55444304e+04  7.62778858e+04]
E1 = -728.2862049574499  E_coul = 201.53436300918352
Extra cycle  E= -526.751841948266  delta_E= -1.14e-12  |g|= 4.07e-07  |ddm|= 3.38e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113953.83666799616
E1 = -728.2862049574499  E_coul = 201.53436300918352
init E= -526.751841948266
    CPU time for initialize scf      0.80 sec, wall time      0.32 sec
  HOMO = -0.583744890798017  LUMO = 0.86691805579641
  mo_energy =
[-1.18584547e+02 -1.23129330e+01 -9.56301591e+00 -9.56301591e+00
 -9.56301591e+00 -1.27097676e+00 -5.83744891e-01 -5.83744891e-01
 -5.83744891e-01  8.66918056e-01  1.03875103e+00  1.03875103e+00
  1.03875103e+00  7.72039768e+00  7.72039768e+00  7.72039768e+00
  9.32522045e+00  3.46666972e+01  3.46666972e+01  3.46666972e+01
  4.87472351e+01  1.30754065e+02  1.30754065e+02  1.30754065e+02
  1.91861971e+02  4.84937972e+02  4.84937972e+02  4.84937972e+02
  7.15346823e+02  1.33593164e+03  1.33593164e+03  1.33593164e+03
  2.79584877e+03  3.02906557e+03  3.02906557e+03  3.02906557e+03
  6.64869844e+03  6.64869844e+03  6.64869844e+03  9.19566723e+03
  2.55444304e+04  7.62778858e+04]
E1 = -728.2862057651622  E_coul = 201.53436381689673
cycle= 1 E= -526.751841948265  delta_E= 9.09e-13  |g|= 9.63e-08  |ddm|= 6.23e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2862057651622  E_coul = 201.53436381689673
  HOMO = -0.583744879010645  LUMO = 0.866918079486199
  mo_energy =
[-1.18584547e+02 -1.23129330e+01 -9.56301585e+00 -9.56301585e+00
 -9.56301585e+00 -1.27097673e+00 -5.83744879e-01 -5.83744879e-01
 -5.83744879e-01  8.66918079e-01  1.03875104e+00  1.03875104e+00
  1.03875104e+00  7.72039772e+00  7.72039772e+00  7.72039772e+00
  9.32522050e+00  3.46666973e+01  3.46666973e+01  3.46666973e+01
  4.87472352e+01  1.30754065e+02  1.30754065e+02  1.30754065e+02
  1.91861971e+02  4.84937972e+02  4.84937972e+02  4.84937972e+02
  7.15346823e+02  1.33593164e+03  1.33593164e+03  1.33593164e+03
  2.79584877e+03  3.02906557e+03  3.02906557e+03  3.02906557e+03
  6.64869844e+03  6.64869844e+03  6.64869844e+03  9.19566723e+03
  2.55444304e+04  7.62778858e+04]
E1 = -728.2862055011658  E_coul = 201.53436355290043
Extra cycle  E= -526.751841948265  delta_E= 1.14e-13  |g|= 2.15e-08  |ddm|= 1.47e-07
    CPU time for scf_cycle      0.91 sec, wall time      0.43 sec
exp = [2.61826815e+04 7.61746243e+03 3.61737415e+03 1.59651455e+03
 3.85987188e+02 1.20139275e+02 4.49087522e+01 1.75295837e+01
 7.00656418e+00 6.29939676e-01 2.80128988e+00 2.22890286e-01
 1.36279173e+03 6.64663059e+02 3.00572920e+02 3.13706937e+02
 6.17721309e+01 7.53815013e+00 2.03403240e+01 7.93565247e-01
 2.99163814e+00 2.25034425e-01]
grad_E = [-1.56146777e-06  3.81512865e-06 -1.26891198e-06  8.86150803e-05
 -4.51507149e-04 -1.57002805e-04  2.04756036e-04 -1.07932487e-04
  1.03763271e-03 -2.30595084e-03 -2.53757513e-03 -2.84023393e-03
 -5.25136605e-07  4.78371337e-06  2.23438398e-05  1.92446922e-05
  7.54778965e-05 -3.48143168e-03 -3.72780383e-04  1.57261327e-02
  1.27354269e-02 -4.99707583e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:02 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6894003        1
[INPUT] 0    0    [1    /1   ]  7617.44325975        1
[INPUT] 0    0    [1    /1   ]  3617.38042563        1
[INPUT] 0    0    [1    /1   ]  1596.07482561        1
[INPUT] 0    0    [1    /1   ]  387.824316193        1
[INPUT] 0    0    [1    /1   ]  122.1949287          1
[INPUT] 0    0    [1    /1   ]  45.3444073257        1
[INPUT] 0    0    [1    /1   ]  16.1193251635        1
[INPUT] 0    0    [1    /1   ]  7.09677046054        1
[INPUT] 0    0    [1    /1   ]  0.632982451528       1
[INPUT] 0    0    [1    /1   ]  2.83045593769        1
[INPUT] 0    0    [1    /1   ]  0.224480407617       1
[INPUT] 1    0    [1    /1   ]  1362.79432845        1
[INPUT] 1    0    [1    /1   ]  664.638224195        1
[INPUT] 1    0    [1    /1   ]  300.456113728        1
[INPUT] 1    0    [1    /1   ]  313.606287931        1
[INPUT] 1    0    [1    /1   ]  61.7839567853        1
[INPUT] 1    0    [1    /1   ]  7.57142974707        1
[INPUT] 1    0    [1    /1   ]  20.4468400292        1
[INPUT] 1    0    [1    /1   ]  0.793523897135       1
[INPUT] 1    0    [1    /1   ]  2.98535603578        1
[INPUT] 1    0    [1    /1   ]  0.225354678231       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.68940030312, 1.0]], [0, [7617.443259754306, 1.0]], [0, [3617.380425634066, 1.0]], [0, [1596.0748256072961, 1.0]], [0, [387.8243161930035, 1.0]], [0, [122.19492869963834, 1.0]], [0, [45.34440732572713, 1.0]], [0, [16.119325163547046, 1.0]], [0, [7.096770460538909, 1.0]], [0, [0.6329824515282043, 1.0]], [0, [2.8304559376884795, 1.0]], [0, [0.2244804076172831, 1.0]], [1, [1362.7943284470593, 1.0]], [1, [664.6382241953836, 1.0]], [1, [300.45611372775284, 1.0]], [1, [313.6062879308091, 1.0]], [1, [61.78395678531011, 1.0]], [1, [7.571429747073134, 1.0]], [1, [20.446840029203823, 1.0]], [1, [0.7935238971352436, 1.0]], [1, [2.9853560357804323, 1.0]], [1, [0.2253546782308298, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6894003]
bas 1, expnt(s) = [7617.44325975]
bas 2, expnt(s) = [3617.38042563]
bas 3, expnt(s) = [1596.07482561]
bas 4, expnt(s) = [387.82431619]
bas 5, expnt(s) = [122.1949287]
bas 6, expnt(s) = [45.34440733]
bas 7, expnt(s) = [16.11932516]
bas 8, expnt(s) = [7.09677046]
bas 9, expnt(s) = [0.63298245]
bas 10, expnt(s) = [2.83045594]
bas 11, expnt(s) = [0.22448041]
bas 12, expnt(s) = [1362.79432845]
bas 13, expnt(s) = [664.6382242]
bas 14, expnt(s) = [300.45611373]
bas 15, expnt(s) = [313.60628793]
bas 16, expnt(s) = [61.78395679]
bas 17, expnt(s) = [7.57142975]
bas 18, expnt(s) = [20.44684003]
bas 19, expnt(s) = [0.7935239]
bas 20, expnt(s) = [2.98535604]
bas 21, expnt(s) = [0.22535468]
CPU time:       429.40
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826894e+04 5.20026786e+03 7.61744326e+03 2.06002241e+03
 3.61738043e+03 1.17844865e+03 1.59607483e+03 6.37976909e+02
 3.87824316e+02 2.20796051e+02 1.22194929e+02 9.28549180e+01
 4.53444073e+01 4.41476735e+01 1.61193252e+01 2.03247478e+01
 7.09677046e+00 1.09852664e+01 6.32982452e-01 1.79291119e+00
 2.83045594e+00 5.51324539e+00 2.24480408e-01 8.23946202e-01
 1.36279433e+03 2.41558481e+04 6.64638224e+02 9.84500714e+03
 3.00456114e+02 3.64930951e+03 3.13606288e+02 3.85004092e+03
 6.17839568e+01 5.05334606e+02 7.57142975e+00 3.66401096e+01
 2.04468400e+01 1.26843186e+02 7.93523897e-01 2.18491429e+00
 2.98535604e+00 1.14479984e+01 2.25354678e-01 4.52968097e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99323143849677
cond(S) = 113586.38548636231
E1 = -729.5449807418072  E_coul = 203.17658481262598
init E= -526.368395929181
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555722074370109  LUMO = 0.895563671195208
  mo_energy =
[-1.18333778e+02 -1.22067910e+01 -9.44701575e+00 -9.44701575e+00
 -9.44701575e+00 -1.24025859e+00 -5.55722074e-01 -5.55722074e-01
 -5.55722074e-01  8.95563671e-01  1.05969725e+00  1.05969725e+00
  1.05969725e+00  7.79420884e+00  7.79420884e+00  7.79420884e+00
  9.44726641e+00  3.49162844e+01  3.49162844e+01  3.49162844e+01
  4.74592788e+01  1.31329611e+02  1.31329611e+02  1.31329611e+02
  1.89577159e+02  4.85581339e+02  4.85581339e+02  4.85581339e+02
  7.18427965e+02  1.33637388e+03  1.33637388e+03  1.33637388e+03
  2.80515197e+03  3.02923888e+03  3.02923888e+03  3.02923888e+03
  6.64874678e+03  6.64874678e+03  6.64874678e+03  9.20637491e+03
  2.55548975e+04  7.62877521e+04]
E1 = -727.8443331061795  E_coul = 201.0924382684257
cycle= 1 E= -526.751894837754  delta_E= -0.383  |g|= 0.187  |ddm|= 0.323
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.567585
diis-c [-0.32215282  1.        ]
  HOMO = -0.591143946832059  LUMO = 0.870262630082837
  mo_energy =
[-1.18642348e+02 -1.23450856e+01 -9.59643522e+00 -9.59643522e+00
 -9.59643522e+00 -1.28006006e+00 -5.91143947e-01 -5.91143947e-01
 -5.91143947e-01  8.70262630e-01  1.03419171e+00  1.03419171e+00
  1.03419171e+00  7.69977155e+00  7.69977155e+00  7.69977155e+00
  9.35404863e+00  3.47601557e+01  3.47601557e+01  3.47601557e+01
  4.73031789e+01  1.31100638e+02  1.31100638e+02  1.31100638e+02
  1.89338697e+02  4.85274106e+02  4.85274106e+02  4.85274106e+02
  7.18079495e+02  1.33601016e+03  1.33601016e+03  1.33601016e+03
  2.80465579e+03  3.02880940e+03  3.02880940e+03  3.02880940e+03
  6.64820393e+03  6.64820393e+03  6.64820393e+03  9.20575799e+03
  2.55541857e+04  7.62869496e+04]
E1 = -728.4205564668812  E_coul = 201.66793160710313
cycle= 2 E= -526.752624859778  delta_E= -0.00073  |g|= 0.0378  |ddm|= 0.0533
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0773414
diis-c [-0.00371865  0.07774751  0.92225249]
  HOMO = -0.581967654286074  LUMO = 0.877597769388182
  mo_energy =
[-1.18574026e+02 -1.23066775e+01 -9.55636441e+00 -9.55636441e+00
 -9.55636441e+00 -1.26906299e+00 -5.81967654e-01 -5.81967654e-01
 -5.81967654e-01  8.77597769e-01  1.04119217e+00  1.04119217e+00
  1.04119217e+00  7.72446682e+00  7.72446682e+00  7.72446682e+00
  9.37960871e+00  3.48008644e+01  3.48008644e+01  3.48008644e+01
  4.73453332e+01  1.31157038e+02  1.31157038e+02  1.31157038e+02
  1.89397570e+02  4.85341578e+02  4.85341578e+02  4.85341578e+02
  7.18149357e+02  1.33608172e+03  1.33608172e+03  1.33608172e+03
  2.80473059e+03  3.02888322e+03  3.02888322e+03  3.02888322e+03
  6.64827950e+03  6.64827950e+03  6.64827950e+03  9.20583435e+03
  2.55542626e+04  7.62870269e+04]
E1 = -728.2690026821275  E_coul = 201.51631849847757
cycle= 3 E= -526.75268418365  delta_E= -5.93e-05  |g|= 0.00653  |ddm|= 0.0163
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0139386
diis-c [-8.39518431e-07 -1.28489294e-03  1.48237622e-01  8.53047270e-01]
  HOMO = -0.583520549129079  LUMO = 0.876454024952497
  mo_energy =
[-1.18584372e+02 -1.23126955e+01 -9.56274610e+00 -9.56274610e+00
 -9.56274610e+00 -1.27080749e+00 -5.83520549e-01 -5.83520549e-01
 -5.83520549e-01  8.76454025e-01  1.04003412e+00  1.04003412e+00
  1.04003412e+00  7.72043630e+00  7.72043630e+00  7.72043630e+00
  9.37553864e+00  3.47944244e+01  3.47944244e+01  3.47944244e+01
  4.73387483e+01  1.31148374e+02  1.31148374e+02  1.31148374e+02
  1.89388582e+02  4.85331356e+02  4.85331356e+02  4.85331356e+02
  7.18138754e+02  1.33607088e+03  1.33607088e+03  1.33607088e+03
  2.80471911e+03  3.02887198e+03  3.02887198e+03  3.02887198e+03
  6.64826785e+03  6.64826785e+03  6.64826785e+03  9.20582248e+03
  2.55542505e+04  7.62870147e+04]
E1 = -728.2925728023519  E_coul = 201.5398865544579
cycle= 4 E= -526.752686247894  delta_E= -2.06e-06  |g|= 0.000109  |ddm|= 0.00231
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000126625
diis-c [-5.33988641e-09  9.28990436e-05 -1.31246005e-02 -8.03332831e-02
  1.09336498e+00]
  HOMO = -0.583503219186761  LUMO = 0.876486751987277
  mo_energy =
[-1.18584328e+02 -1.23126288e+01 -9.56269425e+00 -9.56269425e+00
 -9.56269425e+00 -1.27076444e+00 -5.83503219e-01 -5.83503219e-01
 -5.83503219e-01  8.76486752e-01  1.04004999e+00  1.04004999e+00
  1.04004999e+00  7.72047842e+00  7.72047842e+00  7.72047842e+00
  9.37559659e+00  3.47944747e+01  3.47944747e+01  3.47944747e+01
  4.73388067e+01  1.31148424e+02  1.31148424e+02  1.31148424e+02
  1.89388633e+02  4.85331400e+02  4.85331400e+02  4.85331400e+02
  7.18138790e+02  1.33607091e+03  1.33607091e+03  1.33607091e+03
  2.80471912e+03  3.02887200e+03  3.02887200e+03  3.02887200e+03
  6.64826786e+03  6.64826786e+03  6.64826786e+03  9.20582248e+03
  2.55542505e+04  7.62870147e+04]
E1 = -728.2923404687253  E_coul = 201.5396542186032
cycle= 5 E= -526.752686250122  delta_E= -2.23e-09  |g|= 2.11e-05  |ddm|= 0.000181
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.92358e-05
diis-c [-1.01293438e-10  1.27398221e-05 -1.72362414e-03 -1.25938199e-02
  3.35274242e-02  9.80777280e-01]
  HOMO = -0.583511259550799  LUMO = 0.876482973608856
  mo_energy =
[-1.18584361e+02 -1.23126529e+01 -9.56272018e+00 -9.56272018e+00
 -9.56272018e+00 -1.27077086e+00 -5.83511260e-01 -5.83511260e-01
 -5.83511260e-01  8.76482974e-01  1.04004446e+00  1.04004446e+00
  1.04004446e+00  7.72046025e+00  7.72046025e+00  7.72046025e+00
  9.37557937e+00  3.47944495e+01  3.47944495e+01  3.47944495e+01
  4.73387815e+01  1.31148395e+02  1.31148395e+02  1.31148395e+02
  1.89388603e+02  4.85331368e+02  4.85331368e+02  4.85331368e+02
  7.18138757e+02  1.33607088e+03  1.33607088e+03  1.33607088e+03
  2.80471908e+03  3.02887197e+03  3.02887197e+03  3.02887197e+03
  6.64826782e+03  6.64826782e+03  6.64826782e+03  9.20582245e+03
  2.55542505e+04  7.62870146e+04]
E1 = -728.2924250080788  E_coul = 201.53973875789146
cycle= 6 E= -526.752686250187  delta_E= -6.53e-11  |g|= 1.88e-06  |ddm|= 2.02e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2924250080788  E_coul = 201.53973875789146
  HOMO = -0.583511119030213  LUMO = 0.876483421519059
  mo_energy =
[-1.18584360e+02 -1.23126521e+01 -9.56271949e+00 -9.56271949e+00
 -9.56271949e+00 -1.27077029e+00 -5.83511119e-01 -5.83511119e-01
 -5.83511119e-01  8.76483422e-01  1.04004462e+00  1.04004462e+00
  1.04004462e+00  7.72046072e+00  7.72046072e+00  7.72046072e+00
  9.37558000e+00  3.47944502e+01  3.47944502e+01  3.47944502e+01
  4.73387822e+01  1.31148396e+02  1.31148396e+02  1.31148396e+02
  1.89388604e+02  4.85331369e+02  4.85331369e+02  4.85331369e+02
  7.18138758e+02  1.33607088e+03  1.33607088e+03  1.33607088e+03
  2.80471909e+03  3.02887197e+03  3.02887197e+03  3.02887197e+03
  6.64826782e+03  6.64826782e+03  6.64826782e+03  9.20582245e+03
  2.55542505e+04  7.62870146e+04]
E1 = -728.2924215281512  E_coul = 201.5397352779645
Extra cycle  E= -526.752686250187  delta_E= 6.82e-13  |g|= 4.03e-07  |ddm|= 3.33e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
exp = [2.61826894e+04 7.61744326e+03 3.61738043e+03 1.59607483e+03
 3.87824316e+02 1.22194929e+02 4.53444073e+01 1.61193252e+01
 7.09677046e+00 6.32982452e-01 2.83045594e+00 2.24480408e-01
 1.36279433e+03 6.64638224e+02 3.00456114e+02 3.13606288e+02
 6.17839568e+01 7.57142975e+00 2.04468400e+01 7.93523897e-01
 2.98535604e+00 2.25354678e-01]
E = -526.7526862501867
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:03 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6894003        1
[INPUT] 0    0    [1    /1   ]  7617.44325975        1
[INPUT] 0    0    [1    /1   ]  3617.38042563        1
[INPUT] 0    0    [1    /1   ]  1596.07482561        1
[INPUT] 0    0    [1    /1   ]  387.824316193        1
[INPUT] 0    0    [1    /1   ]  122.1949287          1
[INPUT] 0    0    [1    /1   ]  45.3444073257        1
[INPUT] 0    0    [1    /1   ]  16.1193251635        1
[INPUT] 0    0    [1    /1   ]  7.09677046054        1
[INPUT] 0    0    [1    /1   ]  0.632982451528       1
[INPUT] 0    0    [1    /1   ]  2.83045593769        1
[INPUT] 0    0    [1    /1   ]  0.224480407617       1
[INPUT] 1    0    [1    /1   ]  1362.79432845        1
[INPUT] 1    0    [1    /1   ]  664.638224195        1
[INPUT] 1    0    [1    /1   ]  300.456113728        1
[INPUT] 1    0    [1    /1   ]  313.606287931        1
[INPUT] 1    0    [1    /1   ]  61.7839567853        1
[INPUT] 1    0    [1    /1   ]  7.57142974707        1
[INPUT] 1    0    [1    /1   ]  20.4468400292        1
[INPUT] 1    0    [1    /1   ]  0.793523897135       1
[INPUT] 1    0    [1    /1   ]  2.98535603578        1
[INPUT] 1    0    [1    /1   ]  0.225354678231       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.68940030312, 1.0]], [0, [7617.443259754306, 1.0]], [0, [3617.380425634066, 1.0]], [0, [1596.0748256072961, 1.0]], [0, [387.8243161930035, 1.0]], [0, [122.19492869963834, 1.0]], [0, [45.34440732572713, 1.0]], [0, [16.119325163547046, 1.0]], [0, [7.096770460538909, 1.0]], [0, [0.6329824515282043, 1.0]], [0, [2.8304559376884795, 1.0]], [0, [0.2244804076172831, 1.0]], [1, [1362.7943284470593, 1.0]], [1, [664.6382241953836, 1.0]], [1, [300.45611372775284, 1.0]], [1, [313.6062879308091, 1.0]], [1, [61.78395678531011, 1.0]], [1, [7.571429747073134, 1.0]], [1, [20.446840029203823, 1.0]], [1, [0.7935238971352436, 1.0]], [1, [2.9853560357804323, 1.0]], [1, [0.2253546782308298, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6894003]
bas 1, expnt(s) = [7617.44325975]
bas 2, expnt(s) = [3617.38042563]
bas 3, expnt(s) = [1596.07482561]
bas 4, expnt(s) = [387.82431619]
bas 5, expnt(s) = [122.1949287]
bas 6, expnt(s) = [45.34440733]
bas 7, expnt(s) = [16.11932516]
bas 8, expnt(s) = [7.09677046]
bas 9, expnt(s) = [0.63298245]
bas 10, expnt(s) = [2.83045594]
bas 11, expnt(s) = [0.22448041]
bas 12, expnt(s) = [1362.79432845]
bas 13, expnt(s) = [664.6382242]
bas 14, expnt(s) = [300.45611373]
bas 15, expnt(s) = [313.60628793]
bas 16, expnt(s) = [61.78395679]
bas 17, expnt(s) = [7.57142975]
bas 18, expnt(s) = [20.44684003]
bas 19, expnt(s) = [0.7935239]
bas 20, expnt(s) = [2.98535604]
bas 21, expnt(s) = [0.22535468]
CPU time:       429.86
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826894e+04 5.20026786e+03 7.61744326e+03 2.06002241e+03
 3.61738043e+03 1.17844865e+03 1.59607483e+03 6.37976909e+02
 3.87824316e+02 2.20796051e+02 1.22194929e+02 9.28549180e+01
 4.53444073e+01 4.41476735e+01 1.61193252e+01 2.03247478e+01
 7.09677046e+00 1.09852664e+01 6.32982452e-01 1.79291119e+00
 2.83045594e+00 5.51324539e+00 2.24480408e-01 8.23946202e-01
 1.36279433e+03 2.41558481e+04 6.64638224e+02 9.84500714e+03
 3.00456114e+02 3.64930951e+03 3.13606288e+02 3.85004092e+03
 6.17839568e+01 5.05334606e+02 7.57142975e+00 3.66401096e+01
 2.04468400e+01 1.26843186e+02 7.93523897e-01 2.18491429e+00
 2.98535604e+00 1.14479984e+01 2.25354678e-01 4.52968097e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99323143849677
cond(S) = 113586.38548636231
E1 = -729.5449807418072  E_coul = 203.17658481262598
init E= -526.368395929181
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555722074370109  LUMO = 0.895563671195208
  mo_energy =
[-1.18333778e+02 -1.22067910e+01 -9.44701575e+00 -9.44701575e+00
 -9.44701575e+00 -1.24025859e+00 -5.55722074e-01 -5.55722074e-01
 -5.55722074e-01  8.95563671e-01  1.05969725e+00  1.05969725e+00
  1.05969725e+00  7.79420884e+00  7.79420884e+00  7.79420884e+00
  9.44726641e+00  3.49162844e+01  3.49162844e+01  3.49162844e+01
  4.74592788e+01  1.31329611e+02  1.31329611e+02  1.31329611e+02
  1.89577159e+02  4.85581339e+02  4.85581339e+02  4.85581339e+02
  7.18427965e+02  1.33637388e+03  1.33637388e+03  1.33637388e+03
  2.80515197e+03  3.02923888e+03  3.02923888e+03  3.02923888e+03
  6.64874678e+03  6.64874678e+03  6.64874678e+03  9.20637491e+03
  2.55548975e+04  7.62877521e+04]
E1 = -727.8443331061795  E_coul = 201.0924382684257
cycle= 1 E= -526.751894837754  delta_E= -0.383  |g|= 0.187  |ddm|= 0.323
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.567585
diis-c [-0.32215282  1.        ]
  HOMO = -0.591143946832059  LUMO = 0.870262630082837
  mo_energy =
[-1.18642348e+02 -1.23450856e+01 -9.59643522e+00 -9.59643522e+00
 -9.59643522e+00 -1.28006006e+00 -5.91143947e-01 -5.91143947e-01
 -5.91143947e-01  8.70262630e-01  1.03419171e+00  1.03419171e+00
  1.03419171e+00  7.69977155e+00  7.69977155e+00  7.69977155e+00
  9.35404863e+00  3.47601557e+01  3.47601557e+01  3.47601557e+01
  4.73031789e+01  1.31100638e+02  1.31100638e+02  1.31100638e+02
  1.89338697e+02  4.85274106e+02  4.85274106e+02  4.85274106e+02
  7.18079495e+02  1.33601016e+03  1.33601016e+03  1.33601016e+03
  2.80465579e+03  3.02880940e+03  3.02880940e+03  3.02880940e+03
  6.64820393e+03  6.64820393e+03  6.64820393e+03  9.20575799e+03
  2.55541857e+04  7.62869496e+04]
E1 = -728.4205564668812  E_coul = 201.66793160710313
cycle= 2 E= -526.752624859778  delta_E= -0.00073  |g|= 0.0378  |ddm|= 0.0533
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0773414
diis-c [-0.00371865  0.07774751  0.92225249]
  HOMO = -0.581967654286074  LUMO = 0.877597769388182
  mo_energy =
[-1.18574026e+02 -1.23066775e+01 -9.55636441e+00 -9.55636441e+00
 -9.55636441e+00 -1.26906299e+00 -5.81967654e-01 -5.81967654e-01
 -5.81967654e-01  8.77597769e-01  1.04119217e+00  1.04119217e+00
  1.04119217e+00  7.72446682e+00  7.72446682e+00  7.72446682e+00
  9.37960871e+00  3.48008644e+01  3.48008644e+01  3.48008644e+01
  4.73453332e+01  1.31157038e+02  1.31157038e+02  1.31157038e+02
  1.89397570e+02  4.85341578e+02  4.85341578e+02  4.85341578e+02
  7.18149357e+02  1.33608172e+03  1.33608172e+03  1.33608172e+03
  2.80473059e+03  3.02888322e+03  3.02888322e+03  3.02888322e+03
  6.64827950e+03  6.64827950e+03  6.64827950e+03  9.20583435e+03
  2.55542626e+04  7.62870269e+04]
E1 = -728.2690026821275  E_coul = 201.51631849847757
cycle= 3 E= -526.75268418365  delta_E= -5.93e-05  |g|= 0.00653  |ddm|= 0.0163
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0139386
diis-c [-8.39518431e-07 -1.28489294e-03  1.48237622e-01  8.53047270e-01]
  HOMO = -0.583520549129079  LUMO = 0.876454024952497
  mo_energy =
[-1.18584372e+02 -1.23126955e+01 -9.56274610e+00 -9.56274610e+00
 -9.56274610e+00 -1.27080749e+00 -5.83520549e-01 -5.83520549e-01
 -5.83520549e-01  8.76454025e-01  1.04003412e+00  1.04003412e+00
  1.04003412e+00  7.72043630e+00  7.72043630e+00  7.72043630e+00
  9.37553864e+00  3.47944244e+01  3.47944244e+01  3.47944244e+01
  4.73387483e+01  1.31148374e+02  1.31148374e+02  1.31148374e+02
  1.89388582e+02  4.85331356e+02  4.85331356e+02  4.85331356e+02
  7.18138754e+02  1.33607088e+03  1.33607088e+03  1.33607088e+03
  2.80471911e+03  3.02887198e+03  3.02887198e+03  3.02887198e+03
  6.64826785e+03  6.64826785e+03  6.64826785e+03  9.20582248e+03
  2.55542505e+04  7.62870147e+04]
E1 = -728.2925728023519  E_coul = 201.5398865544579
cycle= 4 E= -526.752686247894  delta_E= -2.06e-06  |g|= 0.000109  |ddm|= 0.00231
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000126625
diis-c [-5.33988641e-09  9.28990436e-05 -1.31246005e-02 -8.03332831e-02
  1.09336498e+00]
  HOMO = -0.583503219186761  LUMO = 0.876486751987277
  mo_energy =
[-1.18584328e+02 -1.23126288e+01 -9.56269425e+00 -9.56269425e+00
 -9.56269425e+00 -1.27076444e+00 -5.83503219e-01 -5.83503219e-01
 -5.83503219e-01  8.76486752e-01  1.04004999e+00  1.04004999e+00
  1.04004999e+00  7.72047842e+00  7.72047842e+00  7.72047842e+00
  9.37559659e+00  3.47944747e+01  3.47944747e+01  3.47944747e+01
  4.73388067e+01  1.31148424e+02  1.31148424e+02  1.31148424e+02
  1.89388633e+02  4.85331400e+02  4.85331400e+02  4.85331400e+02
  7.18138790e+02  1.33607091e+03  1.33607091e+03  1.33607091e+03
  2.80471912e+03  3.02887200e+03  3.02887200e+03  3.02887200e+03
  6.64826786e+03  6.64826786e+03  6.64826786e+03  9.20582248e+03
  2.55542505e+04  7.62870147e+04]
E1 = -728.2923404687253  E_coul = 201.5396542186032
cycle= 5 E= -526.752686250122  delta_E= -2.23e-09  |g|= 2.11e-05  |ddm|= 0.000181
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.92358e-05
diis-c [-1.01293438e-10  1.27398221e-05 -1.72362414e-03 -1.25938199e-02
  3.35274242e-02  9.80777280e-01]
  HOMO = -0.583511259550799  LUMO = 0.876482973608856
  mo_energy =
[-1.18584361e+02 -1.23126529e+01 -9.56272018e+00 -9.56272018e+00
 -9.56272018e+00 -1.27077086e+00 -5.83511260e-01 -5.83511260e-01
 -5.83511260e-01  8.76482974e-01  1.04004446e+00  1.04004446e+00
  1.04004446e+00  7.72046025e+00  7.72046025e+00  7.72046025e+00
  9.37557937e+00  3.47944495e+01  3.47944495e+01  3.47944495e+01
  4.73387815e+01  1.31148395e+02  1.31148395e+02  1.31148395e+02
  1.89388603e+02  4.85331368e+02  4.85331368e+02  4.85331368e+02
  7.18138757e+02  1.33607088e+03  1.33607088e+03  1.33607088e+03
  2.80471908e+03  3.02887197e+03  3.02887197e+03  3.02887197e+03
  6.64826782e+03  6.64826782e+03  6.64826782e+03  9.20582245e+03
  2.55542505e+04  7.62870146e+04]
E1 = -728.2924250080788  E_coul = 201.53973875789146
cycle= 6 E= -526.752686250187  delta_E= -6.53e-11  |g|= 1.88e-06  |ddm|= 2.02e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2924250080788  E_coul = 201.53973875789146
  HOMO = -0.583511119030213  LUMO = 0.876483421519059
  mo_energy =
[-1.18584360e+02 -1.23126521e+01 -9.56271949e+00 -9.56271949e+00
 -9.56271949e+00 -1.27077029e+00 -5.83511119e-01 -5.83511119e-01
 -5.83511119e-01  8.76483422e-01  1.04004462e+00  1.04004462e+00
  1.04004462e+00  7.72046072e+00  7.72046072e+00  7.72046072e+00
  9.37558000e+00  3.47944502e+01  3.47944502e+01  3.47944502e+01
  4.73387822e+01  1.31148396e+02  1.31148396e+02  1.31148396e+02
  1.89388604e+02  4.85331369e+02  4.85331369e+02  4.85331369e+02
  7.18138758e+02  1.33607088e+03  1.33607088e+03  1.33607088e+03
  2.80471909e+03  3.02887197e+03  3.02887197e+03  3.02887197e+03
  6.64826782e+03  6.64826782e+03  6.64826782e+03  9.20582245e+03
  2.55542505e+04  7.62870146e+04]
E1 = -728.2924215281512  E_coul = 201.5397352779645
Extra cycle  E= -526.752686250187  delta_E= 6.82e-13  |g|= 4.03e-07  |ddm|= 3.33e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113586.38548636231
E1 = -728.2924215281512  E_coul = 201.5397352779645
init E= -526.752686250187
    CPU time for initialize scf      0.80 sec, wall time      0.32 sec
  HOMO = -0.583511203333106  LUMO = 0.876483426991398
  mo_energy =
[-1.18584360e+02 -1.23126523e+01 -9.56271977e+00 -9.56271977e+00
 -9.56271977e+00 -1.27077030e+00 -5.83511203e-01 -5.83511203e-01
 -5.83511203e-01  8.76483427e-01  1.04004457e+00  1.04004457e+00
  1.04004457e+00  7.72046054e+00  7.72046054e+00  7.72046054e+00
  9.37557985e+00  3.47944499e+01  3.47944499e+01  3.47944499e+01
  4.73387820e+01  1.31148395e+02  1.31148395e+02  1.31148395e+02
  1.89388603e+02  4.85331369e+02  4.85331369e+02  4.85331369e+02
  7.18138758e+02  1.33607088e+03  1.33607088e+03  1.33607088e+03
  2.80471909e+03  3.02887197e+03  3.02887197e+03  3.02887197e+03
  6.64826782e+03  6.64826782e+03  6.64826782e+03  9.20582245e+03
  2.55542505e+04  7.62870146e+04]
E1 = -728.2924223325616  E_coul = 201.53973608237453
cycle= 1 E= -526.752686250187  delta_E= -3.41e-13  |g|= 9.52e-08  |ddm|= 6.14e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2924223325616  E_coul = 201.53973608237453
  HOMO = -0.583511191535248  LUMO = 0.876483450648964
  mo_energy =
[-1.18584360e+02 -1.23126523e+01 -9.56271971e+00 -9.56271971e+00
 -9.56271971e+00 -1.27077027e+00 -5.83511192e-01 -5.83511192e-01
 -5.83511192e-01  8.76483451e-01  1.04004458e+00  1.04004458e+00
  1.04004458e+00  7.72046057e+00  7.72046057e+00  7.72046057e+00
  9.37557989e+00  3.47944500e+01  3.47944500e+01  3.47944500e+01
  4.73387820e+01  1.31148395e+02  1.31148395e+02  1.31148395e+02
  1.89388604e+02  4.85331369e+02  4.85331369e+02  4.85331369e+02
  7.18138758e+02  1.33607088e+03  1.33607088e+03  1.33607088e+03
  2.80471909e+03  3.02887197e+03  3.02887197e+03  3.02887197e+03
  6.64826782e+03  6.64826782e+03  6.64826782e+03  9.20582245e+03
  2.55542505e+04  7.62870146e+04]
E1 = -728.292422070792  E_coul = 201.53973582060448
Extra cycle  E= -526.752686250187  delta_E= -4.55e-13  |g|= 2.13e-08  |ddm|= 1.45e-07
    CPU time for scf_cycle      0.90 sec, wall time      0.42 sec
exp = [2.61826894e+04 7.61744326e+03 3.61738043e+03 1.59607483e+03
 3.87824316e+02 1.22194929e+02 4.53444073e+01 1.61193252e+01
 7.09677046e+00 6.32982452e-01 2.83045594e+00 2.24480408e-01
 1.36279433e+03 6.64638224e+02 3.00456114e+02 3.13606288e+02
 6.17839568e+01 7.57142975e+00 2.04468400e+01 7.93523897e-01
 2.98535604e+00 2.25354678e-01]
grad_E = [-1.56304836e-06  3.83381379e-06 -1.27113847e-06  8.97613675e-05
 -5.01339567e-04  1.79070261e-05  3.35729843e-04 -3.50461507e-04
  6.39397326e-04 -1.32547825e-03 -1.58090459e-03 -3.54387509e-03
 -5.13888097e-07  4.94821083e-06  2.33369865e-05  2.00922135e-05
 -1.45259381e-05 -2.68738351e-03 -1.45880211e-04  1.28473140e-02
  1.05613883e-02 -3.89992506e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:07 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6944058        1
[INPUT] 0    0    [1    /1   ]  7617.43131814        1
[INPUT] 0    0    [1    /1   ]  3617.38464558        1
[INPUT] 0    0    [1    /1   ]  1595.80528123        1
[INPUT] 0    0    [1    /1   ]  388.759344563        1
[INPUT] 0    0    [1    /1   ]  123.962975772        1
[INPUT] 0    0    [1    /1   ]  46.2457898121        1
[INPUT] 0    0    [1    /1   ]  16.3952135726        1
[INPUT] 0    0    [1    /1   ]  7.23841509289        1
[INPUT] 0    0    [1    /1   ]  0.641749252425       1
[INPUT] 0    0    [1    /1   ]  2.88423253005        1
[INPUT] 0    0    [1    /1   ]  0.229093875555       1
[INPUT] 1    0    [1    /1   ]  1362.79598524        1
[INPUT] 1    0    [1    /1   ]  664.622315622        1
[INPUT] 1    0    [1    /1   ]  300.381267685        1
[INPUT] 1    0    [1    /1   ]  313.541788002        1
[INPUT] 1    0    [1    /1   ]  61.7930408408        1
[INPUT] 1    0    [1    /1   ]  7.53717322433        1
[INPUT] 1    0    [1    /1   ]  20.5460173308        1
[INPUT] 1    0    [1    /1   ]  0.786356030728       1
[INPUT] 1    0    [1    /1   ]  2.91557611418        1
[INPUT] 1    0    [1    /1   ]  0.22446045479        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69440584971, 1.0]], [0, [7617.431318136871, 1.0]], [0, [3617.3846455794665, 1.0]], [0, [1595.8052812304168, 1.0]], [0, [388.7593445626793, 1.0]], [0, [123.96297577175227, 1.0]], [0, [46.24578981209638, 1.0]], [0, [16.395213572631196, 1.0]], [0, [7.238415092887363, 1.0]], [0, [0.6417492524253843, 1.0]], [0, [2.884232530045148, 1.0]], [0, [0.22909387555498137, 1.0]], [1, [1362.795985239045, 1.0]], [1, [664.622315621948, 1.0]], [1, [300.3812676852709, 1.0]], [1, [313.54178800192983, 1.0]], [1, [61.79304084075072, 1.0]], [1, [7.537173224327129, 1.0]], [1, [20.546017330827933, 1.0]], [1, [0.7863560307280992, 1.0]], [1, [2.9155761141838723, 1.0]], [1, [0.22446045479040488, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69440585]
bas 1, expnt(s) = [7617.43131814]
bas 2, expnt(s) = [3617.38464558]
bas 3, expnt(s) = [1595.80528123]
bas 4, expnt(s) = [388.75934456]
bas 5, expnt(s) = [123.96297577]
bas 6, expnt(s) = [46.24578981]
bas 7, expnt(s) = [16.39521357]
bas 8, expnt(s) = [7.23841509]
bas 9, expnt(s) = [0.64174925]
bas 10, expnt(s) = [2.88423253]
bas 11, expnt(s) = [0.22909388]
bas 12, expnt(s) = [1362.79598524]
bas 13, expnt(s) = [664.62231562]
bas 14, expnt(s) = [300.38126769]
bas 15, expnt(s) = [313.541788]
bas 16, expnt(s) = [61.79304084]
bas 17, expnt(s) = [7.53717322]
bas 18, expnt(s) = [20.54601733]
bas 19, expnt(s) = [0.78635603]
bas 20, expnt(s) = [2.91557611]
bas 21, expnt(s) = [0.22446045]
CPU time:       435.27
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826944e+04 5.20026861e+03 7.61743132e+03 2.06001999e+03
 3.61738465e+03 1.17844968e+03 1.59580528e+03 6.37896101e+02
 3.88759345e+02 2.21195178e+02 1.23962976e+02 9.38607498e+01
 4.62457898e+01 4.48042462e+01 1.63952136e+01 2.05850930e+01
 7.23841509e+00 1.11493009e+01 6.41749252e-01 1.81150298e+00
 2.88423253e+00 5.59162100e+00 2.29093876e-01 8.36614011e-01
 1.36279599e+03 2.41558848e+04 6.64622316e+02 9.84471259e+03
 3.00381268e+02 3.64817321e+03 3.13541788e+02 3.84905114e+03
 6.17930408e+01 5.05427481e+02 7.53717322e+00 3.64330067e+01
 2.05460173e+01 1.27612717e+02 7.86356031e-01 2.16027192e+00
 2.91557611e+00 1.11144985e+01 2.24460455e-01 4.50722450e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99344791609399
cond(S) = 113546.48426512242
E1 = -729.5456906194665  E_coul = 203.17635393828337
init E= -526.369336681183
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555708141485567  LUMO = 0.92347347590964
  mo_energy =
[-1.18333937e+02 -1.22068135e+01 -9.44711626e+00 -9.44711626e+00
 -9.44711626e+00 -1.24025392e+00 -5.55708141e-01 -5.55708141e-01
 -5.55708141e-01  9.23473476e-01  1.04948321e+00  1.04948321e+00
  1.04948321e+00  7.63302839e+00  7.63302839e+00  7.63302839e+00
  9.73889147e+00  3.46259456e+01  3.46259456e+01  3.46259456e+01
  4.87403975e+01  1.31230060e+02  1.31230060e+02  1.31230060e+02
  1.94011832e+02  4.85578293e+02  4.85578293e+02  4.85578293e+02
  7.28457952e+02  1.33624707e+03  1.33624707e+03  1.33624707e+03
  2.81881842e+03  3.02891750e+03  3.02891750e+03  3.02891750e+03
  6.64829203e+03  6.64829203e+03  6.64829203e+03  9.22022919e+03
  2.55681426e+04  7.63000836e+04]
E1 = -727.8484637208373  E_coul = 201.09592966434738
cycle= 1 E= -526.75253405649  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.567981
diis-c [-0.32260217  1.        ]
  HOMO = -0.590839909325484  LUMO = 0.897649152098694
  mo_energy =
[-1.18642509e+02 -1.23449822e+01 -9.59633400e+00 -9.59633400e+00
 -9.59633400e+00 -1.27979002e+00 -5.90839909e-01 -5.90839909e-01
 -5.90839909e-01  8.97649152e-01  1.02449914e+00  1.02449914e+00
  1.02449914e+00  7.53987191e+00  7.53987191e+00  7.53987191e+00
  9.64471816e+00  3.44698384e+01  3.44698384e+01  3.44698384e+01
  4.85830842e+01  1.31000958e+02  1.31000958e+02  1.31000958e+02
  1.93771996e+02  4.85271054e+02  4.85271054e+02  4.85271054e+02
  7.28108864e+02  1.33588334e+03  1.33588334e+03  1.33588334e+03
  2.81832238e+03  3.02848809e+03  3.02848809e+03  3.02848809e+03
  6.64774929e+03  6.64774929e+03  6.64774929e+03  9.21961253e+03
  2.55674309e+04  7.62992813e+04]
E1 = -728.4240772181278  E_coul = 201.67081571779465
cycle= 2 E= -526.753261500333  delta_E= -0.000727  |g|= 0.0378  |ddm|= 0.0533
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0771935
diis-c [-0.00372251  0.07727293  0.92272707]
  HOMO = -0.581668649709648  LUMO = 0.905163298818498
  mo_energy =
[-1.18574186e+02 -1.23066074e+01 -9.55629182e+00 -9.55629182e+00
 -9.55629182e+00 -1.26880343e+00 -5.81668650e-01 -5.81668650e-01
 -5.81668650e-01  9.05163299e-01  1.03140718e+00  1.03140718e+00
  1.03140718e+00  7.56430491e+00  7.56430491e+00  7.56430491e+00
  9.67057733e+00  3.45105433e+01  3.45105433e+01  3.45105433e+01
  4.86255331e+01  1.31057380e+02  1.31057380e+02  1.31057380e+02
  1.93831076e+02  4.85338529e+02  4.85338529e+02  4.85338529e+02
  7.28178773e+02  1.33595491e+03  1.33595491e+03  1.33595491e+03
  2.81839719e+03  3.02856193e+03  3.02856193e+03  3.02856193e+03
  6.64782488e+03  6.64782488e+03  6.64782488e+03  9.21968891e+03
  2.55675078e+04  7.62993586e+04]
E1 = -728.2725973141994  E_coul = 201.51927665611623
cycle= 3 E= -526.753320658083  delta_E= -5.92e-05  |g|= 0.00655  |ddm|= 0.0163
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0139468
diis-c [-8.13891557e-07 -1.27856568e-03  1.48602892e-01  8.52675673e-01]
  HOMO = -0.583222993439198  LUMO = 0.903987075357175
  mo_energy =
[-1.18584564e+02 -1.23126420e+01 -9.56268893e+00 -9.56268893e+00
 -9.56268893e+00 -1.27055240e+00 -5.83222993e-01 -5.83222993e-01
 -5.83222993e-01  9.03987075e-01  1.03026246e+00  1.03026246e+00
  1.03026246e+00  7.56030528e+00  7.56030528e+00  7.56030528e+00
  9.66644639e+00  3.45040837e+01  3.45040837e+01  3.45040837e+01
  4.86188829e+01  1.31048685e+02  1.31048685e+02  1.31048685e+02
  1.93822030e+02  4.85328276e+02  4.85328276e+02  4.85328276e+02
  7.28168132e+02  1.33594403e+03  1.33594403e+03  1.33594403e+03
  2.81838568e+03  3.02855065e+03  3.02855065e+03  3.02855065e+03
  6.64781320e+03  6.64781320e+03  6.64781320e+03  9.21967701e+03
  2.55674957e+04  7.62993464e+04]
E1 = -728.296239635945  E_coul = 201.54291690541402
cycle= 4 E= -526.753322730531  delta_E= -2.07e-06  |g|= 0.000107  |ddm|= 0.00232
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000121801
diis-c [-5.22854518e-09  8.96308473e-05 -1.27105764e-02 -7.74385134e-02
  1.09005946e+00]
  HOMO = -0.583204826119394  LUMO = 0.904020534990808
  mo_energy =
[-1.18584517e+02 -1.23125739e+01 -9.56263515e+00 -9.56263515e+00
 -9.56263515e+00 -1.27050916e+00 -5.83204826e-01 -5.83204826e-01
 -5.83204826e-01  9.04020535e-01  1.03027870e+00  1.03027870e+00
  1.03027870e+00  7.56034860e+00  7.56034860e+00  7.56034860e+00
  9.66650559e+00  3.45041358e+01  3.45041358e+01  3.45041358e+01
  4.86189429e+01  1.31048738e+02  1.31048738e+02  1.31048738e+02
  1.93822083e+02  4.85328322e+02  4.85328322e+02  4.85328322e+02
  7.28168170e+02  1.33594407e+03  1.33594407e+03  1.33594407e+03
  2.81838570e+03  3.02855068e+03  3.02855068e+03  3.02855068e+03
  6.64781321e+03  6.64781321e+03  6.64781321e+03  9.21967702e+03
  2.55674957e+04  7.62993464e+04]
E1 = -728.2960047867201  E_coul = 201.54268205408943
cycle= 5 E= -526.753322732631  delta_E= -2.1e-09  |g|= 2.09e-05  |ddm|= 0.000176
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.90662e-05
diis-c [-9.70620127e-11  1.28554483e-05 -1.74785154e-03 -1.26869415e-02
  3.43276235e-02  9.80094314e-01]
  HOMO = -0.583212734497378  LUMO = 0.90401671569939
  mo_energy =
[-1.18584549e+02 -1.23125976e+01 -9.56266075e+00 -9.56266075e+00
 -9.56266075e+00 -1.27051548e+00 -5.83212734e-01 -5.83212734e-01
 -5.83212734e-01  9.04016716e-01  1.03027334e+00  1.03027334e+00
  1.03027334e+00  7.56033082e+00  7.56033082e+00  7.56033082e+00
  9.66648842e+00  3.45041109e+01  3.45041109e+01  3.45041109e+01
  4.86189179e+01  1.31048709e+02  1.31048709e+02  1.31048709e+02
  1.93822053e+02  4.85328291e+02  4.85328291e+02  4.85328291e+02
  7.28168138e+02  1.33594404e+03  1.33594404e+03  1.33594404e+03
  2.81838566e+03  3.02855065e+03  3.02855065e+03  3.02855065e+03
  6.64781318e+03  6.64781318e+03  6.64781318e+03  9.21967698e+03
  2.55674957e+04  7.62993463e+04]
E1 = -728.296088696299  E_coul = 201.54276596360495
cycle= 6 E= -526.753322732694  delta_E= -6.32e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.296088696299  E_coul = 201.54276596360495
  HOMO = -0.583212612704353  LUMO = 0.904017153614195
  mo_energy =
[-1.18584548e+02 -1.23125969e+01 -9.56266015e+00 -9.56266015e+00
 -9.56266015e+00 -1.27051494e+00 -5.83212613e-01 -5.83212613e-01
 -5.83212613e-01  9.04017154e-01  1.03027348e+00  1.03027348e+00
  1.03027348e+00  7.56033123e+00  7.56033123e+00  7.56033123e+00
  9.66648900e+00  3.45041115e+01  3.45041115e+01  3.45041115e+01
  4.86189186e+01  1.31048710e+02  1.31048710e+02  1.31048710e+02
  1.93822054e+02  4.85328292e+02  4.85328292e+02  4.85328292e+02
  7.28168139e+02  1.33594404e+03  1.33594404e+03  1.33594404e+03
  2.81838566e+03  3.02855065e+03  3.02855065e+03  3.02855065e+03
  6.64781318e+03  6.64781318e+03  6.64781318e+03  9.21967698e+03
  2.55674957e+04  7.62993463e+04]
E1 = -728.2960855876694  E_coul = 201.54276285497443
Extra cycle  E= -526.753322732695  delta_E= -1.02e-12  |g|= 3.92e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
exp = [2.61826944e+04 7.61743132e+03 3.61738465e+03 1.59580528e+03
 3.88759345e+02 1.23962976e+02 4.62457898e+01 1.63952136e+01
 7.23841509e+00 6.41749252e-01 2.88423253e+00 2.29093876e-01
 1.36279599e+03 6.64622316e+02 3.00381268e+02 3.13541788e+02
 6.17930408e+01 7.53717322e+00 2.05460173e+01 7.86356031e-01
 2.91557611e+00 2.24460455e-01]
E = -526.753322732695
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:07 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6944058        1
[INPUT] 0    0    [1    /1   ]  7617.43131814        1
[INPUT] 0    0    [1    /1   ]  3617.38464558        1
[INPUT] 0    0    [1    /1   ]  1595.80528123        1
[INPUT] 0    0    [1    /1   ]  388.759344563        1
[INPUT] 0    0    [1    /1   ]  123.962975772        1
[INPUT] 0    0    [1    /1   ]  46.2457898121        1
[INPUT] 0    0    [1    /1   ]  16.3952135726        1
[INPUT] 0    0    [1    /1   ]  7.23841509289        1
[INPUT] 0    0    [1    /1   ]  0.641749252425       1
[INPUT] 0    0    [1    /1   ]  2.88423253005        1
[INPUT] 0    0    [1    /1   ]  0.229093875555       1
[INPUT] 1    0    [1    /1   ]  1362.79598524        1
[INPUT] 1    0    [1    /1   ]  664.622315622        1
[INPUT] 1    0    [1    /1   ]  300.381267685        1
[INPUT] 1    0    [1    /1   ]  313.541788002        1
[INPUT] 1    0    [1    /1   ]  61.7930408408        1
[INPUT] 1    0    [1    /1   ]  7.53717322433        1
[INPUT] 1    0    [1    /1   ]  20.5460173308        1
[INPUT] 1    0    [1    /1   ]  0.786356030728       1
[INPUT] 1    0    [1    /1   ]  2.91557611418        1
[INPUT] 1    0    [1    /1   ]  0.22446045479        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69440584971, 1.0]], [0, [7617.431318136871, 1.0]], [0, [3617.3846455794665, 1.0]], [0, [1595.8052812304168, 1.0]], [0, [388.7593445626793, 1.0]], [0, [123.96297577175227, 1.0]], [0, [46.24578981209638, 1.0]], [0, [16.395213572631196, 1.0]], [0, [7.238415092887363, 1.0]], [0, [0.6417492524253843, 1.0]], [0, [2.884232530045148, 1.0]], [0, [0.22909387555498137, 1.0]], [1, [1362.795985239045, 1.0]], [1, [664.622315621948, 1.0]], [1, [300.3812676852709, 1.0]], [1, [313.54178800192983, 1.0]], [1, [61.79304084075072, 1.0]], [1, [7.537173224327129, 1.0]], [1, [20.546017330827933, 1.0]], [1, [0.7863560307280992, 1.0]], [1, [2.9155761141838723, 1.0]], [1, [0.22446045479040488, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69440585]
bas 1, expnt(s) = [7617.43131814]
bas 2, expnt(s) = [3617.38464558]
bas 3, expnt(s) = [1595.80528123]
bas 4, expnt(s) = [388.75934456]
bas 5, expnt(s) = [123.96297577]
bas 6, expnt(s) = [46.24578981]
bas 7, expnt(s) = [16.39521357]
bas 8, expnt(s) = [7.23841509]
bas 9, expnt(s) = [0.64174925]
bas 10, expnt(s) = [2.88423253]
bas 11, expnt(s) = [0.22909388]
bas 12, expnt(s) = [1362.79598524]
bas 13, expnt(s) = [664.62231562]
bas 14, expnt(s) = [300.38126769]
bas 15, expnt(s) = [313.541788]
bas 16, expnt(s) = [61.79304084]
bas 17, expnt(s) = [7.53717322]
bas 18, expnt(s) = [20.54601733]
bas 19, expnt(s) = [0.78635603]
bas 20, expnt(s) = [2.91557611]
bas 21, expnt(s) = [0.22446045]
CPU time:       435.72
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826944e+04 5.20026861e+03 7.61743132e+03 2.06001999e+03
 3.61738465e+03 1.17844968e+03 1.59580528e+03 6.37896101e+02
 3.88759345e+02 2.21195178e+02 1.23962976e+02 9.38607498e+01
 4.62457898e+01 4.48042462e+01 1.63952136e+01 2.05850930e+01
 7.23841509e+00 1.11493009e+01 6.41749252e-01 1.81150298e+00
 2.88423253e+00 5.59162100e+00 2.29093876e-01 8.36614011e-01
 1.36279599e+03 2.41558848e+04 6.64622316e+02 9.84471259e+03
 3.00381268e+02 3.64817321e+03 3.13541788e+02 3.84905114e+03
 6.17930408e+01 5.05427481e+02 7.53717322e+00 3.64330067e+01
 2.05460173e+01 1.27612717e+02 7.86356031e-01 2.16027192e+00
 2.91557611e+00 1.11144985e+01 2.24460455e-01 4.50722450e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99344791609399
cond(S) = 113546.48426512242
E1 = -729.5456906194665  E_coul = 203.17635393828337
init E= -526.369336681183
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555708141485567  LUMO = 0.92347347590964
  mo_energy =
[-1.18333937e+02 -1.22068135e+01 -9.44711626e+00 -9.44711626e+00
 -9.44711626e+00 -1.24025392e+00 -5.55708141e-01 -5.55708141e-01
 -5.55708141e-01  9.23473476e-01  1.04948321e+00  1.04948321e+00
  1.04948321e+00  7.63302839e+00  7.63302839e+00  7.63302839e+00
  9.73889147e+00  3.46259456e+01  3.46259456e+01  3.46259456e+01
  4.87403975e+01  1.31230060e+02  1.31230060e+02  1.31230060e+02
  1.94011832e+02  4.85578293e+02  4.85578293e+02  4.85578293e+02
  7.28457952e+02  1.33624707e+03  1.33624707e+03  1.33624707e+03
  2.81881842e+03  3.02891750e+03  3.02891750e+03  3.02891750e+03
  6.64829203e+03  6.64829203e+03  6.64829203e+03  9.22022919e+03
  2.55681426e+04  7.63000836e+04]
E1 = -727.8484637208373  E_coul = 201.09592966434738
cycle= 1 E= -526.75253405649  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.567981
diis-c [-0.32260217  1.        ]
  HOMO = -0.590839909325484  LUMO = 0.897649152098694
  mo_energy =
[-1.18642509e+02 -1.23449822e+01 -9.59633400e+00 -9.59633400e+00
 -9.59633400e+00 -1.27979002e+00 -5.90839909e-01 -5.90839909e-01
 -5.90839909e-01  8.97649152e-01  1.02449914e+00  1.02449914e+00
  1.02449914e+00  7.53987191e+00  7.53987191e+00  7.53987191e+00
  9.64471816e+00  3.44698384e+01  3.44698384e+01  3.44698384e+01
  4.85830842e+01  1.31000958e+02  1.31000958e+02  1.31000958e+02
  1.93771996e+02  4.85271054e+02  4.85271054e+02  4.85271054e+02
  7.28108864e+02  1.33588334e+03  1.33588334e+03  1.33588334e+03
  2.81832238e+03  3.02848809e+03  3.02848809e+03  3.02848809e+03
  6.64774929e+03  6.64774929e+03  6.64774929e+03  9.21961253e+03
  2.55674309e+04  7.62992813e+04]
E1 = -728.4240772181278  E_coul = 201.67081571779465
cycle= 2 E= -526.753261500333  delta_E= -0.000727  |g|= 0.0378  |ddm|= 0.0533
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0771935
diis-c [-0.00372251  0.07727293  0.92272707]
  HOMO = -0.581668649709648  LUMO = 0.905163298818498
  mo_energy =
[-1.18574186e+02 -1.23066074e+01 -9.55629182e+00 -9.55629182e+00
 -9.55629182e+00 -1.26880343e+00 -5.81668650e-01 -5.81668650e-01
 -5.81668650e-01  9.05163299e-01  1.03140718e+00  1.03140718e+00
  1.03140718e+00  7.56430491e+00  7.56430491e+00  7.56430491e+00
  9.67057733e+00  3.45105433e+01  3.45105433e+01  3.45105433e+01
  4.86255331e+01  1.31057380e+02  1.31057380e+02  1.31057380e+02
  1.93831076e+02  4.85338529e+02  4.85338529e+02  4.85338529e+02
  7.28178773e+02  1.33595491e+03  1.33595491e+03  1.33595491e+03
  2.81839719e+03  3.02856193e+03  3.02856193e+03  3.02856193e+03
  6.64782488e+03  6.64782488e+03  6.64782488e+03  9.21968891e+03
  2.55675078e+04  7.62993586e+04]
E1 = -728.2725973141994  E_coul = 201.51927665611623
cycle= 3 E= -526.753320658083  delta_E= -5.92e-05  |g|= 0.00655  |ddm|= 0.0163
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0139468
diis-c [-8.13891557e-07 -1.27856568e-03  1.48602892e-01  8.52675673e-01]
  HOMO = -0.583222993439198  LUMO = 0.903987075357175
  mo_energy =
[-1.18584564e+02 -1.23126420e+01 -9.56268893e+00 -9.56268893e+00
 -9.56268893e+00 -1.27055240e+00 -5.83222993e-01 -5.83222993e-01
 -5.83222993e-01  9.03987075e-01  1.03026246e+00  1.03026246e+00
  1.03026246e+00  7.56030528e+00  7.56030528e+00  7.56030528e+00
  9.66644639e+00  3.45040837e+01  3.45040837e+01  3.45040837e+01
  4.86188829e+01  1.31048685e+02  1.31048685e+02  1.31048685e+02
  1.93822030e+02  4.85328276e+02  4.85328276e+02  4.85328276e+02
  7.28168132e+02  1.33594403e+03  1.33594403e+03  1.33594403e+03
  2.81838568e+03  3.02855065e+03  3.02855065e+03  3.02855065e+03
  6.64781320e+03  6.64781320e+03  6.64781320e+03  9.21967701e+03
  2.55674957e+04  7.62993464e+04]
E1 = -728.296239635945  E_coul = 201.54291690541402
cycle= 4 E= -526.753322730531  delta_E= -2.07e-06  |g|= 0.000107  |ddm|= 0.00232
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000121801
diis-c [-5.22854518e-09  8.96308473e-05 -1.27105764e-02 -7.74385134e-02
  1.09005946e+00]
  HOMO = -0.583204826119394  LUMO = 0.904020534990808
  mo_energy =
[-1.18584517e+02 -1.23125739e+01 -9.56263515e+00 -9.56263515e+00
 -9.56263515e+00 -1.27050916e+00 -5.83204826e-01 -5.83204826e-01
 -5.83204826e-01  9.04020535e-01  1.03027870e+00  1.03027870e+00
  1.03027870e+00  7.56034860e+00  7.56034860e+00  7.56034860e+00
  9.66650559e+00  3.45041358e+01  3.45041358e+01  3.45041358e+01
  4.86189429e+01  1.31048738e+02  1.31048738e+02  1.31048738e+02
  1.93822083e+02  4.85328322e+02  4.85328322e+02  4.85328322e+02
  7.28168170e+02  1.33594407e+03  1.33594407e+03  1.33594407e+03
  2.81838570e+03  3.02855068e+03  3.02855068e+03  3.02855068e+03
  6.64781321e+03  6.64781321e+03  6.64781321e+03  9.21967702e+03
  2.55674957e+04  7.62993464e+04]
E1 = -728.2960047867201  E_coul = 201.54268205408943
cycle= 5 E= -526.753322732631  delta_E= -2.1e-09  |g|= 2.09e-05  |ddm|= 0.000176
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.90662e-05
diis-c [-9.70620127e-11  1.28554483e-05 -1.74785154e-03 -1.26869415e-02
  3.43276235e-02  9.80094314e-01]
  HOMO = -0.583212734497378  LUMO = 0.90401671569939
  mo_energy =
[-1.18584549e+02 -1.23125976e+01 -9.56266075e+00 -9.56266075e+00
 -9.56266075e+00 -1.27051548e+00 -5.83212734e-01 -5.83212734e-01
 -5.83212734e-01  9.04016716e-01  1.03027334e+00  1.03027334e+00
  1.03027334e+00  7.56033082e+00  7.56033082e+00  7.56033082e+00
  9.66648842e+00  3.45041109e+01  3.45041109e+01  3.45041109e+01
  4.86189179e+01  1.31048709e+02  1.31048709e+02  1.31048709e+02
  1.93822053e+02  4.85328291e+02  4.85328291e+02  4.85328291e+02
  7.28168138e+02  1.33594404e+03  1.33594404e+03  1.33594404e+03
  2.81838566e+03  3.02855065e+03  3.02855065e+03  3.02855065e+03
  6.64781318e+03  6.64781318e+03  6.64781318e+03  9.21967698e+03
  2.55674957e+04  7.62993463e+04]
E1 = -728.296088696299  E_coul = 201.54276596360495
cycle= 6 E= -526.753322732694  delta_E= -6.32e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.296088696299  E_coul = 201.54276596360495
  HOMO = -0.583212612704353  LUMO = 0.904017153614195
  mo_energy =
[-1.18584548e+02 -1.23125969e+01 -9.56266015e+00 -9.56266015e+00
 -9.56266015e+00 -1.27051494e+00 -5.83212613e-01 -5.83212613e-01
 -5.83212613e-01  9.04017154e-01  1.03027348e+00  1.03027348e+00
  1.03027348e+00  7.56033123e+00  7.56033123e+00  7.56033123e+00
  9.66648900e+00  3.45041115e+01  3.45041115e+01  3.45041115e+01
  4.86189186e+01  1.31048710e+02  1.31048710e+02  1.31048710e+02
  1.93822054e+02  4.85328292e+02  4.85328292e+02  4.85328292e+02
  7.28168139e+02  1.33594404e+03  1.33594404e+03  1.33594404e+03
  2.81838566e+03  3.02855065e+03  3.02855065e+03  3.02855065e+03
  6.64781318e+03  6.64781318e+03  6.64781318e+03  9.21967698e+03
  2.55674957e+04  7.62993463e+04]
E1 = -728.2960855876694  E_coul = 201.54276285497443
Extra cycle  E= -526.753322732695  delta_E= -1.02e-12  |g|= 3.92e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113546.48426512242
E1 = -728.2960855876694  E_coul = 201.54276285497443
init E= -526.753322732695
    CPU time for initialize scf      0.79 sec, wall time      0.31 sec
  HOMO = -0.583212688617765  LUMO = 0.904017164351631
  mo_energy =
[-1.18584549e+02 -1.23125971e+01 -9.56266040e+00 -9.56266040e+00
 -9.56266040e+00 -1.27051494e+00 -5.83212689e-01 -5.83212689e-01
 -5.83212689e-01  9.04017164e-01  1.03027344e+00  1.03027344e+00
  1.03027344e+00  7.56033107e+00  7.56033107e+00  7.56033107e+00
  9.66648886e+00  3.45041113e+01  3.45041113e+01  3.45041113e+01
  4.86189183e+01  1.31048709e+02  1.31048709e+02  1.31048709e+02
  1.93822054e+02  4.85328291e+02  4.85328291e+02  4.85328291e+02
  7.28168139e+02  1.33594404e+03  1.33594404e+03  1.33594404e+03
  2.81838566e+03  3.02855065e+03  3.02855065e+03  3.02855065e+03
  6.64781318e+03  6.64781318e+03  6.64781318e+03  9.21967698e+03
  2.55674957e+04  7.62993463e+04]
E1 = -728.2960863040508  E_coul = 201.54276357135544
cycle= 1 E= -526.753322732695  delta_E= -4.55e-13  |g|= 9.11e-08  |ddm|= 6.04e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2960863040508  E_coul = 201.54276357135544
  HOMO = -0.583212678250458  LUMO = 0.904017187124686
  mo_energy =
[-1.18584549e+02 -1.23125971e+01 -9.56266035e+00 -9.56266035e+00
 -9.56266035e+00 -1.27051492e+00 -5.83212678e-01 -5.83212678e-01
 -5.83212678e-01  9.04017187e-01  1.03027345e+00  1.03027345e+00
  1.03027345e+00  7.56033110e+00  7.56033110e+00  7.56033110e+00
  9.66648891e+00  3.45041113e+01  3.45041113e+01  3.45041113e+01
  4.86189184e+01  1.31048709e+02  1.31048709e+02  1.31048709e+02
  1.93822054e+02  4.85328291e+02  4.85328291e+02  4.85328291e+02
  7.28168139e+02  1.33594404e+03  1.33594404e+03  1.33594404e+03
  2.81838566e+03  3.02855065e+03  3.02855065e+03  3.02855065e+03
  6.64781318e+03  6.64781318e+03  6.64781318e+03  9.21967698e+03
  2.55674957e+04  7.62993463e+04]
E1 = -728.2960860703705  E_coul = 201.5427633376745
Extra cycle  E= -526.753322732696  delta_E= -5.68e-13  |g|= 2e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.90 sec, wall time      0.42 sec
exp = [2.61826944e+04 7.61743132e+03 3.61738465e+03 1.59580528e+03
 3.88759345e+02 1.23962976e+02 4.62457898e+01 1.63952136e+01
 7.23841509e+00 6.41749252e-01 2.88423253e+00 2.29093876e-01
 1.36279599e+03 6.64622316e+02 3.00381268e+02 3.13541788e+02
 6.17930408e+01 7.53717322e+00 2.05460173e+01 7.86356031e-01
 2.91557611e+00 2.24460455e-01]
grad_E = [-1.56713537e-06  3.88385491e-06 -1.23819059e-06  9.17954268e-05
 -5.49727361e-04  1.82353435e-04  2.74904925e-04 -3.98320078e-04
  2.48208666e-04 -3.72631318e-04 -6.58905222e-05 -1.78963698e-03
 -4.96492155e-07  5.18816311e-06  2.47825753e-05  2.13307962e-05
 -1.46421852e-04 -5.57975646e-04  2.58007392e-04  4.43994993e-03
  3.39882655e-03 -1.34209519e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:12 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6953057        1
[INPUT] 0    0    [1    /1   ]  7617.42932765        1
[INPUT] 0    0    [1    /1   ]  3617.38555239        1
[INPUT] 0    0    [1    /1   ]  1595.76313867        1
[INPUT] 0    0    [1    /1   ]  388.781400714        1
[INPUT] 0    0    [1    /1   ]  124.548792876        1
[INPUT] 0    0    [1    /1   ]  46.8757359652        1
[INPUT] 0    0    [1    /1   ]  17.2500319037        1
[INPUT] 0    0    [1    /1   ]  7.15801019365        1
[INPUT] 0    0    [1    /1   ]  0.647816750867       1
[INPUT] 0    0    [1    /1   ]  2.85372781538        1
[INPUT] 0    0    [1    /1   ]  0.231407715328       1
[INPUT] 1    0    [1    /1   ]  1362.79628626        1
[INPUT] 1    0    [1    /1   ]  664.619373794        1
[INPUT] 1    0    [1    /1   ]  300.367409559        1
[INPUT] 1    0    [1    /1   ]  313.52984112         1
[INPUT] 1    0    [1    /1   ]  61.7970098762        1
[INPUT] 1    0    [1    /1   ]  7.50289684458        1
[INPUT] 1    0    [1    /1   ]  20.5764265961        1
[INPUT] 1    0    [1    /1   ]  0.781856782851       1
[INPUT] 1    0    [1    /1   ]  2.87316877139        1
[INPUT] 1    0    [1    /1   ]  0.223835081962       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.695305711644, 1.0]], [0, [7617.429327645576, 1.0]], [0, [3617.3855523949783, 1.0]], [0, [1595.7631386676583, 1.0]], [0, [388.78140071449735, 1.0]], [0, [124.54879287646821, 1.0]], [0, [46.87573596522965, 1.0]], [0, [17.250031903721563, 1.0]], [0, [7.1580101936484875, 1.0]], [0, [0.647816750866599, 1.0]], [0, [2.853727815383763, 1.0]], [0, [0.2314077153283678, 1.0]], [1, [1362.7962862579068, 1.0]], [1, [664.6193737940683, 1.0]], [1, [300.36740955922465, 1.0]], [1, [313.5298411201675, 1.0]], [1, [61.79700987624857, 1.0]], [1, [7.5028968445849715, 1.0]], [1, [20.576426596060074, 1.0]], [1, [0.7818567828514064, 1.0]], [1, [2.8731687713881984, 1.0]], [1, [0.22383508196199509, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69530571]
bas 1, expnt(s) = [7617.42932765]
bas 2, expnt(s) = [3617.38555239]
bas 3, expnt(s) = [1595.76313867]
bas 4, expnt(s) = [388.78140071]
bas 5, expnt(s) = [124.54879288]
bas 6, expnt(s) = [46.87573597]
bas 7, expnt(s) = [17.2500319]
bas 8, expnt(s) = [7.15801019]
bas 9, expnt(s) = [0.64781675]
bas 10, expnt(s) = [2.85372782]
bas 11, expnt(s) = [0.23140772]
bas 12, expnt(s) = [1362.79628626]
bas 13, expnt(s) = [664.61937379]
bas 14, expnt(s) = [300.36740956]
bas 15, expnt(s) = [313.52984112]
bas 16, expnt(s) = [61.79700988]
bas 17, expnt(s) = [7.50289684]
bas 18, expnt(s) = [20.5764266]
bas 19, expnt(s) = [0.78185678]
bas 20, expnt(s) = [2.87316877]
bas 21, expnt(s) = [0.22383508]
CPU time:       441.25
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826953e+04 5.20026874e+03 7.61742933e+03 2.06001959e+03
 3.61738555e+03 1.17844990e+03 1.59576314e+03 6.37883467e+02
 3.88781401e+02 2.21204590e+02 1.24548793e+02 9.41932249e+01
 4.68757360e+01 4.52612036e+01 1.72500319e+01 2.13849112e+01
 7.15801019e+00 1.10562859e+01 6.47816751e-01 1.82433317e+00
 2.85372782e+00 5.54720781e+00 2.31407715e-01 8.42943372e-01
 1.36279629e+03 2.41558914e+04 6.64619374e+02 9.84465812e+03
 3.00367410e+02 3.64796282e+03 3.13529841e+02 3.84886781e+03
 6.17970099e+01 5.05468062e+02 7.50289684e+00 3.62260191e+01
 2.05764266e+01 1.27848853e+02 7.81856783e-01 2.14483260e+00
 2.87316877e+00 1.09127904e+01 2.23835082e-01 4.49153291e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993582649533515
cond(S) = 113507.15445565809
E1 = -729.5452105079488  E_coul = 203.1755748231751
init E= -526.369635684774
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555725145427191  LUMO = 0.937154661802614
  mo_energy =
[-1.18334072e+02 -1.22069001e+01 -9.44718242e+00 -9.44718242e+00
 -9.44718242e+00 -1.24024282e+00 -5.55725145e-01 -5.55725145e-01
 -5.55725145e-01  9.37154662e-01  1.04287097e+00  1.04287097e+00
  1.04287097e+00  7.53038836e+00  7.53038836e+00  7.53038836e+00
  9.72635672e+00  3.43964865e+01  3.43964865e+01  3.43964865e+01
  4.97498620e+01  1.31040581e+02  1.31040581e+02  1.31040581e+02
  1.98055861e+02  4.85453446e+02  4.85453446e+02  4.85453446e+02
  7.35066519e+02  1.33611901e+03  1.33611901e+03  1.33611901e+03
  2.82601276e+03  3.02876282e+03  3.02876282e+03  3.02876282e+03
  6.64812173e+03  6.64812173e+03  6.64812173e+03  9.22708828e+03
  2.55746575e+04  7.63061545e+04]
E1 = -727.848112203948  E_coul = 201.0954461171003
cycle= 1 E= -526.752666086848  delta_E= -0.383  |g|= 0.187  |ddm|= 0.32
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.569108
diis-c [-0.32388357  1.        ]
  HOMO = -0.590705393943409  LUMO = 0.911149349419366
  mo_energy =
[-1.18642914e+02 -1.23450910e+01 -9.59645083e+00 -9.59645083e+00
 -9.59645083e+00 -1.27963771e+00 -5.90705394e-01 -5.90705394e-01
 -5.90705394e-01  9.11149349e-01  1.01818698e+00  1.01818698e+00
  1.01818698e+00  7.43796720e+00  7.43796720e+00  7.43796720e+00
  9.63224017e+00  3.42403413e+01  3.42403413e+01  3.42403413e+01
  4.95907906e+01  1.30811173e+02  1.30811173e+02  1.30811173e+02
  1.97814719e+02  4.85145929e+02  4.85145929e+02  4.85145929e+02
  7.34716965e+02  1.33575496e+03  1.33575496e+03  1.33575496e+03
  2.82551647e+03  3.02833308e+03  3.02833308e+03  3.02833308e+03
  6.64757863e+03  6.64757863e+03  6.64757863e+03  9.22647131e+03
  2.55739455e+04  7.63053518e+04]
E1 = -728.4241707366027  E_coul = 201.6707768209324
cycle= 2 E= -526.75339391567  delta_E= -0.000728  |g|= 0.0379  |ddm|= 0.0533
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0772665
diis-c [-0.00374788  0.07690816  0.92309184]
  HOMO = -0.581522986078288  LUMO = 0.918744281976989
  mo_energy =
[-1.18574494e+02 -1.23066768e+01 -9.55636545e+00 -9.55636545e+00
 -9.55636545e+00 -1.26864058e+00 -5.81522986e-01 -5.81522986e-01
 -5.81522986e-01  9.18744282e-01  1.02504724e+00  1.02504724e+00
  1.02504724e+00  7.46226351e+00  7.46226351e+00  7.46226351e+00
  9.65813401e+00  3.42810820e+01  3.42810820e+01  3.42810820e+01
  4.96337043e+01  1.30867687e+02  1.30867687e+02  1.30867687e+02
  1.97874061e+02  4.85213503e+02  4.85213503e+02  4.85213503e+02
  7.34786984e+02  1.33582663e+03  1.33582663e+03  1.33582663e+03
  2.82559139e+03  3.02840702e+03  3.02840702e+03  3.02840702e+03
  6.64765434e+03  6.64765434e+03  6.64765434e+03  9.22654780e+03
  2.55740226e+04  7.63054292e+04]
E1 = -728.2724627047236  E_coul = 201.51900954645942
cycle= 3 E= -526.753453158264  delta_E= -5.92e-05  |g|= 0.00658  |ddm|= 0.0163
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0139973
diis-c [-8.17668998e-07 -1.28354971e-03  1.48951908e-01  8.52331642e-01]
  HOMO = -0.583081385058867  LUMO = 0.917552107598697
  mo_energy =
[-1.18584914e+02 -1.23127346e+01 -9.56278685e+00 -9.56278685e+00
 -9.56278685e+00 -1.27039574e+00 -5.83081385e-01 -5.83081385e-01
 -5.83081385e-01  9.17552108e-01  1.02390861e+00  1.02390861e+00
  1.02390861e+00  7.45827612e+00  7.45827612e+00  7.45827612e+00
  9.65398727e+00  3.42745990e+01  3.42745990e+01  3.42745990e+01
  4.96269679e+01  1.30858954e+02  1.30858954e+02  1.30858954e+02
  1.97864951e+02  4.85203206e+02  4.85203206e+02  4.85203206e+02
  7.34776298e+02  1.33581571e+03  1.33581571e+03  1.33581571e+03
  2.82557983e+03  3.02839570e+03  3.02839570e+03  3.02839570e+03
  6.64764261e+03  6.64764261e+03  6.64764261e+03  9.22653586e+03
  2.55740104e+04  7.63054169e+04]
E1 = -728.2962108880968  E_coul = 201.54275564150245
cycle= 4 E= -526.753455246594  delta_E= -2.09e-06  |g|= 0.000106  |ddm|= 0.00233
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000119865
diis-c [-5.16515624e-09  8.79873213e-05 -1.24924302e-02 -7.58271519e-02
  1.08823159e+00]
  HOMO = -0.583062742700337  LUMO = 0.917585906040719
  mo_energy =
[-1.18584866e+02 -1.23126655e+01 -9.56273206e+00 -9.56273206e+00
 -9.56273206e+00 -1.27035238e+00 -5.83062743e-01 -5.83062743e-01
 -5.83062743e-01  9.17585906e-01  1.02392506e+00  1.02392506e+00
  1.02392506e+00  7.45832005e+00  7.45832005e+00  7.45832005e+00
  9.65404705e+00  3.42746521e+01  3.42746521e+01  3.42746521e+01
  4.96270288e+01  1.30859008e+02  1.30859008e+02  1.30859008e+02
  1.97865005e+02  4.85203254e+02  4.85203254e+02  4.85203254e+02
  7.34776338e+02  1.33581575e+03  1.33581575e+03  1.33581575e+03
  2.82557985e+03  3.02839573e+03  3.02839573e+03  3.02839573e+03
  6.64764262e+03  6.64764262e+03  6.64764262e+03  9.22653587e+03
  2.55740104e+04  7.63054169e+04]
E1 = -728.295974688303  E_coul = 201.54251943967316
cycle= 5 E= -526.75345524863  delta_E= -2.04e-09  |g|= 2.09e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.904e-05
diis-c [-9.51652896e-11  1.28315874e-05 -1.74922340e-03 -1.26531002e-02
  3.51106577e-02  9.79278834e-01]
  HOMO = -0.583070582068668  LUMO = 0.917582075229297
  mo_energy =
[-1.18584898e+02 -1.23126891e+01 -9.56275751e+00 -9.56275751e+00
 -9.56275751e+00 -1.27035866e+00 -5.83070582e-01 -5.83070582e-01
 -5.83070582e-01  9.17582075e-01  1.02391978e+00  1.02391978e+00
  1.02391978e+00  7.45830250e+00  7.45830250e+00  7.45830250e+00
  9.65403001e+00  3.42746273e+01  3.42746273e+01  3.42746273e+01
  4.96270038e+01  1.30858979e+02  1.30858979e+02  1.30858979e+02
  1.97864976e+02  4.85203223e+02  4.85203223e+02  4.85203223e+02
  7.34776306e+02  1.33581572e+03  1.33581572e+03  1.33581572e+03
  2.82557981e+03  3.02839570e+03  3.02839570e+03  3.02839570e+03
  6.64764259e+03  6.64764259e+03  6.64764259e+03  9.22653583e+03
  2.55740104e+04  7.63054169e+04]
E1 = -728.2960583584173  E_coul = 201.54260310972626
cycle= 6 E= -526.753455248691  delta_E= -6.13e-11  |g|= 1.84e-06  |ddm|= 1.96e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2960583584173  E_coul = 201.54260310972626
  HOMO = -0.583070471694887  LUMO = 0.917582507777431
  mo_energy =
[-1.18584897e+02 -1.23126885e+01 -9.56275696e+00 -9.56275696e+00
 -9.56275696e+00 -1.27035812e+00 -5.83070472e-01 -5.83070472e-01
 -5.83070472e-01  9.17582508e-01  1.02391992e+00  1.02391992e+00
  1.02391992e+00  7.45830288e+00  7.45830288e+00  7.45830288e+00
  9.65403056e+00  3.42746279e+01  3.42746279e+01  3.42746279e+01
  4.96270045e+01  1.30858980e+02  1.30858980e+02  1.30858980e+02
  1.97864977e+02  4.85203224e+02  4.85203224e+02  4.85203224e+02
  7.34776306e+02  1.33581572e+03  1.33581572e+03  1.33581572e+03
  2.82557982e+03  3.02839570e+03  3.02839570e+03  3.02839570e+03
  6.64764259e+03  6.64764259e+03  6.64764259e+03  9.22653583e+03
  2.55740104e+04  7.63054169e+04]
E1 = -728.2960554554877  E_coul = 201.54260020679612
Extra cycle  E= -526.753455248692  delta_E= -4.55e-13  |g|= 3.88e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
exp = [2.61826953e+04 7.61742933e+03 3.61738555e+03 1.59576314e+03
 3.88781401e+02 1.24548793e+02 4.68757360e+01 1.72500319e+01
 7.15801019e+00 6.47816751e-01 2.85372782e+00 2.31407715e-01
 1.36279629e+03 6.64619374e+02 3.00367410e+02 3.13529841e+02
 6.17970099e+01 7.50289684e+00 2.05764266e+01 7.81856783e-01
 2.87316877e+00 2.23835082e-01]
E = -526.7534552486916
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:12 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6953057        1
[INPUT] 0    0    [1    /1   ]  7617.42932765        1
[INPUT] 0    0    [1    /1   ]  3617.38555239        1
[INPUT] 0    0    [1    /1   ]  1595.76313867        1
[INPUT] 0    0    [1    /1   ]  388.781400714        1
[INPUT] 0    0    [1    /1   ]  124.548792876        1
[INPUT] 0    0    [1    /1   ]  46.8757359652        1
[INPUT] 0    0    [1    /1   ]  17.2500319037        1
[INPUT] 0    0    [1    /1   ]  7.15801019365        1
[INPUT] 0    0    [1    /1   ]  0.647816750867       1
[INPUT] 0    0    [1    /1   ]  2.85372781538        1
[INPUT] 0    0    [1    /1   ]  0.231407715328       1
[INPUT] 1    0    [1    /1   ]  1362.79628626        1
[INPUT] 1    0    [1    /1   ]  664.619373794        1
[INPUT] 1    0    [1    /1   ]  300.367409559        1
[INPUT] 1    0    [1    /1   ]  313.52984112         1
[INPUT] 1    0    [1    /1   ]  61.7970098762        1
[INPUT] 1    0    [1    /1   ]  7.50289684458        1
[INPUT] 1    0    [1    /1   ]  20.5764265961        1
[INPUT] 1    0    [1    /1   ]  0.781856782851       1
[INPUT] 1    0    [1    /1   ]  2.87316877139        1
[INPUT] 1    0    [1    /1   ]  0.223835081962       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.695305711644, 1.0]], [0, [7617.429327645576, 1.0]], [0, [3617.3855523949783, 1.0]], [0, [1595.7631386676583, 1.0]], [0, [388.78140071449735, 1.0]], [0, [124.54879287646821, 1.0]], [0, [46.87573596522965, 1.0]], [0, [17.250031903721563, 1.0]], [0, [7.1580101936484875, 1.0]], [0, [0.647816750866599, 1.0]], [0, [2.853727815383763, 1.0]], [0, [0.2314077153283678, 1.0]], [1, [1362.7962862579068, 1.0]], [1, [664.6193737940683, 1.0]], [1, [300.36740955922465, 1.0]], [1, [313.5298411201675, 1.0]], [1, [61.79700987624857, 1.0]], [1, [7.5028968445849715, 1.0]], [1, [20.576426596060074, 1.0]], [1, [0.7818567828514064, 1.0]], [1, [2.8731687713881984, 1.0]], [1, [0.22383508196199509, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69530571]
bas 1, expnt(s) = [7617.42932765]
bas 2, expnt(s) = [3617.38555239]
bas 3, expnt(s) = [1595.76313867]
bas 4, expnt(s) = [388.78140071]
bas 5, expnt(s) = [124.54879288]
bas 6, expnt(s) = [46.87573597]
bas 7, expnt(s) = [17.2500319]
bas 8, expnt(s) = [7.15801019]
bas 9, expnt(s) = [0.64781675]
bas 10, expnt(s) = [2.85372782]
bas 11, expnt(s) = [0.23140772]
bas 12, expnt(s) = [1362.79628626]
bas 13, expnt(s) = [664.61937379]
bas 14, expnt(s) = [300.36740956]
bas 15, expnt(s) = [313.52984112]
bas 16, expnt(s) = [61.79700988]
bas 17, expnt(s) = [7.50289684]
bas 18, expnt(s) = [20.5764266]
bas 19, expnt(s) = [0.78185678]
bas 20, expnt(s) = [2.87316877]
bas 21, expnt(s) = [0.22383508]
CPU time:       441.71
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826953e+04 5.20026874e+03 7.61742933e+03 2.06001959e+03
 3.61738555e+03 1.17844990e+03 1.59576314e+03 6.37883467e+02
 3.88781401e+02 2.21204590e+02 1.24548793e+02 9.41932249e+01
 4.68757360e+01 4.52612036e+01 1.72500319e+01 2.13849112e+01
 7.15801019e+00 1.10562859e+01 6.47816751e-01 1.82433317e+00
 2.85372782e+00 5.54720781e+00 2.31407715e-01 8.42943372e-01
 1.36279629e+03 2.41558914e+04 6.64619374e+02 9.84465812e+03
 3.00367410e+02 3.64796282e+03 3.13529841e+02 3.84886781e+03
 6.17970099e+01 5.05468062e+02 7.50289684e+00 3.62260191e+01
 2.05764266e+01 1.27848853e+02 7.81856783e-01 2.14483260e+00
 2.87316877e+00 1.09127904e+01 2.23835082e-01 4.49153291e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993582649533515
cond(S) = 113507.15445565809
E1 = -729.5452105079488  E_coul = 203.1755748231751
init E= -526.369635684774
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555725145427191  LUMO = 0.937154661802614
  mo_energy =
[-1.18334072e+02 -1.22069001e+01 -9.44718242e+00 -9.44718242e+00
 -9.44718242e+00 -1.24024282e+00 -5.55725145e-01 -5.55725145e-01
 -5.55725145e-01  9.37154662e-01  1.04287097e+00  1.04287097e+00
  1.04287097e+00  7.53038836e+00  7.53038836e+00  7.53038836e+00
  9.72635672e+00  3.43964865e+01  3.43964865e+01  3.43964865e+01
  4.97498620e+01  1.31040581e+02  1.31040581e+02  1.31040581e+02
  1.98055861e+02  4.85453446e+02  4.85453446e+02  4.85453446e+02
  7.35066519e+02  1.33611901e+03  1.33611901e+03  1.33611901e+03
  2.82601276e+03  3.02876282e+03  3.02876282e+03  3.02876282e+03
  6.64812173e+03  6.64812173e+03  6.64812173e+03  9.22708828e+03
  2.55746575e+04  7.63061545e+04]
E1 = -727.848112203948  E_coul = 201.0954461171003
cycle= 1 E= -526.752666086848  delta_E= -0.383  |g|= 0.187  |ddm|= 0.32
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.569108
diis-c [-0.32388357  1.        ]
  HOMO = -0.590705393943409  LUMO = 0.911149349419366
  mo_energy =
[-1.18642914e+02 -1.23450910e+01 -9.59645083e+00 -9.59645083e+00
 -9.59645083e+00 -1.27963771e+00 -5.90705394e-01 -5.90705394e-01
 -5.90705394e-01  9.11149349e-01  1.01818698e+00  1.01818698e+00
  1.01818698e+00  7.43796720e+00  7.43796720e+00  7.43796720e+00
  9.63224017e+00  3.42403413e+01  3.42403413e+01  3.42403413e+01
  4.95907906e+01  1.30811173e+02  1.30811173e+02  1.30811173e+02
  1.97814719e+02  4.85145929e+02  4.85145929e+02  4.85145929e+02
  7.34716965e+02  1.33575496e+03  1.33575496e+03  1.33575496e+03
  2.82551647e+03  3.02833308e+03  3.02833308e+03  3.02833308e+03
  6.64757863e+03  6.64757863e+03  6.64757863e+03  9.22647131e+03
  2.55739455e+04  7.63053518e+04]
E1 = -728.4241707366027  E_coul = 201.6707768209324
cycle= 2 E= -526.75339391567  delta_E= -0.000728  |g|= 0.0379  |ddm|= 0.0533
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0772665
diis-c [-0.00374788  0.07690816  0.92309184]
  HOMO = -0.581522986078288  LUMO = 0.918744281976989
  mo_energy =
[-1.18574494e+02 -1.23066768e+01 -9.55636545e+00 -9.55636545e+00
 -9.55636545e+00 -1.26864058e+00 -5.81522986e-01 -5.81522986e-01
 -5.81522986e-01  9.18744282e-01  1.02504724e+00  1.02504724e+00
  1.02504724e+00  7.46226351e+00  7.46226351e+00  7.46226351e+00
  9.65813401e+00  3.42810820e+01  3.42810820e+01  3.42810820e+01
  4.96337043e+01  1.30867687e+02  1.30867687e+02  1.30867687e+02
  1.97874061e+02  4.85213503e+02  4.85213503e+02  4.85213503e+02
  7.34786984e+02  1.33582663e+03  1.33582663e+03  1.33582663e+03
  2.82559139e+03  3.02840702e+03  3.02840702e+03  3.02840702e+03
  6.64765434e+03  6.64765434e+03  6.64765434e+03  9.22654780e+03
  2.55740226e+04  7.63054292e+04]
E1 = -728.2724627047236  E_coul = 201.51900954645942
cycle= 3 E= -526.753453158264  delta_E= -5.92e-05  |g|= 0.00658  |ddm|= 0.0163
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0139973
diis-c [-8.17668998e-07 -1.28354971e-03  1.48951908e-01  8.52331642e-01]
  HOMO = -0.583081385058867  LUMO = 0.917552107598697
  mo_energy =
[-1.18584914e+02 -1.23127346e+01 -9.56278685e+00 -9.56278685e+00
 -9.56278685e+00 -1.27039574e+00 -5.83081385e-01 -5.83081385e-01
 -5.83081385e-01  9.17552108e-01  1.02390861e+00  1.02390861e+00
  1.02390861e+00  7.45827612e+00  7.45827612e+00  7.45827612e+00
  9.65398727e+00  3.42745990e+01  3.42745990e+01  3.42745990e+01
  4.96269679e+01  1.30858954e+02  1.30858954e+02  1.30858954e+02
  1.97864951e+02  4.85203206e+02  4.85203206e+02  4.85203206e+02
  7.34776298e+02  1.33581571e+03  1.33581571e+03  1.33581571e+03
  2.82557983e+03  3.02839570e+03  3.02839570e+03  3.02839570e+03
  6.64764261e+03  6.64764261e+03  6.64764261e+03  9.22653586e+03
  2.55740104e+04  7.63054169e+04]
E1 = -728.2962108880968  E_coul = 201.54275564150245
cycle= 4 E= -526.753455246594  delta_E= -2.09e-06  |g|= 0.000106  |ddm|= 0.00233
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119865
diis-c [-5.16515624e-09  8.79873213e-05 -1.24924302e-02 -7.58271519e-02
  1.08823159e+00]
  HOMO = -0.583062742700337  LUMO = 0.917585906040719
  mo_energy =
[-1.18584866e+02 -1.23126655e+01 -9.56273206e+00 -9.56273206e+00
 -9.56273206e+00 -1.27035238e+00 -5.83062743e-01 -5.83062743e-01
 -5.83062743e-01  9.17585906e-01  1.02392506e+00  1.02392506e+00
  1.02392506e+00  7.45832005e+00  7.45832005e+00  7.45832005e+00
  9.65404705e+00  3.42746521e+01  3.42746521e+01  3.42746521e+01
  4.96270288e+01  1.30859008e+02  1.30859008e+02  1.30859008e+02
  1.97865005e+02  4.85203254e+02  4.85203254e+02  4.85203254e+02
  7.34776338e+02  1.33581575e+03  1.33581575e+03  1.33581575e+03
  2.82557985e+03  3.02839573e+03  3.02839573e+03  3.02839573e+03
  6.64764262e+03  6.64764262e+03  6.64764262e+03  9.22653587e+03
  2.55740104e+04  7.63054169e+04]
E1 = -728.295974688303  E_coul = 201.54251943967316
cycle= 5 E= -526.75345524863  delta_E= -2.04e-09  |g|= 2.09e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.904e-05
diis-c [-9.51652896e-11  1.28315874e-05 -1.74922340e-03 -1.26531002e-02
  3.51106577e-02  9.79278834e-01]
  HOMO = -0.583070582068668  LUMO = 0.917582075229297
  mo_energy =
[-1.18584898e+02 -1.23126891e+01 -9.56275751e+00 -9.56275751e+00
 -9.56275751e+00 -1.27035866e+00 -5.83070582e-01 -5.83070582e-01
 -5.83070582e-01  9.17582075e-01  1.02391978e+00  1.02391978e+00
  1.02391978e+00  7.45830250e+00  7.45830250e+00  7.45830250e+00
  9.65403001e+00  3.42746273e+01  3.42746273e+01  3.42746273e+01
  4.96270038e+01  1.30858979e+02  1.30858979e+02  1.30858979e+02
  1.97864976e+02  4.85203223e+02  4.85203223e+02  4.85203223e+02
  7.34776306e+02  1.33581572e+03  1.33581572e+03  1.33581572e+03
  2.82557981e+03  3.02839570e+03  3.02839570e+03  3.02839570e+03
  6.64764259e+03  6.64764259e+03  6.64764259e+03  9.22653583e+03
  2.55740104e+04  7.63054169e+04]
E1 = -728.2960583584173  E_coul = 201.54260310972626
cycle= 6 E= -526.753455248691  delta_E= -6.13e-11  |g|= 1.84e-06  |ddm|= 1.96e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2960583584173  E_coul = 201.54260310972626
  HOMO = -0.583070471694887  LUMO = 0.917582507777431
  mo_energy =
[-1.18584897e+02 -1.23126885e+01 -9.56275696e+00 -9.56275696e+00
 -9.56275696e+00 -1.27035812e+00 -5.83070472e-01 -5.83070472e-01
 -5.83070472e-01  9.17582508e-01  1.02391992e+00  1.02391992e+00
  1.02391992e+00  7.45830288e+00  7.45830288e+00  7.45830288e+00
  9.65403056e+00  3.42746279e+01  3.42746279e+01  3.42746279e+01
  4.96270045e+01  1.30858980e+02  1.30858980e+02  1.30858980e+02
  1.97864977e+02  4.85203224e+02  4.85203224e+02  4.85203224e+02
  7.34776306e+02  1.33581572e+03  1.33581572e+03  1.33581572e+03
  2.82557982e+03  3.02839570e+03  3.02839570e+03  3.02839570e+03
  6.64764259e+03  6.64764259e+03  6.64764259e+03  9.22653583e+03
  2.55740104e+04  7.63054169e+04]
E1 = -728.2960554554877  E_coul = 201.54260020679612
Extra cycle  E= -526.753455248692  delta_E= -4.55e-13  |g|= 3.88e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113507.15445565809
E1 = -728.2960554554877  E_coul = 201.54260020679612
init E= -526.753455248692
    CPU time for initialize scf      0.79 sec, wall time      0.31 sec
  HOMO = -0.583070543133337  LUMO = 0.917582521982011
  mo_energy =
[-1.18584898e+02 -1.23126887e+01 -9.56275720e+00 -9.56275720e+00
 -9.56275720e+00 -1.27035812e+00 -5.83070543e-01 -5.83070543e-01
 -5.83070543e-01  9.17582522e-01  1.02391988e+00  1.02391988e+00
  1.02391988e+00  7.45830272e+00  7.45830272e+00  7.45830272e+00
  9.65403043e+00  3.42746277e+01  3.42746277e+01  3.42746277e+01
  4.96270042e+01  1.30858979e+02  1.30858979e+02  1.30858979e+02
  1.97864976e+02  4.85203224e+02  4.85203224e+02  4.85203224e+02
  7.34776306e+02  1.33581572e+03  1.33581572e+03  1.33581572e+03
  2.82557981e+03  3.02839570e+03  3.02839570e+03  3.02839570e+03
  6.64764259e+03  6.64764259e+03  6.64764259e+03  9.22653583e+03
  2.55740104e+04  7.63054169e+04]
E1 = -728.2960561217519  E_coul = 201.54260087306037
cycle= 1 E= -526.753455248692  delta_E=    0  |g|= 8.94e-08  |ddm|= 6.05e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2960561217519  E_coul = 201.54260087306037
  HOMO = -0.583070533606649  LUMO = 0.917582544238684
  mo_energy =
[-1.18584897e+02 -1.23126886e+01 -9.56275715e+00 -9.56275715e+00
 -9.56275715e+00 -1.27035810e+00 -5.83070534e-01 -5.83070534e-01
 -5.83070534e-01  9.17582544e-01  1.02391989e+00  1.02391989e+00
  1.02391989e+00  7.45830275e+00  7.45830275e+00  7.45830275e+00
  9.65403047e+00  3.42746277e+01  3.42746277e+01  3.42746277e+01
  4.96270043e+01  1.30858979e+02  1.30858979e+02  1.30858979e+02
  1.97864976e+02  4.85203224e+02  4.85203224e+02  4.85203224e+02
  7.34776306e+02  1.33581572e+03  1.33581572e+03  1.33581572e+03
  2.82557981e+03  3.02839570e+03  3.02839570e+03  3.02839570e+03
  6.64764259e+03  6.64764259e+03  6.64764259e+03  9.22653583e+03
  2.55740104e+04  7.63054169e+04]
E1 = -728.2960559036889  E_coul = 201.5426006549965
Extra cycle  E= -526.753455248692  delta_E= -7.96e-13  |g|= 1.94e-08  |ddm|= 1.39e-07
    CPU time for scf_cycle      0.90 sec, wall time      0.42 sec
exp = [2.61826953e+04 7.61742933e+03 3.61738555e+03 1.59576314e+03
 3.88781401e+02 1.24548793e+02 4.68757360e+01 1.72500319e+01
 7.15801019e+00 6.47816751e-01 2.85372782e+00 2.31407715e-01
 1.36279629e+03 6.64619374e+02 3.00367410e+02 3.13529841e+02
 6.17970099e+01 7.50289684e+00 2.05764266e+01 7.81856783e-01
 2.87316877e+00 2.23835082e-01]
grad_E = [-1.56902987e-06  3.90750377e-06 -1.21803393e-06  9.26404049e-05
 -5.62417982e-04  2.12151473e-04  2.29210086e-04 -3.45887213e-04
  2.82918897e-04 -6.59883140e-04 -6.11320075e-04  1.29420932e-03
 -4.87577849e-07  5.30686029e-06  2.54990956e-05  2.19459070e-05
 -2.14854193e-04  3.14542182e-04  5.57647644e-04 -1.13283112e-04
 -2.34174130e-04 -5.08288385e-04]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:16 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6956659        1
[INPUT] 0    0    [1    /1   ]  7617.42854475        1
[INPUT] 0    0    [1    /1   ]  3617.38592846        1
[INPUT] 0    0    [1    /1   ]  1595.74682673        1
[INPUT] 0    0    [1    /1   ]  388.777559513        1
[INPUT] 0    0    [1    /1   ]  124.803690383        1
[INPUT] 0    0    [1    /1   ]  47.1776194695        1
[INPUT] 0    0    [1    /1   ]  17.6762708312        1
[INPUT] 0    0    [1    /1   ]  7.10055530042        1
[INPUT] 0    0    [1    /1   ]  0.649029896747       1
[INPUT] 0    0    [1    /1   ]  2.84318658974        1
[INPUT] 0    0    [1    /1   ]  0.231611078252       1
[INPUT] 1    0    [1    /1   ]  1362.79640682        1
[INPUT] 1    0    [1    /1   ]  664.61818646         1
[INPUT] 1    0    [1    /1   ]  300.361811372        1
[INPUT] 1    0    [1    /1   ]  313.525014671        1
[INPUT] 1    0    [1    /1   ]  61.800432061         1
[INPUT] 1    0    [1    /1   ]  7.49869613646        1
[INPUT] 1    0    [1    /1   ]  20.5793097404        1
[INPUT] 1    0    [1    /1   ]  0.781611407792       1
[INPUT] 1    0    [1    /1   ]  2.86918226294        1
[INPUT] 1    0    [1    /1   ]  0.223850593196       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.695665877738, 1.0]], [0, [7617.428544749705, 1.0]], [0, [3617.385928456652, 1.0]], [0, [1595.7468267275647, 1.0]], [0, [388.7775595133812, 1.0]], [0, [124.80369038267149, 1.0]], [0, [47.177619469480796, 1.0]], [0, [17.676270831188273, 1.0]], [0, [7.100555300416525, 1.0]], [0, [0.6490298967474838, 1.0]], [0, [2.843186589738378, 1.0]], [0, [0.23161107825213528, 1.0]], [1, [1362.7964068212507, 1.0]], [1, [664.6181864602953, 1.0]], [1, [300.3618113718059, 1.0]], [1, [313.52501467091497, 1.0]], [1, [61.80043206099213, 1.0]], [1, [7.498696136457416, 1.0]], [1, [20.579309740414917, 1.0]], [1, [0.781611407792225, 1.0]], [1, [2.8691822629366044, 1.0]], [1, [0.22385059319569225, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69566588]
bas 1, expnt(s) = [7617.42854475]
bas 2, expnt(s) = [3617.38592846]
bas 3, expnt(s) = [1595.74682673]
bas 4, expnt(s) = [388.77755951]
bas 5, expnt(s) = [124.80369038]
bas 6, expnt(s) = [47.17761947]
bas 7, expnt(s) = [17.67627083]
bas 8, expnt(s) = [7.1005553]
bas 9, expnt(s) = [0.6490299]
bas 10, expnt(s) = [2.84318659]
bas 11, expnt(s) = [0.23161108]
bas 12, expnt(s) = [1362.79640682]
bas 13, expnt(s) = [664.61818646]
bas 14, expnt(s) = [300.36181137]
bas 15, expnt(s) = [313.52501467]
bas 16, expnt(s) = [61.80043206]
bas 17, expnt(s) = [7.49869614]
bas 18, expnt(s) = [20.57930974]
bas 19, expnt(s) = [0.78161141]
bas 20, expnt(s) = [2.86918226]
bas 21, expnt(s) = [0.22385059]
CPU time:       447.13
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826957e+04 5.20026880e+03 7.61742854e+03 2.06001943e+03
 3.61738593e+03 1.17844999e+03 1.59574683e+03 6.37878576e+02
 3.88777560e+02 2.21202951e+02 1.24803690e+02 9.43377676e+01
 4.71776195e+01 4.54796424e+01 1.76762708e+01 2.17800067e+01
 7.10055530e+00 1.09896601e+01 6.49029897e-01 1.82689485e+00
 2.84318659e+00 5.53183281e+00 2.31611078e-01 8.43498900e-01
 1.36279641e+03 2.41558941e+04 6.64618186e+02 9.84463613e+03
 3.00361811e+02 3.64787784e+03 3.13525015e+02 3.84879375e+03
 6.18004321e+01 5.05503052e+02 7.49869614e+00 3.62006682e+01
 2.05793097e+01 1.27871246e+02 7.81611408e-01 2.14399123e+00
 2.86918226e+00 1.08938669e+01 2.23850593e-01 4.49192198e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993585358661235
cond(S) = 113491.91644891504
E1 = -729.5452174818357  E_coul = 203.175590039492
init E= -526.369627442344
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555722528840355  LUMO = 0.938926463104807
  mo_energy =
[-1.18334090e+02 -1.22068937e+01 -9.44718284e+00 -9.44718284e+00
 -9.44718284e+00 -1.24024020e+00 -5.55722529e-01 -5.55722529e-01
 -5.55722529e-01  9.38926463e-01  1.04269410e+00  1.04269410e+00
  1.04269410e+00  7.52144483e+00  7.52144483e+00  7.52144483e+00
  9.70221020e+00  3.43734301e+01  3.43734301e+01  3.43734301e+01
  5.01942613e+01  1.31022895e+02  1.31022895e+02  1.31022895e+02
  1.99956528e+02  4.85444969e+02  4.85444969e+02  4.85444969e+02
  7.38154523e+02  1.33610362e+03  1.33610362e+03  1.33610362e+03
  2.82933566e+03  3.02873390e+03  3.02873390e+03  3.02873390e+03
  6.64808350e+03  6.64808350e+03  6.64808350e+03  9.23024422e+03
  2.55776541e+04  7.63089472e+04]
E1 = -727.8491700940225  E_coul = 201.09648018511308
cycle= 1 E= -526.752689908909  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.569671
diis-c [-0.3245246  1.       ]
  HOMO = -0.590675758488442  LUMO = 0.912913746191786
  mo_energy =
[-1.18642865e+02 -1.23450071e+01 -9.59636815e+00 -9.59636815e+00
 -9.59636815e+00 -1.27960222e+00 -5.90675758e-01 -5.90675758e-01
 -5.90675758e-01  9.12913746e-01  1.01804218e+00  1.01804218e+00
  1.01804218e+00  7.42915539e+00  7.42915539e+00  7.42915539e+00
  9.60819487e+00  3.42173524e+01  3.42173524e+01  3.42173524e+01
  5.00344975e+01  1.30793559e+02  1.30793559e+02  1.30793559e+02
  1.99714929e+02  4.85137510e+02  4.85137510e+02  4.85137510e+02
  7.37804959e+02  1.33573962e+03  1.33573962e+03  1.33573962e+03
  2.82883945e+03  3.02830422e+03  3.02830422e+03  3.02830422e+03
  6.64754045e+03  6.64754045e+03  6.64754045e+03  9.22962732e+03
  2.55769421e+04  7.63081445e+04]
E1 = -728.4249897342563  E_coul = 201.6715724598395
cycle= 2 E= -526.753417274417  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0532
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0772849
diis-c [-0.00375805  0.07672125  0.92327875]
  HOMO = -0.581498323845083  LUMO = 0.920513230478919
  mo_energy =
[-1.18574447e+02 -1.23066021e+01 -9.55629080e+00 -9.55629080e+00
 -9.55629080e+00 -1.26861034e+00 -5.81498324e-01 -5.81498324e-01
 -5.81498324e-01  9.20513230e-01  1.02489617e+00  1.02489617e+00
  1.02489617e+00  7.45342785e+00  7.45342785e+00  7.45342785e+00
  9.63407030e+00  3.42580834e+01  3.42580834e+01  3.42580834e+01
  5.00775993e+01  1.30850069e+02  1.30850069e+02  1.30850069e+02
  1.99774354e+02  4.85205082e+02  4.85205082e+02  4.85205082e+02
  7.37874980e+02  1.33581130e+03  1.33581130e+03  1.33581130e+03
  2.82891437e+03  3.02837816e+03  3.02837816e+03  3.02837816e+03
  6.64761616e+03  6.64761616e+03  6.64761616e+03  9.22970381e+03
  2.55770192e+04  7.63082219e+04]
E1 = -728.2732950507403  E_coul = 201.51981857223603
cycle= 3 E= -526.753476478504  delta_E= -5.92e-05  |g|= 0.00659  |ddm|= 0.0162
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.014016
diis-c [-8.21351321e-07 -1.28494692e-03  1.49096565e-01  8.52188382e-01]
  HOMO = -0.583058170996152  LUMO = 0.919318700095572
  mo_energy =
[-1.18584880e+02 -1.23126666e+01 -9.56271921e+00 -9.56271921e+00
 -9.56271921e+00 -1.27036709e+00 -5.83058171e-01 -5.83058171e-01
 -5.83058171e-01  9.19318700e-01  1.02375697e+00  1.02375697e+00
  1.02375697e+00  7.44943891e+00  7.44943891e+00  7.44943891e+00
  9.62992088e+00  3.42515936e+01  3.42515936e+01  3.42515936e+01
  5.00708273e+01  1.30841326e+02  1.30841326e+02  1.30841326e+02
  1.99765221e+02  4.85194773e+02  4.85194773e+02  4.85194773e+02
  7.37864280e+02  1.33580036e+03  1.33580036e+03  1.33580036e+03
  2.82890280e+03  3.02836683e+03  3.02836683e+03  3.02836683e+03
  6.64760441e+03  6.64760441e+03  6.64760441e+03  9.22969185e+03
  2.55770071e+04  7.63082096e+04]
E1 = -728.2970717546685  E_coul = 201.54359318305723
cycle= 4 E= -526.753478571611  delta_E= -2.09e-06  |g|= 0.000106  |ddm|= 0.00233
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000119397
diis-c [-5.17055120e-09  8.77318302e-05 -1.24617318e-02 -7.54985818e-02
  1.08787258e+00]
  HOMO = -0.583039377292791  LUMO = 0.919352693169402
  mo_energy =
[-1.18584832e+02 -1.23125970e+01 -9.56266387e+00 -9.56266387e+00
 -9.56266387e+00 -1.27032351e+00 -5.83039377e-01 -5.83039377e-01
 -5.83039377e-01  9.19352693e-01  1.02377353e+00  1.02377353e+00
  1.02377353e+00  7.44948319e+00  7.44948319e+00  7.44948319e+00
  9.62998101e+00  3.42516472e+01  3.42516472e+01  3.42516472e+01
  5.00708888e+01  1.30841380e+02  1.30841380e+02  1.30841380e+02
  1.99765275e+02  4.85194821e+02  4.85194821e+02  4.85194821e+02
  7.37864320e+02  1.33580040e+03  1.33580040e+03  1.33580040e+03
  2.82890282e+03  3.02836686e+03  3.02836686e+03  3.02836686e+03
  6.64760443e+03  6.64760443e+03  6.64760443e+03  9.22969186e+03
  2.55770071e+04  7.63082096e+04]
E1 = -728.2968336154825  E_coul = 201.54335504182546
cycle= 5 E= -526.753478573657  delta_E= -2.05e-09  |g|= 2.09e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.91806e-05
diis-c [-9.53836230e-11  1.28542001e-05 -1.75480530e-03 -1.26762490e-02
  3.49692145e-02  9.79448986e-01]
  HOMO = -0.583047228753332  LUMO = 0.919348859374261
  mo_energy =
[-1.18584864e+02 -1.23126206e+01 -9.56268937e+00 -9.56268937e+00
 -9.56268937e+00 -1.27032979e+00 -5.83047229e-01 -5.83047229e-01
 -5.83047229e-01  9.19348859e-01  1.02376825e+00  1.02376825e+00
  1.02376825e+00  7.44946562e+00  7.44946562e+00  7.44946562e+00
  9.62996395e+00  3.42516223e+01  3.42516223e+01  3.42516223e+01
  5.00708637e+01  1.30841351e+02  1.30841351e+02  1.30841351e+02
  1.99765246e+02  4.85194790e+02  4.85194790e+02  4.85194790e+02
  7.37864288e+02  1.33580037e+03  1.33580037e+03  1.33580037e+03
  2.82890278e+03  3.02836682e+03  3.02836682e+03  3.02836682e+03
  6.64760439e+03  6.64760439e+03  6.64760439e+03  9.22969183e+03
  2.55770070e+04  7.63082096e+04]
E1 = -728.2969174650808  E_coul = 201.5434388913629
cycle= 6 E= -526.753478573718  delta_E= -6.08e-11  |g|= 1.84e-06  |ddm|= 1.96e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2969174650808  E_coul = 201.5434388913629
  HOMO = -0.583047120002565  LUMO = 0.91934929169693
  mo_energy =
[-1.18584863e+02 -1.23126200e+01 -9.56268883e+00 -9.56268883e+00
 -9.56268883e+00 -1.27032926e+00 -5.83047120e-01 -5.83047120e-01
 -5.83047120e-01  9.19349292e-01  1.02376839e+00  1.02376839e+00
  1.02376839e+00  7.44946599e+00  7.44946599e+00  7.44946599e+00
  9.62996450e+00  3.42516229e+01  3.42516229e+01  3.42516229e+01
  5.00708644e+01  1.30841352e+02  1.30841352e+02  1.30841352e+02
  1.99765247e+02  4.85194791e+02  4.85194791e+02  4.85194791e+02
  7.37864289e+02  1.33580037e+03  1.33580037e+03  1.33580037e+03
  2.82890278e+03  3.02836682e+03  3.02836682e+03  3.02836682e+03
  6.64760439e+03  6.64760439e+03  6.64760439e+03  9.22969183e+03
  2.55770070e+04  7.63082096e+04]
E1 = -728.2969145875685  E_coul = 201.54343601384807
Extra cycle  E= -526.75347857372  delta_E= -2.61e-12  |g|= 3.88e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
exp = [2.61826957e+04 7.61742854e+03 3.61738593e+03 1.59574683e+03
 3.88777560e+02 1.24803690e+02 4.71776195e+01 1.76762708e+01
 7.10055530e+00 6.49029897e-01 2.84318659e+00 2.31611078e-01
 1.36279641e+03 6.64618186e+02 3.00361811e+02 3.13525015e+02
 6.18004321e+01 7.49869614e+00 2.05793097e+01 7.81611408e-01
 2.86918226e+00 2.23850593e-01]
E = -526.7534785737205
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:17 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6956659        1
[INPUT] 0    0    [1    /1   ]  7617.42854475        1
[INPUT] 0    0    [1    /1   ]  3617.38592846        1
[INPUT] 0    0    [1    /1   ]  1595.74682673        1
[INPUT] 0    0    [1    /1   ]  388.777559513        1
[INPUT] 0    0    [1    /1   ]  124.803690383        1
[INPUT] 0    0    [1    /1   ]  47.1776194695        1
[INPUT] 0    0    [1    /1   ]  17.6762708312        1
[INPUT] 0    0    [1    /1   ]  7.10055530042        1
[INPUT] 0    0    [1    /1   ]  0.649029896747       1
[INPUT] 0    0    [1    /1   ]  2.84318658974        1
[INPUT] 0    0    [1    /1   ]  0.231611078252       1
[INPUT] 1    0    [1    /1   ]  1362.79640682        1
[INPUT] 1    0    [1    /1   ]  664.61818646         1
[INPUT] 1    0    [1    /1   ]  300.361811372        1
[INPUT] 1    0    [1    /1   ]  313.525014671        1
[INPUT] 1    0    [1    /1   ]  61.800432061         1
[INPUT] 1    0    [1    /1   ]  7.49869613646        1
[INPUT] 1    0    [1    /1   ]  20.5793097404        1
[INPUT] 1    0    [1    /1   ]  0.781611407792       1
[INPUT] 1    0    [1    /1   ]  2.86918226294        1
[INPUT] 1    0    [1    /1   ]  0.223850593196       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.695665877738, 1.0]], [0, [7617.428544749705, 1.0]], [0, [3617.385928456652, 1.0]], [0, [1595.7468267275647, 1.0]], [0, [388.7775595133812, 1.0]], [0, [124.80369038267149, 1.0]], [0, [47.177619469480796, 1.0]], [0, [17.676270831188273, 1.0]], [0, [7.100555300416525, 1.0]], [0, [0.6490298967474838, 1.0]], [0, [2.843186589738378, 1.0]], [0, [0.23161107825213528, 1.0]], [1, [1362.7964068212507, 1.0]], [1, [664.6181864602953, 1.0]], [1, [300.3618113718059, 1.0]], [1, [313.52501467091497, 1.0]], [1, [61.80043206099213, 1.0]], [1, [7.498696136457416, 1.0]], [1, [20.579309740414917, 1.0]], [1, [0.781611407792225, 1.0]], [1, [2.8691822629366044, 1.0]], [1, [0.22385059319569225, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69566588]
bas 1, expnt(s) = [7617.42854475]
bas 2, expnt(s) = [3617.38592846]
bas 3, expnt(s) = [1595.74682673]
bas 4, expnt(s) = [388.77755951]
bas 5, expnt(s) = [124.80369038]
bas 6, expnt(s) = [47.17761947]
bas 7, expnt(s) = [17.67627083]
bas 8, expnt(s) = [7.1005553]
bas 9, expnt(s) = [0.6490299]
bas 10, expnt(s) = [2.84318659]
bas 11, expnt(s) = [0.23161108]
bas 12, expnt(s) = [1362.79640682]
bas 13, expnt(s) = [664.61818646]
bas 14, expnt(s) = [300.36181137]
bas 15, expnt(s) = [313.52501467]
bas 16, expnt(s) = [61.80043206]
bas 17, expnt(s) = [7.49869614]
bas 18, expnt(s) = [20.57930974]
bas 19, expnt(s) = [0.78161141]
bas 20, expnt(s) = [2.86918226]
bas 21, expnt(s) = [0.22385059]
CPU time:       447.59
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826957e+04 5.20026880e+03 7.61742854e+03 2.06001943e+03
 3.61738593e+03 1.17844999e+03 1.59574683e+03 6.37878576e+02
 3.88777560e+02 2.21202951e+02 1.24803690e+02 9.43377676e+01
 4.71776195e+01 4.54796424e+01 1.76762708e+01 2.17800067e+01
 7.10055530e+00 1.09896601e+01 6.49029897e-01 1.82689485e+00
 2.84318659e+00 5.53183281e+00 2.31611078e-01 8.43498900e-01
 1.36279641e+03 2.41558941e+04 6.64618186e+02 9.84463613e+03
 3.00361811e+02 3.64787784e+03 3.13525015e+02 3.84879375e+03
 6.18004321e+01 5.05503052e+02 7.49869614e+00 3.62006682e+01
 2.05793097e+01 1.27871246e+02 7.81611408e-01 2.14399123e+00
 2.86918226e+00 1.08938669e+01 2.23850593e-01 4.49192198e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993585358661235
cond(S) = 113491.91644891504
E1 = -729.5452174818357  E_coul = 203.175590039492
init E= -526.369627442344
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555722528840355  LUMO = 0.938926463104807
  mo_energy =
[-1.18334090e+02 -1.22068937e+01 -9.44718284e+00 -9.44718284e+00
 -9.44718284e+00 -1.24024020e+00 -5.55722529e-01 -5.55722529e-01
 -5.55722529e-01  9.38926463e-01  1.04269410e+00  1.04269410e+00
  1.04269410e+00  7.52144483e+00  7.52144483e+00  7.52144483e+00
  9.70221020e+00  3.43734301e+01  3.43734301e+01  3.43734301e+01
  5.01942613e+01  1.31022895e+02  1.31022895e+02  1.31022895e+02
  1.99956528e+02  4.85444969e+02  4.85444969e+02  4.85444969e+02
  7.38154523e+02  1.33610362e+03  1.33610362e+03  1.33610362e+03
  2.82933566e+03  3.02873390e+03  3.02873390e+03  3.02873390e+03
  6.64808350e+03  6.64808350e+03  6.64808350e+03  9.23024422e+03
  2.55776541e+04  7.63089472e+04]
E1 = -727.8491700940225  E_coul = 201.09648018511308
cycle= 1 E= -526.752689908909  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.569671
diis-c [-0.3245246  1.       ]
  HOMO = -0.590675758488442  LUMO = 0.912913746191786
  mo_energy =
[-1.18642865e+02 -1.23450071e+01 -9.59636815e+00 -9.59636815e+00
 -9.59636815e+00 -1.27960222e+00 -5.90675758e-01 -5.90675758e-01
 -5.90675758e-01  9.12913746e-01  1.01804218e+00  1.01804218e+00
  1.01804218e+00  7.42915539e+00  7.42915539e+00  7.42915539e+00
  9.60819487e+00  3.42173524e+01  3.42173524e+01  3.42173524e+01
  5.00344975e+01  1.30793559e+02  1.30793559e+02  1.30793559e+02
  1.99714929e+02  4.85137510e+02  4.85137510e+02  4.85137510e+02
  7.37804959e+02  1.33573962e+03  1.33573962e+03  1.33573962e+03
  2.82883945e+03  3.02830422e+03  3.02830422e+03  3.02830422e+03
  6.64754045e+03  6.64754045e+03  6.64754045e+03  9.22962732e+03
  2.55769421e+04  7.63081445e+04]
E1 = -728.4249897342563  E_coul = 201.6715724598395
cycle= 2 E= -526.753417274417  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0532
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0772849
diis-c [-0.00375805  0.07672125  0.92327875]
  HOMO = -0.581498323845083  LUMO = 0.920513230478919
  mo_energy =
[-1.18574447e+02 -1.23066021e+01 -9.55629080e+00 -9.55629080e+00
 -9.55629080e+00 -1.26861034e+00 -5.81498324e-01 -5.81498324e-01
 -5.81498324e-01  9.20513230e-01  1.02489617e+00  1.02489617e+00
  1.02489617e+00  7.45342785e+00  7.45342785e+00  7.45342785e+00
  9.63407030e+00  3.42580834e+01  3.42580834e+01  3.42580834e+01
  5.00775993e+01  1.30850069e+02  1.30850069e+02  1.30850069e+02
  1.99774354e+02  4.85205082e+02  4.85205082e+02  4.85205082e+02
  7.37874980e+02  1.33581130e+03  1.33581130e+03  1.33581130e+03
  2.82891437e+03  3.02837816e+03  3.02837816e+03  3.02837816e+03
  6.64761616e+03  6.64761616e+03  6.64761616e+03  9.22970381e+03
  2.55770192e+04  7.63082219e+04]
E1 = -728.2732950507403  E_coul = 201.51981857223603
cycle= 3 E= -526.753476478504  delta_E= -5.92e-05  |g|= 0.00659  |ddm|= 0.0162
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.014016
diis-c [-8.21351321e-07 -1.28494692e-03  1.49096565e-01  8.52188382e-01]
  HOMO = -0.583058170996152  LUMO = 0.919318700095572
  mo_energy =
[-1.18584880e+02 -1.23126666e+01 -9.56271921e+00 -9.56271921e+00
 -9.56271921e+00 -1.27036709e+00 -5.83058171e-01 -5.83058171e-01
 -5.83058171e-01  9.19318700e-01  1.02375697e+00  1.02375697e+00
  1.02375697e+00  7.44943891e+00  7.44943891e+00  7.44943891e+00
  9.62992088e+00  3.42515936e+01  3.42515936e+01  3.42515936e+01
  5.00708273e+01  1.30841326e+02  1.30841326e+02  1.30841326e+02
  1.99765221e+02  4.85194773e+02  4.85194773e+02  4.85194773e+02
  7.37864280e+02  1.33580036e+03  1.33580036e+03  1.33580036e+03
  2.82890280e+03  3.02836683e+03  3.02836683e+03  3.02836683e+03
  6.64760441e+03  6.64760441e+03  6.64760441e+03  9.22969185e+03
  2.55770071e+04  7.63082096e+04]
E1 = -728.2970717546685  E_coul = 201.54359318305723
cycle= 4 E= -526.753478571611  delta_E= -2.09e-06  |g|= 0.000106  |ddm|= 0.00233
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000119397
diis-c [-5.17055120e-09  8.77318302e-05 -1.24617318e-02 -7.54985818e-02
  1.08787258e+00]
  HOMO = -0.583039377292791  LUMO = 0.919352693169402
  mo_energy =
[-1.18584832e+02 -1.23125970e+01 -9.56266387e+00 -9.56266387e+00
 -9.56266387e+00 -1.27032351e+00 -5.83039377e-01 -5.83039377e-01
 -5.83039377e-01  9.19352693e-01  1.02377353e+00  1.02377353e+00
  1.02377353e+00  7.44948319e+00  7.44948319e+00  7.44948319e+00
  9.62998101e+00  3.42516472e+01  3.42516472e+01  3.42516472e+01
  5.00708888e+01  1.30841380e+02  1.30841380e+02  1.30841380e+02
  1.99765275e+02  4.85194821e+02  4.85194821e+02  4.85194821e+02
  7.37864320e+02  1.33580040e+03  1.33580040e+03  1.33580040e+03
  2.82890282e+03  3.02836686e+03  3.02836686e+03  3.02836686e+03
  6.64760443e+03  6.64760443e+03  6.64760443e+03  9.22969186e+03
  2.55770071e+04  7.63082096e+04]
E1 = -728.2968336154825  E_coul = 201.54335504182546
cycle= 5 E= -526.753478573657  delta_E= -2.05e-09  |g|= 2.09e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.91806e-05
diis-c [-9.53836230e-11  1.28542001e-05 -1.75480530e-03 -1.26762490e-02
  3.49692145e-02  9.79448986e-01]
  HOMO = -0.583047228753332  LUMO = 0.919348859374261
  mo_energy =
[-1.18584864e+02 -1.23126206e+01 -9.56268937e+00 -9.56268937e+00
 -9.56268937e+00 -1.27032979e+00 -5.83047229e-01 -5.83047229e-01
 -5.83047229e-01  9.19348859e-01  1.02376825e+00  1.02376825e+00
  1.02376825e+00  7.44946562e+00  7.44946562e+00  7.44946562e+00
  9.62996395e+00  3.42516223e+01  3.42516223e+01  3.42516223e+01
  5.00708637e+01  1.30841351e+02  1.30841351e+02  1.30841351e+02
  1.99765246e+02  4.85194790e+02  4.85194790e+02  4.85194790e+02
  7.37864288e+02  1.33580037e+03  1.33580037e+03  1.33580037e+03
  2.82890278e+03  3.02836682e+03  3.02836682e+03  3.02836682e+03
  6.64760439e+03  6.64760439e+03  6.64760439e+03  9.22969183e+03
  2.55770070e+04  7.63082096e+04]
E1 = -728.2969174650808  E_coul = 201.5434388913629
cycle= 6 E= -526.753478573718  delta_E= -6.08e-11  |g|= 1.84e-06  |ddm|= 1.96e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2969174650808  E_coul = 201.5434388913629
  HOMO = -0.583047120002565  LUMO = 0.91934929169693
  mo_energy =
[-1.18584863e+02 -1.23126200e+01 -9.56268883e+00 -9.56268883e+00
 -9.56268883e+00 -1.27032926e+00 -5.83047120e-01 -5.83047120e-01
 -5.83047120e-01  9.19349292e-01  1.02376839e+00  1.02376839e+00
  1.02376839e+00  7.44946599e+00  7.44946599e+00  7.44946599e+00
  9.62996450e+00  3.42516229e+01  3.42516229e+01  3.42516229e+01
  5.00708644e+01  1.30841352e+02  1.30841352e+02  1.30841352e+02
  1.99765247e+02  4.85194791e+02  4.85194791e+02  4.85194791e+02
  7.37864289e+02  1.33580037e+03  1.33580037e+03  1.33580037e+03
  2.82890278e+03  3.02836682e+03  3.02836682e+03  3.02836682e+03
  6.64760439e+03  6.64760439e+03  6.64760439e+03  9.22969183e+03
  2.55770070e+04  7.63082096e+04]
E1 = -728.2969145875685  E_coul = 201.54343601384807
Extra cycle  E= -526.75347857372  delta_E= -2.61e-12  |g|= 3.88e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113491.91644891504
E1 = -728.2969145875685  E_coul = 201.54343601384807
init E= -526.75347857372
    CPU time for initialize scf      0.80 sec, wall time      0.32 sec
  HOMO = -0.583047190922097  LUMO = 0.919349306442039
  mo_energy =
[-1.18584863e+02 -1.23126202e+01 -9.56268906e+00 -9.56268906e+00
 -9.56268906e+00 -1.27032926e+00 -5.83047191e-01 -5.83047191e-01
 -5.83047191e-01  9.19349306e-01  1.02376835e+00  1.02376835e+00
  1.02376835e+00  7.44946584e+00  7.44946584e+00  7.44946584e+00
  9.62996437e+00  3.42516227e+01  3.42516227e+01  3.42516227e+01
  5.00708641e+01  1.30841352e+02  1.30841352e+02  1.30841352e+02
  1.99765246e+02  4.85194791e+02  4.85194791e+02  4.85194791e+02
  7.37864288e+02  1.33580037e+03  1.33580037e+03  1.33580037e+03
  2.82890278e+03  3.02836682e+03  3.02836682e+03  3.02836682e+03
  6.64760439e+03  6.64760439e+03  6.64760439e+03  9.22969183e+03
  2.55770070e+04  7.63082096e+04]
E1 = -728.2969152472433  E_coul = 201.54343667352362
cycle= 1 E= -526.75347857372  delta_E= 7.96e-13  |g|= 8.93e-08  |ddm|= 6.05e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2969152472433  E_coul = 201.54343667352362
  HOMO = -0.583047181515639  LUMO = 0.919349328646646
  mo_energy =
[-1.18584863e+02 -1.23126201e+01 -9.56268901e+00 -9.56268901e+00
 -9.56268901e+00 -1.27032923e+00 -5.83047182e-01 -5.83047182e-01
 -5.83047182e-01  9.19349329e-01  1.02376836e+00  1.02376836e+00
  1.02376836e+00  7.44946587e+00  7.44946587e+00  7.44946587e+00
  9.62996441e+00  3.42516227e+01  3.42516227e+01  3.42516227e+01
  5.00708642e+01  1.30841352e+02  1.30841352e+02  1.30841352e+02
  1.99765246e+02  4.85194791e+02  4.85194791e+02  4.85194791e+02
  7.37864289e+02  1.33580037e+03  1.33580037e+03  1.33580037e+03
  2.82890278e+03  3.02836682e+03  3.02836682e+03  3.02836682e+03
  6.64760439e+03  6.64760439e+03  6.64760439e+03  9.22969183e+03
  2.55770070e+04  7.63082096e+04]
E1 = -728.2969150311368  E_coul = 201.543436457417
Extra cycle  E= -526.75347857372  delta_E= -1.14e-13  |g|= 1.94e-08  |ddm|= 1.39e-07
    CPU time for scf_cycle      0.90 sec, wall time      0.42 sec
exp = [2.61826957e+04 7.61742854e+03 3.61738593e+03 1.59574683e+03
 3.88777560e+02 1.24803690e+02 4.71776195e+01 1.76762708e+01
 7.10055530e+00 6.49029897e-01 2.84318659e+00 2.31611078e-01
 1.36279641e+03 6.64618186e+02 3.00361811e+02 3.13525015e+02
 6.18004321e+01 7.49869614e+00 2.05793097e+01 7.81611408e-01
 2.86918226e+00 2.23850593e-01]
grad_E = [-1.56981662e-06  3.91736957e-06 -1.20936290e-06  9.29876406e-05
 -5.67108967e-04  2.20334947e-04  2.24038038e-04 -3.25510786e-04
 -9.75578751e-06 -3.16087512e-04  2.88061923e-06  7.12575784e-04
 -4.86744769e-07  5.31843308e-06  2.55708880e-05  2.20071134e-05
 -2.23326881e-04  2.99452441e-04  6.12150523e-04 -5.10277695e-04
 -4.72183801e-04  1.32564543e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:21 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6962815        1
[INPUT] 0    0    [1    /1   ]  7617.42712003        1
[INPUT] 0    0    [1    /1   ]  3617.38648945        1
[INPUT] 0    0    [1    /1   ]  1595.71544688        1
[INPUT] 0    0    [1    /1   ]  388.852138727        1
[INPUT] 0    0    [1    /1   ]  125.0893486          1
[INPUT] 0    0    [1    /1   ]  47.4376126452        1
[INPUT] 0    0    [1    /1   ]  17.9543450164        1
[INPUT] 0    0    [1    /1   ]  7.05101416122        1
[INPUT] 0    0    [1    /1   ]  0.649677822301       1
[INPUT] 0    0    [1    /1   ]  2.83099907912        1
[INPUT] 0    0    [1    /1   ]  0.231489120563       1
[INPUT] 1    0    [1    /1   ]  1362.79661117        1
[INPUT] 1    0    [1    /1   ]  664.616202807        1
[INPUT] 1    0    [1    /1   ]  300.352468473        1
[INPUT] 1    0    [1    /1   ]  313.516962071        1
[INPUT] 1    0    [1    /1   ]  61.8046526103        1
[INPUT] 1    0    [1    /1   ]  7.50370094561        1
[INPUT] 1    0    [1    /1   ]  20.5799317973        1
[INPUT] 1    0    [1    /1   ]  0.782158243901       1
[INPUT] 1    0    [1    /1   ]  2.87367099633        1
[INPUT] 1    0    [1    /1   ]  0.223983102642       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69628149869, 1.0]], [0, [7617.427120025334, 1.0]], [0, [3617.3864894461226, 1.0]], [0, [1595.7154468809933, 1.0]], [0, [388.8521387270348, 1.0]], [0, [125.08934860015434, 1.0]], [0, [47.4376126451936, 1.0]], [0, [17.954345016399333, 1.0]], [0, [7.051014161224615, 1.0]], [0, [0.6496778223012155, 1.0]], [0, [2.830999079116981, 1.0]], [0, [0.23148912056297236, 1.0]], [1, [1362.7966111684088, 1.0]], [1, [664.6162028066618, 1.0]], [1, [300.3524684731015, 1.0]], [1, [313.51696207113457, 1.0]], [1, [61.8046526103412, 1.0]], [1, [7.503700945614422, 1.0]], [1, [20.579931797275318, 1.0]], [1, [0.7821582439010129, 1.0]], [1, [2.8736709963343112, 1.0]], [1, [0.22398310264212026, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6962815]
bas 1, expnt(s) = [7617.42712003]
bas 2, expnt(s) = [3617.38648945]
bas 3, expnt(s) = [1595.71544688]
bas 4, expnt(s) = [388.85213873]
bas 5, expnt(s) = [125.0893486]
bas 6, expnt(s) = [47.43761265]
bas 7, expnt(s) = [17.95434502]
bas 8, expnt(s) = [7.05101416]
bas 9, expnt(s) = [0.64967782]
bas 10, expnt(s) = [2.83099908]
bas 11, expnt(s) = [0.23148912]
bas 12, expnt(s) = [1362.79661117]
bas 13, expnt(s) = [664.61620281]
bas 14, expnt(s) = [300.35246847]
bas 15, expnt(s) = [313.51696207]
bas 16, expnt(s) = [61.80465261]
bas 17, expnt(s) = [7.50370095]
bas 18, expnt(s) = [20.5799318]
bas 19, expnt(s) = [0.78215824]
bas 20, expnt(s) = [2.873671]
bas 21, expnt(s) = [0.2239831]
CPU time:       453.02
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826963e+04 5.20026889e+03 7.61742712e+03 2.06001914e+03
 3.61738649e+03 1.17845013e+03 1.59571545e+03 6.37869169e+02
 3.88852139e+02 2.21234775e+02 1.25089349e+02 9.44996658e+01
 4.74376126e+01 4.56674900e+01 1.79543450e+01 2.20364788e+01
 7.05101416e+00 1.09321030e+01 6.49677822e-01 1.82826252e+00
 2.83099908e+00 5.51403883e+00 2.31489121e-01 8.43165762e-01
 1.36279661e+03 2.41558986e+04 6.64616203e+02 9.84459940e+03
 3.00352468e+02 3.64773600e+03 3.13516962e+02 3.84867018e+03
 6.18046526e+01 5.05546205e+02 7.50370095e+00 3.62308722e+01
 2.05799318e+01 1.27876078e+02 7.82158244e-01 2.14586638e+00
 2.87367100e+00 1.09151749e+01 2.23983103e-01 4.49524600e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993564697733444
cond(S) = 113456.9555056858
E1 = -729.5452116927081  E_coul = 203.17565518013683
init E= -526.369556512571
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.55571640178168  LUMO = 0.938812103595649
  mo_energy =
[-1.18334098e+02 -1.22068782e+01 -9.44718296e+00 -9.44718296e+00
 -9.44718296e+00 -1.24023621e+00 -5.55716402e-01 -5.55716402e-01
 -5.55716402e-01  9.38812104e-01  1.04370941e+00  1.04370941e+00
  1.04370941e+00  7.53321976e+00  7.53321976e+00  7.53321976e+00
  9.66393903e+00  3.44039509e+01  3.44039509e+01  3.44039509e+01
  5.04343161e+01  1.31062648e+02  1.31062648e+02  1.31062648e+02
  2.01301212e+02  4.85481037e+02  4.85481037e+02  4.85481037e+02
  7.40664068e+02  1.33611990e+03  1.33611990e+03  1.33611990e+03
  2.83229368e+03  3.02872370e+03  3.02872370e+03  3.02872370e+03
  6.64805407e+03  6.64805407e+03  6.64805407e+03  9.23312970e+03
  2.55804022e+04  7.63115075e+04]
E1 = -727.8499684865557  E_coul = 201.09726890484094
cycle= 1 E= -526.752699581715  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.570109
diis-c [-0.32502413  1.        ]
  HOMO = -0.59066087134774  LUMO = 0.912828040016044
  mo_energy =
[-1.18642808e+02 -1.23449269e+01 -9.59630592e+00 -9.59630592e+00
 -9.59630592e+00 -1.27958056e+00 -5.90660871e-01 -5.90660871e-01
 -5.90660871e-01  9.12828040e-01  1.01904109e+00  1.01904109e+00
  1.01904109e+00  7.44090036e+00  7.44090036e+00  7.44090036e+00
  9.57008650e+00  3.42479078e+01  3.42479078e+01  3.42479078e+01
  5.02741165e+01  1.30833392e+02  1.30833392e+02  1.30833392e+02
  2.01059248e+02  4.85173640e+02  4.85173640e+02  4.85173640e+02
  7.40314468e+02  1.33575596e+03  1.33575596e+03  1.33575596e+03
  2.83179755e+03  3.02829408e+03  3.02829408e+03  3.02829408e+03
  6.64751107e+03  6.64751107e+03  6.64751107e+03  9.23251287e+03
  2.55796902e+04  7.63107049e+04]
E1 = -728.4255513302393  E_coul = 201.6721246689883
cycle= 2 E= -526.753426661251  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0531
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0773047
diis-c [-0.00376443  0.07661381  0.92338619]
  HOMO = -0.581489152487726  LUMO = 0.920420027202864
  mo_energy =
[-1.18574402e+02 -1.23065334e+01 -9.55623968e+00 -9.55623968e+00
 -9.55623968e+00 -1.26859441e+00 -5.81489152e-01 -5.81489152e-01
 -5.81489152e-01  9.20420027e-01  1.02589840e+00  1.02589840e+00
  1.02589840e+00  7.46518190e+00  7.46518190e+00  7.46518190e+00
  9.59591943e+00  3.42886314e+01  3.42886314e+01  3.42886314e+01
  5.03173356e+01  1.30889891e+02  1.30889891e+02  1.30889891e+02
  2.01118735e+02  4.85241200e+02  4.85241200e+02  4.85241200e+02
  7.40384485e+02  1.33582762e+03  1.33582762e+03  1.33582762e+03
  2.83187246e+03  3.02836801e+03  3.02836801e+03  3.02836801e+03
  6.64758677e+03  6.64758677e+03  6.64758677e+03  9.23258935e+03
  2.55797673e+04  7.63107823e+04]
E1 = -728.2738992983219  E_coul = 201.52041347129202
cycle= 3 E= -526.75348582703  delta_E= -5.92e-05  |g|= 0.00659  |ddm|= 0.0162
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0140273
diis-c [-8.25915856e-07 -1.28586853e-03  1.49167607e-01  8.52118261e-01]
  HOMO = -0.583049505997933  LUMO = 0.919225988336954
  mo_energy =
[-1.18584839e+02 -1.23126002e+01 -9.56267061e+00 -9.56267061e+00
 -9.56267061e+00 -1.27035136e+00 -5.83049506e-01 -5.83049506e-01
 -5.83049506e-01  9.19225988e-01  1.02475768e+00  1.02475768e+00
  1.02475768e+00  7.46118854e+00  7.46118854e+00  7.46118854e+00
  9.59177381e+00  3.42821385e+01  3.42821385e+01  3.42821385e+01
  5.03105427e+01  1.30881144e+02  1.30881144e+02  1.30881144e+02
  2.01109587e+02  4.85230887e+02  4.85230887e+02  4.85230887e+02
  7.40373779e+02  1.33581669e+03  1.33581669e+03  1.33581669e+03
  2.83186088e+03  3.02835667e+03  3.02835667e+03  3.02835667e+03
  6.64757502e+03  6.64757502e+03  6.64757502e+03  9.23257739e+03
  2.55797551e+04  7.63107700e+04]
E1 = -728.2976838844697  E_coul = 201.5441959625413
cycle= 4 E= -526.753487921928  delta_E= -2.09e-06  |g|= 0.000107  |ddm|= 0.00233
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000119521
diis-c [-5.18770390e-09  8.78636533e-05 -1.24812121e-02 -7.55492495e-02
  1.08794260e+00]
  HOMO = -0.583030668623123  LUMO = 0.919260107438317
  mo_energy =
[-1.18584790e+02 -1.23125304e+01 -9.56261503e+00 -9.56261503e+00
 -9.56261503e+00 -1.27030761e+00 -5.83030669e-01 -5.83030669e-01
 -5.83030669e-01  9.19260107e-01  1.02477430e+00  1.02477430e+00
  1.02477430e+00  7.46123299e+00  7.46123299e+00  7.46123299e+00
  9.59183410e+00  3.42821924e+01  3.42821924e+01  3.42821924e+01
  5.03106045e+01  1.30881199e+02  1.30881199e+02  1.30881199e+02
  2.01109642e+02  4.85230936e+02  4.85230936e+02  4.85230936e+02
  7.40373820e+02  1.33581673e+03  1.33581673e+03  1.33581673e+03
  2.83186090e+03  3.02835670e+03  3.02835670e+03  3.02835670e+03
  6.64757504e+03  6.64757504e+03  6.64757504e+03  9.23257739e+03
  2.55797551e+04  7.63107700e+04]
E1 = -728.2974445668789  E_coul = 201.54395664288512
cycle= 5 E= -526.753487923994  delta_E= -2.07e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93148e-05
diis-c [-9.59951317e-11  1.28642400e-05 -1.75749484e-03 -1.26909700e-02
  3.47272862e-02  9.79708314e-01]
  HOMO = -0.583038542591916  LUMO = 0.919256271479478
  mo_energy =
[-1.18584822e+02 -1.23125541e+01 -9.56264061e+00 -9.56264061e+00
 -9.56264061e+00 -1.27031390e+00 -5.83038543e-01 -5.83038543e-01
 -5.83038543e-01  9.19256271e-01  1.02476900e+00  1.02476900e+00
  1.02476900e+00  7.46121536e+00  7.46121536e+00  7.46121536e+00
  9.59181702e+00  3.42821675e+01  3.42821675e+01  3.42821675e+01
  5.03105793e+01  1.30881170e+02  1.30881170e+02  1.30881170e+02
  2.01109612e+02  4.85230905e+02  4.85230905e+02  4.85230905e+02
  7.40373788e+02  1.33581669e+03  1.33581669e+03  1.33581669e+03
  2.83186086e+03  3.02835666e+03  3.02835666e+03  3.02835666e+03
  6.64757500e+03  6.64757500e+03  6.64757500e+03  9.23257736e+03
  2.55797551e+04  7.63107699e+04]
E1 = -728.2975286288403  E_coul = 201.5440407047845
cycle= 6 E= -526.753487924056  delta_E= -6.2e-11  |g|= 1.85e-06  |ddm|= 1.97e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2975286288403  E_coul = 201.5440407047845
  HOMO = -0.58303843275407  LUMO = 0.919256705211886
  mo_energy =
[-1.18584821e+02 -1.23125534e+01 -9.56264006e+00 -9.56264006e+00
 -9.56264006e+00 -1.27031336e+00 -5.83038433e-01 -5.83038433e-01
 -5.83038433e-01  9.19256705e-01  1.02476914e+00  1.02476914e+00
  1.02476914e+00  7.46121573e+00  7.46121573e+00  7.46121573e+00
  9.59181756e+00  3.42821681e+01  3.42821681e+01  3.42821681e+01
  5.03105800e+01  1.30881171e+02  1.30881171e+02  1.30881171e+02
  2.01109613e+02  4.85230905e+02  4.85230905e+02  4.85230905e+02
  7.40373788e+02  1.33581670e+03  1.33581670e+03  1.33581670e+03
  2.83186087e+03  3.02835666e+03  3.02835666e+03  3.02835666e+03
  6.64757500e+03  6.64757500e+03  6.64757500e+03  9.23257736e+03
  2.55797551e+04  7.63107699e+04]
E1 = -728.2975257323493  E_coul = 201.5440378082931
Extra cycle  E= -526.753487924056  delta_E= -4.55e-13  |g|= 3.89e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
exp = [2.61826963e+04 7.61742712e+03 3.61738649e+03 1.59571545e+03
 3.88852139e+02 1.25089349e+02 4.74376126e+01 1.79543450e+01
 7.05101416e+00 6.49677822e-01 2.83099908e+00 2.31489121e-01
 1.36279661e+03 6.64616203e+02 3.00352468e+02 3.13516962e+02
 6.18046526e+01 7.50370095e+00 2.05799318e+01 7.82158244e-01
 2.87367100e+00 2.23983103e-01]
E = -526.7534879240562
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:22 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6962815        1
[INPUT] 0    0    [1    /1   ]  7617.42712003        1
[INPUT] 0    0    [1    /1   ]  3617.38648945        1
[INPUT] 0    0    [1    /1   ]  1595.71544688        1
[INPUT] 0    0    [1    /1   ]  388.852138727        1
[INPUT] 0    0    [1    /1   ]  125.0893486          1
[INPUT] 0    0    [1    /1   ]  47.4376126452        1
[INPUT] 0    0    [1    /1   ]  17.9543450164        1
[INPUT] 0    0    [1    /1   ]  7.05101416122        1
[INPUT] 0    0    [1    /1   ]  0.649677822301       1
[INPUT] 0    0    [1    /1   ]  2.83099907912        1
[INPUT] 0    0    [1    /1   ]  0.231489120563       1
[INPUT] 1    0    [1    /1   ]  1362.79661117        1
[INPUT] 1    0    [1    /1   ]  664.616202807        1
[INPUT] 1    0    [1    /1   ]  300.352468473        1
[INPUT] 1    0    [1    /1   ]  313.516962071        1
[INPUT] 1    0    [1    /1   ]  61.8046526103        1
[INPUT] 1    0    [1    /1   ]  7.50370094561        1
[INPUT] 1    0    [1    /1   ]  20.5799317973        1
[INPUT] 1    0    [1    /1   ]  0.782158243901       1
[INPUT] 1    0    [1    /1   ]  2.87367099633        1
[INPUT] 1    0    [1    /1   ]  0.223983102642       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69628149869, 1.0]], [0, [7617.427120025334, 1.0]], [0, [3617.3864894461226, 1.0]], [0, [1595.7154468809933, 1.0]], [0, [388.8521387270348, 1.0]], [0, [125.08934860015434, 1.0]], [0, [47.4376126451936, 1.0]], [0, [17.954345016399333, 1.0]], [0, [7.051014161224615, 1.0]], [0, [0.6496778223012155, 1.0]], [0, [2.830999079116981, 1.0]], [0, [0.23148912056297236, 1.0]], [1, [1362.7966111684088, 1.0]], [1, [664.6162028066618, 1.0]], [1, [300.3524684731015, 1.0]], [1, [313.51696207113457, 1.0]], [1, [61.8046526103412, 1.0]], [1, [7.503700945614422, 1.0]], [1, [20.579931797275318, 1.0]], [1, [0.7821582439010129, 1.0]], [1, [2.8736709963343112, 1.0]], [1, [0.22398310264212026, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.6962815]
bas 1, expnt(s) = [7617.42712003]
bas 2, expnt(s) = [3617.38648945]
bas 3, expnt(s) = [1595.71544688]
bas 4, expnt(s) = [388.85213873]
bas 5, expnt(s) = [125.0893486]
bas 6, expnt(s) = [47.43761265]
bas 7, expnt(s) = [17.95434502]
bas 8, expnt(s) = [7.05101416]
bas 9, expnt(s) = [0.64967782]
bas 10, expnt(s) = [2.83099908]
bas 11, expnt(s) = [0.23148912]
bas 12, expnt(s) = [1362.79661117]
bas 13, expnt(s) = [664.61620281]
bas 14, expnt(s) = [300.35246847]
bas 15, expnt(s) = [313.51696207]
bas 16, expnt(s) = [61.80465261]
bas 17, expnt(s) = [7.50370095]
bas 18, expnt(s) = [20.5799318]
bas 19, expnt(s) = [0.78215824]
bas 20, expnt(s) = [2.873671]
bas 21, expnt(s) = [0.2239831]
CPU time:       453.49
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826963e+04 5.20026889e+03 7.61742712e+03 2.06001914e+03
 3.61738649e+03 1.17845013e+03 1.59571545e+03 6.37869169e+02
 3.88852139e+02 2.21234775e+02 1.25089349e+02 9.44996658e+01
 4.74376126e+01 4.56674900e+01 1.79543450e+01 2.20364788e+01
 7.05101416e+00 1.09321030e+01 6.49677822e-01 1.82826252e+00
 2.83099908e+00 5.51403883e+00 2.31489121e-01 8.43165762e-01
 1.36279661e+03 2.41558986e+04 6.64616203e+02 9.84459940e+03
 3.00352468e+02 3.64773600e+03 3.13516962e+02 3.84867018e+03
 6.18046526e+01 5.05546205e+02 7.50370095e+00 3.62308722e+01
 2.05799318e+01 1.27876078e+02 7.82158244e-01 2.14586638e+00
 2.87367100e+00 1.09151749e+01 2.23983103e-01 4.49524600e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993564697733444
cond(S) = 113456.9555056858
E1 = -729.5452116927081  E_coul = 203.17565518013683
init E= -526.369556512571
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.55571640178168  LUMO = 0.938812103595649
  mo_energy =
[-1.18334098e+02 -1.22068782e+01 -9.44718296e+00 -9.44718296e+00
 -9.44718296e+00 -1.24023621e+00 -5.55716402e-01 -5.55716402e-01
 -5.55716402e-01  9.38812104e-01  1.04370941e+00  1.04370941e+00
  1.04370941e+00  7.53321976e+00  7.53321976e+00  7.53321976e+00
  9.66393903e+00  3.44039509e+01  3.44039509e+01  3.44039509e+01
  5.04343161e+01  1.31062648e+02  1.31062648e+02  1.31062648e+02
  2.01301212e+02  4.85481037e+02  4.85481037e+02  4.85481037e+02
  7.40664068e+02  1.33611990e+03  1.33611990e+03  1.33611990e+03
  2.83229368e+03  3.02872370e+03  3.02872370e+03  3.02872370e+03
  6.64805407e+03  6.64805407e+03  6.64805407e+03  9.23312970e+03
  2.55804022e+04  7.63115075e+04]
E1 = -727.8499684865557  E_coul = 201.09726890484094
cycle= 1 E= -526.752699581715  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.570109
diis-c [-0.32502413  1.        ]
  HOMO = -0.59066087134774  LUMO = 0.912828040016044
  mo_energy =
[-1.18642808e+02 -1.23449269e+01 -9.59630592e+00 -9.59630592e+00
 -9.59630592e+00 -1.27958056e+00 -5.90660871e-01 -5.90660871e-01
 -5.90660871e-01  9.12828040e-01  1.01904109e+00  1.01904109e+00
  1.01904109e+00  7.44090036e+00  7.44090036e+00  7.44090036e+00
  9.57008650e+00  3.42479078e+01  3.42479078e+01  3.42479078e+01
  5.02741165e+01  1.30833392e+02  1.30833392e+02  1.30833392e+02
  2.01059248e+02  4.85173640e+02  4.85173640e+02  4.85173640e+02
  7.40314468e+02  1.33575596e+03  1.33575596e+03  1.33575596e+03
  2.83179755e+03  3.02829408e+03  3.02829408e+03  3.02829408e+03
  6.64751107e+03  6.64751107e+03  6.64751107e+03  9.23251287e+03
  2.55796902e+04  7.63107049e+04]
E1 = -728.4255513302393  E_coul = 201.6721246689883
cycle= 2 E= -526.753426661251  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0531
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0773047
diis-c [-0.00376443  0.07661381  0.92338619]
  HOMO = -0.581489152487726  LUMO = 0.920420027202864
  mo_energy =
[-1.18574402e+02 -1.23065334e+01 -9.55623968e+00 -9.55623968e+00
 -9.55623968e+00 -1.26859441e+00 -5.81489152e-01 -5.81489152e-01
 -5.81489152e-01  9.20420027e-01  1.02589840e+00  1.02589840e+00
  1.02589840e+00  7.46518190e+00  7.46518190e+00  7.46518190e+00
  9.59591943e+00  3.42886314e+01  3.42886314e+01  3.42886314e+01
  5.03173356e+01  1.30889891e+02  1.30889891e+02  1.30889891e+02
  2.01118735e+02  4.85241200e+02  4.85241200e+02  4.85241200e+02
  7.40384485e+02  1.33582762e+03  1.33582762e+03  1.33582762e+03
  2.83187246e+03  3.02836801e+03  3.02836801e+03  3.02836801e+03
  6.64758677e+03  6.64758677e+03  6.64758677e+03  9.23258935e+03
  2.55797673e+04  7.63107823e+04]
E1 = -728.2738992983219  E_coul = 201.52041347129202
cycle= 3 E= -526.75348582703  delta_E= -5.92e-05  |g|= 0.00659  |ddm|= 0.0162
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0140273
diis-c [-8.25915856e-07 -1.28586853e-03  1.49167607e-01  8.52118261e-01]
  HOMO = -0.583049505997933  LUMO = 0.919225988336954
  mo_energy =
[-1.18584839e+02 -1.23126002e+01 -9.56267061e+00 -9.56267061e+00
 -9.56267061e+00 -1.27035136e+00 -5.83049506e-01 -5.83049506e-01
 -5.83049506e-01  9.19225988e-01  1.02475768e+00  1.02475768e+00
  1.02475768e+00  7.46118854e+00  7.46118854e+00  7.46118854e+00
  9.59177381e+00  3.42821385e+01  3.42821385e+01  3.42821385e+01
  5.03105427e+01  1.30881144e+02  1.30881144e+02  1.30881144e+02
  2.01109587e+02  4.85230887e+02  4.85230887e+02  4.85230887e+02
  7.40373779e+02  1.33581669e+03  1.33581669e+03  1.33581669e+03
  2.83186088e+03  3.02835667e+03  3.02835667e+03  3.02835667e+03
  6.64757502e+03  6.64757502e+03  6.64757502e+03  9.23257739e+03
  2.55797551e+04  7.63107700e+04]
E1 = -728.2976838844697  E_coul = 201.5441959625413
cycle= 4 E= -526.753487921928  delta_E= -2.09e-06  |g|= 0.000107  |ddm|= 0.00233
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119521
diis-c [-5.18770390e-09  8.78636533e-05 -1.24812121e-02 -7.55492495e-02
  1.08794260e+00]
  HOMO = -0.583030668623123  LUMO = 0.919260107438317
  mo_energy =
[-1.18584790e+02 -1.23125304e+01 -9.56261503e+00 -9.56261503e+00
 -9.56261503e+00 -1.27030761e+00 -5.83030669e-01 -5.83030669e-01
 -5.83030669e-01  9.19260107e-01  1.02477430e+00  1.02477430e+00
  1.02477430e+00  7.46123299e+00  7.46123299e+00  7.46123299e+00
  9.59183410e+00  3.42821924e+01  3.42821924e+01  3.42821924e+01
  5.03106045e+01  1.30881199e+02  1.30881199e+02  1.30881199e+02
  2.01109642e+02  4.85230936e+02  4.85230936e+02  4.85230936e+02
  7.40373820e+02  1.33581673e+03  1.33581673e+03  1.33581673e+03
  2.83186090e+03  3.02835670e+03  3.02835670e+03  3.02835670e+03
  6.64757504e+03  6.64757504e+03  6.64757504e+03  9.23257739e+03
  2.55797551e+04  7.63107700e+04]
E1 = -728.2974445668789  E_coul = 201.54395664288512
cycle= 5 E= -526.753487923994  delta_E= -2.07e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93148e-05
diis-c [-9.59951317e-11  1.28642400e-05 -1.75749484e-03 -1.26909700e-02
  3.47272862e-02  9.79708314e-01]
  HOMO = -0.583038542591916  LUMO = 0.919256271479478
  mo_energy =
[-1.18584822e+02 -1.23125541e+01 -9.56264061e+00 -9.56264061e+00
 -9.56264061e+00 -1.27031390e+00 -5.83038543e-01 -5.83038543e-01
 -5.83038543e-01  9.19256271e-01  1.02476900e+00  1.02476900e+00
  1.02476900e+00  7.46121536e+00  7.46121536e+00  7.46121536e+00
  9.59181702e+00  3.42821675e+01  3.42821675e+01  3.42821675e+01
  5.03105793e+01  1.30881170e+02  1.30881170e+02  1.30881170e+02
  2.01109612e+02  4.85230905e+02  4.85230905e+02  4.85230905e+02
  7.40373788e+02  1.33581669e+03  1.33581669e+03  1.33581669e+03
  2.83186086e+03  3.02835666e+03  3.02835666e+03  3.02835666e+03
  6.64757500e+03  6.64757500e+03  6.64757500e+03  9.23257736e+03
  2.55797551e+04  7.63107699e+04]
E1 = -728.2975286288403  E_coul = 201.5440407047845
cycle= 6 E= -526.753487924056  delta_E= -6.2e-11  |g|= 1.85e-06  |ddm|= 1.97e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2975286288403  E_coul = 201.5440407047845
  HOMO = -0.58303843275407  LUMO = 0.919256705211886
  mo_energy =
[-1.18584821e+02 -1.23125534e+01 -9.56264006e+00 -9.56264006e+00
 -9.56264006e+00 -1.27031336e+00 -5.83038433e-01 -5.83038433e-01
 -5.83038433e-01  9.19256705e-01  1.02476914e+00  1.02476914e+00
  1.02476914e+00  7.46121573e+00  7.46121573e+00  7.46121573e+00
  9.59181756e+00  3.42821681e+01  3.42821681e+01  3.42821681e+01
  5.03105800e+01  1.30881171e+02  1.30881171e+02  1.30881171e+02
  2.01109613e+02  4.85230905e+02  4.85230905e+02  4.85230905e+02
  7.40373788e+02  1.33581670e+03  1.33581670e+03  1.33581670e+03
  2.83186087e+03  3.02835666e+03  3.02835666e+03  3.02835666e+03
  6.64757500e+03  6.64757500e+03  6.64757500e+03  9.23257736e+03
  2.55797551e+04  7.63107699e+04]
E1 = -728.2975257323493  E_coul = 201.5440378082931
Extra cycle  E= -526.753487924056  delta_E= -4.55e-13  |g|= 3.89e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113456.9555056858
E1 = -728.2975257323493  E_coul = 201.5440378082931
init E= -526.753487924056
    CPU time for initialize scf      0.80 sec, wall time      0.32 sec
  HOMO = -0.583038504094238  LUMO = 0.919256719763072
  mo_energy =
[-1.18584822e+02 -1.23125536e+01 -9.56264030e+00 -9.56264030e+00
 -9.56264030e+00 -1.27031336e+00 -5.83038504e-01 -5.83038504e-01
 -5.83038504e-01  9.19256720e-01  1.02476910e+00  1.02476910e+00
  1.02476910e+00  7.46121558e+00  7.46121558e+00  7.46121558e+00
  9.59181744e+00  3.42821678e+01  3.42821678e+01  3.42821678e+01
  5.03105798e+01  1.30881170e+02  1.30881170e+02  1.30881170e+02
  2.01109613e+02  4.85230905e+02  4.85230905e+02  4.85230905e+02
  7.40373788e+02  1.33581670e+03  1.33581670e+03  1.33581670e+03
  2.83186087e+03  3.02835666e+03  3.02835666e+03  3.02835666e+03
  6.64757500e+03  6.64757500e+03  6.64757500e+03  9.23257736e+03
  2.55797551e+04  7.63107699e+04]
E1 = -728.2975263966781  E_coul = 201.54403847262037
cycle= 1 E= -526.753487924058  delta_E= -1.48e-12  |g|= 8.96e-08  |ddm|= 6.06e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2975263966781  E_coul = 201.54403847262037
  HOMO = -0.58303849461189  LUMO = 0.919256742047408
  mo_energy =
[-1.18584822e+02 -1.23125536e+01 -9.56264025e+00 -9.56264025e+00
 -9.56264025e+00 -1.27031334e+00 -5.83038495e-01 -5.83038495e-01
 -5.83038495e-01  9.19256742e-01  1.02476911e+00  1.02476911e+00
  1.02476911e+00  7.46121561e+00  7.46121561e+00  7.46121561e+00
  9.59181748e+00  3.42821679e+01  3.42821679e+01  3.42821679e+01
  5.03105798e+01  1.30881171e+02  1.30881171e+02  1.30881171e+02
  2.01109613e+02  4.85230905e+02  4.85230905e+02  4.85230905e+02
  7.40373788e+02  1.33581670e+03  1.33581670e+03  1.33581670e+03
  2.83186087e+03  3.02835666e+03  3.02835666e+03  3.02835666e+03
  6.64757500e+03  6.64757500e+03  6.64757500e+03  9.23257736e+03
  2.55797551e+04  7.63107699e+04]
E1 = -728.2975261791263  E_coul = 201.54403825506984
Extra cycle  E= -526.753487924056  delta_E= 1.25e-12  |g|= 1.94e-08  |ddm|= 1.39e-07
    CPU time for scf_cycle      0.91 sec, wall time      0.43 sec
exp = [2.61826963e+04 7.61742712e+03 3.61738649e+03 1.59571545e+03
 3.88852139e+02 1.25089349e+02 4.74376126e+01 1.79543450e+01
 7.05101416e+00 6.49677822e-01 2.83099908e+00 2.31489121e-01
 1.36279661e+03 6.64616203e+02 3.00352468e+02 3.13516962e+02
 6.18046526e+01 7.50370095e+00 2.05799318e+01 7.82158244e-01
 2.87367100e+00 2.23983103e-01]
grad_E = [-1.57039362e-06  3.92461451e-06 -1.20361985e-06  9.32589653e-05
 -5.71546933e-04  2.28896642e-04  2.32213170e-04 -3.23055003e-04
 -2.52163633e-04  1.26228595e-05  3.91341539e-04 -1.23591723e-04
 -4.87889374e-07  5.30432799e-06  2.54879143e-05  2.19351028e-05
 -2.16327350e-04  2.58561576e-04  5.73999742e-04 -3.49311322e-04
 -1.75612857e-04  1.35340275e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:26 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6967916        1
[INPUT] 0    0    [1    /1   ]  7617.4259286         1
[INPUT] 0    0    [1    /1   ]  3617.38694404        1
[INPUT] 0    0    [1    /1   ]  1595.68900663        1
[INPUT] 0    0    [1    /1   ]  388.92407364         1
[INPUT] 0    0    [1    /1   ]  125.306056262        1
[INPUT] 0    0    [1    /1   ]  47.623793578         1
[INPUT] 0    0    [1    /1   ]  18.1151917596        1
[INPUT] 0    0    [1    /1   ]  7.0686005619         1
[INPUT] 0    0    [1    /1   ]  0.649696465425       1
[INPUT] 0    0    [1    /1   ]  2.83658130128        1
[INPUT] 0    0    [1    /1   ]  0.231452841794       1
[INPUT] 1    0    [1    /1   ]  1362.79678031        1
[INPUT] 1    0    [1    /1   ]  664.614564895        1
[INPUT] 1    0    [1    /1   ]  300.344755505        1
[INPUT] 1    0    [1    /1   ]  313.510314601        1
[INPUT] 1    0    [1    /1   ]  61.8078232767        1
[INPUT] 1    0    [1    /1   ]  7.50814417965        1
[INPUT] 1    0    [1    /1   ]  20.5808176216        1
[INPUT] 1    0    [1    /1   ]  0.782531030983       1
[INPUT] 1    0    [1    /1   ]  2.87743406456        1
[INPUT] 1    0    [1    /1   ]  0.224043360921       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69679164902, 1.0]], [0, [7617.425928595285, 1.0]], [0, [3617.3869440437657, 1.0]], [0, [1595.689006625003, 1.0]], [0, [388.9240736404164, 1.0]], [0, [125.3060562622914, 1.0]], [0, [47.62379357799303, 1.0]], [0, [18.115191759585358, 1.0]], [0, [7.0686005618982914, 1.0]], [0, [0.6496964654251092, 1.0]], [0, [2.836581301276676, 1.0]], [0, [0.23145284179372572, 1.0]], [1, [1362.7967803066238, 1.0]], [1, [664.6145648948789, 1.0]], [1, [300.34475550535984, 1.0]], [1, [313.5103146011999, 1.0]], [1, [61.80782327668451, 1.0]], [1, [7.508144179646246, 1.0]], [1, [20.580817621564613, 1.0]], [1, [0.7825310309832884, 1.0]], [1, [2.8774340645590546, 1.0]], [1, [0.2240433609213824, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69679165]
bas 1, expnt(s) = [7617.4259286]
bas 2, expnt(s) = [3617.38694404]
bas 3, expnt(s) = [1595.68900663]
bas 4, expnt(s) = [388.92407364]
bas 5, expnt(s) = [125.30605626]
bas 6, expnt(s) = [47.62379358]
bas 7, expnt(s) = [18.11519176]
bas 8, expnt(s) = [7.06860056]
bas 9, expnt(s) = [0.64969647]
bas 10, expnt(s) = [2.8365813]
bas 11, expnt(s) = [0.23145284]
bas 12, expnt(s) = [1362.79678031]
bas 13, expnt(s) = [664.61456489]
bas 14, expnt(s) = [300.34475551]
bas 15, expnt(s) = [313.5103146]
bas 16, expnt(s) = [61.80782328]
bas 17, expnt(s) = [7.50814418]
bas 18, expnt(s) = [20.58081762]
bas 19, expnt(s) = [0.78253103]
bas 20, expnt(s) = [2.87743406]
bas 21, expnt(s) = [0.22404336]
CPU time:       458.96
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826968e+04 5.20026897e+03 7.61742593e+03 2.06001890e+03
 3.61738694e+03 1.17845024e+03 1.59568901e+03 6.37861242e+02
 3.88924074e+02 2.21265470e+02 1.25306056e+02 9.46224242e+01
 4.76237936e+01 4.58018494e+01 1.81151918e+01 2.21843764e+01
 7.06860056e+00 1.09525465e+01 6.49696465e-01 1.82830187e+00
 2.83658130e+00 5.52219135e+00 2.31452842e-01 8.43066655e-01
 1.36279678e+03 2.41559024e+04 6.64614565e+02 9.84456908e+03
 3.00344756e+02 3.64761891e+03 3.13510315e+02 3.84856818e+03
 6.18078233e+01 5.05578624e+02 7.50814418e+00 3.62576913e+01
 2.05808176e+01 1.27882958e+02 7.82531031e-01 2.14714490e+00
 2.87743406e+00 1.09330446e+01 2.24043361e-01 4.49675774e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993551942886747
cond(S) = 113470.93553910457
E1 = -729.5452736016563  E_coul = 203.17575641933962
init E= -526.369517182317
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555712937925529  LUMO = 0.939013687402326
  mo_energy =
[-1.18334097e+02 -1.22068620e+01 -9.44717644e+00 -9.44717644e+00
 -9.44717644e+00 -1.24023436e+00 -5.55712938e-01 -5.55712938e-01
 -5.55712938e-01  9.39013687e-01  1.04429013e+00  1.04429013e+00
  1.04429013e+00  7.54263584e+00  7.54263584e+00  7.54263584e+00
  9.69806384e+00  3.44299167e+01  3.44299167e+01  3.44299167e+01
  5.07733855e+01  1.31097151e+02  1.31097151e+02  1.31097151e+02
  2.02414932e+02  4.85512036e+02  4.85512036e+02  4.85512036e+02
  7.42613719e+02  1.33613423e+03  1.33613423e+03  1.33613423e+03
  2.83459531e+03  3.02871603e+03  3.02871603e+03  3.02871603e+03
  6.64803044e+03  6.64803044e+03  6.64803044e+03  9.23538210e+03
  2.55825481e+04  7.63135067e+04]
E1 = -727.8501202065974  E_coul = 201.0974164842286
cycle= 1 E= -526.752703722369  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.570427
diis-c [-0.32538722  1.        ]
  HOMO = -0.590666281267925  LUMO = 0.913009363102568
  mo_energy =
[-1.18642784e+02 -1.23449046e+01 -9.59629028e+00 -9.59629028e+00
 -9.59629028e+00 -1.27958647e+00 -5.90666281e-01 -5.90666281e-01
 -5.90666281e-01  9.13009363e-01  1.01959968e+00  1.01959968e+00
  1.01959968e+00  7.45025152e+00  7.45025152e+00  7.45025152e+00
  9.60400579e+00  3.42738682e+01  3.42738682e+01  3.42738682e+01
  5.06127857e+01  1.30867918e+02  1.30867918e+02  1.30867918e+02
  2.02172710e+02  4.85204667e+02  4.85204667e+02  4.85204667e+02
  7.42264072e+02  1.33577032e+03  1.33577032e+03  1.33577032e+03
  2.83409924e+03  3.02828644e+03  3.02828644e+03  3.02828644e+03
  6.64748746e+03  6.64748746e+03  6.64748746e+03  9.23476532e+03
  2.55818362e+04  7.63127041e+04]
E1 = -728.4256403177172  E_coul = 201.67220958509932
cycle= 2 E= -526.753430732618  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0531
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0773127
diis-c [-0.00376892  0.07652238  0.92347762]
  HOMO = -0.581494720213969  LUMO = 0.920605950196013
  mo_energy =
[-1.18574378e+02 -1.23065113e+01 -9.55622432e+00 -9.55622432e+00
 -9.55622432e+00 -1.26860015e+00 -5.81494720e-01 -5.81494720e-01
 -5.81494720e-01  9.20605950e-01  1.02646169e+00  1.02646169e+00
  1.02646169e+00  7.47454859e+00  7.47454859e+00  7.47454859e+00
  9.62989539e+00  3.43145952e+01  3.43145952e+01  3.43145952e+01
  5.06561068e+01  1.30924416e+02  1.30924416e+02  1.30924416e+02
  2.02232241e+02  4.85272226e+02  4.85272226e+02  4.85272226e+02
  7.42334091e+02  1.33584198e+03  1.33584198e+03  1.33584198e+03
  2.83417414e+03  3.02836037e+03  3.02836037e+03  3.02836037e+03
  6.64756316e+03  6.64756316e+03  6.64756316e+03  9.23484180e+03
  2.55819133e+04  7.63127815e+04]
E1 = -728.2739972564074  E_coul = 201.52050737384886
cycle= 3 E= -526.753489882558  delta_E= -5.91e-05  |g|= 0.0066  |ddm|= 0.0162
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140364
diis-c [-8.26618607e-07 -1.28588096e-03  1.49241410e-01  8.52044471e-01]
  HOMO = -0.583055807930784  LUMO = 0.919410692255804
  mo_energy =
[-1.18584821e+02 -1.23125808e+01 -9.56265812e+00 -9.56265812e+00
 -9.56265812e+00 -1.27035785e+00 -5.83055808e-01 -5.83055808e-01
 -5.83055808e-01  9.19410692e-01  1.02531964e+00  1.02531964e+00
  1.02531964e+00  7.47055093e+00  7.47055093e+00  7.47055093e+00
  9.62573922e+00  3.43080988e+01  3.43080988e+01  3.43080988e+01
  5.06492959e+01  1.30915665e+02  1.30915665e+02  1.30915665e+02
  2.02223082e+02  4.85261908e+02  4.85261908e+02  4.85261908e+02
  7.42323380e+02  1.33583104e+03  1.33583104e+03  1.33583104e+03
  2.83416256e+03  3.02834902e+03  3.02834902e+03  3.02834902e+03
  6.64755141e+03  6.64755141e+03  6.64755141e+03  9.23482983e+03
  2.55819011e+04  7.63127692e+04]
E1 = -728.2977912824111  E_coul = 201.54429930309038
cycle= 4 E= -526.753491979321  delta_E= -2.1e-06  |g|= 0.000107  |ddm|= 0.00233
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119551
diis-c [-5.18301660e-09  8.78829677e-05 -1.24881910e-02 -7.55493681e-02
  1.08794968e+00]
  HOMO = -0.583036991169327  LUMO = 0.919444839844756
  mo_energy =
[-1.18584772e+02 -1.23125110e+01 -9.56260257e+00 -9.56260257e+00
 -9.56260257e+00 -1.27031409e+00 -5.83036991e-01 -5.83036991e-01
 -5.83036991e-01  9.19444840e-01  1.02533626e+00  1.02533626e+00
  1.02533626e+00  7.47059537e+00  7.47059537e+00  7.47059537e+00
  9.62579956e+00  3.43081526e+01  3.43081526e+01  3.43081526e+01
  5.06493577e+01  1.30915720e+02  1.30915720e+02  1.30915720e+02
  2.02223137e+02  4.85261957e+02  4.85261957e+02  4.85261957e+02
  7.42323420e+02  1.33583108e+03  1.33583108e+03  1.33583108e+03
  2.83416257e+03  3.02834905e+03  3.02834905e+03  3.02834905e+03
  6.64755142e+03  6.64755142e+03  6.64755142e+03  9.23482984e+03
  2.55819011e+04  7.63127692e+04]
E1 = -728.2975519251254  E_coul = 201.5440599437314
cycle= 5 E= -526.753491981394  delta_E= -2.07e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93401e-05
diis-c [-9.60840570e-11  1.28598366e-05 -1.75860238e-03 -1.26910536e-02
  3.45913766e-02  9.79845420e-01]
  HOMO = -0.583044868228518  LUMO = 0.919441003359771
  mo_energy =
[-1.18584804e+02 -1.23125347e+01 -9.56262815e+00 -9.56262815e+00
 -9.56262815e+00 -1.27032037e+00 -5.83044868e-01 -5.83044868e-01
 -5.83044868e-01  9.19441003e-01  1.02533095e+00  1.02533095e+00
  1.02533095e+00  7.47057773e+00  7.47057773e+00  7.47057773e+00
  9.62578244e+00  3.43081277e+01  3.43081277e+01  3.43081277e+01
  5.06493325e+01  1.30915691e+02  1.30915691e+02  1.30915691e+02
  2.02223107e+02  4.85261925e+02  4.85261925e+02  4.85261925e+02
  7.42323388e+02  1.33583105e+03  1.33583105e+03  1.33583105e+03
  2.83416254e+03  3.02834902e+03  3.02834902e+03  3.02834902e+03
  6.64755139e+03  6.64755139e+03  6.64755139e+03  9.23482980e+03
  2.55819011e+04  7.63127692e+04]
E1 = -728.2976359967879  E_coul = 201.54414401533163
cycle= 6 E= -526.753491981456  delta_E= -6.23e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2976359967879  E_coul = 201.54414401533163
  HOMO = -0.583044757838772  LUMO = 0.919441437818542
  mo_energy =
[-1.18584803e+02 -1.23125340e+01 -9.56262760e+00 -9.56262760e+00
 -9.56262760e+00 -1.27031984e+00 -5.83044758e-01 -5.83044758e-01
 -5.83044758e-01  9.19441438e-01  1.02533109e+00  1.02533109e+00
  1.02533109e+00  7.47057810e+00  7.47057810e+00  7.47057810e+00
  9.62578299e+00  3.43081283e+01  3.43081283e+01  3.43081283e+01
  5.06493331e+01  1.30915691e+02  1.30915691e+02  1.30915691e+02
  2.02223108e+02  4.85261926e+02  4.85261926e+02  4.85261926e+02
  7.42323389e+02  1.33583105e+03  1.33583105e+03  1.33583105e+03
  2.83416254e+03  3.02834902e+03  3.02834902e+03  3.02834902e+03
  6.64755139e+03  6.64755139e+03  6.64755139e+03  9.23482981e+03
  2.55819011e+04  7.63127692e+04]
E1 = -728.297633091824  E_coul = 201.54414111036914
Extra cycle  E= -526.753491981455  delta_E= 1.48e-12  |g|= 3.9e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
exp = [2.61826968e+04 7.61742593e+03 3.61738694e+03 1.59568901e+03
 3.88924074e+02 1.25306056e+02 4.76237936e+01 1.81151918e+01
 7.06860056e+00 6.49696465e-01 2.83658130e+00 2.31452842e-01
 1.36279678e+03 6.64614565e+02 3.00344756e+02 3.13510315e+02
 6.18078233e+01 7.50814418e+00 2.05808176e+01 7.82531031e-01
 2.87743406e+00 2.24043361e-01]
E = -526.7534919814548
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:26 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6967916        1
[INPUT] 0    0    [1    /1   ]  7617.4259286         1
[INPUT] 0    0    [1    /1   ]  3617.38694404        1
[INPUT] 0    0    [1    /1   ]  1595.68900663        1
[INPUT] 0    0    [1    /1   ]  388.92407364         1
[INPUT] 0    0    [1    /1   ]  125.306056262        1
[INPUT] 0    0    [1    /1   ]  47.623793578         1
[INPUT] 0    0    [1    /1   ]  18.1151917596        1
[INPUT] 0    0    [1    /1   ]  7.0686005619         1
[INPUT] 0    0    [1    /1   ]  0.649696465425       1
[INPUT] 0    0    [1    /1   ]  2.83658130128        1
[INPUT] 0    0    [1    /1   ]  0.231452841794       1
[INPUT] 1    0    [1    /1   ]  1362.79678031        1
[INPUT] 1    0    [1    /1   ]  664.614564895        1
[INPUT] 1    0    [1    /1   ]  300.344755505        1
[INPUT] 1    0    [1    /1   ]  313.510314601        1
[INPUT] 1    0    [1    /1   ]  61.8078232767        1
[INPUT] 1    0    [1    /1   ]  7.50814417965        1
[INPUT] 1    0    [1    /1   ]  20.5808176216        1
[INPUT] 1    0    [1    /1   ]  0.782531030983       1
[INPUT] 1    0    [1    /1   ]  2.87743406456        1
[INPUT] 1    0    [1    /1   ]  0.224043360921       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69679164902, 1.0]], [0, [7617.425928595285, 1.0]], [0, [3617.3869440437657, 1.0]], [0, [1595.689006625003, 1.0]], [0, [388.9240736404164, 1.0]], [0, [125.3060562622914, 1.0]], [0, [47.62379357799303, 1.0]], [0, [18.115191759585358, 1.0]], [0, [7.0686005618982914, 1.0]], [0, [0.6496964654251092, 1.0]], [0, [2.836581301276676, 1.0]], [0, [0.23145284179372572, 1.0]], [1, [1362.7967803066238, 1.0]], [1, [664.6145648948789, 1.0]], [1, [300.34475550535984, 1.0]], [1, [313.5103146011999, 1.0]], [1, [61.80782327668451, 1.0]], [1, [7.508144179646246, 1.0]], [1, [20.580817621564613, 1.0]], [1, [0.7825310309832884, 1.0]], [1, [2.8774340645590546, 1.0]], [1, [0.2240433609213824, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69679165]
bas 1, expnt(s) = [7617.4259286]
bas 2, expnt(s) = [3617.38694404]
bas 3, expnt(s) = [1595.68900663]
bas 4, expnt(s) = [388.92407364]
bas 5, expnt(s) = [125.30605626]
bas 6, expnt(s) = [47.62379358]
bas 7, expnt(s) = [18.11519176]
bas 8, expnt(s) = [7.06860056]
bas 9, expnt(s) = [0.64969647]
bas 10, expnt(s) = [2.8365813]
bas 11, expnt(s) = [0.23145284]
bas 12, expnt(s) = [1362.79678031]
bas 13, expnt(s) = [664.61456489]
bas 14, expnt(s) = [300.34475551]
bas 15, expnt(s) = [313.5103146]
bas 16, expnt(s) = [61.80782328]
bas 17, expnt(s) = [7.50814418]
bas 18, expnt(s) = [20.58081762]
bas 19, expnt(s) = [0.78253103]
bas 20, expnt(s) = [2.87743406]
bas 21, expnt(s) = [0.22404336]
CPU time:       459.45
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826968e+04 5.20026897e+03 7.61742593e+03 2.06001890e+03
 3.61738694e+03 1.17845024e+03 1.59568901e+03 6.37861242e+02
 3.88924074e+02 2.21265470e+02 1.25306056e+02 9.46224242e+01
 4.76237936e+01 4.58018494e+01 1.81151918e+01 2.21843764e+01
 7.06860056e+00 1.09525465e+01 6.49696465e-01 1.82830187e+00
 2.83658130e+00 5.52219135e+00 2.31452842e-01 8.43066655e-01
 1.36279678e+03 2.41559024e+04 6.64614565e+02 9.84456908e+03
 3.00344756e+02 3.64761891e+03 3.13510315e+02 3.84856818e+03
 6.18078233e+01 5.05578624e+02 7.50814418e+00 3.62576913e+01
 2.05808176e+01 1.27882958e+02 7.82531031e-01 2.14714490e+00
 2.87743406e+00 1.09330446e+01 2.24043361e-01 4.49675774e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993551942886747
cond(S) = 113470.93553910457
E1 = -729.5452736016563  E_coul = 203.17575641933962
init E= -526.369517182317
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555712937925529  LUMO = 0.939013687402326
  mo_energy =
[-1.18334097e+02 -1.22068620e+01 -9.44717644e+00 -9.44717644e+00
 -9.44717644e+00 -1.24023436e+00 -5.55712938e-01 -5.55712938e-01
 -5.55712938e-01  9.39013687e-01  1.04429013e+00  1.04429013e+00
  1.04429013e+00  7.54263584e+00  7.54263584e+00  7.54263584e+00
  9.69806384e+00  3.44299167e+01  3.44299167e+01  3.44299167e+01
  5.07733855e+01  1.31097151e+02  1.31097151e+02  1.31097151e+02
  2.02414932e+02  4.85512036e+02  4.85512036e+02  4.85512036e+02
  7.42613719e+02  1.33613423e+03  1.33613423e+03  1.33613423e+03
  2.83459531e+03  3.02871603e+03  3.02871603e+03  3.02871603e+03
  6.64803044e+03  6.64803044e+03  6.64803044e+03  9.23538210e+03
  2.55825481e+04  7.63135067e+04]
E1 = -727.8501202065974  E_coul = 201.0974164842286
cycle= 1 E= -526.752703722369  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.570427
diis-c [-0.32538722  1.        ]
  HOMO = -0.590666281267925  LUMO = 0.913009363102568
  mo_energy =
[-1.18642784e+02 -1.23449046e+01 -9.59629028e+00 -9.59629028e+00
 -9.59629028e+00 -1.27958647e+00 -5.90666281e-01 -5.90666281e-01
 -5.90666281e-01  9.13009363e-01  1.01959968e+00  1.01959968e+00
  1.01959968e+00  7.45025152e+00  7.45025152e+00  7.45025152e+00
  9.60400579e+00  3.42738682e+01  3.42738682e+01  3.42738682e+01
  5.06127857e+01  1.30867918e+02  1.30867918e+02  1.30867918e+02
  2.02172710e+02  4.85204667e+02  4.85204667e+02  4.85204667e+02
  7.42264072e+02  1.33577032e+03  1.33577032e+03  1.33577032e+03
  2.83409924e+03  3.02828644e+03  3.02828644e+03  3.02828644e+03
  6.64748746e+03  6.64748746e+03  6.64748746e+03  9.23476532e+03
  2.55818362e+04  7.63127041e+04]
E1 = -728.4256403177172  E_coul = 201.67220958509932
cycle= 2 E= -526.753430732618  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0531
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0773127
diis-c [-0.00376892  0.07652238  0.92347762]
  HOMO = -0.581494720213969  LUMO = 0.920605950196013
  mo_energy =
[-1.18574378e+02 -1.23065113e+01 -9.55622432e+00 -9.55622432e+00
 -9.55622432e+00 -1.26860015e+00 -5.81494720e-01 -5.81494720e-01
 -5.81494720e-01  9.20605950e-01  1.02646169e+00  1.02646169e+00
  1.02646169e+00  7.47454859e+00  7.47454859e+00  7.47454859e+00
  9.62989539e+00  3.43145952e+01  3.43145952e+01  3.43145952e+01
  5.06561068e+01  1.30924416e+02  1.30924416e+02  1.30924416e+02
  2.02232241e+02  4.85272226e+02  4.85272226e+02  4.85272226e+02
  7.42334091e+02  1.33584198e+03  1.33584198e+03  1.33584198e+03
  2.83417414e+03  3.02836037e+03  3.02836037e+03  3.02836037e+03
  6.64756316e+03  6.64756316e+03  6.64756316e+03  9.23484180e+03
  2.55819133e+04  7.63127815e+04]
E1 = -728.2739972564074  E_coul = 201.52050737384886
cycle= 3 E= -526.753489882558  delta_E= -5.91e-05  |g|= 0.0066  |ddm|= 0.0162
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0140364
diis-c [-8.26618607e-07 -1.28588096e-03  1.49241410e-01  8.52044471e-01]
  HOMO = -0.583055807930784  LUMO = 0.919410692255804
  mo_energy =
[-1.18584821e+02 -1.23125808e+01 -9.56265812e+00 -9.56265812e+00
 -9.56265812e+00 -1.27035785e+00 -5.83055808e-01 -5.83055808e-01
 -5.83055808e-01  9.19410692e-01  1.02531964e+00  1.02531964e+00
  1.02531964e+00  7.47055093e+00  7.47055093e+00  7.47055093e+00
  9.62573922e+00  3.43080988e+01  3.43080988e+01  3.43080988e+01
  5.06492959e+01  1.30915665e+02  1.30915665e+02  1.30915665e+02
  2.02223082e+02  4.85261908e+02  4.85261908e+02  4.85261908e+02
  7.42323380e+02  1.33583104e+03  1.33583104e+03  1.33583104e+03
  2.83416256e+03  3.02834902e+03  3.02834902e+03  3.02834902e+03
  6.64755141e+03  6.64755141e+03  6.64755141e+03  9.23482983e+03
  2.55819011e+04  7.63127692e+04]
E1 = -728.2977912824111  E_coul = 201.54429930309038
cycle= 4 E= -526.753491979321  delta_E= -2.1e-06  |g|= 0.000107  |ddm|= 0.00233
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000119551
diis-c [-5.18301660e-09  8.78829677e-05 -1.24881910e-02 -7.55493681e-02
  1.08794968e+00]
  HOMO = -0.583036991169327  LUMO = 0.919444839844756
  mo_energy =
[-1.18584772e+02 -1.23125110e+01 -9.56260257e+00 -9.56260257e+00
 -9.56260257e+00 -1.27031409e+00 -5.83036991e-01 -5.83036991e-01
 -5.83036991e-01  9.19444840e-01  1.02533626e+00  1.02533626e+00
  1.02533626e+00  7.47059537e+00  7.47059537e+00  7.47059537e+00
  9.62579956e+00  3.43081526e+01  3.43081526e+01  3.43081526e+01
  5.06493577e+01  1.30915720e+02  1.30915720e+02  1.30915720e+02
  2.02223137e+02  4.85261957e+02  4.85261957e+02  4.85261957e+02
  7.42323420e+02  1.33583108e+03  1.33583108e+03  1.33583108e+03
  2.83416257e+03  3.02834905e+03  3.02834905e+03  3.02834905e+03
  6.64755142e+03  6.64755142e+03  6.64755142e+03  9.23482984e+03
  2.55819011e+04  7.63127692e+04]
E1 = -728.2975519251254  E_coul = 201.5440599437314
cycle= 5 E= -526.753491981394  delta_E= -2.07e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93401e-05
diis-c [-9.60840570e-11  1.28598366e-05 -1.75860238e-03 -1.26910536e-02
  3.45913766e-02  9.79845420e-01]
  HOMO = -0.583044868228518  LUMO = 0.919441003359771
  mo_energy =
[-1.18584804e+02 -1.23125347e+01 -9.56262815e+00 -9.56262815e+00
 -9.56262815e+00 -1.27032037e+00 -5.83044868e-01 -5.83044868e-01
 -5.83044868e-01  9.19441003e-01  1.02533095e+00  1.02533095e+00
  1.02533095e+00  7.47057773e+00  7.47057773e+00  7.47057773e+00
  9.62578244e+00  3.43081277e+01  3.43081277e+01  3.43081277e+01
  5.06493325e+01  1.30915691e+02  1.30915691e+02  1.30915691e+02
  2.02223107e+02  4.85261925e+02  4.85261925e+02  4.85261925e+02
  7.42323388e+02  1.33583105e+03  1.33583105e+03  1.33583105e+03
  2.83416254e+03  3.02834902e+03  3.02834902e+03  3.02834902e+03
  6.64755139e+03  6.64755139e+03  6.64755139e+03  9.23482980e+03
  2.55819011e+04  7.63127692e+04]
E1 = -728.2976359967879  E_coul = 201.54414401533163
cycle= 6 E= -526.753491981456  delta_E= -6.23e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2976359967879  E_coul = 201.54414401533163
  HOMO = -0.583044757838772  LUMO = 0.919441437818542
  mo_energy =
[-1.18584803e+02 -1.23125340e+01 -9.56262760e+00 -9.56262760e+00
 -9.56262760e+00 -1.27031984e+00 -5.83044758e-01 -5.83044758e-01
 -5.83044758e-01  9.19441438e-01  1.02533109e+00  1.02533109e+00
  1.02533109e+00  7.47057810e+00  7.47057810e+00  7.47057810e+00
  9.62578299e+00  3.43081283e+01  3.43081283e+01  3.43081283e+01
  5.06493331e+01  1.30915691e+02  1.30915691e+02  1.30915691e+02
  2.02223108e+02  4.85261926e+02  4.85261926e+02  4.85261926e+02
  7.42323389e+02  1.33583105e+03  1.33583105e+03  1.33583105e+03
  2.83416254e+03  3.02834902e+03  3.02834902e+03  3.02834902e+03
  6.64755139e+03  6.64755139e+03  6.64755139e+03  9.23482981e+03
  2.55819011e+04  7.63127692e+04]
E1 = -728.297633091824  E_coul = 201.54414111036914
Extra cycle  E= -526.753491981455  delta_E= 1.48e-12  |g|= 3.9e-07  |ddm|= 3.25e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113470.93553910457
E1 = -728.297633091824  E_coul = 201.54414111036914
init E= -526.753491981455
    CPU time for initialize scf      0.80 sec, wall time      0.32 sec
  HOMO = -0.583044829365346  LUMO = 0.919441452237675
  mo_energy =
[-1.18584803e+02 -1.23125342e+01 -9.56262784e+00 -9.56262784e+00
 -9.56262784e+00 -1.27031984e+00 -5.83044829e-01 -5.83044829e-01
 -5.83044829e-01  9.19441452e-01  1.02533105e+00  1.02533105e+00
  1.02533105e+00  7.47057795e+00  7.47057795e+00  7.47057795e+00
  9.62578287e+00  3.43081281e+01  3.43081281e+01  3.43081281e+01
  5.06493329e+01  1.30915691e+02  1.30915691e+02  1.30915691e+02
  2.02223108e+02  4.85261926e+02  4.85261926e+02  4.85261926e+02
  7.42323389e+02  1.33583105e+03  1.33583105e+03  1.33583105e+03
  2.83416254e+03  3.02834902e+03  3.02834902e+03  3.02834902e+03
  6.64755139e+03  6.64755139e+03  6.64755139e+03  9.23482980e+03
  2.55819011e+04  7.63127692e+04]
E1 = -728.2976337582313  E_coul = 201.54414177677498
cycle= 1 E= -526.753491981456  delta_E= -1.59e-12  |g|= 8.97e-08  |ddm|= 6.06e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2976337582313  E_coul = 201.54414177677498
  HOMO = -0.583044819845923  LUMO = 0.919441474565453
  mo_energy =
[-1.18584803e+02 -1.23125342e+01 -9.56262779e+00 -9.56262779e+00
 -9.56262779e+00 -1.27031981e+00 -5.83044820e-01 -5.83044820e-01
 -5.83044820e-01  9.19441475e-01  1.02533106e+00  1.02533106e+00
  1.02533106e+00  7.47057798e+00  7.47057798e+00  7.47057798e+00
  9.62578291e+00  3.43081281e+01  3.43081281e+01  3.43081281e+01
  5.06493329e+01  1.30915691e+02  1.30915691e+02  1.30915691e+02
  2.02223108e+02  4.85261926e+02  4.85261926e+02  4.85261926e+02
  7.42323389e+02  1.33583105e+03  1.33583105e+03  1.33583105e+03
  2.83416254e+03  3.02834902e+03  3.02834902e+03  3.02834902e+03
  6.64755139e+03  6.64755139e+03  6.64755139e+03  9.23482980e+03
  2.55819011e+04  7.63127692e+04]
E1 = -728.2976335400614  E_coul = 201.54414155860448
Extra cycle  E= -526.753491981457  delta_E= -5.68e-13  |g|= 1.95e-08  |ddm|= 1.39e-07
    CPU time for scf_cycle      0.90 sec, wall time      0.42 sec
exp = [2.61826968e+04 7.61742593e+03 3.61738694e+03 1.59568901e+03
 3.88924074e+02 1.25306056e+02 4.76237936e+01 1.81151918e+01
 7.06860056e+00 6.49696465e-01 2.83658130e+00 2.31452842e-01
 1.36279678e+03 6.64614565e+02 3.00344756e+02 3.13510315e+02
 6.18078233e+01 7.50814418e+00 2.05808176e+01 7.82531031e-01
 2.87743406e+00 2.24043361e-01]
grad_E = [-1.57079269e-06  3.92960384e-06 -1.19988399e-06  9.34513402e-05
 -5.75071436e-04  2.38466017e-04  2.23530920e-04 -3.18612374e-04
 -2.62911036e-04  1.59880333e-04  4.65985905e-04 -5.47119059e-04
 -4.88777381e-07  5.29334058e-06  2.54232071e-05  2.18789445e-05
 -2.10709491e-04  2.34851901e-04  5.41392807e-04 -1.11365426e-04
  5.92646557e-05  6.28115104e-04]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:31 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6981187        1
[INPUT] 0    0    [1    /1   ]  7617.42281108        1
[INPUT] 0    0    [1    /1   ]  3617.38810979        1
[INPUT] 0    0    [1    /1   ]  1595.6194879         1
[INPUT] 0    0    [1    /1   ]  389.128872744        1
[INPUT] 0    0    [1    /1   ]  125.82927773         1
[INPUT] 0    0    [1    /1   ]  48.0783229171        1
[INPUT] 0    0    [1    /1   ]  18.4523457333        1
[INPUT] 0    0    [1    /1   ]  7.11050523954        1
[INPUT] 0    0    [1    /1   ]  0.649195095857       1
[INPUT] 0    0    [1    /1   ]  2.84565138575        1
[INPUT] 0    0    [1    /1   ]  0.231349405272       1
[INPUT] 1    0    [1    /1   ]  1362.79721998        1
[INPUT] 1    0    [1    /1   ]  664.610314278        1
[INPUT] 1    0    [1    /1   ]  300.324742278        1
[INPUT] 1    0    [1    /1   ]  313.493066553        1
[INPUT] 1    0    [1    /1   ]  61.8152355506        1
[INPUT] 1    0    [1    /1   ]  7.51632511251        1
[INPUT] 1    0    [1    /1   ]  20.5863182172        1
[INPUT] 1    0    [1    /1   ]  0.783059501516       1
[INPUT] 1    0    [1    /1   ]  2.883044998          1
[INPUT] 1    0    [1    /1   ]  0.22412719809        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69811874861, 1.0]], [0, [7617.4228110825115, 1.0]], [0, [3617.388109787079, 1.0]], [0, [1595.6194879003647, 1.0]], [0, [389.12887274402306, 1.0]], [0, [125.8292777295723, 1.0]], [0, [48.07832291710519, 1.0]], [0, [18.45234573327008, 1.0]], [0, [7.110505239536551, 1.0]], [0, [0.6491950958572316, 1.0]], [0, [2.8456513857541106, 1.0]], [0, [0.23134940527182002, 1.0]], [1, [1362.7972199803216, 1.0]], [1, [664.6103142775672, 1.0]], [1, [300.32474227833376, 1.0]], [1, [313.49306655277616, 1.0]], [1, [61.81523555058566, 1.0]], [1, [7.516325112507949, 1.0]], [1, [20.586318217235945, 1.0]], [1, [0.7830595015161065, 1.0]], [1, [2.883044997995616, 1.0]], [1, [0.2241271980902322, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69811875]
bas 1, expnt(s) = [7617.42281108]
bas 2, expnt(s) = [3617.38810979]
bas 3, expnt(s) = [1595.6194879]
bas 4, expnt(s) = [389.12887274]
bas 5, expnt(s) = [125.82927773]
bas 6, expnt(s) = [48.07832292]
bas 7, expnt(s) = [18.45234573]
bas 8, expnt(s) = [7.11050524]
bas 9, expnt(s) = [0.6491951]
bas 10, expnt(s) = [2.84565139]
bas 11, expnt(s) = [0.23134941]
bas 12, expnt(s) = [1362.79721998]
bas 13, expnt(s) = [664.61031428]
bas 14, expnt(s) = [300.32474228]
bas 15, expnt(s) = [313.49306655]
bas 16, expnt(s) = [61.81523555]
bas 17, expnt(s) = [7.51632511]
bas 18, expnt(s) = [20.58631822]
bas 19, expnt(s) = [0.7830595]
bas 20, expnt(s) = [2.883045]
bas 21, expnt(s) = [0.2241272]
CPU time:       464.91
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826981e+04 5.20026916e+03 7.61742281e+03 2.06001826e+03
 3.61738811e+03 1.17845053e+03 1.59561949e+03 6.37840400e+02
 3.89128873e+02 2.21352849e+02 1.25829278e+02 9.49185952e+01
 4.80783229e+01 4.61293151e+01 1.84523457e+01 2.24933278e+01
 7.11050524e+00 1.10012078e+01 6.49195096e-01 1.82724359e+00
 2.84565139e+00 5.53542913e+00 2.31349405e-01 8.42784064e-01
 1.36279722e+03 2.41559121e+04 6.64610314e+02 9.84449038e+03
 3.00324742e+02 3.64731509e+03 3.13493067e+02 3.84830352e+03
 6.18152356e+01 5.05654415e+02 7.51632511e+00 3.63070814e+01
 2.05863182e+01 1.27925683e+02 7.83059502e-01 2.14895760e+00
 2.88304500e+00 1.09597001e+01 2.24127198e-01 4.49886120e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993534801219923
cond(S) = 113484.32520884708
E1 = -729.5452697105541  E_coul = 203.17580184485593
init E= -526.369467865698
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555709694687786  LUMO = 0.93860323955686
  mo_energy =
[-1.18334112e+02 -1.22068429e+01 -9.44717501e+00 -9.44717501e+00
 -9.44717501e+00 -1.24023238e+00 -5.55709695e-01 -5.55709695e-01
 -5.55709695e-01  9.38603240e-01  1.04510755e+00  1.04510755e+00
  1.04510755e+00  7.55696795e+00  7.55696795e+00  7.55696795e+00
  9.76480446e+00  3.44749274e+01  3.44749274e+01  3.44749274e+01
  5.15021753e+01  1.31167642e+02  1.31167642e+02  1.31167642e+02
  2.04913493e+02  4.85578574e+02  4.85578574e+02  4.85578574e+02
  7.47136453e+02  1.33615921e+03  1.33615921e+03  1.33615921e+03
  2.84004609e+03  3.02868478e+03  3.02868478e+03  3.02868478e+03
  6.64795875e+03  6.64795875e+03  6.64795875e+03  9.24074826e+03
  2.55876644e+04  7.63182730e+04]
E1 = -727.850126441479  E_coul = 201.09741672236572
cycle= 1 E= -526.752709719113  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571118
diis-c [-0.32617578  1.        ]
  HOMO = -0.590665994839364  LUMO = 0.912589946384163
  mo_energy =
[-1.18642792e+02 -1.23448883e+01 -9.59629445e+00 -9.59629445e+00
 -9.59629445e+00 -1.27958614e+00 -5.90665995e-01 -5.90665995e-01
 -5.90665995e-01  9.12589946e-01  1.02039092e+00  1.02039092e+00
  1.02039092e+00  7.46448019e+00  7.46448019e+00  7.46448019e+00
  9.67033117e+00  3.43188452e+01  3.43188452e+01  3.43188452e+01
  5.13406721e+01  1.30938412e+02  1.30938412e+02  1.30938412e+02
  2.04670635e+02  4.85271225e+02  4.85271225e+02  4.85271225e+02
  7.46786633e+02  1.33579531e+03  1.33579531e+03  1.33579531e+03
  2.83955007e+03  3.02825520e+03  3.02825520e+03  3.02825520e+03
  6.64741578e+03  6.64741578e+03  6.64741578e+03  9.24013153e+03
  2.55869525e+04  7.63174704e+04]
E1 = -728.4255854307895  E_coul = 201.67214871406097
cycle= 2 E= -526.753436716729  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0532
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0773301
diis-c [-0.00377831  0.0763297   0.9236703 ]
  HOMO = -0.58149287180283  LUMO = 0.920190970364349
  mo_energy =
[-1.18574380e+02 -1.23064911e+01 -9.55622495e+00 -9.55622495e+00
 -9.55622495e+00 -1.26859793e+00 -5.81492872e-01 -5.81492872e-01
 -5.81492872e-01  9.20190970e-01  1.02726080e+00  1.02726080e+00
  1.02726080e+00  7.48880466e+00  7.48880466e+00  7.48880466e+00
  9.69634154e+00  3.43595847e+01  3.43595847e+01  3.43595847e+01
  5.13842197e+01  1.30994914e+02  1.30994914e+02  1.30994914e+02
  2.04730275e+02  4.85338788e+02  4.85338788e+02  4.85338788e+02
  7.46856670e+02  1.33586697e+03  1.33586697e+03  1.33586697e+03
  2.83962498e+03  3.02832914e+03  3.02832914e+03  3.02832914e+03
  6.64749149e+03  6.64749149e+03  6.64749149e+03  9.24020801e+03
  2.55870296e+04  7.63175478e+04]
E1 = -728.2739554506784  E_coul = 201.5204596118791
cycle= 3 E= -526.753495838799  delta_E= -5.91e-05  |g|= 0.0066  |ddm|= 0.0162
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0140558
diis-c [-8.27646193e-07 -1.28608199e-03  1.49396542e-01  8.51889540e-01]
  HOMO = -0.583055309114434  LUMO = 0.918994153725737
  mo_energy =
[-1.18584833e+02 -1.23125663e+01 -9.56266480e+00 -9.56266480e+00
 -9.56266480e+00 -1.27035720e+00 -5.83055309e-01 -5.83055309e-01
 -5.83055309e-01  9.18994154e-01  1.02611661e+00  1.02611661e+00
  1.02611661e+00  7.48479949e+00  7.48479949e+00  7.48479949e+00
  9.69216378e+00  3.43530809e+01  3.43530809e+01  3.43530809e+01
  5.13773697e+01  1.30986154e+02  1.30986154e+02  1.30986154e+02
  2.04721092e+02  4.85328460e+02  4.85328460e+02  4.85328460e+02
  7.46845945e+02  1.33585602e+03  1.33585602e+03  1.33585602e+03
  2.83961338e+03  3.02831778e+03  3.02831778e+03  3.02831778e+03
  6.64747972e+03  6.64747972e+03  6.64747972e+03  9.24019603e+03
  2.55870174e+04  7.63175354e+04]
E1 = -728.2977682929476  E_coul = 201.54427035371222
cycle= 4 E= -526.753497939235  delta_E= -2.1e-06  |g|= 0.000107  |ddm|= 0.00233
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000119631
diis-c [-5.16095497e-09  8.78547596e-05 -1.24919331e-02 -7.55036238e-02
  1.08790770e+00]
  HOMO = -0.583036557688942  LUMO = 0.919028266410618
  mo_energy =
[-1.18584785e+02 -1.23124967e+01 -9.56260945e+00 -9.56260945e+00
 -9.56260945e+00 -1.27031350e+00 -5.83036558e-01 -5.83036558e-01
 -5.83036558e-01  9.19028266e-01  1.02613319e+00  1.02613319e+00
  1.02613319e+00  7.48484381e+00  7.48484381e+00  7.48484381e+00
  9.69222410e+00  3.43531345e+01  3.43531345e+01  3.43531345e+01
  5.13774313e+01  1.30986209e+02  1.30986209e+02  1.30986209e+02
  2.04721147e+02  4.85328508e+02  4.85328508e+02  4.85328508e+02
  7.46845985e+02  1.33585606e+03  1.33585606e+03  1.33585606e+03
  2.83961340e+03  3.02831781e+03  3.02831781e+03  3.02831781e+03
  6.64747973e+03  6.64747973e+03  6.64747973e+03  9.24019604e+03
  2.55870174e+04  7.63175354e+04]
E1 = -728.2975295431154  E_coul = 201.54403160180428
cycle= 5 E= -526.753497941311  delta_E= -2.08e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93327e-05
diis-c [-9.59897081e-11  1.28354065e-05 -1.75881641e-03 -1.26762974e-02
  3.45239684e-02  9.79898310e-01]
  HOMO = -0.583044429711391  LUMO = 0.91902443405729
  mo_energy =
[-1.18584817e+02 -1.23125203e+01 -9.56263501e+00 -9.56263501e+00
 -9.56263501e+00 -1.27031978e+00 -5.83044430e-01 -5.83044430e-01
 -5.83044430e-01  9.19024434e-01  1.02612789e+00  1.02612789e+00
  1.02612789e+00  7.48482616e+00  7.48482616e+00  7.48482616e+00
  9.69220695e+00  3.43531096e+01  3.43531096e+01  3.43531096e+01
  5.13774060e+01  1.30986180e+02  1.30986180e+02  1.30986180e+02
  2.04721117e+02  4.85328477e+02  4.85328477e+02  4.85328477e+02
  7.46845953e+02  1.33585603e+03  1.33585603e+03  1.33585603e+03
  2.83961336e+03  3.02831777e+03  3.02831777e+03  3.02831777e+03
  6.64747970e+03  6.64747970e+03  6.64747970e+03  9.24019600e+03
  2.55870173e+04  7.63175354e+04]
E1 = -728.2976135084601  E_coul = 201.54411556708638
cycle= 6 E= -526.753497941374  delta_E= -6.26e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2976135084601  E_coul = 201.54411556708638
  HOMO = -0.583044319762868  LUMO = 0.919024868607975
  mo_energy =
[-1.18584816e+02 -1.23125197e+01 -9.56263446e+00 -9.56263446e+00
 -9.56263446e+00 -1.27031924e+00 -5.83044320e-01 -5.83044320e-01
 -5.83044320e-01  9.19024869e-01  1.02612802e+00  1.02612802e+00
  1.02612802e+00  7.48482654e+00  7.48482654e+00  7.48482654e+00
  9.69220750e+00  3.43531102e+01  3.43531102e+01  3.43531102e+01
  5.13774067e+01  1.30986180e+02  1.30986180e+02  1.30986180e+02
  2.04721118e+02  4.85328478e+02  4.85328478e+02  4.85328478e+02
  7.46845954e+02  1.33585603e+03  1.33585603e+03  1.33585603e+03
  2.83961337e+03  3.02831777e+03  3.02831777e+03  3.02831777e+03
  6.64747970e+03  6.64747970e+03  6.64747970e+03  9.24019600e+03
  2.55870173e+04  7.63175354e+04]
E1 = -728.2976106021873  E_coul = 201.5441126608131
Extra cycle  E= -526.753497941374  delta_E= -4.55e-13  |g|= 3.9e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
exp = [2.61826981e+04 7.61742281e+03 3.61738811e+03 1.59561949e+03
 3.89128873e+02 1.25829278e+02 4.80783229e+01 1.84523457e+01
 7.11050524e+00 6.49195096e-01 2.84565139e+00 2.31349405e-01
 1.36279722e+03 6.64610314e+02 3.00324742e+02 3.13493067e+02
 6.18152356e+01 7.51632511e+00 2.05863182e+01 7.83059502e-01
 2.88304500e+00 2.24127198e-01]
E = -526.7534979413742
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:31 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6981187        1
[INPUT] 0    0    [1    /1   ]  7617.42281108        1
[INPUT] 0    0    [1    /1   ]  3617.38810979        1
[INPUT] 0    0    [1    /1   ]  1595.6194879         1
[INPUT] 0    0    [1    /1   ]  389.128872744        1
[INPUT] 0    0    [1    /1   ]  125.82927773         1
[INPUT] 0    0    [1    /1   ]  48.0783229171        1
[INPUT] 0    0    [1    /1   ]  18.4523457333        1
[INPUT] 0    0    [1    /1   ]  7.11050523954        1
[INPUT] 0    0    [1    /1   ]  0.649195095857       1
[INPUT] 0    0    [1    /1   ]  2.84565138575        1
[INPUT] 0    0    [1    /1   ]  0.231349405272       1
[INPUT] 1    0    [1    /1   ]  1362.79721998        1
[INPUT] 1    0    [1    /1   ]  664.610314278        1
[INPUT] 1    0    [1    /1   ]  300.324742278        1
[INPUT] 1    0    [1    /1   ]  313.493066553        1
[INPUT] 1    0    [1    /1   ]  61.8152355506        1
[INPUT] 1    0    [1    /1   ]  7.51632511251        1
[INPUT] 1    0    [1    /1   ]  20.5863182172        1
[INPUT] 1    0    [1    /1   ]  0.783059501516       1
[INPUT] 1    0    [1    /1   ]  2.883044998          1
[INPUT] 1    0    [1    /1   ]  0.22412719809        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69811874861, 1.0]], [0, [7617.4228110825115, 1.0]], [0, [3617.388109787079, 1.0]], [0, [1595.6194879003647, 1.0]], [0, [389.12887274402306, 1.0]], [0, [125.8292777295723, 1.0]], [0, [48.07832291710519, 1.0]], [0, [18.45234573327008, 1.0]], [0, [7.110505239536551, 1.0]], [0, [0.6491950958572316, 1.0]], [0, [2.8456513857541106, 1.0]], [0, [0.23134940527182002, 1.0]], [1, [1362.7972199803216, 1.0]], [1, [664.6103142775672, 1.0]], [1, [300.32474227833376, 1.0]], [1, [313.49306655277616, 1.0]], [1, [61.81523555058566, 1.0]], [1, [7.516325112507949, 1.0]], [1, [20.586318217235945, 1.0]], [1, [0.7830595015161065, 1.0]], [1, [2.883044997995616, 1.0]], [1, [0.2241271980902322, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69811875]
bas 1, expnt(s) = [7617.42281108]
bas 2, expnt(s) = [3617.38810979]
bas 3, expnt(s) = [1595.6194879]
bas 4, expnt(s) = [389.12887274]
bas 5, expnt(s) = [125.82927773]
bas 6, expnt(s) = [48.07832292]
bas 7, expnt(s) = [18.45234573]
bas 8, expnt(s) = [7.11050524]
bas 9, expnt(s) = [0.6491951]
bas 10, expnt(s) = [2.84565139]
bas 11, expnt(s) = [0.23134941]
bas 12, expnt(s) = [1362.79721998]
bas 13, expnt(s) = [664.61031428]
bas 14, expnt(s) = [300.32474228]
bas 15, expnt(s) = [313.49306655]
bas 16, expnt(s) = [61.81523555]
bas 17, expnt(s) = [7.51632511]
bas 18, expnt(s) = [20.58631822]
bas 19, expnt(s) = [0.7830595]
bas 20, expnt(s) = [2.883045]
bas 21, expnt(s) = [0.2241272]
CPU time:       465.38
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826981e+04 5.20026916e+03 7.61742281e+03 2.06001826e+03
 3.61738811e+03 1.17845053e+03 1.59561949e+03 6.37840400e+02
 3.89128873e+02 2.21352849e+02 1.25829278e+02 9.49185952e+01
 4.80783229e+01 4.61293151e+01 1.84523457e+01 2.24933278e+01
 7.11050524e+00 1.10012078e+01 6.49195096e-01 1.82724359e+00
 2.84565139e+00 5.53542913e+00 2.31349405e-01 8.42784064e-01
 1.36279722e+03 2.41559121e+04 6.64610314e+02 9.84449038e+03
 3.00324742e+02 3.64731509e+03 3.13493067e+02 3.84830352e+03
 6.18152356e+01 5.05654415e+02 7.51632511e+00 3.63070814e+01
 2.05863182e+01 1.27925683e+02 7.83059502e-01 2.14895760e+00
 2.88304500e+00 1.09597001e+01 2.24127198e-01 4.49886120e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993534801219923
cond(S) = 113484.32520884708
E1 = -729.5452697105541  E_coul = 203.17580184485593
init E= -526.369467865698
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555709694687786  LUMO = 0.93860323955686
  mo_energy =
[-1.18334112e+02 -1.22068429e+01 -9.44717501e+00 -9.44717501e+00
 -9.44717501e+00 -1.24023238e+00 -5.55709695e-01 -5.55709695e-01
 -5.55709695e-01  9.38603240e-01  1.04510755e+00  1.04510755e+00
  1.04510755e+00  7.55696795e+00  7.55696795e+00  7.55696795e+00
  9.76480446e+00  3.44749274e+01  3.44749274e+01  3.44749274e+01
  5.15021753e+01  1.31167642e+02  1.31167642e+02  1.31167642e+02
  2.04913493e+02  4.85578574e+02  4.85578574e+02  4.85578574e+02
  7.47136453e+02  1.33615921e+03  1.33615921e+03  1.33615921e+03
  2.84004609e+03  3.02868478e+03  3.02868478e+03  3.02868478e+03
  6.64795875e+03  6.64795875e+03  6.64795875e+03  9.24074826e+03
  2.55876644e+04  7.63182730e+04]
E1 = -727.850126441479  E_coul = 201.09741672236572
cycle= 1 E= -526.752709719113  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571118
diis-c [-0.32617578  1.        ]
  HOMO = -0.590665994839364  LUMO = 0.912589946384163
  mo_energy =
[-1.18642792e+02 -1.23448883e+01 -9.59629445e+00 -9.59629445e+00
 -9.59629445e+00 -1.27958614e+00 -5.90665995e-01 -5.90665995e-01
 -5.90665995e-01  9.12589946e-01  1.02039092e+00  1.02039092e+00
  1.02039092e+00  7.46448019e+00  7.46448019e+00  7.46448019e+00
  9.67033117e+00  3.43188452e+01  3.43188452e+01  3.43188452e+01
  5.13406721e+01  1.30938412e+02  1.30938412e+02  1.30938412e+02
  2.04670635e+02  4.85271225e+02  4.85271225e+02  4.85271225e+02
  7.46786633e+02  1.33579531e+03  1.33579531e+03  1.33579531e+03
  2.83955007e+03  3.02825520e+03  3.02825520e+03  3.02825520e+03
  6.64741578e+03  6.64741578e+03  6.64741578e+03  9.24013153e+03
  2.55869525e+04  7.63174704e+04]
E1 = -728.4255854307895  E_coul = 201.67214871406097
cycle= 2 E= -526.753436716729  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0532
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0773301
diis-c [-0.00377831  0.0763297   0.9236703 ]
  HOMO = -0.58149287180283  LUMO = 0.920190970364349
  mo_energy =
[-1.18574380e+02 -1.23064911e+01 -9.55622495e+00 -9.55622495e+00
 -9.55622495e+00 -1.26859793e+00 -5.81492872e-01 -5.81492872e-01
 -5.81492872e-01  9.20190970e-01  1.02726080e+00  1.02726080e+00
  1.02726080e+00  7.48880466e+00  7.48880466e+00  7.48880466e+00
  9.69634154e+00  3.43595847e+01  3.43595847e+01  3.43595847e+01
  5.13842197e+01  1.30994914e+02  1.30994914e+02  1.30994914e+02
  2.04730275e+02  4.85338788e+02  4.85338788e+02  4.85338788e+02
  7.46856670e+02  1.33586697e+03  1.33586697e+03  1.33586697e+03
  2.83962498e+03  3.02832914e+03  3.02832914e+03  3.02832914e+03
  6.64749149e+03  6.64749149e+03  6.64749149e+03  9.24020801e+03
  2.55870296e+04  7.63175478e+04]
E1 = -728.2739554506784  E_coul = 201.5204596118791
cycle= 3 E= -526.753495838799  delta_E= -5.91e-05  |g|= 0.0066  |ddm|= 0.0162
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0140558
diis-c [-8.27646193e-07 -1.28608199e-03  1.49396542e-01  8.51889540e-01]
  HOMO = -0.583055309114434  LUMO = 0.918994153725737
  mo_energy =
[-1.18584833e+02 -1.23125663e+01 -9.56266480e+00 -9.56266480e+00
 -9.56266480e+00 -1.27035720e+00 -5.83055309e-01 -5.83055309e-01
 -5.83055309e-01  9.18994154e-01  1.02611661e+00  1.02611661e+00
  1.02611661e+00  7.48479949e+00  7.48479949e+00  7.48479949e+00
  9.69216378e+00  3.43530809e+01  3.43530809e+01  3.43530809e+01
  5.13773697e+01  1.30986154e+02  1.30986154e+02  1.30986154e+02
  2.04721092e+02  4.85328460e+02  4.85328460e+02  4.85328460e+02
  7.46845945e+02  1.33585602e+03  1.33585602e+03  1.33585602e+03
  2.83961338e+03  3.02831778e+03  3.02831778e+03  3.02831778e+03
  6.64747972e+03  6.64747972e+03  6.64747972e+03  9.24019603e+03
  2.55870174e+04  7.63175354e+04]
E1 = -728.2977682929476  E_coul = 201.54427035371222
cycle= 4 E= -526.753497939235  delta_E= -2.1e-06  |g|= 0.000107  |ddm|= 0.00233
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000119631
diis-c [-5.16095497e-09  8.78547596e-05 -1.24919331e-02 -7.55036238e-02
  1.08790770e+00]
  HOMO = -0.583036557688942  LUMO = 0.919028266410618
  mo_energy =
[-1.18584785e+02 -1.23124967e+01 -9.56260945e+00 -9.56260945e+00
 -9.56260945e+00 -1.27031350e+00 -5.83036558e-01 -5.83036558e-01
 -5.83036558e-01  9.19028266e-01  1.02613319e+00  1.02613319e+00
  1.02613319e+00  7.48484381e+00  7.48484381e+00  7.48484381e+00
  9.69222410e+00  3.43531345e+01  3.43531345e+01  3.43531345e+01
  5.13774313e+01  1.30986209e+02  1.30986209e+02  1.30986209e+02
  2.04721147e+02  4.85328508e+02  4.85328508e+02  4.85328508e+02
  7.46845985e+02  1.33585606e+03  1.33585606e+03  1.33585606e+03
  2.83961340e+03  3.02831781e+03  3.02831781e+03  3.02831781e+03
  6.64747973e+03  6.64747973e+03  6.64747973e+03  9.24019604e+03
  2.55870174e+04  7.63175354e+04]
E1 = -728.2975295431154  E_coul = 201.54403160180428
cycle= 5 E= -526.753497941311  delta_E= -2.08e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93327e-05
diis-c [-9.59897081e-11  1.28354065e-05 -1.75881641e-03 -1.26762974e-02
  3.45239684e-02  9.79898310e-01]
  HOMO = -0.583044429711391  LUMO = 0.91902443405729
  mo_energy =
[-1.18584817e+02 -1.23125203e+01 -9.56263501e+00 -9.56263501e+00
 -9.56263501e+00 -1.27031978e+00 -5.83044430e-01 -5.83044430e-01
 -5.83044430e-01  9.19024434e-01  1.02612789e+00  1.02612789e+00
  1.02612789e+00  7.48482616e+00  7.48482616e+00  7.48482616e+00
  9.69220695e+00  3.43531096e+01  3.43531096e+01  3.43531096e+01
  5.13774060e+01  1.30986180e+02  1.30986180e+02  1.30986180e+02
  2.04721117e+02  4.85328477e+02  4.85328477e+02  4.85328477e+02
  7.46845953e+02  1.33585603e+03  1.33585603e+03  1.33585603e+03
  2.83961336e+03  3.02831777e+03  3.02831777e+03  3.02831777e+03
  6.64747970e+03  6.64747970e+03  6.64747970e+03  9.24019600e+03
  2.55870173e+04  7.63175354e+04]
E1 = -728.2976135084601  E_coul = 201.54411556708638
cycle= 6 E= -526.753497941374  delta_E= -6.26e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2976135084601  E_coul = 201.54411556708638
  HOMO = -0.583044319762868  LUMO = 0.919024868607975
  mo_energy =
[-1.18584816e+02 -1.23125197e+01 -9.56263446e+00 -9.56263446e+00
 -9.56263446e+00 -1.27031924e+00 -5.83044320e-01 -5.83044320e-01
 -5.83044320e-01  9.19024869e-01  1.02612802e+00  1.02612802e+00
  1.02612802e+00  7.48482654e+00  7.48482654e+00  7.48482654e+00
  9.69220750e+00  3.43531102e+01  3.43531102e+01  3.43531102e+01
  5.13774067e+01  1.30986180e+02  1.30986180e+02  1.30986180e+02
  2.04721118e+02  4.85328478e+02  4.85328478e+02  4.85328478e+02
  7.46845954e+02  1.33585603e+03  1.33585603e+03  1.33585603e+03
  2.83961337e+03  3.02831777e+03  3.02831777e+03  3.02831777e+03
  6.64747970e+03  6.64747970e+03  6.64747970e+03  9.24019600e+03
  2.55870173e+04  7.63175354e+04]
E1 = -728.2976106021873  E_coul = 201.5441126608131
Extra cycle  E= -526.753497941374  delta_E= -4.55e-13  |g|= 3.9e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113484.32520884708
E1 = -728.2976106021873  E_coul = 201.5441126608131
init E= -526.753497941374
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583044391379003  LUMO = 0.919024883028152
  mo_energy =
[-1.18584816e+02 -1.23125199e+01 -9.56263470e+00 -9.56263470e+00
 -9.56263470e+00 -1.27031924e+00 -5.83044391e-01 -5.83044391e-01
 -5.83044391e-01  9.19024883e-01  1.02612798e+00  1.02612798e+00
  1.02612798e+00  7.48482638e+00  7.48482638e+00  7.48482638e+00
  9.69220737e+00  3.43531100e+01  3.43531100e+01  3.43531100e+01
  5.13774064e+01  1.30986180e+02  1.30986180e+02  1.30986180e+02
  2.04721118e+02  4.85328477e+02  4.85328477e+02  4.85328477e+02
  7.46845954e+02  1.33585603e+03  1.33585603e+03  1.33585603e+03
  2.83961336e+03  3.02831777e+03  3.02831777e+03  3.02831777e+03
  6.64747970e+03  6.64747970e+03  6.64747970e+03  9.24019600e+03
  2.55870173e+04  7.63175354e+04]
E1 = -728.2976112679984  E_coul = 201.5441133266242
cycle= 1 E= -526.753497941374  delta_E=    0  |g|= 8.98e-08  |ddm|= 6.07e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2976112679984  E_coul = 201.5441133266242
  HOMO = -0.583044381883048  LUMO = 0.919024905360521
  mo_energy =
[-1.18584816e+02 -1.23125198e+01 -9.56263465e+00 -9.56263465e+00
 -9.56263465e+00 -1.27031921e+00 -5.83044382e-01 -5.83044382e-01
 -5.83044382e-01  9.19024905e-01  1.02612799e+00  1.02612799e+00
  1.02612799e+00  7.48482641e+00  7.48482641e+00  7.48482641e+00
  9.69220741e+00  3.43531100e+01  3.43531100e+01  3.43531100e+01
  5.13774065e+01  1.30986180e+02  1.30986180e+02  1.30986180e+02
  2.04721118e+02  4.85328477e+02  4.85328477e+02  4.85328477e+02
  7.46845954e+02  1.33585603e+03  1.33585603e+03  1.33585603e+03
  2.83961336e+03  3.02831777e+03  3.02831777e+03  3.02831777e+03
  6.64747970e+03  6.64747970e+03  6.64747970e+03  9.24019600e+03
  2.55870173e+04  7.63175354e+04]
E1 = -728.2976110498616  E_coul = 201.54411310848764
Extra cycle  E= -526.753497941374  delta_E= 2.27e-13  |g|= 1.95e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      1.10 sec, wall time      0.62 sec
exp = [2.61826981e+04 7.61742281e+03 3.61738811e+03 1.59561949e+03
 3.89128873e+02 1.25829278e+02 4.80783229e+01 1.84523457e+01
 7.11050524e+00 6.49195096e-01 2.84565139e+00 2.31349405e-01
 1.36279722e+03 6.64610314e+02 3.00324742e+02 3.13493067e+02
 6.18152356e+01 7.51632511e+00 2.05863182e+01 7.83059502e-01
 2.88304500e+00 2.24127198e-01]
grad_E = [-1.57136086e-06  3.93670145e-06 -1.19534269e-06  9.37404933e-05
 -5.80393462e-04  2.48464993e-04  2.27178107e-04 -3.24431005e-04
 -1.92591200e-04  4.21816263e-05  3.04131894e-04 -4.76314001e-04
 -4.89947345e-07  5.27959765e-06  2.53438490e-05  2.18094110e-05
 -2.04199540e-04  2.42811228e-04  4.94557475e-04  1.63566928e-04
  3.23317034e-04 -3.43768955e-04]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:36 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6987558        1
[INPUT] 0    0    [1    /1   ]  7617.42132315        1
[INPUT] 0    0    [1    /1   ]  3617.38867756        1
[INPUT] 0    0    [1    /1   ]  1595.58646001        1
[INPUT] 0    0    [1    /1   ]  389.21944242         1
[INPUT] 0    0    [1    /1   ]  126.092642341        1
[INPUT] 0    0    [1    /1   ]  48.3268664063        1
[INPUT] 0    0    [1    /1   ]  18.6597085711        1
[INPUT] 0    0    [1    /1   ]  7.13433598951        1
[INPUT] 0    0    [1    /1   ]  0.648995929905       1
[INPUT] 0    0    [1    /1   ]  2.8509314814         1
[INPUT] 0    0    [1    /1   ]  0.231367062996       1
[INPUT] 1    0    [1    /1   ]  1362.79743118        1
[INPUT] 1    0    [1    /1   ]  664.608268928        1
[INPUT] 1    0    [1    /1   ]  300.315110561        1
[INPUT] 1    0    [1    /1   ]  313.48476542         1
[INPUT] 1    0    [1    /1   ]  61.819151091         1
[INPUT] 1    0    [1    /1   ]  7.51762705397        1
[INPUT] 1    0    [1    /1   ]  20.5893729532        1
[INPUT] 1    0    [1    /1   ]  0.783067286946       1
[INPUT] 1    0    [1    /1   ]  2.88326959447        1
[INPUT] 1    0    [1    /1   ]  0.22412701259        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69875578775, 1.0]], [0, [7617.421323151872, 1.0]], [0, [3617.3886775606015, 1.0]], [0, [1595.586460006425, 1.0]], [0, [389.21944241982317, 1.0]], [0, [126.09264234139926, 1.0]], [0, [48.32686640632553, 1.0]], [0, [18.65970857105665, 1.0]], [0, [7.134335989509243, 1.0]], [0, [0.6489959299053603, 1.0]], [0, [2.8509314814032876, 1.0]], [0, [0.2313670629964152, 1.0]], [1, [1362.7974311753826, 1.0]], [1, [664.6082689276151, 1.0]], [1, [300.31511056140056, 1.0]], [1, [313.4847654196199, 1.0]], [1, [61.81915109097747, 1.0]], [1, [7.517627053974473, 1.0]], [1, [20.58937295321291, 1.0]], [1, [0.7830672869457298, 1.0]], [1, [2.8832695944673215, 1.0]], [1, [0.22412701259014572, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69875579]
bas 1, expnt(s) = [7617.42132315]
bas 2, expnt(s) = [3617.38867756]
bas 3, expnt(s) = [1595.58646001]
bas 4, expnt(s) = [389.21944242]
bas 5, expnt(s) = [126.09264234]
bas 6, expnt(s) = [48.32686641]
bas 7, expnt(s) = [18.65970857]
bas 8, expnt(s) = [7.13433599]
bas 9, expnt(s) = [0.64899593]
bas 10, expnt(s) = [2.85093148]
bas 11, expnt(s) = [0.23136706]
bas 12, expnt(s) = [1362.79743118]
bas 13, expnt(s) = [664.60826893]
bas 14, expnt(s) = [300.31511056]
bas 15, expnt(s) = [313.48476542]
bas 16, expnt(s) = [61.81915109]
bas 17, expnt(s) = [7.51762705]
bas 18, expnt(s) = [20.58937295]
bas 19, expnt(s) = [0.78306729]
bas 20, expnt(s) = [2.88326959]
bas 21, expnt(s) = [0.22412701]
CPU time:       471.03
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826988e+04 5.20026926e+03 7.61742132e+03 2.06001796e+03
 3.61738868e+03 1.17845066e+03 1.59558646e+03 6.37830497e+02
 3.89219442e+02 2.21391488e+02 1.26092642e+02 9.50675569e+01
 4.83268664e+01 4.63080508e+01 1.86597086e+01 2.26826435e+01
 7.13433599e+00 1.10288491e+01 6.48995930e-01 1.82682314e+00
 2.85093148e+00 5.54313057e+00 2.31367063e-01 8.42832307e-01
 1.36279743e+03 2.41559168e+04 6.64608269e+02 9.84445250e+03
 3.00315111e+02 3.64716888e+03 3.13484765e+02 3.84817614e+03
 6.18191511e+01 5.05694452e+02 7.51762705e+00 3.63149427e+01
 2.05893730e+01 1.27949412e+02 7.83067287e-01 2.14898431e+00
 2.88326959e+00 1.09607673e+01 2.24127013e-01 4.49885655e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993534394647888
cond(S) = 113496.54445408151
E1 = -729.5452386311665  E_coul = 203.17578968590524
init E= -526.369448945261
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555709761418571  LUMO = 0.938732328541506
  mo_energy =
[-1.18334124e+02 -1.22068364e+01 -9.44717606e+00 -9.44717606e+00
 -9.44717606e+00 -1.24023157e+00 -5.55709761e-01 -5.55709761e-01
 -5.55709761e-01  9.38732329e-01  1.04511403e+00  1.04511403e+00
  1.04511403e+00  7.55774630e+00  7.55774630e+00  7.55774630e+00
  9.80471805e+00  3.44808286e+01  3.44808286e+01  3.44808286e+01
  5.19369569e+01  1.31184755e+02  1.31184755e+02  1.31184755e+02
  2.06350494e+02  4.85597741e+02  4.85597741e+02  4.85597741e+02
  7.49632953e+02  1.33616031e+03  1.33616031e+03  1.33616031e+03
  2.84298119e+03  3.02865978e+03  3.02865978e+03  3.02865978e+03
  6.64791523e+03  6.64791523e+03  6.64791523e+03  9.24361891e+03
  2.55903995e+04  7.63208213e+04]
E1 = -727.8500310496394  E_coul = 201.0973186969505
cycle= 1 E= -526.752712352689  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571507
diis-c [-0.32661984  1.        ]
  HOMO = -0.590663345291723  LUMO = 0.912707601616325
  mo_energy =
[-1.18642817e+02 -1.23448905e+01 -9.59630560e+00 -9.59630560e+00
 -9.59630560e+00 -1.27958303e+00 -5.90663345e-01 -5.90663345e-01
 -5.90663345e-01  9.12707602e-01  1.02039840e+00  1.02039840e+00
  1.02039840e+00  7.46524762e+00  7.46524762e+00  7.46524762e+00
  9.71000061e+00  3.43247289e+01  3.43247289e+01  3.43247289e+01
  5.17749141e+01  1.30955504e+02  1.30955504e+02  1.30955504e+02
  2.06107271e+02  4.85290384e+02  4.85290384e+02  4.85290384e+02
  7.49283030e+02  1.33579639e+03  1.33579639e+03  1.33579639e+03
  2.84248517e+03  3.02823019e+03  3.02823019e+03  3.02823019e+03
  6.64737225e+03  6.64737225e+03  6.64737225e+03  9.24300218e+03
  2.55896876e+04  7.63200187e+04]
E1 = -728.4254997812322  E_coul = 201.672060395964
cycle= 2 E= -526.753439385268  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0773393
diis-c [-0.003784    0.07621346  0.92378654]
  HOMO = -0.581488287949691  LUMO = 0.920313920391163
  mo_energy =
[-1.18574397e+02 -1.23064879e+01 -9.55623089e+00 -9.55623089e+00
 -9.55623089e+00 -1.26859269e+00 -5.81488288e-01 -5.81488288e-01
 -5.81488288e-01  9.20313920e-01  1.02726976e+00  1.02726976e+00
  1.02726976e+00  7.48957762e+00  7.48957762e+00  7.48957762e+00
  9.73608388e+00  3.43654764e+01  3.43654764e+01  3.43654764e+01
  5.18185975e+01  1.31012014e+02  1.31012014e+02  1.31012014e+02
  2.06166977e+02  4.85357956e+02  4.85357956e+02  4.85357956e+02
  7.49353080e+02  1.33586806e+03  1.33586806e+03  1.33586806e+03
  2.84256008e+03  3.02830413e+03  3.02830413e+03  3.02830413e+03
  6.64744796e+03  6.64744796e+03  6.64744796e+03  9.24307868e+03
  2.55897647e+04  7.63200961e+04]
E1 = -728.2738596783444  E_coul = 201.5203611782332
cycle= 3 E= -526.753498500111  delta_E= -5.91e-05  |g|= 0.00661  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140678
diis-c [-8.27897756e-07 -1.28632714e-03  1.49495511e-01  8.51790816e-01]
  HOMO = -0.58305170745348  LUMO = 0.919115649172635
  mo_energy =
[-1.18584858e+02 -1.23125674e+01 -9.56267521e+00 -9.56267521e+00
 -9.56267521e+00 -1.27035319e+00 -5.83051707e-01 -5.83051707e-01
 -5.83051707e-01  9.19115649e-01  1.02612481e+00  1.02612481e+00
  1.02612481e+00  7.48556950e+00  7.48556950e+00  7.48556950e+00
  9.73189283e+00  3.43589677e+01  3.43589677e+01  3.43589677e+01
  5.18117236e+01  1.31003248e+02  1.31003248e+02  1.31003248e+02
  2.06157778e+02  4.85347619e+02  4.85347619e+02  4.85347619e+02
  7.49342347e+02  1.33585710e+03  1.33585710e+03  1.33585710e+03
  2.84254848e+03  3.02829276e+03  3.02829276e+03  3.02829276e+03
  6.64743619e+03  6.64743619e+03  6.64743619e+03  9.24306669e+03
  2.55897525e+04  7.63200838e+04]
E1 = -728.2976882167495  E_coul = 201.54418761341685
cycle= 4 E= -526.753500603333  delta_E= -2.1e-06  |g|= 0.000107  |ddm|= 0.00234
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119567
diis-c [-5.14545922e-09  8.77472405e-05 -1.24816155e-02 -7.53938985e-02
  1.08778777e+00]
  HOMO = -0.583032973781187  LUMO = 0.919149745153315
  mo_energy =
[-1.18584810e+02 -1.23124979e+01 -9.56261993e+00 -9.56261993e+00
 -9.56261993e+00 -1.27030952e+00 -5.83032974e-01 -5.83032974e-01
 -5.83032974e-01  9.19149745e-01  1.02614138e+00  1.02614138e+00
  1.02614138e+00  7.48561377e+00  7.48561377e+00  7.48561377e+00
  9.73195317e+00  3.43590212e+01  3.43590212e+01  3.43590212e+01
  5.18117852e+01  1.31003302e+02  1.31003302e+02  1.31003302e+02
  2.06157833e+02  4.85347668e+02  4.85347668e+02  4.85347668e+02
  7.49342387e+02  1.33585714e+03  1.33585714e+03  1.33585714e+03
  2.84254850e+03  3.02829279e+03  3.02829279e+03  3.02829279e+03
  6.64743620e+03  6.64743620e+03  6.64743620e+03  9.24306669e+03
  2.55897525e+04  7.63200838e+04]
E1 = -728.2974497782096  E_coul = 201.5439491728039
cycle= 5 E= -526.753500605406  delta_E= -2.07e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93209e-05
diis-c [-9.58214902e-11  1.28235506e-05 -1.75924163e-03 -1.26680350e-02
  3.45291301e-02  9.79885323e-01]
  HOMO = -0.583040839194285  LUMO = 0.919145915490275
  mo_energy =
[-1.18584841e+02 -1.23125215e+01 -9.56264548e+00 -9.56264548e+00
 -9.56264548e+00 -1.27031579e+00 -5.83040839e-01 -5.83040839e-01
 -5.83040839e-01  9.19145915e-01  1.02613607e+00  1.02613607e+00
  1.02613607e+00  7.48559614e+00  7.48559614e+00  7.48559614e+00
  9.73193599e+00  3.43589964e+01  3.43589964e+01  3.43589964e+01
  5.18117598e+01  1.31003273e+02  1.31003273e+02  1.31003273e+02
  2.06157803e+02  4.85347636e+02  4.85347636e+02  4.85347636e+02
  7.49342355e+02  1.33585711e+03  1.33585711e+03  1.33585711e+03
  2.84254846e+03  3.02829276e+03  3.02829276e+03  3.02829276e+03
  6.64743617e+03  6.64743617e+03  6.64743617e+03  9.24306666e+03
  2.55897525e+04  7.63200837e+04]
E1 = -728.2975336642235  E_coul = 201.54403305875584
cycle= 6 E= -526.753500605468  delta_E= -6.18e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2975336642235  E_coul = 201.54403305875584
  HOMO = -0.583040730152142  LUMO = 0.919146349658335
  mo_energy =
[-1.18584841e+02 -1.23125209e+01 -9.56264493e+00 -9.56264493e+00
 -9.56264493e+00 -1.27031526e+00 -5.83040730e-01 -5.83040730e-01
 -5.83040730e-01  9.19146350e-01  1.02613621e+00  1.02613621e+00
  1.02613621e+00  7.48559651e+00  7.48559651e+00  7.48559651e+00
  9.73193654e+00  3.43589969e+01  3.43589969e+01  3.43589969e+01
  5.18117605e+01  1.31003274e+02  1.31003274e+02  1.31003274e+02
  2.06157804e+02  4.85347637e+02  4.85347637e+02  4.85347637e+02
  7.49342355e+02  1.33585711e+03  1.33585711e+03  1.33585711e+03
  2.84254846e+03  3.02829276e+03  3.02829276e+03  3.02829276e+03
  6.64743617e+03  6.64743617e+03  6.64743617e+03  9.24306666e+03
  2.55897525e+04  7.63200837e+04]
E1 = -728.2975307680551  E_coul = 201.5440301625874
Extra cycle  E= -526.753500605468  delta_E= -1.14e-13  |g|= 3.9e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
exp = [2.61826988e+04 7.61742132e+03 3.61738868e+03 1.59558646e+03
 3.89219442e+02 1.26092642e+02 4.83268664e+01 1.86597086e+01
 7.13433599e+00 6.48995930e-01 2.85093148e+00 2.31367063e-01
 1.36279743e+03 6.64608269e+02 3.00315111e+02 3.13484765e+02
 6.18191511e+01 7.51762705e+00 2.05893730e+01 7.83067287e-01
 2.88326959e+00 2.24127013e-01]
E = -526.7535006054677
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:36 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6987558        1
[INPUT] 0    0    [1    /1   ]  7617.42132315        1
[INPUT] 0    0    [1    /1   ]  3617.38867756        1
[INPUT] 0    0    [1    /1   ]  1595.58646001        1
[INPUT] 0    0    [1    /1   ]  389.21944242         1
[INPUT] 0    0    [1    /1   ]  126.092642341        1
[INPUT] 0    0    [1    /1   ]  48.3268664063        1
[INPUT] 0    0    [1    /1   ]  18.6597085711        1
[INPUT] 0    0    [1    /1   ]  7.13433598951        1
[INPUT] 0    0    [1    /1   ]  0.648995929905       1
[INPUT] 0    0    [1    /1   ]  2.8509314814         1
[INPUT] 0    0    [1    /1   ]  0.231367062996       1
[INPUT] 1    0    [1    /1   ]  1362.79743118        1
[INPUT] 1    0    [1    /1   ]  664.608268928        1
[INPUT] 1    0    [1    /1   ]  300.315110561        1
[INPUT] 1    0    [1    /1   ]  313.48476542         1
[INPUT] 1    0    [1    /1   ]  61.819151091         1
[INPUT] 1    0    [1    /1   ]  7.51762705397        1
[INPUT] 1    0    [1    /1   ]  20.5893729532        1
[INPUT] 1    0    [1    /1   ]  0.783067286946       1
[INPUT] 1    0    [1    /1   ]  2.88326959447        1
[INPUT] 1    0    [1    /1   ]  0.22412701259        1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69875578775, 1.0]], [0, [7617.421323151872, 1.0]], [0, [3617.3886775606015, 1.0]], [0, [1595.586460006425, 1.0]], [0, [389.21944241982317, 1.0]], [0, [126.09264234139926, 1.0]], [0, [48.32686640632553, 1.0]], [0, [18.65970857105665, 1.0]], [0, [7.134335989509243, 1.0]], [0, [0.6489959299053603, 1.0]], [0, [2.8509314814032876, 1.0]], [0, [0.2313670629964152, 1.0]], [1, [1362.7974311753826, 1.0]], [1, [664.6082689276151, 1.0]], [1, [300.31511056140056, 1.0]], [1, [313.4847654196199, 1.0]], [1, [61.81915109097747, 1.0]], [1, [7.517627053974473, 1.0]], [1, [20.58937295321291, 1.0]], [1, [0.7830672869457298, 1.0]], [1, [2.8832695944673215, 1.0]], [1, [0.22412701259014572, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69875579]
bas 1, expnt(s) = [7617.42132315]
bas 2, expnt(s) = [3617.38867756]
bas 3, expnt(s) = [1595.58646001]
bas 4, expnt(s) = [389.21944242]
bas 5, expnt(s) = [126.09264234]
bas 6, expnt(s) = [48.32686641]
bas 7, expnt(s) = [18.65970857]
bas 8, expnt(s) = [7.13433599]
bas 9, expnt(s) = [0.64899593]
bas 10, expnt(s) = [2.85093148]
bas 11, expnt(s) = [0.23136706]
bas 12, expnt(s) = [1362.79743118]
bas 13, expnt(s) = [664.60826893]
bas 14, expnt(s) = [300.31511056]
bas 15, expnt(s) = [313.48476542]
bas 16, expnt(s) = [61.81915109]
bas 17, expnt(s) = [7.51762705]
bas 18, expnt(s) = [20.58937295]
bas 19, expnt(s) = [0.78306729]
bas 20, expnt(s) = [2.88326959]
bas 21, expnt(s) = [0.22412701]
CPU time:       471.52
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826988e+04 5.20026926e+03 7.61742132e+03 2.06001796e+03
 3.61738868e+03 1.17845066e+03 1.59558646e+03 6.37830497e+02
 3.89219442e+02 2.21391488e+02 1.26092642e+02 9.50675569e+01
 4.83268664e+01 4.63080508e+01 1.86597086e+01 2.26826435e+01
 7.13433599e+00 1.10288491e+01 6.48995930e-01 1.82682314e+00
 2.85093148e+00 5.54313057e+00 2.31367063e-01 8.42832307e-01
 1.36279743e+03 2.41559168e+04 6.64608269e+02 9.84445250e+03
 3.00315111e+02 3.64716888e+03 3.13484765e+02 3.84817614e+03
 6.18191511e+01 5.05694452e+02 7.51762705e+00 3.63149427e+01
 2.05893730e+01 1.27949412e+02 7.83067287e-01 2.14898431e+00
 2.88326959e+00 1.09607673e+01 2.24127013e-01 4.49885655e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993534394647888
cond(S) = 113496.54445408151
E1 = -729.5452386311665  E_coul = 203.17578968590524
init E= -526.369448945261
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555709761418571  LUMO = 0.938732328541506
  mo_energy =
[-1.18334124e+02 -1.22068364e+01 -9.44717606e+00 -9.44717606e+00
 -9.44717606e+00 -1.24023157e+00 -5.55709761e-01 -5.55709761e-01
 -5.55709761e-01  9.38732329e-01  1.04511403e+00  1.04511403e+00
  1.04511403e+00  7.55774630e+00  7.55774630e+00  7.55774630e+00
  9.80471805e+00  3.44808286e+01  3.44808286e+01  3.44808286e+01
  5.19369569e+01  1.31184755e+02  1.31184755e+02  1.31184755e+02
  2.06350494e+02  4.85597741e+02  4.85597741e+02  4.85597741e+02
  7.49632953e+02  1.33616031e+03  1.33616031e+03  1.33616031e+03
  2.84298119e+03  3.02865978e+03  3.02865978e+03  3.02865978e+03
  6.64791523e+03  6.64791523e+03  6.64791523e+03  9.24361891e+03
  2.55903995e+04  7.63208213e+04]
E1 = -727.8500310496394  E_coul = 201.0973186969505
cycle= 1 E= -526.752712352689  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.571507
diis-c [-0.32661984  1.        ]
  HOMO = -0.590663345291723  LUMO = 0.912707601616325
  mo_energy =
[-1.18642817e+02 -1.23448905e+01 -9.59630560e+00 -9.59630560e+00
 -9.59630560e+00 -1.27958303e+00 -5.90663345e-01 -5.90663345e-01
 -5.90663345e-01  9.12707602e-01  1.02039840e+00  1.02039840e+00
  1.02039840e+00  7.46524762e+00  7.46524762e+00  7.46524762e+00
  9.71000061e+00  3.43247289e+01  3.43247289e+01  3.43247289e+01
  5.17749141e+01  1.30955504e+02  1.30955504e+02  1.30955504e+02
  2.06107271e+02  4.85290384e+02  4.85290384e+02  4.85290384e+02
  7.49283030e+02  1.33579639e+03  1.33579639e+03  1.33579639e+03
  2.84248517e+03  3.02823019e+03  3.02823019e+03  3.02823019e+03
  6.64737225e+03  6.64737225e+03  6.64737225e+03  9.24300218e+03
  2.55896876e+04  7.63200187e+04]
E1 = -728.4254997812322  E_coul = 201.672060395964
cycle= 2 E= -526.753439385268  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0532
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0773393
diis-c [-0.003784    0.07621346  0.92378654]
  HOMO = -0.581488287949691  LUMO = 0.920313920391163
  mo_energy =
[-1.18574397e+02 -1.23064879e+01 -9.55623089e+00 -9.55623089e+00
 -9.55623089e+00 -1.26859269e+00 -5.81488288e-01 -5.81488288e-01
 -5.81488288e-01  9.20313920e-01  1.02726976e+00  1.02726976e+00
  1.02726976e+00  7.48957762e+00  7.48957762e+00  7.48957762e+00
  9.73608388e+00  3.43654764e+01  3.43654764e+01  3.43654764e+01
  5.18185975e+01  1.31012014e+02  1.31012014e+02  1.31012014e+02
  2.06166977e+02  4.85357956e+02  4.85357956e+02  4.85357956e+02
  7.49353080e+02  1.33586806e+03  1.33586806e+03  1.33586806e+03
  2.84256008e+03  3.02830413e+03  3.02830413e+03  3.02830413e+03
  6.64744796e+03  6.64744796e+03  6.64744796e+03  9.24307868e+03
  2.55897647e+04  7.63200961e+04]
E1 = -728.2738596783444  E_coul = 201.5203611782332
cycle= 3 E= -526.753498500111  delta_E= -5.91e-05  |g|= 0.00661  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0140678
diis-c [-8.27897756e-07 -1.28632714e-03  1.49495511e-01  8.51790816e-01]
  HOMO = -0.58305170745348  LUMO = 0.919115649172635
  mo_energy =
[-1.18584858e+02 -1.23125674e+01 -9.56267521e+00 -9.56267521e+00
 -9.56267521e+00 -1.27035319e+00 -5.83051707e-01 -5.83051707e-01
 -5.83051707e-01  9.19115649e-01  1.02612481e+00  1.02612481e+00
  1.02612481e+00  7.48556950e+00  7.48556950e+00  7.48556950e+00
  9.73189283e+00  3.43589677e+01  3.43589677e+01  3.43589677e+01
  5.18117236e+01  1.31003248e+02  1.31003248e+02  1.31003248e+02
  2.06157778e+02  4.85347619e+02  4.85347619e+02  4.85347619e+02
  7.49342347e+02  1.33585710e+03  1.33585710e+03  1.33585710e+03
  2.84254848e+03  3.02829276e+03  3.02829276e+03  3.02829276e+03
  6.64743619e+03  6.64743619e+03  6.64743619e+03  9.24306669e+03
  2.55897525e+04  7.63200838e+04]
E1 = -728.2976882167495  E_coul = 201.54418761341685
cycle= 4 E= -526.753500603333  delta_E= -2.1e-06  |g|= 0.000107  |ddm|= 0.00234
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119567
diis-c [-5.14545922e-09  8.77472405e-05 -1.24816155e-02 -7.53938985e-02
  1.08778777e+00]
  HOMO = -0.583032973781187  LUMO = 0.919149745153315
  mo_energy =
[-1.18584810e+02 -1.23124979e+01 -9.56261993e+00 -9.56261993e+00
 -9.56261993e+00 -1.27030952e+00 -5.83032974e-01 -5.83032974e-01
 -5.83032974e-01  9.19149745e-01  1.02614138e+00  1.02614138e+00
  1.02614138e+00  7.48561377e+00  7.48561377e+00  7.48561377e+00
  9.73195317e+00  3.43590212e+01  3.43590212e+01  3.43590212e+01
  5.18117852e+01  1.31003302e+02  1.31003302e+02  1.31003302e+02
  2.06157833e+02  4.85347668e+02  4.85347668e+02  4.85347668e+02
  7.49342387e+02  1.33585714e+03  1.33585714e+03  1.33585714e+03
  2.84254850e+03  3.02829279e+03  3.02829279e+03  3.02829279e+03
  6.64743620e+03  6.64743620e+03  6.64743620e+03  9.24306669e+03
  2.55897525e+04  7.63200838e+04]
E1 = -728.2974497782096  E_coul = 201.5439491728039
cycle= 5 E= -526.753500605406  delta_E= -2.07e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93209e-05
diis-c [-9.58214902e-11  1.28235506e-05 -1.75924163e-03 -1.26680350e-02
  3.45291301e-02  9.79885323e-01]
  HOMO = -0.583040839194285  LUMO = 0.919145915490275
  mo_energy =
[-1.18584841e+02 -1.23125215e+01 -9.56264548e+00 -9.56264548e+00
 -9.56264548e+00 -1.27031579e+00 -5.83040839e-01 -5.83040839e-01
 -5.83040839e-01  9.19145915e-01  1.02613607e+00  1.02613607e+00
  1.02613607e+00  7.48559614e+00  7.48559614e+00  7.48559614e+00
  9.73193599e+00  3.43589964e+01  3.43589964e+01  3.43589964e+01
  5.18117598e+01  1.31003273e+02  1.31003273e+02  1.31003273e+02
  2.06157803e+02  4.85347636e+02  4.85347636e+02  4.85347636e+02
  7.49342355e+02  1.33585711e+03  1.33585711e+03  1.33585711e+03
  2.84254846e+03  3.02829276e+03  3.02829276e+03  3.02829276e+03
  6.64743617e+03  6.64743617e+03  6.64743617e+03  9.24306666e+03
  2.55897525e+04  7.63200837e+04]
E1 = -728.2975336642235  E_coul = 201.54403305875584
cycle= 6 E= -526.753500605468  delta_E= -6.18e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2975336642235  E_coul = 201.54403305875584
  HOMO = -0.583040730152142  LUMO = 0.919146349658335
  mo_energy =
[-1.18584841e+02 -1.23125209e+01 -9.56264493e+00 -9.56264493e+00
 -9.56264493e+00 -1.27031526e+00 -5.83040730e-01 -5.83040730e-01
 -5.83040730e-01  9.19146350e-01  1.02613621e+00  1.02613621e+00
  1.02613621e+00  7.48559651e+00  7.48559651e+00  7.48559651e+00
  9.73193654e+00  3.43589969e+01  3.43589969e+01  3.43589969e+01
  5.18117605e+01  1.31003274e+02  1.31003274e+02  1.31003274e+02
  2.06157804e+02  4.85347637e+02  4.85347637e+02  4.85347637e+02
  7.49342355e+02  1.33585711e+03  1.33585711e+03  1.33585711e+03
  2.84254846e+03  3.02829276e+03  3.02829276e+03  3.02829276e+03
  6.64743617e+03  6.64743617e+03  6.64743617e+03  9.24306666e+03
  2.55897525e+04  7.63200837e+04]
E1 = -728.2975307680551  E_coul = 201.5440301625874
Extra cycle  E= -526.753500605468  delta_E= -1.14e-13  |g|= 3.9e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113496.54445408151
E1 = -728.2975307680551  E_coul = 201.5440301625874
init E= -526.753500605468
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583040801587052  LUMO = 0.919146364260257
  mo_energy =
[-1.18584841e+02 -1.23125211e+01 -9.56264516e+00 -9.56264516e+00
 -9.56264516e+00 -1.27031526e+00 -5.83040802e-01 -5.83040802e-01
 -5.83040802e-01  9.19146364e-01  1.02613617e+00  1.02613617e+00
  1.02613617e+00  7.48559636e+00  7.48559636e+00  7.48559636e+00
  9.73193642e+00  3.43589967e+01  3.43589967e+01  3.43589967e+01
  5.18117603e+01  1.31003274e+02  1.31003274e+02  1.31003274e+02
  2.06157804e+02  4.85347637e+02  4.85347637e+02  4.85347637e+02
  7.49342355e+02  1.33585711e+03  1.33585711e+03  1.33585711e+03
  2.84254846e+03  3.02829276e+03  3.02829276e+03  3.02829276e+03
  6.64743617e+03  6.64743617e+03  6.64743617e+03  9.24306666e+03
  2.55897525e+04  7.63200837e+04]
E1 = -728.2975314308281  E_coul = 201.54403082536
cycle= 1 E= -526.753500605468  delta_E= -4.55e-13  |g|= 8.97e-08  |ddm|= 6.07e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2975314308281  E_coul = 201.54403082536
  HOMO = -0.583040792149487  LUMO = 0.919146386562376
  mo_energy =
[-1.18584841e+02 -1.23125210e+01 -9.56264512e+00 -9.56264512e+00
 -9.56264512e+00 -1.27031523e+00 -5.83040792e-01 -5.83040792e-01
 -5.83040792e-01  9.19146387e-01  1.02613618e+00  1.02613618e+00
  1.02613618e+00  7.48559639e+00  7.48559639e+00  7.48559639e+00
  9.73193646e+00  3.43589967e+01  3.43589967e+01  3.43589967e+01
  5.18117603e+01  1.31003274e+02  1.31003274e+02  1.31003274e+02
  2.06157804e+02  4.85347637e+02  4.85347637e+02  4.85347637e+02
  7.49342355e+02  1.33585711e+03  1.33585711e+03  1.33585711e+03
  2.84254846e+03  3.02829276e+03  3.02829276e+03  3.02829276e+03
  6.64743617e+03  6.64743617e+03  6.64743617e+03  9.24306666e+03
  2.55897525e+04  7.63200837e+04]
E1 = -728.2975312135482  E_coul = 201.54403060807985
Extra cycle  E= -526.753500605468  delta_E= -1.14e-13  |g|= 1.95e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.44 sec
exp = [2.61826988e+04 7.61742132e+03 3.61738868e+03 1.59558646e+03
 3.89219442e+02 1.26092642e+02 4.83268664e+01 1.86597086e+01
 7.13433599e+00 6.48995930e-01 2.85093148e+00 2.31367063e-01
 1.36279743e+03 6.64608269e+02 3.00315111e+02 3.13484765e+02
 6.18191511e+01 7.51762705e+00 2.05893730e+01 7.83067287e-01
 2.88326959e+00 2.24127013e-01]
grad_E = [-1.57168035e-06  3.94070505e-06 -1.19256090e-06  9.38986554e-05
 -5.83122999e-04  2.54388718e-04  2.21275576e-04 -3.20299248e-04
 -1.37641540e-04 -6.91034832e-05  1.86224185e-04 -2.59618851e-04
 -4.90110318e-07  5.27829890e-06  2.53379836e-05  2.18036939e-05
 -2.04508337e-04  2.71237558e-04  4.92122686e-04  1.29059198e-04
  2.79198206e-04 -3.29672370e-04]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:40 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6997897        1
[INPUT] 0    0    [1    /1   ]  7617.41889955        1
[INPUT] 0    0    [1    /1   ]  3617.3895911         1
[INPUT] 0    0    [1    /1   ]  1595.53249727        1
[INPUT] 0    0    [1    /1   ]  389.37532259         1
[INPUT] 0    0    [1    /1   ]  126.497616432        1
[INPUT] 0    0    [1    /1   ]  48.7208716512        1
[INPUT] 0    0    [1    /1   ]  18.9652447686        1
[INPUT] 0    0    [1    /1   ]  7.16571766614        1
[INPUT] 0    0    [1    /1   ]  0.648632367106       1
[INPUT] 0    0    [1    /1   ]  2.85741372757        1
[INPUT] 0    0    [1    /1   ]  0.231391423699       1
[INPUT] 1    0    [1    /1   ]  1362.7977737         1
[INPUT] 1    0    [1    /1   ]  664.604953092        1
[INPUT] 1    0    [1    /1   ]  300.299495876        1
[INPUT] 1    0    [1    /1   ]  313.471308137        1
[INPUT] 1    0    [1    /1   ]  61.8257451593        1
[INPUT] 1    0    [1    /1   ]  7.51797509377        1
[INPUT] 1    0    [1    /1   ]  20.5938727199        1
[INPUT] 1    0    [1    /1   ]  0.782963404725       1
[INPUT] 1    0    [1    /1   ]  2.88229870528        1
[INPUT] 1    0    [1    /1   ]  0.224108432954       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69978968858, 1.0]], [0, [7617.4188995476, 1.0]], [0, [3617.389591097945, 1.0]], [0, [1595.532497274433, 1.0]], [0, [389.375322590406, 1.0]], [0, [126.49761643178628, 1.0]], [0, [48.72087165122306, 1.0]], [0, [18.965244768562503, 1.0]], [0, [7.165717666136401, 1.0]], [0, [0.6486323671055471, 1.0]], [0, [2.85741372756506, 1.0]], [0, [0.23139142369934954, 1.0]], [1, [1362.797773702343, 1.0]], [1, [664.6049530916684, 1.0]], [1, [300.29949587622684, 1.0]], [1, [313.471308137391, 1.0]], [1, [61.825745159328, 1.0]], [1, [7.517975093769741, 1.0]], [1, [20.593872719875126, 1.0]], [1, [0.7829634047253213, 1.0]], [1, [2.8822987052828415, 1.0]], [1, [0.22410843295435037, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69978969]
bas 1, expnt(s) = [7617.41889955]
bas 2, expnt(s) = [3617.3895911]
bas 3, expnt(s) = [1595.53249727]
bas 4, expnt(s) = [389.37532259]
bas 5, expnt(s) = [126.49761643]
bas 6, expnt(s) = [48.72087165]
bas 7, expnt(s) = [18.96524477]
bas 8, expnt(s) = [7.16571767]
bas 9, expnt(s) = [0.64863237]
bas 10, expnt(s) = [2.85741373]
bas 11, expnt(s) = [0.23139142]
bas 12, expnt(s) = [1362.7977737]
bas 13, expnt(s) = [664.60495309]
bas 14, expnt(s) = [300.29949588]
bas 15, expnt(s) = [313.47130814]
bas 16, expnt(s) = [61.82574516]
bas 17, expnt(s) = [7.51797509]
bas 18, expnt(s) = [20.59387272]
bas 19, expnt(s) = [0.7829634]
bas 20, expnt(s) = [2.88229871]
bas 21, expnt(s) = [0.22410843]
CPU time:       477.06
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826998e+04 5.20026941e+03 7.61741890e+03 2.06001747e+03
 3.61738959e+03 1.17845089e+03 1.59553250e+03 6.37814319e+02
 3.89375323e+02 2.21457984e+02 1.26497616e+02 9.52964628e+01
 4.87208717e+01 4.65909227e+01 1.89652448e+01 2.29606333e+01
 7.16571767e+00 1.10652134e+01 6.48632367e-01 1.82605556e+00
 2.85741373e+00 5.55258057e+00 2.31391424e-01 8.42898863e-01
 1.36279777e+03 2.41559244e+04 6.64604953e+02 9.84439111e+03
 3.00299496e+02 3.64693184e+03 3.13471308e+02 3.84796965e+03
 6.18257452e+01 5.05761879e+02 7.51797509e+00 3.63170443e+01
 2.05938727e+01 1.27984366e+02 7.82963405e-01 2.14862796e+00
 2.88229871e+00 1.09561539e+01 2.24108433e-01 4.49839037e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993537749374646
cond(S) = 113504.48246367302
E1 = -729.5451697304317  E_coul = 203.17573212087945
init E= -526.369437609552
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555711155646409  LUMO = 0.938779158325616
  mo_energy =
[-1.18334146e+02 -1.22068292e+01 -9.44718041e+00 -9.44718041e+00
 -9.44718041e+00 -1.24023092e+00 -5.55711156e-01 -5.55711156e-01
 -5.55711156e-01  9.38779158e-01  1.04494404e+00  1.04494404e+00
  1.04494404e+00  7.55568813e+00  7.55568813e+00  7.55568813e+00
  9.85789942e+00  3.44807137e+01  3.44807137e+01  3.44807137e+01
  5.25676248e+01  1.31200518e+02  1.31200518e+02  1.31200518e+02
  2.08506726e+02  4.85618809e+02  4.85618809e+02  4.85618809e+02
  7.53443554e+02  1.33615339e+03  1.33615339e+03  1.33615339e+03
  2.84750851e+03  3.02861125e+03  3.02861125e+03  3.02861125e+03
  6.64783742e+03  6.64783742e+03  6.64783742e+03  9.24806124e+03
  2.55946340e+04  7.63247666e+04]
E1 = -727.8498451846557  E_coul = 201.09712767855365
cycle= 1 E= -526.752717506102  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.572068
diis-c [-0.32726173  1.        ]
  HOMO = -0.590657628227086  LUMO = 0.912744634912292
  mo_energy =
[-1.18642869e+02 -1.23448971e+01 -9.59632705e+00 -9.59632705e+00
 -9.59632705e+00 -1.27957604e+00 -5.90657628e-01 -5.90657628e-01
 -5.90657628e-01  9.12744635e-01  1.02023709e+00  1.02023709e+00
  1.02023709e+00  7.46319699e+00  7.46319699e+00  7.46319699e+00
  9.76285141e+00  3.43245897e+01  3.43245897e+01  3.43245897e+01
  5.24047835e+01  1.30971230e+02  1.30971230e+02  1.30971230e+02
  2.08262939e+02  4.85311429e+02  4.85311429e+02  4.85311429e+02
  7.53093459e+02  1.33578943e+03  1.33578943e+03  1.33578943e+03
  2.84701249e+03  3.02818162e+03  3.02818162e+03  3.02818162e+03
  6.64729440e+03  6.64729440e+03  6.64729440e+03  9.24744451e+03
  2.55939221e+04  7.63239639e+04]
E1 = -728.4253467375371  E_coul = 201.67190211846088
cycle= 2 E= -526.753444619076  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0532
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0773523
diis-c [-0.0037922   0.07604537  0.92395463]
  HOMO = -0.581479506028957  LUMO = 0.920357350522161
  mo_energy =
[-1.18574432e+02 -1.23064857e+01 -9.55624359e+00 -9.55624359e+00
 -9.55624359e+00 -1.26858242e+00 -5.81479506e-01 -5.81479506e-01
 -5.81479506e-01  9.20357351e-01  1.02710927e+00  1.02710927e+00
  1.02710927e+00  7.48753028e+00  7.48753028e+00  7.48753028e+00
  9.78903555e+00  3.43653490e+01  3.43653490e+01  3.43653490e+01
  5.24486678e+01  1.31027754e+02  1.31027754e+02  1.31027754e+02
  2.08322746e+02  4.85379016e+02  4.85379016e+02  4.85379016e+02
  7.53163534e+02  1.33586112e+03  1.33586112e+03  1.33586112e+03
  2.84708742e+03  3.02825559e+03  3.02825559e+03  3.02825559e+03
  6.64737013e+03  6.64737013e+03  6.64737013e+03  9.24752102e+03
  2.55939992e+04  7.63240413e+04]
E1 = -728.27368581944  E_coul = 201.52018209243252
cycle= 3 E= -526.753503727007  delta_E= -5.91e-05  |g|= 0.00662  |ddm|= 0.0163
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0140852
diis-c [-8.28093388e-07 -1.28666831e-03  1.49639664e-01  8.51647004e-01]
  HOMO = -0.58304439009077  LUMO = 0.919157130491488
  mo_energy =
[-1.18584906e+02 -1.23125716e+01 -9.56269466e+00 -9.56269466e+00
 -9.56269466e+00 -1.27034479e+00 -5.83044390e-01 -5.83044390e-01
 -5.83044390e-01  9.19157130e-01  1.02596342e+00  1.02596342e+00
  1.02596342e+00  7.48351860e+00  7.48351860e+00  7.48351860e+00
  9.78482592e+00  3.43588330e+01  3.43588330e+01  3.43588330e+01
  5.24417586e+01  1.31018978e+02  1.31018978e+02  1.31018978e+02
  2.08313525e+02  4.85368668e+02  4.85368668e+02  4.85368668e+02
  7.53152787e+02  1.33585015e+03  1.33585015e+03  1.33585015e+03
  2.84707581e+03  3.02824421e+03  3.02824421e+03  3.02824421e+03
  6.64735834e+03  6.64735834e+03  6.64735834e+03  9.24750902e+03
  2.55939870e+04  7.63240290e+04]
E1 = -728.2975384277378  E_coul = 201.54403259330752
cycle= 4 E= -526.75350583443  delta_E= -2.11e-06  |g|= 0.000107  |ddm|= 0.00234
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.00011944
diis-c [-5.12266030e-09  8.75547201e-05 -1.24609617e-02 -7.52008386e-02
  1.08757425e+00]
  HOMO = -0.583025672667411  LUMO = 0.919191194854618
  mo_energy =
[-1.18584857e+02 -1.23125022e+01 -9.56263947e+00 -9.56263947e+00
 -9.56263947e+00 -1.27030118e+00 -5.83025673e-01 -5.83025673e-01
 -5.83025673e-01  9.19191195e-01  1.02597997e+00  1.02597997e+00
  1.02597997e+00  7.48356282e+00  7.48356282e+00  7.48356282e+00
  9.78488629e+00  3.43588865e+01  3.43588865e+01  3.43588865e+01
  5.24418200e+01  1.31019033e+02  1.31019033e+02  1.31019033e+02
  2.08313579e+02  4.85368717e+02  4.85368717e+02  4.85368717e+02
  7.53152827e+02  1.33585019e+03  1.33585019e+03  1.33585019e+03
  2.84707582e+03  3.02824424e+03  3.02824424e+03  3.02824424e+03
  6.64735835e+03  6.64735835e+03  6.64735835e+03  9.24750903e+03
  2.55939870e+04  7.63240290e+04]
E1 = -728.2973004099963  E_coul = 201.54379457350052
cycle= 5 E= -526.753505836496  delta_E= -2.07e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93025e-05
diis-c [-9.55361087e-11  1.28083694e-05 -1.76008503e-03 -1.26573328e-02
  3.45842651e-02  9.79820344e-01]
  HOMO = -0.583033527715376  LUMO = 0.919187369657189
  mo_energy =
[-1.18584889e+02 -1.23125258e+01 -9.56266498e+00 -9.56266498e+00
 -9.56266498e+00 -1.27030744e+00 -5.83033528e-01 -5.83033528e-01
 -5.83033528e-01  9.19187370e-01  1.02597468e+00  1.02597468e+00
  1.02597468e+00  7.48354521e+00  7.48354521e+00  7.48354521e+00
  9.78486909e+00  3.43588616e+01  3.43588616e+01  3.43588616e+01
  5.24417946e+01  1.31019004e+02  1.31019004e+02  1.31019004e+02
  2.08313549e+02  4.85368685e+02  4.85368685e+02  4.85368685e+02
  7.53152795e+02  1.33585016e+03  1.33585016e+03  1.33585016e+03
  2.84707579e+03  3.02824420e+03  3.02824420e+03  3.02824420e+03
  6.64735832e+03  6.64735832e+03  6.64735832e+03  9.24750899e+03
  2.55939869e+04  7.63240290e+04]
E1 = -728.2973841776009  E_coul = 201.5438783410424
cycle= 6 E= -526.753505836558  delta_E= -6.26e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2973841776009  E_coul = 201.5438783410424
  HOMO = -0.583033420510291  LUMO = 0.919187802849817
  mo_energy =
[-1.18584888e+02 -1.23125252e+01 -9.56266444e+00 -9.56266444e+00
 -9.56266444e+00 -1.27030691e+00 -5.83033421e-01 -5.83033421e-01
 -5.83033421e-01  9.19187803e-01  1.02597481e+00  1.02597481e+00
  1.02597481e+00  7.48354558e+00  7.48354558e+00  7.48354558e+00
  9.78486964e+00  3.43588622e+01  3.43588622e+01  3.43588622e+01
  5.24417953e+01  1.31019004e+02  1.31019004e+02  1.31019004e+02
  2.08313550e+02  4.85368686e+02  4.85368686e+02  4.85368686e+02
  7.53152796e+02  1.33585016e+03  1.33585016e+03  1.33585016e+03
  2.84707579e+03  3.02824420e+03  3.02824420e+03  3.02824420e+03
  6.64735832e+03  6.64735832e+03  6.64735832e+03  9.24750899e+03
  2.55939869e+04  7.63240290e+04]
E1 = -728.2973813023829  E_coul = 201.5438754658241
Extra cycle  E= -526.753505836559  delta_E= -3.41e-13  |g|= 3.9e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
exp = [2.61826998e+04 7.61741890e+03 3.61738959e+03 1.59553250e+03
 3.89375323e+02 1.26497616e+02 4.87208717e+01 1.89652448e+01
 7.16571767e+00 6.48632367e-01 2.85741373e+00 2.31391424e-01
 1.36279777e+03 6.64604953e+02 3.00299496e+02 3.13471308e+02
 6.18257452e+01 7.51797509e+00 2.05938727e+01 7.82963405e-01
 2.88229871e+00 2.24108433e-01]
E = -526.7535058365588
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:41 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.6997897        1
[INPUT] 0    0    [1    /1   ]  7617.41889955        1
[INPUT] 0    0    [1    /1   ]  3617.3895911         1
[INPUT] 0    0    [1    /1   ]  1595.53249727        1
[INPUT] 0    0    [1    /1   ]  389.37532259         1
[INPUT] 0    0    [1    /1   ]  126.497616432        1
[INPUT] 0    0    [1    /1   ]  48.7208716512        1
[INPUT] 0    0    [1    /1   ]  18.9652447686        1
[INPUT] 0    0    [1    /1   ]  7.16571766614        1
[INPUT] 0    0    [1    /1   ]  0.648632367106       1
[INPUT] 0    0    [1    /1   ]  2.85741372757        1
[INPUT] 0    0    [1    /1   ]  0.231391423699       1
[INPUT] 1    0    [1    /1   ]  1362.7977737         1
[INPUT] 1    0    [1    /1   ]  664.604953092        1
[INPUT] 1    0    [1    /1   ]  300.299495876        1
[INPUT] 1    0    [1    /1   ]  313.471308137        1
[INPUT] 1    0    [1    /1   ]  61.8257451593        1
[INPUT] 1    0    [1    /1   ]  7.51797509377        1
[INPUT] 1    0    [1    /1   ]  20.5938727199        1
[INPUT] 1    0    [1    /1   ]  0.782963404725       1
[INPUT] 1    0    [1    /1   ]  2.88229870528        1
[INPUT] 1    0    [1    /1   ]  0.224108432954       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.69978968858, 1.0]], [0, [7617.4188995476, 1.0]], [0, [3617.389591097945, 1.0]], [0, [1595.532497274433, 1.0]], [0, [389.375322590406, 1.0]], [0, [126.49761643178628, 1.0]], [0, [48.72087165122306, 1.0]], [0, [18.965244768562503, 1.0]], [0, [7.165717666136401, 1.0]], [0, [0.6486323671055471, 1.0]], [0, [2.85741372756506, 1.0]], [0, [0.23139142369934954, 1.0]], [1, [1362.797773702343, 1.0]], [1, [664.6049530916684, 1.0]], [1, [300.29949587622684, 1.0]], [1, [313.471308137391, 1.0]], [1, [61.825745159328, 1.0]], [1, [7.517975093769741, 1.0]], [1, [20.593872719875126, 1.0]], [1, [0.7829634047253213, 1.0]], [1, [2.8822987052828415, 1.0]], [1, [0.22410843295435037, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.69978969]
bas 1, expnt(s) = [7617.41889955]
bas 2, expnt(s) = [3617.3895911]
bas 3, expnt(s) = [1595.53249727]
bas 4, expnt(s) = [389.37532259]
bas 5, expnt(s) = [126.49761643]
bas 6, expnt(s) = [48.72087165]
bas 7, expnt(s) = [18.96524477]
bas 8, expnt(s) = [7.16571767]
bas 9, expnt(s) = [0.64863237]
bas 10, expnt(s) = [2.85741373]
bas 11, expnt(s) = [0.23139142]
bas 12, expnt(s) = [1362.7977737]
bas 13, expnt(s) = [664.60495309]
bas 14, expnt(s) = [300.29949588]
bas 15, expnt(s) = [313.47130814]
bas 16, expnt(s) = [61.82574516]
bas 17, expnt(s) = [7.51797509]
bas 18, expnt(s) = [20.59387272]
bas 19, expnt(s) = [0.7829634]
bas 20, expnt(s) = [2.88229871]
bas 21, expnt(s) = [0.22410843]
CPU time:       477.54
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61826998e+04 5.20026941e+03 7.61741890e+03 2.06001747e+03
 3.61738959e+03 1.17845089e+03 1.59553250e+03 6.37814319e+02
 3.89375323e+02 2.21457984e+02 1.26497616e+02 9.52964628e+01
 4.87208717e+01 4.65909227e+01 1.89652448e+01 2.29606333e+01
 7.16571767e+00 1.10652134e+01 6.48632367e-01 1.82605556e+00
 2.85741373e+00 5.55258057e+00 2.31391424e-01 8.42898863e-01
 1.36279777e+03 2.41559244e+04 6.64604953e+02 9.84439111e+03
 3.00299496e+02 3.64693184e+03 3.13471308e+02 3.84796965e+03
 6.18257452e+01 5.05761879e+02 7.51797509e+00 3.63170443e+01
 2.05938727e+01 1.27984366e+02 7.82963405e-01 2.14862796e+00
 2.88229871e+00 1.09561539e+01 2.24108433e-01 4.49839037e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993537749374646
cond(S) = 113504.48246367302
E1 = -729.5451697304317  E_coul = 203.17573212087945
init E= -526.369437609552
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555711155646409  LUMO = 0.938779158325616
  mo_energy =
[-1.18334146e+02 -1.22068292e+01 -9.44718041e+00 -9.44718041e+00
 -9.44718041e+00 -1.24023092e+00 -5.55711156e-01 -5.55711156e-01
 -5.55711156e-01  9.38779158e-01  1.04494404e+00  1.04494404e+00
  1.04494404e+00  7.55568813e+00  7.55568813e+00  7.55568813e+00
  9.85789942e+00  3.44807137e+01  3.44807137e+01  3.44807137e+01
  5.25676248e+01  1.31200518e+02  1.31200518e+02  1.31200518e+02
  2.08506726e+02  4.85618809e+02  4.85618809e+02  4.85618809e+02
  7.53443554e+02  1.33615339e+03  1.33615339e+03  1.33615339e+03
  2.84750851e+03  3.02861125e+03  3.02861125e+03  3.02861125e+03
  6.64783742e+03  6.64783742e+03  6.64783742e+03  9.24806124e+03
  2.55946340e+04  7.63247666e+04]
E1 = -727.8498451846557  E_coul = 201.09712767855365
cycle= 1 E= -526.752717506102  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.572068
diis-c [-0.32726173  1.        ]
  HOMO = -0.590657628227086  LUMO = 0.912744634912292
  mo_energy =
[-1.18642869e+02 -1.23448971e+01 -9.59632705e+00 -9.59632705e+00
 -9.59632705e+00 -1.27957604e+00 -5.90657628e-01 -5.90657628e-01
 -5.90657628e-01  9.12744635e-01  1.02023709e+00  1.02023709e+00
  1.02023709e+00  7.46319699e+00  7.46319699e+00  7.46319699e+00
  9.76285141e+00  3.43245897e+01  3.43245897e+01  3.43245897e+01
  5.24047835e+01  1.30971230e+02  1.30971230e+02  1.30971230e+02
  2.08262939e+02  4.85311429e+02  4.85311429e+02  4.85311429e+02
  7.53093459e+02  1.33578943e+03  1.33578943e+03  1.33578943e+03
  2.84701249e+03  3.02818162e+03  3.02818162e+03  3.02818162e+03
  6.64729440e+03  6.64729440e+03  6.64729440e+03  9.24744451e+03
  2.55939221e+04  7.63239639e+04]
E1 = -728.4253467375371  E_coul = 201.67190211846088
cycle= 2 E= -526.753444619076  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0532
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0773523
diis-c [-0.0037922   0.07604537  0.92395463]
  HOMO = -0.581479506028957  LUMO = 0.920357350522161
  mo_energy =
[-1.18574432e+02 -1.23064857e+01 -9.55624359e+00 -9.55624359e+00
 -9.55624359e+00 -1.26858242e+00 -5.81479506e-01 -5.81479506e-01
 -5.81479506e-01  9.20357351e-01  1.02710927e+00  1.02710927e+00
  1.02710927e+00  7.48753028e+00  7.48753028e+00  7.48753028e+00
  9.78903555e+00  3.43653490e+01  3.43653490e+01  3.43653490e+01
  5.24486678e+01  1.31027754e+02  1.31027754e+02  1.31027754e+02
  2.08322746e+02  4.85379016e+02  4.85379016e+02  4.85379016e+02
  7.53163534e+02  1.33586112e+03  1.33586112e+03  1.33586112e+03
  2.84708742e+03  3.02825559e+03  3.02825559e+03  3.02825559e+03
  6.64737013e+03  6.64737013e+03  6.64737013e+03  9.24752102e+03
  2.55939992e+04  7.63240413e+04]
E1 = -728.27368581944  E_coul = 201.52018209243252
cycle= 3 E= -526.753503727007  delta_E= -5.91e-05  |g|= 0.00662  |ddm|= 0.0163
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0140852
diis-c [-8.28093388e-07 -1.28666831e-03  1.49639664e-01  8.51647004e-01]
  HOMO = -0.58304439009077  LUMO = 0.919157130491488
  mo_energy =
[-1.18584906e+02 -1.23125716e+01 -9.56269466e+00 -9.56269466e+00
 -9.56269466e+00 -1.27034479e+00 -5.83044390e-01 -5.83044390e-01
 -5.83044390e-01  9.19157130e-01  1.02596342e+00  1.02596342e+00
  1.02596342e+00  7.48351860e+00  7.48351860e+00  7.48351860e+00
  9.78482592e+00  3.43588330e+01  3.43588330e+01  3.43588330e+01
  5.24417586e+01  1.31018978e+02  1.31018978e+02  1.31018978e+02
  2.08313525e+02  4.85368668e+02  4.85368668e+02  4.85368668e+02
  7.53152787e+02  1.33585015e+03  1.33585015e+03  1.33585015e+03
  2.84707581e+03  3.02824421e+03  3.02824421e+03  3.02824421e+03
  6.64735834e+03  6.64735834e+03  6.64735834e+03  9.24750902e+03
  2.55939870e+04  7.63240290e+04]
E1 = -728.2975384277378  E_coul = 201.54403259330752
cycle= 4 E= -526.75350583443  delta_E= -2.11e-06  |g|= 0.000107  |ddm|= 0.00234
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.00011944
diis-c [-5.12266030e-09  8.75547201e-05 -1.24609617e-02 -7.52008386e-02
  1.08757425e+00]
  HOMO = -0.583025672667411  LUMO = 0.919191194854618
  mo_energy =
[-1.18584857e+02 -1.23125022e+01 -9.56263947e+00 -9.56263947e+00
 -9.56263947e+00 -1.27030118e+00 -5.83025673e-01 -5.83025673e-01
 -5.83025673e-01  9.19191195e-01  1.02597997e+00  1.02597997e+00
  1.02597997e+00  7.48356282e+00  7.48356282e+00  7.48356282e+00
  9.78488629e+00  3.43588865e+01  3.43588865e+01  3.43588865e+01
  5.24418200e+01  1.31019033e+02  1.31019033e+02  1.31019033e+02
  2.08313579e+02  4.85368717e+02  4.85368717e+02  4.85368717e+02
  7.53152827e+02  1.33585019e+03  1.33585019e+03  1.33585019e+03
  2.84707582e+03  3.02824424e+03  3.02824424e+03  3.02824424e+03
  6.64735835e+03  6.64735835e+03  6.64735835e+03  9.24750903e+03
  2.55939870e+04  7.63240290e+04]
E1 = -728.2973004099963  E_coul = 201.54379457350052
cycle= 5 E= -526.753505836496  delta_E= -2.07e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93025e-05
diis-c [-9.55361087e-11  1.28083694e-05 -1.76008503e-03 -1.26573328e-02
  3.45842651e-02  9.79820344e-01]
  HOMO = -0.583033527715376  LUMO = 0.919187369657189
  mo_energy =
[-1.18584889e+02 -1.23125258e+01 -9.56266498e+00 -9.56266498e+00
 -9.56266498e+00 -1.27030744e+00 -5.83033528e-01 -5.83033528e-01
 -5.83033528e-01  9.19187370e-01  1.02597468e+00  1.02597468e+00
  1.02597468e+00  7.48354521e+00  7.48354521e+00  7.48354521e+00
  9.78486909e+00  3.43588616e+01  3.43588616e+01  3.43588616e+01
  5.24417946e+01  1.31019004e+02  1.31019004e+02  1.31019004e+02
  2.08313549e+02  4.85368685e+02  4.85368685e+02  4.85368685e+02
  7.53152795e+02  1.33585016e+03  1.33585016e+03  1.33585016e+03
  2.84707579e+03  3.02824420e+03  3.02824420e+03  3.02824420e+03
  6.64735832e+03  6.64735832e+03  6.64735832e+03  9.24750899e+03
  2.55939869e+04  7.63240290e+04]
E1 = -728.2973841776009  E_coul = 201.5438783410424
cycle= 6 E= -526.753505836558  delta_E= -6.26e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2973841776009  E_coul = 201.5438783410424
  HOMO = -0.583033420510291  LUMO = 0.919187802849817
  mo_energy =
[-1.18584888e+02 -1.23125252e+01 -9.56266444e+00 -9.56266444e+00
 -9.56266444e+00 -1.27030691e+00 -5.83033421e-01 -5.83033421e-01
 -5.83033421e-01  9.19187803e-01  1.02597481e+00  1.02597481e+00
  1.02597481e+00  7.48354558e+00  7.48354558e+00  7.48354558e+00
  9.78486964e+00  3.43588622e+01  3.43588622e+01  3.43588622e+01
  5.24417953e+01  1.31019004e+02  1.31019004e+02  1.31019004e+02
  2.08313550e+02  4.85368686e+02  4.85368686e+02  4.85368686e+02
  7.53152796e+02  1.33585016e+03  1.33585016e+03  1.33585016e+03
  2.84707579e+03  3.02824420e+03  3.02824420e+03  3.02824420e+03
  6.64735832e+03  6.64735832e+03  6.64735832e+03  9.24750899e+03
  2.55939869e+04  7.63240290e+04]
E1 = -728.2973813023829  E_coul = 201.5438754658241
Extra cycle  E= -526.753505836559  delta_E= -3.41e-13  |g|= 3.9e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113504.48246367302
E1 = -728.2973813023829  E_coul = 201.5438754658241
init E= -526.753505836559
    CPU time for initialize scf      0.82 sec, wall time      0.32 sec
  HOMO = -0.583033491559835  LUMO = 0.919187817828186
  mo_energy =
[-1.18584888e+02 -1.23125254e+01 -9.56266467e+00 -9.56266467e+00
 -9.56266467e+00 -1.27030691e+00 -5.83033492e-01 -5.83033492e-01
 -5.83033492e-01  9.19187818e-01  1.02597477e+00  1.02597477e+00
  1.02597477e+00  7.48354543e+00  7.48354543e+00  7.48354543e+00
  9.78486951e+00  3.43588619e+01  3.43588619e+01  3.43588619e+01
  5.24417950e+01  1.31019004e+02  1.31019004e+02  1.31019004e+02
  2.08313550e+02  4.85368686e+02  4.85368686e+02  4.85368686e+02
  7.53152795e+02  1.33585016e+03  1.33585016e+03  1.33585016e+03
  2.84707579e+03  3.02824420e+03  3.02824420e+03  3.02824420e+03
  6.64735832e+03  6.64735832e+03  6.64735832e+03  9.24750899e+03
  2.55939869e+04  7.63240290e+04]
E1 = -728.2973819589915  E_coul = 201.54387612243167
cycle= 1 E= -526.75350583656  delta_E= -1.02e-12  |g|= 8.96e-08  |ddm|= 6.08e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2973819589915  E_coul = 201.54387612243167
  HOMO = -0.583033482242095  LUMO = 0.919187840059368
  mo_energy =
[-1.18584888e+02 -1.23125253e+01 -9.56266463e+00 -9.56266463e+00
 -9.56266463e+00 -1.27030688e+00 -5.83033482e-01 -5.83033482e-01
 -5.83033482e-01  9.19187840e-01  1.02597478e+00  1.02597478e+00
  1.02597478e+00  7.48354546e+00  7.48354546e+00  7.48354546e+00
  9.78486955e+00  3.43588620e+01  3.43588620e+01  3.43588620e+01
  5.24417951e+01  1.31019004e+02  1.31019004e+02  1.31019004e+02
  2.08313550e+02  4.85368686e+02  4.85368686e+02  4.85368686e+02
  7.53152795e+02  1.33585016e+03  1.33585016e+03  1.33585016e+03
  2.84707579e+03  3.02824420e+03  3.02824420e+03  3.02824420e+03
  6.64735832e+03  6.64735832e+03  6.64735832e+03  9.24750899e+03
  2.55939869e+04  7.63240290e+04]
E1 = -728.2973817434126  E_coul = 201.54387590685343
Extra cycle  E= -526.753505836559  delta_E= 5.68e-13  |g|= 1.94e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.43 sec
exp = [2.61826998e+04 7.61741890e+03 3.61738959e+03 1.59553250e+03
 3.89375323e+02 1.26497616e+02 4.87208717e+01 1.89652448e+01
 7.16571767e+00 6.48632367e-01 2.85741373e+00 2.31391424e-01
 1.36279777e+03 6.64604953e+02 3.00299496e+02 3.13471308e+02
 6.18257452e+01 7.51797509e+00 2.05938727e+01 7.82963405e-01
 2.88229871e+00 2.24108433e-01]
grad_E = [-1.57191707e-06  3.94366418e-06 -1.19116243e-06  9.40277751e-05
 -5.85210360e-04  2.54930272e-04  2.28954021e-04 -3.24139771e-04
 -7.07940102e-05 -2.97460254e-04  1.07318769e-05  2.03130378e-04
 -4.90219590e-07  5.27829515e-06  2.53414402e-05  2.18055257e-05
 -2.06633461e-04  3.15130418e-04  5.00623606e-04  1.92674999e-05
  1.38893606e-04 -8.83485145e-05]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:45 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.701172         1
[INPUT] 0    0    [1    /1   ]  7617.41566288        1
[INPUT] 0    0    [1    /1   ]  3617.39081624        1
[INPUT] 0    0    [1    /1   ]  1595.46048559        1
[INPUT] 0    0    [1    /1   ]  389.581253084        1
[INPUT] 0    0    [1    /1   ]  127.039407706        1
[INPUT] 0    0    [1    /1   ]  49.2659513543        1
[INPUT] 0    0    [1    /1   ]  19.4047554567        1
[INPUT] 0    0    [1    /1   ]  7.20486064434        1
[INPUT] 0    0    [1    /1   ]  0.648435986102       1
[INPUT] 0    0    [1    /1   ]  2.86633565851        1
[INPUT] 0    0    [1    /1   ]  0.231494226246       1
[INPUT] 1    0    [1    /1   ]  1362.79823154        1
[INPUT] 1    0    [1    /1   ]  664.600515396        1
[INPUT] 1    0    [1    /1   ]  300.278594212        1
[INPUT] 1    0    [1    /1   ]  313.453294418        1
[INPUT] 1    0    [1    /1   ]  61.8360221741        1
[INPUT] 1    0    [1    /1   ]  7.51587571087        1
[INPUT] 1    0    [1    /1   ]  20.596514363         1
[INPUT] 1    0    [1    /1   ]  0.782707907162       1
[INPUT] 1    0    [1    /1   ]  2.87976100893        1
[INPUT] 1    0    [1    /1   ]  0.224066606706       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.701171974604, 1.0]], [0, [7617.415662878815, 1.0]], [0, [3617.3908162359853, 1.0]], [0, [1595.4604855889356, 1.0]], [0, [389.58125308413673, 1.0]], [0, [127.03940770561438, 1.0]], [0, [49.26595135432531, 1.0]], [0, [19.404755456702958, 1.0]], [0, [7.204860644343232, 1.0]], [0, [0.6484359861016668, 1.0]], [0, [2.8663356585123734, 1.0]], [0, [0.2314942262457103, 1.0]], [1, [1362.7982315364743, 1.0]], [1, [664.6005153957668, 1.0]], [1, [300.27859421225355, 1.0]], [1, [313.4532944178949, 1.0]], [1, [61.83602217414316, 1.0]], [1, [7.515875710870947, 1.0]], [1, [20.596514363023665, 1.0]], [1, [0.7827079071621452, 1.0]], [1, [2.8797610089329404, 1.0]], [1, [0.22406660670561965, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.70117197]
bas 1, expnt(s) = [7617.41566288]
bas 2, expnt(s) = [3617.39081624]
bas 3, expnt(s) = [1595.46048559]
bas 4, expnt(s) = [389.58125308]
bas 5, expnt(s) = [127.03940771]
bas 6, expnt(s) = [49.26595135]
bas 7, expnt(s) = [19.40475546]
bas 8, expnt(s) = [7.20486064]
bas 9, expnt(s) = [0.64843599]
bas 10, expnt(s) = [2.86633566]
bas 11, expnt(s) = [0.23149423]
bas 12, expnt(s) = [1362.79823154]
bas 13, expnt(s) = [664.6005154]
bas 14, expnt(s) = [300.27859421]
bas 15, expnt(s) = [313.45329442]
bas 16, expnt(s) = [61.83602217]
bas 17, expnt(s) = [7.51587571]
bas 18, expnt(s) = [20.59651436]
bas 19, expnt(s) = [0.78270791]
bas 20, expnt(s) = [2.87976101]
bas 21, expnt(s) = [0.22406661]
CPU time:       483.03
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827012e+04 5.20026962e+03 7.61741566e+03 2.06001681e+03
 3.61739082e+03 1.17845119e+03 1.59546049e+03 6.37792729e+02
 3.89581253e+02 2.21545821e+02 1.27039408e+02 9.56024164e+01
 4.92659514e+01 4.69813162e+01 1.94047555e+01 2.33585648e+01
 7.20486064e+00 1.11105156e+01 6.48435986e-01 1.82564090e+00
 2.86633566e+00 5.56557845e+00 2.31494226e-01 8.43179709e-01
 1.36279823e+03 2.41559345e+04 6.64600515e+02 9.84430894e+03
 3.00278594e+02 3.64661455e+03 3.13453294e+02 3.84769324e+03
 6.18360222e+01 5.05866969e+02 7.51587571e+00 3.63043679e+01
 2.05965144e+01 1.28004888e+02 7.82707907e-01 2.14775156e+00
 2.87976101e+00 1.09440975e+01 2.24066607e-01 4.49734096e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993545240963016
cond(S) = 113515.5565342029
E1 = -729.5451056747032  E_coul = 203.17568347523232
init E= -526.369422199471
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555713155406456  LUMO = 0.939422222010387
  mo_energy =
[-1.18334175e+02 -1.22068171e+01 -9.44718356e+00 -9.44718356e+00
 -9.44718356e+00 -1.24022904e+00 -5.55713155e-01 -5.55713155e-01
 -5.55713155e-01  9.39422222e-01  1.04454324e+00  1.04454324e+00
  1.04454324e+00  7.54958623e+00  7.54958623e+00  7.54958623e+00
  9.93114465e+00  3.44673949e+01  3.44673949e+01  3.44673949e+01
  5.34518543e+01  1.31200365e+02  1.31200365e+02  1.31200365e+02
  2.11516197e+02  4.85628454e+02  4.85628454e+02  4.85628454e+02
  7.58708870e+02  1.33612827e+03  1.33612827e+03  1.33612827e+03
  2.85373105e+03  3.02853188e+03  3.02853188e+03  3.02853188e+03
  6.64772023e+03  6.64772023e+03  6.64772023e+03  9.25415958e+03
  2.56004467e+04  7.63301826e+04]
E1 = -727.8496554943374  E_coul = 201.0969280617825
cycle= 1 E= -526.752727432555  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.572838
diis-c [-0.32814391  1.        ]
  HOMO = -0.590651351476388  LUMO = 0.913359684418268
  mo_energy =
[-1.18642934e+02 -1.23449006e+01 -9.59634821e+00 -9.59634821e+00
 -9.59634821e+00 -1.27956708e+00 -5.90651351e-01 -5.90651351e-01
 -5.90651351e-01  9.13359684e-01  1.01985263e+00  1.01985263e+00
  1.01985263e+00  7.45713024e+00  7.45713024e+00  7.45713024e+00
  9.83564831e+00  3.43112548e+01  3.43112548e+01  3.43112548e+01
  5.32879085e+01  1.30971027e+02  1.30971027e+02  1.30971027e+02
  2.11271638e+02  4.85321043e+02  4.85321043e+02  4.85321043e+02
  7.58358547e+02  1.33576428e+03  1.33576428e+03  1.33576428e+03
  2.85323504e+03  3.02810222e+03  3.02810222e+03  3.02810222e+03
  6.64717717e+03  6.64717717e+03  6.64717717e+03  9.25354286e+03
  2.55997347e+04  7.63293799e+04]
E1 = -728.425204913977  E_coul = 201.671750275491
cycle= 2 E= -526.753454638486  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0773679
diis-c [-0.0038035   0.07580832  0.92419168]
  HOMO = -0.581469085555259  LUMO = 0.920984681275045
  mo_energy =
[-1.18574475e+02 -1.23064765e+01 -9.55625209e+00 -9.55625209e+00
 -9.55625209e+00 -1.26856887e+00 -5.81469086e-01 -5.81469086e-01
 -5.81469086e-01  9.20984681e-01  1.02672448e+00  1.02672448e+00
  1.02672448e+00  7.48146229e+00  7.48146229e+00  7.48146229e+00
  9.86196910e+00  3.43520273e+01  3.43520273e+01  3.43520273e+01
  5.33320720e+01  1.31027572e+02  1.31027572e+02  1.31027572e+02
  2.11331585e+02  4.85388654e+02  4.85388654e+02  4.85388654e+02
  7.58428656e+02  1.33583599e+03  1.33583599e+03  1.33583599e+03
  2.85330999e+03  3.02817621e+03  3.02817621e+03  3.02817621e+03
  6.64725292e+03  6.64725292e+03  6.64725292e+03  9.25361940e+03
  2.55998118e+04  7.63294573e+04]
E1 = -728.2735054682461  E_coul = 201.51999172749183
cycle= 3 E= -526.753513740754  delta_E= -5.91e-05  |g|= 0.00663  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141098
diis-c [-8.28316996e-07 -1.28710552e-03  1.49847956e-01  8.51439149e-01]
  HOMO = -0.583036204055326  LUMO = 0.919781063157197
  mo_energy =
[-1.18584966e+02 -1.23125721e+01 -9.56271321e+00 -9.56271321e+00
 -9.56271321e+00 -1.27033404e+00 -5.83036204e-01 -5.83036204e-01
 -5.83036204e-01  9.19781063e-01  1.02557749e+00  1.02557749e+00
  1.02557749e+00  7.47744617e+00  7.47744617e+00  7.47744617e+00
  9.85773363e+00  3.43455010e+01  3.43455010e+01  3.43455010e+01
  5.33251128e+01  1.31018781e+02  1.31018781e+02  1.31018781e+02
  2.11322331e+02  4.85378288e+02  4.85378288e+02  4.85378288e+02
  7.58417889e+02  1.33582500e+03  1.33582500e+03  1.33582500e+03
  2.85329835e+03  3.02816481e+03  3.02816481e+03  3.02816481e+03
  6.64724112e+03  6.64724112e+03  6.64724112e+03  9.25360737e+03
  2.55997996e+04  7.63294450e+04]
E1 = -728.2973952010245  E_coul = 201.54387934644367
cycle= 4 E= -526.753515854581  delta_E= -2.11e-06  |g|= 0.000106  |ddm|= 0.00234
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119213
diis-c [-5.09456026e-09  8.72558888e-05 -1.24285595e-02 -7.49006784e-02
  1.08724198e+00]
  HOMO = -0.583017488365476  LUMO = 0.919815120306944
  mo_energy =
[-1.18584918e+02 -1.23125027e+01 -9.56265806e+00 -9.56265806e+00
 -9.56265806e+00 -1.27029048e+00 -5.83017488e-01 -5.83017488e-01
 -5.83017488e-01  9.19815120e-01  1.02559403e+00  1.02559403e+00
  1.02559403e+00  7.47749034e+00  7.47749034e+00  7.47749034e+00
  9.85779408e+00  3.43455545e+01  3.43455545e+01  3.43455545e+01
  5.33251742e+01  1.31018836e+02  1.31018836e+02  1.31018836e+02
  2.11322385e+02  4.85378337e+02  4.85378337e+02  4.85378337e+02
  7.58417929e+02  1.33582504e+03  1.33582504e+03  1.33582504e+03
  2.85329837e+03  3.02816484e+03  3.02816484e+03  3.02816484e+03
  6.64724113e+03  6.64724113e+03  6.64724113e+03  9.25360738e+03
  2.55997996e+04  7.63294450e+04]
E1 = -728.2971575171013  E_coul = 201.5436416604604
cycle= 5 E= -526.753515856641  delta_E= -2.06e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.92976e-05
diis-c [-9.51745714e-11  1.27948129e-05 -1.76227081e-03 -1.26486192e-02
  3.46246006e-02  9.79773495e-01]
  HOMO = -0.58302533141934  LUMO = 0.919811299187933
  mo_energy =
[-1.18584950e+02 -1.23125262e+01 -9.56268354e+00 -9.56268354e+00
 -9.56268354e+00 -1.27029673e+00 -5.83025331e-01 -5.83025331e-01
 -5.83025331e-01  9.19811299e-01  1.02558875e+00  1.02558875e+00
  1.02558875e+00  7.47747276e+00  7.47747276e+00  7.47747276e+00
  9.85777685e+00  3.43455296e+01  3.43455296e+01  3.43455296e+01
  5.33251488e+01  1.31018807e+02  1.31018807e+02  1.31018807e+02
  2.11322355e+02  4.85378305e+02  4.85378305e+02  4.85378305e+02
  7.58417897e+02  1.33582501e+03  1.33582501e+03  1.33582501e+03
  2.85329834e+03  3.02816480e+03  3.02816480e+03  3.02816480e+03
  6.64724110e+03  6.64724110e+03  6.64724110e+03  9.25360734e+03
  2.55997996e+04  7.63294449e+04]
E1 = -728.2972411643518  E_coul = 201.54372530764985
cycle= 6 E= -526.753515856702  delta_E= -6.1e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2972411643518  E_coul = 201.54372530764985
  HOMO = -0.58302522664329  LUMO = 0.919811731243079
  mo_energy =
[-1.18584949e+02 -1.23125256e+01 -9.56268301e+00 -9.56268301e+00
 -9.56268301e+00 -1.27029620e+00 -5.83025227e-01 -5.83025227e-01
 -5.83025227e-01  9.19811731e-01  1.02558888e+00  1.02558888e+00
  1.02558888e+00  7.47747313e+00  7.47747313e+00  7.47747313e+00
  9.85777739e+00  3.43455302e+01  3.43455302e+01  3.43455302e+01
  5.33251494e+01  1.31018808e+02  1.31018808e+02  1.31018808e+02
  2.11322356e+02  4.85378306e+02  4.85378306e+02  4.85378306e+02
  7.58417898e+02  1.33582501e+03  1.33582501e+03  1.33582501e+03
  2.85329834e+03  3.02816480e+03  3.02816480e+03  3.02816480e+03
  6.64724110e+03  6.64724110e+03  6.64724110e+03  9.25360734e+03
  2.55997996e+04  7.63294449e+04]
E1 = -728.2972383197683  E_coul = 201.54372246306494
Extra cycle  E= -526.753515856703  delta_E= -1.48e-12  |g|= 3.9e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
exp = [2.61827012e+04 7.61741566e+03 3.61739082e+03 1.59546049e+03
 3.89581253e+02 1.27039408e+02 4.92659514e+01 1.94047555e+01
 7.20486064e+00 6.48435986e-01 2.86633566e+00 2.31494226e-01
 1.36279823e+03 6.64600515e+02 3.00278594e+02 3.13453294e+02
 6.18360222e+01 7.51587571e+00 2.05965144e+01 7.82707907e-01
 2.87976101e+00 2.24066607e-01]
E = -526.7535158567034
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:46 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.701172         1
[INPUT] 0    0    [1    /1   ]  7617.41566288        1
[INPUT] 0    0    [1    /1   ]  3617.39081624        1
[INPUT] 0    0    [1    /1   ]  1595.46048559        1
[INPUT] 0    0    [1    /1   ]  389.581253084        1
[INPUT] 0    0    [1    /1   ]  127.039407706        1
[INPUT] 0    0    [1    /1   ]  49.2659513543        1
[INPUT] 0    0    [1    /1   ]  19.4047554567        1
[INPUT] 0    0    [1    /1   ]  7.20486064434        1
[INPUT] 0    0    [1    /1   ]  0.648435986102       1
[INPUT] 0    0    [1    /1   ]  2.86633565851        1
[INPUT] 0    0    [1    /1   ]  0.231494226246       1
[INPUT] 1    0    [1    /1   ]  1362.79823154        1
[INPUT] 1    0    [1    /1   ]  664.600515396        1
[INPUT] 1    0    [1    /1   ]  300.278594212        1
[INPUT] 1    0    [1    /1   ]  313.453294418        1
[INPUT] 1    0    [1    /1   ]  61.8360221741        1
[INPUT] 1    0    [1    /1   ]  7.51587571087        1
[INPUT] 1    0    [1    /1   ]  20.596514363         1
[INPUT] 1    0    [1    /1   ]  0.782707907162       1
[INPUT] 1    0    [1    /1   ]  2.87976100893        1
[INPUT] 1    0    [1    /1   ]  0.224066606706       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.701171974604, 1.0]], [0, [7617.415662878815, 1.0]], [0, [3617.3908162359853, 1.0]], [0, [1595.4604855889356, 1.0]], [0, [389.58125308413673, 1.0]], [0, [127.03940770561438, 1.0]], [0, [49.26595135432531, 1.0]], [0, [19.404755456702958, 1.0]], [0, [7.204860644343232, 1.0]], [0, [0.6484359861016668, 1.0]], [0, [2.8663356585123734, 1.0]], [0, [0.2314942262457103, 1.0]], [1, [1362.7982315364743, 1.0]], [1, [664.6005153957668, 1.0]], [1, [300.27859421225355, 1.0]], [1, [313.4532944178949, 1.0]], [1, [61.83602217414316, 1.0]], [1, [7.515875710870947, 1.0]], [1, [20.596514363023665, 1.0]], [1, [0.7827079071621452, 1.0]], [1, [2.8797610089329404, 1.0]], [1, [0.22406660670561965, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.70117197]
bas 1, expnt(s) = [7617.41566288]
bas 2, expnt(s) = [3617.39081624]
bas 3, expnt(s) = [1595.46048559]
bas 4, expnt(s) = [389.58125308]
bas 5, expnt(s) = [127.03940771]
bas 6, expnt(s) = [49.26595135]
bas 7, expnt(s) = [19.40475546]
bas 8, expnt(s) = [7.20486064]
bas 9, expnt(s) = [0.64843599]
bas 10, expnt(s) = [2.86633566]
bas 11, expnt(s) = [0.23149423]
bas 12, expnt(s) = [1362.79823154]
bas 13, expnt(s) = [664.6005154]
bas 14, expnt(s) = [300.27859421]
bas 15, expnt(s) = [313.45329442]
bas 16, expnt(s) = [61.83602217]
bas 17, expnt(s) = [7.51587571]
bas 18, expnt(s) = [20.59651436]
bas 19, expnt(s) = [0.78270791]
bas 20, expnt(s) = [2.87976101]
bas 21, expnt(s) = [0.22406661]
CPU time:       483.53
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827012e+04 5.20026962e+03 7.61741566e+03 2.06001681e+03
 3.61739082e+03 1.17845119e+03 1.59546049e+03 6.37792729e+02
 3.89581253e+02 2.21545821e+02 1.27039408e+02 9.56024164e+01
 4.92659514e+01 4.69813162e+01 1.94047555e+01 2.33585648e+01
 7.20486064e+00 1.11105156e+01 6.48435986e-01 1.82564090e+00
 2.86633566e+00 5.56557845e+00 2.31494226e-01 8.43179709e-01
 1.36279823e+03 2.41559345e+04 6.64600515e+02 9.84430894e+03
 3.00278594e+02 3.64661455e+03 3.13453294e+02 3.84769324e+03
 6.18360222e+01 5.05866969e+02 7.51587571e+00 3.63043679e+01
 2.05965144e+01 1.28004888e+02 7.82707907e-01 2.14775156e+00
 2.87976101e+00 1.09440975e+01 2.24066607e-01 4.49734096e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993545240963016
cond(S) = 113515.5565342029
E1 = -729.5451056747032  E_coul = 203.17568347523232
init E= -526.369422199471
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555713155406456  LUMO = 0.939422222010387
  mo_energy =
[-1.18334175e+02 -1.22068171e+01 -9.44718356e+00 -9.44718356e+00
 -9.44718356e+00 -1.24022904e+00 -5.55713155e-01 -5.55713155e-01
 -5.55713155e-01  9.39422222e-01  1.04454324e+00  1.04454324e+00
  1.04454324e+00  7.54958623e+00  7.54958623e+00  7.54958623e+00
  9.93114465e+00  3.44673949e+01  3.44673949e+01  3.44673949e+01
  5.34518543e+01  1.31200365e+02  1.31200365e+02  1.31200365e+02
  2.11516197e+02  4.85628454e+02  4.85628454e+02  4.85628454e+02
  7.58708870e+02  1.33612827e+03  1.33612827e+03  1.33612827e+03
  2.85373105e+03  3.02853188e+03  3.02853188e+03  3.02853188e+03
  6.64772023e+03  6.64772023e+03  6.64772023e+03  9.25415958e+03
  2.56004467e+04  7.63301826e+04]
E1 = -727.8496554943374  E_coul = 201.0969280617825
cycle= 1 E= -526.752727432555  delta_E= -0.383  |g|= 0.187  |ddm|= 0.321
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.572838
diis-c [-0.32814391  1.        ]
  HOMO = -0.590651351476388  LUMO = 0.913359684418268
  mo_energy =
[-1.18642934e+02 -1.23449006e+01 -9.59634821e+00 -9.59634821e+00
 -9.59634821e+00 -1.27956708e+00 -5.90651351e-01 -5.90651351e-01
 -5.90651351e-01  9.13359684e-01  1.01985263e+00  1.01985263e+00
  1.01985263e+00  7.45713024e+00  7.45713024e+00  7.45713024e+00
  9.83564831e+00  3.43112548e+01  3.43112548e+01  3.43112548e+01
  5.32879085e+01  1.30971027e+02  1.30971027e+02  1.30971027e+02
  2.11271638e+02  4.85321043e+02  4.85321043e+02  4.85321043e+02
  7.58358547e+02  1.33576428e+03  1.33576428e+03  1.33576428e+03
  2.85323504e+03  3.02810222e+03  3.02810222e+03  3.02810222e+03
  6.64717717e+03  6.64717717e+03  6.64717717e+03  9.25354286e+03
  2.55997347e+04  7.63293799e+04]
E1 = -728.425204913977  E_coul = 201.671750275491
cycle= 2 E= -526.753454638486  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0773679
diis-c [-0.0038035   0.07580832  0.92419168]
  HOMO = -0.581469085555259  LUMO = 0.920984681275045
  mo_energy =
[-1.18574475e+02 -1.23064765e+01 -9.55625209e+00 -9.55625209e+00
 -9.55625209e+00 -1.26856887e+00 -5.81469086e-01 -5.81469086e-01
 -5.81469086e-01  9.20984681e-01  1.02672448e+00  1.02672448e+00
  1.02672448e+00  7.48146229e+00  7.48146229e+00  7.48146229e+00
  9.86196910e+00  3.43520273e+01  3.43520273e+01  3.43520273e+01
  5.33320720e+01  1.31027572e+02  1.31027572e+02  1.31027572e+02
  2.11331585e+02  4.85388654e+02  4.85388654e+02  4.85388654e+02
  7.58428656e+02  1.33583599e+03  1.33583599e+03  1.33583599e+03
  2.85330999e+03  3.02817621e+03  3.02817621e+03  3.02817621e+03
  6.64725292e+03  6.64725292e+03  6.64725292e+03  9.25361940e+03
  2.55998118e+04  7.63294573e+04]
E1 = -728.2735054682461  E_coul = 201.51999172749183
cycle= 3 E= -526.753513740754  delta_E= -5.91e-05  |g|= 0.00663  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141098
diis-c [-8.28316996e-07 -1.28710552e-03  1.49847956e-01  8.51439149e-01]
  HOMO = -0.583036204055326  LUMO = 0.919781063157197
  mo_energy =
[-1.18584966e+02 -1.23125721e+01 -9.56271321e+00 -9.56271321e+00
 -9.56271321e+00 -1.27033404e+00 -5.83036204e-01 -5.83036204e-01
 -5.83036204e-01  9.19781063e-01  1.02557749e+00  1.02557749e+00
  1.02557749e+00  7.47744617e+00  7.47744617e+00  7.47744617e+00
  9.85773363e+00  3.43455010e+01  3.43455010e+01  3.43455010e+01
  5.33251128e+01  1.31018781e+02  1.31018781e+02  1.31018781e+02
  2.11322331e+02  4.85378288e+02  4.85378288e+02  4.85378288e+02
  7.58417889e+02  1.33582500e+03  1.33582500e+03  1.33582500e+03
  2.85329835e+03  3.02816481e+03  3.02816481e+03  3.02816481e+03
  6.64724112e+03  6.64724112e+03  6.64724112e+03  9.25360737e+03
  2.55997996e+04  7.63294450e+04]
E1 = -728.2973952010245  E_coul = 201.54387934644367
cycle= 4 E= -526.753515854581  delta_E= -2.11e-06  |g|= 0.000106  |ddm|= 0.00234
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000119213
diis-c [-5.09456026e-09  8.72558888e-05 -1.24285595e-02 -7.49006784e-02
  1.08724198e+00]
  HOMO = -0.583017488365476  LUMO = 0.919815120306944
  mo_energy =
[-1.18584918e+02 -1.23125027e+01 -9.56265806e+00 -9.56265806e+00
 -9.56265806e+00 -1.27029048e+00 -5.83017488e-01 -5.83017488e-01
 -5.83017488e-01  9.19815120e-01  1.02559403e+00  1.02559403e+00
  1.02559403e+00  7.47749034e+00  7.47749034e+00  7.47749034e+00
  9.85779408e+00  3.43455545e+01  3.43455545e+01  3.43455545e+01
  5.33251742e+01  1.31018836e+02  1.31018836e+02  1.31018836e+02
  2.11322385e+02  4.85378337e+02  4.85378337e+02  4.85378337e+02
  7.58417929e+02  1.33582504e+03  1.33582504e+03  1.33582504e+03
  2.85329837e+03  3.02816484e+03  3.02816484e+03  3.02816484e+03
  6.64724113e+03  6.64724113e+03  6.64724113e+03  9.25360738e+03
  2.55997996e+04  7.63294450e+04]
E1 = -728.2971575171013  E_coul = 201.5436416604604
cycle= 5 E= -526.753515856641  delta_E= -2.06e-09  |g|= 2.1e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.92976e-05
diis-c [-9.51745714e-11  1.27948129e-05 -1.76227081e-03 -1.26486192e-02
  3.46246006e-02  9.79773495e-01]
  HOMO = -0.58302533141934  LUMO = 0.919811299187933
  mo_energy =
[-1.18584950e+02 -1.23125262e+01 -9.56268354e+00 -9.56268354e+00
 -9.56268354e+00 -1.27029673e+00 -5.83025331e-01 -5.83025331e-01
 -5.83025331e-01  9.19811299e-01  1.02558875e+00  1.02558875e+00
  1.02558875e+00  7.47747276e+00  7.47747276e+00  7.47747276e+00
  9.85777685e+00  3.43455296e+01  3.43455296e+01  3.43455296e+01
  5.33251488e+01  1.31018807e+02  1.31018807e+02  1.31018807e+02
  2.11322355e+02  4.85378305e+02  4.85378305e+02  4.85378305e+02
  7.58417897e+02  1.33582501e+03  1.33582501e+03  1.33582501e+03
  2.85329834e+03  3.02816480e+03  3.02816480e+03  3.02816480e+03
  6.64724110e+03  6.64724110e+03  6.64724110e+03  9.25360734e+03
  2.55997996e+04  7.63294449e+04]
E1 = -728.2972411643518  E_coul = 201.54372530764985
cycle= 6 E= -526.753515856702  delta_E= -6.1e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2972411643518  E_coul = 201.54372530764985
  HOMO = -0.58302522664329  LUMO = 0.919811731243079
  mo_energy =
[-1.18584949e+02 -1.23125256e+01 -9.56268301e+00 -9.56268301e+00
 -9.56268301e+00 -1.27029620e+00 -5.83025227e-01 -5.83025227e-01
 -5.83025227e-01  9.19811731e-01  1.02558888e+00  1.02558888e+00
  1.02558888e+00  7.47747313e+00  7.47747313e+00  7.47747313e+00
  9.85777739e+00  3.43455302e+01  3.43455302e+01  3.43455302e+01
  5.33251494e+01  1.31018808e+02  1.31018808e+02  1.31018808e+02
  2.11322356e+02  4.85378306e+02  4.85378306e+02  4.85378306e+02
  7.58417898e+02  1.33582501e+03  1.33582501e+03  1.33582501e+03
  2.85329834e+03  3.02816480e+03  3.02816480e+03  3.02816480e+03
  6.64724110e+03  6.64724110e+03  6.64724110e+03  9.25360734e+03
  2.55997996e+04  7.63294449e+04]
E1 = -728.2972383197683  E_coul = 201.54372246306494
Extra cycle  E= -526.753515856703  delta_E= -1.48e-12  |g|= 3.9e-07  |ddm|= 3.27e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113515.5565342029
E1 = -728.2972383197683  E_coul = 201.54372246306494
init E= -526.753515856703
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583025297107238  LUMO = 0.919811746775134
  mo_energy =
[-1.18584949e+02 -1.23125258e+01 -9.56268324e+00 -9.56268324e+00
 -9.56268324e+00 -1.27029619e+00 -5.83025297e-01 -5.83025297e-01
 -5.83025297e-01  9.19811747e-01  1.02558884e+00  1.02558884e+00
  1.02558884e+00  7.47747298e+00  7.47747298e+00  7.47747298e+00
  9.85777727e+00  3.43455300e+01  3.43455300e+01  3.43455300e+01
  5.33251492e+01  1.31018807e+02  1.31018807e+02  1.31018807e+02
  2.11322356e+02  4.85378306e+02  4.85378306e+02  4.85378306e+02
  7.58417898e+02  1.33582501e+03  1.33582501e+03  1.33582501e+03
  2.85329834e+03  3.02816480e+03  3.02816480e+03  3.02816480e+03
  6.64724110e+03  6.64724110e+03  6.64724110e+03  9.25360734e+03
  2.55997996e+04  7.63294449e+04]
E1 = -728.2972389677249  E_coul = 201.54372311102068
cycle= 1 E= -526.753515856704  delta_E= -7.96e-13  |g|= 8.94e-08  |ddm|= 6.1e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2972389677249  E_coul = 201.54372311102068
  HOMO = -0.583025287952327  LUMO = 0.919811768914031
  mo_energy =
[-1.18584949e+02 -1.23125258e+01 -9.56268319e+00 -9.56268319e+00
 -9.56268319e+00 -1.27029617e+00 -5.83025288e-01 -5.83025288e-01
 -5.83025288e-01  9.19811769e-01  1.02558885e+00  1.02558885e+00
  1.02558885e+00  7.47747301e+00  7.47747301e+00  7.47747301e+00
  9.85777730e+00  3.43455300e+01  3.43455300e+01  3.43455300e+01
  5.33251493e+01  1.31018807e+02  1.31018807e+02  1.31018807e+02
  2.11322356e+02  4.85378306e+02  4.85378306e+02  4.85378306e+02
  7.58417898e+02  1.33582501e+03  1.33582501e+03  1.33582501e+03
  2.85329834e+03  3.02816480e+03  3.02816480e+03  3.02816480e+03
  6.64724110e+03  6.64724110e+03  6.64724110e+03  9.25360734e+03
  2.55997996e+04  7.63294449e+04]
E1 = -728.2972387545947  E_coul = 201.5437228978912
Extra cycle  E= -526.753515856703  delta_E= 7.96e-13  |g|= 1.93e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.44 sec
exp = [2.61827012e+04 7.61741566e+03 3.61739082e+03 1.59546049e+03
 3.89581253e+02 1.27039408e+02 4.92659514e+01 1.94047555e+01
 7.20486064e+00 6.48435986e-01 2.86633566e+00 2.31494226e-01
 1.36279823e+03 6.64600515e+02 3.00278594e+02 3.13453294e+02
 6.18360222e+01 7.51587571e+00 2.05965144e+01 7.82707907e-01
 2.87976101e+00 2.24066607e-01]
grad_E = [-1.57222666e-06  3.94753872e-06 -1.18934740e-06  9.41975264e-05
 -5.88016226e-04  2.57874880e-04  2.29320609e-04 -3.21477644e-04
  3.00122487e-06 -4.95254090e-04 -1.65367982e-04  6.46290464e-04
 -4.90815586e-07  5.27259478e-06  2.53128193e-05  2.17792473e-05
 -2.07478349e-04  3.71080289e-04  5.10537227e-04 -1.80451568e-04
 -7.97931706e-05  4.49098047e-04]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:50 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7041936        1
[INPUT] 0    0    [1    /1   ]  7617.40856367        1
[INPUT] 0    0    [1    /1   ]  3617.39347259        1
[INPUT] 0    0    [1    /1   ]  1595.30207989        1
[INPUT] 0    0    [1    /1   ]  390.055792148        1
[INPUT] 0    0    [1    /1   ]  128.168369612        1
[INPUT] 0    0    [1    /1   ]  50.4084631815        1
[INPUT] 0    0    [1    /1   ]  20.2781274448        1
[INPUT] 0    0    [1    /1   ]  7.273381681          1
[INPUT] 0    0    [1    /1   ]  0.64810654756        1
[INPUT] 0    0    [1    /1   ]  2.88241717412        1
[INPUT] 0    0    [1    /1   ]  0.231689660716       1
[INPUT] 1    0    [1    /1   ]  1362.79923153        1
[INPUT] 1    0    [1    /1   ]  664.590822323        1
[INPUT] 1    0    [1    /1   ]  300.232935587        1
[INPUT] 1    0    [1    /1   ]  313.413945349        1
[INPUT] 1    0    [1    /1   ]  61.8606450983        1
[INPUT] 1    0    [1    /1   ]  7.5087242249         1
[INPUT] 1    0    [1    /1   ]  20.5952872854        1
[INPUT] 1    0    [1    /1   ]  0.782143426103       1
[INPUT] 1    0    [1    /1   ]  2.87415530497        1
[INPUT] 1    0    [1    /1   ]  0.223971153999       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.704193622612, 1.0]], [0, [7617.408563672743, 1.0]], [0, [3617.393472586684, 1.0]], [0, [1595.3020798895345, 1.0]], [0, [390.0557921483573, 1.0]], [0, [128.16836961242052, 1.0]], [0, [50.4084631814591, 1.0]], [0, [20.278127444769126, 1.0]], [0, [7.2733816810016805, 1.0]], [0, [0.6481065475603679, 1.0]], [0, [2.882417174121397, 1.0]], [0, [0.23168966071560834, 1.0]], [1, [1362.7992315265747, 1.0]], [1, [664.5908223227243, 1.0]], [1, [300.2329355872078, 1.0]], [1, [313.4139453492199, 1.0]], [1, [61.86064509832528, 1.0]], [1, [7.50872422489977, 1.0]], [1, [20.59528728542958, 1.0]], [1, [0.7821434261030773, 1.0]], [1, [2.8741553049689976, 1.0]], [1, [0.2239711539994337, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.70419362]
bas 1, expnt(s) = [7617.40856367]
bas 2, expnt(s) = [3617.39347259]
bas 3, expnt(s) = [1595.30207989]
bas 4, expnt(s) = [390.05579215]
bas 5, expnt(s) = [128.16836961]
bas 6, expnt(s) = [50.40846318]
bas 7, expnt(s) = [20.27812744]
bas 8, expnt(s) = [7.27338168]
bas 9, expnt(s) = [0.64810655]
bas 10, expnt(s) = [2.88241717]
bas 11, expnt(s) = [0.23168966]
bas 12, expnt(s) = [1362.79923153]
bas 13, expnt(s) = [664.59082232]
bas 14, expnt(s) = [300.23293559]
bas 15, expnt(s) = [313.41394535]
bas 16, expnt(s) = [61.8606451]
bas 17, expnt(s) = [7.50872422]
bas 18, expnt(s) = [20.59528729]
bas 19, expnt(s) = [0.78214343]
bas 20, expnt(s) = [2.8741553]
bas 21, expnt(s) = [0.22397115]
CPU time:       489.08
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827042e+04 5.20027007e+03 7.61740856e+03 2.06001537e+03
 3.61739347e+03 1.17845184e+03 1.59530208e+03 6.37745236e+02
 3.90055792e+02 2.21748184e+02 1.28168370e+02 9.62389041e+01
 5.04084632e+01 4.77961172e+01 2.02781274e+01 2.41427040e+01
 7.27338168e+00 1.11896708e+01 6.48106548e-01 1.82494521e+00
 2.88241717e+00 5.58898124e+00 2.31689661e-01 8.43713532e-01
 1.36279923e+03 2.41559567e+04 6.64590822e+02 9.84412947e+03
 3.00232936e+02 3.64592146e+03 3.13413945e+02 3.84708948e+03
 6.18606451e+01 5.06118775e+02 7.50872422e+00 3.62611927e+01
 2.05952873e+01 1.27995355e+02 7.82143426e-01 2.14581557e+00
 2.87415530e+00 1.09174744e+01 2.23971154e-01 4.49494624e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993562115748922
cond(S) = 113515.1444399543
E1 = -729.5449984089071  E_coul = 203.17559900204884
init E= -526.369399406858
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555718050901026  LUMO = 0.94064658011609
  mo_energy =
[-1.18334231e+02 -1.22067917e+01 -9.44718859e+00 -9.44718859e+00
 -9.44718859e+00 -1.24022490e+00 -5.55718051e-01 -5.55718051e-01
 -5.55718051e-01  9.40646580e-01  1.04364899e+00  1.04364899e+00
  1.04364899e+00  7.53543326e+00  7.53543326e+00  7.53543326e+00
  1.00666780e+01  3.44273504e+01  3.44273504e+01  3.44273504e+01
  5.51916697e+01  1.31173912e+02  1.31173912e+02  1.31173912e+02
  2.17577146e+02  4.85624342e+02  4.85624342e+02  4.85624342e+02
  7.69491252e+02  1.33605152e+03  1.33605152e+03  1.33605152e+03
  2.86663380e+03  3.02833852e+03  3.02833852e+03  3.02833852e+03
  6.64744615e+03  6.64744615e+03  6.64744615e+03  9.26685376e+03
  2.56125529e+04  7.63414633e+04]
E1 = -727.8492720223047  E_coul = 201.09651711996983
cycle= 1 E= -526.752754902335  delta_E= -0.383  |g|= 0.187  |ddm|= 0.32
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.574333
diis-c [-0.32985866  1.        ]
  HOMO = -0.590644216897757  LUMO = 0.914528965146688
  mo_energy =
[-1.18643067e+02 -1.23449045e+01 -9.59638741e+00 -9.59638741e+00
 -9.59638741e+00 -1.27955339e+00 -5.90644217e-01 -5.90644217e-01
 -5.90644217e-01  9.14528965e-01  1.01899048e+00  1.01899048e+00
  1.01899048e+00  7.44306194e+00  7.44306194e+00  7.44306194e+00
  9.97034701e+00  3.42711992e+01  3.42711992e+01  3.42711992e+01
  5.50255637e+01  1.30944475e+02  1.30944475e+02  1.30944475e+02
  2.17331022e+02  4.85316867e+02  4.85316867e+02  4.85316867e+02
  7.69140444e+02  1.33568745e+03  1.33568745e+03  1.33568745e+03
  2.86613780e+03  3.02790878e+03  3.02790878e+03  3.02790878e+03
  6.64690300e+03  6.64690300e+03  6.64690300e+03  9.26623704e+03
  2.56118409e+04  7.63406605e+04]
E1 = -728.4249392177161  E_coul = 201.6714568866825
cycle= 2 E= -526.753482331034  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0533
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0773934
diis-c [-0.00382463  0.07535033  0.92464967]
  HOMO = -0.581453680478701  LUMO = 0.922177198459022
  mo_energy =
[-1.18574562e+02 -1.23064543e+01 -9.55626488e+00 -9.55626488e+00
 -9.55626488e+00 -1.26854593e+00 -5.81453680e-01 -5.81453680e-01
 -5.81453680e-01  9.22177198e-01  1.02586100e+00  1.02586100e+00
  1.02586100e+00  7.46738774e+00  7.46738774e+00  7.46738774e+00
  9.99692360e+00  3.43119940e+01  3.43119940e+01  3.43119940e+01
  5.50702726e+01  1.31001064e+02  1.31001064e+02  1.31001064e+02
  2.17391253e+02  4.85384524e+02  4.85384524e+02  4.85384524e+02
  7.69210625e+02  1.33575921e+03  1.33575921e+03  1.33575921e+03
  2.86621280e+03  3.02798281e+03  3.02798281e+03  3.02798281e+03
  6.64697880e+03  6.64697880e+03  6.64697880e+03  9.26631363e+03
  2.56119181e+04  7.63407380e+04]
E1 = -728.2731514752178  E_coul = 201.51961004510972
cycle= 3 E= -526.753541430108  delta_E= -5.91e-05  |g|= 0.00665  |ddm|= 0.0163
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0141574
diis-c [-8.28363081e-07 -1.28760220e-03  1.50258334e-01  8.51029268e-01]
  HOMO = -0.583025337886657  LUMO = 0.92096695174087
  mo_energy =
[-1.18585087e+02 -1.23125690e+01 -9.56274609e+00 -9.56274609e+00
 -9.56274609e+00 -1.27031676e+00 -5.83025338e-01 -5.83025338e-01
 -5.83025338e-01  9.20966952e-01  1.02471180e+00  1.02471180e+00
  1.02471180e+00  7.46336334e+00  7.46336334e+00  7.46336334e+00
  9.99263903e+00  3.43054480e+01  3.43054480e+01  3.43054480e+01
  5.50632157e+01  1.30992244e+02  1.30992244e+02  1.30992244e+02
  2.17381932e+02  4.85374124e+02  4.85374124e+02  4.85374124e+02
  7.69199818e+02  1.33574818e+03  1.33574818e+03  1.33574818e+03
  2.86620112e+03  3.02797138e+03  3.02797138e+03  3.02797138e+03
  6.64696696e+03  6.64696696e+03  6.64696696e+03  9.26630157e+03
  2.56119058e+04  7.63407256e+04]
E1 = -728.2971164028156  E_coul = 201.5435728459291
cycle= 4 E= -526.753543556886  delta_E= -2.13e-06  |g|= 0.000106  |ddm|= 0.00235
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000118785
diis-c [-5.04383363e-09  8.66556483e-05 -1.23632475e-02 -7.43065537e-02
  1.08658315e+00]
  HOMO = -0.583006617249356  LUMO = 0.921001003482756
  mo_energy =
[-1.18585039e+02 -1.23124997e+01 -9.56269100e+00 -9.56269100e+00
 -9.56269100e+00 -1.27027328e+00 -5.83006617e-01 -5.83006617e-01
 -5.83006617e-01  9.21001003e-01  1.02472832e+00  1.02472832e+00
  1.02472832e+00  7.46340746e+00  7.46340746e+00  7.46340746e+00
  9.99269964e+00  3.43055014e+01  3.43055014e+01  3.43055014e+01
  5.50632769e+01  1.30992298e+02  1.30992298e+02  1.30992298e+02
  2.17381987e+02  4.85374173e+02  4.85374173e+02  4.85374173e+02
  7.69199859e+02  1.33574822e+03  1.33574822e+03  1.33574822e+03
  2.86620114e+03  3.02797141e+03  3.02797141e+03  3.02797141e+03
  6.64696697e+03  6.64696697e+03  6.64696697e+03  9.26630157e+03
  2.56119058e+04  7.63407256e+04]
E1 = -728.2968792528851  E_coul = 201.5433356939518
cycle= 5 E= -526.753543558933  delta_E= -2.05e-09  |g|= 2.1e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93066e-05
diis-c [-9.45149760e-11  1.27756202e-05 -1.76749070e-03 -1.26383042e-02
  3.47151271e-02  9.79677892e-01]
  HOMO = -0.583014440366049  LUMO = 0.920997189172885
  mo_energy =
[-1.18585071e+02 -1.23125232e+01 -9.56271643e+00 -9.56271643e+00
 -9.56271643e+00 -1.27027950e+00 -5.83014440e-01 -5.83014440e-01
 -5.83014440e-01  9.20997189e-01  1.02472305e+00  1.02472305e+00
  1.02472305e+00  7.46338994e+00  7.46338994e+00  7.46338994e+00
  9.99268235e+00  3.43054766e+01  3.43054766e+01  3.43054766e+01
  5.50632515e+01  1.30992269e+02  1.30992269e+02  1.30992269e+02
  2.17381957e+02  4.85374141e+02  4.85374141e+02  4.85374141e+02
  7.69199826e+02  1.33574819e+03  1.33574819e+03  1.33574819e+03
  2.86620111e+03  3.02797137e+03  3.02797137e+03  3.02797137e+03
  6.64696694e+03  6.64696694e+03  6.64696694e+03  9.26630154e+03
  2.56119058e+04  7.63407255e+04]
E1 = -728.2969627114363  E_coul = 201.54341915244203
cycle= 6 E= -526.753543558994  delta_E= -6.1e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2969627114363  E_coul = 201.54341915244203
  HOMO = -0.583014340456074  LUMO = 0.92099761892438
  mo_energy =
[-1.18585070e+02 -1.23125226e+01 -9.56271591e+00 -9.56271591e+00
 -9.56271591e+00 -1.27027897e+00 -5.83014340e-01 -5.83014340e-01
 -5.83014340e-01  9.20997619e-01  1.02472318e+00  1.02472318e+00
  1.02472318e+00  7.46339030e+00  7.46339030e+00  7.46339030e+00
  9.99268288e+00  3.43054771e+01  3.43054771e+01  3.43054771e+01
  5.50632521e+01  1.30992270e+02  1.30992270e+02  1.30992270e+02
  2.17381958e+02  4.85374142e+02  4.85374142e+02  4.85374142e+02
  7.69199827e+02  1.33574819e+03  1.33574819e+03  1.33574819e+03
  2.86620111e+03  3.02797137e+03  3.02797137e+03  3.02797137e+03
  6.64696694e+03  6.64696694e+03  6.64696694e+03  9.26630154e+03
  2.56119058e+04  7.63407255e+04]
E1 = -728.2969599285266  E_coul = 201.5434163695311
Extra cycle  E= -526.753543558995  delta_E= -1.14e-12  |g|= 3.9e-07  |ddm|= 3.28e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
exp = [2.61827042e+04 7.61740856e+03 3.61739347e+03 1.59530208e+03
 3.90055792e+02 1.28168370e+02 5.04084632e+01 2.02781274e+01
 7.27338168e+00 6.48106548e-01 2.88241717e+00 2.31689661e-01
 1.36279923e+03 6.64590822e+02 3.00232936e+02 3.13413945e+02
 6.18606451e+01 7.50872422e+00 2.05952873e+01 7.82143426e-01
 2.87415530e+00 2.23971154e-01]
E = -526.7535435589955
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:51 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7041936        1
[INPUT] 0    0    [1    /1   ]  7617.40856367        1
[INPUT] 0    0    [1    /1   ]  3617.39347259        1
[INPUT] 0    0    [1    /1   ]  1595.30207989        1
[INPUT] 0    0    [1    /1   ]  390.055792148        1
[INPUT] 0    0    [1    /1   ]  128.168369612        1
[INPUT] 0    0    [1    /1   ]  50.4084631815        1
[INPUT] 0    0    [1    /1   ]  20.2781274448        1
[INPUT] 0    0    [1    /1   ]  7.273381681          1
[INPUT] 0    0    [1    /1   ]  0.64810654756        1
[INPUT] 0    0    [1    /1   ]  2.88241717412        1
[INPUT] 0    0    [1    /1   ]  0.231689660716       1
[INPUT] 1    0    [1    /1   ]  1362.79923153        1
[INPUT] 1    0    [1    /1   ]  664.590822323        1
[INPUT] 1    0    [1    /1   ]  300.232935587        1
[INPUT] 1    0    [1    /1   ]  313.413945349        1
[INPUT] 1    0    [1    /1   ]  61.8606450983        1
[INPUT] 1    0    [1    /1   ]  7.5087242249         1
[INPUT] 1    0    [1    /1   ]  20.5952872854        1
[INPUT] 1    0    [1    /1   ]  0.782143426103       1
[INPUT] 1    0    [1    /1   ]  2.87415530497        1
[INPUT] 1    0    [1    /1   ]  0.223971153999       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.704193622612, 1.0]], [0, [7617.408563672743, 1.0]], [0, [3617.393472586684, 1.0]], [0, [1595.3020798895345, 1.0]], [0, [390.0557921483573, 1.0]], [0, [128.16836961242052, 1.0]], [0, [50.4084631814591, 1.0]], [0, [20.278127444769126, 1.0]], [0, [7.2733816810016805, 1.0]], [0, [0.6481065475603679, 1.0]], [0, [2.882417174121397, 1.0]], [0, [0.23168966071560834, 1.0]], [1, [1362.7992315265747, 1.0]], [1, [664.5908223227243, 1.0]], [1, [300.2329355872078, 1.0]], [1, [313.4139453492199, 1.0]], [1, [61.86064509832528, 1.0]], [1, [7.50872422489977, 1.0]], [1, [20.59528728542958, 1.0]], [1, [0.7821434261030773, 1.0]], [1, [2.8741553049689976, 1.0]], [1, [0.2239711539994337, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.70419362]
bas 1, expnt(s) = [7617.40856367]
bas 2, expnt(s) = [3617.39347259]
bas 3, expnt(s) = [1595.30207989]
bas 4, expnt(s) = [390.05579215]
bas 5, expnt(s) = [128.16836961]
bas 6, expnt(s) = [50.40846318]
bas 7, expnt(s) = [20.27812744]
bas 8, expnt(s) = [7.27338168]
bas 9, expnt(s) = [0.64810655]
bas 10, expnt(s) = [2.88241717]
bas 11, expnt(s) = [0.23168966]
bas 12, expnt(s) = [1362.79923153]
bas 13, expnt(s) = [664.59082232]
bas 14, expnt(s) = [300.23293559]
bas 15, expnt(s) = [313.41394535]
bas 16, expnt(s) = [61.8606451]
bas 17, expnt(s) = [7.50872422]
bas 18, expnt(s) = [20.59528729]
bas 19, expnt(s) = [0.78214343]
bas 20, expnt(s) = [2.8741553]
bas 21, expnt(s) = [0.22397115]
CPU time:       489.58
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827042e+04 5.20027007e+03 7.61740856e+03 2.06001537e+03
 3.61739347e+03 1.17845184e+03 1.59530208e+03 6.37745236e+02
 3.90055792e+02 2.21748184e+02 1.28168370e+02 9.62389041e+01
 5.04084632e+01 4.77961172e+01 2.02781274e+01 2.41427040e+01
 7.27338168e+00 1.11896708e+01 6.48106548e-01 1.82494521e+00
 2.88241717e+00 5.58898124e+00 2.31689661e-01 8.43713532e-01
 1.36279923e+03 2.41559567e+04 6.64590822e+02 9.84412947e+03
 3.00232936e+02 3.64592146e+03 3.13413945e+02 3.84708948e+03
 6.18606451e+01 5.06118775e+02 7.50872422e+00 3.62611927e+01
 2.05952873e+01 1.27995355e+02 7.82143426e-01 2.14581557e+00
 2.87415530e+00 1.09174744e+01 2.23971154e-01 4.49494624e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993562115748922
cond(S) = 113515.1444399543
E1 = -729.5449984089071  E_coul = 203.17559900204884
init E= -526.369399406858
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555718050901026  LUMO = 0.94064658011609
  mo_energy =
[-1.18334231e+02 -1.22067917e+01 -9.44718859e+00 -9.44718859e+00
 -9.44718859e+00 -1.24022490e+00 -5.55718051e-01 -5.55718051e-01
 -5.55718051e-01  9.40646580e-01  1.04364899e+00  1.04364899e+00
  1.04364899e+00  7.53543326e+00  7.53543326e+00  7.53543326e+00
  1.00666780e+01  3.44273504e+01  3.44273504e+01  3.44273504e+01
  5.51916697e+01  1.31173912e+02  1.31173912e+02  1.31173912e+02
  2.17577146e+02  4.85624342e+02  4.85624342e+02  4.85624342e+02
  7.69491252e+02  1.33605152e+03  1.33605152e+03  1.33605152e+03
  2.86663380e+03  3.02833852e+03  3.02833852e+03  3.02833852e+03
  6.64744615e+03  6.64744615e+03  6.64744615e+03  9.26685376e+03
  2.56125529e+04  7.63414633e+04]
E1 = -727.8492720223047  E_coul = 201.09651711996983
cycle= 1 E= -526.752754902335  delta_E= -0.383  |g|= 0.187  |ddm|= 0.32
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.574333
diis-c [-0.32985866  1.        ]
  HOMO = -0.590644216897757  LUMO = 0.914528965146688
  mo_energy =
[-1.18643067e+02 -1.23449045e+01 -9.59638741e+00 -9.59638741e+00
 -9.59638741e+00 -1.27955339e+00 -5.90644217e-01 -5.90644217e-01
 -5.90644217e-01  9.14528965e-01  1.01899048e+00  1.01899048e+00
  1.01899048e+00  7.44306194e+00  7.44306194e+00  7.44306194e+00
  9.97034701e+00  3.42711992e+01  3.42711992e+01  3.42711992e+01
  5.50255637e+01  1.30944475e+02  1.30944475e+02  1.30944475e+02
  2.17331022e+02  4.85316867e+02  4.85316867e+02  4.85316867e+02
  7.69140444e+02  1.33568745e+03  1.33568745e+03  1.33568745e+03
  2.86613780e+03  3.02790878e+03  3.02790878e+03  3.02790878e+03
  6.64690300e+03  6.64690300e+03  6.64690300e+03  9.26623704e+03
  2.56118409e+04  7.63406605e+04]
E1 = -728.4249392177161  E_coul = 201.6714568866825
cycle= 2 E= -526.753482331034  delta_E= -0.000727  |g|= 0.0379  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0773934
diis-c [-0.00382463  0.07535033  0.92464967]
  HOMO = -0.581453680478701  LUMO = 0.922177198459022
  mo_energy =
[-1.18574562e+02 -1.23064543e+01 -9.55626488e+00 -9.55626488e+00
 -9.55626488e+00 -1.26854593e+00 -5.81453680e-01 -5.81453680e-01
 -5.81453680e-01  9.22177198e-01  1.02586100e+00  1.02586100e+00
  1.02586100e+00  7.46738774e+00  7.46738774e+00  7.46738774e+00
  9.99692360e+00  3.43119940e+01  3.43119940e+01  3.43119940e+01
  5.50702726e+01  1.31001064e+02  1.31001064e+02  1.31001064e+02
  2.17391253e+02  4.85384524e+02  4.85384524e+02  4.85384524e+02
  7.69210625e+02  1.33575921e+03  1.33575921e+03  1.33575921e+03
  2.86621280e+03  3.02798281e+03  3.02798281e+03  3.02798281e+03
  6.64697880e+03  6.64697880e+03  6.64697880e+03  9.26631363e+03
  2.56119181e+04  7.63407380e+04]
E1 = -728.2731514752178  E_coul = 201.51961004510972
cycle= 3 E= -526.753541430108  delta_E= -5.91e-05  |g|= 0.00665  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0141574
diis-c [-8.28363081e-07 -1.28760220e-03  1.50258334e-01  8.51029268e-01]
  HOMO = -0.583025337886657  LUMO = 0.92096695174087
  mo_energy =
[-1.18585087e+02 -1.23125690e+01 -9.56274609e+00 -9.56274609e+00
 -9.56274609e+00 -1.27031676e+00 -5.83025338e-01 -5.83025338e-01
 -5.83025338e-01  9.20966952e-01  1.02471180e+00  1.02471180e+00
  1.02471180e+00  7.46336334e+00  7.46336334e+00  7.46336334e+00
  9.99263903e+00  3.43054480e+01  3.43054480e+01  3.43054480e+01
  5.50632157e+01  1.30992244e+02  1.30992244e+02  1.30992244e+02
  2.17381932e+02  4.85374124e+02  4.85374124e+02  4.85374124e+02
  7.69199818e+02  1.33574818e+03  1.33574818e+03  1.33574818e+03
  2.86620112e+03  3.02797138e+03  3.02797138e+03  3.02797138e+03
  6.64696696e+03  6.64696696e+03  6.64696696e+03  9.26630157e+03
  2.56119058e+04  7.63407256e+04]
E1 = -728.2971164028156  E_coul = 201.5435728459291
cycle= 4 E= -526.753543556886  delta_E= -2.13e-06  |g|= 0.000106  |ddm|= 0.00235
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000118785
diis-c [-5.04383363e-09  8.66556483e-05 -1.23632475e-02 -7.43065537e-02
  1.08658315e+00]
  HOMO = -0.583006617249356  LUMO = 0.921001003482756
  mo_energy =
[-1.18585039e+02 -1.23124997e+01 -9.56269100e+00 -9.56269100e+00
 -9.56269100e+00 -1.27027328e+00 -5.83006617e-01 -5.83006617e-01
 -5.83006617e-01  9.21001003e-01  1.02472832e+00  1.02472832e+00
  1.02472832e+00  7.46340746e+00  7.46340746e+00  7.46340746e+00
  9.99269964e+00  3.43055014e+01  3.43055014e+01  3.43055014e+01
  5.50632769e+01  1.30992298e+02  1.30992298e+02  1.30992298e+02
  2.17381987e+02  4.85374173e+02  4.85374173e+02  4.85374173e+02
  7.69199859e+02  1.33574822e+03  1.33574822e+03  1.33574822e+03
  2.86620114e+03  3.02797141e+03  3.02797141e+03  3.02797141e+03
  6.64696697e+03  6.64696697e+03  6.64696697e+03  9.26630157e+03
  2.56119058e+04  7.63407256e+04]
E1 = -728.2968792528851  E_coul = 201.5433356939518
cycle= 5 E= -526.753543558933  delta_E= -2.05e-09  |g|= 2.1e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93066e-05
diis-c [-9.45149760e-11  1.27756202e-05 -1.76749070e-03 -1.26383042e-02
  3.47151271e-02  9.79677892e-01]
  HOMO = -0.583014440366049  LUMO = 0.920997189172885
  mo_energy =
[-1.18585071e+02 -1.23125232e+01 -9.56271643e+00 -9.56271643e+00
 -9.56271643e+00 -1.27027950e+00 -5.83014440e-01 -5.83014440e-01
 -5.83014440e-01  9.20997189e-01  1.02472305e+00  1.02472305e+00
  1.02472305e+00  7.46338994e+00  7.46338994e+00  7.46338994e+00
  9.99268235e+00  3.43054766e+01  3.43054766e+01  3.43054766e+01
  5.50632515e+01  1.30992269e+02  1.30992269e+02  1.30992269e+02
  2.17381957e+02  4.85374141e+02  4.85374141e+02  4.85374141e+02
  7.69199826e+02  1.33574819e+03  1.33574819e+03  1.33574819e+03
  2.86620111e+03  3.02797137e+03  3.02797137e+03  3.02797137e+03
  6.64696694e+03  6.64696694e+03  6.64696694e+03  9.26630154e+03
  2.56119058e+04  7.63407255e+04]
E1 = -728.2969627114363  E_coul = 201.54341915244203
cycle= 6 E= -526.753543558994  delta_E= -6.1e-11  |g|= 1.85e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2969627114363  E_coul = 201.54341915244203
  HOMO = -0.583014340456074  LUMO = 0.92099761892438
  mo_energy =
[-1.18585070e+02 -1.23125226e+01 -9.56271591e+00 -9.56271591e+00
 -9.56271591e+00 -1.27027897e+00 -5.83014340e-01 -5.83014340e-01
 -5.83014340e-01  9.20997619e-01  1.02472318e+00  1.02472318e+00
  1.02472318e+00  7.46339030e+00  7.46339030e+00  7.46339030e+00
  9.99268288e+00  3.43054771e+01  3.43054771e+01  3.43054771e+01
  5.50632521e+01  1.30992270e+02  1.30992270e+02  1.30992270e+02
  2.17381958e+02  4.85374142e+02  4.85374142e+02  4.85374142e+02
  7.69199827e+02  1.33574819e+03  1.33574819e+03  1.33574819e+03
  2.86620111e+03  3.02797137e+03  3.02797137e+03  3.02797137e+03
  6.64696694e+03  6.64696694e+03  6.64696694e+03  9.26630154e+03
  2.56119058e+04  7.63407255e+04]
E1 = -728.2969599285266  E_coul = 201.5434163695311
Extra cycle  E= -526.753543558995  delta_E= -1.14e-12  |g|= 3.9e-07  |ddm|= 3.28e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113515.1444399543
E1 = -728.2969599285266  E_coul = 201.5434163695311
init E= -526.753543558995
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.58301440973554  LUMO = 0.920997635586698
  mo_energy =
[-1.18585070e+02 -1.23125228e+01 -9.56271614e+00 -9.56271614e+00
 -9.56271614e+00 -1.27027897e+00 -5.83014410e-01 -5.83014410e-01
 -5.83014410e-01  9.20997636e-01  1.02472315e+00  1.02472315e+00
  1.02472315e+00  7.46339015e+00  7.46339015e+00  7.46339015e+00
  9.99268276e+00  3.43054769e+01  3.43054769e+01  3.43054769e+01
  5.50632519e+01  1.30992269e+02  1.30992269e+02  1.30992269e+02
  2.17381957e+02  4.85374142e+02  4.85374142e+02  4.85374142e+02
  7.69199827e+02  1.33574819e+03  1.33574819e+03  1.33574819e+03
  2.86620111e+03  3.02797137e+03  3.02797137e+03  3.02797137e+03
  6.64696694e+03  6.64696694e+03  6.64696694e+03  9.26630154e+03
  2.56119058e+04  7.63407255e+04]
E1 = -728.296960559202  E_coul = 201.54341700020726
cycle= 1 E= -526.753543558995  delta_E= 6.82e-13  |g|= 8.91e-08  |ddm|= 6.12e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.296960559202  E_coul = 201.54341700020726
  HOMO = -0.583014400905735  LUMO = 0.920997657540936
  mo_energy =
[-1.18585070e+02 -1.23125228e+01 -9.56271609e+00 -9.56271609e+00
 -9.56271609e+00 -1.27027894e+00 -5.83014401e-01 -5.83014401e-01
 -5.83014401e-01  9.20997658e-01  1.02472315e+00  1.02472315e+00
  1.02472315e+00  7.46339018e+00  7.46339018e+00  7.46339018e+00
  9.99268279e+00  3.43054770e+01  3.43054770e+01  3.43054770e+01
  5.50632519e+01  1.30992269e+02  1.30992269e+02  1.30992269e+02
  2.17381957e+02  4.85374142e+02  4.85374142e+02  4.85374142e+02
  7.69199827e+02  1.33574819e+03  1.33574819e+03  1.33574819e+03
  2.86620111e+03  3.02797137e+03  3.02797137e+03  3.02797137e+03
  6.64696694e+03  6.64696694e+03  6.64696694e+03  9.26630154e+03
  2.56119058e+04  7.63407255e+04]
E1 = -728.2969603509906  E_coul = 201.54341679199374
Extra cycle  E= -526.753543558997  delta_E= -2.05e-12  |g|= 1.92e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.43 sec
exp = [2.61827042e+04 7.61740856e+03 3.61739347e+03 1.59530208e+03
 3.90055792e+02 1.28168370e+02 5.04084632e+01 2.02781274e+01
 7.27338168e+00 6.48106548e-01 2.88241717e+00 2.31689661e-01
 1.36279923e+03 6.64590822e+02 3.00232936e+02 3.13413945e+02
 6.18606451e+01 7.50872422e+00 2.05952873e+01 7.82143426e-01
 2.87415530e+00 2.23971154e-01]
grad_E = [-1.57251167e-06  3.95107362e-06 -1.18993847e-06  9.43982012e-05
 -5.91883691e-04  2.62336150e-04  2.28685653e-04 -3.17678537e-04
  1.27241349e-04 -8.40624098e-04 -4.73403215e-04  1.42031056e-03
 -4.93294590e-07  5.24492237e-06  2.51602598e-05  2.16442339e-05
 -2.02628550e-04  4.53471983e-04  5.13795223e-04 -5.21084025e-04
 -4.41445914e-04  1.41110723e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:55 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7115496        1
[INPUT] 0    0    [1    /1   ]  7617.39123749        1
[INPUT] 0    0    [1    /1   ]  3617.39989955        1
[INPUT] 0    0    [1    /1   ]  1594.91464964        1
[INPUT] 0    0    [1    /1   ]  391.255243741        1
[INPUT] 0    0    [1    /1   ]  130.81715417         1
[INPUT] 0    0    [1    /1   ]  53.0989407922        1
[INPUT] 0    0    [1    /1   ]  22.2442437226        1
[INPUT] 0    0    [1    /1   ]  7.40660802531        1
[INPUT] 0    0    [1    /1   ]  0.647701425908       1
[INPUT] 0    0    [1    /1   ]  2.91659005006        1
[INPUT] 0    0    [1    /1   ]  0.232122649997       1
[INPUT] 1    0    [1    /1   ]  1362.80166447        1
[INPUT] 1    0    [1    /1   ]  664.567239435        1
[INPUT] 1    0    [1    /1   ]  300.121843101        1
[INPUT] 1    0    [1    /1   ]  313.318206485        1
[INPUT] 1    0    [1    /1   ]  61.9243406989        1
[INPUT] 1    0    [1    /1   ]  7.48835677784        1
[INPUT] 1    0    [1    /1   ]  20.5793520246        1
[INPUT] 1    0    [1    /1   ]  0.780923206607       1
[INPUT] 1    0    [1    /1   ]  2.86221287513        1
[INPUT] 1    0    [1    /1   ]  0.223745801502       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.711549647272, 1.0]], [0, [7617.391237494261, 1.0]], [0, [3617.3998995460884, 1.0]], [0, [1594.9146496365343, 1.0]], [0, [391.2552437407279, 1.0]], [0, [130.8171541704162, 1.0]], [0, [53.09894079216127, 1.0]], [0, [22.24424372257319, 1.0]], [0, [7.406608025314231, 1.0]], [0, [0.6477014259076751, 1.0]], [0, [2.916590050055034, 1.0]], [0, [0.2321226499967989, 1.0]], [1, [1362.8016644682714, 1.0]], [1, [664.5672394352407, 1.0]], [1, [300.1218431012915, 1.0]], [1, [313.31820648483193, 1.0]], [1, [61.92434069886452, 1.0]], [1, [7.4883567778360165, 1.0]], [1, [20.579352024559626, 1.0]], [1, [0.7809232066072401, 1.0]], [1, [2.8622128751324483, 1.0]], [1, [0.22374580150243842, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.71154965]
bas 1, expnt(s) = [7617.39123749]
bas 2, expnt(s) = [3617.39989955]
bas 3, expnt(s) = [1594.91464964]
bas 4, expnt(s) = [391.25524374]
bas 5, expnt(s) = [130.81715417]
bas 6, expnt(s) = [53.09894079]
bas 7, expnt(s) = [22.24424372]
bas 8, expnt(s) = [7.40660803]
bas 9, expnt(s) = [0.64770143]
bas 10, expnt(s) = [2.91659005]
bas 11, expnt(s) = [0.23212265]
bas 12, expnt(s) = [1362.80166447]
bas 13, expnt(s) = [664.56723944]
bas 14, expnt(s) = [300.1218431]
bas 15, expnt(s) = [313.31820648]
bas 16, expnt(s) = [61.9243407]
bas 17, expnt(s) = [7.48835678]
bas 18, expnt(s) = [20.57935202]
bas 19, expnt(s) = [0.78092321]
bas 20, expnt(s) = [2.86221288]
bas 21, expnt(s) = [0.2237458]
CPU time:       495.12
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827115e+04 5.20027116e+03 7.61739124e+03 2.06001186e+03
 3.61739990e+03 1.17845341e+03 1.59491465e+03 6.37629071e+02
 3.91255244e+02 2.22259408e+02 1.30817154e+02 9.77267705e+01
 5.30989408e+01 4.96969136e+01 2.22442437e+01 2.58778540e+01
 7.40660803e+00 1.13430421e+01 6.47701426e-01 1.82408959e+00
 2.91659005e+00 5.63860363e+00 2.32122650e-01 8.44895825e-01
 1.36280166e+03 2.41560106e+04 6.64567239e+02 9.84369283e+03
 3.00121843e+02 3.64423520e+03 3.13318206e+02 3.84562057e+03
 6.19243407e+01 5.06770273e+02 7.48835678e+00 3.61382862e+01
 2.05793520e+01 1.27871574e+02 7.80923207e-01 2.14163178e+00
 2.86221288e+00 1.08607997e+01 2.23745802e-01 4.48929362e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993598983700124
cond(S) = 113484.44153798801
E1 = -729.5447851836694  E_coul = 203.17556535753394
init E= -526.369219826135
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555729439016503  LUMO = 0.943568686513719
  mo_energy =
[-1.18334329e+02 -1.22067332e+01 -9.44718577e+00 -9.44718577e+00
 -9.44718577e+00 -1.24021389e+00 -5.55729439e-01 -5.55729439e-01
 -5.55729439e-01  9.43568687e-01  1.04165102e+00  1.04165102e+00
  1.04165102e+00  7.50381255e+00  7.50381255e+00  7.50381255e+00
  1.03521736e+01  3.43209339e+01  3.43209339e+01  3.43209339e+01
  5.90836871e+01  1.31073758e+02  1.31073758e+02  1.31073758e+02
  2.31338234e+02  4.85577664e+02  4.85577664e+02  4.85577664e+02
  7.94342887e+02  1.33583287e+03  1.33583287e+03  1.33583287e+03
  2.89677286e+03  3.02783892e+03  3.02783892e+03  3.02783892e+03
  6.64675294e+03  6.64675294e+03  6.64675294e+03  9.29663079e+03
  2.56409715e+04  7.63679481e+04]
E1 = -727.848306975863  E_coul = 201.09547998670217
cycle= 1 E= -526.752826989161  delta_E= -0.384  |g|= 0.187  |ddm|= 0.317
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.57751
diis-c [-0.33351784  1.        ]
  HOMO = -0.590651812014518  LUMO = 0.917311641148556
  mo_energy =
[-1.18643335e+02 -1.23449250e+01 -9.59647124e+00 -9.59647124e+00
 -9.59647124e+00 -1.27954539e+00 -5.90651812e-01 -5.90651812e-01
 -5.90651812e-01  9.17311641e-01  1.01704713e+00  1.01704713e+00
  1.01704713e+00  7.41161274e+00  7.41161274e+00  7.41161274e+00
  1.02540802e+01  3.41647911e+01  3.41647911e+01  3.41647911e+01
  5.89128908e+01  1.30844083e+02  1.30844083e+02  1.30844083e+02
  2.31088614e+02  4.85270064e+02  4.85270064e+02  4.85270064e+02
  7.93990933e+02  1.33546860e+03  1.33546860e+03  1.33546860e+03
  2.89627690e+03  3.02740901e+03  3.02740901e+03  3.02740901e+03
  6.64620962e+03  6.64620962e+03  6.64620962e+03  9.29601415e+03
  2.56402594e+04  7.63671451e+04]
E1 = -728.4243021627406  E_coul = 201.67074716613809
cycle= 2 E= -526.753554996602  delta_E= -0.000728  |g|= 0.0379  |ddm|= 0.0533
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0774232
diis-c [-0.00386641  0.07436879  0.92563121]
  HOMO = -0.58144196815494  LUMO = 0.92501210237588
  mo_energy =
[-1.18574726e+02 -1.23064127e+01 -9.55628605e+00 -9.55628605e+00
 -9.55628605e+00 -1.26851577e+00 -5.81441968e-01 -5.81441968e-01
 -5.81441968e-01  9.25012102e-01  1.02391566e+00  1.02391566e+00
  1.02391566e+00  7.43592516e+00  7.43592516e+00  7.43592516e+00
  1.02811937e+01  3.42056296e+01  3.42056296e+01  3.42056296e+01
  5.89587754e+01  1.30900768e+02  1.30900768e+02  1.30900768e+02
  2.31149469e+02  4.85337826e+02  4.85337826e+02  4.85337826e+02
  7.94061282e+02  1.33554047e+03  1.33554047e+03  1.33554047e+03
  2.89635200e+03  3.02748316e+03  3.02748316e+03  3.02748316e+03
  6.64628553e+03  6.64628553e+03  6.64628553e+03  9.29609085e+03
  2.56403367e+04  7.63672227e+04]
E1 = -728.2722837550176  E_coul = 201.5186696431403
cycle= 3 E= -526.753614111877  delta_E= -5.91e-05  |g|= 0.0067  |ddm|= 0.0163
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0142587
diis-c [-8.26350994e-07 -1.28706045e-03  1.51176610e-01  8.50110450e-01]
  HOMO = -0.583024035194066  LUMO = 0.923786946607843
  mo_energy =
[-1.18585328e+02 -1.23125705e+01 -9.56281211e+00 -9.56281211e+00
 -9.56281211e+00 -1.27029946e+00 -5.83024035e-01 -5.83024035e-01
 -5.83024035e-01  9.23786947e-01  1.02276131e+00  1.02276131e+00
  1.02276131e+00  7.43188237e+00  7.43188237e+00  7.43188237e+00
  1.02768043e+01  3.41990410e+01  3.41990410e+01  3.41990410e+01
  5.89515057e+01  1.30891883e+02  1.30891883e+02  1.30891883e+02
  2.31140003e+02  4.85327350e+02  4.85327350e+02  4.85327350e+02
  7.94050387e+02  1.33552936e+03  1.33552936e+03  1.33552936e+03
  2.89634024e+03  3.02747164e+03  3.02747164e+03  3.02747164e+03
  6.64627360e+03  6.64627360e+03  6.64627360e+03  9.29607870e+03
  2.56403244e+04  7.63672103e+04]
E1 = -728.2964193812298  E_coul = 201.54280311299257
cycle= 4 E= -526.753616268237  delta_E= -2.16e-06  |g|= 0.000106  |ddm|= 0.00237
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000118068
diis-c [-4.94095086e-09  8.53951258e-05 -1.22311900e-02 -7.30999549e-02
  1.08524575e+00]
  HOMO = -0.5830053449269  LUMO = 0.923820981918214
  mo_energy =
[-1.18585281e+02 -1.23125014e+01 -9.56275728e+00 -9.56275728e+00
 -9.56275728e+00 -1.27025616e+00 -5.83005345e-01 -5.83005345e-01
 -5.83005345e-01  9.23820982e-01  1.02277776e+00  1.02277776e+00
  1.02277776e+00  7.43192628e+00  7.43192628e+00  7.43192628e+00
  1.02768651e+01  3.41990941e+01  3.41990941e+01  3.41990941e+01
  5.89515666e+01  1.30891937e+02  1.30891937e+02  1.30891937e+02
  2.31140057e+02  4.85327398e+02  4.85327398e+02  4.85327398e+02
  7.94050426e+02  1.33552940e+03  1.33552940e+03  1.33552940e+03
  2.89634026e+03  3.02747167e+03  3.02747167e+03  3.02747167e+03
  6.64627362e+03  6.64627362e+03  6.64627362e+03  9.29607870e+03
  2.56403244e+04  7.63672103e+04]
E1 = -728.2961837129  E_coul = 201.54256744263898
cycle= 5 E= -526.753616270261  delta_E= -2.02e-09  |g|= 2.1e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93499e-05
diis-c [-9.32027537e-11  1.27442191e-05 -1.78043215e-03 -1.26260891e-02
  3.48053052e-02  9.79588472e-01]
  HOMO = -0.583013130819591  LUMO = 0.923817180649708
  mo_energy =
[-1.18585312e+02 -1.23125248e+01 -9.56278260e+00 -9.56278260e+00
 -9.56278260e+00 -1.27026233e+00 -5.83013131e-01 -5.83013131e-01
 -5.83013131e-01  9.23817181e-01  1.02277254e+00  1.02277254e+00
  1.02277254e+00  7.43190888e+00  7.43190888e+00  7.43190888e+00
  1.02768477e+01  3.41990695e+01  3.41990695e+01  3.41990695e+01
  5.89515409e+01  1.30891908e+02  1.30891908e+02  1.30891908e+02
  2.31140027e+02  4.85327367e+02  4.85327367e+02  4.85327367e+02
  7.94050394e+02  1.33552936e+03  1.33552936e+03  1.33552936e+03
  2.89634023e+03  3.02747164e+03  3.02747164e+03  3.02747164e+03
  6.64627358e+03  6.64627358e+03  6.64627358e+03  9.29607867e+03
  2.56403243e+04  7.63672102e+04]
E1 = -728.2962668457197  E_coul = 201.54265057539604
cycle= 6 E= -526.753616270324  delta_E= -6.28e-11  |g|= 1.86e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2962668457197  E_coul = 201.54265057539604
  HOMO = -0.583013040154509  LUMO = 0.923817606233026
  mo_energy =
[-1.18585311e+02 -1.23125242e+01 -9.56278212e+00 -9.56278212e+00
 -9.56278212e+00 -1.27026181e+00 -5.83013040e-01 -5.83013040e-01
 -5.83013040e-01  9.23817606e-01  1.02277267e+00  1.02277267e+00
  1.02277267e+00  7.43190921e+00  7.43190921e+00  7.43190921e+00
  1.02768482e+01  3.41990700e+01  3.41990700e+01  3.41990700e+01
  5.89515415e+01  1.30891909e+02  1.30891909e+02  1.30891909e+02
  2.31140028e+02  4.85327368e+02  4.85327368e+02  4.85327368e+02
  7.94050395e+02  1.33552936e+03  1.33552936e+03  1.33552936e+03
  2.89634023e+03  3.02747164e+03  3.02747164e+03  3.02747164e+03
  6.64627358e+03  6.64627358e+03  6.64627358e+03  9.29607867e+03
  2.56403243e+04  7.63672102e+04]
E1 = -728.2962641840569  E_coul = 201.54264791373126
Extra cycle  E= -526.753616270326  delta_E= -1.93e-12  |g|= 3.9e-07  |ddm|= 3.29e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
exp = [2.61827115e+04 7.61739124e+03 3.61739990e+03 1.59491465e+03
 3.91255244e+02 1.30817154e+02 5.30989408e+01 2.22442437e+01
 7.40660803e+00 6.47701426e-01 2.91659005e+00 2.32122650e-01
 1.36280166e+03 6.64567239e+02 3.00121843e+02 3.13318206e+02
 6.19243407e+01 7.48835678e+00 2.05793520e+01 7.80923207e-01
 2.86221288e+00 2.23745802e-01]
E = -526.7536162703257
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:27:55 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7115496        1
[INPUT] 0    0    [1    /1   ]  7617.39123749        1
[INPUT] 0    0    [1    /1   ]  3617.39989955        1
[INPUT] 0    0    [1    /1   ]  1594.91464964        1
[INPUT] 0    0    [1    /1   ]  391.255243741        1
[INPUT] 0    0    [1    /1   ]  130.81715417         1
[INPUT] 0    0    [1    /1   ]  53.0989407922        1
[INPUT] 0    0    [1    /1   ]  22.2442437226        1
[INPUT] 0    0    [1    /1   ]  7.40660802531        1
[INPUT] 0    0    [1    /1   ]  0.647701425908       1
[INPUT] 0    0    [1    /1   ]  2.91659005006        1
[INPUT] 0    0    [1    /1   ]  0.232122649997       1
[INPUT] 1    0    [1    /1   ]  1362.80166447        1
[INPUT] 1    0    [1    /1   ]  664.567239435        1
[INPUT] 1    0    [1    /1   ]  300.121843101        1
[INPUT] 1    0    [1    /1   ]  313.318206485        1
[INPUT] 1    0    [1    /1   ]  61.9243406989        1
[INPUT] 1    0    [1    /1   ]  7.48835677784        1
[INPUT] 1    0    [1    /1   ]  20.5793520246        1
[INPUT] 1    0    [1    /1   ]  0.780923206607       1
[INPUT] 1    0    [1    /1   ]  2.86221287513        1
[INPUT] 1    0    [1    /1   ]  0.223745801502       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.711549647272, 1.0]], [0, [7617.391237494261, 1.0]], [0, [3617.3998995460884, 1.0]], [0, [1594.9146496365343, 1.0]], [0, [391.2552437407279, 1.0]], [0, [130.8171541704162, 1.0]], [0, [53.09894079216127, 1.0]], [0, [22.24424372257319, 1.0]], [0, [7.406608025314231, 1.0]], [0, [0.6477014259076751, 1.0]], [0, [2.916590050055034, 1.0]], [0, [0.2321226499967989, 1.0]], [1, [1362.8016644682714, 1.0]], [1, [664.5672394352407, 1.0]], [1, [300.1218431012915, 1.0]], [1, [313.31820648483193, 1.0]], [1, [61.92434069886452, 1.0]], [1, [7.4883567778360165, 1.0]], [1, [20.579352024559626, 1.0]], [1, [0.7809232066072401, 1.0]], [1, [2.8622128751324483, 1.0]], [1, [0.22374580150243842, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.71154965]
bas 1, expnt(s) = [7617.39123749]
bas 2, expnt(s) = [3617.39989955]
bas 3, expnt(s) = [1594.91464964]
bas 4, expnt(s) = [391.25524374]
bas 5, expnt(s) = [130.81715417]
bas 6, expnt(s) = [53.09894079]
bas 7, expnt(s) = [22.24424372]
bas 8, expnt(s) = [7.40660803]
bas 9, expnt(s) = [0.64770143]
bas 10, expnt(s) = [2.91659005]
bas 11, expnt(s) = [0.23212265]
bas 12, expnt(s) = [1362.80166447]
bas 13, expnt(s) = [664.56723944]
bas 14, expnt(s) = [300.1218431]
bas 15, expnt(s) = [313.31820648]
bas 16, expnt(s) = [61.9243407]
bas 17, expnt(s) = [7.48835678]
bas 18, expnt(s) = [20.57935202]
bas 19, expnt(s) = [0.78092321]
bas 20, expnt(s) = [2.86221288]
bas 21, expnt(s) = [0.2237458]
CPU time:       495.62
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827115e+04 5.20027116e+03 7.61739124e+03 2.06001186e+03
 3.61739990e+03 1.17845341e+03 1.59491465e+03 6.37629071e+02
 3.91255244e+02 2.22259408e+02 1.30817154e+02 9.77267705e+01
 5.30989408e+01 4.96969136e+01 2.22442437e+01 2.58778540e+01
 7.40660803e+00 1.13430421e+01 6.47701426e-01 1.82408959e+00
 2.91659005e+00 5.63860363e+00 2.32122650e-01 8.44895825e-01
 1.36280166e+03 2.41560106e+04 6.64567239e+02 9.84369283e+03
 3.00121843e+02 3.64423520e+03 3.13318206e+02 3.84562057e+03
 6.19243407e+01 5.06770273e+02 7.48835678e+00 3.61382862e+01
 2.05793520e+01 1.27871574e+02 7.80923207e-01 2.14163178e+00
 2.86221288e+00 1.08607997e+01 2.23745802e-01 4.48929362e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993598983700124
cond(S) = 113484.44153798801
E1 = -729.5447851836694  E_coul = 203.17556535753394
init E= -526.369219826135
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555729439016503  LUMO = 0.943568686513719
  mo_energy =
[-1.18334329e+02 -1.22067332e+01 -9.44718577e+00 -9.44718577e+00
 -9.44718577e+00 -1.24021389e+00 -5.55729439e-01 -5.55729439e-01
 -5.55729439e-01  9.43568687e-01  1.04165102e+00  1.04165102e+00
  1.04165102e+00  7.50381255e+00  7.50381255e+00  7.50381255e+00
  1.03521736e+01  3.43209339e+01  3.43209339e+01  3.43209339e+01
  5.90836871e+01  1.31073758e+02  1.31073758e+02  1.31073758e+02
  2.31338234e+02  4.85577664e+02  4.85577664e+02  4.85577664e+02
  7.94342887e+02  1.33583287e+03  1.33583287e+03  1.33583287e+03
  2.89677286e+03  3.02783892e+03  3.02783892e+03  3.02783892e+03
  6.64675294e+03  6.64675294e+03  6.64675294e+03  9.29663079e+03
  2.56409715e+04  7.63679481e+04]
E1 = -727.848306975863  E_coul = 201.09547998670217
cycle= 1 E= -526.752826989161  delta_E= -0.384  |g|= 0.187  |ddm|= 0.317
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.57751
diis-c [-0.33351784  1.        ]
  HOMO = -0.590651812014518  LUMO = 0.917311641148556
  mo_energy =
[-1.18643335e+02 -1.23449250e+01 -9.59647124e+00 -9.59647124e+00
 -9.59647124e+00 -1.27954539e+00 -5.90651812e-01 -5.90651812e-01
 -5.90651812e-01  9.17311641e-01  1.01704713e+00  1.01704713e+00
  1.01704713e+00  7.41161274e+00  7.41161274e+00  7.41161274e+00
  1.02540802e+01  3.41647911e+01  3.41647911e+01  3.41647911e+01
  5.89128908e+01  1.30844083e+02  1.30844083e+02  1.30844083e+02
  2.31088614e+02  4.85270064e+02  4.85270064e+02  4.85270064e+02
  7.93990933e+02  1.33546860e+03  1.33546860e+03  1.33546860e+03
  2.89627690e+03  3.02740901e+03  3.02740901e+03  3.02740901e+03
  6.64620962e+03  6.64620962e+03  6.64620962e+03  9.29601415e+03
  2.56402594e+04  7.63671451e+04]
E1 = -728.4243021627406  E_coul = 201.67074716613809
cycle= 2 E= -526.753554996602  delta_E= -0.000728  |g|= 0.0379  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0774232
diis-c [-0.00386641  0.07436879  0.92563121]
  HOMO = -0.58144196815494  LUMO = 0.92501210237588
  mo_energy =
[-1.18574726e+02 -1.23064127e+01 -9.55628605e+00 -9.55628605e+00
 -9.55628605e+00 -1.26851577e+00 -5.81441968e-01 -5.81441968e-01
 -5.81441968e-01  9.25012102e-01  1.02391566e+00  1.02391566e+00
  1.02391566e+00  7.43592516e+00  7.43592516e+00  7.43592516e+00
  1.02811937e+01  3.42056296e+01  3.42056296e+01  3.42056296e+01
  5.89587754e+01  1.30900768e+02  1.30900768e+02  1.30900768e+02
  2.31149469e+02  4.85337826e+02  4.85337826e+02  4.85337826e+02
  7.94061282e+02  1.33554047e+03  1.33554047e+03  1.33554047e+03
  2.89635200e+03  3.02748316e+03  3.02748316e+03  3.02748316e+03
  6.64628553e+03  6.64628553e+03  6.64628553e+03  9.29609085e+03
  2.56403367e+04  7.63672227e+04]
E1 = -728.2722837550176  E_coul = 201.5186696431403
cycle= 3 E= -526.753614111877  delta_E= -5.91e-05  |g|= 0.0067  |ddm|= 0.0163
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0142587
diis-c [-8.26350994e-07 -1.28706045e-03  1.51176610e-01  8.50110450e-01]
  HOMO = -0.583024035194066  LUMO = 0.923786946607843
  mo_energy =
[-1.18585328e+02 -1.23125705e+01 -9.56281211e+00 -9.56281211e+00
 -9.56281211e+00 -1.27029946e+00 -5.83024035e-01 -5.83024035e-01
 -5.83024035e-01  9.23786947e-01  1.02276131e+00  1.02276131e+00
  1.02276131e+00  7.43188237e+00  7.43188237e+00  7.43188237e+00
  1.02768043e+01  3.41990410e+01  3.41990410e+01  3.41990410e+01
  5.89515057e+01  1.30891883e+02  1.30891883e+02  1.30891883e+02
  2.31140003e+02  4.85327350e+02  4.85327350e+02  4.85327350e+02
  7.94050387e+02  1.33552936e+03  1.33552936e+03  1.33552936e+03
  2.89634024e+03  3.02747164e+03  3.02747164e+03  3.02747164e+03
  6.64627360e+03  6.64627360e+03  6.64627360e+03  9.29607870e+03
  2.56403244e+04  7.63672103e+04]
E1 = -728.2964193812298  E_coul = 201.54280311299257
cycle= 4 E= -526.753616268237  delta_E= -2.16e-06  |g|= 0.000106  |ddm|= 0.00237
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000118068
diis-c [-4.94095086e-09  8.53951258e-05 -1.22311900e-02 -7.30999549e-02
  1.08524575e+00]
  HOMO = -0.5830053449269  LUMO = 0.923820981918214
  mo_energy =
[-1.18585281e+02 -1.23125014e+01 -9.56275728e+00 -9.56275728e+00
 -9.56275728e+00 -1.27025616e+00 -5.83005345e-01 -5.83005345e-01
 -5.83005345e-01  9.23820982e-01  1.02277776e+00  1.02277776e+00
  1.02277776e+00  7.43192628e+00  7.43192628e+00  7.43192628e+00
  1.02768651e+01  3.41990941e+01  3.41990941e+01  3.41990941e+01
  5.89515666e+01  1.30891937e+02  1.30891937e+02  1.30891937e+02
  2.31140057e+02  4.85327398e+02  4.85327398e+02  4.85327398e+02
  7.94050426e+02  1.33552940e+03  1.33552940e+03  1.33552940e+03
  2.89634026e+03  3.02747167e+03  3.02747167e+03  3.02747167e+03
  6.64627362e+03  6.64627362e+03  6.64627362e+03  9.29607870e+03
  2.56403244e+04  7.63672103e+04]
E1 = -728.2961837129  E_coul = 201.54256744263898
cycle= 5 E= -526.753616270261  delta_E= -2.02e-09  |g|= 2.1e-05  |ddm|= 0.000173
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.93499e-05
diis-c [-9.32027537e-11  1.27442191e-05 -1.78043215e-03 -1.26260891e-02
  3.48053052e-02  9.79588472e-01]
  HOMO = -0.583013130819591  LUMO = 0.923817180649708
  mo_energy =
[-1.18585312e+02 -1.23125248e+01 -9.56278260e+00 -9.56278260e+00
 -9.56278260e+00 -1.27026233e+00 -5.83013131e-01 -5.83013131e-01
 -5.83013131e-01  9.23817181e-01  1.02277254e+00  1.02277254e+00
  1.02277254e+00  7.43190888e+00  7.43190888e+00  7.43190888e+00
  1.02768477e+01  3.41990695e+01  3.41990695e+01  3.41990695e+01
  5.89515409e+01  1.30891908e+02  1.30891908e+02  1.30891908e+02
  2.31140027e+02  4.85327367e+02  4.85327367e+02  4.85327367e+02
  7.94050394e+02  1.33552936e+03  1.33552936e+03  1.33552936e+03
  2.89634023e+03  3.02747164e+03  3.02747164e+03  3.02747164e+03
  6.64627358e+03  6.64627358e+03  6.64627358e+03  9.29607867e+03
  2.56403243e+04  7.63672102e+04]
E1 = -728.2962668457197  E_coul = 201.54265057539604
cycle= 6 E= -526.753616270324  delta_E= -6.28e-11  |g|= 1.86e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2962668457197  E_coul = 201.54265057539604
  HOMO = -0.583013040154509  LUMO = 0.923817606233026
  mo_energy =
[-1.18585311e+02 -1.23125242e+01 -9.56278212e+00 -9.56278212e+00
 -9.56278212e+00 -1.27026181e+00 -5.83013040e-01 -5.83013040e-01
 -5.83013040e-01  9.23817606e-01  1.02277267e+00  1.02277267e+00
  1.02277267e+00  7.43190921e+00  7.43190921e+00  7.43190921e+00
  1.02768482e+01  3.41990700e+01  3.41990700e+01  3.41990700e+01
  5.89515415e+01  1.30891909e+02  1.30891909e+02  1.30891909e+02
  2.31140028e+02  4.85327368e+02  4.85327368e+02  4.85327368e+02
  7.94050395e+02  1.33552936e+03  1.33552936e+03  1.33552936e+03
  2.89634023e+03  3.02747164e+03  3.02747164e+03  3.02747164e+03
  6.64627358e+03  6.64627358e+03  6.64627358e+03  9.29607867e+03
  2.56403243e+04  7.63672102e+04]
E1 = -728.2962641840569  E_coul = 201.54264791373126
Extra cycle  E= -526.753616270326  delta_E= -1.93e-12  |g|= 3.9e-07  |ddm|= 3.29e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113484.44153798801
E1 = -728.2962641840569  E_coul = 201.54264791373126
init E= -526.753616270326
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583013107080631  LUMO = 0.923817625142169
  mo_energy =
[-1.18585312e+02 -1.23125244e+01 -9.56278233e+00 -9.56278233e+00
 -9.56278233e+00 -1.27026181e+00 -5.83013107e-01 -5.83013107e-01
 -5.83013107e-01  9.23817625e-01  1.02277263e+00  1.02277263e+00
  1.02277263e+00  7.43190907e+00  7.43190907e+00  7.43190907e+00
  1.02768481e+01  3.41990698e+01  3.41990698e+01  3.41990698e+01
  5.89515412e+01  1.30891909e+02  1.30891909e+02  1.30891909e+02
  2.31140028e+02  4.85327367e+02  4.85327367e+02  4.85327367e+02
  7.94050395e+02  1.33552936e+03  1.33552936e+03  1.33552936e+03
  2.89634023e+03  3.02747164e+03  3.02747164e+03  3.02747164e+03
  6.64627358e+03  6.64627358e+03  6.64627358e+03  9.29607867e+03
  2.56403243e+04  7.63672102e+04]
E1 = -728.2962647811898  E_coul = 201.54264851086597
cycle= 1 E= -526.753616270324  delta_E= 1.82e-12  |g|= 8.85e-08  |ddm|= 6.17e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2962647811898  E_coul = 201.54264851086597
  HOMO = -0.58301309887716  LUMO = 0.923817646746936
  mo_energy =
[-1.18585312e+02 -1.23125244e+01 -9.56278229e+00 -9.56278229e+00
 -9.56278229e+00 -1.27026178e+00 -5.83013099e-01 -5.83013099e-01
 -5.83013099e-01  9.23817647e-01  1.02277264e+00  1.02277264e+00
  1.02277264e+00  7.43190909e+00  7.43190909e+00  7.43190909e+00
  1.02768481e+01  3.41990698e+01  3.41990698e+01  3.41990698e+01
  5.89515413e+01  1.30891909e+02  1.30891909e+02  1.30891909e+02
  2.31140028e+02  4.85327367e+02  4.85327367e+02  4.85327367e+02
  7.94050395e+02  1.33552936e+03  1.33552936e+03  1.33552936e+03
  2.89634023e+03  3.02747164e+03  3.02747164e+03  3.02747164e+03
  6.64627358e+03  6.64627358e+03  6.64627358e+03  9.29607867e+03
  2.56403243e+04  7.63672102e+04]
E1 = -728.2962645825781  E_coul = 201.54264831225242
Extra cycle  E= -526.753616270326  delta_E= -1.82e-12  |g|= 1.89e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.91 sec, wall time      0.43 sec
exp = [2.61827115e+04 7.61739124e+03 3.61739990e+03 1.59491465e+03
 3.91255244e+02 1.30817154e+02 5.30989408e+01 2.22442437e+01
 7.40660803e+00 6.47701426e-01 2.91659005e+00 2.32122650e-01
 1.36280166e+03 6.64567239e+02 3.00121843e+02 3.13318206e+02
 6.19243407e+01 7.48835678e+00 2.05793520e+01 7.80923207e-01
 2.86221288e+00 2.23745802e-01]
grad_E = [-1.57300195e-06  3.95706318e-06 -1.19439424e-06  9.48186698e-05
 -6.03109038e-04  3.07447994e-04  1.29802867e-04 -2.28862178e-04
  4.73277323e-04 -1.34807674e-03 -1.23104396e-03  2.59939411e-03
 -5.01526779e-07  5.14806804e-06  2.46138741e-05  2.11650262e-05
 -1.77294908e-04  5.26999062e-04  4.84050518e-04 -9.76041574e-04
 -9.41653195e-04  2.68234579e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:00 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7359845        1
[INPUT] 0    0    [1    /1   ]  7617.33338333        1
[INPUT] 0    0    [1    /1   ]  3617.42096676        1
[INPUT] 0    0    [1    /1   ]  1593.61547265        1
[INPUT] 0    0    [1    /1   ]  395.528494635        1
[INPUT] 0    0    [1    /1   ]  139.026950567        1
[INPUT] 0    0    [1    /1   ]  61.2944312164        1
[INPUT] 0    0    [1    /1   ]  27.409843973         1
[INPUT] 0    0    [1    /1   ]  7.75424523535        1
[INPUT] 0    0    [1    /1   ]  0.644667271221       1
[INPUT] 0    0    [1    /1   ]  3.00797858546        1
[INPUT] 0    0    [1    /1   ]  0.233043480952       1
[INPUT] 1    0    [1    /1   ]  1362.8097396         1
[INPUT] 1    0    [1    /1   ]  664.489055119        1
[INPUT] 1    0    [1    /1   ]  299.753563833        1
[INPUT] 1    0    [1    /1   ]  313.000834545        1
[INPUT] 1    0    [1    /1   ]  62.1332230657        1
[INPUT] 1    0    [1    /1   ]  7.41929682271        1
[INPUT] 1    0    [1    /1   ]  20.5202370491        1
[INPUT] 1    0    [1    /1   ]  0.776858641387       1
[INPUT] 1    0    [1    /1   ]  2.82298288894        1
[INPUT] 1    0    [1    /1   ]  0.222964007897       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.735984526782, 1.0]], [0, [7617.333383328698, 1.0]], [0, [3617.420966757131, 1.0]], [0, [1593.6154726495963, 1.0]], [0, [395.52849463497324, 1.0]], [0, [139.02695056741567, 1.0]], [0, [61.294431216386755, 1.0]], [0, [27.409843972955944, 1.0]], [0, [7.754245235352499, 1.0]], [0, [0.6446672712206456, 1.0]], [0, [3.007978585464608, 1.0]], [0, [0.23304348095189256, 1.0]], [1, [1362.8097396009603, 1.0]], [1, [664.4890551194675, 1.0]], [1, [299.75356383288494, 1.0]], [1, [313.0008345445582, 1.0]], [1, [62.13322306571441, 1.0]], [1, [7.419296822709466, 1.0]], [1, [20.520237049117075, 1.0]], [1, [0.7768586413866767, 1.0]], [1, [2.8229828889382365, 1.0]], [1, [0.22296400789697166, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.73598453]
bas 1, expnt(s) = [7617.33338333]
bas 2, expnt(s) = [3617.42096676]
bas 3, expnt(s) = [1593.61547265]
bas 4, expnt(s) = [395.52849463]
bas 5, expnt(s) = [139.02695057]
bas 6, expnt(s) = [61.29443122]
bas 7, expnt(s) = [27.40984397]
bas 8, expnt(s) = [7.75424524]
bas 9, expnt(s) = [0.64466727]
bas 10, expnt(s) = [3.00797859]
bas 11, expnt(s) = [0.23304348]
bas 12, expnt(s) = [1362.8097396]
bas 13, expnt(s) = [664.48905512]
bas 14, expnt(s) = [299.75356383]
bas 15, expnt(s) = [313.00083454]
bas 16, expnt(s) = [62.13322307]
bas 17, expnt(s) = [7.41929682]
bas 18, expnt(s) = [20.52023705]
bas 19, expnt(s) = [0.77685864]
bas 20, expnt(s) = [2.82298289]
bas 21, expnt(s) = [0.22296401]
CPU time:       501.14
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827360e+04 5.20027480e+03 7.61733338e+03 2.06000013e+03
 3.61742097e+03 1.17845855e+03 1.59361547e+03 6.37239484e+02
 3.95528495e+02 2.24077555e+02 1.39026951e+02 1.02291435e+02
 6.12944312e+01 5.53453055e+01 2.74098440e+01 3.02652975e+01
 7.75424524e+00 1.17400426e+01 6.44667271e-01 1.81767712e+00
 3.00797859e+00 5.77060143e+00 2.33043481e-01 8.47408358e-01
 1.36280974e+03 2.41561895e+04 6.64489055e+02 9.84224525e+03
 2.99753564e+02 3.63864626e+03 3.13000835e+02 3.84075197e+03
 6.21332231e+01 5.08907962e+02 7.41929682e+00 3.57221694e+01
 2.05202370e+01 1.27412594e+02 7.76858641e-01 2.12770735e+00
 2.82298289e+00 1.06750446e+01 2.22964008e-01 4.46969455e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993719556044816
cond(S) = 113240.82045922492
E1 = -729.541618281301  E_coul = 203.17571751654253
init E= -526.365900764758
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555777102626561  LUMO = 0.947706939463832
  mo_energy =
[-1.18334274e+02 -1.22065927e+01 -9.44713932e+00 -9.44713932e+00
 -9.44713932e+00 -1.24018202e+00 -5.55777103e-01 -5.55777103e-01
 -5.55777103e-01  9.47706939e-01  1.03489701e+00  1.03489701e+00
  1.03489701e+00  7.39922439e+00  7.39922439e+00  7.39922439e+00
  1.10949299e+01  3.39613075e+01  3.39613075e+01  3.39613075e+01
  6.97994952e+01  1.30718026e+02  1.30718026e+02  1.30718026e+02
  2.69883827e+02  4.85391725e+02  4.85391725e+02  4.85391725e+02
  8.66563125e+02  1.33507738e+03  1.33507738e+03  1.33507738e+03
  2.98744051e+03  3.02615340e+03  3.02615340e+03  3.02615340e+03
  6.64442813e+03  6.64442813e+03  6.64442813e+03  9.38720572e+03
  2.57275847e+04  7.64487031e+04]
E1 = -727.8443534164584  E_coul = 201.09182279510097
cycle= 1 E= -526.752530621357  delta_E= -0.387  |g|= 0.188  |ddm|= 0.312
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.58449
diis-c [-0.34162895  1.        ]
  HOMO = -0.590690741682645  LUMO = 0.92117979167588
  mo_energy =
[-1.18643641e+02 -1.23451567e+01 -9.59681936e+00 -9.59681936e+00
 -9.59681936e+00 -1.27952799e+00 -5.90690742e-01 -5.90690742e-01
 -5.90690742e-01  9.21179792e-01  1.01046986e+00  1.01046986e+00
  1.01046986e+00  7.30754786e+00  7.30754786e+00  7.30754786e+00
  1.09923265e+01  3.38052319e+01  3.38052319e+01  3.38052319e+01
  6.96167924e+01  1.30487514e+02  1.30487514e+02  1.30487514e+02
  2.69624953e+02  4.85084069e+02  4.85084069e+02  4.85084069e+02
  8.66207910e+02  1.33471284e+03  1.33471284e+03  1.33471284e+03
  2.98694516e+03  3.02572350e+03  3.02572350e+03  3.02572350e+03
  6.64388501e+03  6.64388501e+03  6.64388501e+03  9.38659013e+03
  2.57268733e+04  7.64479007e+04]
E1 = -728.4212746619354  E_coul = 201.6680147754619
cycle= 2 E= -526.753259886474  delta_E= -0.000729  |g|= 0.0379  |ddm|= 0.0536
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0772811
diis-c [-0.00394218  0.07195789  0.92804211]
  HOMO = -0.581424028507377  LUMO = 0.928993584017674
  mo_energy =
[-1.18574795e+02 -1.23064793e+01 -9.55647224e+00 -9.55647224e+00
 -9.55647224e+00 -1.26843390e+00 -5.81424029e-01 -5.81424029e-01
 -5.81424029e-01  9.28993584e-01  1.01732520e+00  1.01732520e+00
  1.01732520e+00  7.33179074e+00  7.33179074e+00  7.33179074e+00
  1.10207894e+01  3.38461619e+01  3.38461619e+01  3.38461619e+01
  6.96655384e+01  1.30544437e+02  1.30544437e+02  1.30544437e+02
  2.69687378e+02  4.85152073e+02  4.85152073e+02  4.85152073e+02
  8.66278703e+02  1.33478496e+03  1.33478496e+03  1.33478496e+03
  2.98702050e+03  3.02579790e+03  3.02579790e+03  3.02579790e+03
  6.64396118e+03  6.64396118e+03  6.64396118e+03  9.38666707e+03
  2.57269509e+04  7.64479786e+04]
E1 = -728.2686517803583  E_coul = 201.51533273474033
cycle= 3 E= -526.753319045618  delta_E= -5.92e-05  |g|= 0.00682  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0144861
diis-c [-8.03610332e-07 -1.27494999e-03  1.53624408e-01  8.47650542e-01]
  HOMO = -0.583031881337502  LUMO = 0.927734484578037
  mo_energy =
[-1.18585585e+02 -1.23127424e+01 -9.56310833e+00 -9.56310833e+00
 -9.56310833e+00 -1.27024983e+00 -5.83031881e-01 -5.83031881e-01
 -5.83031881e-01  9.27734485e-01  1.01616053e+00  1.01616053e+00
  1.01616053e+00  7.32771122e+00  7.32771122e+00  7.32771122e+00
  1.10161370e+01  3.38394726e+01  3.38394726e+01  3.38394726e+01
  6.96577428e+01  1.30535391e+02  1.30535391e+02  1.30535391e+02
  2.69677545e+02  4.85141412e+02  4.85141412e+02  4.85141412e+02
  8.66267583e+02  1.33477365e+03  1.33477365e+03  1.33477365e+03
  2.98700854e+03  3.02578618e+03  3.02578618e+03  3.02578618e+03
  6.64394905e+03  6.64394905e+03  6.64394905e+03  9.38665472e+03
  2.57269383e+04  7.64479659e+04]
E1 = -728.2932076929487  E_coul = 201.53988641671802
cycle= 4 E= -526.753321276231  delta_E= -2.23e-06  |g|= 0.000104  |ddm|= 0.00242
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000118004
diis-c [-4.65302123e-09  8.28991055e-05 -1.20098634e-02 -7.09452494e-02
  1.08287221e+00]
  HOMO = -0.583013854445752  LUMO = 0.927767821393588
  mo_energy =
[-1.18585541e+02 -1.23126759e+01 -9.56305620e+00 -9.56305620e+00
 -9.56305620e+00 -1.27020774e+00 -5.83013854e-01 -5.83013854e-01
 -5.83013854e-01  9.27767821e-01  1.01617635e+00  1.01617635e+00
  1.01617635e+00  7.32775318e+00  7.32775318e+00  7.32775318e+00
  1.10161968e+01  3.38395230e+01  3.38395230e+01  3.38395230e+01
  6.96578002e+01  1.30535442e+02  1.30535442e+02  1.30535442e+02
  2.69677594e+02  4.85141456e+02  4.85141456e+02  4.85141456e+02
  8.66267619e+02  1.33477369e+03  1.33477369e+03  1.33477369e+03
  2.98700856e+03  3.02578620e+03  3.02578620e+03  3.02578620e+03
  6.64394906e+03  6.64394906e+03  6.64394906e+03  9.38665472e+03
  2.57269383e+04  7.64479659e+04]
E1 = -728.2929831992908  E_coul = 201.53966192111417
cycle= 5 E= -526.753321278177  delta_E= -1.95e-09  |g|= 2.08e-05  |ddm|= 0.000169
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.90621e-05
diis-c [-8.88453655e-11  1.26150201e-05 -1.80896644e-03 -1.25540918e-02
  3.51165325e-02  9.79233911e-01]
  HOMO = -0.583021494046002  LUMO = 0.927764083555561
  mo_energy =
[-1.18585572e+02 -1.23126989e+01 -9.56308107e+00 -9.56308107e+00
 -9.56308107e+00 -1.27021376e+00 -5.83021494e-01 -5.83021494e-01
 -5.83021494e-01  9.27764084e-01  1.01617127e+00  1.01617127e+00
  1.01617127e+00  7.32773621e+00  7.32773621e+00  7.32773621e+00
  1.10161792e+01  3.38394988e+01  3.38394988e+01  3.38394988e+01
  6.96577742e+01  1.30535414e+02  1.30535414e+02  1.30535414e+02
  2.69677564e+02  4.85141425e+02  4.85141425e+02  4.85141425e+02
  8.66267587e+02  1.33477366e+03  1.33477366e+03  1.33477366e+03
  2.98700852e+03  3.02578617e+03  3.02578617e+03  3.02578617e+03
  6.64394902e+03  6.64394902e+03  6.64394902e+03  9.38665469e+03
  2.57269383e+04  7.64479658e+04]
E1 = -728.2930649229867  E_coul = 201.5397436447495
cycle= 6 E= -526.753321278237  delta_E= -6.06e-11  |g|= 1.85e-06  |ddm|= 1.97e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2930649229867  E_coul = 201.5397436447495
  HOMO = -0.583021421502626  LUMO = 0.927764498480201
  mo_energy =
[-1.18585571e+02 -1.23126984e+01 -9.56308066e+00 -9.56308066e+00
 -9.56308066e+00 -1.27021326e+00 -5.83021422e-01 -5.83021422e-01
 -5.83021422e-01  9.27764498e-01  1.01617138e+00  1.01617138e+00
  1.01617138e+00  7.32773650e+00  7.32773650e+00  7.32773650e+00
  1.10161796e+01  3.38394993e+01  3.38394993e+01  3.38394993e+01
  6.96577747e+01  1.30535414e+02  1.30535414e+02  1.30535414e+02
  2.69677565e+02  4.85141426e+02  4.85141426e+02  4.85141426e+02
  8.66267588e+02  1.33477366e+03  1.33477366e+03  1.33477366e+03
  2.98700852e+03  3.02578617e+03  3.02578617e+03  3.02578617e+03
  6.64394902e+03  6.64394902e+03  6.64394902e+03  9.38665469e+03
  2.57269383e+04  7.64479658e+04]
E1 = -728.293062513475  E_coul = 201.53974123523636
Extra cycle  E= -526.753321278239  delta_E= -1.48e-12  |g|= 3.88e-07  |ddm|= 3.31e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
exp = [2.61827360e+04 7.61733338e+03 3.61742097e+03 1.59361547e+03
 3.95528495e+02 1.39026951e+02 6.12944312e+01 2.74098440e+01
 7.75424524e+00 6.44667271e-01 3.00797859e+00 2.33043481e-01
 1.36280974e+03 6.64489055e+02 2.99753564e+02 3.13000835e+02
 6.21332231e+01 7.41929682e+00 2.05202370e+01 7.76858641e-01
 2.82298289e+00 2.22964008e-01]
E = -526.7533212782387
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:00 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7178679        1
[INPUT] 0    0    [1    /1   ]  7617.37627773        1
[INPUT] 0    0    [1    /1   ]  3617.40534705        1
[INPUT] 0    0    [1    /1   ]  1594.57871211        1
[INPUT] 0    0    [1    /1   ]  392.360208921        1
[INPUT] 0    0    [1    /1   ]  132.940020199        1
[INPUT] 0    0    [1    /1   ]  55.2181076227        1
[INPUT] 0    0    [1    /1   ]  23.5799500859        1
[INPUT] 0    0    [1    /1   ]  7.49649907593        1
[INPUT] 0    0    [1    /1   ]  0.646916862735       1
[INPUT] 0    0    [1    /1   ]  2.94022104014        1
[INPUT] 0    0    [1    /1   ]  0.232360755872       1
[INPUT] 1    0    [1    /1   ]  1362.80375251        1
[INPUT] 1    0    [1    /1   ]  664.547022755        1
[INPUT] 1    0    [1    /1   ]  300.026614485        1
[INPUT] 1    0    [1    /1   ]  313.236141342        1
[INPUT] 1    0    [1    /1   ]  61.9783529129        1
[INPUT] 1    0    [1    /1   ]  7.47049944915        1
[INPUT] 1    0    [1    /1   ]  20.5640662407        1
[INPUT] 1    0    [1    /1   ]  0.779872202781       1
[INPUT] 1    0    [1    /1   ]  2.8520688958         1
[INPUT] 1    0    [1    /1   ]  0.223543647514       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.717867949592, 1.0]], [0, [7617.376277727081, 1.0]], [0, [3617.405347046182, 1.0]], [0, [1594.5787121105066, 1.0]], [0, [392.36020892094666, 1.0]], [0, [132.9400201990845, 1.0]], [0, [55.21810762268382, 1.0]], [0, [23.57995008591564, 1.0]], [0, [7.496499075932855, 1.0]], [0, [0.6469168627346866, 1.0]], [0, [2.940221040136791, 1.0]], [0, [0.23236075587155958, 1.0]], [1, [1362.8037525133377, 1.0]], [1, [664.5470227550816, 1.0]], [1, [300.0266144853603, 1.0]], [1, [313.23614134242405, 1.0]], [1, [61.97835291294763, 1.0]], [1, [7.470499449153286, 1.0]], [1, [20.56406624071261, 1.0]], [1, [0.7798722027807391, 1.0]], [1, [2.852068895797314, 1.0]], [1, [0.22354364751393244, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.71786795]
bas 1, expnt(s) = [7617.37627773]
bas 2, expnt(s) = [3617.40534705]
bas 3, expnt(s) = [1594.57871211]
bas 4, expnt(s) = [392.36020892]
bas 5, expnt(s) = [132.9400202]
bas 6, expnt(s) = [55.21810762]
bas 7, expnt(s) = [23.57995009]
bas 8, expnt(s) = [7.49649908]
bas 9, expnt(s) = [0.64691686]
bas 10, expnt(s) = [2.94022104]
bas 11, expnt(s) = [0.23236076]
bas 12, expnt(s) = [1362.80375251]
bas 13, expnt(s) = [664.54702276]
bas 14, expnt(s) = [300.02661449]
bas 15, expnt(s) = [313.23614134]
bas 16, expnt(s) = [61.97835291]
bas 17, expnt(s) = [7.47049945]
bas 18, expnt(s) = [20.56406624]
bas 19, expnt(s) = [0.7798722]
bas 20, expnt(s) = [2.8520689]
bas 21, expnt(s) = [0.22354365]
CPU time:       501.61
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827179e+04 5.20027210e+03 7.61737628e+03 2.06000883e+03
 3.61740535e+03 1.17845474e+03 1.59457871e+03 6.37528341e+02
 3.92360209e+02 2.22730013e+02 1.32940020e+02 9.89137870e+01
 5.52181076e+01 5.11771578e+01 2.35799501e+01 2.70347393e+01
 7.49649908e+00 1.14461358e+01 6.46916863e-01 1.82243219e+00
 2.94022104e+00 5.67283315e+00 2.32360756e-01 8.45545747e-01
 1.36280375e+03 2.41560569e+04 6.64547023e+02 9.84331851e+03
 3.00026614e+02 3.64278986e+03 3.13236141e+02 3.84436154e+03
 6.19783529e+01 5.07322858e+02 7.47049945e+00 3.60305955e+01
 2.05640662e+01 1.27752861e+02 7.79872203e-01 2.13802950e+00
 2.85206890e+00 1.08127063e+01 2.23543648e-01 4.48422410e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99363196033772
cond(S) = 113407.39563834005
E1 = -729.5445532567271  E_coul = 203.1755059123732
init E= -526.369047344354
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555740987402926  LUMO = 0.944734217867779
  mo_energy =
[-1.18334404e+02 -1.22066993e+01 -9.44718449e+00 -9.44718449e+00
 -9.44718449e+00 -1.24020830e+00 -5.55740987e-01 -5.55740987e-01
 -5.55740987e-01  9.44734218e-01  1.03990224e+00  1.03990224e+00
  1.03990224e+00  7.47673294e+00  7.47673294e+00  7.47673294e+00
  1.05439954e+01  3.42279629e+01  3.42279629e+01  3.42279629e+01
  6.18269250e+01  1.30981792e+02  1.30981792e+02  1.30981792e+02
  2.41363003e+02  4.85529596e+02  4.85529596e+02  4.85529596e+02
  8.13127564e+02  1.33563745e+03  1.33563745e+03  1.33563745e+03
  2.92021117e+03  3.02740301e+03  3.02740301e+03  3.02740301e+03
  6.64615168e+03  6.64615168e+03  6.64615168e+03  9.31998680e+03
  2.56632906e+04  7.63887516e+04]
E1 = -727.8474586196651  E_coul = 201.09456064879694
cycle= 1 E= -526.752897970868  delta_E= -0.384  |g|= 0.188  |ddm|= 0.315
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.579544
diis-c [-0.33587073  1.        ]
  HOMO = -0.59066182033926  LUMO = 0.918400503482068
  mo_energy =
[-1.18643537e+02 -1.23449625e+01 -9.59654682e+00 -9.59654682e+00
 -9.59654682e+00 -1.27954496e+00 -5.90661820e-01 -5.90661820e-01
 -5.90661820e-01  9.18400503e-01  1.01534383e+00  1.01534383e+00
  1.01534383e+00  7.38467988e+00  7.38467988e+00  7.38467988e+00
  1.04447230e+01  3.40718353e+01  3.40718353e+01  3.40718353e+01
  6.16529178e+01  1.30751922e+02  1.30751922e+02  1.30751922e+02
  2.41110838e+02  4.85221911e+02  4.85221911e+02  4.85221911e+02
  8.12774686e+02  1.33527305e+03  1.33527305e+03  1.33527305e+03
  2.91971524e+03  3.02697300e+03  3.02697300e+03  3.02697300e+03
  6.64560827e+03  6.64560827e+03  6.64560827e+03  9.31937027e+03
  2.56625785e+04  7.63879486e+04]
E1 = -728.4237323800638  E_coul = 201.67010595466738
cycle= 2 E= -526.753626425396  delta_E= -0.000728  |g|= 0.0379  |ddm|= 0.0534
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.077417
diis-c [-0.00389012  0.07372754  0.92627246]
  HOMO = -0.581437471863558  LUMO = 0.926131418321242
  mo_energy =
[-1.18574855e+02 -1.23064050e+01 -9.55631635e+00 -9.55631635e+00
 -9.55631635e+00 -1.26849902e+00 -5.81437472e-01 -5.81437472e-01
 -5.81437472e-01  9.26131418e-01  1.02220897e+00  1.02220897e+00
  1.02220897e+00  7.40897546e+00  7.40897546e+00  7.40897546e+00
  1.04721962e+01  3.41127012e+01  3.41127012e+01  3.41127012e+01
  6.16995945e+01  1.30808677e+02  1.30808677e+02  1.30808677e+02
  2.41172138e+02  4.85289746e+02  4.85289746e+02  4.85289746e+02
  8.12845161e+02  1.33534499e+03  1.33534499e+03  1.33534499e+03
  2.91979042e+03  3.02704722e+03  3.02704722e+03  3.02704722e+03
  6.64568426e+03  6.64568426e+03  6.64568426e+03  9.31944704e+03
  2.56626559e+04  7.63880263e+04]
E1 = -728.2715446383258  E_coul = 201.51785907795244
cycle= 3 E= -526.753685560373  delta_E= -5.91e-05  |g|= 0.00673  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0143223
diis-c [-8.22162063e-07 -1.28508908e-03  1.51798386e-01  8.49486703e-01]
  HOMO = -0.583026540059269  LUMO = 0.924896998926308
  mo_energy =
[-1.18585508e+02 -1.23125915e+01 -9.56287232e+00 -9.56287232e+00
 -9.56287232e+00 -1.27029148e+00 -5.83026540e-01 -5.83026540e-01
 -5.83026540e-01  9.24896999e-01  1.02105167e+00  1.02105167e+00
  1.02105167e+00  7.40492215e+00  7.40492215e+00  7.40492215e+00
  1.04677367e+01  3.41060851e+01  3.41060851e+01  3.41060851e+01
  6.16921814e+01  1.30799748e+02  1.30799748e+02  1.30799748e+02
  2.41162571e+02  4.85279219e+02  4.85279219e+02  4.85279219e+02
  8.12834205e+02  1.33533383e+03  1.33533383e+03  1.33533383e+03
  2.91977861e+03  3.02703565e+03  3.02703565e+03  3.02703565e+03
  6.64567228e+03  6.64567228e+03  6.64567228e+03  9.31943484e+03
  2.56626435e+04  7.63880138e+04]
E1 = -728.2957947854544  E_coul = 201.54210704884653
cycle= 4 E= -526.753687736608  delta_E= -2.18e-06  |g|= 0.000105  |ddm|= 0.00238
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000117674
diis-c [-4.86815285e-09  8.45158628e-05 -1.21391494e-02 -7.23048605e-02
  1.08435949e+00]
  HOMO = -0.583007911713211  LUMO = 0.924930936583639
  mo_energy =
[-1.18585461e+02 -1.23125228e+01 -9.56281784e+00 -9.56281784e+00
 -9.56281784e+00 -1.27024837e+00 -5.83007912e-01 -5.83007912e-01
 -5.83007912e-01  9.24930937e-01  1.02106804e+00  1.02106804e+00
  1.02106804e+00  7.40496581e+00  7.40496581e+00  7.40496581e+00
  1.04677976e+01  3.41061378e+01  3.41061378e+01  3.41061378e+01
  6.16922418e+01  1.30799801e+02  1.30799801e+02  1.30799801e+02
  2.41162624e+02  4.85279267e+02  4.85279267e+02  4.85279267e+02
  8.12834244e+02  1.33533387e+03  1.33533387e+03  1.33533387e+03
  2.91977862e+03  3.02703568e+03  3.02703568e+03  3.02703568e+03
  6.64567229e+03  6.64567229e+03  6.64567229e+03  9.31943484e+03
  2.56626435e+04  7.63880138e+04]
E1 = -728.2955607920138  E_coul = 201.54187305340312
cycle= 5 E= -526.753687738611  delta_E= -2e-09  |g|= 2.1e-05  |ddm|= 0.000172
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93366e-05
diis-c [-9.21414167e-11  1.27224744e-05 -1.78917635e-03 -1.26175580e-02
  3.49843320e-02  9.79409680e-01]
  HOMO = -0.58301566692307  LUMO = 0.924927147332302
  mo_energy =
[-1.18585492e+02 -1.23125461e+01 -9.56284307e+00 -9.56284307e+00
 -9.56284307e+00 -1.27025451e+00 -5.83015667e-01 -5.83015667e-01
 -5.83015667e-01  9.24927147e-01  1.02106285e+00  1.02106285e+00
  1.02106285e+00  7.40494850e+00  7.40494850e+00  7.40494850e+00
  1.04677801e+01  3.41061133e+01  3.41061133e+01  3.41061133e+01
  6.16922159e+01  1.30799773e+02  1.30799773e+02  1.30799773e+02
  2.41162594e+02  4.85279236e+02  4.85279236e+02  4.85279236e+02
  8.12834212e+02  1.33533384e+03  1.33533384e+03  1.33533384e+03
  2.91977859e+03  3.02703564e+03  3.02703564e+03  3.02703564e+03
  6.64567225e+03  6.64567225e+03  6.64567225e+03  9.31943481e+03
  2.56626434e+04  7.63880137e+04]
E1 = -728.2956436466063  E_coul = 201.54195590793265
cycle= 6 E= -526.753687738674  delta_E= -6.3e-11  |g|= 1.86e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2956436466063  E_coul = 201.54195590793265
  HOMO = -0.583015583100896  LUMO = 0.924927569164016
  mo_energy =
[-1.18585492e+02 -1.23125456e+01 -9.56284261e+00 -9.56284261e+00
 -9.56284261e+00 -1.27025400e+00 -5.83015583e-01 -5.83015583e-01
 -5.83015583e-01  9.24927569e-01  1.02106297e+00  1.02106297e+00
  1.02106297e+00  7.40494881e+00  7.40494881e+00  7.40494881e+00
  1.04677806e+01  3.41061137e+01  3.41061137e+01  3.41061137e+01
  6.16922165e+01  1.30799773e+02  1.30799773e+02  1.30799773e+02
  2.41162595e+02  4.85279237e+02  4.85279237e+02  4.85279237e+02
  8.12834213e+02  1.33533384e+03  1.33533384e+03  1.33533384e+03
  2.91977859e+03  3.02703564e+03  3.02703564e+03  3.02703564e+03
  6.64567226e+03  6.64567226e+03  6.64567226e+03  9.31943481e+03
  2.56626434e+04  7.63880137e+04]
E1 = -728.2956410738009  E_coul = 201.54195333512678
Extra cycle  E= -526.753687738674  delta_E= -4.55e-13  |g|= 3.9e-07  |ddm|= 3.3e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
exp = [2.61827179e+04 7.61737628e+03 3.61740535e+03 1.59457871e+03
 3.92360209e+02 1.32940020e+02 5.52181076e+01 2.35799501e+01
 7.49649908e+00 6.46916863e-01 2.94022104e+00 2.32360756e-01
 1.36280375e+03 6.64547023e+02 3.00026614e+02 3.13236141e+02
 6.19783529e+01 7.47049945e+00 2.05640662e+01 7.79872203e-01
 2.85206890e+00 2.23543648e-01]
E = -526.7536877386741
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:01 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7178679        1
[INPUT] 0    0    [1    /1   ]  7617.37627773        1
[INPUT] 0    0    [1    /1   ]  3617.40534705        1
[INPUT] 0    0    [1    /1   ]  1594.57871211        1
[INPUT] 0    0    [1    /1   ]  392.360208921        1
[INPUT] 0    0    [1    /1   ]  132.940020199        1
[INPUT] 0    0    [1    /1   ]  55.2181076227        1
[INPUT] 0    0    [1    /1   ]  23.5799500859        1
[INPUT] 0    0    [1    /1   ]  7.49649907593        1
[INPUT] 0    0    [1    /1   ]  0.646916862735       1
[INPUT] 0    0    [1    /1   ]  2.94022104014        1
[INPUT] 0    0    [1    /1   ]  0.232360755872       1
[INPUT] 1    0    [1    /1   ]  1362.80375251        1
[INPUT] 1    0    [1    /1   ]  664.547022755        1
[INPUT] 1    0    [1    /1   ]  300.026614485        1
[INPUT] 1    0    [1    /1   ]  313.236141342        1
[INPUT] 1    0    [1    /1   ]  61.9783529129        1
[INPUT] 1    0    [1    /1   ]  7.47049944915        1
[INPUT] 1    0    [1    /1   ]  20.5640662407        1
[INPUT] 1    0    [1    /1   ]  0.779872202781       1
[INPUT] 1    0    [1    /1   ]  2.8520688958         1
[INPUT] 1    0    [1    /1   ]  0.223543647514       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.717867949592, 1.0]], [0, [7617.376277727081, 1.0]], [0, [3617.405347046182, 1.0]], [0, [1594.5787121105066, 1.0]], [0, [392.36020892094666, 1.0]], [0, [132.9400201990845, 1.0]], [0, [55.21810762268382, 1.0]], [0, [23.57995008591564, 1.0]], [0, [7.496499075932855, 1.0]], [0, [0.6469168627346866, 1.0]], [0, [2.940221040136791, 1.0]], [0, [0.23236075587155958, 1.0]], [1, [1362.8037525133377, 1.0]], [1, [664.5470227550816, 1.0]], [1, [300.0266144853603, 1.0]], [1, [313.23614134242405, 1.0]], [1, [61.97835291294763, 1.0]], [1, [7.470499449153286, 1.0]], [1, [20.56406624071261, 1.0]], [1, [0.7798722027807391, 1.0]], [1, [2.852068895797314, 1.0]], [1, [0.22354364751393244, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.71786795]
bas 1, expnt(s) = [7617.37627773]
bas 2, expnt(s) = [3617.40534705]
bas 3, expnt(s) = [1594.57871211]
bas 4, expnt(s) = [392.36020892]
bas 5, expnt(s) = [132.9400202]
bas 6, expnt(s) = [55.21810762]
bas 7, expnt(s) = [23.57995009]
bas 8, expnt(s) = [7.49649908]
bas 9, expnt(s) = [0.64691686]
bas 10, expnt(s) = [2.94022104]
bas 11, expnt(s) = [0.23236076]
bas 12, expnt(s) = [1362.80375251]
bas 13, expnt(s) = [664.54702276]
bas 14, expnt(s) = [300.02661449]
bas 15, expnt(s) = [313.23614134]
bas 16, expnt(s) = [61.97835291]
bas 17, expnt(s) = [7.47049945]
bas 18, expnt(s) = [20.56406624]
bas 19, expnt(s) = [0.7798722]
bas 20, expnt(s) = [2.8520689]
bas 21, expnt(s) = [0.22354365]
CPU time:       502.08
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827179e+04 5.20027210e+03 7.61737628e+03 2.06000883e+03
 3.61740535e+03 1.17845474e+03 1.59457871e+03 6.37528341e+02
 3.92360209e+02 2.22730013e+02 1.32940020e+02 9.89137870e+01
 5.52181076e+01 5.11771578e+01 2.35799501e+01 2.70347393e+01
 7.49649908e+00 1.14461358e+01 6.46916863e-01 1.82243219e+00
 2.94022104e+00 5.67283315e+00 2.32360756e-01 8.45545747e-01
 1.36280375e+03 2.41560569e+04 6.64547023e+02 9.84331851e+03
 3.00026614e+02 3.64278986e+03 3.13236141e+02 3.84436154e+03
 6.19783529e+01 5.07322858e+02 7.47049945e+00 3.60305955e+01
 2.05640662e+01 1.27752861e+02 7.79872203e-01 2.13802950e+00
 2.85206890e+00 1.08127063e+01 2.23543648e-01 4.48422410e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99363196033772
cond(S) = 113407.39563834005
E1 = -729.5445532567271  E_coul = 203.1755059123732
init E= -526.369047344354
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555740987402926  LUMO = 0.944734217867779
  mo_energy =
[-1.18334404e+02 -1.22066993e+01 -9.44718449e+00 -9.44718449e+00
 -9.44718449e+00 -1.24020830e+00 -5.55740987e-01 -5.55740987e-01
 -5.55740987e-01  9.44734218e-01  1.03990224e+00  1.03990224e+00
  1.03990224e+00  7.47673294e+00  7.47673294e+00  7.47673294e+00
  1.05439954e+01  3.42279629e+01  3.42279629e+01  3.42279629e+01
  6.18269250e+01  1.30981792e+02  1.30981792e+02  1.30981792e+02
  2.41363003e+02  4.85529596e+02  4.85529596e+02  4.85529596e+02
  8.13127564e+02  1.33563745e+03  1.33563745e+03  1.33563745e+03
  2.92021117e+03  3.02740301e+03  3.02740301e+03  3.02740301e+03
  6.64615168e+03  6.64615168e+03  6.64615168e+03  9.31998680e+03
  2.56632906e+04  7.63887516e+04]
E1 = -727.8474586196651  E_coul = 201.09456064879694
cycle= 1 E= -526.752897970868  delta_E= -0.384  |g|= 0.188  |ddm|= 0.315
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.579544
diis-c [-0.33587073  1.        ]
  HOMO = -0.59066182033926  LUMO = 0.918400503482068
  mo_energy =
[-1.18643537e+02 -1.23449625e+01 -9.59654682e+00 -9.59654682e+00
 -9.59654682e+00 -1.27954496e+00 -5.90661820e-01 -5.90661820e-01
 -5.90661820e-01  9.18400503e-01  1.01534383e+00  1.01534383e+00
  1.01534383e+00  7.38467988e+00  7.38467988e+00  7.38467988e+00
  1.04447230e+01  3.40718353e+01  3.40718353e+01  3.40718353e+01
  6.16529178e+01  1.30751922e+02  1.30751922e+02  1.30751922e+02
  2.41110838e+02  4.85221911e+02  4.85221911e+02  4.85221911e+02
  8.12774686e+02  1.33527305e+03  1.33527305e+03  1.33527305e+03
  2.91971524e+03  3.02697300e+03  3.02697300e+03  3.02697300e+03
  6.64560827e+03  6.64560827e+03  6.64560827e+03  9.31937027e+03
  2.56625785e+04  7.63879486e+04]
E1 = -728.4237323800638  E_coul = 201.67010595466738
cycle= 2 E= -526.753626425396  delta_E= -0.000728  |g|= 0.0379  |ddm|= 0.0534
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.077417
diis-c [-0.00389012  0.07372754  0.92627246]
  HOMO = -0.581437471863558  LUMO = 0.926131418321242
  mo_energy =
[-1.18574855e+02 -1.23064050e+01 -9.55631635e+00 -9.55631635e+00
 -9.55631635e+00 -1.26849902e+00 -5.81437472e-01 -5.81437472e-01
 -5.81437472e-01  9.26131418e-01  1.02220897e+00  1.02220897e+00
  1.02220897e+00  7.40897546e+00  7.40897546e+00  7.40897546e+00
  1.04721962e+01  3.41127012e+01  3.41127012e+01  3.41127012e+01
  6.16995945e+01  1.30808677e+02  1.30808677e+02  1.30808677e+02
  2.41172138e+02  4.85289746e+02  4.85289746e+02  4.85289746e+02
  8.12845161e+02  1.33534499e+03  1.33534499e+03  1.33534499e+03
  2.91979042e+03  3.02704722e+03  3.02704722e+03  3.02704722e+03
  6.64568426e+03  6.64568426e+03  6.64568426e+03  9.31944704e+03
  2.56626559e+04  7.63880263e+04]
E1 = -728.2715446383258  E_coul = 201.51785907795244
cycle= 3 E= -526.753685560373  delta_E= -5.91e-05  |g|= 0.00673  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0143223
diis-c [-8.22162063e-07 -1.28508908e-03  1.51798386e-01  8.49486703e-01]
  HOMO = -0.583026540059269  LUMO = 0.924896998926308
  mo_energy =
[-1.18585508e+02 -1.23125915e+01 -9.56287232e+00 -9.56287232e+00
 -9.56287232e+00 -1.27029148e+00 -5.83026540e-01 -5.83026540e-01
 -5.83026540e-01  9.24896999e-01  1.02105167e+00  1.02105167e+00
  1.02105167e+00  7.40492215e+00  7.40492215e+00  7.40492215e+00
  1.04677367e+01  3.41060851e+01  3.41060851e+01  3.41060851e+01
  6.16921814e+01  1.30799748e+02  1.30799748e+02  1.30799748e+02
  2.41162571e+02  4.85279219e+02  4.85279219e+02  4.85279219e+02
  8.12834205e+02  1.33533383e+03  1.33533383e+03  1.33533383e+03
  2.91977861e+03  3.02703565e+03  3.02703565e+03  3.02703565e+03
  6.64567228e+03  6.64567228e+03  6.64567228e+03  9.31943484e+03
  2.56626435e+04  7.63880138e+04]
E1 = -728.2957947854544  E_coul = 201.54210704884653
cycle= 4 E= -526.753687736608  delta_E= -2.18e-06  |g|= 0.000105  |ddm|= 0.00238
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000117674
diis-c [-4.86815285e-09  8.45158628e-05 -1.21391494e-02 -7.23048605e-02
  1.08435949e+00]
  HOMO = -0.583007911713211  LUMO = 0.924930936583639
  mo_energy =
[-1.18585461e+02 -1.23125228e+01 -9.56281784e+00 -9.56281784e+00
 -9.56281784e+00 -1.27024837e+00 -5.83007912e-01 -5.83007912e-01
 -5.83007912e-01  9.24930937e-01  1.02106804e+00  1.02106804e+00
  1.02106804e+00  7.40496581e+00  7.40496581e+00  7.40496581e+00
  1.04677976e+01  3.41061378e+01  3.41061378e+01  3.41061378e+01
  6.16922418e+01  1.30799801e+02  1.30799801e+02  1.30799801e+02
  2.41162624e+02  4.85279267e+02  4.85279267e+02  4.85279267e+02
  8.12834244e+02  1.33533387e+03  1.33533387e+03  1.33533387e+03
  2.91977862e+03  3.02703568e+03  3.02703568e+03  3.02703568e+03
  6.64567229e+03  6.64567229e+03  6.64567229e+03  9.31943484e+03
  2.56626435e+04  7.63880138e+04]
E1 = -728.2955607920138  E_coul = 201.54187305340312
cycle= 5 E= -526.753687738611  delta_E= -2e-09  |g|= 2.1e-05  |ddm|= 0.000172
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93366e-05
diis-c [-9.21414167e-11  1.27224744e-05 -1.78917635e-03 -1.26175580e-02
  3.49843320e-02  9.79409680e-01]
  HOMO = -0.58301566692307  LUMO = 0.924927147332302
  mo_energy =
[-1.18585492e+02 -1.23125461e+01 -9.56284307e+00 -9.56284307e+00
 -9.56284307e+00 -1.27025451e+00 -5.83015667e-01 -5.83015667e-01
 -5.83015667e-01  9.24927147e-01  1.02106285e+00  1.02106285e+00
  1.02106285e+00  7.40494850e+00  7.40494850e+00  7.40494850e+00
  1.04677801e+01  3.41061133e+01  3.41061133e+01  3.41061133e+01
  6.16922159e+01  1.30799773e+02  1.30799773e+02  1.30799773e+02
  2.41162594e+02  4.85279236e+02  4.85279236e+02  4.85279236e+02
  8.12834212e+02  1.33533384e+03  1.33533384e+03  1.33533384e+03
  2.91977859e+03  3.02703564e+03  3.02703564e+03  3.02703564e+03
  6.64567225e+03  6.64567225e+03  6.64567225e+03  9.31943481e+03
  2.56626434e+04  7.63880137e+04]
E1 = -728.2956436466063  E_coul = 201.54195590793265
cycle= 6 E= -526.753687738674  delta_E= -6.3e-11  |g|= 1.86e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2956436466063  E_coul = 201.54195590793265
  HOMO = -0.583015583100896  LUMO = 0.924927569164016
  mo_energy =
[-1.18585492e+02 -1.23125456e+01 -9.56284261e+00 -9.56284261e+00
 -9.56284261e+00 -1.27025400e+00 -5.83015583e-01 -5.83015583e-01
 -5.83015583e-01  9.24927569e-01  1.02106297e+00  1.02106297e+00
  1.02106297e+00  7.40494881e+00  7.40494881e+00  7.40494881e+00
  1.04677806e+01  3.41061137e+01  3.41061137e+01  3.41061137e+01
  6.16922165e+01  1.30799773e+02  1.30799773e+02  1.30799773e+02
  2.41162595e+02  4.85279237e+02  4.85279237e+02  4.85279237e+02
  8.12834213e+02  1.33533384e+03  1.33533384e+03  1.33533384e+03
  2.91977859e+03  3.02703564e+03  3.02703564e+03  3.02703564e+03
  6.64567226e+03  6.64567226e+03  6.64567226e+03  9.31943481e+03
  2.56626434e+04  7.63880137e+04]
E1 = -728.2956410738009  E_coul = 201.54195333512678
Extra cycle  E= -526.753687738674  delta_E= -4.55e-13  |g|= 3.9e-07  |ddm|= 3.3e-06
    CPU time for scf_cycle      0.23 sec, wall time      0.20 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113407.39563834005
E1 = -728.2956410738009  E_coul = 201.54195333512678
init E= -526.753687738674
    CPU time for initialize scf      0.80 sec, wall time      0.32 sec
  HOMO = -0.583015648299764  LUMO = 0.924927589684552
  mo_energy =
[-1.18585492e+02 -1.23125457e+01 -9.56284282e+00 -9.56284282e+00
 -9.56284282e+00 -1.27025399e+00 -5.83015648e-01 -5.83015648e-01
 -5.83015648e-01  9.24927590e-01  1.02106293e+00  1.02106293e+00
  1.02106293e+00  7.40494868e+00  7.40494868e+00  7.40494868e+00
  1.04677805e+01  3.41061135e+01  3.41061135e+01  3.41061135e+01
  6.16922163e+01  1.30799773e+02  1.30799773e+02  1.30799773e+02
  2.41162594e+02  4.85279236e+02  4.85279236e+02  4.85279236e+02
  8.12834213e+02  1.33533384e+03  1.33533384e+03  1.33533384e+03
  2.91977859e+03  3.02703564e+03  3.02703564e+03  3.02703564e+03
  6.64567225e+03  6.64567225e+03  6.64567225e+03  9.31943481e+03
  2.56626434e+04  7.63880137e+04]
E1 = -728.2956416463492  E_coul = 201.54195390767492
cycle= 1 E= -526.753687738674  delta_E= -1.14e-13  |g|= 8.8e-08  |ddm|= 6.2e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2956416463492  E_coul = 201.54195390767492
  HOMO = -0.58301564055461  LUMO = 0.924927611003703
  mo_energy =
[-1.18585492e+02 -1.23125457e+01 -9.56284278e+00 -9.56284278e+00
 -9.56284278e+00 -1.27025397e+00 -5.83015641e-01 -5.83015641e-01
 -5.83015641e-01  9.24927611e-01  1.02106294e+00  1.02106294e+00
  1.02106294e+00  7.40494870e+00  7.40494870e+00  7.40494870e+00
  1.04677805e+01  3.41061136e+01  3.41061136e+01  3.41061136e+01
  6.16922164e+01  1.30799773e+02  1.30799773e+02  1.30799773e+02
  2.41162594e+02  4.85279236e+02  4.85279236e+02  4.85279236e+02
  8.12834213e+02  1.33533384e+03  1.33533384e+03  1.33533384e+03
  2.91977859e+03  3.02703564e+03  3.02703564e+03  3.02703564e+03
  6.64567225e+03  6.64567225e+03  6.64567225e+03  9.31943481e+03
  2.56626434e+04  7.63880137e+04]
E1 = -728.2956414547149  E_coul = 201.54195371604203
Extra cycle  E= -526.753687738673  delta_E= 1.36e-12  |g|= 1.88e-08  |ddm|= 1.41e-07
    CPU time for scf_cycle      0.90 sec, wall time      0.42 sec
exp = [2.61827179e+04 7.61737628e+03 3.61740535e+03 1.59457871e+03
 3.92360209e+02 1.32940020e+02 5.52181076e+01 2.35799501e+01
 7.49649908e+00 6.46916863e-01 2.94022104e+00 2.32360756e-01
 1.36280375e+03 6.64547023e+02 3.00026614e+02 3.13236141e+02
 6.19783529e+01 7.47049945e+00 2.05640662e+01 7.79872203e-01
 2.85206890e+00 2.23543648e-01]
grad_E = [-1.57240818e-06  3.94934546e-06 -1.21029254e-06  9.47378496e-05
 -6.07085039e-04  3.38874620e-04  5.00910313e-05 -1.42109793e-04
  7.82241698e-04 -1.89203019e-03 -1.93504022e-03  3.76009743e-03
 -5.08588532e-07  5.06353510e-06  2.41359387e-05  2.07463923e-05
 -1.54392127e-04  5.74537285e-04  4.55787186e-04 -1.29594569e-03
 -1.33015980e-03  3.52283962e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:05 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.756958         1
[INPUT] 0    0    [1    /1   ]  7617.28334868        1
[INPUT] 0    0    [1    /1   ]  3617.43869816        1
[INPUT] 0    0    [1    /1   ]  1592.48503559        1
[INPUT] 0    0    [1    /1   ]  399.557907601        1
[INPUT] 0    0    [1    /1   ]  145.351256138        1
[INPUT] 0    0    [1    /1   ]  67.3455211412        1
[INPUT] 0    0    [1    /1   ]  30.1341113659        1
[INPUT] 0    0    [1    /1   ]  7.95507007032        1
[INPUT] 0    0    [1    /1   ]  0.641195976112       1
[INPUT] 0    0    [1    /1   ]  3.0645779941         1
[INPUT] 0    0    [1    /1   ]  0.2336212933         1
[INPUT] 1    0    [1    /1   ]  1362.81666235        1
[INPUT] 1    0    [1    /1   ]  664.422130431        1
[INPUT] 1    0    [1    /1   ]  299.438345693        1
[INPUT] 1    0    [1    /1   ]  312.729200873        1
[INPUT] 1    0    [1    /1   ]  62.3122927807        1
[INPUT] 1    0    [1    /1   ]  7.34986480341        1
[INPUT] 1    0    [1    /1   ]  20.4553434022        1
[INPUT] 1    0    [1    /1   ]  0.772708400217       1
[INPUT] 1    0    [1    /1   ]  2.78330090205        1
[INPUT] 1    0    [1    /1   ]  0.222179371649       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.756958041133, 1.0]], [0, [7617.283348681995, 1.0]], [0, [3617.438698156414, 1.0]], [0, [1592.4850355910714, 1.0]], [0, [399.5579076010741, 1.0]], [0, [145.35125613826455, 1.0]], [0, [67.34552114122539, 1.0]], [0, [30.13411136590986, 1.0]], [0, [7.955070070324305, 1.0]], [0, [0.641195976112277, 1.0]], [0, [3.064577994097436, 1.0]], [0, [0.23362129330049222, 1.0]], [1, [1362.8166623516968, 1.0]], [1, [664.4221304309574, 1.0]], [1, [299.43834569294427, 1.0]], [1, [312.72920087283484, 1.0]], [1, [62.3122927806567, 1.0]], [1, [7.349864803407699, 1.0]], [1, [20.455343402161112, 1.0]], [1, [0.7727084002171913, 1.0]], [1, [2.7833009020543895, 1.0]], [1, [0.22217937164917256, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.75695804]
bas 1, expnt(s) = [7617.28334868]
bas 2, expnt(s) = [3617.43869816]
bas 3, expnt(s) = [1592.48503559]
bas 4, expnt(s) = [399.5579076]
bas 5, expnt(s) = [145.35125614]
bas 6, expnt(s) = [67.34552114]
bas 7, expnt(s) = [30.13411137]
bas 8, expnt(s) = [7.95507007]
bas 9, expnt(s) = [0.64119598]
bas 10, expnt(s) = [3.06457799]
bas 11, expnt(s) = [0.23362129]
bas 12, expnt(s) = [1362.81666235]
bas 13, expnt(s) = [664.42213043]
bas 14, expnt(s) = [299.43834569]
bas 15, expnt(s) = [312.72920087]
bas 16, expnt(s) = [62.31229278]
bas 17, expnt(s) = [7.3498648]
bas 18, expnt(s) = [20.4553434]
bas 19, expnt(s) = [0.7727084]
bas 20, expnt(s) = [2.7833009]
bas 21, expnt(s) = [0.22217937]
CPU time:       507.53
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827570e+04 5.20027793e+03 7.61728335e+03 2.05998998e+03
 3.61743870e+03 1.17846289e+03 1.59248504e+03 6.36900433e+02
 3.99557908e+02 2.25787462e+02 1.45351256e+02 1.05761869e+02
 6.73455211e+01 5.93945454e+01 3.01341114e+01 3.24944220e+01
 7.95507007e+00 1.19673511e+01 6.41195976e-01 1.81033153e+00
 3.06457799e+00 5.85184795e+00 2.33621293e-01 8.48983680e-01
 1.36281666e+03 2.41563429e+04 6.64422130e+02 9.84100617e+03
 2.99438346e+02 3.63386393e+03 3.12729201e+02 3.83658599e+03
 6.23122928e+01 5.10741981e+02 7.34986480e+00 3.53047858e+01
 2.04553434e+01 1.26909128e+02 7.72708400e-01 2.11350819e+00
 2.78330090e+00 1.04878047e+01 2.22179372e-01 4.45004149e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993836842520388
cond(S) = 112770.94660113088
E1 = -729.5376273787552  E_coul = 203.17549534548587
init E= -526.362132033269
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555830697290203  LUMO = 0.948171889592861
  mo_energy =
[-1.18334160e+02 -1.22064597e+01 -9.44711351e+00 -9.44711351e+00
 -9.44711351e+00 -1.24016821e+00 -5.55830697e-01 -5.55830697e-01
 -5.55830697e-01  9.48171890e-01  1.02808321e+00  1.02808321e+00
  1.02808321e+00  7.29381638e+00  7.29381638e+00  7.29381638e+00
  1.15262406e+01  3.35948564e+01  3.35948564e+01  3.35948564e+01
  7.62587509e+01  1.30316044e+02  1.30316044e+02  1.30316044e+02
  2.94491302e+02  4.85136917e+02  4.85136917e+02  4.85136917e+02
  9.16029341e+02  1.33434357e+03  1.33434357e+03  1.33434357e+03
  3.02462960e+03  3.02462960e+03  3.02462960e+03  3.05318364e+03
  6.64236461e+03  6.64236461e+03  6.64236461e+03  9.45408731e+03
  2.57917368e+04  7.65085489e+04]
E1 = -727.841378833808  E_coul = 201.08942045655698
cycle= 1 E= -526.751958377251  delta_E= -0.39  |g|= 0.188  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587185
diis-c [-0.34478615  1.        ]
  HOMO = -0.590722562573361  LUMO = 0.921540702043862
  mo_energy =
[-1.18643611e+02 -1.23452887e+01 -9.59706273e+00 -9.59706273e+00
 -9.59706273e+00 -1.27951646e+00 -5.90722563e-01 -5.90722563e-01
 -5.90722563e-01  9.21540702e-01  1.00384774e+00  1.00384774e+00
  1.00384774e+00  7.20277624e+00  7.20277624e+00  7.20277624e+00
  1.14211342e+01  3.34389694e+01  3.34389694e+01  3.34389694e+01
  7.60694644e+01  1.30085024e+02  1.30085024e+02  1.30085024e+02
  2.94226816e+02  4.84829387e+02  4.84829387e+02  4.84829387e+02
  9.15671903e+02  1.33397922e+03  1.33397922e+03  1.33397922e+03
  3.02420011e+03  3.02420011e+03  3.02420011e+03  3.05268906e+03
  6.64182217e+03  6.64182217e+03  6.64182217e+03  9.45347306e+03
  2.57910266e+04  7.65077476e+04]
E1 = -728.4189091633689  E_coul = 201.66622105211943
cycle= 2 E= -526.752688111249  delta_E= -0.00073  |g|= 0.0379  |ddm|= 0.0538
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0770794
diis-c [-0.00396203  0.07080841  0.92919159]
  HOMO = -0.581421526355969  LUMO = 0.929404026224373
  mo_energy =
[-1.18574646e+02 -1.23065202e+01 -9.55662750e+00 -9.55662750e+00
 -9.55662750e+00 -1.26838520e+00 -5.81421526e-01 -5.81421526e-01
 -5.81421526e-01  9.29404026e-01  1.01067247e+00  1.01067247e+00
  1.01067247e+00  7.22689512e+00  7.22689512e+00  7.22689512e+00
  1.14503400e+01  3.34799100e+01  3.34799100e+01  3.34799100e+01
  7.61197227e+01  1.30142082e+02  1.30142082e+02  1.30142082e+02
  2.94290140e+02  4.84897515e+02  4.84897515e+02  4.84897515e+02
  9.15742980e+02  1.33405145e+03  1.33405145e+03  1.33405145e+03
  3.02427464e+03  3.02427464e+03  3.02427464e+03  3.05276452e+03
  6.64189847e+03  6.64189847e+03  6.64189847e+03  9.45355013e+03
  2.57911042e+04  7.65078256e+04]
E1 = -728.2659275426391  E_coul = 201.51318023407427
cycle= 3 E= -526.752747308565  delta_E= -5.92e-05  |g|= 0.00688  |ddm|= 0.0165
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0145771
diis-c [-7.80016674e-07 -1.26116647e-03  1.54887656e-01  8.46373511e-01]
  HOMO = -0.583042671370651  LUMO = 0.928128497686921
  mo_energy =
[-1.18585528e+02 -1.23128362e+01 -9.56331849e+00 -9.56331849e+00
 -9.56331849e+00 -1.27021852e+00 -5.83042671e-01 -5.83042671e-01
 -5.83042671e-01  9.28128498e-01  1.00950708e+00  1.00950708e+00
  1.00950708e+00  7.22281327e+00  7.22281327e+00  7.22281327e+00
  1.14455446e+01  3.34731771e+01  3.34731771e+01  3.34731771e+01
  7.61116488e+01  1.30132956e+02  1.30132956e+02  1.30132956e+02
  2.94280105e+02  4.84886761e+02  4.84886761e+02  4.84886761e+02
  9.15731739e+02  1.33404005e+03  1.33404005e+03  1.33404005e+03
  3.02426282e+03  3.02426282e+03  3.02426282e+03  3.05275246e+03
  6.64188624e+03  6.64188624e+03  6.64188624e+03  9.45353768e+03
  2.57910916e+04  7.65078128e+04]
E1 = -728.2907011483716  E_coul = 201.53795157139817
cycle= 4 E= -526.752749576973  delta_E= -2.27e-06  |g|= 0.000103  |ddm|= 0.00244
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000117818
diis-c [-4.49572476e-09  8.14184138e-05 -1.18739424e-02 -6.97737084e-02
  1.08156623e+00]
  HOMO = -0.583025049173011  LUMO = 0.928161177838244
  mo_energy =
[-1.18585486e+02 -1.23127714e+01 -9.56326804e+00 -9.56326804e+00
 -9.56326804e+00 -1.27017735e+00 -5.83025049e-01 -5.83025049e-01
 -5.83025049e-01  9.28161178e-01  1.00952245e+00  1.00952245e+00
  1.00952245e+00  7.22285396e+00  7.22285396e+00  7.22285396e+00
  1.14456035e+01  3.34732257e+01  3.34732257e+01  3.34732257e+01
  7.61117039e+01  1.30133004e+02  1.30133004e+02  1.30133004e+02
  2.94280152e+02  4.84886804e+02  4.84886804e+02  4.84886804e+02
  9.15731772e+02  1.33404008e+03  1.33404008e+03  1.33404008e+03
  3.02426284e+03  3.02426284e+03  3.02426284e+03  3.05275247e+03
  6.64188624e+03  6.64188624e+03  6.64188624e+03  9.45353768e+03
  2.57910916e+04  7.65078128e+04]
E1 = -728.2904841062971  E_coul = 201.53773452745827
cycle= 5 E= -526.752749578839  delta_E= -1.87e-09  |g|= 2.06e-05  |ddm|= 0.000166
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.86891e-05
diis-c [-8.53991241e-11  1.25546037e-05 -1.82670989e-03 -1.25293104e-02
  3.60673121e-02  9.78276154e-01]
  HOMO = -0.583032577938396  LUMO = 0.928157479897943
  mo_energy =
[-1.18585517e+02 -1.23127940e+01 -9.56329257e+00 -9.56329257e+00
 -9.56329257e+00 -1.27018329e+00 -5.83032578e-01 -5.83032578e-01
 -5.83032578e-01  9.28157480e-01  1.00951749e+00  1.00951749e+00
  1.00951749e+00  7.22283735e+00  7.22283735e+00  7.22283735e+00
  1.14455858e+01  3.34732019e+01  3.34732019e+01  3.34732019e+01
  7.61116779e+01  1.30132976e+02  1.30132976e+02  1.30132976e+02
  2.94280122e+02  4.84886773e+02  4.84886773e+02  4.84886773e+02
  9.15731741e+02  1.33404005e+03  1.33404005e+03  1.33404005e+03
  3.02426281e+03  3.02426281e+03  3.02426281e+03  3.05275244e+03
  6.64188621e+03  6.64188621e+03  6.64188621e+03  9.45353764e+03
  2.57910915e+04  7.65078127e+04]
E1 = -728.2905648134293  E_coul = 201.5378152345317
cycle= 6 E= -526.752749578898  delta_E= -5.89e-11  |g|= 1.84e-06  |ddm|= 1.94e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2905648134293  E_coul = 201.5378152345317
  HOMO = -0.583032519350051  LUMO = 0.928157883525625
  mo_energy =
[-1.18585517e+02 -1.23127936e+01 -9.56329220e+00 -9.56329220e+00
 -9.56329220e+00 -1.27018281e+00 -5.83032519e-01 -5.83032519e-01
 -5.83032519e-01  9.28157884e-01  1.00951759e+00  1.00951759e+00
  1.00951759e+00  7.22283759e+00  7.22283759e+00  7.22283759e+00
  1.14455862e+01  3.34732023e+01  3.34732023e+01  3.34732023e+01
  7.61116783e+01  1.30132977e+02  1.30132977e+02  1.30132977e+02
  2.94280123e+02  4.84886774e+02  4.84886774e+02  4.84886774e+02
  9.15731741e+02  1.33404005e+03  1.33404005e+03  1.33404005e+03
  3.02426281e+03  3.02426281e+03  3.02426281e+03  3.05275244e+03
  6.64188621e+03  6.64188621e+03  6.64188621e+03  9.45353764e+03
  2.57910915e+04  7.65078127e+04]
E1 = -728.2905626053954  E_coul = 201.53781302649676
Extra cycle  E= -526.752749578899  delta_E= -9.09e-13  |g|= 3.85e-07  |ddm|= 3.31e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
exp = [2.61827570e+04 7.61728335e+03 3.61743870e+03 1.59248504e+03
 3.99557908e+02 1.45351256e+02 6.73455211e+01 3.01341114e+01
 7.95507007e+00 6.41195976e-01 3.06457799e+00 2.33621293e-01
 1.36281666e+03 6.64422130e+02 2.99438346e+02 3.12729201e+02
 6.23122928e+01 7.34986480e+00 2.04553434e+01 7.72708400e-01
 2.78330090e+00 2.22179372e-01]
E = -526.7527495788986
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:06 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7258869        1
[INPUT] 0    0    [1    /1   ]  7617.35721418        1
[INPUT] 0    0    [1    /1   ]  3617.41218872        1
[INPUT] 0    0    [1    /1   ]  1594.14921334        1
[INPUT] 0    0    [1    /1   ]  393.836751581        1
[INPUT] 0    0    [1    /1   ]  135.486072785        1
[INPUT] 0    0    [1    /1   ]  57.7059366104        1
[INPUT] 0    0    [1    /1   ]  24.9244768803        1
[INPUT] 0    0    [1    /1   ]  7.59057075998        1
[INPUT] 0    0    [1    /1   ]  0.645743274685       1
[INPUT] 0    0    [1    /1   ]  2.96573174235        1
[INPUT] 0    0    [1    /1   ]  0.232619343702       1
[INPUT] 1    0    [1    /1   ]  1362.80640085        1
[INPUT] 1    0    [1    /1   ]  664.521402227        1
[INPUT] 1    0    [1    /1   ]  299.905936473        1
[INPUT] 1    0    [1    /1   ]  313.132147099        1
[INPUT] 1    0    [1    /1   ]  62.0468576507        1
[INPUT] 1    0    [1    /1   ]  7.44575234474        1
[INPUT] 1    0    [1    /1   ]  20.5417627356        1
[INPUT] 1    0    [1    /1   ]  0.778402613601       1
[INPUT] 1    0    [1    /1   ]  2.83796176504        1
[INPUT] 1    0    [1    /1   ]  0.223263778683       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.72588692765, 1.0]], [0, [7617.357214175581, 1.0]], [0, [3617.412188724227, 1.0]], [0, [1594.1492133449158, 1.0]], [0, [393.8367515814348, 1.0]], [0, [135.48607278450032, 1.0]], [0, [57.705936610433234, 1.0]], [0, [24.924476880340915, 1.0]], [0, [7.5905707599769325, 1.0]], [0, [0.6457432746853389, 1.0]], [0, [2.9657317423502927, 1.0]], [0, [0.23261934370243112, 1.0]], [1, [1362.8064008496913, 1.0]], [1, [664.5214022265304, 1.0]], [1, [299.9059364733404, 1.0]], [1, [313.1321470988552, 1.0]], [1, [62.046857650728825, 1.0]], [1, [7.44575234473948, 1.0]], [1, [20.541762735602862, 1.0]], [1, [0.7784026136014092, 1.0]], [1, [2.8379617650392635, 1.0]], [1, [0.22326377868300262, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.72588693]
bas 1, expnt(s) = [7617.35721418]
bas 2, expnt(s) = [3617.41218872]
bas 3, expnt(s) = [1594.14921334]
bas 4, expnt(s) = [393.83675158]
bas 5, expnt(s) = [135.48607278]
bas 6, expnt(s) = [57.70593661]
bas 7, expnt(s) = [24.92447688]
bas 8, expnt(s) = [7.59057076]
bas 9, expnt(s) = [0.64574327]
bas 10, expnt(s) = [2.96573174]
bas 11, expnt(s) = [0.23261934]
bas 12, expnt(s) = [1362.80640085]
bas 13, expnt(s) = [664.52140223]
bas 14, expnt(s) = [299.90593647]
bas 15, expnt(s) = [313.1321471]
bas 16, expnt(s) = [62.04685765]
bas 17, expnt(s) = [7.44575234]
bas 18, expnt(s) = [20.54176274]
bas 19, expnt(s) = [0.77840261]
bas 20, expnt(s) = [2.83796177]
bas 21, expnt(s) = [0.22326378]
CPU time:       508.04
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827259e+04 5.20027330e+03 7.61735721e+03 2.06000496e+03
 3.61741219e+03 1.17845641e+03 1.59414921e+03 6.37399548e+02
 3.93836752e+02 2.23358356e+02 1.35486073e+02 1.00331202e+02
 5.77059366e+01 5.28969212e+01 2.49244769e+01 2.81828276e+01
 7.59057076e+00 1.15536937e+01 6.45743275e-01 1.81995204e+00
 2.96573174e+00 5.70970833e+00 2.32619344e-01 8.46251388e-01
 1.36280640e+03 2.41561156e+04 6.64521402e+02 9.84284415e+03
 2.99905936e+02 3.64095843e+03 3.13132147e+02 3.84276620e+03
 6.20468577e+01 5.08023886e+02 7.44575234e+00 3.58814617e+01
 2.05417627e+01 1.27579686e+02 7.78402614e-01 2.13299457e+00
 2.83796177e+00 1.07458944e+01 2.23263779e-01 4.47720759e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99367792302482
cond(S) = 113257.42601840592
E1 = -729.5442874894236  E_coul = 203.1753823268134
init E= -526.36890516261
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555757495730377  LUMO = 0.945565071186904
  mo_energy =
[-1.18334510e+02 -1.22066690e+01 -9.44718485e+00 -9.44718485e+00
 -9.44718485e+00 -1.24020467e+00 -5.55757496e-01 -5.55757496e-01
 -5.55757496e-01  9.45565071e-01  1.03747127e+00  1.03747127e+00
  1.03747127e+00  7.43910961e+00  7.43910961e+00  7.43910961e+00
  1.07435420e+01  3.40981492e+01  3.40981492e+01  3.40981492e+01
  6.47359362e+01  1.30845282e+02  1.30845282e+02  1.30845282e+02
  2.52337094e+02  4.85449013e+02  4.85449013e+02  4.85449013e+02
  8.34423628e+02  1.33537186e+03  1.33537186e+03  1.33537186e+03
  2.94749923e+03  3.02683388e+03  3.02683388e+03  3.02683388e+03
  6.64537451e+03  6.64537451e+03  6.64537451e+03  9.34739902e+03
  2.56895177e+04  7.64132015e+04]
E1 = -727.8465304067033  E_coul = 201.09351366183364
cycle= 1 E= -526.75301674487  delta_E= -0.384  |g|= 0.188  |ddm|= 0.313
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.581463
diis-c [-0.33809892  1.        ]
  HOMO = -0.590673620729962  LUMO = 0.9191610970666
  mo_energy =
[-1.18643775e+02 -1.23450138e+01 -9.59663271e+00 -9.59663271e+00
 -9.59663271e+00 -1.27954609e+00 -5.90673621e-01 -5.90673621e-01
 -5.90673621e-01  9.19161097e-01  1.01297848e+00  1.01297848e+00
  1.01297848e+00  7.34727625e+00  7.34727625e+00  7.34727625e+00
  1.06430646e+01  3.39420646e+01  3.39420646e+01  3.39420646e+01
  6.45586125e+01  1.30615191e+02  1.30615191e+02  1.30615191e+02
  2.52082150e+02  4.85141240e+02  4.85141240e+02  4.85141240e+02
  8.34069650e+02  1.33500735e+03  1.33500735e+03  1.33500735e+03
  2.94700336e+03  3.02640378e+03  3.02640378e+03  3.02640378e+03
  6.64483103e+03  6.64483103e+03  6.64483103e+03  9.34678267e+03
  2.56888056e+04  7.64123985e+04]
E1 = -728.4231313316678  E_coul = 201.66938567804027
cycle= 2 E= -526.753745653628  delta_E= -0.000729  |g|= 0.0379  |ddm|= 0.0535
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.077386
diis-c [-0.00390983  0.07310325  0.92689675]
  HOMO = -0.581433483359685  LUMO = 0.926920910237325
  mo_energy =
[-1.18575018e+02 -1.23064086e+01 -9.55635448e+00 -9.55635448e+00
 -9.55635448e+00 -1.26848275e+00 -5.81433483e-01 -5.81433483e-01
 -5.81433483e-01  9.26920910e-01  1.01983562e+00  1.01983562e+00
  1.01983562e+00  7.37153816e+00  7.37153816e+00  7.37153816e+00
  1.06709065e+01  3.39829522e+01  3.39829522e+01  3.39829522e+01
  6.46060966e+01  1.30672020e+02  1.30672020e+02  1.30672020e+02
  2.52143924e+02  4.85209152e+02  4.85209152e+02  4.85209152e+02
  8.34140268e+02  1.33507937e+03  1.33507937e+03  1.33507937e+03
  2.94707861e+03  3.02647809e+03  3.02647809e+03  3.02647809e+03
  6.64490711e+03  6.64490711e+03  6.64490711e+03  9.34685952e+03
  2.56888831e+04  7.64124763e+04]
E1 = -728.2707592058828  E_coul = 201.51695439036607
cycle= 3 E= -526.753804815517  delta_E= -5.92e-05  |g|= 0.00677  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.014381
diis-c [-8.15360737e-07 -1.28164152e-03  1.52420935e-01  8.48860707e-01]
  HOMO = -0.583029603569204  LUMO = 0.925677380068194
  mo_energy =
[-1.18585721e+02 -1.23126238e+01 -9.56294032e+00 -9.56294032e+00
 -9.56294032e+00 -1.27028421e+00 -5.83029604e-01 -5.83029604e-01
 -5.83029604e-01  9.25677380e-01  1.01867626e+00  1.01867626e+00
  1.01867626e+00  7.36747744e+00  7.36747744e+00  7.36747744e+00
  1.06663754e+01  3.39763098e+01  3.39763098e+01  3.39763098e+01
  6.45985375e+01  1.30663048e+02  1.30663048e+02  1.30663048e+02
  2.52134252e+02  4.85198575e+02  4.85198575e+02  4.85198575e+02
  8.34129250e+02  1.33506816e+03  1.33506816e+03  1.33506816e+03
  2.94706675e+03  3.02646646e+03  3.02646646e+03  3.02646646e+03
  6.64489507e+03  6.64489507e+03  6.64489507e+03  9.34684726e+03
  2.56888706e+04  7.64124637e+04]
E1 = -728.2951251985409  E_coul = 201.54131818684448
cycle= 4 E= -526.753807011696  delta_E= -2.2e-06  |g|= 0.000105  |ddm|= 0.0024
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000117213
diis-c [-4.79276192e-09  8.35297659e-05 -1.20332764e-02 -7.14478883e-02
  1.08339763e+00]
  HOMO = -0.583011039082554  LUMO = 0.92571116517385
  mo_energy =
[-1.18585675e+02 -1.23125555e+01 -9.56288621e+00 -9.56288621e+00
 -9.56288621e+00 -1.27024136e+00 -5.83011039e-01 -5.83011039e-01
 -5.83011039e-01  9.25711165e-01  1.01869252e+00  1.01869252e+00
  1.01869252e+00  7.36752079e+00  7.36752079e+00  7.36752079e+00
  1.06664362e+01  3.39763621e+01  3.39763621e+01  3.39763621e+01
  6.45985973e+01  1.30663101e+02  1.30663101e+02  1.30663101e+02
  2.52134304e+02  4.85198622e+02  4.85198622e+02  4.85198622e+02
  8.34129288e+02  1.33506820e+03  1.33506820e+03  1.33506820e+03
  2.94706676e+03  3.02646648e+03  3.02646648e+03  3.02646648e+03
  6.64489508e+03  6.64489508e+03  6.64489508e+03  9.34684727e+03
  2.56888706e+04  7.64124637e+04]
E1 = -728.2948931805382  E_coul = 201.5410861668694
cycle= 5 E= -526.753807013669  delta_E= -1.97e-09  |g|= 2.09e-05  |ddm|= 0.000171
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.92865e-05
diis-c [-9.08455002e-11  1.27034417e-05 -1.79848195e-03 -1.26117178e-02
  3.53253728e-02  9.79072124e-01]
  HOMO = -0.583018757313667  LUMO = 0.925707389075752
  mo_energy =
[-1.18585706e+02 -1.23125787e+01 -9.56291133e+00 -9.56291133e+00
 -9.56291133e+00 -1.27024746e+00 -5.83018757e-01 -5.83018757e-01
 -5.83018757e-01  9.25707389e-01  1.01868737e+00  1.01868737e+00
  1.01868737e+00  7.36750360e+00  7.36750360e+00  7.36750360e+00
  1.06664187e+01  3.39763377e+01  3.39763377e+01  3.39763377e+01
  6.45985714e+01  1.30663072e+02  1.30663072e+02  1.30663072e+02
  2.52134274e+02  4.85198591e+02  4.85198591e+02  4.85198591e+02
  8.34129256e+02  1.33506816e+03  1.33506816e+03  1.33506816e+03
  2.94706673e+03  3.02646645e+03  3.02646645e+03  3.02646645e+03
  6.64489505e+03  6.64489505e+03  6.64489505e+03  9.34684723e+03
  2.56888706e+04  7.64124637e+04]
E1 = -728.2949757087554  E_coul = 201.54116869502488
cycle= 6 E= -526.75380701373  delta_E= -6.16e-11  |g|= 1.86e-06  |ddm|= 1.97e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2949757087554  E_coul = 201.54116869502488
  HOMO = -0.583018681581115  LUMO = 0.925707805860561
  mo_energy =
[-1.18585705e+02 -1.23125782e+01 -9.56291090e+00 -9.56291090e+00
 -9.56291090e+00 -1.27024696e+00 -5.83018682e-01 -5.83018682e-01
 -5.83018682e-01  9.25707806e-01  1.01868748e+00  1.01868748e+00
  1.01868748e+00  7.36750390e+00  7.36750390e+00  7.36750390e+00
  1.06664191e+01  3.39763381e+01  3.39763381e+01  3.39763381e+01
  6.45985719e+01  1.30663073e+02  1.30663073e+02  1.30663073e+02
  2.52134275e+02  4.85198592e+02  4.85198592e+02  4.85198592e+02
  8.34129257e+02  1.33506816e+03  1.33506816e+03  1.33506816e+03
  2.94706673e+03  3.02646645e+03  3.02646645e+03  3.02646645e+03
  6.64489505e+03  6.64489505e+03  6.64489505e+03  9.34684723e+03
  2.56888706e+04  7.64124637e+04]
E1 = -728.2949732422982  E_coul = 201.54116622856594
Extra cycle  E= -526.753807013732  delta_E= -1.82e-12  |g|= 3.89e-07  |ddm|= 3.31e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.23 sec
exp = [2.61827259e+04 7.61735721e+03 3.61741219e+03 1.59414921e+03
 3.93836752e+02 1.35486073e+02 5.77059366e+01 2.49244769e+01
 7.59057076e+00 6.45743275e-01 2.96573174e+00 2.32619344e-01
 1.36280640e+03 6.64521402e+02 2.99905936e+02 3.13132147e+02
 6.20468577e+01 7.44575234e+00 2.05417627e+01 7.78402614e-01
 2.83796177e+00 2.23263779e-01]
E = -526.7538070137323
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:06 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7258869        1
[INPUT] 0    0    [1    /1   ]  7617.35721418        1
[INPUT] 0    0    [1    /1   ]  3617.41218872        1
[INPUT] 0    0    [1    /1   ]  1594.14921334        1
[INPUT] 0    0    [1    /1   ]  393.836751581        1
[INPUT] 0    0    [1    /1   ]  135.486072785        1
[INPUT] 0    0    [1    /1   ]  57.7059366104        1
[INPUT] 0    0    [1    /1   ]  24.9244768803        1
[INPUT] 0    0    [1    /1   ]  7.59057075998        1
[INPUT] 0    0    [1    /1   ]  0.645743274685       1
[INPUT] 0    0    [1    /1   ]  2.96573174235        1
[INPUT] 0    0    [1    /1   ]  0.232619343702       1
[INPUT] 1    0    [1    /1   ]  1362.80640085        1
[INPUT] 1    0    [1    /1   ]  664.521402227        1
[INPUT] 1    0    [1    /1   ]  299.905936473        1
[INPUT] 1    0    [1    /1   ]  313.132147099        1
[INPUT] 1    0    [1    /1   ]  62.0468576507        1
[INPUT] 1    0    [1    /1   ]  7.44575234474        1
[INPUT] 1    0    [1    /1   ]  20.5417627356        1
[INPUT] 1    0    [1    /1   ]  0.778402613601       1
[INPUT] 1    0    [1    /1   ]  2.83796176504        1
[INPUT] 1    0    [1    /1   ]  0.223263778683       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.72588692765, 1.0]], [0, [7617.357214175581, 1.0]], [0, [3617.412188724227, 1.0]], [0, [1594.1492133449158, 1.0]], [0, [393.8367515814348, 1.0]], [0, [135.48607278450032, 1.0]], [0, [57.705936610433234, 1.0]], [0, [24.924476880340915, 1.0]], [0, [7.5905707599769325, 1.0]], [0, [0.6457432746853389, 1.0]], [0, [2.9657317423502927, 1.0]], [0, [0.23261934370243112, 1.0]], [1, [1362.8064008496913, 1.0]], [1, [664.5214022265304, 1.0]], [1, [299.9059364733404, 1.0]], [1, [313.1321470988552, 1.0]], [1, [62.046857650728825, 1.0]], [1, [7.44575234473948, 1.0]], [1, [20.541762735602862, 1.0]], [1, [0.7784026136014092, 1.0]], [1, [2.8379617650392635, 1.0]], [1, [0.22326377868300262, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.72588693]
bas 1, expnt(s) = [7617.35721418]
bas 2, expnt(s) = [3617.41218872]
bas 3, expnt(s) = [1594.14921334]
bas 4, expnt(s) = [393.83675158]
bas 5, expnt(s) = [135.48607278]
bas 6, expnt(s) = [57.70593661]
bas 7, expnt(s) = [24.92447688]
bas 8, expnt(s) = [7.59057076]
bas 9, expnt(s) = [0.64574327]
bas 10, expnt(s) = [2.96573174]
bas 11, expnt(s) = [0.23261934]
bas 12, expnt(s) = [1362.80640085]
bas 13, expnt(s) = [664.52140223]
bas 14, expnt(s) = [299.90593647]
bas 15, expnt(s) = [313.1321471]
bas 16, expnt(s) = [62.04685765]
bas 17, expnt(s) = [7.44575234]
bas 18, expnt(s) = [20.54176274]
bas 19, expnt(s) = [0.77840261]
bas 20, expnt(s) = [2.83796177]
bas 21, expnt(s) = [0.22326378]
CPU time:       508.55
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827259e+04 5.20027330e+03 7.61735721e+03 2.06000496e+03
 3.61741219e+03 1.17845641e+03 1.59414921e+03 6.37399548e+02
 3.93836752e+02 2.23358356e+02 1.35486073e+02 1.00331202e+02
 5.77059366e+01 5.28969212e+01 2.49244769e+01 2.81828276e+01
 7.59057076e+00 1.15536937e+01 6.45743275e-01 1.81995204e+00
 2.96573174e+00 5.70970833e+00 2.32619344e-01 8.46251388e-01
 1.36280640e+03 2.41561156e+04 6.64521402e+02 9.84284415e+03
 2.99905936e+02 3.64095843e+03 3.13132147e+02 3.84276620e+03
 6.20468577e+01 5.08023886e+02 7.44575234e+00 3.58814617e+01
 2.05417627e+01 1.27579686e+02 7.78402614e-01 2.13299457e+00
 2.83796177e+00 1.07458944e+01 2.23263779e-01 4.47720759e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99367792302482
cond(S) = 113257.42601840592
E1 = -729.5442874894236  E_coul = 203.1753823268134
init E= -526.36890516261
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555757495730377  LUMO = 0.945565071186904
  mo_energy =
[-1.18334510e+02 -1.22066690e+01 -9.44718485e+00 -9.44718485e+00
 -9.44718485e+00 -1.24020467e+00 -5.55757496e-01 -5.55757496e-01
 -5.55757496e-01  9.45565071e-01  1.03747127e+00  1.03747127e+00
  1.03747127e+00  7.43910961e+00  7.43910961e+00  7.43910961e+00
  1.07435420e+01  3.40981492e+01  3.40981492e+01  3.40981492e+01
  6.47359362e+01  1.30845282e+02  1.30845282e+02  1.30845282e+02
  2.52337094e+02  4.85449013e+02  4.85449013e+02  4.85449013e+02
  8.34423628e+02  1.33537186e+03  1.33537186e+03  1.33537186e+03
  2.94749923e+03  3.02683388e+03  3.02683388e+03  3.02683388e+03
  6.64537451e+03  6.64537451e+03  6.64537451e+03  9.34739902e+03
  2.56895177e+04  7.64132015e+04]
E1 = -727.8465304067033  E_coul = 201.09351366183364
cycle= 1 E= -526.75301674487  delta_E= -0.384  |g|= 0.188  |ddm|= 0.313
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.581463
diis-c [-0.33809892  1.        ]
  HOMO = -0.590673620729962  LUMO = 0.9191610970666
  mo_energy =
[-1.18643775e+02 -1.23450138e+01 -9.59663271e+00 -9.59663271e+00
 -9.59663271e+00 -1.27954609e+00 -5.90673621e-01 -5.90673621e-01
 -5.90673621e-01  9.19161097e-01  1.01297848e+00  1.01297848e+00
  1.01297848e+00  7.34727625e+00  7.34727625e+00  7.34727625e+00
  1.06430646e+01  3.39420646e+01  3.39420646e+01  3.39420646e+01
  6.45586125e+01  1.30615191e+02  1.30615191e+02  1.30615191e+02
  2.52082150e+02  4.85141240e+02  4.85141240e+02  4.85141240e+02
  8.34069650e+02  1.33500735e+03  1.33500735e+03  1.33500735e+03
  2.94700336e+03  3.02640378e+03  3.02640378e+03  3.02640378e+03
  6.64483103e+03  6.64483103e+03  6.64483103e+03  9.34678267e+03
  2.56888056e+04  7.64123985e+04]
E1 = -728.4231313316678  E_coul = 201.66938567804027
cycle= 2 E= -526.753745653628  delta_E= -0.000729  |g|= 0.0379  |ddm|= 0.0535
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.077386
diis-c [-0.00390983  0.07310325  0.92689675]
  HOMO = -0.581433483359685  LUMO = 0.926920910237325
  mo_energy =
[-1.18575018e+02 -1.23064086e+01 -9.55635448e+00 -9.55635448e+00
 -9.55635448e+00 -1.26848275e+00 -5.81433483e-01 -5.81433483e-01
 -5.81433483e-01  9.26920910e-01  1.01983562e+00  1.01983562e+00
  1.01983562e+00  7.37153816e+00  7.37153816e+00  7.37153816e+00
  1.06709065e+01  3.39829522e+01  3.39829522e+01  3.39829522e+01
  6.46060966e+01  1.30672020e+02  1.30672020e+02  1.30672020e+02
  2.52143924e+02  4.85209152e+02  4.85209152e+02  4.85209152e+02
  8.34140268e+02  1.33507937e+03  1.33507937e+03  1.33507937e+03
  2.94707861e+03  3.02647809e+03  3.02647809e+03  3.02647809e+03
  6.64490711e+03  6.64490711e+03  6.64490711e+03  9.34685952e+03
  2.56888831e+04  7.64124763e+04]
E1 = -728.2707592058828  E_coul = 201.51695439036607
cycle= 3 E= -526.753804815517  delta_E= -5.92e-05  |g|= 0.00677  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.014381
diis-c [-8.15360737e-07 -1.28164152e-03  1.52420935e-01  8.48860707e-01]
  HOMO = -0.583029603569204  LUMO = 0.925677380068194
  mo_energy =
[-1.18585721e+02 -1.23126238e+01 -9.56294032e+00 -9.56294032e+00
 -9.56294032e+00 -1.27028421e+00 -5.83029604e-01 -5.83029604e-01
 -5.83029604e-01  9.25677380e-01  1.01867626e+00  1.01867626e+00
  1.01867626e+00  7.36747744e+00  7.36747744e+00  7.36747744e+00
  1.06663754e+01  3.39763098e+01  3.39763098e+01  3.39763098e+01
  6.45985375e+01  1.30663048e+02  1.30663048e+02  1.30663048e+02
  2.52134252e+02  4.85198575e+02  4.85198575e+02  4.85198575e+02
  8.34129250e+02  1.33506816e+03  1.33506816e+03  1.33506816e+03
  2.94706675e+03  3.02646646e+03  3.02646646e+03  3.02646646e+03
  6.64489507e+03  6.64489507e+03  6.64489507e+03  9.34684726e+03
  2.56888706e+04  7.64124637e+04]
E1 = -728.2951251985409  E_coul = 201.54131818684448
cycle= 4 E= -526.753807011696  delta_E= -2.2e-06  |g|= 0.000105  |ddm|= 0.0024
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000117213
diis-c [-4.79276192e-09  8.35297659e-05 -1.20332764e-02 -7.14478883e-02
  1.08339763e+00]
  HOMO = -0.583011039082554  LUMO = 0.92571116517385
  mo_energy =
[-1.18585675e+02 -1.23125555e+01 -9.56288621e+00 -9.56288621e+00
 -9.56288621e+00 -1.27024136e+00 -5.83011039e-01 -5.83011039e-01
 -5.83011039e-01  9.25711165e-01  1.01869252e+00  1.01869252e+00
  1.01869252e+00  7.36752079e+00  7.36752079e+00  7.36752079e+00
  1.06664362e+01  3.39763621e+01  3.39763621e+01  3.39763621e+01
  6.45985973e+01  1.30663101e+02  1.30663101e+02  1.30663101e+02
  2.52134304e+02  4.85198622e+02  4.85198622e+02  4.85198622e+02
  8.34129288e+02  1.33506820e+03  1.33506820e+03  1.33506820e+03
  2.94706676e+03  3.02646648e+03  3.02646648e+03  3.02646648e+03
  6.64489508e+03  6.64489508e+03  6.64489508e+03  9.34684727e+03
  2.56888706e+04  7.64124637e+04]
E1 = -728.2948931805382  E_coul = 201.5410861668694
cycle= 5 E= -526.753807013669  delta_E= -1.97e-09  |g|= 2.09e-05  |ddm|= 0.000171
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.92865e-05
diis-c [-9.08455002e-11  1.27034417e-05 -1.79848195e-03 -1.26117178e-02
  3.53253728e-02  9.79072124e-01]
  HOMO = -0.583018757313667  LUMO = 0.925707389075752
  mo_energy =
[-1.18585706e+02 -1.23125787e+01 -9.56291133e+00 -9.56291133e+00
 -9.56291133e+00 -1.27024746e+00 -5.83018757e-01 -5.83018757e-01
 -5.83018757e-01  9.25707389e-01  1.01868737e+00  1.01868737e+00
  1.01868737e+00  7.36750360e+00  7.36750360e+00  7.36750360e+00
  1.06664187e+01  3.39763377e+01  3.39763377e+01  3.39763377e+01
  6.45985714e+01  1.30663072e+02  1.30663072e+02  1.30663072e+02
  2.52134274e+02  4.85198591e+02  4.85198591e+02  4.85198591e+02
  8.34129256e+02  1.33506816e+03  1.33506816e+03  1.33506816e+03
  2.94706673e+03  3.02646645e+03  3.02646645e+03  3.02646645e+03
  6.64489505e+03  6.64489505e+03  6.64489505e+03  9.34684723e+03
  2.56888706e+04  7.64124637e+04]
E1 = -728.2949757087554  E_coul = 201.54116869502488
cycle= 6 E= -526.75380701373  delta_E= -6.16e-11  |g|= 1.86e-06  |ddm|= 1.97e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2949757087554  E_coul = 201.54116869502488
  HOMO = -0.583018681581115  LUMO = 0.925707805860561
  mo_energy =
[-1.18585705e+02 -1.23125782e+01 -9.56291090e+00 -9.56291090e+00
 -9.56291090e+00 -1.27024696e+00 -5.83018682e-01 -5.83018682e-01
 -5.83018682e-01  9.25707806e-01  1.01868748e+00  1.01868748e+00
  1.01868748e+00  7.36750390e+00  7.36750390e+00  7.36750390e+00
  1.06664191e+01  3.39763381e+01  3.39763381e+01  3.39763381e+01
  6.45985719e+01  1.30663073e+02  1.30663073e+02  1.30663073e+02
  2.52134275e+02  4.85198592e+02  4.85198592e+02  4.85198592e+02
  8.34129257e+02  1.33506816e+03  1.33506816e+03  1.33506816e+03
  2.94706673e+03  3.02646645e+03  3.02646645e+03  3.02646645e+03
  6.64489505e+03  6.64489505e+03  6.64489505e+03  9.34684723e+03
  2.56888706e+04  7.64124637e+04]
E1 = -728.2949732422982  E_coul = 201.54116622856594
Extra cycle  E= -526.753807013732  delta_E= -1.82e-12  |g|= 3.89e-07  |ddm|= 3.31e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 113257.42601840592
E1 = -728.2949732422982  E_coul = 201.54116622856594
init E= -526.753807013732
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583018744689011  LUMO = 0.925707828263351
  mo_energy =
[-1.18585706e+02 -1.23125783e+01 -9.56291111e+00 -9.56291111e+00
 -9.56291111e+00 -1.27024695e+00 -5.83018745e-01 -5.83018745e-01
 -5.83018745e-01  9.25707828e-01  1.01868745e+00  1.01868745e+00
  1.01868745e+00  7.36750377e+00  7.36750377e+00  7.36750377e+00
  1.06664190e+01  3.39763379e+01  3.39763379e+01  3.39763379e+01
  6.45985717e+01  1.30663073e+02  1.30663073e+02  1.30663073e+02
  2.52134274e+02  4.85198591e+02  4.85198591e+02  4.85198591e+02
  8.34129257e+02  1.33506816e+03  1.33506816e+03  1.33506816e+03
  2.94706673e+03  3.02646645e+03  3.02646645e+03  3.02646645e+03
  6.64489505e+03  6.64489505e+03  6.64489505e+03  9.34684723e+03
  2.56888706e+04  7.64124637e+04]
E1 = -728.2949737856092  E_coul = 201.54116677187838
cycle= 1 E= -526.753807013731  delta_E= 1.48e-12  |g|= 8.73e-08  |ddm|= 6.24e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2949737856092  E_coul = 201.54116677187838
  HOMO = -0.583018737488743  LUMO = 0.92570784921588
  mo_energy =
[-1.18585705e+02 -1.23125783e+01 -9.56291107e+00 -9.56291107e+00
 -9.56291107e+00 -1.27024692e+00 -5.83018737e-01 -5.83018737e-01
 -5.83018737e-01  9.25707849e-01  1.01868746e+00  1.01868746e+00
  1.01868746e+00  7.36750379e+00  7.36750379e+00  7.36750379e+00
  1.06664191e+01  3.39763380e+01  3.39763380e+01  3.39763380e+01
  6.45985717e+01  1.30663073e+02  1.30663073e+02  1.30663073e+02
  2.52134274e+02  4.85198592e+02  4.85198592e+02  4.85198592e+02
  8.34129257e+02  1.33506816e+03  1.33506816e+03  1.33506816e+03
  2.94706673e+03  3.02646645e+03  3.02646645e+03  3.02646645e+03
  6.64489505e+03  6.64489505e+03  6.64489505e+03  9.34684723e+03
  2.56888706e+04  7.64124637e+04]
E1 = -728.2949736023379  E_coul = 201.5411665886058
Extra cycle  E= -526.753807013732  delta_E= -1.25e-12  |g|= 1.85e-08  |ddm|= 1.41e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.43 sec
exp = [2.61827259e+04 7.61735721e+03 3.61741219e+03 1.59414921e+03
 3.93836752e+02 1.35486073e+02 5.77059366e+01 2.49244769e+01
 7.59057076e+00 6.45743275e-01 2.96573174e+00 2.32619344e-01
 1.36280640e+03 6.64521402e+02 2.99905936e+02 3.13132147e+02
 6.20468577e+01 7.44575234e+00 2.05417627e+01 7.78402614e-01
 2.83796177e+00 2.23263779e-01]
grad_E = [-1.57042339e-06  3.92407393e-06 -1.24451426e-06  9.40944659e-05
 -6.04373783e-04  3.59178647e-04 -1.84645731e-05 -4.70072443e-05
  1.12319262e-03 -2.62973194e-03 -2.73278434e-03  5.29944940e-03
 -5.17604753e-07  4.95352579e-06  2.35126636e-05  2.02012140e-05
 -1.23688983e-04  6.47274042e-04  4.16818465e-04 -1.76128954e-03
 -1.87455338e-03  4.75503712e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:10 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7735836        1
[INPUT] 0    0    [1    /1   ]  7617.24346156        1
[INPUT] 0    0    [1    /1   ]  3617.45254317        1
[INPUT] 0    0    [1    /1   ]  1591.57977509        1
[INPUT] 0    0    [1    /1   ]  402.968347395        1
[INPUT] 0    0    [1    /1   ]  149.951355768        1
[INPUT] 0    0    [1    /1   ]  71.4829334632        1
[INPUT] 0    0    [1    /1   ]  31.2619960257        1
[INPUT] 0    0    [1    /1   ]  8.05263050174        1
[INPUT] 0    0    [1    /1   ]  0.63912413619        1
[INPUT] 0    0    [1    /1   ]  3.09536281192        1
[INPUT] 0    0    [1    /1   ]  0.234146548564       1
[INPUT] 1    0    [1    /1   ]  1362.82214453        1
[INPUT] 1    0    [1    /1   ]  664.369184978        1
[INPUT] 1    0    [1    /1   ]  299.188977203        1
[INPUT] 1    0    [1    /1   ]  312.514319508        1
[INPUT] 1    0    [1    /1   ]  62.457118849         1
[INPUT] 1    0    [1    /1   ]  7.28670890527        1
[INPUT] 1    0    [1    /1   ]  20.3866397487        1
[INPUT] 1    0    [1    /1   ]  0.769092200222       1
[INPUT] 1    0    [1    /1   ]  2.7487960288         1
[INPUT] 1    0    [1    /1   ]  0.221516123773       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.77358355126, 1.0]], [0, [7617.243461561369, 1.0]], [0, [3617.452543167962, 1.0]], [0, [1591.579775088914, 1.0]], [0, [402.9683473954502, 1.0]], [0, [149.95135576793388, 1.0]], [0, [71.48293346322386, 1.0]], [0, [31.261996025745567, 1.0]], [0, [8.052630501744646, 1.0]], [0, [0.6391241361898486, 1.0]], [0, [3.095362811919812, 1.0]], [0, [0.2341465485643965, 1.0]], [1, [1362.822144530008, 1.0]], [1, [664.3691849784545, 1.0]], [1, [299.1889772028852, 1.0]], [1, [312.5143195075972, 1.0]], [1, [62.45711884903899, 1.0]], [1, [7.286708905274981, 1.0]], [1, [20.386639748672867, 1.0]], [1, [0.7690922002215402, 1.0]], [1, [2.7487960287994, 1.0]], [1, [0.22151612377323904, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.77358355]
bas 1, expnt(s) = [7617.24346156]
bas 2, expnt(s) = [3617.45254317]
bas 3, expnt(s) = [1591.57977509]
bas 4, expnt(s) = [402.9683474]
bas 5, expnt(s) = [149.95135577]
bas 6, expnt(s) = [71.48293346]
bas 7, expnt(s) = [31.26199603]
bas 8, expnt(s) = [8.0526305]
bas 9, expnt(s) = [0.63912414]
bas 10, expnt(s) = [3.09536281]
bas 11, expnt(s) = [0.23414655]
bas 12, expnt(s) = [1362.82214453]
bas 13, expnt(s) = [664.36918498]
bas 14, expnt(s) = [299.1889772]
bas 15, expnt(s) = [312.51431951]
bas 16, expnt(s) = [62.45711885]
bas 17, expnt(s) = [7.28670891]
bas 18, expnt(s) = [20.38663975]
bas 19, expnt(s) = [0.7690922]
bas 20, expnt(s) = [2.74879603]
bas 21, expnt(s) = [0.22151612]
CPU time:       514.05
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827736e+04 5.20028040e+03 7.61724346e+03 2.05998189e+03
 3.61745254e+03 1.17846627e+03 1.59157978e+03 6.36628876e+02
 4.02968347e+02 2.27231338e+02 1.49951356e+02 1.08262443e+02
 7.14829335e+01 6.21107537e+01 3.12619960e+01 3.34023907e+01
 8.05263050e+00 1.20772583e+01 6.39124136e-01 1.80594258e+00
 3.09536281e+00 5.89588080e+00 2.34146549e-01 8.50414868e-01
 1.36282214e+03 2.41564644e+04 6.64369185e+02 9.84002594e+03
 2.99188977e+02 3.63008153e+03 3.12514320e+02 3.83329105e+03
 6.24571188e+01 5.12226244e+02 7.28670891e+00 3.49259854e+01
 2.03866397e+01 1.26376538e+02 7.69092200e-01 2.10115166e+00
 2.74879603e+00 1.03255344e+01 2.21516124e-01 4.43344241e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993938536212376
cond(S) = 112212.35506335953
E1 = -729.5377146344546  E_coul = 203.17504511311887
init E= -526.362669521336
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555874420041928  LUMO = 0.948935655980032
  mo_energy =
[-1.18334519e+02 -1.22064215e+01 -9.44710612e+00 -9.44710612e+00
 -9.44710612e+00 -1.24017264e+00 -5.55874420e-01 -5.55874420e-01
 -5.55874420e-01  9.48935656e-01  1.02225453e+00  1.02225453e+00
  1.02225453e+00  7.20191865e+00  7.20191865e+00  7.20191865e+00
  1.17435550e+01  3.32613706e+01  3.32613706e+01  3.32613706e+01
  7.96312765e+01  1.29913307e+02  1.29913307e+02  1.29913307e+02
  3.08926306e+02  4.84852863e+02  4.84852863e+02  4.84852863e+02
  9.47719853e+02  1.33368933e+03  1.33368933e+03  1.33368933e+03
  3.02335610e+03  3.02335610e+03  3.02335610e+03  3.09775837e+03
  6.64067059e+03  6.64067059e+03  6.64067059e+03  9.50022865e+03
  2.58361185e+04  7.65499674e+04]
E1 = -727.8408456605463  E_coul = 201.0884713505864
cycle= 1 E= -526.75237430996  delta_E= -0.39  |g|= 0.188  |ddm|= 0.307
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587934
diis-c [-0.34566582  1.        ]
  HOMO = -0.590748401502898  LUMO = 0.922232093388615
  mo_energy =
[-1.18644018e+02 -1.23453198e+01 -9.59711574e+00 -9.59711574e+00
 -9.59711574e+00 -1.27952463e+00 -5.90748402e-01 -5.90748402e-01
 -5.90748402e-01  9.22232093e-01  9.98187983e-01  9.98187983e-01
  9.98187983e-01  7.11153368e+00  7.11153368e+00  7.11153368e+00
  1.16372865e+01  3.31057580e+01  3.31057580e+01  3.31057580e+01
  7.94386661e+01  1.29682071e+02  1.29682071e+02  1.29682071e+02
  3.08658440e+02  4.84545300e+02  4.84545300e+02  4.84545300e+02
  9.47360700e+02  1.33332507e+03  1.33332507e+03  1.33332507e+03
  3.02292675e+03  3.02292675e+03  3.02292675e+03  3.09726401e+03
  6.64012840e+03  6.64012840e+03  6.64012840e+03  9.49961505e+03
  2.58354088e+04  7.65491667e+04]
E1 = -728.4188110183986  E_coul = 201.6657067729875
cycle= 2 E= -526.753104245411  delta_E= -0.00073  |g|= 0.0379  |ddm|= 0.0539
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0769543
diis-c [-0.00396026  0.07043233  0.92956767]
  HOMO = -0.581431200343469  LUMO = 0.930120530156826
  mo_energy =
[-1.18574986e+02 -1.23065064e+01 -9.55663583e+00 -9.55663583e+00
 -9.55663583e+00 -1.26837718e+00 -5.81431200e-01 -5.81431200e-01
 -5.81431200e-01  9.30120530e-01  1.00497667e+00  1.00497667e+00
  1.00497667e+00  7.13551410e+00  7.13551410e+00  7.13551410e+00
  1.16668509e+01  3.31466658e+01  3.31466658e+01  3.31466658e+01
  7.94896859e+01  1.29739210e+02  1.29739210e+02  1.29739210e+02
  3.08722286e+02  4.84613500e+02  4.84613500e+02  4.84613500e+02
  9.47431964e+02  1.33339738e+03  1.33339738e+03  1.33339738e+03
  3.02300135e+03  3.02300135e+03  3.02300135e+03  3.09733955e+03
  6.64020478e+03  6.64020478e+03  6.64020478e+03  9.49969218e+03
  2.58354866e+04  7.65492448e+04]
E1 = -728.2656039174341  E_coul = 201.51244041711365
cycle= 3 E= -526.75316350032  delta_E= -5.93e-05  |g|= 0.00691  |ddm|= 0.0165
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0145975
diis-c [-7.66417235e-07 -1.25252033e-03  1.55327658e-01  8.45924862e-01]
  HOMO = -0.583058374467466  LUMO = 0.928836469164898
  mo_energy =
[-1.18585906e+02 -1.23128454e+01 -9.56334997e+00 -9.56334997e+00
 -9.56334997e+00 -1.27021899e+00 -5.83058374e-01 -5.83058374e-01
 -5.83058374e-01  9.28836469e-01  1.00381478e+00  1.00381478e+00
  1.00381478e+00  7.13144574e+00  7.13144574e+00  7.13144574e+00
  1.16619876e+01  3.31399214e+01  3.31399214e+01  3.31399214e+01
  7.94814777e+01  1.29730048e+02  1.29730048e+02  1.29730048e+02
  3.08712148e+02  4.84602709e+02  4.84602709e+02  4.84602709e+02
  9.47420666e+02  1.33338594e+03  1.33338594e+03  1.33338594e+03
  3.02298949e+03  3.02298949e+03  3.02298949e+03  3.09732745e+03
  6.64019250e+03  6.64019250e+03  6.64019250e+03  9.49967969e+03
  2.58354739e+04  7.65492320e+04]
E1 = -728.2904795347854  E_coul = 201.53731374998142
cycle= 4 E= -526.753165784804  delta_E= -2.28e-06  |g|= 0.000101  |ddm|= 0.00246
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000116469
diis-c [-4.44211947e-09  7.99276706e-05 -1.16929414e-02 -6.85530515e-02
  1.08016607e+00]
  HOMO = -0.583040615659413  LUMO = 0.928868957908413
  mo_energy =
[-1.18585864e+02 -1.23127805e+01 -9.56329929e+00 -9.56329929e+00
 -9.56329929e+00 -1.27017806e+00 -5.83040616e-01 -5.83040616e-01
 -5.83040616e-01  9.28868958e-01  1.00383012e+00  1.00383012e+00
  1.00383012e+00  7.13148646e+00  7.13148646e+00  7.13148646e+00
  1.16620468e+01  3.31399702e+01  3.31399702e+01  3.31399702e+01
  7.94815327e+01  1.29730097e+02  1.29730097e+02  1.29730097e+02
  3.08712194e+02  4.84602751e+02  4.84602751e+02  4.84602751e+02
  9.47420699e+02  1.33338597e+03  1.33338597e+03  1.33338597e+03
  3.02298951e+03  3.02298951e+03  3.02298951e+03  3.09732746e+03
  6.64019251e+03  6.64019251e+03  6.64019251e+03  9.49967969e+03
  2.58354739e+04  7.65492319e+04]
E1 = -728.2902629681951  E_coul = 201.53709718159004
cycle= 5 E= -526.753165786605  delta_E= -1.8e-09  |g|= 2.05e-05  |ddm|= 0.000164
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.85588e-05
diis-c [-8.32681260e-11  1.25702515e-05 -1.83937395e-03 -1.25586502e-02
  3.72898896e-02  9.77095564e-01]
  HOMO = -0.583048096644729  LUMO = 0.928865261037378
  mo_energy =
[-1.18585894e+02 -1.23128030e+01 -9.56332368e+00 -9.56332368e+00
 -9.56332368e+00 -1.27018398e+00 -5.83048097e-01 -5.83048097e-01
 -5.83048097e-01  9.28865261e-01  1.00382522e+00  1.00382522e+00
  1.00382522e+00  7.13147004e+00  7.13147004e+00  7.13147004e+00
  1.16620290e+01  3.31399465e+01  3.31399465e+01  3.31399465e+01
  7.94815066e+01  1.29730069e+02  1.29730069e+02  1.29730069e+02
  3.08712164e+02  4.84602721e+02  4.84602721e+02  4.84602721e+02
  9.47420668e+02  1.33338594e+03  1.33338594e+03  1.33338594e+03
  3.02298948e+03  3.02298948e+03  3.02298948e+03  3.09732743e+03
  6.64019248e+03  6.64019248e+03  6.64019248e+03  9.49967966e+03
  2.58354738e+04  7.65492319e+04]
E1 = -728.2903433817404  E_coul = 201.53717759507674
cycle= 6 E= -526.753165786664  delta_E= -5.87e-11  |g|= 1.84e-06  |ddm|= 1.92e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2903433817404  E_coul = 201.53717759507674
  HOMO = -0.583048052326777  LUMO = 0.928865653548927
  mo_energy =
[-1.18585894e+02 -1.23128026e+01 -9.56332337e+00 -9.56332337e+00
 -9.56332337e+00 -1.27018352e+00 -5.83048052e-01 -5.83048052e-01
 -5.83048052e-01  9.28865654e-01  1.00382531e+00  1.00382531e+00
  1.00382531e+00  7.13147025e+00  7.13147025e+00  7.13147025e+00
  1.16620294e+01  3.31399468e+01  3.31399468e+01  3.31399468e+01
  7.94815070e+01  1.29730069e+02  1.29730069e+02  1.29730069e+02
  3.08712165e+02  4.84602721e+02  4.84602721e+02  4.84602721e+02
  9.47420669e+02  1.33338594e+03  1.33338594e+03  1.33338594e+03
  3.02298948e+03  3.02298948e+03  3.02298948e+03  3.09732743e+03
  6.64019248e+03  6.64019248e+03  6.64019248e+03  9.49967966e+03
  2.58354738e+04  7.65492319e+04]
E1 = -728.2903413744028  E_coul = 201.53717558773883
Extra cycle  E= -526.753165786664  delta_E= -3.41e-13  |g|= 3.82e-07  |ddm|= 3.31e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
exp = [2.61827736e+04 7.61724346e+03 3.61745254e+03 1.59157978e+03
 4.02968347e+02 1.49951356e+02 7.14829335e+01 3.12619960e+01
 8.05263050e+00 6.39124136e-01 3.09536281e+00 2.34146549e-01
 1.36282214e+03 6.64369185e+02 2.99188977e+02 3.12514320e+02
 6.24571188e+01 7.28670891e+00 2.03866397e+01 7.69092200e-01
 2.74879603e+00 2.21516124e-01]
E = -526.753165786664
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:11 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7404228        1
[INPUT] 0    0    [1    /1   ]  7617.32254726        1
[INPUT] 0    0    [1    /1   ]  3617.42448703        1
[INPUT] 0    0    [1    /1   ]  1593.36615881        1
[INPUT] 0    0    [1    /1   ]  396.619670179        1
[INPUT] 0    0    [1    /1   ]  139.89447038         1
[INPUT] 0    0    [1    /1   ]  61.9045741254        1
[INPUT] 0    0    [1    /1   ]  26.8558807937        1
[INPUT] 0    0    [1    /1   ]  7.7313867438         1
[INPUT] 0    0    [1    /1   ]  0.643726045277       1
[INPUT] 0    0    [1    /1   ]  3.00523773031        1
[INPUT] 0    0    [1    /1   ]  0.233084770217       1
[INPUT] 1    0    [1    /1   ]  1362.81119885        1
[INPUT] 1    0    [1    /1   ]  664.47501294         1
[INPUT] 1    0    [1    /1   ]  299.68743805         1
[INPUT] 1    0    [1    /1   ]  312.943859758        1
[INPUT] 1    0    [1    /1   ]  62.171887661         1
[INPUT] 1    0    [1    /1   ]  7.39728272842        1
[INPUT] 1    0    [1    /1   ]  20.494487905         1
[INPUT] 1    0    [1    /1   ]  0.775565199083       1
[INPUT] 1    0    [1    /1   ]  2.81078787444        1
[INPUT] 1    0    [1    /1   ]  0.222731168453       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.74042281202, 1.0]], [0, [7617.322547259521, 1.0]], [0, [3617.4244870272005, 1.0]], [0, [1593.366158810658, 1.0]], [0, [396.61967017870865, 1.0]], [0, [139.89447037998312, 1.0]], [0, [61.90457412539736, 1.0]], [0, [26.85588079369156, 1.0]], [0, [7.731386743799096, 1.0]], [0, [0.6437260452774451, 1.0]], [0, [3.0052377303108884, 1.0]], [0, [0.23308477021700455, 1.0]], [1, [1362.811198847942, 1.0]], [1, [664.4750129404599, 1.0]], [1, [299.68743805007733, 1.0]], [1, [312.94385975799617, 1.0]], [1, [62.1718876610108, 1.0]], [1, [7.397282728423257, 1.0]], [1, [20.494487905005393, 1.0]], [1, [0.7755651990825386, 1.0]], [1, [2.8107878744427612, 1.0]], [1, [0.2227311684526491, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.74042281]
bas 1, expnt(s) = [7617.32254726]
bas 2, expnt(s) = [3617.42448703]
bas 3, expnt(s) = [1593.36615881]
bas 4, expnt(s) = [396.61967018]
bas 5, expnt(s) = [139.89447038]
bas 6, expnt(s) = [61.90457413]
bas 7, expnt(s) = [26.85588079]
bas 8, expnt(s) = [7.73138674]
bas 9, expnt(s) = [0.64372605]
bas 10, expnt(s) = [3.00523773]
bas 11, expnt(s) = [0.23308477]
bas 12, expnt(s) = [1362.81119885]
bas 13, expnt(s) = [664.47501294]
bas 14, expnt(s) = [299.68743805]
bas 15, expnt(s) = [312.94385976]
bas 16, expnt(s) = [62.17188766]
bas 17, expnt(s) = [7.39728273]
bas 18, expnt(s) = [20.49448791]
bas 19, expnt(s) = [0.7755652]
bas 20, expnt(s) = [2.81078787]
bas 21, expnt(s) = [0.22273117]
CPU time:       514.55
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827404e+04 5.20027546e+03 7.61732255e+03 2.05999793e+03
 3.61742449e+03 1.17845941e+03 1.59336616e+03 6.37164713e+02
 3.96619670e+02 2.24541030e+02 1.39894470e+02 1.02769782e+02
 6.19045741e+01 5.57579861e+01 2.68558808e+01 2.98053739e+01
 7.73138674e+00 1.17140770e+01 6.43726045e-01 1.81568638e+00
 3.00523773e+00 5.76665738e+00 2.33084770e-01 8.47520960e-01
 1.36281120e+03 2.41562219e+04 6.64475013e+02 9.84198526e+03
 2.99687438e+02 3.63764293e+03 3.12943860e+02 3.83987809e+03
 6.21718877e+01 5.09303850e+02 7.39728273e+00 3.55897277e+01
 2.04944879e+01 1.27212776e+02 7.75565199e-01 2.12328007e+00
 2.81078787e+00 1.06174318e+01 2.22731168e-01 4.46386073e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993764123222178
cond(S) = 112913.48745065267
E1 = -729.5438611606603  E_coul = 203.1751394996536
init E= -526.368721661007
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555789819015555  LUMO = 0.946743655218959
  mo_energy =
[-1.18334718e+02 -1.22066285e+01 -9.44718149e+00 -9.44718149e+00
 -9.44718149e+00 -1.24020115e+00 -5.55789819e-01 -5.55789819e-01
 -5.55789819e-01  9.46743655e-01  1.03281920e+00  1.03281920e+00
  1.03281920e+00  7.36658833e+00  7.36658833e+00  7.36658833e+00
  1.10443545e+01  3.38432744e+01  3.38432744e+01  3.38432744e+01
  6.91962969e+01  1.30561417e+02  1.30561417e+02  1.30561417e+02
  2.69676603e+02  4.85267194e+02  4.85267194e+02  4.85267194e+02
  8.69239246e+02  1.33485875e+03  1.33485875e+03  1.33485875e+03
  2.99333703e+03  3.02577357e+03  3.02577357e+03  3.02577357e+03
  6.64394031e+03  6.64394031e+03  6.64394031e+03  9.39384108e+03
  2.57340159e+04  7.64546953e+04]
E1 = -727.845203335722  E_coul = 201.091932907014
cycle= 1 E= -526.753270428708  delta_E= -0.385  |g|= 0.188  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.583918
diis-c [-0.34096001  1.        ]
  HOMO = -0.590694643448426  LUMO = 0.920237228639505
  mo_energy =
[-1.18644158e+02 -1.23451017e+01 -9.59675966e+00 -9.59675966e+00
 -9.59675966e+00 -1.27954888e+00 -5.90694643e-01 -5.90694643e-01
 -5.90694643e-01  9.20237229e-01  1.00845537e+00  1.00845537e+00
  1.00845537e+00  7.27520541e+00  7.27520541e+00  7.27520541e+00
  1.09421073e+01  3.36873203e+01  3.36873203e+01  3.36873203e+01
  6.90140787e+01  1.30330978e+02  1.30330978e+02  1.30330978e+02
  2.69417351e+02  4.84959314e+02  4.84959314e+02  4.84959314e+02
  8.68883428e+02  1.33449411e+03  1.33449411e+03  1.33449411e+03
  2.99284129e+03  3.02534340e+03  3.02534340e+03  3.02534340e+03
  6.64339685e+03  6.64339685e+03  6.64339685e+03  9.39322514e+03
  2.57333042e+04  7.64538926e+04]
E1 = -728.4223246690452  E_coul = 201.6683247459991
cycle= 2 E= -526.753999923046  delta_E= -0.000729  |g|= 0.0379  |ddm|= 0.0536
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0772983
diis-c [-0.00393068  0.07225575  0.92774425]
  HOMO = -0.58143050162134  LUMO = 0.928038665325578
  mo_energy =
[-1.18575293e+02 -1.23064262e+01 -9.55641154e+00 -9.55641154e+00
 -9.55641154e+00 -1.26845954e+00 -5.81430502e-01 -5.81430502e-01
 -5.81430502e-01  9.28038665e-01  1.01529236e+00  1.01529236e+00
  1.01529236e+00  7.29938623e+00  7.29938623e+00  7.29938623e+00
  1.09704899e+01  3.37282236e+01  3.37282236e+01  3.37282236e+01
  6.90627332e+01  1.30387919e+02  1.30387919e+02  1.30387919e+02
  2.69479838e+02  4.85027337e+02  4.85027337e+02  4.85027337e+02
  8.68954272e+02  1.33456625e+03  1.33456625e+03  1.33456625e+03
  2.99291666e+03  3.02541783e+03  3.02541783e+03  3.02541783e+03
  6.64347305e+03  6.64347305e+03  6.64347305e+03  9.39330210e+03
  2.57333818e+04  7.64539705e+04]
E1 = -728.26966771495  E_coul = 201.5156085814452
cycle= 3 E= -526.754059133505  delta_E= -5.92e-05  |g|= 0.00681  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0144551
diis-c [-8.02178896e-07 -1.27437246e-03  1.53298936e-01  8.47975436e-01]
  HOMO = -0.583036678684994  LUMO = 0.926781942757017
  mo_energy =
[-1.18586068e+02 -1.23126820e+01 -9.56303935e+00 -9.56303935e+00
 -9.56303935e+00 -1.27027407e+00 -5.83036679e-01 -5.83036679e-01
 -5.83036679e-01  9.26781943e-01  1.01413170e+00  1.01413170e+00
  1.01413170e+00  7.29532101e+00  7.29532101e+00  7.29532101e+00
  1.09658544e+01  3.37215470e+01  3.37215470e+01  3.37215470e+01
  6.90549628e+01  1.30378885e+02  1.30378885e+02  1.30378885e+02
  2.69470012e+02  4.85016690e+02  4.85016690e+02  4.85016690e+02
  8.68943163e+02  1.33455496e+03  1.33455496e+03  1.33455496e+03
  2.99290471e+03  3.02540612e+03  3.02540612e+03  3.02540612e+03
  6.64346093e+03  6.64346093e+03  6.64346093e+03  9.39328977e+03
  2.57333692e+04  7.64539578e+04]
E1 = -728.2941998784414  E_coul = 201.54013852044218
cycle= 4 E= -526.754061357999  delta_E= -2.22e-06  |g|= 0.000104  |ddm|= 0.00242
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000116446
diis-c [-4.68576774e-09  8.19865066e-05 -1.18650776e-02 -7.01530170e-02
  1.08193611e+00]
  HOMO = -0.583018197525023  LUMO = 0.926815450718908
  mo_energy =
[-1.18586022e+02 -1.23126143e+01 -9.56298580e+00 -9.56298580e+00
 -9.56298580e+00 -1.27023165e+00 -5.83018198e-01 -5.83018198e-01
 -5.83018198e-01  9.26815451e-01  1.01414779e+00  1.01414779e+00
  1.01414779e+00  7.29536390e+00  7.29536390e+00  7.29536390e+00
  1.09659152e+01  3.37215987e+01  3.37215987e+01  3.37215987e+01
  6.90550217e+01  1.30378937e+02  1.30378937e+02  1.30378937e+02
  2.69470062e+02  4.85016736e+02  4.85016736e+02  4.85016736e+02
  8.68943200e+02  1.33455500e+03  1.33455500e+03  1.33455500e+03
  2.99290473e+03  3.02540615e+03  3.02540615e+03  3.02540615e+03
  6.64346094e+03  6.64346094e+03  6.64346094e+03  9.39328977e+03
  2.57333692e+04  7.64539578e+04]
E1 = -728.2939709604526  E_coul = 201.539909600535
cycle= 5 E= -526.754061359918  delta_E= -1.92e-09  |g|= 2.08e-05  |ddm|= 0.000168
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.91616e-05
diis-c [-8.86460287e-11  1.26802318e-05 -1.81251062e-03 -1.26080054e-02
  3.60498659e-02  9.78357970e-01]
  HOMO = -0.583025854191846  LUMO = 0.926811692643413
  mo_energy =
[-1.18586053e+02 -1.23126373e+01 -9.56301074e+00 -9.56301074e+00
 -9.56301074e+00 -1.27023771e+00 -5.83025854e-01 -5.83025854e-01
 -5.83025854e-01  9.26811693e-01  1.01414271e+00  1.01414271e+00
  1.01414271e+00  7.29534693e+00  7.29534693e+00  7.29534693e+00
  1.09658975e+01  3.37215745e+01  3.37215745e+01  3.37215745e+01
  6.90549957e+01  1.30378908e+02  1.30378908e+02  1.30378908e+02
  2.69470033e+02  4.85016705e+02  4.85016705e+02  4.85016705e+02
  8.68943168e+02  1.33455496e+03  1.33455496e+03  1.33455496e+03
  2.99290470e+03  3.02540611e+03  3.02540611e+03  3.02540611e+03
  6.64346091e+03  6.64346091e+03  6.64346091e+03  9.39328974e+03
  2.57333692e+04  7.64539577e+04]
E1 = -728.2940529737463  E_coul = 201.5399916137666
cycle= 6 E= -526.75406135998  delta_E= -6.21e-11  |g|= 1.86e-06  |ddm|= 1.96e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2940529737463  E_coul = 201.5399916137666
  HOMO = -0.583025791473741  LUMO = 0.92681210054982
  mo_energy =
[-1.18586052e+02 -1.23126369e+01 -9.56301035e+00 -9.56301035e+00
 -9.56301035e+00 -1.27023722e+00 -5.83025791e-01 -5.83025791e-01
 -5.83025791e-01  9.26812101e-01  1.01414282e+00  1.01414282e+00
  1.01414282e+00  7.29534719e+00  7.29534719e+00  7.29534719e+00
  1.09658979e+01  3.37215749e+01  3.37215749e+01  3.37215749e+01
  6.90549962e+01  1.30378909e+02  1.30378909e+02  1.30378909e+02
  2.69470033e+02  4.85016706e+02  4.85016706e+02  4.85016706e+02
  8.68943169e+02  1.33455496e+03  1.33455496e+03  1.33455496e+03
  2.99290470e+03  3.02540611e+03  3.02540611e+03  3.02540611e+03
  6.64346091e+03  6.64346091e+03  6.64346091e+03  9.39328974e+03
  2.57333692e+04  7.64539577e+04]
E1 = -728.2940506838767  E_coul = 201.53998932389482
Extra cycle  E= -526.754061359982  delta_E= -2.16e-12  |g|= 3.88e-07  |ddm|= 3.32e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
exp = [2.61827404e+04 7.61732255e+03 3.61742449e+03 1.59336616e+03
 3.96619670e+02 1.39894470e+02 6.19045741e+01 2.68558808e+01
 7.73138674e+00 6.43726045e-01 3.00523773e+00 2.33084770e-01
 1.36281120e+03 6.64475013e+02 2.99687438e+02 3.12943860e+02
 6.21718877e+01 7.39728273e+00 2.04944879e+01 7.75565199e-01
 2.81078787e+00 2.22731168e-01]
E = -526.7540613599818
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:11 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7404228        1
[INPUT] 0    0    [1    /1   ]  7617.32254726        1
[INPUT] 0    0    [1    /1   ]  3617.42448703        1
[INPUT] 0    0    [1    /1   ]  1593.36615881        1
[INPUT] 0    0    [1    /1   ]  396.619670179        1
[INPUT] 0    0    [1    /1   ]  139.89447038         1
[INPUT] 0    0    [1    /1   ]  61.9045741254        1
[INPUT] 0    0    [1    /1   ]  26.8558807937        1
[INPUT] 0    0    [1    /1   ]  7.7313867438         1
[INPUT] 0    0    [1    /1   ]  0.643726045277       1
[INPUT] 0    0    [1    /1   ]  3.00523773031        1
[INPUT] 0    0    [1    /1   ]  0.233084770217       1
[INPUT] 1    0    [1    /1   ]  1362.81119885        1
[INPUT] 1    0    [1    /1   ]  664.47501294         1
[INPUT] 1    0    [1    /1   ]  299.68743805         1
[INPUT] 1    0    [1    /1   ]  312.943859758        1
[INPUT] 1    0    [1    /1   ]  62.171887661         1
[INPUT] 1    0    [1    /1   ]  7.39728272842        1
[INPUT] 1    0    [1    /1   ]  20.494487905         1
[INPUT] 1    0    [1    /1   ]  0.775565199083       1
[INPUT] 1    0    [1    /1   ]  2.81078787444        1
[INPUT] 1    0    [1    /1   ]  0.222731168453       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.74042281202, 1.0]], [0, [7617.322547259521, 1.0]], [0, [3617.4244870272005, 1.0]], [0, [1593.366158810658, 1.0]], [0, [396.61967017870865, 1.0]], [0, [139.89447037998312, 1.0]], [0, [61.90457412539736, 1.0]], [0, [26.85588079369156, 1.0]], [0, [7.731386743799096, 1.0]], [0, [0.6437260452774451, 1.0]], [0, [3.0052377303108884, 1.0]], [0, [0.23308477021700455, 1.0]], [1, [1362.811198847942, 1.0]], [1, [664.4750129404599, 1.0]], [1, [299.68743805007733, 1.0]], [1, [312.94385975799617, 1.0]], [1, [62.1718876610108, 1.0]], [1, [7.397282728423257, 1.0]], [1, [20.494487905005393, 1.0]], [1, [0.7755651990825386, 1.0]], [1, [2.8107878744427612, 1.0]], [1, [0.2227311684526491, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.74042281]
bas 1, expnt(s) = [7617.32254726]
bas 2, expnt(s) = [3617.42448703]
bas 3, expnt(s) = [1593.36615881]
bas 4, expnt(s) = [396.61967018]
bas 5, expnt(s) = [139.89447038]
bas 6, expnt(s) = [61.90457413]
bas 7, expnt(s) = [26.85588079]
bas 8, expnt(s) = [7.73138674]
bas 9, expnt(s) = [0.64372605]
bas 10, expnt(s) = [3.00523773]
bas 11, expnt(s) = [0.23308477]
bas 12, expnt(s) = [1362.81119885]
bas 13, expnt(s) = [664.47501294]
bas 14, expnt(s) = [299.68743805]
bas 15, expnt(s) = [312.94385976]
bas 16, expnt(s) = [62.17188766]
bas 17, expnt(s) = [7.39728273]
bas 18, expnt(s) = [20.49448791]
bas 19, expnt(s) = [0.7755652]
bas 20, expnt(s) = [2.81078787]
bas 21, expnt(s) = [0.22273117]
CPU time:       515.05
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827404e+04 5.20027546e+03 7.61732255e+03 2.05999793e+03
 3.61742449e+03 1.17845941e+03 1.59336616e+03 6.37164713e+02
 3.96619670e+02 2.24541030e+02 1.39894470e+02 1.02769782e+02
 6.19045741e+01 5.57579861e+01 2.68558808e+01 2.98053739e+01
 7.73138674e+00 1.17140770e+01 6.43726045e-01 1.81568638e+00
 3.00523773e+00 5.76665738e+00 2.33084770e-01 8.47520960e-01
 1.36281120e+03 2.41562219e+04 6.64475013e+02 9.84198526e+03
 2.99687438e+02 3.63764293e+03 3.12943860e+02 3.83987809e+03
 6.21718877e+01 5.09303850e+02 7.39728273e+00 3.55897277e+01
 2.04944879e+01 1.27212776e+02 7.75565199e-01 2.12328007e+00
 2.81078787e+00 1.06174318e+01 2.22731168e-01 4.46386073e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993764123222178
cond(S) = 112913.48745065267
E1 = -729.5438611606603  E_coul = 203.1751394996536
init E= -526.368721661007
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555789819015555  LUMO = 0.946743655218959
  mo_energy =
[-1.18334718e+02 -1.22066285e+01 -9.44718149e+00 -9.44718149e+00
 -9.44718149e+00 -1.24020115e+00 -5.55789819e-01 -5.55789819e-01
 -5.55789819e-01  9.46743655e-01  1.03281920e+00  1.03281920e+00
  1.03281920e+00  7.36658833e+00  7.36658833e+00  7.36658833e+00
  1.10443545e+01  3.38432744e+01  3.38432744e+01  3.38432744e+01
  6.91962969e+01  1.30561417e+02  1.30561417e+02  1.30561417e+02
  2.69676603e+02  4.85267194e+02  4.85267194e+02  4.85267194e+02
  8.69239246e+02  1.33485875e+03  1.33485875e+03  1.33485875e+03
  2.99333703e+03  3.02577357e+03  3.02577357e+03  3.02577357e+03
  6.64394031e+03  6.64394031e+03  6.64394031e+03  9.39384108e+03
  2.57340159e+04  7.64546953e+04]
E1 = -727.845203335722  E_coul = 201.091932907014
cycle= 1 E= -526.753270428708  delta_E= -0.385  |g|= 0.188  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.583918
diis-c [-0.34096001  1.        ]
  HOMO = -0.590694643448426  LUMO = 0.920237228639505
  mo_energy =
[-1.18644158e+02 -1.23451017e+01 -9.59675966e+00 -9.59675966e+00
 -9.59675966e+00 -1.27954888e+00 -5.90694643e-01 -5.90694643e-01
 -5.90694643e-01  9.20237229e-01  1.00845537e+00  1.00845537e+00
  1.00845537e+00  7.27520541e+00  7.27520541e+00  7.27520541e+00
  1.09421073e+01  3.36873203e+01  3.36873203e+01  3.36873203e+01
  6.90140787e+01  1.30330978e+02  1.30330978e+02  1.30330978e+02
  2.69417351e+02  4.84959314e+02  4.84959314e+02  4.84959314e+02
  8.68883428e+02  1.33449411e+03  1.33449411e+03  1.33449411e+03
  2.99284129e+03  3.02534340e+03  3.02534340e+03  3.02534340e+03
  6.64339685e+03  6.64339685e+03  6.64339685e+03  9.39322514e+03
  2.57333042e+04  7.64538926e+04]
E1 = -728.4223246690452  E_coul = 201.6683247459991
cycle= 2 E= -526.753999923046  delta_E= -0.000729  |g|= 0.0379  |ddm|= 0.0536
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0772983
diis-c [-0.00393068  0.07225575  0.92774425]
  HOMO = -0.58143050162134  LUMO = 0.928038665325578
  mo_energy =
[-1.18575293e+02 -1.23064262e+01 -9.55641154e+00 -9.55641154e+00
 -9.55641154e+00 -1.26845954e+00 -5.81430502e-01 -5.81430502e-01
 -5.81430502e-01  9.28038665e-01  1.01529236e+00  1.01529236e+00
  1.01529236e+00  7.29938623e+00  7.29938623e+00  7.29938623e+00
  1.09704899e+01  3.37282236e+01  3.37282236e+01  3.37282236e+01
  6.90627332e+01  1.30387919e+02  1.30387919e+02  1.30387919e+02
  2.69479838e+02  4.85027337e+02  4.85027337e+02  4.85027337e+02
  8.68954272e+02  1.33456625e+03  1.33456625e+03  1.33456625e+03
  2.99291666e+03  3.02541783e+03  3.02541783e+03  3.02541783e+03
  6.64347305e+03  6.64347305e+03  6.64347305e+03  9.39330210e+03
  2.57333818e+04  7.64539705e+04]
E1 = -728.26966771495  E_coul = 201.5156085814452
cycle= 3 E= -526.754059133505  delta_E= -5.92e-05  |g|= 0.00681  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0144551
diis-c [-8.02178896e-07 -1.27437246e-03  1.53298936e-01  8.47975436e-01]
  HOMO = -0.583036678684994  LUMO = 0.926781942757017
  mo_energy =
[-1.18586068e+02 -1.23126820e+01 -9.56303935e+00 -9.56303935e+00
 -9.56303935e+00 -1.27027407e+00 -5.83036679e-01 -5.83036679e-01
 -5.83036679e-01  9.26781943e-01  1.01413170e+00  1.01413170e+00
  1.01413170e+00  7.29532101e+00  7.29532101e+00  7.29532101e+00
  1.09658544e+01  3.37215470e+01  3.37215470e+01  3.37215470e+01
  6.90549628e+01  1.30378885e+02  1.30378885e+02  1.30378885e+02
  2.69470012e+02  4.85016690e+02  4.85016690e+02  4.85016690e+02
  8.68943163e+02  1.33455496e+03  1.33455496e+03  1.33455496e+03
  2.99290471e+03  3.02540612e+03  3.02540612e+03  3.02540612e+03
  6.64346093e+03  6.64346093e+03  6.64346093e+03  9.39328977e+03
  2.57333692e+04  7.64539578e+04]
E1 = -728.2941998784414  E_coul = 201.54013852044218
cycle= 4 E= -526.754061357999  delta_E= -2.22e-06  |g|= 0.000104  |ddm|= 0.00242
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116446
diis-c [-4.68576774e-09  8.19865066e-05 -1.18650776e-02 -7.01530170e-02
  1.08193611e+00]
  HOMO = -0.583018197525023  LUMO = 0.926815450718908
  mo_energy =
[-1.18586022e+02 -1.23126143e+01 -9.56298580e+00 -9.56298580e+00
 -9.56298580e+00 -1.27023165e+00 -5.83018198e-01 -5.83018198e-01
 -5.83018198e-01  9.26815451e-01  1.01414779e+00  1.01414779e+00
  1.01414779e+00  7.29536390e+00  7.29536390e+00  7.29536390e+00
  1.09659152e+01  3.37215987e+01  3.37215987e+01  3.37215987e+01
  6.90550217e+01  1.30378937e+02  1.30378937e+02  1.30378937e+02
  2.69470062e+02  4.85016736e+02  4.85016736e+02  4.85016736e+02
  8.68943200e+02  1.33455500e+03  1.33455500e+03  1.33455500e+03
  2.99290473e+03  3.02540615e+03  3.02540615e+03  3.02540615e+03
  6.64346094e+03  6.64346094e+03  6.64346094e+03  9.39328977e+03
  2.57333692e+04  7.64539578e+04]
E1 = -728.2939709604526  E_coul = 201.539909600535
cycle= 5 E= -526.754061359918  delta_E= -1.92e-09  |g|= 2.08e-05  |ddm|= 0.000168
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.91616e-05
diis-c [-8.86460287e-11  1.26802318e-05 -1.81251062e-03 -1.26080054e-02
  3.60498659e-02  9.78357970e-01]
  HOMO = -0.583025854191846  LUMO = 0.926811692643413
  mo_energy =
[-1.18586053e+02 -1.23126373e+01 -9.56301074e+00 -9.56301074e+00
 -9.56301074e+00 -1.27023771e+00 -5.83025854e-01 -5.83025854e-01
 -5.83025854e-01  9.26811693e-01  1.01414271e+00  1.01414271e+00
  1.01414271e+00  7.29534693e+00  7.29534693e+00  7.29534693e+00
  1.09658975e+01  3.37215745e+01  3.37215745e+01  3.37215745e+01
  6.90549957e+01  1.30378908e+02  1.30378908e+02  1.30378908e+02
  2.69470033e+02  4.85016705e+02  4.85016705e+02  4.85016705e+02
  8.68943168e+02  1.33455496e+03  1.33455496e+03  1.33455496e+03
  2.99290470e+03  3.02540611e+03  3.02540611e+03  3.02540611e+03
  6.64346091e+03  6.64346091e+03  6.64346091e+03  9.39328974e+03
  2.57333692e+04  7.64539577e+04]
E1 = -728.2940529737463  E_coul = 201.5399916137666
cycle= 6 E= -526.75406135998  delta_E= -6.21e-11  |g|= 1.86e-06  |ddm|= 1.96e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2940529737463  E_coul = 201.5399916137666
  HOMO = -0.583025791473741  LUMO = 0.92681210054982
  mo_energy =
[-1.18586052e+02 -1.23126369e+01 -9.56301035e+00 -9.56301035e+00
 -9.56301035e+00 -1.27023722e+00 -5.83025791e-01 -5.83025791e-01
 -5.83025791e-01  9.26812101e-01  1.01414282e+00  1.01414282e+00
  1.01414282e+00  7.29534719e+00  7.29534719e+00  7.29534719e+00
  1.09658979e+01  3.37215749e+01  3.37215749e+01  3.37215749e+01
  6.90549962e+01  1.30378909e+02  1.30378909e+02  1.30378909e+02
  2.69470033e+02  4.85016706e+02  4.85016706e+02  4.85016706e+02
  8.68943169e+02  1.33455496e+03  1.33455496e+03  1.33455496e+03
  2.99290470e+03  3.02540611e+03  3.02540611e+03  3.02540611e+03
  6.64346091e+03  6.64346091e+03  6.64346091e+03  9.39328974e+03
  2.57333692e+04  7.64539577e+04]
E1 = -728.2940506838767  E_coul = 201.53998932389482
Extra cycle  E= -526.754061359982  delta_E= -2.16e-12  |g|= 3.88e-07  |ddm|= 3.32e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 112913.48745065267
E1 = -728.2940506838767  E_coul = 201.53998932389482
init E= -526.754061359982
    CPU time for initialize scf      0.83 sec, wall time      0.34 sec
  HOMO = -0.583025851060322  LUMO = 0.926812126005591
  mo_energy =
[-1.18586053e+02 -1.23126370e+01 -9.56301054e+00 -9.56301054e+00
 -9.56301054e+00 -1.27023721e+00 -5.83025851e-01 -5.83025851e-01
 -5.83025851e-01  9.26812126e-01  1.01414279e+00  1.01414279e+00
  1.01414279e+00  7.29534707e+00  7.29534707e+00  7.29534707e+00
  1.09658978e+01  3.37215747e+01  3.37215747e+01  3.37215747e+01
  6.90549960e+01  1.30378909e+02  1.30378909e+02  1.30378909e+02
  2.69470033e+02  4.85016706e+02  4.85016706e+02  4.85016706e+02
  8.68943168e+02  1.33455496e+03  1.33455496e+03  1.33455496e+03
  2.99290470e+03  3.02540611e+03  3.02540611e+03  3.02540611e+03
  6.64346091e+03  6.64346091e+03  6.64346091e+03  9.39328974e+03
  2.57333692e+04  7.64539577e+04]
E1 = -728.2940511793018  E_coul = 201.53998981932068
cycle= 1 E= -526.754061359981  delta_E= 6.82e-13  |g|= 8.63e-08  |ddm|= 6.28e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2940511793018  E_coul = 201.53998981932068
  HOMO = -0.583025844743279  LUMO = 0.926812146327838
  mo_energy =
[-1.18586053e+02 -1.23126370e+01 -9.56301051e+00 -9.56301051e+00
 -9.56301051e+00 -1.27023718e+00 -5.83025845e-01 -5.83025845e-01
 -5.83025845e-01  9.26812146e-01  1.01414280e+00  1.01414280e+00
  1.01414280e+00  7.29534709e+00  7.29534709e+00  7.29534709e+00
  1.09658979e+01  3.37215747e+01  3.37215747e+01  3.37215747e+01
  6.90549960e+01  1.30378909e+02  1.30378909e+02  1.30378909e+02
  2.69470033e+02  4.85016706e+02  4.85016706e+02  4.85016706e+02
  8.68943168e+02  1.33455496e+03  1.33455496e+03  1.33455496e+03
  2.99290470e+03  3.02540611e+03  3.02540611e+03  3.02540611e+03
  6.64346091e+03  6.64346091e+03  6.64346091e+03  9.39328974e+03
  2.57333692e+04  7.64539577e+04]
E1 = -728.294051009797  E_coul = 201.5399896498171
Extra cycle  E= -526.75406135998  delta_E= 1.25e-12  |g|= 1.82e-08  |ddm|= 1.41e-07
    CPU time for scf_cycle      0.94 sec, wall time      0.44 sec
exp = [2.61827404e+04 7.61732255e+03 3.61742449e+03 1.59336616e+03
 3.96619670e+02 1.39894470e+02 6.19045741e+01 2.68558808e+01
 7.73138674e+00 6.43726045e-01 3.00523773e+00 2.33084770e-01
 1.36281120e+03 6.64475013e+02 2.99687438e+02 3.12943860e+02
 6.21718877e+01 7.39728273e+00 2.04944879e+01 7.75565199e-01
 2.81078787e+00 2.22731168e-01]
grad_E = [-1.56496241e-06  3.85546258e-06 -1.32584219e-06  9.21318661e-05
 -5.88718604e-04  3.72033964e-04 -1.12738868e-04  1.38426405e-04
  1.68361620e-03 -3.91493637e-03 -4.09232923e-03  7.95763180e-03
 -5.34114359e-07  4.74536380e-06  2.23294487e-05  1.91686118e-05
 -6.26066836e-05  7.66515125e-04  3.34468795e-04 -2.65274433e-03
 -2.85796130e-03  7.17805736e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:16 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7896647        1
[INPUT] 0    0    [1    /1   ]  7617.20468701        1
[INPUT] 0    0    [1    /1   ]  3617.46575394        1
[INPUT] 0    0    [1    /1   ]  1590.69626675        1
[INPUT] 0    0    [1    /1   ]  406.452959905        1
[INPUT] 0    0    [1    /1   ]  154.054823537        1
[INPUT] 0    0    [1    /1   ]  74.8851704598        1
[INPUT] 0    0    [1    /1   ]  31.4526625149        1
[INPUT] 0    0    [1    /1   ]  8.12873065856        1
[INPUT] 0    0    [1    /1   ]  0.636557614743       1
[INPUT] 0    0    [1    /1   ]  3.11979033901        1
[INPUT] 0    0    [1    /1   ]  0.234645386935       1
[INPUT] 1    0    [1    /1   ]  1362.82744243        1
[INPUT] 1    0    [1    /1   ]  664.318061404        1
[INPUT] 1    0    [1    /1   ]  298.948192646        1
[INPUT] 1    0    [1    /1   ]  312.306841629        1
[INPUT] 1    0    [1    /1   ]  62.6007444145        1
[INPUT] 1    0    [1    /1   ]  7.21365024936        1
[INPUT] 1    0    [1    /1   ]  20.3041233864        1
[INPUT] 1    0    [1    /1   ]  0.764795016426       1
[INPUT] 1    0    [1    /1   ]  2.70790294969        1
[INPUT] 1    0    [1    /1   ]  0.220755656904       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.78966470335, 1.0]], [0, [7617.204687011013, 1.0]], [0, [3617.465753935315, 1.0]], [0, [1590.696266749746, 1.0]], [0, [406.45295990455855, 1.0]], [0, [154.05482353659878, 1.0]], [0, [74.8851704597565, 1.0]], [0, [31.45266251488042, 1.0]], [0, [8.128730658562594, 1.0]], [0, [0.6365576147429675, 1.0]], [0, [3.1197903390108364, 1.0]], [0, [0.23464538693544426, 1.0]], [1, [1362.8274424264864, 1.0]], [1, [664.3180614043974, 1.0]], [1, [298.9481926459502, 1.0]], [1, [312.30684162905425, 1.0]], [1, [62.600744414522076, 1.0]], [1, [7.213650249358971, 1.0]], [1, [20.304123386424266, 1.0]], [1, [0.7647950164260432, 1.0]], [1, [2.707902949686677, 1.0]], [1, [0.22075565690375612, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.7896647]
bas 1, expnt(s) = [7617.20468701]
bas 2, expnt(s) = [3617.46575394]
bas 3, expnt(s) = [1590.69626675]
bas 4, expnt(s) = [406.4529599]
bas 5, expnt(s) = [154.05482354]
bas 6, expnt(s) = [74.88517046]
bas 7, expnt(s) = [31.45266251]
bas 8, expnt(s) = [8.12873066]
bas 9, expnt(s) = [0.63655761]
bas 10, expnt(s) = [3.11979034]
bas 11, expnt(s) = [0.23464539]
bas 12, expnt(s) = [1362.82744243]
bas 13, expnt(s) = [664.3180614]
bas 14, expnt(s) = [298.94819265]
bas 15, expnt(s) = [312.30684163]
bas 16, expnt(s) = [62.60074441]
bas 17, expnt(s) = [7.21365025]
bas 18, expnt(s) = [20.30412339]
bas 19, expnt(s) = [0.76479502]
bas 20, expnt(s) = [2.70790295]
bas 21, expnt(s) = [0.22075566]
CPU time:       520.53
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827897e+04 5.20028280e+03 7.61720469e+03 2.05997402e+03
 3.61746575e+03 1.17846950e+03 1.59069627e+03 6.36363806e+02
 4.06452960e+02 2.28703464e+02 1.54054824e+02 1.10476905e+02
 7.48851705e+01 6.43149433e+01 3.14526625e+01 3.35550651e+01
 8.12873066e+00 1.21627582e+01 6.36557615e-01 1.80050077e+00
 3.11979034e+00 5.93074267e+00 2.34645387e-01 8.51773334e-01
 1.36282744e+03 2.41565818e+04 6.64318061e+02 9.83907946e+03
 2.98948193e+02 3.62643007e+03 3.12306842e+02 3.83011016e+03
 6.26007444e+01 5.13699052e+02 7.21365025e+00 3.44888128e+01
 2.03041234e+01 1.25737464e+02 7.64795016e-01 2.08648710e+00
 2.70790295e+00 1.01338801e+01 2.20755657e-01 4.41442552e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994060028546645
cond(S) = 111513.53806984563
E1 = -729.5413408251485  E_coul = 203.17401988737637
init E= -526.367320937772
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555925560350318  LUMO = 0.94877142660024
  mo_energy =
[-1.18335426e+02 -1.22064667e+01 -9.44713035e+00 -9.44713035e+00
 -9.44713035e+00 -1.24019691e+00 -5.55925560e-01 -5.55925560e-01
 -5.55925560e-01  9.48771427e-01  1.01546234e+00  1.01546234e+00
  1.01546234e+00  7.09399339e+00  7.09399339e+00  7.09399339e+00
  1.18846744e+01  3.28695336e+01  3.28695336e+01  3.28695336e+01
  8.14341044e+01  1.29413799e+02  1.29413799e+02  1.29413799e+02
  3.18632885e+02  4.84477666e+02  4.84477666e+02  4.84477666e+02
  9.72055711e+02  1.33296854e+03  1.33296854e+03  1.33296854e+03
  3.02204455e+03  3.02204455e+03  3.02204455e+03  3.13437941e+03
  6.63896074e+03  6.63896074e+03  6.63896074e+03  9.53887003e+03
  2.58733944e+04  7.65847650e+04]
E1 = -727.8418177474094  E_coul = 201.0880795121746
cycle= 1 E= -526.753738235235  delta_E= -0.386  |g|= 0.188  |ddm|= 0.302
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.5878
diis-c [-0.34550938  1.        ]
  HOMO = -0.590762584942152  LUMO = 0.922036256487684
  mo_energy =
[-1.18645094e+02 -1.23452787e+01 -9.59704541e+00 -9.59704541e+00
 -9.59704541e+00 -1.27953661e+00 -5.90762585e-01 -5.90762585e-01
 -5.90762585e-01  9.22036256e-01  9.91607651e-01  9.91607651e-01
  9.91607651e-01  7.00447763e+00  7.00447763e+00  7.00447763e+00
  1.17778292e+01  3.27142908e+01  3.27142908e+01  3.27142908e+01
  8.12397106e+01  1.29182462e+02  1.29182462e+02  1.29182462e+02
  3.18362395e+02  4.84169746e+02  4.84169746e+02  4.84169746e+02
  9.71694650e+02  1.33260408e+03  1.33260408e+03  1.33260408e+03
  3.02161480e+03  3.02161480e+03  3.02161480e+03  3.13388456e+03
  6.63841813e+03  6.63841813e+03  6.63841813e+03  9.53825621e+03
  2.58726845e+04  7.65839639e+04]
E1 = -728.420257654694  E_coul = 201.66578914609053
cycle= 2 E= -526.754468508603  delta_E= -0.00073  |g|= 0.038  |ddm|= 0.054
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076884
diis-c [-0.00394562  0.07050978  0.92949022]
  HOMO = -0.581438182245508  LUMO = 0.929931829212242
  mo_energy =
[-1.18575996e+02 -1.23064402e+01 -9.55653828e+00 -9.55653828e+00
 -9.55653828e+00 -1.26838457e+00 -5.81438182e-01 -5.81438182e-01
 -5.81438182e-01  9.29931829e-01  9.98345516e-01  9.98345516e-01
  9.98345516e-01  7.02826994e+00  7.02826994e+00  7.02826994e+00
  1.18076051e+01  3.27551334e+01  3.27551334e+01  3.27551334e+01
  8.12911545e+01  1.29239675e+02  1.29239675e+02  1.29239675e+02
  3.18426629e+02  4.84238016e+02  4.84238016e+02  4.84238016e+02
  9.71766087e+02  1.33267645e+03  1.33267645e+03  1.33267645e+03
  3.02168947e+03  3.02168947e+03  3.02168947e+03  3.13396017e+03
  6.63849458e+03  6.63849458e+03  6.63849458e+03  9.53833342e+03
  2.58727623e+04  7.65840421e+04]
E1 = -728.2668718064544  E_coul = 201.51234395491454
cycle= 3 E= -526.75452785154  delta_E= -5.93e-05  |g|= 0.00691  |ddm|= 0.0165
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0145746
diis-c [-7.60296653e-07 -1.24815856e-03  1.55241528e-01  8.46006631e-01]
  HOMO = -0.583067521941303  LUMO = 0.928643870144022
  mo_energy =
[-1.18586924e+02 -1.23127862e+01 -9.56325854e+00 -9.56325854e+00
 -9.56325854e+00 -1.27023055e+00 -5.83067522e-01 -5.83067522e-01
 -5.83067522e-01  9.28643870e-01  9.97191427e-01  9.97191427e-01
  9.97191427e-01  7.02423058e+00  7.02423058e+00  7.02423058e+00
  1.18027057e+01  3.27483970e+01  3.27483970e+01  3.27483970e+01
  8.12828824e+01  1.29230502e+02  1.29230502e+02  1.29230502e+02
  3.18416434e+02  4.84227216e+02  4.84227216e+02  4.84227216e+02
  9.71754764e+02  1.33266500e+03  1.33266500e+03  1.33266500e+03
  3.02167760e+03  3.02167760e+03  3.02167760e+03  3.13394807e+03
  6.63848230e+03  6.63848230e+03  6.63848230e+03  9.53832092e+03
  2.58727496e+04  7.65840293e+04]
E1 = -728.2917886028162  E_coul = 201.53725846320103
cycle= 4 E= -526.754530139615  delta_E= -2.29e-06  |g|= 9.95e-05  |ddm|= 0.00246
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000113703
diis-c [-4.44740727e-09  7.76365520e-05 -1.13718491e-02 -6.66406735e-02
  1.07793489e+00]
  HOMO = -0.583049102426956  LUMO = 0.928676467025734
  mo_energy =
[-1.18586880e+02 -1.23127196e+01 -9.56320593e+00 -9.56320593e+00
 -9.56320593e+00 -1.27018937e+00 -5.83049102e-01 -5.83049102e-01
 -5.83049102e-01  9.28676467e-01  9.97207063e-01  9.97207063e-01
  9.97207063e-01  7.02427244e+00  7.02427244e+00  7.02427244e+00
  1.18027663e+01  3.27484476e+01  3.27484476e+01  3.27484476e+01
  8.12829393e+01  1.29230553e+02  1.29230553e+02  1.29230553e+02
  3.18416482e+02  4.84227261e+02  4.84227261e+02  4.84227261e+02
  9.71754799e+02  1.33266504e+03  1.33266504e+03  1.33266504e+03
  3.02167763e+03  3.02167763e+03  3.02167763e+03  3.13394808e+03
  6.63848231e+03  6.63848231e+03  6.63848231e+03  9.53832092e+03
  2.58727496e+04  7.65840292e+04]
E1 = -728.2915667832939  E_coul = 201.5370366419539
cycle= 5 E= -526.75453014134  delta_E= -1.72e-09  |g|= 2.05e-05  |ddm|= 0.000161
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.8602e-05
diis-c [-8.15329615e-11  1.26247376e-05 -1.84696786e-03 -1.26132496e-02
  3.92907771e-02  9.75156816e-01]
  HOMO = -0.583056572705004  LUMO = 0.92867274148639
  mo_energy =
[-1.18586910e+02 -1.23127421e+01 -9.56323031e+00 -9.56323031e+00
 -9.56323031e+00 -1.27019532e+00 -5.83056573e-01 -5.83056573e-01
 -5.83056573e-01  9.28672741e-01  9.97202208e-01  9.97202208e-01
  9.97202208e-01  7.02425615e+00  7.02425615e+00  7.02425615e+00
  1.18027485e+01  3.27484239e+01  3.27484239e+01  3.27484239e+01
  8.12829131e+01  1.29230525e+02  1.29230525e+02  1.29230525e+02
  3.18416452e+02  4.84227230e+02  4.84227230e+02  4.84227230e+02
  9.71754768e+02  1.33266501e+03  1.33266501e+03  1.33266501e+03
  3.02167760e+03  3.02167760e+03  3.02167760e+03  3.13394805e+03
  6.63848228e+03  6.63848228e+03  6.63848228e+03  9.53832089e+03
  2.58727496e+04  7.65840292e+04]
E1 = -728.29164736437  E_coul = 201.5371172229715
cycle= 6 E= -526.754530141399  delta_E= -5.85e-11  |g|= 1.84e-06  |ddm|= 1.89e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.29164736437  E_coul = 201.5371172229715
  HOMO = -0.583056550070373  LUMO = 0.928673118310393
  mo_energy =
[-1.18586910e+02 -1.23127418e+01 -9.56323007e+00 -9.56323007e+00
 -9.56323007e+00 -1.27019488e+00 -5.83056550e-01 -5.83056550e-01
 -5.83056550e-01  9.28673118e-01  9.97202283e-01  9.97202283e-01
  9.97202283e-01  7.02425631e+00  7.02425631e+00  7.02425631e+00
  1.18027489e+01  3.27484242e+01  3.27484242e+01  3.27484242e+01
  8.12829135e+01  1.29230525e+02  1.29230525e+02  1.29230525e+02
  3.18416453e+02  4.84227231e+02  4.84227231e+02  4.84227231e+02
  9.71754768e+02  1.33266501e+03  1.33266501e+03  1.33266501e+03
  3.02167760e+03  3.02167760e+03  3.02167760e+03  3.13394805e+03
  6.63848228e+03  6.63848228e+03  6.63848228e+03  9.53832089e+03
  2.58727496e+04  7.65840292e+04]
E1 = -728.2916456420577  E_coul = 201.53711550065952
Extra cycle  E= -526.754530141398  delta_E= 3.41e-13  |g|= 3.82e-07  |ddm|= 3.32e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
exp = [2.61827897e+04 7.61720469e+03 3.61746575e+03 1.59069627e+03
 4.06452960e+02 1.54054824e+02 7.48851705e+01 3.14526625e+01
 8.12873066e+00 6.36557615e-01 3.11979034e+00 2.34645387e-01
 1.36282744e+03 6.64318061e+02 2.98948193e+02 3.12306842e+02
 6.26007444e+01 7.21365025e+00 2.03041234e+01 7.64795016e-01
 2.70790295e+00 2.20755657e-01]
E = -526.7545301413982
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:16 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.7896647        1
[INPUT] 0    0    [1    /1   ]  7617.20468701        1
[INPUT] 0    0    [1    /1   ]  3617.46575394        1
[INPUT] 0    0    [1    /1   ]  1590.69626675        1
[INPUT] 0    0    [1    /1   ]  406.452959905        1
[INPUT] 0    0    [1    /1   ]  154.054823537        1
[INPUT] 0    0    [1    /1   ]  74.8851704598        1
[INPUT] 0    0    [1    /1   ]  31.4526625149        1
[INPUT] 0    0    [1    /1   ]  8.12873065856        1
[INPUT] 0    0    [1    /1   ]  0.636557614743       1
[INPUT] 0    0    [1    /1   ]  3.11979033901        1
[INPUT] 0    0    [1    /1   ]  0.234645386935       1
[INPUT] 1    0    [1    /1   ]  1362.82744243        1
[INPUT] 1    0    [1    /1   ]  664.318061404        1
[INPUT] 1    0    [1    /1   ]  298.948192646        1
[INPUT] 1    0    [1    /1   ]  312.306841629        1
[INPUT] 1    0    [1    /1   ]  62.6007444145        1
[INPUT] 1    0    [1    /1   ]  7.21365024936        1
[INPUT] 1    0    [1    /1   ]  20.3041233864        1
[INPUT] 1    0    [1    /1   ]  0.764795016426       1
[INPUT] 1    0    [1    /1   ]  2.70790294969        1
[INPUT] 1    0    [1    /1   ]  0.220755656904       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.78966470335, 1.0]], [0, [7617.204687011013, 1.0]], [0, [3617.465753935315, 1.0]], [0, [1590.696266749746, 1.0]], [0, [406.45295990455855, 1.0]], [0, [154.05482353659878, 1.0]], [0, [74.8851704597565, 1.0]], [0, [31.45266251488042, 1.0]], [0, [8.128730658562594, 1.0]], [0, [0.6365576147429675, 1.0]], [0, [3.1197903390108364, 1.0]], [0, [0.23464538693544426, 1.0]], [1, [1362.8274424264864, 1.0]], [1, [664.3180614043974, 1.0]], [1, [298.9481926459502, 1.0]], [1, [312.30684162905425, 1.0]], [1, [62.600744414522076, 1.0]], [1, [7.213650249358971, 1.0]], [1, [20.304123386424266, 1.0]], [1, [0.7647950164260432, 1.0]], [1, [2.707902949686677, 1.0]], [1, [0.22075565690375612, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.7896647]
bas 1, expnt(s) = [7617.20468701]
bas 2, expnt(s) = [3617.46575394]
bas 3, expnt(s) = [1590.69626675]
bas 4, expnt(s) = [406.4529599]
bas 5, expnt(s) = [154.05482354]
bas 6, expnt(s) = [74.88517046]
bas 7, expnt(s) = [31.45266251]
bas 8, expnt(s) = [8.12873066]
bas 9, expnt(s) = [0.63655761]
bas 10, expnt(s) = [3.11979034]
bas 11, expnt(s) = [0.23464539]
bas 12, expnt(s) = [1362.82744243]
bas 13, expnt(s) = [664.3180614]
bas 14, expnt(s) = [298.94819265]
bas 15, expnt(s) = [312.30684163]
bas 16, expnt(s) = [62.60074441]
bas 17, expnt(s) = [7.21365025]
bas 18, expnt(s) = [20.30412339]
bas 19, expnt(s) = [0.76479502]
bas 20, expnt(s) = [2.70790295]
bas 21, expnt(s) = [0.22075566]
CPU time:       521.03
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827897e+04 5.20028280e+03 7.61720469e+03 2.05997402e+03
 3.61746575e+03 1.17846950e+03 1.59069627e+03 6.36363806e+02
 4.06452960e+02 2.28703464e+02 1.54054824e+02 1.10476905e+02
 7.48851705e+01 6.43149433e+01 3.14526625e+01 3.35550651e+01
 8.12873066e+00 1.21627582e+01 6.36557615e-01 1.80050077e+00
 3.11979034e+00 5.93074267e+00 2.34645387e-01 8.51773334e-01
 1.36282744e+03 2.41565818e+04 6.64318061e+02 9.83907946e+03
 2.98948193e+02 3.62643007e+03 3.12306842e+02 3.83011016e+03
 6.26007444e+01 5.13699052e+02 7.21365025e+00 3.44888128e+01
 2.03041234e+01 1.25737464e+02 7.64795016e-01 2.08648710e+00
 2.70790295e+00 1.01338801e+01 2.20755657e-01 4.41442552e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994060028546645
cond(S) = 111513.53806984563
E1 = -729.5413408251485  E_coul = 203.17401988737637
init E= -526.367320937772
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555925560350318  LUMO = 0.94877142660024
  mo_energy =
[-1.18335426e+02 -1.22064667e+01 -9.44713035e+00 -9.44713035e+00
 -9.44713035e+00 -1.24019691e+00 -5.55925560e-01 -5.55925560e-01
 -5.55925560e-01  9.48771427e-01  1.01546234e+00  1.01546234e+00
  1.01546234e+00  7.09399339e+00  7.09399339e+00  7.09399339e+00
  1.18846744e+01  3.28695336e+01  3.28695336e+01  3.28695336e+01
  8.14341044e+01  1.29413799e+02  1.29413799e+02  1.29413799e+02
  3.18632885e+02  4.84477666e+02  4.84477666e+02  4.84477666e+02
  9.72055711e+02  1.33296854e+03  1.33296854e+03  1.33296854e+03
  3.02204455e+03  3.02204455e+03  3.02204455e+03  3.13437941e+03
  6.63896074e+03  6.63896074e+03  6.63896074e+03  9.53887003e+03
  2.58733944e+04  7.65847650e+04]
E1 = -727.8418177474094  E_coul = 201.0880795121746
cycle= 1 E= -526.753738235235  delta_E= -0.386  |g|= 0.188  |ddm|= 0.302
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.5878
diis-c [-0.34550938  1.        ]
  HOMO = -0.590762584942152  LUMO = 0.922036256487684
  mo_energy =
[-1.18645094e+02 -1.23452787e+01 -9.59704541e+00 -9.59704541e+00
 -9.59704541e+00 -1.27953661e+00 -5.90762585e-01 -5.90762585e-01
 -5.90762585e-01  9.22036256e-01  9.91607651e-01  9.91607651e-01
  9.91607651e-01  7.00447763e+00  7.00447763e+00  7.00447763e+00
  1.17778292e+01  3.27142908e+01  3.27142908e+01  3.27142908e+01
  8.12397106e+01  1.29182462e+02  1.29182462e+02  1.29182462e+02
  3.18362395e+02  4.84169746e+02  4.84169746e+02  4.84169746e+02
  9.71694650e+02  1.33260408e+03  1.33260408e+03  1.33260408e+03
  3.02161480e+03  3.02161480e+03  3.02161480e+03  3.13388456e+03
  6.63841813e+03  6.63841813e+03  6.63841813e+03  9.53825621e+03
  2.58726845e+04  7.65839639e+04]
E1 = -728.420257654694  E_coul = 201.66578914609053
cycle= 2 E= -526.754468508603  delta_E= -0.00073  |g|= 0.038  |ddm|= 0.054
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076884
diis-c [-0.00394562  0.07050978  0.92949022]
  HOMO = -0.581438182245508  LUMO = 0.929931829212242
  mo_energy =
[-1.18575996e+02 -1.23064402e+01 -9.55653828e+00 -9.55653828e+00
 -9.55653828e+00 -1.26838457e+00 -5.81438182e-01 -5.81438182e-01
 -5.81438182e-01  9.29931829e-01  9.98345516e-01  9.98345516e-01
  9.98345516e-01  7.02826994e+00  7.02826994e+00  7.02826994e+00
  1.18076051e+01  3.27551334e+01  3.27551334e+01  3.27551334e+01
  8.12911545e+01  1.29239675e+02  1.29239675e+02  1.29239675e+02
  3.18426629e+02  4.84238016e+02  4.84238016e+02  4.84238016e+02
  9.71766087e+02  1.33267645e+03  1.33267645e+03  1.33267645e+03
  3.02168947e+03  3.02168947e+03  3.02168947e+03  3.13396017e+03
  6.63849458e+03  6.63849458e+03  6.63849458e+03  9.53833342e+03
  2.58727623e+04  7.65840421e+04]
E1 = -728.2668718064544  E_coul = 201.51234395491454
cycle= 3 E= -526.75452785154  delta_E= -5.93e-05  |g|= 0.00691  |ddm|= 0.0165
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0145746
diis-c [-7.60296653e-07 -1.24815856e-03  1.55241528e-01  8.46006631e-01]
  HOMO = -0.583067521941303  LUMO = 0.928643870144022
  mo_energy =
[-1.18586924e+02 -1.23127862e+01 -9.56325854e+00 -9.56325854e+00
 -9.56325854e+00 -1.27023055e+00 -5.83067522e-01 -5.83067522e-01
 -5.83067522e-01  9.28643870e-01  9.97191427e-01  9.97191427e-01
  9.97191427e-01  7.02423058e+00  7.02423058e+00  7.02423058e+00
  1.18027057e+01  3.27483970e+01  3.27483970e+01  3.27483970e+01
  8.12828824e+01  1.29230502e+02  1.29230502e+02  1.29230502e+02
  3.18416434e+02  4.84227216e+02  4.84227216e+02  4.84227216e+02
  9.71754764e+02  1.33266500e+03  1.33266500e+03  1.33266500e+03
  3.02167760e+03  3.02167760e+03  3.02167760e+03  3.13394807e+03
  6.63848230e+03  6.63848230e+03  6.63848230e+03  9.53832092e+03
  2.58727496e+04  7.65840293e+04]
E1 = -728.2917886028162  E_coul = 201.53725846320103
cycle= 4 E= -526.754530139615  delta_E= -2.29e-06  |g|= 9.95e-05  |ddm|= 0.00246
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000113703
diis-c [-4.44740727e-09  7.76365520e-05 -1.13718491e-02 -6.66406735e-02
  1.07793489e+00]
  HOMO = -0.583049102426956  LUMO = 0.928676467025734
  mo_energy =
[-1.18586880e+02 -1.23127196e+01 -9.56320593e+00 -9.56320593e+00
 -9.56320593e+00 -1.27018937e+00 -5.83049102e-01 -5.83049102e-01
 -5.83049102e-01  9.28676467e-01  9.97207063e-01  9.97207063e-01
  9.97207063e-01  7.02427244e+00  7.02427244e+00  7.02427244e+00
  1.18027663e+01  3.27484476e+01  3.27484476e+01  3.27484476e+01
  8.12829393e+01  1.29230553e+02  1.29230553e+02  1.29230553e+02
  3.18416482e+02  4.84227261e+02  4.84227261e+02  4.84227261e+02
  9.71754799e+02  1.33266504e+03  1.33266504e+03  1.33266504e+03
  3.02167763e+03  3.02167763e+03  3.02167763e+03  3.13394808e+03
  6.63848231e+03  6.63848231e+03  6.63848231e+03  9.53832092e+03
  2.58727496e+04  7.65840292e+04]
E1 = -728.2915667832939  E_coul = 201.5370366419539
cycle= 5 E= -526.75453014134  delta_E= -1.72e-09  |g|= 2.05e-05  |ddm|= 0.000161
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.8602e-05
diis-c [-8.15329615e-11  1.26247376e-05 -1.84696786e-03 -1.26132496e-02
  3.92907771e-02  9.75156816e-01]
  HOMO = -0.583056572705004  LUMO = 0.92867274148639
  mo_energy =
[-1.18586910e+02 -1.23127421e+01 -9.56323031e+00 -9.56323031e+00
 -9.56323031e+00 -1.27019532e+00 -5.83056573e-01 -5.83056573e-01
 -5.83056573e-01  9.28672741e-01  9.97202208e-01  9.97202208e-01
  9.97202208e-01  7.02425615e+00  7.02425615e+00  7.02425615e+00
  1.18027485e+01  3.27484239e+01  3.27484239e+01  3.27484239e+01
  8.12829131e+01  1.29230525e+02  1.29230525e+02  1.29230525e+02
  3.18416452e+02  4.84227230e+02  4.84227230e+02  4.84227230e+02
  9.71754768e+02  1.33266501e+03  1.33266501e+03  1.33266501e+03
  3.02167760e+03  3.02167760e+03  3.02167760e+03  3.13394805e+03
  6.63848228e+03  6.63848228e+03  6.63848228e+03  9.53832089e+03
  2.58727496e+04  7.65840292e+04]
E1 = -728.29164736437  E_coul = 201.5371172229715
cycle= 6 E= -526.754530141399  delta_E= -5.85e-11  |g|= 1.84e-06  |ddm|= 1.89e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.29164736437  E_coul = 201.5371172229715
  HOMO = -0.583056550070373  LUMO = 0.928673118310393
  mo_energy =
[-1.18586910e+02 -1.23127418e+01 -9.56323007e+00 -9.56323007e+00
 -9.56323007e+00 -1.27019488e+00 -5.83056550e-01 -5.83056550e-01
 -5.83056550e-01  9.28673118e-01  9.97202283e-01  9.97202283e-01
  9.97202283e-01  7.02425631e+00  7.02425631e+00  7.02425631e+00
  1.18027489e+01  3.27484242e+01  3.27484242e+01  3.27484242e+01
  8.12829135e+01  1.29230525e+02  1.29230525e+02  1.29230525e+02
  3.18416453e+02  4.84227231e+02  4.84227231e+02  4.84227231e+02
  9.71754768e+02  1.33266501e+03  1.33266501e+03  1.33266501e+03
  3.02167760e+03  3.02167760e+03  3.02167760e+03  3.13394805e+03
  6.63848228e+03  6.63848228e+03  6.63848228e+03  9.53832089e+03
  2.58727496e+04  7.65840292e+04]
E1 = -728.2916456420577  E_coul = 201.53711550065952
Extra cycle  E= -526.754530141398  delta_E= 3.41e-13  |g|= 3.82e-07  |ddm|= 3.32e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111513.53806984563
E1 = -728.2916456420577  E_coul = 201.53711550065952
init E= -526.754530141398
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583056598146805  LUMO = 0.928673153262174
  mo_energy =
[-1.18586910e+02 -1.23127419e+01 -9.56323022e+00 -9.56323022e+00
 -9.56323022e+00 -1.27019485e+00 -5.83056598e-01 -5.83056598e-01
 -5.83056598e-01  9.28673153e-01  9.97202261e-01  9.97202261e-01
  9.97202261e-01  7.02425622e+00  7.02425622e+00  7.02425622e+00
  1.18027488e+01  3.27484240e+01  3.27484240e+01  3.27484240e+01
  8.12829133e+01  1.29230525e+02  1.29230525e+02  1.29230525e+02
  3.18416453e+02  4.84227230e+02  4.84227230e+02  4.84227230e+02
  9.71754768e+02  1.33266501e+03  1.33266501e+03  1.33266501e+03
  3.02167760e+03  3.02167760e+03  3.02167760e+03  3.13394805e+03
  6.63848228e+03  6.63848228e+03  6.63848228e+03  9.53832089e+03
  2.58727496e+04  7.65840292e+04]
E1 = -728.2916459856943  E_coul = 201.53711584429465
cycle= 1 E= -526.7545301414  delta_E= -1.59e-12  |g|= 8.28e-08  |ddm|= 6.41e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2916459856943  E_coul = 201.53711584429465
  HOMO = -0.583056594599488  LUMO = 0.928673171430092
  mo_energy =
[-1.18586910e+02 -1.23127419e+01 -9.56323020e+00 -9.56323020e+00
 -9.56323020e+00 -1.27019483e+00 -5.83056595e-01 -5.83056595e-01
 -5.83056595e-01  9.28673171e-01  9.97202267e-01  9.97202267e-01
  9.97202267e-01  7.02425624e+00  7.02425624e+00  7.02425624e+00
  1.18027488e+01  3.27484241e+01  3.27484241e+01  3.27484241e+01
  8.12829134e+01  1.29230525e+02  1.29230525e+02  1.29230525e+02
  3.18416453e+02  4.84227230e+02  4.84227230e+02  4.84227230e+02
  9.71754768e+02  1.33266501e+03  1.33266501e+03  1.33266501e+03
  3.02167760e+03  3.02167760e+03  3.02167760e+03  3.13394805e+03
  6.63848228e+03  6.63848228e+03  6.63848228e+03  9.53832089e+03
  2.58727496e+04  7.65840292e+04]
E1 = -728.2916458602822  E_coul = 201.537115718883
Extra cycle  E= -526.754530141399  delta_E= 5.68e-13  |g|= 1.71e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.43 sec
exp = [2.61827897e+04 7.61720469e+03 3.61746575e+03 1.59069627e+03
 4.06452960e+02 1.54054824e+02 7.48851705e+01 3.14526625e+01
 8.12873066e+00 6.36557615e-01 3.11979034e+00 2.34645387e-01
 1.36282744e+03 6.64318061e+02 2.98948193e+02 3.12306842e+02
 6.26007444e+01 7.21365025e+00 2.03041234e+01 7.64795016e-01
 2.70790295e+00 2.20755657e-01]
grad_E = [-1.53716088e-06  3.52161952e-06 -1.65891693e-06  8.19430099e-05
 -4.93398294e-04  3.15842451e-04 -2.99089390e-04  9.88429699e-04
  3.41631573e-03 -8.53658257e-03 -9.04135484e-03  1.68682928e-02
 -5.85503668e-07  4.03004886e-06  1.82498741e-05  1.56257881e-05
  1.61683293e-04  7.78804984e-04  1.11566160e-04 -5.72752708e-03
 -5.99941488e-03  1.58968171e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:20 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.80452          1
[INPUT] 0    0    [1    /1   ]  7617.16856202        1
[INPUT] 0    0    [1    /1   ]  3617.47767295        1
[INPUT] 0    0    [1    /1   ]  1589.86757275        1
[INPUT] 0    0    [1    /1   ]  409.970794154        1
[INPUT] 0    0    [1    /1   ]  157.253271002        1
[INPUT] 0    0    [1    /1   ]  77.1681161436        1
[INPUT] 0    0    [1    /1   ]  30.2554677021        1
[INPUT] 0    0    [1    /1   ]  8.22453781046        1
[INPUT] 0    0    [1    /1   ]  0.632620510244       1
[INPUT] 0    0    [1    /1   ]  3.15147196758        1
[INPUT] 0    0    [1    /1   ]  0.235336758563       1
[INPUT] 1    0    [1    /1   ]  1362.83232822        1
[INPUT] 1    0    [1    /1   ]  664.270965356        1
[INPUT] 1    0    [1    /1   ]  298.72636939         1
[INPUT] 1    0    [1    /1   ]  312.115713338        1
[INPUT] 1    0    [1    /1   ]  62.7438058596        1
[INPUT] 1    0    [1    /1   ]  7.11701682582        1
[INPUT] 1    0    [1    /1   ]  20.1918137329        1
[INPUT] 1    0    [1    /1   ]  0.758820446346       1
[INPUT] 1    0    [1    /1   ]  2.65121122439        1
[INPUT] 1    0    [1    /1   ]  0.219725136174       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.8045199746, 1.0]], [0, [7617.168562019517, 1.0]], [0, [3617.4776729510295, 1.0]], [0, [1589.86757274533, 1.0]], [0, [409.9707941537212, 1.0]], [0, [157.2532710024185, 1.0]], [0, [77.16811614355913, 1.0]], [0, [30.255467702053533, 1.0]], [0, [8.224537810455608, 1.0]], [0, [0.6326205102435745, 1.0]], [0, [3.151471967584546, 1.0]], [0, [0.23533675856298072, 1.0]], [1, [1362.8323282152055, 1.0]], [1, [664.2709653560053, 1.0]], [1, [298.72636938952036, 1.0]], [1, [312.1157133379867, 1.0]], [1, [62.743805859616835, 1.0]], [1, [7.117016825819253, 1.0]], [1, [20.19181373293935, 1.0]], [1, [0.7588204463455354, 1.0]], [1, [2.6512112243934904, 1.0]], [1, [0.21972513617360326, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.80451997]
bas 1, expnt(s) = [7617.16856202]
bas 2, expnt(s) = [3617.47767295]
bas 3, expnt(s) = [1589.86757275]
bas 4, expnt(s) = [409.97079415]
bas 5, expnt(s) = [157.253271]
bas 6, expnt(s) = [77.16811614]
bas 7, expnt(s) = [30.2554677]
bas 8, expnt(s) = [8.22453781]
bas 9, expnt(s) = [0.63262051]
bas 10, expnt(s) = [3.15147197]
bas 11, expnt(s) = [0.23533676]
bas 12, expnt(s) = [1362.83232822]
bas 13, expnt(s) = [664.27096536]
bas 14, expnt(s) = [298.72636939]
bas 15, expnt(s) = [312.11571334]
bas 16, expnt(s) = [62.74380586]
bas 17, expnt(s) = [7.11701683]
bas 18, expnt(s) = [20.19181373]
bas 19, expnt(s) = [0.75882045]
bas 20, expnt(s) = [2.65121122]
bas 21, expnt(s) = [0.21972514]
CPU time:       526.51
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828045e+04 5.20028501e+03 7.61716856e+03 2.05996670e+03
 3.61747767e+03 1.17847241e+03 1.58986757e+03 6.36115148e+02
 4.09970794e+02 2.30186428e+02 1.57253271e+02 1.12192749e+02
 7.71681161e+01 6.57799362e+01 3.02554677e+01 3.25925190e+01
 8.22453781e+00 1.22701155e+01 6.32620510e-01 1.79214224e+00
 3.15147197e+00 5.97585582e+00 2.35336759e-01 8.53654924e-01
 1.36283233e+03 2.41566900e+04 6.64270965e+02 9.83820755e+03
 2.98726369e+02 3.62306682e+03 3.12115713e+02 3.82718041e+03
 6.27438059e+01 5.15166917e+02 7.11701683e+00 3.39122717e+01
 2.01918137e+01 1.24868690e+02 7.58820446e-01 2.06613252e+00
 2.65121122e+00 9.86937850e+00 2.19725136e-01 4.38868157e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994217785972733
cond(S) = 110629.98318931574
E1 = -729.5420600627635  E_coul = 203.17173364969614
init E= -526.370326413067
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.556001087522998  LUMO = 0.948043763992347
  mo_energy =
[-1.18336068e+02 -1.22064453e+01 -9.44722246e+00 -9.44722246e+00
 -9.44722246e+00 -1.24025155e+00 -5.56001088e-01 -5.56001088e-01
 -5.56001088e-01  9.48043764e-01  1.00616251e+00  1.00616251e+00
  1.00616251e+00  6.94639323e+00  6.94639323e+00  6.94639323e+00
  1.19930219e+01  3.23385388e+01  3.23385388e+01  3.23385388e+01
  8.10239212e+01  1.28692763e+02  1.28692763e+02  1.28692763e+02
  3.21417627e+02  4.83899873e+02  4.83899873e+02  4.83899873e+02
  9.85403970e+02  1.33210158e+03  1.33210158e+03  1.33210158e+03
  3.02065027e+03  3.02065027e+03  3.02065027e+03  3.15862510e+03
  6.63721709e+03  6.63721709e+03  6.63721709e+03  9.56559750e+03
  2.58993267e+04  7.66089768e+04]
E1 = -727.8431623904255  E_coul = 201.08937584852274
cycle= 1 E= -526.753786541903  delta_E= -0.383  |g|= 0.187  |ddm|= 0.295
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.586445
diis-c [-0.34391806  1.        ]
  HOMO = -0.590762603701773  LUMO = 0.921298136903354
  mo_energy =
[-1.18645943e+02 -1.23448497e+01 -9.59669183e+00 -9.59669183e+00
 -9.59669183e+00 -1.27955273e+00 -5.90762604e-01 -5.90762604e-01
 -5.90762604e-01  9.21298137e-01  9.82621743e-01  9.82621743e-01
  9.82621743e-01  6.85823244e+00  6.85823244e+00  6.85823244e+00
  1.18862161e+01  3.21839402e+01  3.21839402e+01  3.21839402e+01
  8.08300493e+01  1.28461651e+02  1.28461651e+02  1.28461651e+02
  3.21145624e+02  4.83591197e+02  4.83591197e+02  4.83591197e+02
  9.85040848e+02  1.33173662e+03  1.33173662e+03  1.33173662e+03
  3.02021950e+03  3.02021950e+03  3.02021950e+03  3.15812889e+03
  6.63667321e+03  6.63667321e+03  6.63667321e+03  9.56498237e+03
  2.58986154e+04  7.66081744e+04]
E1 = -728.4218625482885  E_coul = 201.6673459536228
cycle= 2 E= -526.754516594666  delta_E= -0.00073  |g|= 0.038  |ddm|= 0.054
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0768356
diis-c [-0.00391022  0.07112461  0.92887539]
  HOMO = -0.581447159376614  LUMO = 0.929181045259843
  mo_energy =
[-1.18576804e+02 -1.23060292e+01 -9.55619689e+00 -9.55619689e+00
 -9.55619689e+00 -1.26841750e+00 -5.81447159e-01 -5.81447159e-01
 -5.81447159e-01  9.29181045e-01  9.89276248e-01  9.89276248e-01
  9.89276248e-01  6.88172447e+00  6.88172447e+00  6.88172447e+00
  1.19160646e+01  3.22246443e+01  3.22246443e+01  3.22246443e+01
  8.08814325e+01  1.28518910e+02  1.28518910e+02  1.28518910e+02
  3.21210057e+02  4.83659515e+02  4.83659515e+02  4.83659515e+02
  9.85112415e+02  1.33180904e+03  1.33180904e+03  1.33180904e+03
  3.02029422e+03  3.02029422e+03  3.02029422e+03  3.15820456e+03
  6.63674972e+03  6.63674972e+03  6.63674972e+03  9.56505963e+03
  2.58986933e+04  7.66082526e+04]
E1 = -728.268408387513  E_coul = 201.51383238009322
cycle= 3 E= -526.75457600742  delta_E= -5.94e-05  |g|= 0.00689  |ddm|= 0.0165
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0144871
diis-c [-7.60357473e-07 -1.24878391e-03  1.54478945e-01  8.46769839e-01]
  HOMO = -0.583073943095531  LUMO = 0.927893187630058
  mo_energy =
[-1.18587701e+02 -1.23123622e+01 -9.56290129e+00 -9.56290129e+00
 -9.56290129e+00 -1.27026296e+00 -5.83073943e-01 -5.83073943e-01
 -5.83073943e-01  9.27893188e-01  9.88136927e-01  9.88136927e-01
  9.88136927e-01  6.87773961e+00  6.87773961e+00  6.87773961e+00
  1.19111592e+01  3.22179430e+01  3.22179430e+01  3.22179430e+01
  8.08731925e+01  1.28509758e+02  1.28509758e+02  1.28509758e+02
  3.21199865e+02  4.83648743e+02  4.83648743e+02  4.83648743e+02
  9.85101110e+02  1.33179762e+03  1.33179762e+03  1.33179762e+03
  3.02028238e+03  3.02028238e+03  3.02028238e+03  3.15819248e+03
  6.63673746e+03  6.63673746e+03  6.63673746e+03  9.56504717e+03
  2.58986806e+04  7.66082398e+04]
E1 = -728.2932924647541  E_coul = 201.53871418213365
cycle= 4 E= -526.754578282621  delta_E= -2.28e-06  |g|= 9.7e-05  |ddm|= 0.00246
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000107979
diis-c [-4.52762902e-09  7.33731041e-05 -1.07536592e-02 -6.30613361e-02
  1.07374162e+00]
  HOMO = -0.583053927970198  LUMO = 0.927926382687041
  mo_energy =
[-1.18587650e+02 -1.23122914e+01 -9.56284373e+00 -9.56284373e+00
 -9.56284373e+00 -1.27022075e+00 -5.83053928e-01 -5.83053928e-01
 -5.83053928e-01  9.27926383e-01  9.88153420e-01  9.88153420e-01
  9.88153420e-01  6.87778454e+00  6.87778454e+00  6.87778454e+00
  1.19112233e+01  3.22179983e+01  3.22179983e+01  3.22179983e+01
  8.08732546e+01  1.28509815e+02  1.28509815e+02  1.28509815e+02
  3.21199919e+02  4.83648794e+02  4.83648794e+02  4.83648794e+02
  9.85101151e+02  1.33179767e+03  1.33179767e+03  1.33179767e+03
  3.02028242e+03  3.02028242e+03  3.02028242e+03  3.15819251e+03
  6.63673748e+03  6.63673748e+03  6.63673748e+03  9.56504718e+03
  2.58986806e+04  7.66082398e+04]
E1 = -728.2930554758183  E_coul = 201.53847719158128
cycle= 5 E= -526.754578284237  delta_E= -1.62e-09  |g|= 2.05e-05  |ddm|= 0.000157
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.88623e-05
diis-c [-7.96421836e-11  1.27172066e-05 -1.84719328e-03 -1.26924426e-02
  4.25008646e-02  9.72026054e-01]
  HOMO = -0.58306142744924  LUMO = 0.927922583964441
  mo_energy =
[-1.18587681e+02 -1.23123140e+01 -9.56286824e+00 -9.56286824e+00
 -9.56286824e+00 -1.27022679e+00 -5.83061427e-01 -5.83061427e-01
 -5.83061427e-01  9.27922584e-01  9.88148595e-01  9.88148595e-01
  9.88148595e-01  6.87776833e+00  6.87776833e+00  6.87776833e+00
  1.19112053e+01  3.22179745e+01  3.22179745e+01  3.22179745e+01
  8.08732283e+01  1.28509787e+02  1.28509787e+02  1.28509787e+02
  3.21199889e+02  4.83648763e+02  4.83648763e+02  4.83648763e+02
  9.85101119e+02  1.33179763e+03  1.33179763e+03  1.33179763e+03
  3.02028238e+03  3.02028238e+03  3.02028238e+03  3.15819247e+03
  6.63673745e+03  6.63673745e+03  6.63673745e+03  9.56504714e+03
  2.58986806e+04  7.66082397e+04]
E1 = -728.2931368064534  E_coul = 201.53855852215924
cycle= 6 E= -526.754578284294  delta_E= -5.72e-11  |g|= 1.85e-06  |ddm|= 1.85e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2931368064534  E_coul = 201.53855852215924
  HOMO = -0.583061441400121  LUMO = 0.927922934785676
  mo_energy =
[-1.18587681e+02 -1.23123138e+01 -9.56286814e+00 -9.56286814e+00
 -9.56286814e+00 -1.27022639e+00 -5.83061441e-01 -5.83061441e-01
 -5.83061441e-01  9.27922935e-01  9.88148645e-01  9.88148645e-01
  9.88148645e-01  6.87776841e+00  6.87776841e+00  6.87776841e+00
  1.19112056e+01  3.22179747e+01  3.22179747e+01  3.22179747e+01
  8.08732285e+01  1.28509787e+02  1.28509787e+02  1.28509787e+02
  3.21199889e+02  4.83648763e+02  4.83648763e+02  4.83648763e+02
  9.85101120e+02  1.33179763e+03  1.33179763e+03  1.33179763e+03
  3.02028238e+03  3.02028238e+03  3.02028238e+03  3.15819247e+03
  6.63673745e+03  6.63673745e+03  6.63673745e+03  9.56504714e+03
  2.58986806e+04  7.66082397e+04]
E1 = -728.2931355529413  E_coul = 201.5385572686472
Extra cycle  E= -526.754578284294  delta_E= 1.14e-13  |g|= 3.83e-07  |ddm|= 3.34e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
exp = [2.61828045e+04 7.61716856e+03 3.61747767e+03 1.58986757e+03
 4.09970794e+02 1.57253271e+02 7.71681161e+01 3.02554677e+01
 8.22453781e+00 6.32620510e-01 3.15147197e+00 2.35336759e-01
 1.36283233e+03 6.64270965e+02 2.98726369e+02 3.12115713e+02
 6.27438059e+01 7.11701683e+00 2.01918137e+01 7.58820446e-01
 2.65121122e+00 2.19725136e-01]
E = -526.7545782842941
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:21 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.797252         1
[INPUT] 0    0    [1    /1   ]  7617.1862362         1
[INPUT] 0    0    [1    /1   ]  3617.47184156        1
[INPUT] 0    0    [1    /1   ]  1590.27301192        1
[INPUT] 0    0    [1    /1   ]  408.249691043        1
[INPUT] 0    0    [1    /1   ]  155.688428121        1
[INPUT] 0    0    [1    /1   ]  76.0511832126        1
[INPUT] 0    0    [1    /1   ]  30.8411961846        1
[INPUT] 0    0    [1    /1   ]  8.17766408773        1
[INPUT] 0    0    [1    /1   ]  0.634546741647       1
[INPUT] 0    0    [1    /1   ]  3.13597170645        1
[INPUT] 0    0    [1    /1   ]  0.234998504463       1
[INPUT] 1    0    [1    /1   ]  1362.82993784        1
[INPUT] 1    0    [1    /1   ]  664.294007134        1
[INPUT] 1    0    [1    /1   ]  298.834896588        1
[INPUT] 1    0    [1    /1   ]  312.209223001        1
[INPUT] 1    0    [1    /1   ]  62.6738129376        1
[INPUT] 1    0    [1    /1   ]  7.16429480258        1
[INPUT] 1    0    [1    /1   ]  20.2467613173        1
[INPUT] 1    0    [1    /1   ]  0.761743509351       1
[INPUT] 1    0    [1    /1   ]  2.67894769458        1
[INPUT] 1    0    [1    /1   ]  0.220229319233       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.79725202172, 1.0]], [0, [7617.18623619938, 1.0]], [0, [3617.471841563428, 1.0]], [0, [1590.2730119240978, 1.0]], [0, [408.2496910427772, 1.0]], [0, [155.6884281207723, 1.0]], [0, [76.05118321261044, 1.0]], [0, [30.841196184642744, 1.0]], [0, [8.17766408773459, 1.0]], [0, [0.6345467416467823, 1.0]], [0, [3.1359717064477506, 1.0]], [0, [0.23499850446267606, 1.0]], [1, [1362.8299378393185, 1.0]], [1, [664.294007133889, 1.0]], [1, [298.8348965882683, 1.0]], [1, [312.2092230013326, 1.0]], [1, [62.673812937617356, 1.0]], [1, [7.164294802578667, 1.0]], [1, [20.246761317251472, 1.0]], [1, [0.7617435093507247, 1.0]], [1, [2.6789476945782673, 1.0]], [1, [0.22022931923310374, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.79725202]
bas 1, expnt(s) = [7617.1862362]
bas 2, expnt(s) = [3617.47184156]
bas 3, expnt(s) = [1590.27301192]
bas 4, expnt(s) = [408.24969104]
bas 5, expnt(s) = [155.68842812]
bas 6, expnt(s) = [76.05118321]
bas 7, expnt(s) = [30.84119618]
bas 8, expnt(s) = [8.17766409]
bas 9, expnt(s) = [0.63454674]
bas 10, expnt(s) = [3.13597171]
bas 11, expnt(s) = [0.2349985]
bas 12, expnt(s) = [1362.82993784]
bas 13, expnt(s) = [664.29400713]
bas 14, expnt(s) = [298.83489659]
bas 15, expnt(s) = [312.209223]
bas 16, expnt(s) = [62.67381294]
bas 17, expnt(s) = [7.1642948]
bas 18, expnt(s) = [20.24676132]
bas 19, expnt(s) = [0.76174351]
bas 20, expnt(s) = [2.67894769]
bas 21, expnt(s) = [0.22022932]
CPU time:       527.03
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827973e+04 5.20028393e+03 7.61718624e+03 2.05997028e+03
 3.61747184e+03 1.17847098e+03 1.59027301e+03 6.36236808e+02
 4.08249691e+02 2.29461286e+02 1.55688428e+02 1.11354372e+02
 7.60511832e+01 6.50645613e+01 3.08411962e+01 3.30646123e+01
 8.17766409e+00 1.22176302e+01 6.34546742e-01 1.79623328e+00
 3.13597171e+00 5.95379841e+00 2.34998504e-01 8.52734527e-01
 1.36282994e+03 2.41566371e+04 6.64294007e+02 9.83863413e+03
 2.98834897e+02 3.62471222e+03 3.12209223e+02 3.82861374e+03
 6.26738129e+01 5.14448658e+02 7.16429480e+00 3.41941020e+01
 2.02467613e+01 1.25293588e+02 7.61743509e-01 2.07608603e+00
 2.67894769e+00 9.99861130e+00 2.20229319e-01 4.40127305e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994143484383255
cond(S) = 111061.45978651967
E1 = -729.5434837098907  E_coul = 203.172903279005
init E= -526.370580430886
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555962219219566  LUMO = 0.948401719332683
  mo_energy =
[-1.18335998e+02 -1.22064917e+01 -9.44717587e+00 -9.44717587e+00
 -9.44717587e+00 -1.24022667e+00 -5.55962219e-01 -5.55962219e-01
 -5.55962219e-01  9.48401719e-01  1.01070626e+00  1.01070626e+00
  1.01070626e+00  7.01848535e+00  7.01848535e+00  7.01848535e+00
  1.19410420e+01  3.25983825e+01  3.25983825e+01  3.25983825e+01
  8.12402990e+01  1.29045545e+02  1.29045545e+02  1.29045545e+02
  3.20071972e+02  4.84182343e+02  4.84182343e+02  4.84182343e+02
  9.78883073e+02  1.33252549e+03  1.33252549e+03  1.33252549e+03
  3.02133217e+03  3.02133217e+03  3.02133217e+03  3.14676965e+03
  6.63806989e+03  6.63806989e+03  6.63806989e+03  9.55251942e+03
  2.58866343e+04  7.65971252e+04]
E1 = -727.8429881072936  E_coul = 201.08863341828493
cycle= 1 E= -526.754354689009  delta_E= -0.384  |g|= 0.188  |ddm|= 0.298
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587134
diis-c [-0.34472639  1.        ]
  HOMO = -0.590761197502327  LUMO = 0.921660512202293
  mo_energy =
[-1.18645796e+02 -1.23451072e+01 -9.59687666e+00 -9.59687666e+00
 -9.59687666e+00 -1.27954749e+00 -5.90761198e-01 -5.90761198e-01
 -5.90761198e-01  9.21660512e-01  9.87011299e-01  9.87011299e-01
  9.87011299e-01  6.92965419e+00  6.92965419e+00  6.92965419e+00
  1.18341999e+01  3.24434563e+01  3.24434563e+01  3.24434563e+01
  8.10461447e+01  1.28814299e+02  1.28814299e+02  1.28814299e+02
  3.19800690e+02  4.83874017e+02  4.83874017e+02  4.83874017e+02
  9.78520925e+02  1.33216074e+03  1.33216074e+03  1.33216074e+03
  3.02090185e+03  3.02090185e+03  3.02090185e+03  3.14627405e+03
  6.63752658e+03  6.63752658e+03  6.63752658e+03  9.55190486e+03
  2.58859236e+04  7.65963234e+04]
E1 = -728.421602233374  E_coul = 201.66651731338771
cycle= 2 E= -526.755084919986  delta_E= -0.00073  |g|= 0.038  |ddm|= 0.054
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0768661
diis-c [-0.00392808  0.07082952  0.92917048]
  HOMO = -0.581440574560651  LUMO = 0.929550284343285
  mo_energy =
[-1.18576673e+02 -1.23062754e+01 -9.55637320e+00 -9.55637320e+00
 -9.55637320e+00 -1.26840315e+00 -5.81440575e-01 -5.81440575e-01
 -5.81440575e-01  9.29550284e-01  9.93707119e-01  9.93707119e-01
  9.93707119e-01  6.95329545e+00  6.95329545e+00  6.95329545e+00
  1.18640168e+01  3.24842311e+01  3.24842311e+01  3.24842311e+01
  8.10975633e+01  1.28871539e+02  1.28871539e+02  1.28871539e+02
  3.19865029e+02  4.83942315e+02  4.83942315e+02  4.83942315e+02
  9.78592433e+02  1.33223314e+03  1.33223314e+03  1.33223314e+03
  3.02097655e+03  3.02097655e+03  3.02097655e+03  3.14634969e+03
  6.63760306e+03  6.63760306e+03  6.63760306e+03  9.55198210e+03
  2.58860015e+04  7.65964016e+04]
E1 = -728.2681735024464  E_coul = 201.5130291965819
cycle= 3 E= -526.755144305865  delta_E= -5.94e-05  |g|= 0.0069  |ddm|= 0.0165
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0145307
diis-c [-7.60288694e-07 -1.24863437e-03  1.54846909e-01  8.46401725e-01]
  HOMO = -0.583068604566576  LUMO = 0.928262367895437
  mo_energy =
[-1.18587585e+02 -1.23126148e+01 -9.56308546e+00 -9.56308546e+00
 -9.56308546e+00 -1.27024887e+00 -5.83068605e-01 -5.83068605e-01
 -5.83068605e-01  9.28262368e-01  9.92560581e-01  9.92560581e-01
  9.92560581e-01  6.94928382e+00  6.94928382e+00  6.94928382e+00
  1.18591140e+01  3.24775125e+01  3.24775125e+01  3.24775125e+01
  8.10893071e+01  1.28862377e+02  1.28862377e+02  1.28862377e+02
  3.19854836e+02  4.83931529e+02  4.83931529e+02  4.83931529e+02
  9.78581119e+02  1.33222171e+03  1.33222171e+03  1.33222171e+03
  3.02096470e+03  3.02096470e+03  3.02096470e+03  3.14633760e+03
  6.63759079e+03  6.63759079e+03  6.63759079e+03  9.55196962e+03
  2.58859888e+04  7.65963888e+04]
E1 = -728.2930736732819  E_coul = 201.53792708589233
cycle= 4 E= -526.75514658739  delta_E= -2.28e-06  |g|= 9.82e-05  |ddm|= 0.00246
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000110754
diis-c [-4.48609659e-09  7.54798887e-05 -1.10562725e-02 -6.48228043e-02
  1.07580360e+00]
  HOMO = -0.583049378203278  LUMO = 0.928295260130622
  mo_energy =
[-1.18587538e+02 -1.23125461e+01 -9.56303035e+00 -9.56303035e+00
 -9.56303035e+00 -1.27020718e+00 -5.83049378e-01 -5.83049378e-01
 -5.83049378e-01  9.28295260e-01  9.92576652e-01  9.92576652e-01
  9.92576652e-01  6.94932723e+00  6.94932723e+00  6.94932723e+00
  1.18591764e+01  3.24775654e+01  3.24775654e+01  3.24775654e+01
  8.10893666e+01  1.28862430e+02  1.28862430e+02  1.28862430e+02
  3.19854886e+02  4.83931577e+02  4.83931577e+02  4.83931577e+02
  9.78581157e+02  1.33222175e+03  1.33222175e+03  1.33222175e+03
  3.02096473e+03  3.02096473e+03  3.02096473e+03  3.14633762e+03
  6.63759081e+03  6.63759081e+03  6.63759081e+03  9.55196963e+03
  2.58859888e+04  7.65963888e+04]
E1 = -728.2928442373576  E_coul = 201.53769764830093
cycle= 5 E= -526.755146589057  delta_E= -1.67e-09  |g|= 2.05e-05  |ddm|= 0.000159
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.8733e-05
diis-c [-8.05791855e-11  1.26776048e-05 -1.84755601e-03 -1.26569259e-02
  4.09645024e-02  9.73527302e-01]
  HOMO = -0.583056862648871  LUMO = 0.928291497544565
  mo_energy =
[-1.18587569e+02 -1.23125687e+01 -9.56305479e+00 -9.56305479e+00
 -9.56305479e+00 -1.27021318e+00 -5.83056863e-01 -5.83056863e-01
 -5.83056863e-01  9.28291498e-01  9.92571812e-01  9.92571812e-01
  9.92571812e-01  6.94931098e+00  6.94931098e+00  6.94931098e+00
  1.18591585e+01  3.24775418e+01  3.24775418e+01  3.24775418e+01
  8.10893404e+01  1.28862402e+02  1.28862402e+02  1.28862402e+02
  3.19854857e+02  4.83931547e+02  4.83931547e+02  4.83931547e+02
  9.78581126e+02  1.33222172e+03  1.33222172e+03  1.33222172e+03
  3.02096469e+03  3.02096469e+03  3.02096469e+03  3.14633759e+03
  6.63759077e+03  6.63759077e+03  6.63759077e+03  9.55196959e+03
  2.58859887e+04  7.65963887e+04]
E1 = -728.292925192316  E_coul = 201.537778603201
cycle= 6 E= -526.755146589115  delta_E= -5.83e-11  |g|= 1.84e-06  |ddm|= 1.87e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.292925192316  E_coul = 201.537778603201
  HOMO = -0.583056858813574  LUMO = 0.928291861112374
  mo_energy =
[-1.18587568e+02 -1.23125684e+01 -9.56305463e+00 -9.56305463e+00
 -9.56305463e+00 -1.27021276e+00 -5.83056859e-01 -5.83056859e-01
 -5.83056859e-01  9.28291861e-01  9.92571874e-01  9.92571874e-01
  9.92571874e-01  6.94931110e+00  6.94931110e+00  6.94931110e+00
  1.18591588e+01  3.24775419e+01  3.24775419e+01  3.24775419e+01
  8.10893407e+01  1.28862403e+02  1.28862403e+02  1.28862403e+02
  3.19854857e+02  4.83931547e+02  4.83931547e+02  4.83931547e+02
  9.78581126e+02  1.33222172e+03  1.33222172e+03  1.33222172e+03
  3.02096469e+03  3.02096469e+03  3.02096469e+03  3.14633759e+03
  6.63759077e+03  6.63759077e+03  6.63759077e+03  9.55196959e+03
  2.58859887e+04  7.65963887e+04]
E1 = -728.2929237103705  E_coul = 201.53777712125458
Extra cycle  E= -526.755146589116  delta_E= -7.96e-13  |g|= 3.82e-07  |ddm|= 3.33e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
exp = [2.61827973e+04 7.61718624e+03 3.61747184e+03 1.59027301e+03
 4.08249691e+02 1.55688428e+02 7.60511832e+01 3.08411962e+01
 8.17766409e+00 6.34546742e-01 3.13597171e+00 2.34998504e-01
 1.36282994e+03 6.64294007e+02 2.98834897e+02 3.12209223e+02
 6.26738129e+01 7.16429480e+00 2.02467613e+01 7.61743509e-01
 2.67894769e+00 2.20229319e-01]
E = -526.7551465891158
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:21 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.797252         1
[INPUT] 0    0    [1    /1   ]  7617.1862362         1
[INPUT] 0    0    [1    /1   ]  3617.47184156        1
[INPUT] 0    0    [1    /1   ]  1590.27301192        1
[INPUT] 0    0    [1    /1   ]  408.249691043        1
[INPUT] 0    0    [1    /1   ]  155.688428121        1
[INPUT] 0    0    [1    /1   ]  76.0511832126        1
[INPUT] 0    0    [1    /1   ]  30.8411961846        1
[INPUT] 0    0    [1    /1   ]  8.17766408773        1
[INPUT] 0    0    [1    /1   ]  0.634546741647       1
[INPUT] 0    0    [1    /1   ]  3.13597170645        1
[INPUT] 0    0    [1    /1   ]  0.234998504463       1
[INPUT] 1    0    [1    /1   ]  1362.82993784        1
[INPUT] 1    0    [1    /1   ]  664.294007134        1
[INPUT] 1    0    [1    /1   ]  298.834896588        1
[INPUT] 1    0    [1    /1   ]  312.209223001        1
[INPUT] 1    0    [1    /1   ]  62.6738129376        1
[INPUT] 1    0    [1    /1   ]  7.16429480258        1
[INPUT] 1    0    [1    /1   ]  20.2467613173        1
[INPUT] 1    0    [1    /1   ]  0.761743509351       1
[INPUT] 1    0    [1    /1   ]  2.67894769458        1
[INPUT] 1    0    [1    /1   ]  0.220229319233       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.79725202172, 1.0]], [0, [7617.18623619938, 1.0]], [0, [3617.471841563428, 1.0]], [0, [1590.2730119240978, 1.0]], [0, [408.2496910427772, 1.0]], [0, [155.6884281207723, 1.0]], [0, [76.05118321261044, 1.0]], [0, [30.841196184642744, 1.0]], [0, [8.17766408773459, 1.0]], [0, [0.6345467416467823, 1.0]], [0, [3.1359717064477506, 1.0]], [0, [0.23499850446267606, 1.0]], [1, [1362.8299378393185, 1.0]], [1, [664.294007133889, 1.0]], [1, [298.8348965882683, 1.0]], [1, [312.2092230013326, 1.0]], [1, [62.673812937617356, 1.0]], [1, [7.164294802578667, 1.0]], [1, [20.246761317251472, 1.0]], [1, [0.7617435093507247, 1.0]], [1, [2.6789476945782673, 1.0]], [1, [0.22022931923310374, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.79725202]
bas 1, expnt(s) = [7617.1862362]
bas 2, expnt(s) = [3617.47184156]
bas 3, expnt(s) = [1590.27301192]
bas 4, expnt(s) = [408.24969104]
bas 5, expnt(s) = [155.68842812]
bas 6, expnt(s) = [76.05118321]
bas 7, expnt(s) = [30.84119618]
bas 8, expnt(s) = [8.17766409]
bas 9, expnt(s) = [0.63454674]
bas 10, expnt(s) = [3.13597171]
bas 11, expnt(s) = [0.2349985]
bas 12, expnt(s) = [1362.82993784]
bas 13, expnt(s) = [664.29400713]
bas 14, expnt(s) = [298.83489659]
bas 15, expnt(s) = [312.209223]
bas 16, expnt(s) = [62.67381294]
bas 17, expnt(s) = [7.1642948]
bas 18, expnt(s) = [20.24676132]
bas 19, expnt(s) = [0.76174351]
bas 20, expnt(s) = [2.67894769]
bas 21, expnt(s) = [0.22022932]
CPU time:       527.54
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61827973e+04 5.20028393e+03 7.61718624e+03 2.05997028e+03
 3.61747184e+03 1.17847098e+03 1.59027301e+03 6.36236808e+02
 4.08249691e+02 2.29461286e+02 1.55688428e+02 1.11354372e+02
 7.60511832e+01 6.50645613e+01 3.08411962e+01 3.30646123e+01
 8.17766409e+00 1.22176302e+01 6.34546742e-01 1.79623328e+00
 3.13597171e+00 5.95379841e+00 2.34998504e-01 8.52734527e-01
 1.36282994e+03 2.41566371e+04 6.64294007e+02 9.83863413e+03
 2.98834897e+02 3.62471222e+03 3.12209223e+02 3.82861374e+03
 6.26738129e+01 5.14448658e+02 7.16429480e+00 3.41941020e+01
 2.02467613e+01 1.25293588e+02 7.61743509e-01 2.07608603e+00
 2.67894769e+00 9.99861130e+00 2.20229319e-01 4.40127305e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.994143484383255
cond(S) = 111061.45978651967
E1 = -729.5434837098907  E_coul = 203.172903279005
init E= -526.370580430886
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555962219219566  LUMO = 0.948401719332683
  mo_energy =
[-1.18335998e+02 -1.22064917e+01 -9.44717587e+00 -9.44717587e+00
 -9.44717587e+00 -1.24022667e+00 -5.55962219e-01 -5.55962219e-01
 -5.55962219e-01  9.48401719e-01  1.01070626e+00  1.01070626e+00
  1.01070626e+00  7.01848535e+00  7.01848535e+00  7.01848535e+00
  1.19410420e+01  3.25983825e+01  3.25983825e+01  3.25983825e+01
  8.12402990e+01  1.29045545e+02  1.29045545e+02  1.29045545e+02
  3.20071972e+02  4.84182343e+02  4.84182343e+02  4.84182343e+02
  9.78883073e+02  1.33252549e+03  1.33252549e+03  1.33252549e+03
  3.02133217e+03  3.02133217e+03  3.02133217e+03  3.14676965e+03
  6.63806989e+03  6.63806989e+03  6.63806989e+03  9.55251942e+03
  2.58866343e+04  7.65971252e+04]
E1 = -727.8429881072936  E_coul = 201.08863341828493
cycle= 1 E= -526.754354689009  delta_E= -0.384  |g|= 0.188  |ddm|= 0.298
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587134
diis-c [-0.34472639  1.        ]
  HOMO = -0.590761197502327  LUMO = 0.921660512202293
  mo_energy =
[-1.18645796e+02 -1.23451072e+01 -9.59687666e+00 -9.59687666e+00
 -9.59687666e+00 -1.27954749e+00 -5.90761198e-01 -5.90761198e-01
 -5.90761198e-01  9.21660512e-01  9.87011299e-01  9.87011299e-01
  9.87011299e-01  6.92965419e+00  6.92965419e+00  6.92965419e+00
  1.18341999e+01  3.24434563e+01  3.24434563e+01  3.24434563e+01
  8.10461447e+01  1.28814299e+02  1.28814299e+02  1.28814299e+02
  3.19800690e+02  4.83874017e+02  4.83874017e+02  4.83874017e+02
  9.78520925e+02  1.33216074e+03  1.33216074e+03  1.33216074e+03
  3.02090185e+03  3.02090185e+03  3.02090185e+03  3.14627405e+03
  6.63752658e+03  6.63752658e+03  6.63752658e+03  9.55190486e+03
  2.58859236e+04  7.65963234e+04]
E1 = -728.421602233374  E_coul = 201.66651731338771
cycle= 2 E= -526.755084919986  delta_E= -0.00073  |g|= 0.038  |ddm|= 0.054
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0768661
diis-c [-0.00392808  0.07082952  0.92917048]
  HOMO = -0.581440574560651  LUMO = 0.929550284343285
  mo_energy =
[-1.18576673e+02 -1.23062754e+01 -9.55637320e+00 -9.55637320e+00
 -9.55637320e+00 -1.26840315e+00 -5.81440575e-01 -5.81440575e-01
 -5.81440575e-01  9.29550284e-01  9.93707119e-01  9.93707119e-01
  9.93707119e-01  6.95329545e+00  6.95329545e+00  6.95329545e+00
  1.18640168e+01  3.24842311e+01  3.24842311e+01  3.24842311e+01
  8.10975633e+01  1.28871539e+02  1.28871539e+02  1.28871539e+02
  3.19865029e+02  4.83942315e+02  4.83942315e+02  4.83942315e+02
  9.78592433e+02  1.33223314e+03  1.33223314e+03  1.33223314e+03
  3.02097655e+03  3.02097655e+03  3.02097655e+03  3.14634969e+03
  6.63760306e+03  6.63760306e+03  6.63760306e+03  9.55198210e+03
  2.58860015e+04  7.65964016e+04]
E1 = -728.2681735024464  E_coul = 201.5130291965819
cycle= 3 E= -526.755144305865  delta_E= -5.94e-05  |g|= 0.0069  |ddm|= 0.0165
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0145307
diis-c [-7.60288694e-07 -1.24863437e-03  1.54846909e-01  8.46401725e-01]
  HOMO = -0.583068604566576  LUMO = 0.928262367895437
  mo_energy =
[-1.18587585e+02 -1.23126148e+01 -9.56308546e+00 -9.56308546e+00
 -9.56308546e+00 -1.27024887e+00 -5.83068605e-01 -5.83068605e-01
 -5.83068605e-01  9.28262368e-01  9.92560581e-01  9.92560581e-01
  9.92560581e-01  6.94928382e+00  6.94928382e+00  6.94928382e+00
  1.18591140e+01  3.24775125e+01  3.24775125e+01  3.24775125e+01
  8.10893071e+01  1.28862377e+02  1.28862377e+02  1.28862377e+02
  3.19854836e+02  4.83931529e+02  4.83931529e+02  4.83931529e+02
  9.78581119e+02  1.33222171e+03  1.33222171e+03  1.33222171e+03
  3.02096470e+03  3.02096470e+03  3.02096470e+03  3.14633760e+03
  6.63759079e+03  6.63759079e+03  6.63759079e+03  9.55196962e+03
  2.58859888e+04  7.65963888e+04]
E1 = -728.2930736732819  E_coul = 201.53792708589233
cycle= 4 E= -526.75514658739  delta_E= -2.28e-06  |g|= 9.82e-05  |ddm|= 0.00246
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000110754
diis-c [-4.48609659e-09  7.54798887e-05 -1.10562725e-02 -6.48228043e-02
  1.07580360e+00]
  HOMO = -0.583049378203278  LUMO = 0.928295260130622
  mo_energy =
[-1.18587538e+02 -1.23125461e+01 -9.56303035e+00 -9.56303035e+00
 -9.56303035e+00 -1.27020718e+00 -5.83049378e-01 -5.83049378e-01
 -5.83049378e-01  9.28295260e-01  9.92576652e-01  9.92576652e-01
  9.92576652e-01  6.94932723e+00  6.94932723e+00  6.94932723e+00
  1.18591764e+01  3.24775654e+01  3.24775654e+01  3.24775654e+01
  8.10893666e+01  1.28862430e+02  1.28862430e+02  1.28862430e+02
  3.19854886e+02  4.83931577e+02  4.83931577e+02  4.83931577e+02
  9.78581157e+02  1.33222175e+03  1.33222175e+03  1.33222175e+03
  3.02096473e+03  3.02096473e+03  3.02096473e+03  3.14633762e+03
  6.63759081e+03  6.63759081e+03  6.63759081e+03  9.55196963e+03
  2.58859888e+04  7.65963888e+04]
E1 = -728.2928442373576  E_coul = 201.53769764830093
cycle= 5 E= -526.755146589057  delta_E= -1.67e-09  |g|= 2.05e-05  |ddm|= 0.000159
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.8733e-05
diis-c [-8.05791855e-11  1.26776048e-05 -1.84755601e-03 -1.26569259e-02
  4.09645024e-02  9.73527302e-01]
  HOMO = -0.583056862648871  LUMO = 0.928291497544565
  mo_energy =
[-1.18587569e+02 -1.23125687e+01 -9.56305479e+00 -9.56305479e+00
 -9.56305479e+00 -1.27021318e+00 -5.83056863e-01 -5.83056863e-01
 -5.83056863e-01  9.28291498e-01  9.92571812e-01  9.92571812e-01
  9.92571812e-01  6.94931098e+00  6.94931098e+00  6.94931098e+00
  1.18591585e+01  3.24775418e+01  3.24775418e+01  3.24775418e+01
  8.10893404e+01  1.28862402e+02  1.28862402e+02  1.28862402e+02
  3.19854857e+02  4.83931547e+02  4.83931547e+02  4.83931547e+02
  9.78581126e+02  1.33222172e+03  1.33222172e+03  1.33222172e+03
  3.02096469e+03  3.02096469e+03  3.02096469e+03  3.14633759e+03
  6.63759077e+03  6.63759077e+03  6.63759077e+03  9.55196959e+03
  2.58859887e+04  7.65963887e+04]
E1 = -728.292925192316  E_coul = 201.537778603201
cycle= 6 E= -526.755146589115  delta_E= -5.83e-11  |g|= 1.84e-06  |ddm|= 1.87e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.292925192316  E_coul = 201.537778603201
  HOMO = -0.583056858813574  LUMO = 0.928291861112374
  mo_energy =
[-1.18587568e+02 -1.23125684e+01 -9.56305463e+00 -9.56305463e+00
 -9.56305463e+00 -1.27021276e+00 -5.83056859e-01 -5.83056859e-01
 -5.83056859e-01  9.28291861e-01  9.92571874e-01  9.92571874e-01
  9.92571874e-01  6.94931110e+00  6.94931110e+00  6.94931110e+00
  1.18591588e+01  3.24775419e+01  3.24775419e+01  3.24775419e+01
  8.10893407e+01  1.28862403e+02  1.28862403e+02  1.28862403e+02
  3.19854857e+02  4.83931547e+02  4.83931547e+02  4.83931547e+02
  9.78581126e+02  1.33222172e+03  1.33222172e+03  1.33222172e+03
  3.02096469e+03  3.02096469e+03  3.02096469e+03  3.14633759e+03
  6.63759077e+03  6.63759077e+03  6.63759077e+03  9.55196959e+03
  2.58859887e+04  7.65963887e+04]
E1 = -728.2929237103705  E_coul = 201.53777712125458
Extra cycle  E= -526.755146589116  delta_E= -7.96e-13  |g|= 3.82e-07  |ddm|= 3.33e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 111061.45978651967
E1 = -728.2929237103705  E_coul = 201.53777712125458
init E= -526.755146589116
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583056902134173  LUMO = 0.928291900420551
  mo_energy =
[-1.18587569e+02 -1.23125685e+01 -9.56305475e+00 -9.56305475e+00
 -9.56305475e+00 -1.27021272e+00 -5.83056902e-01 -5.83056902e-01
 -5.83056902e-01  9.28291900e-01  9.92571857e-01  9.92571857e-01
  9.92571857e-01  6.94931102e+00  6.94931102e+00  6.94931102e+00
  1.18591587e+01  3.24775418e+01  3.24775418e+01  3.24775418e+01
  8.10893405e+01  1.28862403e+02  1.28862403e+02  1.28862403e+02
  3.19854857e+02  4.83931547e+02  4.83931547e+02  4.83931547e+02
  9.78581126e+02  1.33222172e+03  1.33222172e+03  1.33222172e+03
  3.02096469e+03  3.02096469e+03  3.02096469e+03  3.14633759e+03
  6.63759077e+03  6.63759077e+03  6.63759077e+03  9.55196959e+03
  2.58859887e+04  7.65963887e+04]
E1 = -728.292923987687  E_coul = 201.53777739857108
cycle= 1 E= -526.755146589116  delta_E= -1.14e-13  |g|= 8.21e-08  |ddm|= 6.48e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.292923987687  E_coul = 201.53777739857108
  HOMO = -0.583056899829848  LUMO = 0.928291917663365
  mo_energy =
[-1.18587569e+02 -1.23125685e+01 -9.56305474e+00 -9.56305474e+00
 -9.56305474e+00 -1.27021270e+00 -5.83056900e-01 -5.83056900e-01
 -5.83056900e-01  9.28291918e-01  9.92571861e-01  9.92571861e-01
  9.92571861e-01  6.94931103e+00  6.94931103e+00  6.94931103e+00
  1.18591588e+01  3.24775418e+01  3.24775418e+01  3.24775418e+01
  8.10893406e+01  1.28862403e+02  1.28862403e+02  1.28862403e+02
  3.19854857e+02  4.83931547e+02  4.83931547e+02  4.83931547e+02
  9.78581126e+02  1.33222172e+03  1.33222172e+03  1.33222172e+03
  3.02096469e+03  3.02096469e+03  3.02096469e+03  3.14633759e+03
  6.63759077e+03  6.63759077e+03  6.63759077e+03  9.55196959e+03
  2.58859887e+04  7.65963887e+04]
E1 = -728.2929238811427  E_coul = 201.53777729202722
Extra cycle  E= -526.755146589115  delta_E= 5.68e-13  |g|= 1.68e-08  |ddm|= 1.4e-07
    CPU time for scf_cycle      0.91 sec, wall time      0.43 sec
exp = [2.61827973e+04 7.61718624e+03 3.61747184e+03 1.59027301e+03
 4.08249691e+02 1.55688428e+02 7.60511832e+01 3.08411962e+01
 8.17766409e+00 6.34546742e-01 3.13597171e+00 2.34998504e-01
 1.36282994e+03 6.64294007e+02 2.98834897e+02 3.12209223e+02
 6.26738129e+01 7.16429480e+00 2.02467613e+01 7.61743509e-01
 2.67894769e+00 2.20229319e-01]
grad_E = [-1.52221512e-06  3.35351614e-06 -1.77850602e-06  7.62470835e-05
 -4.19568771e-04  1.51286173e-04  1.32382679e-04 -1.88722560e-04
  2.70582383e-03 -9.37302307e-03 -6.15006407e-03  1.84880614e-02
 -5.94757502e-07  3.88266888e-06  1.73997895e-05  1.48933973e-05
  2.16091408e-04  8.47487548e-04  5.54156593e-05 -6.76674955e-03
 -6.96572905e-03  1.89319137e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:26 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8095456        1
[INPUT] 0    0    [1    /1   ]  7617.15671759        1
[INPUT] 0    0    [1    /1   ]  3617.48205169        1
[INPUT] 0    0    [1    /1   ]  1589.60272129        1
[INPUT] 0    0    [1    /1   ]  410.782755845        1
[INPUT] 0    0    [1    /1   ]  159.207216481        1
[INPUT] 0    0    [1    /1   ]  78.6411091488        1
[INPUT] 0    0    [1    /1   ]  31.4533998222        1
[INPUT] 0    0    [1    /1   ]  7.9608104131         1
[INPUT] 0    0    [1    /1   ]  0.64778868488        1
[INPUT] 0    0    [1    /1   ]  3.09822200959        1
[INPUT] 0    0    [1    /1   ]  0.237242367877       1
[INPUT] 1    0    [1    /1   ]  1362.83399164        1
[INPUT] 1    0    [1    /1   ]  664.25487688         1
[INPUT] 1    0    [1    /1   ]  298.650606894        1
[INPUT] 1    0    [1    /1   ]  312.050420775        1
[INPUT] 1    0    [1    /1   ]  62.7787155335        1
[INPUT] 1    0    [1    /1   ]  7.16972550926        1
[INPUT] 1    0    [1    /1   ]  20.1791718541        1
[INPUT] 1    0    [1    /1   ]  0.764185247274       1
[INPUT] 1    0    [1    /1   ]  2.70313108873        1
[INPUT] 1    0    [1    /1   ]  0.220574273815       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.80954561291, 1.0]], [0, [7617.156717594669, 1.0]], [0, [3617.4820516944924, 1.0]], [0, [1589.6027212911022, 1.0]], [0, [410.78275584532696, 1.0]], [0, [159.20721648118882, 1.0]], [0, [78.64110914875185, 1.0]], [0, [31.45339982222356, 1.0]], [0, [7.96081041309513, 1.0]], [0, [0.6477886848801647, 1.0]], [0, [3.0982220095882016, 1.0]], [0, [0.2372423678768224, 1.0]], [1, [1362.8339916354569, 1.0]], [1, [664.2548768801034, 1.0]], [1, [298.65060689407306, 1.0]], [1, [312.0504207745225, 1.0]], [1, [62.778715533516774, 1.0]], [1, [7.169725509259077, 1.0]], [1, [20.17917185410337, 1.0]], [1, [0.7641852472742682, 1.0]], [1, [2.7031310887285174, 1.0]], [1, [0.22057427381472205, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.80954561]
bas 1, expnt(s) = [7617.15671759]
bas 2, expnt(s) = [3617.48205169]
bas 3, expnt(s) = [1589.60272129]
bas 4, expnt(s) = [410.78275585]
bas 5, expnt(s) = [159.20721648]
bas 6, expnt(s) = [78.64110915]
bas 7, expnt(s) = [31.45339982]
bas 8, expnt(s) = [7.96081041]
bas 9, expnt(s) = [0.64778868]
bas 10, expnt(s) = [3.09822201]
bas 11, expnt(s) = [0.23724237]
bas 12, expnt(s) = [1362.83399164]
bas 13, expnt(s) = [664.25487688]
bas 14, expnt(s) = [298.65060689]
bas 15, expnt(s) = [312.05042077]
bas 16, expnt(s) = [62.77871553]
bas 17, expnt(s) = [7.16972551]
bas 18, expnt(s) = [20.17917185]
bas 19, expnt(s) = [0.76418525]
bas 20, expnt(s) = [2.70313109]
bas 21, expnt(s) = [0.22057427]
CPU time:       532.97
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828095e+04 5.20028576e+03 7.61715672e+03 2.05996429e+03
 3.61748205e+03 1.17847348e+03 1.58960272e+03 6.36035670e+02
 4.10782756e+02 2.30528263e+02 1.59207216e+02 1.13236669e+02
 7.86411091e+01 6.67194176e+01 3.14533998e+01 3.35556550e+01
 7.96081041e+00 1.19738272e+01 6.47788685e-01 1.82427389e+00
 3.09822201e+00 5.89996486e+00 2.37242368e-01 8.58833965e-01
 1.36283399e+03 2.41567269e+04 6.64254877e+02 9.83790970e+03
 2.98650607e+02 3.62191826e+03 3.12050421e+02 3.82617966e+03
 6.27787155e+01 5.15525230e+02 7.16972551e+00 3.42265050e+01
 2.01791719e+01 1.24770974e+02 7.64185247e-01 2.08440787e+00
 2.70313109e+00 1.01115626e+01 2.20574274e-01 4.40989212e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99408141396153
cond(S) = 110555.94234738998
E1 = -729.5464049657506  E_coul = 203.17490105028722
init E= -526.371503915463
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555896179633215  LUMO = 0.970620576483647
  mo_energy =
[-1.18336051e+02 -1.22064587e+01 -9.44704377e+00 -9.44704377e+00
 -9.44704377e+00 -1.24018753e+00 -5.55896180e-01 -5.55896180e-01
 -5.55896180e-01  9.70620576e-01  1.01426710e+00  1.01426710e+00
  1.01426710e+00  7.07281304e+00  7.07281304e+00  7.07281304e+00
  1.17522617e+01  3.26632518e+01  3.26632518e+01  3.26632518e+01
  8.20766453e+01  1.29060564e+02  1.29060564e+02  1.29060564e+02
  3.27868920e+02  4.84209442e+02  4.84209442e+02  4.84209442e+02
  9.98656940e+02  1.33224553e+03  1.33224553e+03  1.33224553e+03
  3.02057767e+03  3.02057767e+03  3.02057767e+03  3.17626963e+03
  6.63698770e+03  6.63698770e+03  6.63698770e+03  9.58360986e+03
  2.59166484e+04  7.66251610e+04]
E1 = -727.8452537833232  E_coul = 201.0901306471578
cycle= 1 E= -526.755123136165  delta_E= -0.384  |g|= 0.187  |ddm|= 0.299
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587255
diis-c [-0.34486806  1.        ]
  HOMO = -0.59087722926965  LUMO = 0.943266075987912
  mo_energy =
[-1.18645806e+02 -1.23450056e+01 -9.59661694e+00 -9.59661694e+00
 -9.59661694e+00 -1.27970627e+00 -5.90877229e-01 -5.90877229e-01
 -5.90877229e-01  9.43266076e-01  9.90357139e-01  9.90357139e-01
  9.90357139e-01  6.98348734e+00  6.98348734e+00  6.98348734e+00
  1.16461552e+01  3.25085144e+01  3.25085144e+01  3.25085144e+01
  8.18811887e+01  1.28829449e+02  1.28829449e+02  1.28829449e+02
  3.27595604e+02  4.83901188e+02  4.83901188e+02  4.83901188e+02
  9.98293598e+02  1.33188089e+03  1.33188089e+03  1.33188089e+03
  3.02014743e+03  3.02014743e+03  3.02014743e+03  3.17577407e+03
  6.63644449e+03  6.63644449e+03  6.63644449e+03  9.58299563e+03
  2.59159380e+04  7.66243594e+04]
E1 = -728.4243431878859  E_coul = 201.66848936887246
cycle= 2 E= -526.755853819014  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.0538
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0769476
diis-c [-0.00392734  0.07103589  0.92896411]
  HOMO = -0.58155624962655  LUMO = 0.951288091504111
  mo_energy =
[-1.18576665e+02 -1.23061472e+01 -9.55607720e+00 -9.55607720e+00
 -9.55607720e+00 -1.26855574e+00 -5.81556250e-01 -5.81556250e-01
 -5.81556250e-01  9.51288092e-01  9.97085048e-01  9.97085048e-01
  9.97085048e-01  7.00723599e+00  7.00723599e+00  7.00723599e+00
  1.16757350e+01  3.25492913e+01  3.25492913e+01  3.25492913e+01
  8.19329749e+01  1.28886712e+02  1.28886712e+02  1.28886712e+02
  3.27660246e+02  4.83969505e+02  4.83969505e+02  4.83969505e+02
  9.98365209e+02  1.33195331e+03  1.33195331e+03  1.33195331e+03
  3.02022214e+03  3.02022214e+03  3.02022214e+03  3.17584973e+03
  6.63652100e+03  6.63652100e+03  6.63652100e+03  9.58307288e+03
  2.59160158e+04  7.66244376e+04]
E1 = -728.2705989211968  E_coul = 201.51468549329454
cycle= 3 E= -526.755913427902  delta_E= -5.96e-05  |g|= 0.00691  |ddm|= 0.0165
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.014544
diis-c [-7.58635198e-07 -1.24247219e-03  1.54841428e-01  8.46401044e-01]
  HOMO = -0.583187231820823  LUMO = 0.949977264810012
  mo_energy =
[-1.18587586e+02 -1.23124962e+01 -9.56279907e+00 -9.56279907e+00
 -9.56279907e+00 -1.27040408e+00 -5.83187232e-01 -5.83187232e-01
 -5.83187232e-01  9.49977265e-01  9.95931377e-01  9.95931377e-01
  9.95931377e-01  7.00320220e+00  7.00320220e+00  7.00320220e+00
  1.16708632e+01  3.25425682e+01  3.25425682e+01  3.25425682e+01
  8.19246607e+01  1.28877541e+02  1.28877541e+02  1.28877541e+02
  3.27650002e+02  4.83958711e+02  4.83958711e+02  4.83958711e+02
  9.98353874e+02  1.33194187e+03  1.33194187e+03  1.33194187e+03
  3.02021028e+03  3.02021028e+03  3.02021028e+03  3.17583764e+03
  6.63650872e+03  6.63650872e+03  6.63650872e+03  9.58306040e+03
  2.59160032e+04  7.66244248e+04]
E1 = -728.2955654400026  E_coul = 201.53964971918415
cycle= 4 E= -526.755915720819  delta_E= -2.29e-06  |g|= 9.95e-05  |ddm|= 0.00246
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000110021
diis-c [-4.55191717e-09  7.53761678e-05 -1.10698615e-02 -6.47717289e-02
  1.07576621e+00]
  HOMO = -0.583167593797773  LUMO = 0.950011264119934
  mo_energy =
[-1.18587537e+02 -1.23124261e+01 -9.56274252e+00 -9.56274252e+00
 -9.56274252e+00 -1.27036156e+00 -5.83167594e-01 -5.83167594e-01
 -5.83167594e-01  9.50011264e-01  9.95947849e-01  9.95947849e-01
  9.95947849e-01  7.00324667e+00  7.00324667e+00  7.00324667e+00
  1.16709264e+01  3.25426227e+01  3.25426227e+01  3.25426227e+01
  8.19247218e+01  1.28877596e+02  1.28877596e+02  1.28877596e+02
  3.27650055e+02  4.83958760e+02  4.83958760e+02  4.83958760e+02
  9.98353914e+02  1.33194191e+03  1.33194191e+03  1.33194191e+03
  3.02021031e+03  3.02021031e+03  3.02021031e+03  3.17583766e+03
  6.63650874e+03  6.63650874e+03  6.63650874e+03  9.58306041e+03
  2.59160032e+04  7.66244248e+04]
E1 = -728.2953303976078  E_coul = 201.53941467506473
cycle= 5 E= -526.755915722543  delta_E= -1.72e-09  |g|= 2.08e-05  |ddm|= 0.00016
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.92724e-05
diis-c [-8.18076622e-11  1.27885217e-05 -1.86505030e-03 -1.27777050e-02
  3.90991163e-02  9.75530850e-01]
  HOMO = -0.583175145038629  LUMO = 0.950007423716761
  mo_energy =
[-1.18587568e+02 -1.23124489e+01 -9.56276725e+00 -9.56276725e+00
 -9.56276725e+00 -1.27036759e+00 -5.83175145e-01 -5.83175145e-01
 -5.83175145e-01  9.50007424e-01  9.95942948e-01  9.95942948e-01
  9.95942948e-01  7.00323019e+00  7.00323019e+00  7.00323019e+00
  1.16709084e+01  3.25425987e+01  3.25425987e+01  3.25425987e+01
  8.19246952e+01  1.28877568e+02  1.28877568e+02  1.28877568e+02
  3.27650025e+02  4.83958729e+02  4.83958729e+02  4.83958729e+02
  9.98353882e+02  1.33194188e+03  1.33194188e+03  1.33194188e+03
  3.02021028e+03  3.02021028e+03  3.02021028e+03  3.17583763e+03
  6.63650870e+03  6.63650870e+03  6.63650870e+03  9.58306037e+03
  2.59160031e+04  7.66244248e+04]
E1 = -728.2954125667078  E_coul = 201.53949684410557
cycle= 6 E= -526.755915722602  delta_E= -5.92e-11  |g|= 1.83e-06  |ddm|= 1.89e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2954125667078  E_coul = 201.53949684410557
  HOMO = -0.583175128047784  LUMO = 0.950007799682594
  mo_energy =
[-1.18587567e+02 -1.23124486e+01 -9.56276705e+00 -9.56276705e+00
 -9.56276705e+00 -1.27036716e+00 -5.83175128e-01 -5.83175128e-01
 -5.83175128e-01  9.50007800e-01  9.95943018e-01  9.95943018e-01
  9.95943018e-01  7.00323034e+00  7.00323034e+00  7.00323034e+00
  1.16709087e+01  3.25425989e+01  3.25425989e+01  3.25425989e+01
  8.19246955e+01  1.28877568e+02  1.28877568e+02  1.28877568e+02
  3.27650025e+02  4.83958730e+02  4.83958730e+02  4.83958730e+02
  9.98353882e+02  1.33194188e+03  1.33194188e+03  1.33194188e+03
  3.02021028e+03  3.02021028e+03  3.02021028e+03  3.17583763e+03
  6.63650870e+03  6.63650870e+03  6.63650870e+03  9.58306037e+03
  2.59160031e+04  7.66244248e+04]
E1 = -728.295411000358  E_coul = 201.53949527775612
Extra cycle  E= -526.755915722602  delta_E= 4.55e-13  |g|= 3.8e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.23 sec, wall time      0.21 sec
exp = [2.61828095e+04 7.61715672e+03 3.61748205e+03 1.58960272e+03
 4.10782756e+02 1.59207216e+02 7.86411091e+01 3.14533998e+01
 7.96081041e+00 6.47788685e-01 3.09822201e+00 2.37242368e-01
 1.36283399e+03 6.64254877e+02 2.98650607e+02 3.12050421e+02
 6.27787155e+01 7.16972551e+00 2.01791719e+01 7.64185247e-01
 2.70313109e+00 2.20574274e-01]
E = -526.7559157226018
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:26 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8095456        1
[INPUT] 0    0    [1    /1   ]  7617.15671759        1
[INPUT] 0    0    [1    /1   ]  3617.48205169        1
[INPUT] 0    0    [1    /1   ]  1589.60272129        1
[INPUT] 0    0    [1    /1   ]  410.782755845        1
[INPUT] 0    0    [1    /1   ]  159.207216481        1
[INPUT] 0    0    [1    /1   ]  78.6411091488        1
[INPUT] 0    0    [1    /1   ]  31.4533998222        1
[INPUT] 0    0    [1    /1   ]  7.9608104131         1
[INPUT] 0    0    [1    /1   ]  0.64778868488        1
[INPUT] 0    0    [1    /1   ]  3.09822200959        1
[INPUT] 0    0    [1    /1   ]  0.237242367877       1
[INPUT] 1    0    [1    /1   ]  1362.83399164        1
[INPUT] 1    0    [1    /1   ]  664.25487688         1
[INPUT] 1    0    [1    /1   ]  298.650606894        1
[INPUT] 1    0    [1    /1   ]  312.050420775        1
[INPUT] 1    0    [1    /1   ]  62.7787155335        1
[INPUT] 1    0    [1    /1   ]  7.16972550926        1
[INPUT] 1    0    [1    /1   ]  20.1791718541        1
[INPUT] 1    0    [1    /1   ]  0.764185247274       1
[INPUT] 1    0    [1    /1   ]  2.70313108873        1
[INPUT] 1    0    [1    /1   ]  0.220574273815       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.80954561291, 1.0]], [0, [7617.156717594669, 1.0]], [0, [3617.4820516944924, 1.0]], [0, [1589.6027212911022, 1.0]], [0, [410.78275584532696, 1.0]], [0, [159.20721648118882, 1.0]], [0, [78.64110914875185, 1.0]], [0, [31.45339982222356, 1.0]], [0, [7.96081041309513, 1.0]], [0, [0.6477886848801647, 1.0]], [0, [3.0982220095882016, 1.0]], [0, [0.2372423678768224, 1.0]], [1, [1362.8339916354569, 1.0]], [1, [664.2548768801034, 1.0]], [1, [298.65060689407306, 1.0]], [1, [312.0504207745225, 1.0]], [1, [62.778715533516774, 1.0]], [1, [7.169725509259077, 1.0]], [1, [20.17917185410337, 1.0]], [1, [0.7641852472742682, 1.0]], [1, [2.7031310887285174, 1.0]], [1, [0.22057427381472205, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.80954561]
bas 1, expnt(s) = [7617.15671759]
bas 2, expnt(s) = [3617.48205169]
bas 3, expnt(s) = [1589.60272129]
bas 4, expnt(s) = [410.78275585]
bas 5, expnt(s) = [159.20721648]
bas 6, expnt(s) = [78.64110915]
bas 7, expnt(s) = [31.45339982]
bas 8, expnt(s) = [7.96081041]
bas 9, expnt(s) = [0.64778868]
bas 10, expnt(s) = [3.09822201]
bas 11, expnt(s) = [0.23724237]
bas 12, expnt(s) = [1362.83399164]
bas 13, expnt(s) = [664.25487688]
bas 14, expnt(s) = [298.65060689]
bas 15, expnt(s) = [312.05042077]
bas 16, expnt(s) = [62.77871553]
bas 17, expnt(s) = [7.16972551]
bas 18, expnt(s) = [20.17917185]
bas 19, expnt(s) = [0.76418525]
bas 20, expnt(s) = [2.70313109]
bas 21, expnt(s) = [0.22057427]
CPU time:       533.45
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828095e+04 5.20028576e+03 7.61715672e+03 2.05996429e+03
 3.61748205e+03 1.17847348e+03 1.58960272e+03 6.36035670e+02
 4.10782756e+02 2.30528263e+02 1.59207216e+02 1.13236669e+02
 7.86411091e+01 6.67194176e+01 3.14533998e+01 3.35556550e+01
 7.96081041e+00 1.19738272e+01 6.47788685e-01 1.82427389e+00
 3.09822201e+00 5.89996486e+00 2.37242368e-01 8.58833965e-01
 1.36283399e+03 2.41567269e+04 6.64254877e+02 9.83790970e+03
 2.98650607e+02 3.62191826e+03 3.12050421e+02 3.82617966e+03
 6.27787155e+01 5.15525230e+02 7.16972551e+00 3.42265050e+01
 2.01791719e+01 1.24770974e+02 7.64185247e-01 2.08440787e+00
 2.70313109e+00 1.01115626e+01 2.20574274e-01 4.40989212e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99408141396153
cond(S) = 110555.94234738998
E1 = -729.5464049657506  E_coul = 203.17490105028722
init E= -526.371503915463
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555896179633215  LUMO = 0.970620576483647
  mo_energy =
[-1.18336051e+02 -1.22064587e+01 -9.44704377e+00 -9.44704377e+00
 -9.44704377e+00 -1.24018753e+00 -5.55896180e-01 -5.55896180e-01
 -5.55896180e-01  9.70620576e-01  1.01426710e+00  1.01426710e+00
  1.01426710e+00  7.07281304e+00  7.07281304e+00  7.07281304e+00
  1.17522617e+01  3.26632518e+01  3.26632518e+01  3.26632518e+01
  8.20766453e+01  1.29060564e+02  1.29060564e+02  1.29060564e+02
  3.27868920e+02  4.84209442e+02  4.84209442e+02  4.84209442e+02
  9.98656940e+02  1.33224553e+03  1.33224553e+03  1.33224553e+03
  3.02057767e+03  3.02057767e+03  3.02057767e+03  3.17626963e+03
  6.63698770e+03  6.63698770e+03  6.63698770e+03  9.58360986e+03
  2.59166484e+04  7.66251610e+04]
E1 = -727.8452537833232  E_coul = 201.0901306471578
cycle= 1 E= -526.755123136165  delta_E= -0.384  |g|= 0.187  |ddm|= 0.299
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587255
diis-c [-0.34486806  1.        ]
  HOMO = -0.59087722926965  LUMO = 0.943266075987912
  mo_energy =
[-1.18645806e+02 -1.23450056e+01 -9.59661694e+00 -9.59661694e+00
 -9.59661694e+00 -1.27970627e+00 -5.90877229e-01 -5.90877229e-01
 -5.90877229e-01  9.43266076e-01  9.90357139e-01  9.90357139e-01
  9.90357139e-01  6.98348734e+00  6.98348734e+00  6.98348734e+00
  1.16461552e+01  3.25085144e+01  3.25085144e+01  3.25085144e+01
  8.18811887e+01  1.28829449e+02  1.28829449e+02  1.28829449e+02
  3.27595604e+02  4.83901188e+02  4.83901188e+02  4.83901188e+02
  9.98293598e+02  1.33188089e+03  1.33188089e+03  1.33188089e+03
  3.02014743e+03  3.02014743e+03  3.02014743e+03  3.17577407e+03
  6.63644449e+03  6.63644449e+03  6.63644449e+03  9.58299563e+03
  2.59159380e+04  7.66243594e+04]
E1 = -728.4243431878859  E_coul = 201.66848936887246
cycle= 2 E= -526.755853819014  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.0538
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0769476
diis-c [-0.00392734  0.07103589  0.92896411]
  HOMO = -0.58155624962655  LUMO = 0.951288091504111
  mo_energy =
[-1.18576665e+02 -1.23061472e+01 -9.55607720e+00 -9.55607720e+00
 -9.55607720e+00 -1.26855574e+00 -5.81556250e-01 -5.81556250e-01
 -5.81556250e-01  9.51288092e-01  9.97085048e-01  9.97085048e-01
  9.97085048e-01  7.00723599e+00  7.00723599e+00  7.00723599e+00
  1.16757350e+01  3.25492913e+01  3.25492913e+01  3.25492913e+01
  8.19329749e+01  1.28886712e+02  1.28886712e+02  1.28886712e+02
  3.27660246e+02  4.83969505e+02  4.83969505e+02  4.83969505e+02
  9.98365209e+02  1.33195331e+03  1.33195331e+03  1.33195331e+03
  3.02022214e+03  3.02022214e+03  3.02022214e+03  3.17584973e+03
  6.63652100e+03  6.63652100e+03  6.63652100e+03  9.58307288e+03
  2.59160158e+04  7.66244376e+04]
E1 = -728.2705989211968  E_coul = 201.51468549329454
cycle= 3 E= -526.755913427902  delta_E= -5.96e-05  |g|= 0.00691  |ddm|= 0.0165
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.014544
diis-c [-7.58635198e-07 -1.24247219e-03  1.54841428e-01  8.46401044e-01]
  HOMO = -0.583187231820823  LUMO = 0.949977264810012
  mo_energy =
[-1.18587586e+02 -1.23124962e+01 -9.56279907e+00 -9.56279907e+00
 -9.56279907e+00 -1.27040408e+00 -5.83187232e-01 -5.83187232e-01
 -5.83187232e-01  9.49977265e-01  9.95931377e-01  9.95931377e-01
  9.95931377e-01  7.00320220e+00  7.00320220e+00  7.00320220e+00
  1.16708632e+01  3.25425682e+01  3.25425682e+01  3.25425682e+01
  8.19246607e+01  1.28877541e+02  1.28877541e+02  1.28877541e+02
  3.27650002e+02  4.83958711e+02  4.83958711e+02  4.83958711e+02
  9.98353874e+02  1.33194187e+03  1.33194187e+03  1.33194187e+03
  3.02021028e+03  3.02021028e+03  3.02021028e+03  3.17583764e+03
  6.63650872e+03  6.63650872e+03  6.63650872e+03  9.58306040e+03
  2.59160032e+04  7.66244248e+04]
E1 = -728.2955654400026  E_coul = 201.53964971918415
cycle= 4 E= -526.755915720819  delta_E= -2.29e-06  |g|= 9.95e-05  |ddm|= 0.00246
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000110021
diis-c [-4.55191717e-09  7.53761678e-05 -1.10698615e-02 -6.47717289e-02
  1.07576621e+00]
  HOMO = -0.583167593797773  LUMO = 0.950011264119934
  mo_energy =
[-1.18587537e+02 -1.23124261e+01 -9.56274252e+00 -9.56274252e+00
 -9.56274252e+00 -1.27036156e+00 -5.83167594e-01 -5.83167594e-01
 -5.83167594e-01  9.50011264e-01  9.95947849e-01  9.95947849e-01
  9.95947849e-01  7.00324667e+00  7.00324667e+00  7.00324667e+00
  1.16709264e+01  3.25426227e+01  3.25426227e+01  3.25426227e+01
  8.19247218e+01  1.28877596e+02  1.28877596e+02  1.28877596e+02
  3.27650055e+02  4.83958760e+02  4.83958760e+02  4.83958760e+02
  9.98353914e+02  1.33194191e+03  1.33194191e+03  1.33194191e+03
  3.02021031e+03  3.02021031e+03  3.02021031e+03  3.17583766e+03
  6.63650874e+03  6.63650874e+03  6.63650874e+03  9.58306041e+03
  2.59160032e+04  7.66244248e+04]
E1 = -728.2953303976078  E_coul = 201.53941467506473
cycle= 5 E= -526.755915722543  delta_E= -1.72e-09  |g|= 2.08e-05  |ddm|= 0.00016
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.92724e-05
diis-c [-8.18076622e-11  1.27885217e-05 -1.86505030e-03 -1.27777050e-02
  3.90991163e-02  9.75530850e-01]
  HOMO = -0.583175145038629  LUMO = 0.950007423716761
  mo_energy =
[-1.18587568e+02 -1.23124489e+01 -9.56276725e+00 -9.56276725e+00
 -9.56276725e+00 -1.27036759e+00 -5.83175145e-01 -5.83175145e-01
 -5.83175145e-01  9.50007424e-01  9.95942948e-01  9.95942948e-01
  9.95942948e-01  7.00323019e+00  7.00323019e+00  7.00323019e+00
  1.16709084e+01  3.25425987e+01  3.25425987e+01  3.25425987e+01
  8.19246952e+01  1.28877568e+02  1.28877568e+02  1.28877568e+02
  3.27650025e+02  4.83958729e+02  4.83958729e+02  4.83958729e+02
  9.98353882e+02  1.33194188e+03  1.33194188e+03  1.33194188e+03
  3.02021028e+03  3.02021028e+03  3.02021028e+03  3.17583763e+03
  6.63650870e+03  6.63650870e+03  6.63650870e+03  9.58306037e+03
  2.59160031e+04  7.66244248e+04]
E1 = -728.2954125667078  E_coul = 201.53949684410557
cycle= 6 E= -526.755915722602  delta_E= -5.92e-11  |g|= 1.83e-06  |ddm|= 1.89e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2954125667078  E_coul = 201.53949684410557
  HOMO = -0.583175128047784  LUMO = 0.950007799682594
  mo_energy =
[-1.18587567e+02 -1.23124486e+01 -9.56276705e+00 -9.56276705e+00
 -9.56276705e+00 -1.27036716e+00 -5.83175128e-01 -5.83175128e-01
 -5.83175128e-01  9.50007800e-01  9.95943018e-01  9.95943018e-01
  9.95943018e-01  7.00323034e+00  7.00323034e+00  7.00323034e+00
  1.16709087e+01  3.25425989e+01  3.25425989e+01  3.25425989e+01
  8.19246955e+01  1.28877568e+02  1.28877568e+02  1.28877568e+02
  3.27650025e+02  4.83958730e+02  4.83958730e+02  4.83958730e+02
  9.98353882e+02  1.33194188e+03  1.33194188e+03  1.33194188e+03
  3.02021028e+03  3.02021028e+03  3.02021028e+03  3.17583763e+03
  6.63650870e+03  6.63650870e+03  6.63650870e+03  9.58306037e+03
  2.59160031e+04  7.66244248e+04]
E1 = -728.295411000358  E_coul = 201.53949527775612
Extra cycle  E= -526.755915722602  delta_E= 4.55e-13  |g|= 3.8e-07  |ddm|= 3.26e-06
    CPU time for scf_cycle      0.23 sec, wall time      0.20 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 110555.94234738998
E1 = -728.295411000358  E_coul = 201.53949527775612
init E= -526.755915722602
    CPU time for initialize scf      0.80 sec, wall time      0.32 sec
  HOMO = -0.583175172367526  LUMO = 0.950007837671927
  mo_energy =
[-1.18587567e+02 -1.23124487e+01 -9.56276718e+00 -9.56276718e+00
 -9.56276718e+00 -1.27036712e+00 -5.83175172e-01 -5.83175172e-01
 -5.83175172e-01  9.50007838e-01  9.95943000e-01  9.95943000e-01
  9.95943000e-01  7.00323025e+00  7.00323025e+00  7.00323025e+00
  1.16709087e+01  3.25425988e+01  3.25425988e+01  3.25425988e+01
  8.19246954e+01  1.28877568e+02  1.28877568e+02  1.28877568e+02
  3.27650025e+02  4.83958730e+02  4.83958730e+02  4.83958730e+02
  9.98353882e+02  1.33194188e+03  1.33194188e+03  1.33194188e+03
  3.02021028e+03  3.02021028e+03  3.02021028e+03  3.17583763e+03
  6.63650870e+03  6.63650870e+03  6.63650870e+03  9.58306037e+03
  2.59160031e+04  7.66244248e+04]
E1 = -728.2954113102536  E_coul = 201.5394955876503
cycle= 1 E= -526.755915722603  delta_E= -1.48e-12  |g|= 8.18e-08  |ddm|= 6.32e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2954113102536  E_coul = 201.5394955876503
  HOMO = -0.583175169308946  LUMO = 0.950007855557571
  mo_energy =
[-1.18587567e+02 -1.23124486e+01 -9.56276716e+00 -9.56276716e+00
 -9.56276716e+00 -1.27036710e+00 -5.83175169e-01 -5.83175169e-01
 -5.83175169e-01  9.50007856e-01  9.95943005e-01  9.95943005e-01
  9.95943005e-01  7.00323027e+00  7.00323027e+00  7.00323027e+00
  1.16709087e+01  3.25425988e+01  3.25425988e+01  3.25425988e+01
  8.19246954e+01  1.28877568e+02  1.28877568e+02  1.28877568e+02
  3.27650025e+02  4.83958730e+02  4.83958730e+02  4.83958730e+02
  9.98353882e+02  1.33194188e+03  1.33194188e+03  1.33194188e+03
  3.02021028e+03  3.02021028e+03  3.02021028e+03  3.17583763e+03
  6.63650870e+03  6.63650870e+03  6.63650870e+03  9.58306037e+03
  2.59160031e+04  7.66244248e+04]
E1 = -728.295411196078  E_coul = 201.53949547347432
Extra cycle  E= -526.755915722604  delta_E= -4.55e-13  |g|= 1.68e-08  |ddm|= 1.37e-07
    CPU time for scf_cycle      0.90 sec, wall time      0.42 sec
exp = [2.61828095e+04 7.61715672e+03 3.61748205e+03 1.58960272e+03
 4.10782756e+02 1.59207216e+02 7.86411091e+01 3.14533998e+01
 7.96081041e+00 6.47788685e-01 3.09822201e+00 2.37242368e-01
 1.36283399e+03 6.64254877e+02 2.98650607e+02 3.12050421e+02
 6.27787155e+01 7.16972551e+00 2.01791719e+01 7.64185247e-01
 2.70313109e+00 2.20574274e-01]
grad_E = [-1.51321173e-06  3.25500407e-06 -1.85271331e-06  7.31762887e-05
 -3.90771321e-04  1.29621205e-04  1.68183973e-04 -2.86857897e-04
  1.43543143e-03 -4.47357161e-03 -3.22132298e-03  1.11828940e-02
 -6.12615134e-07  3.55859055e-06  1.54849169e-05  1.32567542e-05
  3.93762439e-04  1.22882098e-03 -8.49338808e-04 -4.51406253e-03
 -5.03331900e-03  1.29122271e-02]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:31 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8583331        1
[INPUT] 0    0    [1    /1   ]  7617.03969826        1
[INPUT] 0    0    [1    /1   ]  3617.52268883        1
[INPUT] 0    0    [1    /1   ]  1586.9478161         1
[INPUT] 0    0    [1    /1   ]  420.717102663        1
[INPUT] 0    0    [1    /1   ]  173.28716762         1
[INPUT] 0    0    [1    /1   ]  89.6466884597        1
[INPUT] 0    0    [1    /1   ]  34.3643847189        1
[INPUT] 0    0    [1    /1   ]  7.78176796945        1
[INPUT] 0    0    [1    /1   ]  0.655012244977       1
[INPUT] 0    0    [1    /1   ]  3.09906664278        1
[INPUT] 0    0    [1    /1   ]  0.236906363159       1
[INPUT] 1    0    [1    /1   ]  1362.85008443        1
[INPUT] 1    0    [1    /1   ]  664.099559501        1
[INPUT] 1    0    [1    /1   ]  297.919156225        1
[INPUT] 1    0    [1    /1   ]  311.420124617        1
[INPUT] 1    0    [1    /1   ]  63.1741051767        1
[INPUT] 1    0    [1    /1   ]  7.10687723381        1
[INPUT] 1    0    [1    /1   ]  20.0181826294        1
[INPUT] 1    0    [1    /1   ]  0.764350247945       1
[INPUT] 1    0    [1    /1   ]  2.71034876368        1
[INPUT] 1    0    [1    /1   ]  0.220455019615       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.858333063818, 1.0]], [0, [7617.039698255571, 1.0]], [0, [3617.5226888295633, 1.0]], [0, [1586.9478160970932, 1.0]], [0, [420.71710266281383, 1.0]], [0, [173.28716762027167, 1.0]], [0, [89.64668845971488, 1.0]], [0, [34.36438471892009, 1.0]], [0, [7.781767969451684, 1.0]], [0, [0.6550122449767748, 1.0]], [0, [3.0990666427758504, 1.0]], [0, [0.23690636315905686, 1.0]], [1, [1362.850084430252, 1.0]], [1, [664.0995595010422, 1.0]], [1, [297.9191562245878, 1.0]], [1, [311.42012461725653, 1.0]], [1, [63.17410517665228, 1.0]], [1, [7.106877233805649, 1.0]], [1, [20.01818262940534, 1.0]], [1, [0.7643502479448135, 1.0]], [1, [2.710348763676679, 1.0]], [1, [0.22045501961496472, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.85833306]
bas 1, expnt(s) = [7617.03969826]
bas 2, expnt(s) = [3617.52268883]
bas 3, expnt(s) = [1586.9478161]
bas 4, expnt(s) = [420.71710266]
bas 5, expnt(s) = [173.28716762]
bas 6, expnt(s) = [89.64668846]
bas 7, expnt(s) = [34.36438472]
bas 8, expnt(s) = [7.78176797]
bas 9, expnt(s) = [0.65501224]
bas 10, expnt(s) = [3.09906664]
bas 11, expnt(s) = [0.23690636]
bas 12, expnt(s) = [1362.85008443]
bas 13, expnt(s) = [664.0995595]
bas 14, expnt(s) = [297.91915622]
bas 15, expnt(s) = [311.42012462]
bas 16, expnt(s) = [63.17410518]
bas 17, expnt(s) = [7.10687723]
bas 18, expnt(s) = [20.01818263]
bas 19, expnt(s) = [0.76435025]
bas 20, expnt(s) = [2.71034876]
bas 21, expnt(s) = [0.22045502]
CPU time:       538.96
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828583e+04 5.20029303e+03 7.61703970e+03 2.05994056e+03
 3.61752269e+03 1.17848341e+03 1.58694782e+03 6.35238788e+02
 4.20717103e+02 2.34697060e+02 1.73287168e+02 1.20667364e+02
 8.96466885e+01 7.36064229e+01 3.43643847e+01 3.58588579e+01
 7.78176797e+00 1.17712811e+01 6.55012245e-01 1.83950973e+00
 3.09906664e+00 5.90117115e+00 2.36906363e-01 8.57921533e-01
 1.36285008e+03 2.41570834e+04 6.64099560e+02 9.83503439e+03
 2.97919156e+02 3.61083322e+03 3.11420125e+02 3.81652169e+03
 6.31741052e+01 5.19586988e+02 7.10687723e+00 3.38518891e+01
 2.00181826e+01 1.23527941e+02 7.64350248e-01 2.08497046e+00
 2.71034876e+00 1.01453227e+01 2.20455020e-01 4.40691204e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99407273555383
cond(S) = 108959.00858199238
E1 = -729.5458663698589  E_coul = 203.17669909249705
init E= -526.369167277362
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.55586644731696  LUMO = 0.978670773075322
  mo_energy =
[-1.18336224e+02 -1.22063897e+01 -9.44681488e+00 -9.44681488e+00
 -9.44681488e+00 -1.24014883e+00 -5.55866447e-01 -5.55866447e-01
 -5.55866447e-01  9.78670773e-01  1.01410467e+00  1.01410467e+00
  1.01410467e+00  7.07077144e+00  7.07077144e+00  7.07077144e+00
  1.17458882e+01  3.24333143e+01  3.24333143e+01  3.24333143e+01
  8.92653836e+01  1.28775603e+02  1.28775603e+02  1.28775603e+02
  3.64693797e+02  4.84104756e+02  4.84104756e+02  4.84104756e+02
  1.08360848e+03  1.33095363e+03  1.33095363e+03  1.33095363e+03
  3.01741636e+03  3.01741636e+03  3.01741636e+03  3.30020191e+03
  6.63254197e+03  6.63254197e+03  6.63254197e+03  9.71414908e+03
  2.60428195e+04  7.67431067e+04]
E1 = -727.8453312943457  E_coul = 201.08981954064447
cycle= 1 E= -526.755511753701  delta_E= -0.386  |g|= 0.187  |ddm|= 0.308
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587426
diis-c [-0.34506977  1.        ]
  HOMO = -0.591213471818134  LUMO = 0.950816731022052
  mo_energy =
[-1.18645735e+02 -1.23450404e+01 -9.59629923e+00 -9.59629923e+00
 -9.59629923e+00 -1.28003685e+00 -5.91213472e-01 -5.91213472e-01
 -5.91213472e-01  9.50816731e-01  9.89959010e-01  9.89959010e-01
  9.89959010e-01  6.98123070e+00  6.98123070e+00  6.98123070e+00
  1.16390627e+01  3.22791954e+01  3.22791954e+01  3.22791954e+01
  8.90628580e+01  1.28544426e+02  1.28544426e+02  1.28544426e+02
  3.64412729e+02  4.83797009e+02  4.83797009e+02  4.83797009e+02
  1.08324108e+03  1.33058978e+03  1.33058978e+03  1.33058978e+03
  3.01698708e+03  3.01698708e+03  3.01698708e+03  3.29970742e+03
  6.63200013e+03  6.63200013e+03  6.63200013e+03  9.71353726e+03
  2.60421113e+04  7.67423072e+04]
E1 = -728.4250684296824  E_coul = 201.6688258459824
cycle= 2 E= -526.7562425837  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.0535
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076802
diis-c [-0.00391279  0.0708852   0.9291148 ]
  HOMO = -0.581875569215022  LUMO = 0.958921996564604
  mo_energy =
[-1.18576588e+02 -1.23061258e+01 -9.55569257e+00 -9.55569257e+00
 -9.55569257e+00 -1.26885554e+00 -5.81875569e-01 -5.81875569e-01
 -5.81875569e-01  9.58921997e-01  9.96704139e-01  9.96704139e-01
  9.96704139e-01  7.00499850e+00  7.00499850e+00  7.00499850e+00
  1.16687909e+01  3.23199064e+01  3.23199064e+01  3.23199064e+01
  8.91162606e+01  1.28601752e+02  1.28601752e+02  1.28601752e+02
  3.64478400e+02  4.83865337e+02  4.83865337e+02  4.83865337e+02
  1.08331300e+03  1.33066220e+03  1.33066220e+03  1.33066220e+03
  3.01706180e+03  3.01706180e+03  3.01706180e+03  3.29978311e+03
  6.63207664e+03  6.63207664e+03  6.63207664e+03  9.71361452e+03
  2.60421892e+04  7.67423855e+04]
E1 = -728.2708203113528  E_coul = 201.51451787061873
cycle= 3 E= -526.756302440734  delta_E= -5.99e-05  |g|= 0.00692  |ddm|= 0.0166
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0145594
diis-c [-7.39833747e-07 -1.21637999e-03  1.55319812e-01  8.45896568e-01]
  HOMO = -0.58351734587804  LUMO = 0.957594367909935
  mo_energy =
[-1.18587547e+02 -1.23125059e+01 -9.56244491e+00 -9.56244491e+00
 -9.56244491e+00 -1.27071353e+00 -5.83517346e-01 -5.83517346e-01
 -5.83517346e-01  9.57594368e-01  9.95542752e-01  9.95542752e-01
  9.95542752e-01  7.00094724e+00  7.00094724e+00  7.00094724e+00
  1.16638782e+01  3.23131733e+01  3.23131733e+01  3.23131733e+01
  8.91076808e+01  1.28592541e+02  1.28592541e+02  1.28592541e+02
  3.64467969e+02  4.83854505e+02  4.83854505e+02  4.83854505e+02
  1.08330157e+03  1.33065072e+03  1.33065072e+03  1.33065072e+03
  3.01704990e+03  3.01704990e+03  3.01704990e+03  3.29977098e+03
  6.63206433e+03  6.63206433e+03  6.63206433e+03  9.71360200e+03
  2.60421765e+04  7.67423726e+04]
E1 = -728.295941147542  E_coul = 201.53963638664706
cycle= 4 E= -526.756304760895  delta_E= -2.32e-06  |g|= 0.000103  |ddm|= 0.00247
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000109711
diis-c [-4.65540768e-09  7.63174555e-05 -1.12968116e-02 -6.57068897e-02
  1.07692738e+00]
  HOMO = -0.583497638366111  LUMO = 0.957629553133118
  mo_energy =
[-1.18587496e+02 -1.23124348e+01 -9.56238741e+00 -9.56238741e+00
 -9.56238741e+00 -1.27066989e+00 -5.83497638e-01 -5.83497638e-01
 -5.83497638e-01  9.57629553e-01  9.95559430e-01  9.95559430e-01
  9.95559430e-01  7.00099225e+00  7.00099225e+00  7.00099225e+00
  1.16639422e+01  3.23132288e+01  3.23132288e+01  3.23132288e+01
  8.91077428e+01  1.28592598e+02  1.28592598e+02  1.28592598e+02
  3.64468022e+02  4.83854556e+02  4.83854556e+02  4.83854556e+02
  1.08330162e+03  1.33065076e+03  1.33065076e+03  1.33065076e+03
  3.01704993e+03  3.01704993e+03  3.01704993e+03  3.29977100e+03
  6.63206435e+03  6.63206435e+03  6.63206435e+03  9.71360201e+03
  2.60421765e+04  7.67423726e+04]
E1 = -728.2957000482781  E_coul = 201.53939528548375
cycle= 5 E= -526.756304762794  delta_E= -1.9e-09  |g|= 2.13e-05  |ddm|= 0.000167
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=4.00522e-05
diis-c [-8.44890592e-11  1.31282976e-05 -1.93226182e-03 -1.31419518e-02
  3.39626009e-02  9.81098484e-01]
  HOMO = -0.583505330531493  LUMO = 0.957625702380943
  mo_energy =
[-1.18587527e+02 -1.23124580e+01 -9.56241260e+00 -9.56241260e+00
 -9.56241260e+00 -1.27067592e+00 -5.83505331e-01 -5.83505331e-01
 -5.83505331e-01  9.57625702e-01  9.95554448e-01  9.95554448e-01
  9.95554448e-01  7.00097549e+00  7.00097549e+00  7.00097549e+00
  1.16639239e+01  3.23132044e+01  3.23132044e+01  3.23132044e+01
  8.91077153e+01  1.28592569e+02  1.28592569e+02  1.28592569e+02
  3.64467991e+02  4.83854525e+02  4.83854525e+02  4.83854525e+02
  1.08330158e+03  1.33065073e+03  1.33065073e+03  1.33065073e+03
  3.01704990e+03  3.01704990e+03  3.01704990e+03  3.29977097e+03
  6.63206431e+03  6.63206431e+03  6.63206431e+03  9.71360197e+03
  2.60421765e+04  7.67423726e+04]
E1 = -728.2957838259019  E_coul = 201.53947906304344
cycle= 6 E= -526.756304762858  delta_E= -6.41e-11  |g|= 1.81e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2957838259019  E_coul = 201.53947906304344
  HOMO = -0.583505285201723  LUMO = 0.957626098264847
  mo_energy =
[-1.18587527e+02 -1.23124576e+01 -9.56241231e+00 -9.56241231e+00
 -9.56241231e+00 -1.27067546e+00 -5.83505285e-01 -5.83505285e-01
 -5.83505285e-01  9.57626098e-01  9.95554537e-01  9.95554537e-01
  9.95554537e-01  7.00097569e+00  7.00097569e+00  7.00097569e+00
  1.16639243e+01  3.23132047e+01  3.23132047e+01  3.23132047e+01
  8.91077158e+01  1.28592569e+02  1.28592569e+02  1.28592569e+02
  3.64467992e+02  4.83854525e+02  4.83854525e+02  4.83854525e+02
  1.08330158e+03  1.33065073e+03  1.33065073e+03  1.33065073e+03
  3.01704990e+03  3.01704990e+03  3.01704990e+03  3.29977097e+03
  6.63206431e+03  6.63206431e+03  6.63206431e+03  9.71360197e+03
  2.60421765e+04  7.67423726e+04]
E1 = -728.2957819634676  E_coul = 201.53947720060947
Extra cycle  E= -526.756304762858  delta_E= 3.41e-13  |g|= 3.76e-07  |ddm|= 3.19e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
exp = [2.61828583e+04 7.61703970e+03 3.61752269e+03 1.58694782e+03
 4.20717103e+02 1.73287168e+02 8.96466885e+01 3.43643847e+01
 7.78176797e+00 6.55012245e-01 3.09906664e+00 2.36906363e-01
 1.36285008e+03 6.64099560e+02 2.97919156e+02 3.11420125e+02
 6.31741052e+01 7.10687723e+00 2.00181826e+01 7.64350248e-01
 2.71034876e+00 2.20455020e-01]
E = -526.7563047628581
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:31 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8583331        1
[INPUT] 0    0    [1    /1   ]  7617.03969826        1
[INPUT] 0    0    [1    /1   ]  3617.52268883        1
[INPUT] 0    0    [1    /1   ]  1586.9478161         1
[INPUT] 0    0    [1    /1   ]  420.717102663        1
[INPUT] 0    0    [1    /1   ]  173.28716762         1
[INPUT] 0    0    [1    /1   ]  89.6466884597        1
[INPUT] 0    0    [1    /1   ]  34.3643847189        1
[INPUT] 0    0    [1    /1   ]  7.78176796945        1
[INPUT] 0    0    [1    /1   ]  0.655012244977       1
[INPUT] 0    0    [1    /1   ]  3.09906664278        1
[INPUT] 0    0    [1    /1   ]  0.236906363159       1
[INPUT] 1    0    [1    /1   ]  1362.85008443        1
[INPUT] 1    0    [1    /1   ]  664.099559501        1
[INPUT] 1    0    [1    /1   ]  297.919156225        1
[INPUT] 1    0    [1    /1   ]  311.420124617        1
[INPUT] 1    0    [1    /1   ]  63.1741051767        1
[INPUT] 1    0    [1    /1   ]  7.10687723381        1
[INPUT] 1    0    [1    /1   ]  20.0181826294        1
[INPUT] 1    0    [1    /1   ]  0.764350247945       1
[INPUT] 1    0    [1    /1   ]  2.71034876368        1
[INPUT] 1    0    [1    /1   ]  0.220455019615       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.858333063818, 1.0]], [0, [7617.039698255571, 1.0]], [0, [3617.5226888295633, 1.0]], [0, [1586.9478160970932, 1.0]], [0, [420.71710266281383, 1.0]], [0, [173.28716762027167, 1.0]], [0, [89.64668845971488, 1.0]], [0, [34.36438471892009, 1.0]], [0, [7.781767969451684, 1.0]], [0, [0.6550122449767748, 1.0]], [0, [3.0990666427758504, 1.0]], [0, [0.23690636315905686, 1.0]], [1, [1362.850084430252, 1.0]], [1, [664.0995595010422, 1.0]], [1, [297.9191562245878, 1.0]], [1, [311.42012461725653, 1.0]], [1, [63.17410517665228, 1.0]], [1, [7.106877233805649, 1.0]], [1, [20.01818262940534, 1.0]], [1, [0.7643502479448135, 1.0]], [1, [2.710348763676679, 1.0]], [1, [0.22045501961496472, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.85833306]
bas 1, expnt(s) = [7617.03969826]
bas 2, expnt(s) = [3617.52268883]
bas 3, expnt(s) = [1586.9478161]
bas 4, expnt(s) = [420.71710266]
bas 5, expnt(s) = [173.28716762]
bas 6, expnt(s) = [89.64668846]
bas 7, expnt(s) = [34.36438472]
bas 8, expnt(s) = [7.78176797]
bas 9, expnt(s) = [0.65501224]
bas 10, expnt(s) = [3.09906664]
bas 11, expnt(s) = [0.23690636]
bas 12, expnt(s) = [1362.85008443]
bas 13, expnt(s) = [664.0995595]
bas 14, expnt(s) = [297.91915622]
bas 15, expnt(s) = [311.42012462]
bas 16, expnt(s) = [63.17410518]
bas 17, expnt(s) = [7.10687723]
bas 18, expnt(s) = [20.01818263]
bas 19, expnt(s) = [0.76435025]
bas 20, expnt(s) = [2.71034876]
bas 21, expnt(s) = [0.22045502]
CPU time:       539.47
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828583e+04 5.20029303e+03 7.61703970e+03 2.05994056e+03
 3.61752269e+03 1.17848341e+03 1.58694782e+03 6.35238788e+02
 4.20717103e+02 2.34697060e+02 1.73287168e+02 1.20667364e+02
 8.96466885e+01 7.36064229e+01 3.43643847e+01 3.58588579e+01
 7.78176797e+00 1.17712811e+01 6.55012245e-01 1.83950973e+00
 3.09906664e+00 5.90117115e+00 2.36906363e-01 8.57921533e-01
 1.36285008e+03 2.41570834e+04 6.64099560e+02 9.83503439e+03
 2.97919156e+02 3.61083322e+03 3.11420125e+02 3.81652169e+03
 6.31741052e+01 5.19586988e+02 7.10687723e+00 3.38518891e+01
 2.00181826e+01 1.23527941e+02 7.64350248e-01 2.08497046e+00
 2.71034876e+00 1.01453227e+01 2.20455020e-01 4.40691204e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99407273555383
cond(S) = 108959.00858199238
E1 = -729.5458663698589  E_coul = 203.17669909249705
init E= -526.369167277362
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.55586644731696  LUMO = 0.978670773075322
  mo_energy =
[-1.18336224e+02 -1.22063897e+01 -9.44681488e+00 -9.44681488e+00
 -9.44681488e+00 -1.24014883e+00 -5.55866447e-01 -5.55866447e-01
 -5.55866447e-01  9.78670773e-01  1.01410467e+00  1.01410467e+00
  1.01410467e+00  7.07077144e+00  7.07077144e+00  7.07077144e+00
  1.17458882e+01  3.24333143e+01  3.24333143e+01  3.24333143e+01
  8.92653836e+01  1.28775603e+02  1.28775603e+02  1.28775603e+02
  3.64693797e+02  4.84104756e+02  4.84104756e+02  4.84104756e+02
  1.08360848e+03  1.33095363e+03  1.33095363e+03  1.33095363e+03
  3.01741636e+03  3.01741636e+03  3.01741636e+03  3.30020191e+03
  6.63254197e+03  6.63254197e+03  6.63254197e+03  9.71414908e+03
  2.60428195e+04  7.67431067e+04]
E1 = -727.8453312943457  E_coul = 201.08981954064447
cycle= 1 E= -526.755511753701  delta_E= -0.386  |g|= 0.187  |ddm|= 0.308
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587426
diis-c [-0.34506977  1.        ]
  HOMO = -0.591213471818134  LUMO = 0.950816731022052
  mo_energy =
[-1.18645735e+02 -1.23450404e+01 -9.59629923e+00 -9.59629923e+00
 -9.59629923e+00 -1.28003685e+00 -5.91213472e-01 -5.91213472e-01
 -5.91213472e-01  9.50816731e-01  9.89959010e-01  9.89959010e-01
  9.89959010e-01  6.98123070e+00  6.98123070e+00  6.98123070e+00
  1.16390627e+01  3.22791954e+01  3.22791954e+01  3.22791954e+01
  8.90628580e+01  1.28544426e+02  1.28544426e+02  1.28544426e+02
  3.64412729e+02  4.83797009e+02  4.83797009e+02  4.83797009e+02
  1.08324108e+03  1.33058978e+03  1.33058978e+03  1.33058978e+03
  3.01698708e+03  3.01698708e+03  3.01698708e+03  3.29970742e+03
  6.63200013e+03  6.63200013e+03  6.63200013e+03  9.71353726e+03
  2.60421113e+04  7.67423072e+04]
E1 = -728.4250684296824  E_coul = 201.6688258459824
cycle= 2 E= -526.7562425837  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.0535
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076802
diis-c [-0.00391279  0.0708852   0.9291148 ]
  HOMO = -0.581875569215022  LUMO = 0.958921996564604
  mo_energy =
[-1.18576588e+02 -1.23061258e+01 -9.55569257e+00 -9.55569257e+00
 -9.55569257e+00 -1.26885554e+00 -5.81875569e-01 -5.81875569e-01
 -5.81875569e-01  9.58921997e-01  9.96704139e-01  9.96704139e-01
  9.96704139e-01  7.00499850e+00  7.00499850e+00  7.00499850e+00
  1.16687909e+01  3.23199064e+01  3.23199064e+01  3.23199064e+01
  8.91162606e+01  1.28601752e+02  1.28601752e+02  1.28601752e+02
  3.64478400e+02  4.83865337e+02  4.83865337e+02  4.83865337e+02
  1.08331300e+03  1.33066220e+03  1.33066220e+03  1.33066220e+03
  3.01706180e+03  3.01706180e+03  3.01706180e+03  3.29978311e+03
  6.63207664e+03  6.63207664e+03  6.63207664e+03  9.71361452e+03
  2.60421892e+04  7.67423855e+04]
E1 = -728.2708203113528  E_coul = 201.51451787061873
cycle= 3 E= -526.756302440734  delta_E= -5.99e-05  |g|= 0.00692  |ddm|= 0.0166
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0145594
diis-c [-7.39833747e-07 -1.21637999e-03  1.55319812e-01  8.45896568e-01]
  HOMO = -0.58351734587804  LUMO = 0.957594367909935
  mo_energy =
[-1.18587547e+02 -1.23125059e+01 -9.56244491e+00 -9.56244491e+00
 -9.56244491e+00 -1.27071353e+00 -5.83517346e-01 -5.83517346e-01
 -5.83517346e-01  9.57594368e-01  9.95542752e-01  9.95542752e-01
  9.95542752e-01  7.00094724e+00  7.00094724e+00  7.00094724e+00
  1.16638782e+01  3.23131733e+01  3.23131733e+01  3.23131733e+01
  8.91076808e+01  1.28592541e+02  1.28592541e+02  1.28592541e+02
  3.64467969e+02  4.83854505e+02  4.83854505e+02  4.83854505e+02
  1.08330157e+03  1.33065072e+03  1.33065072e+03  1.33065072e+03
  3.01704990e+03  3.01704990e+03  3.01704990e+03  3.29977098e+03
  6.63206433e+03  6.63206433e+03  6.63206433e+03  9.71360200e+03
  2.60421765e+04  7.67423726e+04]
E1 = -728.295941147542  E_coul = 201.53963638664706
cycle= 4 E= -526.756304760895  delta_E= -2.32e-06  |g|= 0.000103  |ddm|= 0.00247
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000109711
diis-c [-4.65540768e-09  7.63174555e-05 -1.12968116e-02 -6.57068897e-02
  1.07692738e+00]
  HOMO = -0.583497638366111  LUMO = 0.957629553133118
  mo_energy =
[-1.18587496e+02 -1.23124348e+01 -9.56238741e+00 -9.56238741e+00
 -9.56238741e+00 -1.27066989e+00 -5.83497638e-01 -5.83497638e-01
 -5.83497638e-01  9.57629553e-01  9.95559430e-01  9.95559430e-01
  9.95559430e-01  7.00099225e+00  7.00099225e+00  7.00099225e+00
  1.16639422e+01  3.23132288e+01  3.23132288e+01  3.23132288e+01
  8.91077428e+01  1.28592598e+02  1.28592598e+02  1.28592598e+02
  3.64468022e+02  4.83854556e+02  4.83854556e+02  4.83854556e+02
  1.08330162e+03  1.33065076e+03  1.33065076e+03  1.33065076e+03
  3.01704993e+03  3.01704993e+03  3.01704993e+03  3.29977100e+03
  6.63206435e+03  6.63206435e+03  6.63206435e+03  9.71360201e+03
  2.60421765e+04  7.67423726e+04]
E1 = -728.2957000482781  E_coul = 201.53939528548375
cycle= 5 E= -526.756304762794  delta_E= -1.9e-09  |g|= 2.13e-05  |ddm|= 0.000167
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.00522e-05
diis-c [-8.44890592e-11  1.31282976e-05 -1.93226182e-03 -1.31419518e-02
  3.39626009e-02  9.81098484e-01]
  HOMO = -0.583505330531493  LUMO = 0.957625702380943
  mo_energy =
[-1.18587527e+02 -1.23124580e+01 -9.56241260e+00 -9.56241260e+00
 -9.56241260e+00 -1.27067592e+00 -5.83505331e-01 -5.83505331e-01
 -5.83505331e-01  9.57625702e-01  9.95554448e-01  9.95554448e-01
  9.95554448e-01  7.00097549e+00  7.00097549e+00  7.00097549e+00
  1.16639239e+01  3.23132044e+01  3.23132044e+01  3.23132044e+01
  8.91077153e+01  1.28592569e+02  1.28592569e+02  1.28592569e+02
  3.64467991e+02  4.83854525e+02  4.83854525e+02  4.83854525e+02
  1.08330158e+03  1.33065073e+03  1.33065073e+03  1.33065073e+03
  3.01704990e+03  3.01704990e+03  3.01704990e+03  3.29977097e+03
  6.63206431e+03  6.63206431e+03  6.63206431e+03  9.71360197e+03
  2.60421765e+04  7.67423726e+04]
E1 = -728.2957838259019  E_coul = 201.53947906304344
cycle= 6 E= -526.756304762858  delta_E= -6.41e-11  |g|= 1.81e-06  |ddm|= 1.98e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2957838259019  E_coul = 201.53947906304344
  HOMO = -0.583505285201723  LUMO = 0.957626098264847
  mo_energy =
[-1.18587527e+02 -1.23124576e+01 -9.56241231e+00 -9.56241231e+00
 -9.56241231e+00 -1.27067546e+00 -5.83505285e-01 -5.83505285e-01
 -5.83505285e-01  9.57626098e-01  9.95554537e-01  9.95554537e-01
  9.95554537e-01  7.00097569e+00  7.00097569e+00  7.00097569e+00
  1.16639243e+01  3.23132047e+01  3.23132047e+01  3.23132047e+01
  8.91077158e+01  1.28592569e+02  1.28592569e+02  1.28592569e+02
  3.64467992e+02  4.83854525e+02  4.83854525e+02  4.83854525e+02
  1.08330158e+03  1.33065073e+03  1.33065073e+03  1.33065073e+03
  3.01704990e+03  3.01704990e+03  3.01704990e+03  3.29977097e+03
  6.63206431e+03  6.63206431e+03  6.63206431e+03  9.71360197e+03
  2.60421765e+04  7.67423726e+04]
E1 = -728.2957819634676  E_coul = 201.53947720060947
Extra cycle  E= -526.756304762858  delta_E= 3.41e-13  |g|= 3.76e-07  |ddm|= 3.19e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 108959.00858199238
E1 = -728.2957819634676  E_coul = 201.53947720060947
init E= -526.756304762858
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583505334808141  LUMO = 0.957626130707702
  mo_energy =
[-1.18587527e+02 -1.23124578e+01 -9.56241246e+00 -9.56241246e+00
 -9.56241246e+00 -1.27067544e+00 -5.83505335e-01 -5.83505335e-01
 -5.83505335e-01  9.57626131e-01  9.95554514e-01  9.95554514e-01
  9.95554514e-01  7.00097560e+00  7.00097560e+00  7.00097560e+00
  1.16639242e+01  3.23132046e+01  3.23132046e+01  3.23132046e+01
  8.91077156e+01  1.28592569e+02  1.28592569e+02  1.28592569e+02
  3.64467992e+02  4.83854525e+02  4.83854525e+02  4.83854525e+02
  1.08330158e+03  1.33065073e+03  1.33065073e+03  1.33065073e+03
  3.01704990e+03  3.01704990e+03  3.01704990e+03  3.29977097e+03
  6.63206431e+03  6.63206431e+03  6.63206431e+03  9.71360197e+03
  2.60421765e+04  7.67423726e+04]
E1 = -728.2957823636211  E_coul = 201.53947760076213
cycle= 1 E= -526.756304762859  delta_E= -9.09e-13  |g|= 8.23e-08  |ddm|= 6.1e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2957823636211  E_coul = 201.53947760076213
  HOMO = -0.58350532994604  LUMO = 0.957626149954591
  mo_energy =
[-1.18587527e+02 -1.23124577e+01 -9.56241244e+00 -9.56241244e+00
 -9.56241244e+00 -1.27067542e+00 -5.83505330e-01 -5.83505330e-01
 -5.83505330e-01  9.57626150e-01  9.95554520e-01  9.95554520e-01
  9.95554520e-01  7.00097561e+00  7.00097561e+00  7.00097561e+00
  1.16639242e+01  3.23132046e+01  3.23132046e+01  3.23132046e+01
  8.91077156e+01  1.28592569e+02  1.28592569e+02  1.28592569e+02
  3.64467992e+02  4.83854525e+02  4.83854525e+02  4.83854525e+02
  1.08330158e+03  1.33065073e+03  1.33065073e+03  1.33065073e+03
  3.01704990e+03  3.01704990e+03  3.01704990e+03  3.29977097e+03
  6.63206431e+03  6.63206431e+03  6.63206431e+03  9.71360197e+03
  2.60421765e+04  7.67423726e+04]
E1 = -728.2957822248342  E_coul = 201.53947746197497
Extra cycle  E= -526.756304762859  delta_E= -1.14e-13  |g|= 1.71e-08  |ddm|= 1.34e-07
    CPU time for scf_cycle      0.91 sec, wall time      0.42 sec
exp = [2.61828583e+04 7.61703970e+03 3.61752269e+03 1.58694782e+03
 4.20717103e+02 1.73287168e+02 8.96466885e+01 3.43643847e+01
 7.78176797e+00 6.55012245e-01 3.09906664e+00 2.36906363e-01
 1.36285008e+03 6.64099560e+02 2.97919156e+02 3.11420125e+02
 6.31741052e+01 7.10687723e+00 2.00181826e+01 7.64350248e-01
 2.71034876e+00 2.20455020e-01]
grad_E = [-1.47810218e-06  2.89007223e-06 -2.08486027e-06  6.19828967e-05
 -3.00003043e-04  9.54831495e-05  6.54819593e-05  4.49188945e-04
 -6.23616731e-04  3.54477845e-04  3.61351664e-04 -2.33947206e-03
 -6.45559119e-07  2.83745229e-06  1.13032258e-05  9.68618194e-06
  7.34068309e-04 -1.13225414e-04 -1.95476764e-03 -1.52853564e-03
 -8.77339308e-04  5.45355501e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:36 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8404777        1
[INPUT] 0    0    [1    /1   ]  7617.08250147        1
[INPUT] 0    0    [1    /1   ]  3617.50778225        1
[INPUT] 0    0    [1    /1   ]  1587.91877155        1
[INPUT] 0    0    [1    /1   ]  417.075367439        1
[INPUT] 0    0    [1    /1   ]  168.379910865        1
[INPUT] 0    0    [1    /1   ]  84.9343840527        1
[INPUT] 0    0    [1    /1   ]  32.7995188814        1
[INPUT] 0    0    [1    /1   ]  7.74845825349        1
[INPUT] 0    0    [1    /1   ]  0.657662422867       1
[INPUT] 0    0    [1    /1   ]  3.07882348971        1
[INPUT] 0    0    [1    /1   ]  0.236421585638       1
[INPUT] 1    0    [1    /1   ]  1362.84419824        1
[INPUT] 1    0    [1    /1   ]  664.156471283        1
[INPUT] 1    0    [1    /1   ]  298.187251513        1
[INPUT] 1    0    [1    /1   ]  311.651142263        1
[INPUT] 1    0    [1    /1   ]  63.0016337921        1
[INPUT] 1    0    [1    /1   ]  7.19328782177        1
[INPUT] 1    0    [1    /1   ]  20.1352663632        1
[INPUT] 1    0    [1    /1   ]  0.769206858038       1
[INPUT] 1    0    [1    /1   ]  2.75643413601        1
[INPUT] 1    0    [1    /1   ]  0.221281746388       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.840477704594, 1.0]], [0, [7617.082501473188, 1.0]], [0, [3617.5077822466465, 1.0]], [0, [1587.9187715486964, 1.0]], [0, [417.07536743943064, 1.0]], [0, [168.3799108654985, 1.0]], [0, [84.93438405267875, 1.0]], [0, [32.79951888139201, 1.0]], [0, [7.748458253485568, 1.0]], [0, [0.6576624228672576, 1.0]], [0, [3.078823489711472, 1.0]], [0, [0.23642158563771704, 1.0]], [1, [1362.8441982417407, 1.0]], [1, [664.1564712827118, 1.0]], [1, [298.18725151278704, 1.0]], [1, [311.65114226297703, 1.0]], [1, [63.0016337921095, 1.0]], [1, [7.193287821774497, 1.0]], [1, [20.135266363168633, 1.0]], [1, [0.7692068580383895, 1.0]], [1, [2.7564341360078295, 1.0]], [1, [0.2212817463881435, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.8404777]
bas 1, expnt(s) = [7617.08250147]
bas 2, expnt(s) = [3617.50778225]
bas 3, expnt(s) = [1587.91877155]
bas 4, expnt(s) = [417.07536744]
bas 5, expnt(s) = [168.37991087]
bas 6, expnt(s) = [84.93438405]
bas 7, expnt(s) = [32.79951888]
bas 8, expnt(s) = [7.74845825]
bas 9, expnt(s) = [0.65766242]
bas 10, expnt(s) = [3.07882349]
bas 11, expnt(s) = [0.23642159]
bas 12, expnt(s) = [1362.84419824]
bas 13, expnt(s) = [664.15647128]
bas 14, expnt(s) = [298.18725151]
bas 15, expnt(s) = [311.65114226]
bas 16, expnt(s) = [63.00163379]
bas 17, expnt(s) = [7.19328782]
bas 18, expnt(s) = [20.13526636]
bas 19, expnt(s) = [0.76920686]
bas 20, expnt(s) = [2.75643414]
bas 21, expnt(s) = [0.22128175]
CPU time:       545.05
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828405e+04 5.20029037e+03 7.61708250e+03 2.05994924e+03
 3.61750778e+03 1.17847976e+03 1.58791877e+03 6.35530264e+02
 4.17075367e+02 2.33171749e+02 1.68379911e+02 1.18095332e+02
 8.49343841e+01 7.06850681e+01 3.27995189e+01 3.46270608e+01
 7.74845825e+00 1.17334708e+01 6.57662423e-01 1.84508890e+00
 3.07882349e+00 5.87223758e+00 2.36421586e-01 8.56604534e-01
 1.36284420e+03 2.41569530e+04 6.64156471e+02 9.83608795e+03
 2.98187252e+02 3.61489538e+03 3.11651142e+02 3.82006099e+03
 6.30016338e+01 5.17814440e+02 7.19328782e+00 3.43671636e+01
 2.01352664e+01 1.24431723e+02 7.69206858e-01 2.10154322e+00
 2.75643414e+00 1.03614114e+01 2.21281746e-01 4.42757963e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993935714571023
cond(S) = 109512.71998963234
E1 = -729.5472128923086  E_coul = 203.17699678175205
init E= -526.370216110557
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555821747034176  LUMO = 0.979200679327368
  mo_energy =
[-1.18336289e+02 -1.22062351e+01 -9.44688815e+00 -9.44688815e+00
 -9.44688815e+00 -1.24012711e+00 -5.55821747e-01 -5.55821747e-01
 -5.55821747e-01  9.79200679e-01  1.02164398e+00  1.02164398e+00
  1.02164398e+00  7.19265736e+00  7.19265736e+00  7.19265736e+00
  1.16111326e+01  3.28997916e+01  3.28997916e+01  3.28997916e+01
  8.52818777e+01  1.29411829e+02  1.29411829e+02  1.29411829e+02
  3.48171513e+02  4.84588993e+02  4.84588993e+02  4.84588993e+02
  1.04870838e+03  1.33180761e+03  1.33180761e+03  1.33180761e+03
  3.01892102e+03  3.01892102e+03  3.01892102e+03  3.25096186e+03
  6.63448384e+03  6.63448384e+03  6.63448384e+03  9.66257559e+03
  2.59929763e+04  7.66964963e+04]
E1 = -727.8448600857131  E_coul = 201.0891061797591
cycle= 1 E= -526.755753905954  delta_E= -0.386  |g|= 0.187  |ddm|= 0.307
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.58762
diis-c [-0.34529678  1.        ]
  HOMO = -0.591227894411258  LUMO = 0.951345221619997
  mo_energy =
[-1.18646071e+02 -1.23448408e+01 -9.59639497e+00 -9.59639497e+00
 -9.59639497e+00 -1.28004910e+00 -5.91227894e-01 -5.91227894e-01
 -5.91227894e-01  9.51345222e-01  9.97246947e-01  9.97246947e-01
  9.97246947e-01  7.10218134e+00  7.10218134e+00  7.10218134e+00
  1.15051412e+01  3.27450385e+01  3.27450385e+01  3.27450385e+01
  8.50827753e+01  1.29180763e+02  1.29180763e+02  1.29180763e+02
  3.47893305e+02  4.84280806e+02  4.84280806e+02  4.84280806e+02
  1.04834200e+03  1.33144312e+03  1.33144312e+03  1.33144312e+03
  3.01849086e+03  3.01849086e+03  3.01849086e+03  3.25046628e+03
  6.63394078e+03  6.63394078e+03  6.63394078e+03  9.66196203e+03
  2.59922663e+04  7.66956951e+04]
E1 = -728.4246861809103  E_coul = 201.66819959080428
cycle= 2 E= -526.756486590106  delta_E= -0.000733  |g|= 0.038  |ddm|= 0.0535
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0770806
diis-c [-0.00392118  0.07143289  0.92856711]
  HOMO = -0.581904650971696  LUMO = 0.959441452727085
  mo_energy =
[-1.18576916e+02 -1.23059437e+01 -9.55580549e+00 -9.55580549e+00
 -9.55580549e+00 -1.26888071e+00 -5.81904651e-01 -5.81904651e-01
 -5.81904651e-01  9.59441453e-01  1.00404539e+00  1.00404539e+00
  1.00404539e+00  7.12616073e+00  7.12616073e+00  7.12616073e+00
  1.15346134e+01  3.27858563e+01  3.27858563e+01  3.27858563e+01
  8.51354374e+01  1.29238062e+02  1.29238062e+02  1.29238062e+02
  3.47958593e+02  4.84349131e+02  4.84349131e+02  4.84349131e+02
  1.04841382e+03  1.33151554e+03  1.33151554e+03  1.33151554e+03
  3.01856558e+03  3.01856558e+03  3.01856558e+03  3.25054196e+03
  6.63401729e+03  6.63401729e+03  6.63401729e+03  9.66203929e+03
  2.59923442e+04  7.66957733e+04]
E1 = -728.2705699361331  E_coul = 201.51402342151457
cycle= 3 E= -526.756546514619  delta_E= -5.99e-05  |g|= 0.0069  |ddm|= 0.0166
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0145473
diis-c [-7.67795926e-07 -1.22968730e-03  1.54659065e-01  8.46570622e-01]
  HOMO = -0.583540270115029  LUMO = 0.95812083455122
  mo_energy =
[-1.18587833e+02 -1.23122985e+01 -9.56253271e+00 -9.56253271e+00
 -9.56253271e+00 -1.27072954e+00 -5.83540270e-01 -5.83540270e-01
 -5.83540270e-01  9.58120835e-01  1.00287793e+00  1.00287793e+00
  1.00287793e+00  7.12208635e+00  7.12208635e+00  7.12208635e+00
  1.15297566e+01  3.27791295e+01  3.27791295e+01  3.27791295e+01
  8.51269998e+01  1.29228890e+02  1.29228890e+02  1.29228890e+02
  3.47948259e+02  4.84338341e+02  4.84338341e+02  4.84338341e+02
  1.04840246e+03  1.33150411e+03  1.33150411e+03  1.33150411e+03
  3.01855373e+03  3.01855373e+03  3.01855373e+03  3.25052987e+03
  6.63400502e+03  6.63400502e+03  6.63400502e+03  9.66202681e+03
  2.59923316e+04  7.66957605e+04]
E1 = -728.295577165749  E_coul = 201.5390283487083
cycle= 4 E= -526.756548817041  delta_E= -2.3e-06  |g|= 0.000105  |ddm|= 0.00246
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000112059
diis-c [-4.78466268e-09  7.79005926e-05 -1.14624390e-02 -6.69764708e-02
  1.07836101e+00]
  HOMO = -0.583520507331133  LUMO = 0.958156537776443
  mo_energy =
[-1.18587782e+02 -1.23122270e+01 -9.56247488e+00 -9.56247488e+00
 -9.56247488e+00 -1.27068531e+00 -5.83520507e-01 -5.83520507e-01
 -5.83520507e-01  9.58156538e-01  1.00289483e+00  1.00289483e+00
  1.00289483e+00  7.12213186e+00  7.12213186e+00  7.12213186e+00
  1.15298210e+01  3.27791853e+01  3.27791853e+01  3.27791853e+01
  8.51270624e+01  1.29228947e+02  1.29228947e+02  1.29228947e+02
  3.47948313e+02  4.84338392e+02  4.84338392e+02  4.84338392e+02
  1.04840250e+03  1.33150415e+03  1.33150415e+03  1.33150415e+03
  3.01855376e+03  3.01855376e+03  3.01855376e+03  3.25052990e+03
  6.63400504e+03  6.63400504e+03  6.63400504e+03  9.66202682e+03
  2.59923316e+04  7.66957605e+04]
E1 = -728.2953335017445  E_coul = 201.53878468271296
cycle= 5 E= -526.756548819032  delta_E= -1.99e-09  |g|= 2.15e-05  |ddm|= 0.00017
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=4.05187e-05
diis-c [-8.84337464e-11  1.31149460e-05 -1.91162831e-03 -1.31112149e-02
  3.35050824e-02  9.81504646e-01]
  HOMO = -0.583528315968419  LUMO = 0.95815263452267
  mo_energy =
[-1.18587814e+02 -1.23122505e+01 -9.56250043e+00 -9.56250043e+00
 -9.56250043e+00 -1.27069142e+00 -5.83528316e-01 -5.83528316e-01
 -5.83528316e-01  9.58152635e-01  1.00288973e+00  1.00288973e+00
  1.00288973e+00  7.12211471e+00  7.12211471e+00  7.12211471e+00
  1.15298026e+01  3.27791606e+01  3.27791606e+01  3.27791606e+01
  8.51270348e+01  1.29228918e+02  1.29228918e+02  1.29228918e+02
  3.47948282e+02  4.84338360e+02  4.84338360e+02  4.84338360e+02
  1.04840247e+03  1.33150412e+03  1.33150412e+03  1.33150412e+03
  3.01855372e+03  3.01855372e+03  3.01855372e+03  3.25052986e+03
  6.63400501e+03  6.63400501e+03  6.63400501e+03  9.66202678e+03
  2.59923315e+04  7.66957605e+04]
E1 = -728.2954183209904  E_coul = 201.53886950189323
cycle= 6 E= -526.756548819097  delta_E= -6.56e-11  |g|= 1.84e-06  |ddm|= 2.01e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2954183209904  E_coul = 201.53886950189323
  HOMO = -0.583528257875519  LUMO = 0.958153045170685
  mo_energy =
[-1.18587814e+02 -1.23122501e+01 -9.56250009e+00 -9.56250009e+00
 -9.56250009e+00 -1.27069094e+00 -5.83528258e-01 -5.83528258e-01
 -5.83528258e-01  9.58153045e-01  1.00288982e+00  1.00288982e+00
  1.00288982e+00  7.12211495e+00  7.12211495e+00  7.12211495e+00
  1.15298030e+01  3.27791609e+01  3.27791609e+01  3.27791609e+01
  8.51270352e+01  1.29228918e+02  1.29228918e+02  1.29228918e+02
  3.47948282e+02  4.84338361e+02  4.84338361e+02  4.84338361e+02
  1.04840247e+03  1.33150412e+03  1.33150412e+03  1.33150412e+03
  3.01855372e+03  3.01855372e+03  3.01855372e+03  3.25052986e+03
  6.63400501e+03  6.63400501e+03  6.63400501e+03  9.66202678e+03
  2.59923315e+04  7.66957605e+04]
E1 = -728.2954162582072  E_coul = 201.53886743910957
Extra cycle  E= -526.756548819098  delta_E= -4.55e-13  |g|= 3.82e-07  |ddm|= 3.22e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
exp = [2.61828405e+04 7.61708250e+03 3.61750778e+03 1.58791877e+03
 4.17075367e+02 1.68379911e+02 8.49343841e+01 3.27995189e+01
 7.74845825e+00 6.57662423e-01 3.07882349e+00 2.36421586e-01
 1.36284420e+03 6.64156471e+02 2.98187252e+02 3.11651142e+02
 6.30016338e+01 7.19328782e+00 2.01352664e+01 7.69206858e-01
 2.75643414e+00 2.21281746e-01]
E = -526.7565488190976
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:36 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8404777        1
[INPUT] 0    0    [1    /1   ]  7617.08250147        1
[INPUT] 0    0    [1    /1   ]  3617.50778225        1
[INPUT] 0    0    [1    /1   ]  1587.91877155        1
[INPUT] 0    0    [1    /1   ]  417.075367439        1
[INPUT] 0    0    [1    /1   ]  168.379910865        1
[INPUT] 0    0    [1    /1   ]  84.9343840527        1
[INPUT] 0    0    [1    /1   ]  32.7995188814        1
[INPUT] 0    0    [1    /1   ]  7.74845825349        1
[INPUT] 0    0    [1    /1   ]  0.657662422867       1
[INPUT] 0    0    [1    /1   ]  3.07882348971        1
[INPUT] 0    0    [1    /1   ]  0.236421585638       1
[INPUT] 1    0    [1    /1   ]  1362.84419824        1
[INPUT] 1    0    [1    /1   ]  664.156471283        1
[INPUT] 1    0    [1    /1   ]  298.187251513        1
[INPUT] 1    0    [1    /1   ]  311.651142263        1
[INPUT] 1    0    [1    /1   ]  63.0016337921        1
[INPUT] 1    0    [1    /1   ]  7.19328782177        1
[INPUT] 1    0    [1    /1   ]  20.1352663632        1
[INPUT] 1    0    [1    /1   ]  0.769206858038       1
[INPUT] 1    0    [1    /1   ]  2.75643413601        1
[INPUT] 1    0    [1    /1   ]  0.221281746388       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.840477704594, 1.0]], [0, [7617.082501473188, 1.0]], [0, [3617.5077822466465, 1.0]], [0, [1587.9187715486964, 1.0]], [0, [417.07536743943064, 1.0]], [0, [168.3799108654985, 1.0]], [0, [84.93438405267875, 1.0]], [0, [32.79951888139201, 1.0]], [0, [7.748458253485568, 1.0]], [0, [0.6576624228672576, 1.0]], [0, [3.078823489711472, 1.0]], [0, [0.23642158563771704, 1.0]], [1, [1362.8441982417407, 1.0]], [1, [664.1564712827118, 1.0]], [1, [298.18725151278704, 1.0]], [1, [311.65114226297703, 1.0]], [1, [63.0016337921095, 1.0]], [1, [7.193287821774497, 1.0]], [1, [20.135266363168633, 1.0]], [1, [0.7692068580383895, 1.0]], [1, [2.7564341360078295, 1.0]], [1, [0.2212817463881435, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.8404777]
bas 1, expnt(s) = [7617.08250147]
bas 2, expnt(s) = [3617.50778225]
bas 3, expnt(s) = [1587.91877155]
bas 4, expnt(s) = [417.07536744]
bas 5, expnt(s) = [168.37991087]
bas 6, expnt(s) = [84.93438405]
bas 7, expnt(s) = [32.79951888]
bas 8, expnt(s) = [7.74845825]
bas 9, expnt(s) = [0.65766242]
bas 10, expnt(s) = [3.07882349]
bas 11, expnt(s) = [0.23642159]
bas 12, expnt(s) = [1362.84419824]
bas 13, expnt(s) = [664.15647128]
bas 14, expnt(s) = [298.18725151]
bas 15, expnt(s) = [311.65114226]
bas 16, expnt(s) = [63.00163379]
bas 17, expnt(s) = [7.19328782]
bas 18, expnt(s) = [20.13526636]
bas 19, expnt(s) = [0.76920686]
bas 20, expnt(s) = [2.75643414]
bas 21, expnt(s) = [0.22128175]
CPU time:       545.56
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828405e+04 5.20029037e+03 7.61708250e+03 2.05994924e+03
 3.61750778e+03 1.17847976e+03 1.58791877e+03 6.35530264e+02
 4.17075367e+02 2.33171749e+02 1.68379911e+02 1.18095332e+02
 8.49343841e+01 7.06850681e+01 3.27995189e+01 3.46270608e+01
 7.74845825e+00 1.17334708e+01 6.57662423e-01 1.84508890e+00
 3.07882349e+00 5.87223758e+00 2.36421586e-01 8.56604534e-01
 1.36284420e+03 2.41569530e+04 6.64156471e+02 9.83608795e+03
 2.98187252e+02 3.61489538e+03 3.11651142e+02 3.82006099e+03
 6.30016338e+01 5.17814440e+02 7.19328782e+00 3.43671636e+01
 2.01352664e+01 1.24431723e+02 7.69206858e-01 2.10154322e+00
 2.75643414e+00 1.03614114e+01 2.21281746e-01 4.42757963e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993935714571023
cond(S) = 109512.71998963234
E1 = -729.5472128923086  E_coul = 203.17699678175205
init E= -526.370216110557
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555821747034176  LUMO = 0.979200679327368
  mo_energy =
[-1.18336289e+02 -1.22062351e+01 -9.44688815e+00 -9.44688815e+00
 -9.44688815e+00 -1.24012711e+00 -5.55821747e-01 -5.55821747e-01
 -5.55821747e-01  9.79200679e-01  1.02164398e+00  1.02164398e+00
  1.02164398e+00  7.19265736e+00  7.19265736e+00  7.19265736e+00
  1.16111326e+01  3.28997916e+01  3.28997916e+01  3.28997916e+01
  8.52818777e+01  1.29411829e+02  1.29411829e+02  1.29411829e+02
  3.48171513e+02  4.84588993e+02  4.84588993e+02  4.84588993e+02
  1.04870838e+03  1.33180761e+03  1.33180761e+03  1.33180761e+03
  3.01892102e+03  3.01892102e+03  3.01892102e+03  3.25096186e+03
  6.63448384e+03  6.63448384e+03  6.63448384e+03  9.66257559e+03
  2.59929763e+04  7.66964963e+04]
E1 = -727.8448600857131  E_coul = 201.0891061797591
cycle= 1 E= -526.755753905954  delta_E= -0.386  |g|= 0.187  |ddm|= 0.307
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.58762
diis-c [-0.34529678  1.        ]
  HOMO = -0.591227894411258  LUMO = 0.951345221619997
  mo_energy =
[-1.18646071e+02 -1.23448408e+01 -9.59639497e+00 -9.59639497e+00
 -9.59639497e+00 -1.28004910e+00 -5.91227894e-01 -5.91227894e-01
 -5.91227894e-01  9.51345222e-01  9.97246947e-01  9.97246947e-01
  9.97246947e-01  7.10218134e+00  7.10218134e+00  7.10218134e+00
  1.15051412e+01  3.27450385e+01  3.27450385e+01  3.27450385e+01
  8.50827753e+01  1.29180763e+02  1.29180763e+02  1.29180763e+02
  3.47893305e+02  4.84280806e+02  4.84280806e+02  4.84280806e+02
  1.04834200e+03  1.33144312e+03  1.33144312e+03  1.33144312e+03
  3.01849086e+03  3.01849086e+03  3.01849086e+03  3.25046628e+03
  6.63394078e+03  6.63394078e+03  6.63394078e+03  9.66196203e+03
  2.59922663e+04  7.66956951e+04]
E1 = -728.4246861809103  E_coul = 201.66819959080428
cycle= 2 E= -526.756486590106  delta_E= -0.000733  |g|= 0.038  |ddm|= 0.0535
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0770806
diis-c [-0.00392118  0.07143289  0.92856711]
  HOMO = -0.581904650971696  LUMO = 0.959441452727085
  mo_energy =
[-1.18576916e+02 -1.23059437e+01 -9.55580549e+00 -9.55580549e+00
 -9.55580549e+00 -1.26888071e+00 -5.81904651e-01 -5.81904651e-01
 -5.81904651e-01  9.59441453e-01  1.00404539e+00  1.00404539e+00
  1.00404539e+00  7.12616073e+00  7.12616073e+00  7.12616073e+00
  1.15346134e+01  3.27858563e+01  3.27858563e+01  3.27858563e+01
  8.51354374e+01  1.29238062e+02  1.29238062e+02  1.29238062e+02
  3.47958593e+02  4.84349131e+02  4.84349131e+02  4.84349131e+02
  1.04841382e+03  1.33151554e+03  1.33151554e+03  1.33151554e+03
  3.01856558e+03  3.01856558e+03  3.01856558e+03  3.25054196e+03
  6.63401729e+03  6.63401729e+03  6.63401729e+03  9.66203929e+03
  2.59923442e+04  7.66957733e+04]
E1 = -728.2705699361331  E_coul = 201.51402342151457
cycle= 3 E= -526.756546514619  delta_E= -5.99e-05  |g|= 0.0069  |ddm|= 0.0166
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0145473
diis-c [-7.67795926e-07 -1.22968730e-03  1.54659065e-01  8.46570622e-01]
  HOMO = -0.583540270115029  LUMO = 0.95812083455122
  mo_energy =
[-1.18587833e+02 -1.23122985e+01 -9.56253271e+00 -9.56253271e+00
 -9.56253271e+00 -1.27072954e+00 -5.83540270e-01 -5.83540270e-01
 -5.83540270e-01  9.58120835e-01  1.00287793e+00  1.00287793e+00
  1.00287793e+00  7.12208635e+00  7.12208635e+00  7.12208635e+00
  1.15297566e+01  3.27791295e+01  3.27791295e+01  3.27791295e+01
  8.51269998e+01  1.29228890e+02  1.29228890e+02  1.29228890e+02
  3.47948259e+02  4.84338341e+02  4.84338341e+02  4.84338341e+02
  1.04840246e+03  1.33150411e+03  1.33150411e+03  1.33150411e+03
  3.01855373e+03  3.01855373e+03  3.01855373e+03  3.25052987e+03
  6.63400502e+03  6.63400502e+03  6.63400502e+03  9.66202681e+03
  2.59923316e+04  7.66957605e+04]
E1 = -728.295577165749  E_coul = 201.5390283487083
cycle= 4 E= -526.756548817041  delta_E= -2.3e-06  |g|= 0.000105  |ddm|= 0.00246
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000112059
diis-c [-4.78466268e-09  7.79005926e-05 -1.14624390e-02 -6.69764708e-02
  1.07836101e+00]
  HOMO = -0.583520507331133  LUMO = 0.958156537776443
  mo_energy =
[-1.18587782e+02 -1.23122270e+01 -9.56247488e+00 -9.56247488e+00
 -9.56247488e+00 -1.27068531e+00 -5.83520507e-01 -5.83520507e-01
 -5.83520507e-01  9.58156538e-01  1.00289483e+00  1.00289483e+00
  1.00289483e+00  7.12213186e+00  7.12213186e+00  7.12213186e+00
  1.15298210e+01  3.27791853e+01  3.27791853e+01  3.27791853e+01
  8.51270624e+01  1.29228947e+02  1.29228947e+02  1.29228947e+02
  3.47948313e+02  4.84338392e+02  4.84338392e+02  4.84338392e+02
  1.04840250e+03  1.33150415e+03  1.33150415e+03  1.33150415e+03
  3.01855376e+03  3.01855376e+03  3.01855376e+03  3.25052990e+03
  6.63400504e+03  6.63400504e+03  6.63400504e+03  9.66202682e+03
  2.59923316e+04  7.66957605e+04]
E1 = -728.2953335017445  E_coul = 201.53878468271296
cycle= 5 E= -526.756548819032  delta_E= -1.99e-09  |g|= 2.15e-05  |ddm|= 0.00017
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=4.05187e-05
diis-c [-8.84337464e-11  1.31149460e-05 -1.91162831e-03 -1.31112149e-02
  3.35050824e-02  9.81504646e-01]
  HOMO = -0.583528315968419  LUMO = 0.95815263452267
  mo_energy =
[-1.18587814e+02 -1.23122505e+01 -9.56250043e+00 -9.56250043e+00
 -9.56250043e+00 -1.27069142e+00 -5.83528316e-01 -5.83528316e-01
 -5.83528316e-01  9.58152635e-01  1.00288973e+00  1.00288973e+00
  1.00288973e+00  7.12211471e+00  7.12211471e+00  7.12211471e+00
  1.15298026e+01  3.27791606e+01  3.27791606e+01  3.27791606e+01
  8.51270348e+01  1.29228918e+02  1.29228918e+02  1.29228918e+02
  3.47948282e+02  4.84338360e+02  4.84338360e+02  4.84338360e+02
  1.04840247e+03  1.33150412e+03  1.33150412e+03  1.33150412e+03
  3.01855372e+03  3.01855372e+03  3.01855372e+03  3.25052986e+03
  6.63400501e+03  6.63400501e+03  6.63400501e+03  9.66202678e+03
  2.59923315e+04  7.66957605e+04]
E1 = -728.2954183209904  E_coul = 201.53886950189323
cycle= 6 E= -526.756548819097  delta_E= -6.56e-11  |g|= 1.84e-06  |ddm|= 2.01e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2954183209904  E_coul = 201.53886950189323
  HOMO = -0.583528257875519  LUMO = 0.958153045170685
  mo_energy =
[-1.18587814e+02 -1.23122501e+01 -9.56250009e+00 -9.56250009e+00
 -9.56250009e+00 -1.27069094e+00 -5.83528258e-01 -5.83528258e-01
 -5.83528258e-01  9.58153045e-01  1.00288982e+00  1.00288982e+00
  1.00288982e+00  7.12211495e+00  7.12211495e+00  7.12211495e+00
  1.15298030e+01  3.27791609e+01  3.27791609e+01  3.27791609e+01
  8.51270352e+01  1.29228918e+02  1.29228918e+02  1.29228918e+02
  3.47948282e+02  4.84338361e+02  4.84338361e+02  4.84338361e+02
  1.04840247e+03  1.33150412e+03  1.33150412e+03  1.33150412e+03
  3.01855372e+03  3.01855372e+03  3.01855372e+03  3.25052986e+03
  6.63400501e+03  6.63400501e+03  6.63400501e+03  9.66202678e+03
  2.59923315e+04  7.66957605e+04]
E1 = -728.2954162582072  E_coul = 201.53886743910957
Extra cycle  E= -526.756548819098  delta_E= -4.55e-13  |g|= 3.82e-07  |ddm|= 3.22e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 109512.71998963234
E1 = -728.2954162582072  E_coul = 201.53886743910957
init E= -526.756548819098
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583528311732095  LUMO = 0.958153074842588
  mo_energy =
[-1.18587814e+02 -1.23122502e+01 -9.56250026e+00 -9.56250026e+00
 -9.56250026e+00 -1.27069092e+00 -5.83528312e-01 -5.83528312e-01
 -5.83528312e-01  9.58153075e-01  1.00288980e+00  1.00288980e+00
  1.00288980e+00  7.12211484e+00  7.12211484e+00  7.12211484e+00
  1.15298029e+01  3.27791608e+01  3.27791608e+01  3.27791608e+01
  8.51270350e+01  1.29228918e+02  1.29228918e+02  1.29228918e+02
  3.47948282e+02  4.84338361e+02  4.84338361e+02  4.84338361e+02
  1.04840247e+03  1.33150412e+03  1.33150412e+03  1.33150412e+03
  3.01855372e+03  3.01855372e+03  3.01855372e+03  3.25052986e+03
  6.63400501e+03  6.63400501e+03  6.63400501e+03  9.66202678e+03
  2.59923315e+04  7.66957605e+04]
E1 = -728.2954167103984  E_coul = 201.53886789130067
cycle= 1 E= -526.756548819098  delta_E= -1.14e-13  |g|= 8.43e-08  |ddm|= 6.13e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2954167103984  E_coul = 201.53886789130067
  HOMO = -0.583528305953761  LUMO = 0.958153095016298
  mo_energy =
[-1.18587814e+02 -1.23122502e+01 -9.56250023e+00 -9.56250023e+00
 -9.56250023e+00 -1.27069090e+00 -5.83528306e-01 -5.83528306e-01
 -5.83528306e-01  9.58153095e-01  1.00288981e+00  1.00288981e+00
  1.00288981e+00  7.12211486e+00  7.12211486e+00  7.12211486e+00
  1.15298029e+01  3.27791608e+01  3.27791608e+01  3.27791608e+01
  8.51270351e+01  1.29228918e+02  1.29228918e+02  1.29228918e+02
  3.47948282e+02  4.84338361e+02  4.84338361e+02  4.84338361e+02
  1.04840247e+03  1.33150412e+03  1.33150412e+03  1.33150412e+03
  3.01855372e+03  3.01855372e+03  3.01855372e+03  3.25052986e+03
  6.63400501e+03  6.63400501e+03  6.63400501e+03  9.66202678e+03
  2.59923315e+04  7.66957605e+04]
E1 = -728.2954165561565  E_coul = 201.53886773705932
Extra cycle  E= -526.756548819097  delta_E= 5.68e-13  |g|= 1.76e-08  |ddm|= 1.36e-07
    CPU time for scf_cycle      0.91 sec, wall time      0.43 sec
exp = [2.61828405e+04 7.61708250e+03 3.61750778e+03 1.58791877e+03
 4.17075367e+02 1.68379911e+02 8.49343841e+01 3.27995189e+01
 7.74845825e+00 6.57662423e-01 3.07882349e+00 2.36421586e-01
 1.36284420e+03 6.64156471e+02 2.98187252e+02 3.11651142e+02
 6.30016338e+01 7.19328782e+00 2.01352664e+01 7.69206858e-01
 2.75643414e+00 2.21281746e-01]
grad_E = [-1.48986111e-06  3.00958718e-06 -2.01274967e-06  6.55296201e-05
 -3.21137784e-04  8.05090490e-05  2.61249177e-04 -5.32467197e-04
 -9.78572706e-04  2.42959601e-03  2.17463169e-03 -6.21648311e-03
 -6.32166180e-07  3.17181151e-06  1.32456787e-05  1.13379001e-05
  5.71520851e-04 -4.95580971e-04 -1.47101299e-03  2.52709649e-05
  5.36468751e-04  8.99328096e-05]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:40 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8472017        1
[INPUT] 0    0    [1    /1   ]  7617.06643243        1
[INPUT] 0    0    [1    /1   ]  3617.51343238        1
[INPUT] 0    0    [1    /1   ]  1587.55540739        1
[INPUT] 0    0    [1    /1   ]  418.375022047        1
[INPUT] 0    0    [1    /1   ]  170.529288896        1
[INPUT] 0    0    [1    /1   ]  86.4468037627        1
[INPUT] 0    0    [1    /1   ]  33.2294167091        1
[INPUT] 0    0    [1    /1   ]  7.9556608341         1
[INPUT] 0    0    [1    /1   ]  0.659157610836       1
[INPUT] 0    0    [1    /1   ]  3.13499480676        1
[INPUT] 0    0    [1    /1   ]  0.238360671225       1
[INPUT] 1    0    [1    /1   ]  1362.84642019        1
[INPUT] 1    0    [1    /1   ]  664.135074028        1
[INPUT] 1    0    [1    /1   ]  298.086530131        1
[INPUT] 1    0    [1    /1   ]  311.564346094        1
[INPUT] 1    0    [1    /1   ]  63.0363610715        1
[INPUT] 1    0    [1    /1   ]  7.20180563749        1
[INPUT] 1    0    [1    /1   ]  20.1713594803        1
[INPUT] 1    0    [1    /1   ]  0.7693321087         1
[INPUT] 1    0    [1    /1   ]  2.75524263319        1
[INPUT] 1    0    [1    /1   ]  0.221245016359       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.84720172997, 1.0]], [0, [7617.066432428728, 1.0]], [0, [3617.5134323784823, 1.0]], [0, [1587.5554073859746, 1.0]], [0, [418.37502204719493, 1.0]], [0, [170.52928889556975, 1.0]], [0, [86.44680376268535, 1.0]], [0, [33.2294167090883, 1.0]], [0, [7.955660834102612, 1.0]], [0, [0.6591576108358417, 1.0]], [0, [3.1349948067631974, 1.0]], [0, [0.2383606712252344, 1.0]], [1, [1362.846420191318, 1.0]], [1, [664.1350740282286, 1.0]], [1, [298.08653013051975, 1.0]], [1, [311.564346094319, 1.0]], [1, [63.036361071463745, 1.0]], [1, [7.201805637491631, 1.0]], [1, [20.17135948027044, 1.0]], [1, [0.7693321086999725, 1.0]], [1, [2.7552426331940856, 1.0]], [1, [0.22124501635935426, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.84720173]
bas 1, expnt(s) = [7617.06643243]
bas 2, expnt(s) = [3617.51343238]
bas 3, expnt(s) = [1587.55540739]
bas 4, expnt(s) = [418.37502205]
bas 5, expnt(s) = [170.5292889]
bas 6, expnt(s) = [86.44680376]
bas 7, expnt(s) = [33.22941671]
bas 8, expnt(s) = [7.95566083]
bas 9, expnt(s) = [0.65915761]
bas 10, expnt(s) = [3.13499481]
bas 11, expnt(s) = [0.23836067]
bas 12, expnt(s) = [1362.84642019]
bas 13, expnt(s) = [664.13507403]
bas 14, expnt(s) = [298.08653013]
bas 15, expnt(s) = [311.56434609]
bas 16, expnt(s) = [63.03636107]
bas 17, expnt(s) = [7.20180564]
bas 18, expnt(s) = [20.17135948]
bas 19, expnt(s) = [0.76933211]
bas 20, expnt(s) = [2.75524263]
bas 21, expnt(s) = [0.22124502]
CPU time:       551.08
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828472e+04 5.20029137e+03 7.61706643e+03 2.05994598e+03
 3.61751343e+03 1.17848115e+03 1.58755541e+03 6.35421189e+02
 4.18375022e+02 2.33716479e+02 1.70529289e+02 1.19224157e+02
 8.64468038e+01 7.16269947e+01 3.32294167e+01 3.49668945e+01
 7.95566083e+00 1.19680176e+01 6.59157611e-01 1.84823409e+00
 3.13499481e+00 5.95240734e+00 2.38360671e-01 8.61868432e-01
 1.36284642e+03 2.41570022e+04 6.64135074e+02 9.83569184e+03
 2.98086530e+02 3.61336915e+03 3.11564346e+02 3.81873115e+03
 6.30363611e+01 5.18171247e+02 7.20180564e+00 3.44180402e+01
 2.01713595e+01 1.24710596e+02 7.69332109e-01 2.10197098e+00
 2.75524263e+00 1.03558131e+01 2.21245016e-01 4.42666099e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993913860975702
cond(S) = 109483.59488734062
E1 = -729.5489814282669  E_coul = 203.17781765612213
init E= -526.371163772145
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555824518249251  LUMO = 0.990248149394333
  mo_energy =
[-1.18336255e+02 -1.22061461e+01 -9.44681500e+00 -9.44681500e+00
 -9.44681500e+00 -1.24011982e+00 -5.55824518e-01 -5.55824518e-01
 -5.55824518e-01  9.90248149e-01  1.02159470e+00  1.02159470e+00
  1.02159470e+00  7.19308832e+00  7.19308832e+00  7.19308832e+00
  1.19880488e+01  3.29395478e+01  3.29395478e+01  3.29395478e+01
  8.74477773e+01  1.29567220e+02  1.29567220e+02  1.29567220e+02
  3.54631393e+02  4.84759297e+02  4.84759297e+02  4.84759297e+02
  1.06199027e+03  1.33178783e+03  1.33178783e+03  1.33178783e+03
  3.01862898e+03  3.01862898e+03  3.01862898e+03  3.26966905e+03
  6.63400095e+03  6.63400095e+03  6.63400095e+03  9.68213114e+03
  2.60118636e+04  7.67141551e+04]
E1 = -727.8469843468824  E_coul = 201.09109224898305
cycle= 1 E= -526.755892097899  delta_E= -0.385  |g|= 0.187  |ddm|= 0.303
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587533
diis-c [-0.34519481  1.        ]
  HOMO = -0.591190420087298  LUMO = 0.962088578799657
  mo_energy =
[-1.18645640e+02 -1.23447644e+01 -9.59629903e+00 -9.59629903e+00
 -9.59629903e+00 -1.28003163e+00 -5.91190420e-01 -5.91190420e-01
 -5.91190420e-01  9.62088579e-01  9.97222507e-01  9.97222507e-01
  9.97222507e-01  7.10261779e+00  7.10261779e+00  7.10261779e+00
  1.18805110e+01  3.27847960e+01  3.27847960e+01  3.27847960e+01
  8.72474403e+01  1.29336292e+02  1.29336292e+02  1.29336292e+02
  3.54352441e+02  4.84451537e+02  4.84451537e+02  4.84451537e+02
  1.06162374e+03  1.33142386e+03  1.33142386e+03  1.33142386e+03
  3.01819941e+03  3.01819941e+03  3.01819941e+03  3.26917413e+03
  6.63345861e+03  6.63345861e+03  6.63345861e+03  9.68151849e+03
  2.60111546e+04  7.67133549e+04]
E1 = -728.4262961100471  E_coul = 201.66967322047535
cycle= 2 E= -526.756622889572  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.0536
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.076966
diis-c [-0.00391986  0.07117387  0.92882613]
  HOMO = -0.58186690531971  LUMO = 0.970265767491838
  mo_energy =
[-1.18576546e+02 -1.23058893e+01 -9.55573548e+00 -9.55573548e+00
 -9.55573548e+00 -1.26886598e+00 -5.81866905e-01 -5.81866905e-01
 -5.81866905e-01  9.70265767e-01  1.00401976e+00  1.00401976e+00
  1.00401976e+00  7.12659263e+00  7.12659263e+00  7.12659263e+00
  1.19103989e+01  3.28256127e+01  3.28256127e+01  3.28256127e+01
  8.73003200e+01  1.29393553e+02  1.29393553e+02  1.29393553e+02
  3.54417797e+02  4.84519799e+02  4.84519799e+02  4.84519799e+02
  1.06169553e+03  1.33149621e+03  1.33149621e+03  1.33149621e+03
  3.01827406e+03  3.01827406e+03  3.01827406e+03  3.26924975e+03
  6.63353506e+03  6.63353506e+03  6.63353506e+03  9.68159568e+03
  2.60112324e+04  7.67134330e+04]
E1 = -728.2722989981922  E_coul = 201.5156163221963
cycle= 3 E= -526.756682675996  delta_E= -5.98e-05  |g|= 0.0069  |ddm|= 0.0166
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0145539
diis-c [-7.51522627e-07 -1.22411441e-03  1.54949981e-01  8.46274133e-01]
  HOMO = -0.583502833593317  LUMO = 0.968929373960008
  mo_energy =
[-1.18587470e+02 -1.23122475e+01 -9.56246554e+00 -9.56246554e+00
 -9.56246554e+00 -1.27071718e+00 -5.83502834e-01 -5.83502834e-01
 -5.83502834e-01  9.68929374e-01  1.00285183e+00  1.00285183e+00
  1.00285183e+00  7.12251596e+00  7.12251596e+00  7.12251596e+00
  1.19054716e+01  3.28188789e+01  3.28188789e+01  3.28188789e+01
  8.72918373e+01  1.29384374e+02  1.29384374e+02  1.29384374e+02
  3.54407438e+02  4.84509002e+02  4.84509002e+02  4.84509002e+02
  1.06168416e+03  1.33148477e+03  1.33148477e+03  1.33148477e+03
  3.01826220e+03  3.01826220e+03  3.01826220e+03  3.26923766e+03
  6.63352278e+03  6.63352278e+03  6.63352278e+03  9.68158320e+03
  2.60112197e+04  7.67134202e+04]
E1 = -728.2973219178584  E_coul = 201.5406369372239
cycle= 4 E= -526.756684980635  delta_E= -2.3e-06  |g|= 0.000103  |ddm|= 0.00247
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000110676
diis-c [-4.65819377e-09  7.66975695e-05 -1.13206320e-02 -6.60696788e-02
  1.07731361e+00]
  HOMO = -0.583483205518811  LUMO = 0.968964760860297
  mo_energy =
[-1.18587420e+02 -1.23121767e+01 -9.56240834e+00 -9.56240834e+00
 -9.56240834e+00 -1.27067365e+00 -5.83483206e-01 -5.83483206e-01
 -5.83483206e-01  9.68964761e-01  1.00286857e+00  1.00286857e+00
  1.00286857e+00  7.12256101e+00  7.12256101e+00  7.12256101e+00
  1.19055355e+01  3.28189340e+01  3.28189340e+01  3.28189340e+01
  8.72918990e+01  1.29384430e+02  1.29384430e+02  1.29384430e+02
  3.54407490e+02  4.84509053e+02  4.84509053e+02  4.84509053e+02
  1.06168420e+03  1.33148482e+03  1.33148482e+03  1.33148482e+03
  3.01826224e+03  3.01826224e+03  3.01826224e+03  3.26923768e+03
  6.63352280e+03  6.63352280e+03  6.63352280e+03  9.68158321e+03
  2.60112197e+04  7.67134202e+04]
E1 = -728.2970821609053  E_coul = 201.54039717837895
cycle= 5 E= -526.756684982526  delta_E= -1.89e-09  |g|= 2.12e-05  |ddm|= 0.000166
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.00344e-05
diis-c [-8.49912526e-11  1.29913435e-05 -1.90406271e-03 -1.30198427e-02
  3.44135554e-02  9.80497359e-01]
  HOMO = -0.583490892267493  LUMO = 0.968960851205447
  mo_energy =
[-1.18587452e+02 -1.23121999e+01 -9.56243352e+00 -9.56243352e+00
 -9.56243352e+00 -1.27067969e+00 -5.83490892e-01 -5.83490892e-01
 -5.83490892e-01  9.68960851e-01  1.00286354e+00  1.00286354e+00
  1.00286354e+00  7.12254411e+00  7.12254411e+00  7.12254411e+00
  1.19055171e+01  3.28189096e+01  3.28189096e+01  3.28189096e+01
  8.72918716e+01  1.29384402e+02  1.29384402e+02  1.29384402e+02
  3.54407460e+02  4.84509022e+02  4.84509022e+02  4.84509022e+02
  1.06168417e+03  1.33148478e+03  1.33148478e+03  1.33148478e+03
  3.01826220e+03  3.01826220e+03  3.01826220e+03  3.26923765e+03
  6.63352276e+03  6.63352276e+03  6.63352276e+03  9.68158317e+03
  2.60112197e+04  7.67134202e+04]
E1 = -728.2971659526307  E_coul = 201.54048097004105
cycle= 6 E= -526.75668498259  delta_E= -6.33e-11  |g|= 1.82e-06  |ddm|= 1.96e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2971659526307  E_coul = 201.54048097004105
  HOMO = -0.583490841006223  LUMO = 0.968961255271807
  mo_energy =
[-1.18587451e+02 -1.23121995e+01 -9.56243322e+00 -9.56243322e+00
 -9.56243322e+00 -1.27067923e+00 -5.83490841e-01 -5.83490841e-01
 -5.83490841e-01  9.68961255e-01  1.00286364e+00  1.00286364e+00
  1.00286364e+00  7.12254432e+00  7.12254432e+00  7.12254432e+00
  1.19055175e+01  3.28189100e+01  3.28189100e+01  3.28189100e+01
  8.72918721e+01  1.29384402e+02  1.29384402e+02  1.29384402e+02
  3.54407460e+02  4.84509022e+02  4.84509022e+02  4.84509022e+02
  1.06168417e+03  1.33148478e+03  1.33148478e+03  1.33148478e+03
  3.01826220e+03  3.01826220e+03  3.01826220e+03  3.26923765e+03
  6.63352276e+03  6.63352276e+03  6.63352276e+03  9.68158317e+03
  2.60112197e+04  7.67134202e+04]
E1 = -728.2971640283904  E_coul = 201.54047904579994
Extra cycle  E= -526.756684982591  delta_E= -7.96e-13  |g|= 3.77e-07  |ddm|= 3.19e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
exp = [2.61828472e+04 7.61706643e+03 3.61751343e+03 1.58755541e+03
 4.18375022e+02 1.70529289e+02 8.64468038e+01 3.32294167e+01
 7.95566083e+00 6.59157611e-01 3.13499481e+00 2.38360671e-01
 1.36284642e+03 6.64135074e+02 2.98086530e+02 3.11564346e+02
 6.30363611e+01 7.20180564e+00 2.01713595e+01 7.69332109e-01
 2.75524263e+00 2.21245016e-01]
E = -526.7566849825905
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:41 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8472017        1
[INPUT] 0    0    [1    /1   ]  7617.06643243        1
[INPUT] 0    0    [1    /1   ]  3617.51343238        1
[INPUT] 0    0    [1    /1   ]  1587.55540739        1
[INPUT] 0    0    [1    /1   ]  418.375022047        1
[INPUT] 0    0    [1    /1   ]  170.529288896        1
[INPUT] 0    0    [1    /1   ]  86.4468037627        1
[INPUT] 0    0    [1    /1   ]  33.2294167091        1
[INPUT] 0    0    [1    /1   ]  7.9556608341         1
[INPUT] 0    0    [1    /1   ]  0.659157610836       1
[INPUT] 0    0    [1    /1   ]  3.13499480676        1
[INPUT] 0    0    [1    /1   ]  0.238360671225       1
[INPUT] 1    0    [1    /1   ]  1362.84642019        1
[INPUT] 1    0    [1    /1   ]  664.135074028        1
[INPUT] 1    0    [1    /1   ]  298.086530131        1
[INPUT] 1    0    [1    /1   ]  311.564346094        1
[INPUT] 1    0    [1    /1   ]  63.0363610715        1
[INPUT] 1    0    [1    /1   ]  7.20180563749        1
[INPUT] 1    0    [1    /1   ]  20.1713594803        1
[INPUT] 1    0    [1    /1   ]  0.7693321087         1
[INPUT] 1    0    [1    /1   ]  2.75524263319        1
[INPUT] 1    0    [1    /1   ]  0.221245016359       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.84720172997, 1.0]], [0, [7617.066432428728, 1.0]], [0, [3617.5134323784823, 1.0]], [0, [1587.5554073859746, 1.0]], [0, [418.37502204719493, 1.0]], [0, [170.52928889556975, 1.0]], [0, [86.44680376268535, 1.0]], [0, [33.2294167090883, 1.0]], [0, [7.955660834102612, 1.0]], [0, [0.6591576108358417, 1.0]], [0, [3.1349948067631974, 1.0]], [0, [0.2383606712252344, 1.0]], [1, [1362.846420191318, 1.0]], [1, [664.1350740282286, 1.0]], [1, [298.08653013051975, 1.0]], [1, [311.564346094319, 1.0]], [1, [63.036361071463745, 1.0]], [1, [7.201805637491631, 1.0]], [1, [20.17135948027044, 1.0]], [1, [0.7693321086999725, 1.0]], [1, [2.7552426331940856, 1.0]], [1, [0.22124501635935426, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.84720173]
bas 1, expnt(s) = [7617.06643243]
bas 2, expnt(s) = [3617.51343238]
bas 3, expnt(s) = [1587.55540739]
bas 4, expnt(s) = [418.37502205]
bas 5, expnt(s) = [170.5292889]
bas 6, expnt(s) = [86.44680376]
bas 7, expnt(s) = [33.22941671]
bas 8, expnt(s) = [7.95566083]
bas 9, expnt(s) = [0.65915761]
bas 10, expnt(s) = [3.13499481]
bas 11, expnt(s) = [0.23836067]
bas 12, expnt(s) = [1362.84642019]
bas 13, expnt(s) = [664.13507403]
bas 14, expnt(s) = [298.08653013]
bas 15, expnt(s) = [311.56434609]
bas 16, expnt(s) = [63.03636107]
bas 17, expnt(s) = [7.20180564]
bas 18, expnt(s) = [20.17135948]
bas 19, expnt(s) = [0.76933211]
bas 20, expnt(s) = [2.75524263]
bas 21, expnt(s) = [0.22124502]
CPU time:       551.61
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828472e+04 5.20029137e+03 7.61706643e+03 2.05994598e+03
 3.61751343e+03 1.17848115e+03 1.58755541e+03 6.35421189e+02
 4.18375022e+02 2.33716479e+02 1.70529289e+02 1.19224157e+02
 8.64468038e+01 7.16269947e+01 3.32294167e+01 3.49668945e+01
 7.95566083e+00 1.19680176e+01 6.59157611e-01 1.84823409e+00
 3.13499481e+00 5.95240734e+00 2.38360671e-01 8.61868432e-01
 1.36284642e+03 2.41570022e+04 6.64135074e+02 9.83569184e+03
 2.98086530e+02 3.61336915e+03 3.11564346e+02 3.81873115e+03
 6.30363611e+01 5.18171247e+02 7.20180564e+00 3.44180402e+01
 2.01713595e+01 1.24710596e+02 7.69332109e-01 2.10197098e+00
 2.75524263e+00 1.03558131e+01 2.21245016e-01 4.42666099e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993913860975702
cond(S) = 109483.59488734062
E1 = -729.5489814282669  E_coul = 203.17781765612213
init E= -526.371163772145
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555824518249251  LUMO = 0.990248149394333
  mo_energy =
[-1.18336255e+02 -1.22061461e+01 -9.44681500e+00 -9.44681500e+00
 -9.44681500e+00 -1.24011982e+00 -5.55824518e-01 -5.55824518e-01
 -5.55824518e-01  9.90248149e-01  1.02159470e+00  1.02159470e+00
  1.02159470e+00  7.19308832e+00  7.19308832e+00  7.19308832e+00
  1.19880488e+01  3.29395478e+01  3.29395478e+01  3.29395478e+01
  8.74477773e+01  1.29567220e+02  1.29567220e+02  1.29567220e+02
  3.54631393e+02  4.84759297e+02  4.84759297e+02  4.84759297e+02
  1.06199027e+03  1.33178783e+03  1.33178783e+03  1.33178783e+03
  3.01862898e+03  3.01862898e+03  3.01862898e+03  3.26966905e+03
  6.63400095e+03  6.63400095e+03  6.63400095e+03  9.68213114e+03
  2.60118636e+04  7.67141551e+04]
E1 = -727.8469843468824  E_coul = 201.09109224898305
cycle= 1 E= -526.755892097899  delta_E= -0.385  |g|= 0.187  |ddm|= 0.303
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587533
diis-c [-0.34519481  1.        ]
  HOMO = -0.591190420087298  LUMO = 0.962088578799657
  mo_energy =
[-1.18645640e+02 -1.23447644e+01 -9.59629903e+00 -9.59629903e+00
 -9.59629903e+00 -1.28003163e+00 -5.91190420e-01 -5.91190420e-01
 -5.91190420e-01  9.62088579e-01  9.97222507e-01  9.97222507e-01
  9.97222507e-01  7.10261779e+00  7.10261779e+00  7.10261779e+00
  1.18805110e+01  3.27847960e+01  3.27847960e+01  3.27847960e+01
  8.72474403e+01  1.29336292e+02  1.29336292e+02  1.29336292e+02
  3.54352441e+02  4.84451537e+02  4.84451537e+02  4.84451537e+02
  1.06162374e+03  1.33142386e+03  1.33142386e+03  1.33142386e+03
  3.01819941e+03  3.01819941e+03  3.01819941e+03  3.26917413e+03
  6.63345861e+03  6.63345861e+03  6.63345861e+03  9.68151849e+03
  2.60111546e+04  7.67133549e+04]
E1 = -728.4262961100471  E_coul = 201.66967322047535
cycle= 2 E= -526.756622889572  delta_E= -0.000731  |g|= 0.038  |ddm|= 0.0536
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076966
diis-c [-0.00391986  0.07117387  0.92882613]
  HOMO = -0.58186690531971  LUMO = 0.970265767491838
  mo_energy =
[-1.18576546e+02 -1.23058893e+01 -9.55573548e+00 -9.55573548e+00
 -9.55573548e+00 -1.26886598e+00 -5.81866905e-01 -5.81866905e-01
 -5.81866905e-01  9.70265767e-01  1.00401976e+00  1.00401976e+00
  1.00401976e+00  7.12659263e+00  7.12659263e+00  7.12659263e+00
  1.19103989e+01  3.28256127e+01  3.28256127e+01  3.28256127e+01
  8.73003200e+01  1.29393553e+02  1.29393553e+02  1.29393553e+02
  3.54417797e+02  4.84519799e+02  4.84519799e+02  4.84519799e+02
  1.06169553e+03  1.33149621e+03  1.33149621e+03  1.33149621e+03
  3.01827406e+03  3.01827406e+03  3.01827406e+03  3.26924975e+03
  6.63353506e+03  6.63353506e+03  6.63353506e+03  9.68159568e+03
  2.60112324e+04  7.67134330e+04]
E1 = -728.2722989981922  E_coul = 201.5156163221963
cycle= 3 E= -526.756682675996  delta_E= -5.98e-05  |g|= 0.0069  |ddm|= 0.0166
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0145539
diis-c [-7.51522627e-07 -1.22411441e-03  1.54949981e-01  8.46274133e-01]
  HOMO = -0.583502833593317  LUMO = 0.968929373960008
  mo_energy =
[-1.18587470e+02 -1.23122475e+01 -9.56246554e+00 -9.56246554e+00
 -9.56246554e+00 -1.27071718e+00 -5.83502834e-01 -5.83502834e-01
 -5.83502834e-01  9.68929374e-01  1.00285183e+00  1.00285183e+00
  1.00285183e+00  7.12251596e+00  7.12251596e+00  7.12251596e+00
  1.19054716e+01  3.28188789e+01  3.28188789e+01  3.28188789e+01
  8.72918373e+01  1.29384374e+02  1.29384374e+02  1.29384374e+02
  3.54407438e+02  4.84509002e+02  4.84509002e+02  4.84509002e+02
  1.06168416e+03  1.33148477e+03  1.33148477e+03  1.33148477e+03
  3.01826220e+03  3.01826220e+03  3.01826220e+03  3.26923766e+03
  6.63352278e+03  6.63352278e+03  6.63352278e+03  9.68158320e+03
  2.60112197e+04  7.67134202e+04]
E1 = -728.2973219178584  E_coul = 201.5406369372239
cycle= 4 E= -526.756684980635  delta_E= -2.3e-06  |g|= 0.000103  |ddm|= 0.00247
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000110676
diis-c [-4.65819377e-09  7.66975695e-05 -1.13206320e-02 -6.60696788e-02
  1.07731361e+00]
  HOMO = -0.583483205518811  LUMO = 0.968964760860297
  mo_energy =
[-1.18587420e+02 -1.23121767e+01 -9.56240834e+00 -9.56240834e+00
 -9.56240834e+00 -1.27067365e+00 -5.83483206e-01 -5.83483206e-01
 -5.83483206e-01  9.68964761e-01  1.00286857e+00  1.00286857e+00
  1.00286857e+00  7.12256101e+00  7.12256101e+00  7.12256101e+00
  1.19055355e+01  3.28189340e+01  3.28189340e+01  3.28189340e+01
  8.72918990e+01  1.29384430e+02  1.29384430e+02  1.29384430e+02
  3.54407490e+02  4.84509053e+02  4.84509053e+02  4.84509053e+02
  1.06168420e+03  1.33148482e+03  1.33148482e+03  1.33148482e+03
  3.01826224e+03  3.01826224e+03  3.01826224e+03  3.26923768e+03
  6.63352280e+03  6.63352280e+03  6.63352280e+03  9.68158321e+03
  2.60112197e+04  7.67134202e+04]
E1 = -728.2970821609053  E_coul = 201.54039717837895
cycle= 5 E= -526.756684982526  delta_E= -1.89e-09  |g|= 2.12e-05  |ddm|= 0.000166
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=4.00344e-05
diis-c [-8.49912526e-11  1.29913435e-05 -1.90406271e-03 -1.30198427e-02
  3.44135554e-02  9.80497359e-01]
  HOMO = -0.583490892267493  LUMO = 0.968960851205447
  mo_energy =
[-1.18587452e+02 -1.23121999e+01 -9.56243352e+00 -9.56243352e+00
 -9.56243352e+00 -1.27067969e+00 -5.83490892e-01 -5.83490892e-01
 -5.83490892e-01  9.68960851e-01  1.00286354e+00  1.00286354e+00
  1.00286354e+00  7.12254411e+00  7.12254411e+00  7.12254411e+00
  1.19055171e+01  3.28189096e+01  3.28189096e+01  3.28189096e+01
  8.72918716e+01  1.29384402e+02  1.29384402e+02  1.29384402e+02
  3.54407460e+02  4.84509022e+02  4.84509022e+02  4.84509022e+02
  1.06168417e+03  1.33148478e+03  1.33148478e+03  1.33148478e+03
  3.01826220e+03  3.01826220e+03  3.01826220e+03  3.26923765e+03
  6.63352276e+03  6.63352276e+03  6.63352276e+03  9.68158317e+03
  2.60112197e+04  7.67134202e+04]
E1 = -728.2971659526307  E_coul = 201.54048097004105
cycle= 6 E= -526.75668498259  delta_E= -6.33e-11  |g|= 1.82e-06  |ddm|= 1.96e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.2971659526307  E_coul = 201.54048097004105
  HOMO = -0.583490841006223  LUMO = 0.968961255271807
  mo_energy =
[-1.18587451e+02 -1.23121995e+01 -9.56243322e+00 -9.56243322e+00
 -9.56243322e+00 -1.27067923e+00 -5.83490841e-01 -5.83490841e-01
 -5.83490841e-01  9.68961255e-01  1.00286364e+00  1.00286364e+00
  1.00286364e+00  7.12254432e+00  7.12254432e+00  7.12254432e+00
  1.19055175e+01  3.28189100e+01  3.28189100e+01  3.28189100e+01
  8.72918721e+01  1.29384402e+02  1.29384402e+02  1.29384402e+02
  3.54407460e+02  4.84509022e+02  4.84509022e+02  4.84509022e+02
  1.06168417e+03  1.33148478e+03  1.33148478e+03  1.33148478e+03
  3.01826220e+03  3.01826220e+03  3.01826220e+03  3.26923765e+03
  6.63352276e+03  6.63352276e+03  6.63352276e+03  9.68158317e+03
  2.60112197e+04  7.67134202e+04]
E1 = -728.2971640283904  E_coul = 201.54047904579994
Extra cycle  E= -526.756684982591  delta_E= -7.96e-13  |g|= 3.77e-07  |ddm|= 3.19e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 109483.59488734062
E1 = -728.2971640283904  E_coul = 201.54047904579994
init E= -526.756684982591
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583490891771679  LUMO = 0.968961286751021
  mo_energy =
[-1.18587451e+02 -1.23121996e+01 -9.56243338e+00 -9.56243338e+00
 -9.56243338e+00 -1.27067921e+00 -5.83490892e-01 -5.83490892e-01
 -5.83490892e-01  9.68961287e-01  1.00286361e+00  1.00286361e+00
  1.00286361e+00  7.12254422e+00  7.12254422e+00  7.12254422e+00
  1.19055175e+01  3.28189098e+01  3.28189098e+01  3.28189098e+01
  8.72918719e+01  1.29384402e+02  1.29384402e+02  1.29384402e+02
  3.54407460e+02  4.84509022e+02  4.84509022e+02  4.84509022e+02
  1.06168417e+03  1.33148478e+03  1.33148478e+03  1.33148478e+03
  3.01826220e+03  3.01826220e+03  3.01826220e+03  3.26923765e+03
  6.63352276e+03  6.63352276e+03  6.63352276e+03  9.68158317e+03
  2.60112197e+04  7.67134202e+04]
E1 = -728.2971644463919  E_coul = 201.54047946380248
cycle= 1 E= -526.756684982589  delta_E= 1.14e-12  |g|= 8.26e-08  |ddm|= 6.08e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2971644463919  E_coul = 201.54047946380248
  HOMO = -0.583490886551532  LUMO = 0.968961306411675
  mo_energy =
[-1.18587451e+02 -1.23121996e+01 -9.56243335e+00 -9.56243335e+00
 -9.56243335e+00 -1.27067918e+00 -5.83490887e-01 -5.83490887e-01
 -5.83490887e-01  9.68961306e-01  1.00286362e+00  1.00286362e+00
  1.00286362e+00  7.12254424e+00  7.12254424e+00  7.12254424e+00
  1.19055175e+01  3.28189098e+01  3.28189098e+01  3.28189098e+01
  8.72918719e+01  1.29384402e+02  1.29384402e+02  1.29384402e+02
  3.54407460e+02  4.84509022e+02  4.84509022e+02  4.84509022e+02
  1.06168417e+03  1.33148478e+03  1.33148478e+03  1.33148478e+03
  3.01826220e+03  3.01826220e+03  3.01826220e+03  3.26923765e+03
  6.63352276e+03  6.63352276e+03  6.63352276e+03  9.68158317e+03
  2.60112197e+04  7.67134202e+04]
E1 = -728.2971643028603  E_coul = 201.54047932027115
Extra cycle  E= -526.756684982589  delta_E= 2.27e-13  |g|= 1.71e-08  |ddm|= 1.34e-07
    CPU time for scf_cycle      0.91 sec, wall time      0.43 sec
exp = [2.61828472e+04 7.61706643e+03 3.61751343e+03 1.58755541e+03
 4.18375022e+02 1.70529289e+02 8.64468038e+01 3.32294167e+01
 7.95566083e+00 6.59157611e-01 3.13499481e+00 2.38360671e-01
 1.36284642e+03 6.64135074e+02 2.98086530e+02 3.11564346e+02
 6.30363611e+01 7.20180564e+00 2.01713595e+01 7.69332109e-01
 2.75524263e+00 2.21245016e-01]
grad_E = [-1.48602307e-06  2.96972528e-06 -2.03894670e-06  6.43407556e-05
 -3.13113664e-04  8.36113640e-05  2.10245650e-04 -3.29592524e-04
  1.87559209e-04  1.96073447e-03  5.01236997e-04 -3.94693459e-03
 -6.31530139e-07  3.20112101e-06  1.34390084e-05  1.14961498e-05
  5.37084709e-04 -5.19674689e-04 -1.30141065e-03  5.41696662e-04
  1.36542415e-04 -1.71624814e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:45 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8624295        1
[INPUT] 0    0    [1    /1   ]  7617.02999642        1
[INPUT] 0    0    [1    /1   ]  3617.52618191        1
[INPUT] 0    0    [1    /1   ]  1586.73077703        1
[INPUT] 0    0    [1    /1   ]  421.34916346         1
[INPUT] 0    0    [1    /1   ]  175.473456912        1
[INPUT] 0    0    [1    /1   ]  89.3629573691        1
[INPUT] 0    0    [1    /1   ]  33.933298844         1
[INPUT] 0    0    [1    /1   ]  7.94175931473        1
[INPUT] 0    0    [1    /1   ]  0.660779973645       1
[INPUT] 0    0    [1    /1   ]  3.12282225592        1
[INPUT] 0    0    [1    /1   ]  0.239793366958       1
[INPUT] 1    0    [1    /1   ]  1362.8514524         1
[INPUT] 1    0    [1    /1   ]  664.086654698        1
[INPUT] 1    0    [1    /1   ]  297.858633533        1
[INPUT] 1    0    [1    /1   ]  311.367958262        1
[INPUT] 1    0    [1    /1   ]  63.1076356399        1
[INPUT] 1    0    [1    /1   ]  7.24318625406        1
[INPUT] 1    0    [1    /1   ]  20.2640691729        1
[INPUT] 1    0    [1    /1   ]  0.771060634712       1
[INPUT] 1    0    [1    /1   ]  2.77045230609        1
[INPUT] 1    0    [1    /1   ]  0.221585317544       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.862429480418, 1.0]], [0, [7617.02999641615, 1.0]], [0, [3617.526181914885, 1.0]], [0, [1586.730777034987, 1.0]], [0, [421.3491634599613, 1.0]], [0, [175.47345691189278, 1.0]], [0, [89.36295736907219, 1.0]], [0, [33.93329884398711, 1.0]], [0, [7.941759314733733, 1.0]], [0, [0.6607799736447233, 1.0]], [0, [3.1228222559194516, 1.0]], [0, [0.2397933669578439, 1.0]], [1, [1362.8514523956994, 1.0]], [1, [664.0866546978613, 1.0]], [1, [297.85863353324953, 1.0]], [1, [311.3679582615199, 1.0]], [1, [63.107635639858906, 1.0]], [1, [7.2431862540616105, 1.0]], [1, [20.264069172898214, 1.0]], [1, [0.7710606347115941, 1.0]], [1, [2.7704523060883885, 1.0]], [1, [0.2215853175441658, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.86242948]
bas 1, expnt(s) = [7617.02999642]
bas 2, expnt(s) = [3617.52618191]
bas 3, expnt(s) = [1586.73077703]
bas 4, expnt(s) = [421.34916346]
bas 5, expnt(s) = [175.47345691]
bas 6, expnt(s) = [89.36295737]
bas 7, expnt(s) = [33.93329884]
bas 8, expnt(s) = [7.94175931]
bas 9, expnt(s) = [0.66077997]
bas 10, expnt(s) = [3.12282226]
bas 11, expnt(s) = [0.23979337]
bas 12, expnt(s) = [1362.8514524]
bas 13, expnt(s) = [664.0866547]
bas 14, expnt(s) = [297.85863353]
bas 15, expnt(s) = [311.36795826]
bas 16, expnt(s) = [63.10763564]
bas 17, expnt(s) = [7.24318625]
bas 18, expnt(s) = [20.26406917]
bas 19, expnt(s) = [0.77106063]
bas 20, expnt(s) = [2.77045231]
bas 21, expnt(s) = [0.22158532]
CPU time:       557.15
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828624e+04 5.20029364e+03 7.61703000e+03 2.05993859e+03
 3.61752618e+03 1.17848426e+03 1.58673078e+03 6.35173628e+02
 4.21349163e+02 2.34961457e+02 1.75473457e+02 1.21807379e+02
 8.93629574e+01 7.34316309e+01 3.39332988e+01 3.55209511e+01
 7.94175931e+00 1.19523297e+01 6.60779974e-01 1.85164479e+00
 3.12282226e+00 5.93506492e+00 2.39793367e-01 8.65750794e-01
 1.36285145e+03 2.41571137e+04 6.64086655e+02 9.83479550e+03
 2.97858634e+02 3.60991631e+03 3.11367958e+02 3.81572257e+03
 6.31076356e+01 5.18903714e+02 7.24318625e+00 3.46654194e+01
 2.02640692e+01 1.25427486e+02 7.71060635e-01 2.10787599e+00
 2.77045231e+00 1.04273209e+01 2.21585318e-01 4.43517354e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993854548322588
cond(S) = 109105.91595447861
E1 = -729.5487301386463  E_coul = 203.1774880428967
init E= -526.37124209575
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555821132555976  LUMO = 0.996578470771364
  mo_energy =
[-1.18336271e+02 -1.22062348e+01 -9.44687538e+00 -9.44687538e+00
 -9.44687538e+00 -1.24012399e+00 -5.55821133e-01 -5.55821133e-01
 -5.55821133e-01  9.96578471e-01  1.02445567e+00  1.02445567e+00
  1.02445567e+00  7.23754041e+00  7.23754041e+00  7.23754041e+00
  1.19903273e+01  3.31592998e+01  3.31592998e+01  3.31592998e+01
  8.94053231e+01  1.30083146e+02  1.30083146e+02  1.30083146e+02
  3.65028443e+02  4.85278032e+02  4.85278032e+02  4.85278032e+02
  1.08713660e+03  1.33185662e+03  1.33185662e+03  1.33185662e+03
  3.01807138e+03  3.01807138e+03  3.01807138e+03  3.30722263e+03
  6.63300166e+03  6.63300166e+03  6.63300166e+03  9.72197727e+03
  2.60504434e+04  7.67502401e+04]
E1 = -727.8490608532904  E_coul = 201.09293660295032
cycle= 1 E= -526.75612425034  delta_E= -0.385  |g|= 0.187  |ddm|= 0.301
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587648
diis-c [-0.34532983  1.        ]
  HOMO = -0.591032619300258  LUMO = 0.968425864165527
  mo_energy =
[-1.18645468e+02 -1.23447288e+01 -9.59630462e+00 -9.59630462e+00
 -9.59630462e+00 -1.27988893e+00 -5.91032619e-01 -5.91032619e-01
 -5.91032619e-01  9.68425864e-01  1.00010471e+00  1.00010471e+00
  1.00010471e+00  7.14690126e+00  7.14690126e+00  7.14690126e+00
  1.18828595e+01  3.30043576e+01  3.30043576e+01  3.30043576e+01
  8.92030833e+01  1.29852235e+02  1.29852235e+02  1.29852235e+02
  3.64747395e+02  4.84970593e+02  4.84970593e+02  4.84970593e+02
  1.08676893e+03  1.33149303e+03  1.33149303e+03  1.33149303e+03
  3.01764224e+03  3.01764224e+03  3.01764224e+03  3.30672815e+03
  6.63245987e+03  6.63245987e+03  6.63245987e+03  9.72136548e+03
  2.60497352e+04  7.67494406e+04]
E1 = -728.4276157985785  E_coul = 201.67076206397013
cycle= 2 E= -526.756853734608  delta_E= -0.000729  |g|= 0.0379  |ddm|= 0.0537
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0769236
diis-c [-0.00391098  0.07119865  0.92880135]
  HOMO = -0.581725035462003  LUMO = 0.976614629502125
  mo_energy =
[-1.18576444e+02 -1.23059050e+01 -9.55579654e+00 -9.55579654e+00
 -9.55579654e+00 -1.26874674e+00 -5.81725035e-01 -5.81725035e-01
 -5.81725035e-01  9.76614630e-01  1.00691142e+00  1.00691142e+00
  1.00691142e+00  7.17092777e+00  7.17092777e+00  7.17092777e+00
  1.19127399e+01  3.30451980e+01  3.30451980e+01  3.30451980e+01
  8.92563092e+01  1.29909448e+02  1.29909448e+02  1.29909448e+02
  3.64812959e+02  4.85038778e+02  4.85038778e+02  4.85038778e+02
  1.08684074e+03  1.33156531e+03  1.33156531e+03  1.33156531e+03
  3.01771682e+03  3.01771682e+03  3.01771682e+03  3.30680370e+03
  6.63253624e+03  6.63253624e+03  6.63253624e+03  9.72144259e+03
  2.60498130e+04  7.67495187e+04]
E1 = -728.2739485620145  E_coul = 201.5170352344523
cycle= 3 E= -526.756913327562  delta_E= -5.96e-05  |g|= 0.00689  |ddm|= 0.0166
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0145351
diis-c [-7.46600827e-07 -1.21967949e-03  1.54856862e-01  8.46362818e-01]
  HOMO = -0.583355187386332  LUMO = 0.975276861640142
  mo_energy =
[-1.18587345e+02 -1.23122465e+01 -9.56251006e+00 -9.56251006e+00
 -9.56251006e+00 -1.27059303e+00 -5.83355187e-01 -5.83355187e-01
 -5.83355187e-01  9.75276862e-01  1.00574360e+00  1.00574360e+00
  1.00574360e+00  7.16684804e+00  7.16684804e+00  7.16684804e+00
  1.19078214e+01  3.30384689e+01  3.30384689e+01  3.30384689e+01
  8.92477858e+01  1.29900287e+02  1.29900287e+02  1.29900287e+02
  3.64802581e+02  4.85028006e+02  4.85028006e+02  4.85028006e+02
  1.08682938e+03  1.33155389e+03  1.33155389e+03  1.33155389e+03
  3.01770498e+03  3.01770498e+03  3.01770498e+03  3.30679163e+03
  6.63252399e+03  6.63252399e+03  6.63252399e+03  9.72143013e+03
  2.60498003e+04  7.67495059e+04]
E1 = -728.2988947508184  E_coul = 201.54197913186704
cycle= 4 E= -526.756915618951  delta_E= -2.29e-06  |g|= 0.000101  |ddm|= 0.00247
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000110272
diis-c [-4.55002183e-09  7.57906849e-05 -1.12020259e-02 -6.55372193e-02
  1.07666345e+00]
  HOMO = -0.583335629846364  LUMO = 0.975311788232248
  mo_energy =
[-1.18587295e+02 -1.23121764e+01 -9.56245349e+00 -9.56245349e+00
 -9.56245349e+00 -1.27055016e+00 -5.83335630e-01 -5.83335630e-01
 -5.83335630e-01  9.75311788e-01  1.00576025e+00  1.00576025e+00
  1.00576025e+00  7.16689278e+00  7.16689278e+00  7.16689278e+00
  1.19078848e+01  3.30385235e+01  3.30385235e+01  3.30385235e+01
  8.92478466e+01  1.29900343e+02  1.29900343e+02  1.29900343e+02
  3.64802632e+02  4.85028056e+02  4.85028056e+02  4.85028056e+02
  1.08682942e+03  1.33155393e+03  1.33155393e+03  1.33155393e+03
  3.01770502e+03  3.01770502e+03  3.01770502e+03  3.30679165e+03
  6.63252401e+03  6.63252401e+03  6.63252401e+03  9.72143014e+03
  2.60498003e+04  7.67495059e+04]
E1 = -728.2986588480647  E_coul = 201.54174322732098
cycle= 5 E= -526.756915620744  delta_E= -1.79e-09  |g|= 2.1e-05  |ddm|= 0.000162
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.96342e-05
diis-c [-8.21986018e-11  1.27953982e-05 -1.88007425e-03 -1.28845502e-02
  3.67854197e-02  9.77966409e-01]
  HOMO = -0.583343219577289  LUMO = 0.975307865195589
  mo_energy =
[-1.18587326e+02 -1.23121993e+01 -9.56247840e+00 -9.56247840e+00
 -9.56247840e+00 -1.27055618e+00 -5.83343220e-01 -5.83343220e-01
 -5.83343220e-01  9.75307865e-01  1.00575526e+00  1.00575526e+00
  1.00575526e+00  7.16687602e+00  7.16687602e+00  7.16687602e+00
  1.19078666e+01  3.30384993e+01  3.30384993e+01  3.30384993e+01
  8.92478194e+01  1.29900314e+02  1.29900314e+02  1.29900314e+02
  3.64802602e+02  4.85028025e+02  4.85028025e+02  4.85028025e+02
  1.08682939e+03  1.33155390e+03  1.33155390e+03  1.33155390e+03
  3.01770498e+03  3.01770498e+03  3.01770498e+03  3.30679162e+03
  6.63252397e+03  6.63252397e+03  6.63252397e+03  9.72143011e+03
  2.60498003e+04  7.67495058e+04]
E1 = -728.2987417689571  E_coul = 201.54182614815443
cycle= 6 E= -526.756915620803  delta_E= -5.9e-11  |g|= 1.81e-06  |ddm|= 1.91e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2987417689571  E_coul = 201.54182614815443
  HOMO = -0.583343183028019  LUMO = 0.975308257354437
  mo_energy =
[-1.18587326e+02 -1.23121990e+01 -9.56247815e+00 -9.56247815e+00
 -9.56247815e+00 -1.27055574e+00 -5.83343183e-01 -5.83343183e-01
 -5.83343183e-01  9.75308257e-01  1.00575535e+00  1.00575535e+00
  1.00575535e+00  7.16687620e+00  7.16687620e+00  7.16687620e+00
  1.19078669e+01  3.30384996e+01  3.30384996e+01  3.30384996e+01
  8.92478198e+01  1.29900314e+02  1.29900314e+02  1.29900314e+02
  3.64802602e+02  4.85028025e+02  4.85028025e+02  4.85028025e+02
  1.08682939e+03  1.33155390e+03  1.33155390e+03  1.33155390e+03
  3.01770498e+03  3.01770498e+03  3.01770498e+03  3.30679162e+03
  6.63252397e+03  6.63252397e+03  6.63252397e+03  9.72143011e+03
  2.60498003e+04  7.67495058e+04]
E1 = -728.2987400375905  E_coul = 201.54182441678614
Extra cycle  E= -526.756915620804  delta_E= -1.71e-12  |g|= 3.75e-07  |ddm|= 3.18e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
exp = [2.61828624e+04 7.61703000e+03 3.61752618e+03 1.58673078e+03
 4.21349163e+02 1.75473457e+02 8.93629574e+01 3.39332988e+01
 7.94175931e+00 6.60779974e-01 3.12282226e+00 2.39793367e-01
 1.36285145e+03 6.64086655e+02 2.97858634e+02 3.11367958e+02
 6.31076356e+01 7.24318625e+00 2.02640692e+01 7.71060635e-01
 2.77045231e+00 2.21585318e-01]
E = -526.7569156208044
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:46 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8624295        1
[INPUT] 0    0    [1    /1   ]  7617.02999642        1
[INPUT] 0    0    [1    /1   ]  3617.52618191        1
[INPUT] 0    0    [1    /1   ]  1586.73077703        1
[INPUT] 0    0    [1    /1   ]  421.34916346         1
[INPUT] 0    0    [1    /1   ]  175.473456912        1
[INPUT] 0    0    [1    /1   ]  89.3629573691        1
[INPUT] 0    0    [1    /1   ]  33.933298844         1
[INPUT] 0    0    [1    /1   ]  7.94175931473        1
[INPUT] 0    0    [1    /1   ]  0.660779973645       1
[INPUT] 0    0    [1    /1   ]  3.12282225592        1
[INPUT] 0    0    [1    /1   ]  0.239793366958       1
[INPUT] 1    0    [1    /1   ]  1362.8514524         1
[INPUT] 1    0    [1    /1   ]  664.086654698        1
[INPUT] 1    0    [1    /1   ]  297.858633533        1
[INPUT] 1    0    [1    /1   ]  311.367958262        1
[INPUT] 1    0    [1    /1   ]  63.1076356399        1
[INPUT] 1    0    [1    /1   ]  7.24318625406        1
[INPUT] 1    0    [1    /1   ]  20.2640691729        1
[INPUT] 1    0    [1    /1   ]  0.771060634712       1
[INPUT] 1    0    [1    /1   ]  2.77045230609        1
[INPUT] 1    0    [1    /1   ]  0.221585317544       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.862429480418, 1.0]], [0, [7617.02999641615, 1.0]], [0, [3617.526181914885, 1.0]], [0, [1586.730777034987, 1.0]], [0, [421.3491634599613, 1.0]], [0, [175.47345691189278, 1.0]], [0, [89.36295736907219, 1.0]], [0, [33.93329884398711, 1.0]], [0, [7.941759314733733, 1.0]], [0, [0.6607799736447233, 1.0]], [0, [3.1228222559194516, 1.0]], [0, [0.2397933669578439, 1.0]], [1, [1362.8514523956994, 1.0]], [1, [664.0866546978613, 1.0]], [1, [297.85863353324953, 1.0]], [1, [311.3679582615199, 1.0]], [1, [63.107635639858906, 1.0]], [1, [7.2431862540616105, 1.0]], [1, [20.264069172898214, 1.0]], [1, [0.7710606347115941, 1.0]], [1, [2.7704523060883885, 1.0]], [1, [0.2215853175441658, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.86242948]
bas 1, expnt(s) = [7617.02999642]
bas 2, expnt(s) = [3617.52618191]
bas 3, expnt(s) = [1586.73077703]
bas 4, expnt(s) = [421.34916346]
bas 5, expnt(s) = [175.47345691]
bas 6, expnt(s) = [89.36295737]
bas 7, expnt(s) = [33.93329884]
bas 8, expnt(s) = [7.94175931]
bas 9, expnt(s) = [0.66077997]
bas 10, expnt(s) = [3.12282226]
bas 11, expnt(s) = [0.23979337]
bas 12, expnt(s) = [1362.8514524]
bas 13, expnt(s) = [664.0866547]
bas 14, expnt(s) = [297.85863353]
bas 15, expnt(s) = [311.36795826]
bas 16, expnt(s) = [63.10763564]
bas 17, expnt(s) = [7.24318625]
bas 18, expnt(s) = [20.26406917]
bas 19, expnt(s) = [0.77106063]
bas 20, expnt(s) = [2.77045231]
bas 21, expnt(s) = [0.22158532]
CPU time:       557.67
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828624e+04 5.20029364e+03 7.61703000e+03 2.05993859e+03
 3.61752618e+03 1.17848426e+03 1.58673078e+03 6.35173628e+02
 4.21349163e+02 2.34961457e+02 1.75473457e+02 1.21807379e+02
 8.93629574e+01 7.34316309e+01 3.39332988e+01 3.55209511e+01
 7.94175931e+00 1.19523297e+01 6.60779974e-01 1.85164479e+00
 3.12282226e+00 5.93506492e+00 2.39793367e-01 8.65750794e-01
 1.36285145e+03 2.41571137e+04 6.64086655e+02 9.83479550e+03
 2.97858634e+02 3.60991631e+03 3.11367958e+02 3.81572257e+03
 6.31076356e+01 5.18903714e+02 7.24318625e+00 3.46654194e+01
 2.02640692e+01 1.25427486e+02 7.71060635e-01 2.10787599e+00
 2.77045231e+00 1.04273209e+01 2.21585318e-01 4.43517354e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993854548322588
cond(S) = 109105.91595447861
E1 = -729.5487301386463  E_coul = 203.1774880428967
init E= -526.37124209575
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555821132555976  LUMO = 0.996578470771364
  mo_energy =
[-1.18336271e+02 -1.22062348e+01 -9.44687538e+00 -9.44687538e+00
 -9.44687538e+00 -1.24012399e+00 -5.55821133e-01 -5.55821133e-01
 -5.55821133e-01  9.96578471e-01  1.02445567e+00  1.02445567e+00
  1.02445567e+00  7.23754041e+00  7.23754041e+00  7.23754041e+00
  1.19903273e+01  3.31592998e+01  3.31592998e+01  3.31592998e+01
  8.94053231e+01  1.30083146e+02  1.30083146e+02  1.30083146e+02
  3.65028443e+02  4.85278032e+02  4.85278032e+02  4.85278032e+02
  1.08713660e+03  1.33185662e+03  1.33185662e+03  1.33185662e+03
  3.01807138e+03  3.01807138e+03  3.01807138e+03  3.30722263e+03
  6.63300166e+03  6.63300166e+03  6.63300166e+03  9.72197727e+03
  2.60504434e+04  7.67502401e+04]
E1 = -727.8490608532904  E_coul = 201.09293660295032
cycle= 1 E= -526.75612425034  delta_E= -0.385  |g|= 0.187  |ddm|= 0.301
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.587648
diis-c [-0.34532983  1.        ]
  HOMO = -0.591032619300258  LUMO = 0.968425864165527
  mo_energy =
[-1.18645468e+02 -1.23447288e+01 -9.59630462e+00 -9.59630462e+00
 -9.59630462e+00 -1.27988893e+00 -5.91032619e-01 -5.91032619e-01
 -5.91032619e-01  9.68425864e-01  1.00010471e+00  1.00010471e+00
  1.00010471e+00  7.14690126e+00  7.14690126e+00  7.14690126e+00
  1.18828595e+01  3.30043576e+01  3.30043576e+01  3.30043576e+01
  8.92030833e+01  1.29852235e+02  1.29852235e+02  1.29852235e+02
  3.64747395e+02  4.84970593e+02  4.84970593e+02  4.84970593e+02
  1.08676893e+03  1.33149303e+03  1.33149303e+03  1.33149303e+03
  3.01764224e+03  3.01764224e+03  3.01764224e+03  3.30672815e+03
  6.63245987e+03  6.63245987e+03  6.63245987e+03  9.72136548e+03
  2.60497352e+04  7.67494406e+04]
E1 = -728.4276157985785  E_coul = 201.67076206397013
cycle= 2 E= -526.756853734608  delta_E= -0.000729  |g|= 0.0379  |ddm|= 0.0537
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0769236
diis-c [-0.00391098  0.07119865  0.92880135]
  HOMO = -0.581725035462003  LUMO = 0.976614629502125
  mo_energy =
[-1.18576444e+02 -1.23059050e+01 -9.55579654e+00 -9.55579654e+00
 -9.55579654e+00 -1.26874674e+00 -5.81725035e-01 -5.81725035e-01
 -5.81725035e-01  9.76614630e-01  1.00691142e+00  1.00691142e+00
  1.00691142e+00  7.17092777e+00  7.17092777e+00  7.17092777e+00
  1.19127399e+01  3.30451980e+01  3.30451980e+01  3.30451980e+01
  8.92563092e+01  1.29909448e+02  1.29909448e+02  1.29909448e+02
  3.64812959e+02  4.85038778e+02  4.85038778e+02  4.85038778e+02
  1.08684074e+03  1.33156531e+03  1.33156531e+03  1.33156531e+03
  3.01771682e+03  3.01771682e+03  3.01771682e+03  3.30680370e+03
  6.63253624e+03  6.63253624e+03  6.63253624e+03  9.72144259e+03
  2.60498130e+04  7.67495187e+04]
E1 = -728.2739485620145  E_coul = 201.5170352344523
cycle= 3 E= -526.756913327562  delta_E= -5.96e-05  |g|= 0.00689  |ddm|= 0.0166
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0145351
diis-c [-7.46600827e-07 -1.21967949e-03  1.54856862e-01  8.46362818e-01]
  HOMO = -0.583355187386332  LUMO = 0.975276861640142
  mo_energy =
[-1.18587345e+02 -1.23122465e+01 -9.56251006e+00 -9.56251006e+00
 -9.56251006e+00 -1.27059303e+00 -5.83355187e-01 -5.83355187e-01
 -5.83355187e-01  9.75276862e-01  1.00574360e+00  1.00574360e+00
  1.00574360e+00  7.16684804e+00  7.16684804e+00  7.16684804e+00
  1.19078214e+01  3.30384689e+01  3.30384689e+01  3.30384689e+01
  8.92477858e+01  1.29900287e+02  1.29900287e+02  1.29900287e+02
  3.64802581e+02  4.85028006e+02  4.85028006e+02  4.85028006e+02
  1.08682938e+03  1.33155389e+03  1.33155389e+03  1.33155389e+03
  3.01770498e+03  3.01770498e+03  3.01770498e+03  3.30679163e+03
  6.63252399e+03  6.63252399e+03  6.63252399e+03  9.72143013e+03
  2.60498003e+04  7.67495059e+04]
E1 = -728.2988947508184  E_coul = 201.54197913186704
cycle= 4 E= -526.756915618951  delta_E= -2.29e-06  |g|= 0.000101  |ddm|= 0.00247
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000110272
diis-c [-4.55002183e-09  7.57906849e-05 -1.12020259e-02 -6.55372193e-02
  1.07666345e+00]
  HOMO = -0.583335629846364  LUMO = 0.975311788232248
  mo_energy =
[-1.18587295e+02 -1.23121764e+01 -9.56245349e+00 -9.56245349e+00
 -9.56245349e+00 -1.27055016e+00 -5.83335630e-01 -5.83335630e-01
 -5.83335630e-01  9.75311788e-01  1.00576025e+00  1.00576025e+00
  1.00576025e+00  7.16689278e+00  7.16689278e+00  7.16689278e+00
  1.19078848e+01  3.30385235e+01  3.30385235e+01  3.30385235e+01
  8.92478466e+01  1.29900343e+02  1.29900343e+02  1.29900343e+02
  3.64802632e+02  4.85028056e+02  4.85028056e+02  4.85028056e+02
  1.08682942e+03  1.33155393e+03  1.33155393e+03  1.33155393e+03
  3.01770502e+03  3.01770502e+03  3.01770502e+03  3.30679165e+03
  6.63252401e+03  6.63252401e+03  6.63252401e+03  9.72143014e+03
  2.60498003e+04  7.67495059e+04]
E1 = -728.2986588480647  E_coul = 201.54174322732098
cycle= 5 E= -526.756915620744  delta_E= -1.79e-09  |g|= 2.1e-05  |ddm|= 0.000162
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.96342e-05
diis-c [-8.21986018e-11  1.27953982e-05 -1.88007425e-03 -1.28845502e-02
  3.67854197e-02  9.77966409e-01]
  HOMO = -0.583343219577289  LUMO = 0.975307865195589
  mo_energy =
[-1.18587326e+02 -1.23121993e+01 -9.56247840e+00 -9.56247840e+00
 -9.56247840e+00 -1.27055618e+00 -5.83343220e-01 -5.83343220e-01
 -5.83343220e-01  9.75307865e-01  1.00575526e+00  1.00575526e+00
  1.00575526e+00  7.16687602e+00  7.16687602e+00  7.16687602e+00
  1.19078666e+01  3.30384993e+01  3.30384993e+01  3.30384993e+01
  8.92478194e+01  1.29900314e+02  1.29900314e+02  1.29900314e+02
  3.64802602e+02  4.85028025e+02  4.85028025e+02  4.85028025e+02
  1.08682939e+03  1.33155390e+03  1.33155390e+03  1.33155390e+03
  3.01770498e+03  3.01770498e+03  3.01770498e+03  3.30679162e+03
  6.63252397e+03  6.63252397e+03  6.63252397e+03  9.72143011e+03
  2.60498003e+04  7.67495058e+04]
E1 = -728.2987417689571  E_coul = 201.54182614815443
cycle= 6 E= -526.756915620803  delta_E= -5.9e-11  |g|= 1.81e-06  |ddm|= 1.91e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.2987417689571  E_coul = 201.54182614815443
  HOMO = -0.583343183028019  LUMO = 0.975308257354437
  mo_energy =
[-1.18587326e+02 -1.23121990e+01 -9.56247815e+00 -9.56247815e+00
 -9.56247815e+00 -1.27055574e+00 -5.83343183e-01 -5.83343183e-01
 -5.83343183e-01  9.75308257e-01  1.00575535e+00  1.00575535e+00
  1.00575535e+00  7.16687620e+00  7.16687620e+00  7.16687620e+00
  1.19078669e+01  3.30384996e+01  3.30384996e+01  3.30384996e+01
  8.92478198e+01  1.29900314e+02  1.29900314e+02  1.29900314e+02
  3.64802602e+02  4.85028025e+02  4.85028025e+02  4.85028025e+02
  1.08682939e+03  1.33155390e+03  1.33155390e+03  1.33155390e+03
  3.01770498e+03  3.01770498e+03  3.01770498e+03  3.30679162e+03
  6.63252397e+03  6.63252397e+03  6.63252397e+03  9.72143011e+03
  2.60498003e+04  7.67495058e+04]
E1 = -728.2987400375905  E_coul = 201.54182441678614
Extra cycle  E= -526.756915620804  delta_E= -1.71e-12  |g|= 3.75e-07  |ddm|= 3.18e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 109105.91595447861
E1 = -728.2987400375905  E_coul = 201.54182441678614
init E= -526.756915620804
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.58334322993855  LUMO = 0.975308291966182
  mo_energy =
[-1.18587326e+02 -1.23121991e+01 -9.56247829e+00 -9.56247829e+00
 -9.56247829e+00 -1.27055571e+00 -5.83343230e-01 -5.83343230e-01
 -5.83343230e-01  9.75308292e-01  1.00575533e+00  1.00575533e+00
  1.00575533e+00  7.16687611e+00  7.16687611e+00  7.16687611e+00
  1.19078668e+01  3.30384994e+01  3.30384994e+01  3.30384994e+01
  8.92478197e+01  1.29900314e+02  1.29900314e+02  1.29900314e+02
  3.64802602e+02  4.85028025e+02  4.85028025e+02  4.85028025e+02
  1.08682939e+03  1.33155390e+03  1.33155390e+03  1.33155390e+03
  3.01770498e+03  3.01770498e+03  3.01770498e+03  3.30679162e+03
  6.63252397e+03  6.63252397e+03  6.63252397e+03  9.72143011e+03
  2.60498003e+04  7.67495058e+04]
E1 = -728.2987404016327  E_coul = 201.54182478082714
cycle= 1 E= -526.756915620806  delta_E= -1.14e-12  |g|= 8.12e-08  |ddm|= 6.1e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.2987404016327  E_coul = 201.54182478082714
  HOMO = -0.583343225713986  LUMO = 0.975308310774705
  mo_energy =
[-1.18587326e+02 -1.23121991e+01 -9.56247827e+00 -9.56247827e+00
 -9.56247827e+00 -1.27055569e+00 -5.83343226e-01 -5.83343226e-01
 -5.83343226e-01  9.75308311e-01  1.00575533e+00  1.00575533e+00
  1.00575533e+00  7.16687612e+00  7.16687612e+00  7.16687612e+00
  1.19078669e+01  3.30384995e+01  3.30384995e+01  3.30384995e+01
  8.92478197e+01  1.29900314e+02  1.29900314e+02  1.29900314e+02
  3.64802602e+02  4.85028025e+02  4.85028025e+02  4.85028025e+02
  1.08682939e+03  1.33155390e+03  1.33155390e+03  1.33155390e+03
  3.01770498e+03  3.01770498e+03  3.01770498e+03  3.30679162e+03
  6.63252397e+03  6.63252397e+03  6.63252397e+03  9.72143011e+03
  2.60498003e+04  7.67495058e+04]
E1 = -728.298740273649  E_coul = 201.54182465284362
Extra cycle  E= -526.756915620805  delta_E= 2.27e-13  |g|= 1.67e-08  |ddm|= 1.33e-07
    CPU time for scf_cycle      0.91 sec, wall time      0.42 sec
exp = [2.61828624e+04 7.61703000e+03 3.61752618e+03 1.58673078e+03
 4.21349163e+02 1.75473457e+02 8.93629574e+01 3.39332988e+01
 7.94175931e+00 6.60779974e-01 3.12282226e+00 2.39793367e-01
 1.36285145e+03 6.64086655e+02 2.97858634e+02 3.11367958e+02
 6.31076356e+01 7.24318625e+00 2.02640692e+01 7.71060635e-01
 2.77045231e+00 2.21585318e-01]
grad_E = [-1.47721038e-06  2.88107561e-06 -2.09094932e-06  6.16879848e-05
 -2.93753072e-04  8.51081764e-05  1.56941323e-04 -3.89328817e-05
  7.00817633e-04  3.56145518e-04 -1.90341023e-03  1.46865329e-03
 -6.30087047e-07  3.26382817e-06  1.38482713e-05  1.18312504e-05
  4.70652796e-04 -6.25350040e-04 -1.04160964e-03  6.89325890e-04
  2.18593638e-04 -2.40056879e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:50 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8888731        1
[INPUT] 0    0    [1    /1   ]  7616.96677618        1
[INPUT] 0    0    [1    /1   ]  3617.54835481        1
[INPUT] 0    0    [1    /1   ]  1585.3012712         1
[INPUT] 0    0    [1    /1   ]  426.425503328        1
[INPUT] 0    0    [1    /1   ]  184.530688078        1
[INPUT] 0    0    [1    /1   ]  93.7849985888        1
[INPUT] 0    0    [1    /1   ]  34.8698538649        1
[INPUT] 0    0    [1    /1   ]  7.97240722224        1
[INPUT] 0    0    [1    /1   ]  0.656116170437       1
[INPUT] 0    0    [1    /1   ]  3.15571466314        1
[INPUT] 0    0    [1    /1   ]  0.239541384724       1
[INPUT] 1    0    [1    /1   ]  1362.86019816        1
[INPUT] 1    0    [1    /1   ]  664.002629558        1
[INPUT] 1    0    [1    /1   ]  297.463254685        1
[INPUT] 1    0    [1    /1   ]  311.02723881         1
[INPUT] 1    0    [1    /1   ]  63.1902874638        1
[INPUT] 1    0    [1    /1   ]  7.37858577573        1
[INPUT] 1    0    [1    /1   ]  20.5296041093        1
[INPUT] 1    0    [1    /1   ]  0.777116301034       1
[INPUT] 1    0    [1    /1   ]  2.82572467443        1
[INPUT] 1    0    [1    /1   ]  0.222842646636       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.88887311664, 1.0]], [0, [7616.966776176121, 1.0]], [0, [3617.548354806711, 1.0]], [0, [1585.301271198211, 1.0]], [0, [426.4255033281796, 1.0]], [0, [184.53068807796976, 1.0]], [0, [93.78499858878077, 1.0]], [0, [34.869853864914255, 1.0]], [0, [7.972407222238494, 1.0]], [0, [0.6561161704370339, 1.0]], [0, [3.1557146631447313, 1.0]], [0, [0.2395413847237856, 1.0]], [1, [1362.8601981577744, 1.0]], [1, [664.0026295577692, 1.0]], [1, [297.46325468478955, 1.0]], [1, [311.0272388095606, 1.0]], [1, [63.190287463815, 1.0]], [1, [7.378585775727549, 1.0]], [1, [20.52960410925404, 1.0]], [1, [0.7771163010339048, 1.0]], [1, [2.8257246744304187, 1.0]], [1, [0.22284264663607073, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.88887312]
bas 1, expnt(s) = [7616.96677618]
bas 2, expnt(s) = [3617.54835481]
bas 3, expnt(s) = [1585.3012712]
bas 4, expnt(s) = [426.42550333]
bas 5, expnt(s) = [184.53068808]
bas 6, expnt(s) = [93.78499859]
bas 7, expnt(s) = [34.86985386]
bas 8, expnt(s) = [7.97240722]
bas 9, expnt(s) = [0.65611617]
bas 10, expnt(s) = [3.15571466]
bas 11, expnt(s) = [0.23954138]
bas 12, expnt(s) = [1362.86019816]
bas 13, expnt(s) = [664.00262956]
bas 14, expnt(s) = [297.46325468]
bas 15, expnt(s) = [311.02723881]
bas 16, expnt(s) = [63.19028746]
bas 17, expnt(s) = [7.37858578]
bas 18, expnt(s) = [20.52960411]
bas 19, expnt(s) = [0.7771163]
bas 20, expnt(s) = [2.82572467]
bas 21, expnt(s) = [0.22284265]
CPU time:       563.18
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828889e+04 5.20029758e+03 7.61696678e+03 2.05992577e+03
 3.61754835e+03 1.17848968e+03 1.58530127e+03 6.34744403e+02
 4.26425503e+02 2.37081356e+02 1.84530688e+02 1.26492995e+02
 9.37849986e+01 7.61403829e+01 3.48698539e+01 3.62537236e+01
 7.97240722e+00 1.19869068e+01 6.56116170e-01 1.84183440e+00
 3.15571466e+00 5.98188859e+00 2.39541385e-01 8.65068386e-01
 1.36286020e+03 2.41573075e+04 6.64002630e+02 9.83324006e+03
 2.97463255e+02 3.60392753e+03 3.11027239e+02 3.81050402e+03
 6.31902875e+01 5.19753361e+02 7.37858578e+00 3.54773200e+01
 2.05296041e+01 1.27485300e+02 7.77116301e-01 2.12858950e+00
 2.82572467e+00 1.06880062e+01 2.22842647e-01 4.46665364e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99363639266649
cond(S) = 108582.48253238821
E1 = -729.5475546724045  E_coul = 203.17722460028006
init E= -526.370330072124
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555771339224096  LUMO = 0.991720679587223
  mo_energy =
[-1.18336374e+02 -1.22061900e+01 -9.44698379e+00 -9.44698379e+00
 -9.44698379e+00 -1.24016379e+00 -5.55771339e-01 -5.55771339e-01
 -5.55771339e-01  9.91720680e-01  1.03479259e+00  1.03479259e+00
  1.03479259e+00  7.39570455e+00  7.39570455e+00  7.39570455e+00
  1.21261096e+01  3.38764984e+01  3.38764984e+01  3.38764984e+01
  9.26621601e+01  1.31553136e+02  1.31553136e+02  1.31553136e+02
  3.81724489e+02  4.86689146e+02  4.86689146e+02  4.86689146e+02
  1.12871812e+03  1.33241428e+03  1.33241428e+03  1.33241428e+03
  3.01750223e+03  3.01750223e+03  3.01750223e+03  3.37049622e+03
  6.63162802e+03  6.63162802e+03  6.63162802e+03  9.78960151e+03
  2.61160384e+04  7.68116283e+04]
E1 = -727.8595716211136  E_coul = 201.10312807515768
cycle= 1 E= -526.756443545956  delta_E= -0.386  |g|= 0.186  |ddm|= 0.303
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.586806
diis-c [-0.34434175  1.        ]
  HOMO = -0.590733840692363  LUMO = 0.963884441102525
  mo_energy =
[-1.18644230e+02 -1.23440546e+01 -9.59567014e+00 -9.59567014e+00
 -9.59567014e+00 -1.27965899e+00 -5.90733841e-01 -5.90733841e-01
 -5.90733841e-01  9.63884441e-01  1.01034704e+00  1.01034704e+00
  1.01034704e+00  7.30444102e+00  7.30444102e+00  7.30444102e+00
  1.20184419e+01  3.37214125e+01  3.37214125e+01  3.37214125e+01
  9.24580294e+01  1.31323219e+02  1.31323219e+02  1.31323219e+02
  3.81441182e+02  4.86383260e+02  4.86383260e+02  4.86383260e+02
  1.12834951e+03  1.33205236e+03  1.33205236e+03  1.33205236e+03
  3.01707479e+03  3.01707479e+03  3.01707479e+03  3.37000334e+03
  6.63108806e+03  6.63108806e+03  6.63108806e+03  9.78899202e+03
  2.61153324e+04  7.68108310e+04]
E1 = -728.4341502471534  E_coul = 201.67698533179276
cycle= 2 E= -526.757164915361  delta_E= -0.000721  |g|= 0.0377  |ddm|= 0.0536
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766011
diis-c [-0.00387615  0.07104847  0.92895153]
  HOMO = -0.581495880613432  LUMO = 0.971987313766545
  mo_energy =
[-1.18575629e+02 -1.23054964e+01 -9.55543453e+00 -9.55543453e+00
 -9.55543453e+00 -1.26860262e+00 -5.81495881e-01 -5.81495881e-01
 -5.81495881e-01  9.71987314e-01  1.01718219e+00  1.01718219e+00
  1.01718219e+00  7.32859926e+00  7.32859926e+00  7.32859926e+00
  1.20483290e+01  3.37622103e+01  3.37622103e+01  3.37622103e+01
  9.25115059e+01  1.31380095e+02  1.31380095e+02  1.31380095e+02
  3.81506753e+02  4.86451005e+02  4.86451005e+02  4.86451005e+02
  1.12842103e+03  1.33212418e+03  1.33212418e+03  1.33212418e+03
  3.01714891e+03  3.01714891e+03  3.01714891e+03  3.37007844e+03
  6.63116397e+03  6.63116397e+03  6.63116397e+03  9.78906867e+03
  2.61154097e+04  7.68109086e+04]
E1 = -728.2818375868537  E_coul = 201.52461398294872
cycle= 3 E= -526.757223603905  delta_E= -5.87e-05  |g|= 0.00684  |ddm|= 0.0165
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0144494
diis-c [-7.22504248e-07 -1.20592515e-03  1.54659992e-01  8.46545933e-01]
  HOMO = -0.58311041055909  LUMO = 0.970666232854599
  mo_energy =
[-1.18586447e+02 -1.23117850e+01 -9.56209170e+00 -9.56209170e+00
 -9.56209170e+00 -1.27043141e+00 -5.83110411e-01 -5.83110411e-01
 -5.83110411e-01  9.70666233e-01  1.01601191e+00  1.01601191e+00
  1.01601191e+00  7.32450668e+00  7.32450668e+00  7.32450668e+00
  1.20434199e+01  3.37555023e+01  3.37555023e+01  3.37555023e+01
  9.25029631e+01  1.31371003e+02  1.31371003e+02  1.31371003e+02
  3.81496393e+02  4.86440317e+02  4.86440317e+02  4.86440317e+02
  1.12840972e+03  1.33211286e+03  1.33211286e+03  1.33211286e+03
  3.01713716e+03  3.01713716e+03  3.01713716e+03  3.37006646e+03
  6.63115181e+03  6.63115181e+03  6.63115181e+03  9.78905630e+03
  2.61153971e+04  7.68108959e+04]
E1 = -728.3065226139859  E_coul = 201.54929676223
cycle= 4 E= -526.757225851756  delta_E= -2.25e-06  |g|= 9.93e-05  |ddm|= 0.00245
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000108595
diis-c [-4.37856454e-09  7.54136343e-05 -1.11910026e-02 -6.55628210e-02
  1.07667841e+00]
  HOMO = -0.583091251184149  LUMO = 0.970700490036478
  mo_energy =
[-1.18586399e+02 -1.23117162e+01 -9.56203620e+00 -9.56203620e+00
 -9.56203620e+00 -1.27038927e+00 -5.83091251e-01 -5.83091251e-01
 -5.83091251e-01  9.70700490e-01  1.01602840e+00  1.01602840e+00
  1.01602840e+00  7.32455089e+00  7.32455089e+00  7.32455089e+00
  1.20434823e+01  3.37555559e+01  3.37555559e+01  3.37555559e+01
  9.25030227e+01  1.31371057e+02  1.31371057e+02  1.31371057e+02
  3.81496443e+02  4.86440366e+02  4.86440366e+02  4.86440366e+02
  1.12840976e+03  1.33211290e+03  1.33211290e+03  1.33211290e+03
  3.01713719e+03  3.01713719e+03  3.01713719e+03  3.37006648e+03
  6.63115183e+03  6.63115183e+03  6.63115183e+03  9.78905631e+03
  2.61153971e+04  7.68108959e+04]
E1 = -728.306290692527  E_coul = 201.54906483902877
cycle= 5 E= -526.757225853498  delta_E= -1.74e-09  |g|= 2.06e-05  |ddm|= 0.00016
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.9028e-05
diis-c [-8.00364837e-11  1.26570323e-05 -1.86904145e-03 -1.28175182e-02
  3.65429866e-02  9.78130916e-01]
  HOMO = -0.583098730231354  LUMO = 0.970696639622734
  mo_energy =
[-1.18586430e+02 -1.23117388e+01 -9.56206072e+00 -9.56206072e+00
 -9.56206072e+00 -1.27039520e+00 -5.83098730e-01 -5.83098730e-01
 -5.83098730e-01  9.70696640e-01  1.01602343e+00  1.01602343e+00
  1.01602343e+00  7.32453420e+00  7.32453420e+00  7.32453420e+00
  1.20434643e+01  3.37555321e+01  3.37555321e+01  3.37555321e+01
  9.25029958e+01  1.31371029e+02  1.31371029e+02  1.31371029e+02
  3.81496413e+02  4.86440336e+02  4.86440336e+02  4.86440336e+02
  1.12840973e+03  1.33211286e+03  1.33211286e+03  1.33211286e+03
  3.01713716e+03  3.01713716e+03  3.01713716e+03  3.37006645e+03
  6.63115179e+03  6.63115179e+03  6.63115179e+03  9.78905628e+03
  2.61153971e+04  7.68108959e+04]
E1 = -728.306371944359  E_coul = 201.54914609080078
cycle= 6 E= -526.757225853558  delta_E= -5.99e-11  |g|= 1.79e-06  |ddm|= 1.88e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.306371944359  E_coul = 201.54914609080078
  HOMO = -0.583098697007354  LUMO = 0.970697023424491
  mo_energy =
[-1.18586429e+02 -1.23117384e+01 -9.56206047e+00 -9.56206047e+00
 -9.56206047e+00 -1.27039476e+00 -5.83098697e-01 -5.83098697e-01
 -5.83098697e-01  9.70697023e-01  1.01602351e+00  1.01602351e+00
  1.01602351e+00  7.32453438e+00  7.32453438e+00  7.32453438e+00
  1.20434646e+01  3.37555323e+01  3.37555323e+01  3.37555323e+01
  9.25029962e+01  1.31371029e+02  1.31371029e+02  1.31371029e+02
  3.81496413e+02  4.86440336e+02  4.86440336e+02  4.86440336e+02
  1.12840973e+03  1.33211286e+03  1.33211286e+03  1.33211286e+03
  3.01713716e+03  3.01713716e+03  3.01713716e+03  3.37006645e+03
  6.63115179e+03  6.63115179e+03  6.63115179e+03  9.78905628e+03
  2.61153971e+04  7.68108959e+04]
E1 = -728.3063702150511  E_coul = 201.54914436149193
Extra cycle  E= -526.757225853559  delta_E= -1.02e-12  |g|= 3.7e-07  |ddm|= 3.15e-06
    CPU time for scf_cycle      0.27 sec, wall time      0.24 sec
exp = [2.61828889e+04 7.61696678e+03 3.61754835e+03 1.58530127e+03
 4.26425503e+02 1.84530688e+02 9.37849986e+01 3.48698539e+01
 7.97240722e+00 6.56116170e-01 3.15571466e+00 2.39541385e-01
 1.36286020e+03 6.64002630e+02 2.97463255e+02 3.11027239e+02
 6.31902875e+01 7.37858578e+00 2.05296041e+01 7.77116301e-01
 2.82572467e+00 2.22842647e-01]
E = -526.7572258535591
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:51 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8888731        1
[INPUT] 0    0    [1    /1   ]  7616.96677618        1
[INPUT] 0    0    [1    /1   ]  3617.54835481        1
[INPUT] 0    0    [1    /1   ]  1585.3012712         1
[INPUT] 0    0    [1    /1   ]  426.425503328        1
[INPUT] 0    0    [1    /1   ]  184.530688078        1
[INPUT] 0    0    [1    /1   ]  93.7849985888        1
[INPUT] 0    0    [1    /1   ]  34.8698538649        1
[INPUT] 0    0    [1    /1   ]  7.97240722224        1
[INPUT] 0    0    [1    /1   ]  0.656116170437       1
[INPUT] 0    0    [1    /1   ]  3.15571466314        1
[INPUT] 0    0    [1    /1   ]  0.239541384724       1
[INPUT] 1    0    [1    /1   ]  1362.86019816        1
[INPUT] 1    0    [1    /1   ]  664.002629558        1
[INPUT] 1    0    [1    /1   ]  297.463254685        1
[INPUT] 1    0    [1    /1   ]  311.02723881         1
[INPUT] 1    0    [1    /1   ]  63.1902874638        1
[INPUT] 1    0    [1    /1   ]  7.37858577573        1
[INPUT] 1    0    [1    /1   ]  20.5296041093        1
[INPUT] 1    0    [1    /1   ]  0.777116301034       1
[INPUT] 1    0    [1    /1   ]  2.82572467443        1
[INPUT] 1    0    [1    /1   ]  0.222842646636       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.88887311664, 1.0]], [0, [7616.966776176121, 1.0]], [0, [3617.548354806711, 1.0]], [0, [1585.301271198211, 1.0]], [0, [426.4255033281796, 1.0]], [0, [184.53068807796976, 1.0]], [0, [93.78499858878077, 1.0]], [0, [34.869853864914255, 1.0]], [0, [7.972407222238494, 1.0]], [0, [0.6561161704370339, 1.0]], [0, [3.1557146631447313, 1.0]], [0, [0.2395413847237856, 1.0]], [1, [1362.8601981577744, 1.0]], [1, [664.0026295577692, 1.0]], [1, [297.46325468478955, 1.0]], [1, [311.0272388095606, 1.0]], [1, [63.190287463815, 1.0]], [1, [7.378585775727549, 1.0]], [1, [20.52960410925404, 1.0]], [1, [0.7771163010339048, 1.0]], [1, [2.8257246744304187, 1.0]], [1, [0.22284264663607073, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.88887312]
bas 1, expnt(s) = [7616.96677618]
bas 2, expnt(s) = [3617.54835481]
bas 3, expnt(s) = [1585.3012712]
bas 4, expnt(s) = [426.42550333]
bas 5, expnt(s) = [184.53068808]
bas 6, expnt(s) = [93.78499859]
bas 7, expnt(s) = [34.86985386]
bas 8, expnt(s) = [7.97240722]
bas 9, expnt(s) = [0.65611617]
bas 10, expnt(s) = [3.15571466]
bas 11, expnt(s) = [0.23954138]
bas 12, expnt(s) = [1362.86019816]
bas 13, expnt(s) = [664.00262956]
bas 14, expnt(s) = [297.46325468]
bas 15, expnt(s) = [311.02723881]
bas 16, expnt(s) = [63.19028746]
bas 17, expnt(s) = [7.37858578]
bas 18, expnt(s) = [20.52960411]
bas 19, expnt(s) = [0.7771163]
bas 20, expnt(s) = [2.82572467]
bas 21, expnt(s) = [0.22284265]
CPU time:       563.73
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828889e+04 5.20029758e+03 7.61696678e+03 2.05992577e+03
 3.61754835e+03 1.17848968e+03 1.58530127e+03 6.34744403e+02
 4.26425503e+02 2.37081356e+02 1.84530688e+02 1.26492995e+02
 9.37849986e+01 7.61403829e+01 3.48698539e+01 3.62537236e+01
 7.97240722e+00 1.19869068e+01 6.56116170e-01 1.84183440e+00
 3.15571466e+00 5.98188859e+00 2.39541385e-01 8.65068386e-01
 1.36286020e+03 2.41573075e+04 6.64002630e+02 9.83324006e+03
 2.97463255e+02 3.60392753e+03 3.11027239e+02 3.81050402e+03
 6.31902875e+01 5.19753361e+02 7.37858578e+00 3.54773200e+01
 2.05296041e+01 1.27485300e+02 7.77116301e-01 2.12858950e+00
 2.82572467e+00 1.06880062e+01 2.22842647e-01 4.46665364e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99363639266649
cond(S) = 108582.48253238821
E1 = -729.5475546724045  E_coul = 203.17722460028006
init E= -526.370330072124
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555771339224096  LUMO = 0.991720679587223
  mo_energy =
[-1.18336374e+02 -1.22061900e+01 -9.44698379e+00 -9.44698379e+00
 -9.44698379e+00 -1.24016379e+00 -5.55771339e-01 -5.55771339e-01
 -5.55771339e-01  9.91720680e-01  1.03479259e+00  1.03479259e+00
  1.03479259e+00  7.39570455e+00  7.39570455e+00  7.39570455e+00
  1.21261096e+01  3.38764984e+01  3.38764984e+01  3.38764984e+01
  9.26621601e+01  1.31553136e+02  1.31553136e+02  1.31553136e+02
  3.81724489e+02  4.86689146e+02  4.86689146e+02  4.86689146e+02
  1.12871812e+03  1.33241428e+03  1.33241428e+03  1.33241428e+03
  3.01750223e+03  3.01750223e+03  3.01750223e+03  3.37049622e+03
  6.63162802e+03  6.63162802e+03  6.63162802e+03  9.78960151e+03
  2.61160384e+04  7.68116283e+04]
E1 = -727.8595716211136  E_coul = 201.10312807515768
cycle= 1 E= -526.756443545956  delta_E= -0.386  |g|= 0.186  |ddm|= 0.303
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.586806
diis-c [-0.34434175  1.        ]
  HOMO = -0.590733840692363  LUMO = 0.963884441102525
  mo_energy =
[-1.18644230e+02 -1.23440546e+01 -9.59567014e+00 -9.59567014e+00
 -9.59567014e+00 -1.27965899e+00 -5.90733841e-01 -5.90733841e-01
 -5.90733841e-01  9.63884441e-01  1.01034704e+00  1.01034704e+00
  1.01034704e+00  7.30444102e+00  7.30444102e+00  7.30444102e+00
  1.20184419e+01  3.37214125e+01  3.37214125e+01  3.37214125e+01
  9.24580294e+01  1.31323219e+02  1.31323219e+02  1.31323219e+02
  3.81441182e+02  4.86383260e+02  4.86383260e+02  4.86383260e+02
  1.12834951e+03  1.33205236e+03  1.33205236e+03  1.33205236e+03
  3.01707479e+03  3.01707479e+03  3.01707479e+03  3.37000334e+03
  6.63108806e+03  6.63108806e+03  6.63108806e+03  9.78899202e+03
  2.61153324e+04  7.68108310e+04]
E1 = -728.4341502471534  E_coul = 201.67698533179276
cycle= 2 E= -526.757164915361  delta_E= -0.000721  |g|= 0.0377  |ddm|= 0.0536
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766011
diis-c [-0.00387615  0.07104847  0.92895153]
  HOMO = -0.581495880613432  LUMO = 0.971987313766545
  mo_energy =
[-1.18575629e+02 -1.23054964e+01 -9.55543453e+00 -9.55543453e+00
 -9.55543453e+00 -1.26860262e+00 -5.81495881e-01 -5.81495881e-01
 -5.81495881e-01  9.71987314e-01  1.01718219e+00  1.01718219e+00
  1.01718219e+00  7.32859926e+00  7.32859926e+00  7.32859926e+00
  1.20483290e+01  3.37622103e+01  3.37622103e+01  3.37622103e+01
  9.25115059e+01  1.31380095e+02  1.31380095e+02  1.31380095e+02
  3.81506753e+02  4.86451005e+02  4.86451005e+02  4.86451005e+02
  1.12842103e+03  1.33212418e+03  1.33212418e+03  1.33212418e+03
  3.01714891e+03  3.01714891e+03  3.01714891e+03  3.37007844e+03
  6.63116397e+03  6.63116397e+03  6.63116397e+03  9.78906867e+03
  2.61154097e+04  7.68109086e+04]
E1 = -728.2818375868537  E_coul = 201.52461398294872
cycle= 3 E= -526.757223603905  delta_E= -5.87e-05  |g|= 0.00684  |ddm|= 0.0165
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0144494
diis-c [-7.22504248e-07 -1.20592515e-03  1.54659992e-01  8.46545933e-01]
  HOMO = -0.58311041055909  LUMO = 0.970666232854599
  mo_energy =
[-1.18586447e+02 -1.23117850e+01 -9.56209170e+00 -9.56209170e+00
 -9.56209170e+00 -1.27043141e+00 -5.83110411e-01 -5.83110411e-01
 -5.83110411e-01  9.70666233e-01  1.01601191e+00  1.01601191e+00
  1.01601191e+00  7.32450668e+00  7.32450668e+00  7.32450668e+00
  1.20434199e+01  3.37555023e+01  3.37555023e+01  3.37555023e+01
  9.25029631e+01  1.31371003e+02  1.31371003e+02  1.31371003e+02
  3.81496393e+02  4.86440317e+02  4.86440317e+02  4.86440317e+02
  1.12840972e+03  1.33211286e+03  1.33211286e+03  1.33211286e+03
  3.01713716e+03  3.01713716e+03  3.01713716e+03  3.37006646e+03
  6.63115181e+03  6.63115181e+03  6.63115181e+03  9.78905630e+03
  2.61153971e+04  7.68108959e+04]
E1 = -728.3065226139859  E_coul = 201.54929676223
cycle= 4 E= -526.757225851756  delta_E= -2.25e-06  |g|= 9.93e-05  |ddm|= 0.00245
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000108595
diis-c [-4.37856454e-09  7.54136343e-05 -1.11910026e-02 -6.55628210e-02
  1.07667841e+00]
  HOMO = -0.583091251184149  LUMO = 0.970700490036478
  mo_energy =
[-1.18586399e+02 -1.23117162e+01 -9.56203620e+00 -9.56203620e+00
 -9.56203620e+00 -1.27038927e+00 -5.83091251e-01 -5.83091251e-01
 -5.83091251e-01  9.70700490e-01  1.01602840e+00  1.01602840e+00
  1.01602840e+00  7.32455089e+00  7.32455089e+00  7.32455089e+00
  1.20434823e+01  3.37555559e+01  3.37555559e+01  3.37555559e+01
  9.25030227e+01  1.31371057e+02  1.31371057e+02  1.31371057e+02
  3.81496443e+02  4.86440366e+02  4.86440366e+02  4.86440366e+02
  1.12840976e+03  1.33211290e+03  1.33211290e+03  1.33211290e+03
  3.01713719e+03  3.01713719e+03  3.01713719e+03  3.37006648e+03
  6.63115183e+03  6.63115183e+03  6.63115183e+03  9.78905631e+03
  2.61153971e+04  7.68108959e+04]
E1 = -728.306290692527  E_coul = 201.54906483902877
cycle= 5 E= -526.757225853498  delta_E= -1.74e-09  |g|= 2.06e-05  |ddm|= 0.00016
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.9028e-05
diis-c [-8.00364837e-11  1.26570323e-05 -1.86904145e-03 -1.28175182e-02
  3.65429866e-02  9.78130916e-01]
  HOMO = -0.583098730231354  LUMO = 0.970696639622734
  mo_energy =
[-1.18586430e+02 -1.23117388e+01 -9.56206072e+00 -9.56206072e+00
 -9.56206072e+00 -1.27039520e+00 -5.83098730e-01 -5.83098730e-01
 -5.83098730e-01  9.70696640e-01  1.01602343e+00  1.01602343e+00
  1.01602343e+00  7.32453420e+00  7.32453420e+00  7.32453420e+00
  1.20434643e+01  3.37555321e+01  3.37555321e+01  3.37555321e+01
  9.25029958e+01  1.31371029e+02  1.31371029e+02  1.31371029e+02
  3.81496413e+02  4.86440336e+02  4.86440336e+02  4.86440336e+02
  1.12840973e+03  1.33211286e+03  1.33211286e+03  1.33211286e+03
  3.01713716e+03  3.01713716e+03  3.01713716e+03  3.37006645e+03
  6.63115179e+03  6.63115179e+03  6.63115179e+03  9.78905628e+03
  2.61153971e+04  7.68108959e+04]
E1 = -728.306371944359  E_coul = 201.54914609080078
cycle= 6 E= -526.757225853558  delta_E= -5.99e-11  |g|= 1.79e-06  |ddm|= 1.88e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.306371944359  E_coul = 201.54914609080078
  HOMO = -0.583098697007354  LUMO = 0.970697023424491
  mo_energy =
[-1.18586429e+02 -1.23117384e+01 -9.56206047e+00 -9.56206047e+00
 -9.56206047e+00 -1.27039476e+00 -5.83098697e-01 -5.83098697e-01
 -5.83098697e-01  9.70697023e-01  1.01602351e+00  1.01602351e+00
  1.01602351e+00  7.32453438e+00  7.32453438e+00  7.32453438e+00
  1.20434646e+01  3.37555323e+01  3.37555323e+01  3.37555323e+01
  9.25029962e+01  1.31371029e+02  1.31371029e+02  1.31371029e+02
  3.81496413e+02  4.86440336e+02  4.86440336e+02  4.86440336e+02
  1.12840973e+03  1.33211286e+03  1.33211286e+03  1.33211286e+03
  3.01713716e+03  3.01713716e+03  3.01713716e+03  3.37006645e+03
  6.63115179e+03  6.63115179e+03  6.63115179e+03  9.78905628e+03
  2.61153971e+04  7.68108959e+04]
E1 = -728.3063702150511  E_coul = 201.54914436149193
Extra cycle  E= -526.757225853559  delta_E= -1.02e-12  |g|= 3.7e-07  |ddm|= 3.15e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 108582.48253238821
E1 = -728.3063702150511  E_coul = 201.54914436149193
init E= -526.757225853559
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583098744089646  LUMO = 0.970697056896135
  mo_energy =
[-1.18586429e+02 -1.23117385e+01 -9.56206062e+00 -9.56206062e+00
 -9.56206062e+00 -1.27039473e+00 -5.83098744e-01 -5.83098744e-01
 -5.83098744e-01  9.70697057e-01  1.01602349e+00  1.01602349e+00
  1.01602349e+00  7.32453428e+00  7.32453428e+00  7.32453428e+00
  1.20434646e+01  3.37555322e+01  3.37555322e+01  3.37555322e+01
  9.25029960e+01  1.31371029e+02  1.31371029e+02  1.31371029e+02
  3.81496413e+02  4.86440336e+02  4.86440336e+02  4.86440336e+02
  1.12840973e+03  1.33211286e+03  1.33211286e+03  1.33211286e+03
  3.01713716e+03  3.01713716e+03  3.01713716e+03  3.37006645e+03
  6.63115179e+03  6.63115179e+03  6.63115179e+03  9.78905628e+03
  2.61153971e+04  7.68108959e+04]
E1 = -728.3063705729097  E_coul = 201.54914471934987
cycle= 1 E= -526.75722585356  delta_E= -6.82e-13  |g|= 8.02e-08  |ddm|= 6.03e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.3063705729097  E_coul = 201.54914471934987
  HOMO = -0.583098740032079  LUMO = 0.970697075326756
  mo_energy =
[-1.18586429e+02 -1.23117385e+01 -9.56206059e+00 -9.56206059e+00
 -9.56206059e+00 -1.27039471e+00 -5.83098740e-01 -5.83098740e-01
 -5.83098740e-01  9.70697075e-01  1.01602349e+00  1.01602349e+00
  1.01602349e+00  7.32453430e+00  7.32453430e+00  7.32453430e+00
  1.20434646e+01  3.37555322e+01  3.37555322e+01  3.37555322e+01
  9.25029961e+01  1.31371029e+02  1.31371029e+02  1.31371029e+02
  3.81496413e+02  4.86440336e+02  4.86440336e+02  4.86440336e+02
  1.12840973e+03  1.33211286e+03  1.33211286e+03  1.33211286e+03
  3.01713716e+03  3.01713716e+03  3.01713716e+03  3.37006645e+03
  6.63115179e+03  6.63115179e+03  6.63115179e+03  9.78905628e+03
  2.61153971e+04  7.68108959e+04]
E1 = -728.3063704460129  E_coul = 201.54914459245498
Extra cycle  E= -526.757225853558  delta_E= 1.93e-12  |g|= 1.65e-08  |ddm|= 1.32e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.45 sec
exp = [2.61828889e+04 7.61696678e+03 3.61754835e+03 1.58530127e+03
 4.26425503e+02 1.84530688e+02 9.37849986e+01 3.48698539e+01
 7.97240722e+00 6.56116170e-01 3.15571466e+00 2.39541385e-01
 1.36286020e+03 6.64002630e+02 2.97463255e+02 3.11027239e+02
 6.31902875e+01 7.37858578e+00 2.05296041e+01 7.77116301e-01
 2.82572467e+00 2.22842647e-01]
grad_E = [-1.46206325e-06  2.73338389e-06 -2.16512412e-06  5.72522783e-05
 -2.59825693e-04  7.82367728e-05  1.32196180e-04  1.62446420e-04
  6.52305535e-05 -1.06294707e-03 -1.88774047e-04  2.37014390e-03
 -6.18788419e-07  3.55456646e-06  1.56364928e-05  1.33259049e-05
  2.66985567e-04 -9.09792567e-04 -3.50418344e-04  9.26235418e-04
  1.01119091e-03 -3.16122371e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:55 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8944567        1
[INPUT] 0    0    [1    /1   ]  7616.95348794        1
[INPUT] 0    0    [1    /1   ]  3617.55307267        1
[INPUT] 0    0    [1    /1   ]  1585.00239572        1
[INPUT] 0    0    [1    /1   ]  427.388461739        1
[INPUT] 0    0    [1    /1   ]  187.05871649         1
[INPUT] 0    0    [1    /1   ]  93.8311365354        1
[INPUT] 0    0    [1    /1   ]  34.6185550375        1
[INPUT] 0    0    [1    /1   ]  7.90965127534        1
[INPUT] 0    0    [1    /1   ]  0.657775185462       1
[INPUT] 0    0    [1    /1   ]  3.12717408438        1
[INPUT] 0    0    [1    /1   ]  0.239633307246       1
[INPUT] 1    0    [1    /1   ]  1362.86205443        1
[INPUT] 1    0    [1    /1   ]  663.984972951        1
[INPUT] 1    0    [1    /1   ]  297.380318147        1
[INPUT] 1    0    [1    /1   ]  310.95576087         1
[INPUT] 1    0    [1    /1   ]  63.1503984138        1
[INPUT] 1    0    [1    /1   ]  7.48942617275        1
[INPUT] 1    0    [1    /1   ]  20.7341174009        1
[INPUT] 1    0    [1    /1   ]  0.781768273869       1
[INPUT] 1    0    [1    /1   ]  2.86573371279        1
[INPUT] 1    0    [1    /1   ]  0.223902600061       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.8944567098, 1.0]], [0, [7616.953487943054, 1.0]], [0, [3617.5530726657266, 1.0]], [0, [1585.002395716493, 1.0]], [0, [427.3884617387531, 1.0]], [0, [187.0587164903321, 1.0]], [0, [93.83113653537166, 1.0]], [0, [34.61855503754067, 1.0]], [0, [7.909651275337506, 1.0]], [0, [0.6577751854616466, 1.0]], [0, [3.127174084375501, 1.0]], [0, [0.2396333072458774, 1.0]], [1, [1362.862054425889, 1.0]], [1, [663.9849729511434, 1.0]], [1, [297.3803181467342, 1.0]], [1, [310.9557608696041, 1.0]], [1, [63.15039841378198, 1.0]], [1, [7.4894261727536495, 1.0]], [1, [20.734117400933947, 1.0]], [1, [0.7817682738690297, 1.0]], [1, [2.8657337127897686, 1.0]], [1, [0.22390260006069584, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.89445671]
bas 1, expnt(s) = [7616.95348794]
bas 2, expnt(s) = [3617.55307267]
bas 3, expnt(s) = [1585.00239572]
bas 4, expnt(s) = [427.38846174]
bas 5, expnt(s) = [187.05871649]
bas 6, expnt(s) = [93.83113654]
bas 7, expnt(s) = [34.61855504]
bas 8, expnt(s) = [7.90965128]
bas 9, expnt(s) = [0.65777519]
bas 10, expnt(s) = [3.12717408]
bas 11, expnt(s) = [0.23963331]
bas 12, expnt(s) = [1362.86205443]
bas 13, expnt(s) = [663.98497295]
bas 14, expnt(s) = [297.38031815]
bas 15, expnt(s) = [310.95576087]
bas 16, expnt(s) = [63.15039841]
bas 17, expnt(s) = [7.48942617]
bas 18, expnt(s) = [20.7341174]
bas 19, expnt(s) = [0.78176827]
bas 20, expnt(s) = [2.86573371]
bas 21, expnt(s) = [0.2239026]
CPU time:       569.29
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828945e+04 5.20029841e+03 7.61695349e+03 2.05992307e+03
 3.61755307e+03 1.17849083e+03 1.58500240e+03 6.34654650e+02
 4.27388462e+02 2.37482777e+02 1.87058716e+02 1.27790476e+02
 9.38311365e+01 7.61684744e+01 3.46185550e+01 3.60575925e+01
 7.90965128e+00 1.19160695e+01 6.57775185e-01 1.84532616e+00
 3.12717408e+00 5.94126697e+00 2.39633307e-01 8.65317348e-01
 1.36286205e+03 2.41573487e+04 6.63984973e+02 9.83291321e+03
 2.97380318e+02 3.60267155e+03 3.10955761e+02 3.80940942e+03
 6.31503984e+01 5.19343274e+02 7.48942617e+00 3.61447373e+01
 2.07341174e+01 1.29074762e+02 7.81768274e-01 2.14452910e+00
 2.86573371e+00 1.08775023e+01 2.23902600e-01 4.49322652e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993472542306282
cond(S) = 108518.65053406596
E1 = -729.5475099413741  E_coul = 203.17712553189816
init E= -526.370384409476
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555722469491079  LUMO = 0.992711973038852
  mo_energy =
[-1.18336406e+02 -1.22062051e+01 -9.44705587e+00 -9.44705587e+00
 -9.44705587e+00 -1.24016086e+00 -5.55722469e-01 -5.55722469e-01
 -5.55722469e-01  9.92711973e-01  1.04309128e+00  1.04309128e+00
  1.04309128e+00  7.51611844e+00  7.51611844e+00  7.51611844e+00
  1.19906290e+01  3.44364843e+01  3.44364843e+01  3.44364843e+01
  9.20548188e+01  1.32606560e+02  1.32606560e+02  1.32606560e+02
  3.82249851e+02  4.87656389e+02  4.87656389e+02  4.87656389e+02
  1.13380745e+03  1.33310663e+03  1.33310663e+03  1.33310663e+03
  3.01790538e+03  3.01790538e+03  3.01790538e+03  3.38031445e+03
  6.63181179e+03  6.63181179e+03  6.63181179e+03  9.80059257e+03
  2.61267732e+04  7.68216848e+04]
E1 = -727.8639531317907  E_coul = 201.10737315204594
cycle= 1 E= -526.756579979745  delta_E= -0.386  |g|= 0.186  |ddm|= 0.307
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.586729
diis-c [-0.3442504  1.       ]
  HOMO = -0.590477415907689  LUMO = 0.965109594413869
  mo_energy =
[-1.18644057e+02 -1.23437348e+01 -9.59549095e+00 -9.59549095e+00
 -9.59549095e+00 -1.27940267e+00 -5.90477416e-01 -5.90477416e-01
 -5.90477416e-01  9.65109594e-01  1.01858346e+00  1.01858346e+00
  1.01858346e+00  7.42429180e+00  7.42429180e+00  7.42429180e+00
  1.18838633e+01  3.42809139e+01  3.42809139e+01  3.42809139e+01
  9.18510836e+01  1.32376907e+02  1.32376907e+02  1.32376907e+02
  3.81966262e+02  4.87350760e+02  4.87350760e+02  4.87350760e+02
  1.13343837e+03  1.33274487e+03  1.33274487e+03  1.33274487e+03
  3.01747799e+03  3.01747799e+03  3.01747799e+03  3.37982145e+03
  6.63127178e+03  6.63127178e+03  6.63127178e+03  9.79998301e+03
  2.61260671e+04  7.68208873e+04]
E1 = -728.4367878538031  E_coul = 201.6794884987946
cycle= 2 E= -526.757299355009  delta_E= -0.000719  |g|= 0.0376  |ddm|= 0.0534
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076606
diis-c [-0.00386211  0.07130065  0.92869935]
  HOMO = -0.581284056181991  LUMO = 0.973170949076997
  mo_energy =
[-1.18575614e+02 -1.23053069e+01 -9.55539101e+00 -9.55539101e+00
 -9.55539101e+00 -1.26839824e+00 -5.81284056e-01 -5.81284056e-01
 -5.81284056e-01  9.73170949e-01  1.02544717e+00  1.02544717e+00
  1.02544717e+00  7.44857865e+00  7.44857865e+00  7.44857865e+00
  1.19134852e+01  3.43217539e+01  3.43217539e+01  3.43217539e+01
  9.19043830e+01  1.32433640e+02  1.32433640e+02  1.32433640e+02
  3.82031729e+02  4.87418332e+02  4.87418332e+02  4.87418332e+02
  1.13350976e+03  1.33281653e+03  1.33281653e+03  1.33281653e+03
  3.01755195e+03  3.01755195e+03  3.01755195e+03  3.37989639e+03
  6.63134751e+03  6.63134751e+03  6.63134751e+03  9.80005948e+03
  2.61261442e+04  7.68209647e+04]
E1 = -728.2851941727747  E_coul = 201.52783649405112
cycle= 3 E= -526.757357678724  delta_E= -5.83e-05  |g|= 0.0068  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0144018
diis-c [-7.38068730e-07 -1.20934284e-03  1.54173658e-01  8.47035684e-01]
  HOMO = -0.582886354336743  LUMO = 0.971861915980983
  mo_energy =
[-1.18586372e+02 -1.23115545e+01 -9.56200698e+00 -9.56200698e+00
 -9.56200698e+00 -1.27021183e+00 -5.82886354e-01 -5.82886354e-01
 -5.82886354e-01  9.71861916e-01  1.02427553e+00  1.02427553e+00
  1.02427553e+00  7.44447699e+00  7.44447699e+00  7.44447699e+00
  1.19086341e+01  3.43150606e+01  3.43150606e+01  3.43150606e+01
  9.18958965e+01  1.32424599e+02  1.32424599e+02  1.32424599e+02
  3.82021420e+02  4.87407707e+02  4.87407707e+02  4.87407707e+02
  1.13349851e+03  1.33280527e+03  1.33280527e+03  1.33280527e+03
  3.01754027e+03  3.01754027e+03  3.01754027e+03  3.37988447e+03
  6.63133541e+03  6.63133541e+03  6.63133541e+03  9.80004718e+03
  2.61261317e+04  7.68209521e+04]
E1 = -728.3096836804206  E_coul = 201.55232378482592
cycle= 4 E= -526.757359895595  delta_E= -2.22e-06  |g|= 0.0001  |ddm|= 0.00243
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000110577
diis-c [-4.39853586e-09  7.64437639e-05 -1.13158853e-02 -6.66221134e-02
  1.07786155e+00]
  HOMO = -0.582867369211797  LUMO = 0.971896190671738
  mo_energy =
[-1.18586324e+02 -1.23114862e+01 -9.56195215e+00 -9.56195215e+00
 -9.56195215e+00 -1.27016971e+00 -5.82867369e-01 -5.82867369e-01
 -5.82867369e-01  9.71896191e-01  1.02429203e+00  1.02429203e+00
  1.02429203e+00  7.44452098e+00  7.44452098e+00  7.44452098e+00
  1.19086960e+01  3.43151137e+01  3.43151137e+01  3.43151137e+01
  9.18959554e+01  1.32424653e+02  1.32424653e+02  1.32424653e+02
  3.82021469e+02  4.87407755e+02  4.87407755e+02  4.87407755e+02
  1.13349855e+03  1.33280531e+03  1.33280531e+03  1.33280531e+03
  3.01754030e+03  3.01754030e+03  3.01754030e+03  3.37988449e+03
  6.63133543e+03  6.63133543e+03  6.63133543e+03  9.80004719e+03
  2.61261317e+04  7.68209521e+04]
E1 = -728.3094537919104  E_coul = 201.55209389454348
cycle= 5 E= -526.757359897367  delta_E= -1.77e-09  |g|= 2.07e-05  |ddm|= 0.000161
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.90816e-05
diis-c [-8.14844397e-11  1.25499275e-05 -1.84522590e-03 -1.27413068e-02
  3.69442906e-02  9.77629692e-01]
  HOMO = -0.582874871700044  LUMO = 0.971892324619085
  mo_energy =
[-1.18586355e+02 -1.23115088e+01 -9.56197675e+00 -9.56197675e+00
 -9.56197675e+00 -1.27017566e+00 -5.82874872e-01 -5.82874872e-01
 -5.82874872e-01  9.71892325e-01  1.02428700e+00  1.02428700e+00
  1.02428700e+00  7.44450411e+00  7.44450411e+00  7.44450411e+00
  1.19086780e+01  3.43150897e+01  3.43150897e+01  3.43150897e+01
  9.18959284e+01  1.32424625e+02  1.32424625e+02  1.32424625e+02
  3.82021439e+02  4.87407724e+02  4.87407724e+02  4.87407724e+02
  1.13349852e+03  1.33280528e+03  1.33280528e+03  1.33280528e+03
  3.01754026e+03  3.01754026e+03  3.01754026e+03  3.37988446e+03
  6.63133539e+03  6.63133539e+03  6.63133539e+03  9.80004716e+03
  2.61261317e+04  7.68209521e+04]
E1 = -728.3095350418499  E_coul = 201.55217514442384
cycle= 6 E= -526.757359897426  delta_E= -5.91e-11  |g|= 1.81e-06  |ddm|= 1.89e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.3095350418499  E_coul = 201.55217514442384
  HOMO = -0.582874835150209  LUMO = 0.971892713146263
  mo_energy =
[-1.18586355e+02 -1.23115085e+01 -9.56197648e+00 -9.56197648e+00
 -9.56197648e+00 -1.27017521e+00 -5.82874835e-01 -5.82874835e-01
 -5.82874835e-01  9.71892713e-01  1.02428708e+00  1.02428708e+00
  1.02428708e+00  7.44450430e+00  7.44450430e+00  7.44450430e+00
  1.19086784e+01  3.43150900e+01  3.43150900e+01  3.43150900e+01
  9.18959288e+01  1.32424625e+02  1.32424625e+02  1.32424625e+02
  3.82021439e+02  4.87407725e+02  4.87407725e+02  4.87407725e+02
  1.13349852e+03  1.33280528e+03  1.33280528e+03  1.33280528e+03
  3.01754026e+03  3.01754026e+03  3.01754026e+03  3.37988446e+03
  6.63133540e+03  6.63133540e+03  6.63133540e+03  9.80004716e+03
  2.61261317e+04  7.68209521e+04]
E1 = -728.3095332301282  E_coul = 201.55217333270195
Extra cycle  E= -526.757359897426  delta_E= -1.14e-13  |g|= 3.73e-07  |ddm|= 3.17e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
exp = [2.61828945e+04 7.61695349e+03 3.61755307e+03 1.58500240e+03
 4.27388462e+02 1.87058716e+02 9.38311365e+01 3.46185550e+01
 7.90965128e+00 6.57775185e-01 3.12717408e+00 2.39633307e-01
 1.36286205e+03 6.63984973e+02 2.97380318e+02 3.10955761e+02
 6.31503984e+01 7.48942617e+00 2.07341174e+01 7.81768274e-01
 2.86573371e+00 2.23902600e-01]
E = -526.7573598974262
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:28:56 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8944567        1
[INPUT] 0    0    [1    /1   ]  7616.95348794        1
[INPUT] 0    0    [1    /1   ]  3617.55307267        1
[INPUT] 0    0    [1    /1   ]  1585.00239572        1
[INPUT] 0    0    [1    /1   ]  427.388461739        1
[INPUT] 0    0    [1    /1   ]  187.05871649         1
[INPUT] 0    0    [1    /1   ]  93.8311365354        1
[INPUT] 0    0    [1    /1   ]  34.6185550375        1
[INPUT] 0    0    [1    /1   ]  7.90965127534        1
[INPUT] 0    0    [1    /1   ]  0.657775185462       1
[INPUT] 0    0    [1    /1   ]  3.12717408438        1
[INPUT] 0    0    [1    /1   ]  0.239633307246       1
[INPUT] 1    0    [1    /1   ]  1362.86205443        1
[INPUT] 1    0    [1    /1   ]  663.984972951        1
[INPUT] 1    0    [1    /1   ]  297.380318147        1
[INPUT] 1    0    [1    /1   ]  310.95576087         1
[INPUT] 1    0    [1    /1   ]  63.1503984138        1
[INPUT] 1    0    [1    /1   ]  7.48942617275        1
[INPUT] 1    0    [1    /1   ]  20.7341174009        1
[INPUT] 1    0    [1    /1   ]  0.781768273869       1
[INPUT] 1    0    [1    /1   ]  2.86573371279        1
[INPUT] 1    0    [1    /1   ]  0.223902600061       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.8944567098, 1.0]], [0, [7616.953487943054, 1.0]], [0, [3617.5530726657266, 1.0]], [0, [1585.002395716493, 1.0]], [0, [427.3884617387531, 1.0]], [0, [187.0587164903321, 1.0]], [0, [93.83113653537166, 1.0]], [0, [34.61855503754067, 1.0]], [0, [7.909651275337506, 1.0]], [0, [0.6577751854616466, 1.0]], [0, [3.127174084375501, 1.0]], [0, [0.2396333072458774, 1.0]], [1, [1362.862054425889, 1.0]], [1, [663.9849729511434, 1.0]], [1, [297.3803181467342, 1.0]], [1, [310.9557608696041, 1.0]], [1, [63.15039841378198, 1.0]], [1, [7.4894261727536495, 1.0]], [1, [20.734117400933947, 1.0]], [1, [0.7817682738690297, 1.0]], [1, [2.8657337127897686, 1.0]], [1, [0.22390260006069584, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.89445671]
bas 1, expnt(s) = [7616.95348794]
bas 2, expnt(s) = [3617.55307267]
bas 3, expnt(s) = [1585.00239572]
bas 4, expnt(s) = [427.38846174]
bas 5, expnt(s) = [187.05871649]
bas 6, expnt(s) = [93.83113654]
bas 7, expnt(s) = [34.61855504]
bas 8, expnt(s) = [7.90965128]
bas 9, expnt(s) = [0.65777519]
bas 10, expnt(s) = [3.12717408]
bas 11, expnt(s) = [0.23963331]
bas 12, expnt(s) = [1362.86205443]
bas 13, expnt(s) = [663.98497295]
bas 14, expnt(s) = [297.38031815]
bas 15, expnt(s) = [310.95576087]
bas 16, expnt(s) = [63.15039841]
bas 17, expnt(s) = [7.48942617]
bas 18, expnt(s) = [20.7341174]
bas 19, expnt(s) = [0.78176827]
bas 20, expnt(s) = [2.86573371]
bas 21, expnt(s) = [0.2239026]
CPU time:       569.80
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828945e+04 5.20029841e+03 7.61695349e+03 2.05992307e+03
 3.61755307e+03 1.17849083e+03 1.58500240e+03 6.34654650e+02
 4.27388462e+02 2.37482777e+02 1.87058716e+02 1.27790476e+02
 9.38311365e+01 7.61684744e+01 3.46185550e+01 3.60575925e+01
 7.90965128e+00 1.19160695e+01 6.57775185e-01 1.84532616e+00
 3.12717408e+00 5.94126697e+00 2.39633307e-01 8.65317348e-01
 1.36286205e+03 2.41573487e+04 6.63984973e+02 9.83291321e+03
 2.97380318e+02 3.60267155e+03 3.10955761e+02 3.80940942e+03
 6.31503984e+01 5.19343274e+02 7.48942617e+00 3.61447373e+01
 2.07341174e+01 1.29074762e+02 7.81768274e-01 2.14452910e+00
 2.86573371e+00 1.08775023e+01 2.23902600e-01 4.49322652e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993472542306282
cond(S) = 108518.65053406596
E1 = -729.5475099413741  E_coul = 203.17712553189816
init E= -526.370384409476
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555722469491079  LUMO = 0.992711973038852
  mo_energy =
[-1.18336406e+02 -1.22062051e+01 -9.44705587e+00 -9.44705587e+00
 -9.44705587e+00 -1.24016086e+00 -5.55722469e-01 -5.55722469e-01
 -5.55722469e-01  9.92711973e-01  1.04309128e+00  1.04309128e+00
  1.04309128e+00  7.51611844e+00  7.51611844e+00  7.51611844e+00
  1.19906290e+01  3.44364843e+01  3.44364843e+01  3.44364843e+01
  9.20548188e+01  1.32606560e+02  1.32606560e+02  1.32606560e+02
  3.82249851e+02  4.87656389e+02  4.87656389e+02  4.87656389e+02
  1.13380745e+03  1.33310663e+03  1.33310663e+03  1.33310663e+03
  3.01790538e+03  3.01790538e+03  3.01790538e+03  3.38031445e+03
  6.63181179e+03  6.63181179e+03  6.63181179e+03  9.80059257e+03
  2.61267732e+04  7.68216848e+04]
E1 = -727.8639531317907  E_coul = 201.10737315204594
cycle= 1 E= -526.756579979745  delta_E= -0.386  |g|= 0.186  |ddm|= 0.307
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.586729
diis-c [-0.3442504  1.       ]
  HOMO = -0.590477415907689  LUMO = 0.965109594413869
  mo_energy =
[-1.18644057e+02 -1.23437348e+01 -9.59549095e+00 -9.59549095e+00
 -9.59549095e+00 -1.27940267e+00 -5.90477416e-01 -5.90477416e-01
 -5.90477416e-01  9.65109594e-01  1.01858346e+00  1.01858346e+00
  1.01858346e+00  7.42429180e+00  7.42429180e+00  7.42429180e+00
  1.18838633e+01  3.42809139e+01  3.42809139e+01  3.42809139e+01
  9.18510836e+01  1.32376907e+02  1.32376907e+02  1.32376907e+02
  3.81966262e+02  4.87350760e+02  4.87350760e+02  4.87350760e+02
  1.13343837e+03  1.33274487e+03  1.33274487e+03  1.33274487e+03
  3.01747799e+03  3.01747799e+03  3.01747799e+03  3.37982145e+03
  6.63127178e+03  6.63127178e+03  6.63127178e+03  9.79998301e+03
  2.61260671e+04  7.68208873e+04]
E1 = -728.4367878538031  E_coul = 201.6794884987946
cycle= 2 E= -526.757299355009  delta_E= -0.000719  |g|= 0.0376  |ddm|= 0.0534
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076606
diis-c [-0.00386211  0.07130065  0.92869935]
  HOMO = -0.581284056181991  LUMO = 0.973170949076997
  mo_energy =
[-1.18575614e+02 -1.23053069e+01 -9.55539101e+00 -9.55539101e+00
 -9.55539101e+00 -1.26839824e+00 -5.81284056e-01 -5.81284056e-01
 -5.81284056e-01  9.73170949e-01  1.02544717e+00  1.02544717e+00
  1.02544717e+00  7.44857865e+00  7.44857865e+00  7.44857865e+00
  1.19134852e+01  3.43217539e+01  3.43217539e+01  3.43217539e+01
  9.19043830e+01  1.32433640e+02  1.32433640e+02  1.32433640e+02
  3.82031729e+02  4.87418332e+02  4.87418332e+02  4.87418332e+02
  1.13350976e+03  1.33281653e+03  1.33281653e+03  1.33281653e+03
  3.01755195e+03  3.01755195e+03  3.01755195e+03  3.37989639e+03
  6.63134751e+03  6.63134751e+03  6.63134751e+03  9.80005948e+03
  2.61261442e+04  7.68209647e+04]
E1 = -728.2851941727747  E_coul = 201.52783649405112
cycle= 3 E= -526.757357678724  delta_E= -5.83e-05  |g|= 0.0068  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0144018
diis-c [-7.38068730e-07 -1.20934284e-03  1.54173658e-01  8.47035684e-01]
  HOMO = -0.582886354336743  LUMO = 0.971861915980983
  mo_energy =
[-1.18586372e+02 -1.23115545e+01 -9.56200698e+00 -9.56200698e+00
 -9.56200698e+00 -1.27021183e+00 -5.82886354e-01 -5.82886354e-01
 -5.82886354e-01  9.71861916e-01  1.02427553e+00  1.02427553e+00
  1.02427553e+00  7.44447699e+00  7.44447699e+00  7.44447699e+00
  1.19086341e+01  3.43150606e+01  3.43150606e+01  3.43150606e+01
  9.18958965e+01  1.32424599e+02  1.32424599e+02  1.32424599e+02
  3.82021420e+02  4.87407707e+02  4.87407707e+02  4.87407707e+02
  1.13349851e+03  1.33280527e+03  1.33280527e+03  1.33280527e+03
  3.01754027e+03  3.01754027e+03  3.01754027e+03  3.37988447e+03
  6.63133541e+03  6.63133541e+03  6.63133541e+03  9.80004718e+03
  2.61261317e+04  7.68209521e+04]
E1 = -728.3096836804206  E_coul = 201.55232378482592
cycle= 4 E= -526.757359895595  delta_E= -2.22e-06  |g|= 0.0001  |ddm|= 0.00243
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000110577
diis-c [-4.39853586e-09  7.64437639e-05 -1.13158853e-02 -6.66221134e-02
  1.07786155e+00]
  HOMO = -0.582867369211797  LUMO = 0.971896190671738
  mo_energy =
[-1.18586324e+02 -1.23114862e+01 -9.56195215e+00 -9.56195215e+00
 -9.56195215e+00 -1.27016971e+00 -5.82867369e-01 -5.82867369e-01
 -5.82867369e-01  9.71896191e-01  1.02429203e+00  1.02429203e+00
  1.02429203e+00  7.44452098e+00  7.44452098e+00  7.44452098e+00
  1.19086960e+01  3.43151137e+01  3.43151137e+01  3.43151137e+01
  9.18959554e+01  1.32424653e+02  1.32424653e+02  1.32424653e+02
  3.82021469e+02  4.87407755e+02  4.87407755e+02  4.87407755e+02
  1.13349855e+03  1.33280531e+03  1.33280531e+03  1.33280531e+03
  3.01754030e+03  3.01754030e+03  3.01754030e+03  3.37988449e+03
  6.63133543e+03  6.63133543e+03  6.63133543e+03  9.80004719e+03
  2.61261317e+04  7.68209521e+04]
E1 = -728.3094537919104  E_coul = 201.55209389454348
cycle= 5 E= -526.757359897367  delta_E= -1.77e-09  |g|= 2.07e-05  |ddm|= 0.000161
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.90816e-05
diis-c [-8.14844397e-11  1.25499275e-05 -1.84522590e-03 -1.27413068e-02
  3.69442906e-02  9.77629692e-01]
  HOMO = -0.582874871700044  LUMO = 0.971892324619085
  mo_energy =
[-1.18586355e+02 -1.23115088e+01 -9.56197675e+00 -9.56197675e+00
 -9.56197675e+00 -1.27017566e+00 -5.82874872e-01 -5.82874872e-01
 -5.82874872e-01  9.71892325e-01  1.02428700e+00  1.02428700e+00
  1.02428700e+00  7.44450411e+00  7.44450411e+00  7.44450411e+00
  1.19086780e+01  3.43150897e+01  3.43150897e+01  3.43150897e+01
  9.18959284e+01  1.32424625e+02  1.32424625e+02  1.32424625e+02
  3.82021439e+02  4.87407724e+02  4.87407724e+02  4.87407724e+02
  1.13349852e+03  1.33280528e+03  1.33280528e+03  1.33280528e+03
  3.01754026e+03  3.01754026e+03  3.01754026e+03  3.37988446e+03
  6.63133539e+03  6.63133539e+03  6.63133539e+03  9.80004716e+03
  2.61261317e+04  7.68209521e+04]
E1 = -728.3095350418499  E_coul = 201.55217514442384
cycle= 6 E= -526.757359897426  delta_E= -5.91e-11  |g|= 1.81e-06  |ddm|= 1.89e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.3095350418499  E_coul = 201.55217514442384
  HOMO = -0.582874835150209  LUMO = 0.971892713146263
  mo_energy =
[-1.18586355e+02 -1.23115085e+01 -9.56197648e+00 -9.56197648e+00
 -9.56197648e+00 -1.27017521e+00 -5.82874835e-01 -5.82874835e-01
 -5.82874835e-01  9.71892713e-01  1.02428708e+00  1.02428708e+00
  1.02428708e+00  7.44450430e+00  7.44450430e+00  7.44450430e+00
  1.19086784e+01  3.43150900e+01  3.43150900e+01  3.43150900e+01
  9.18959288e+01  1.32424625e+02  1.32424625e+02  1.32424625e+02
  3.82021439e+02  4.87407725e+02  4.87407725e+02  4.87407725e+02
  1.13349852e+03  1.33280528e+03  1.33280528e+03  1.33280528e+03
  3.01754026e+03  3.01754026e+03  3.01754026e+03  3.37988446e+03
  6.63133540e+03  6.63133540e+03  6.63133540e+03  9.80004716e+03
  2.61261317e+04  7.68209521e+04]
E1 = -728.3095332301282  E_coul = 201.55217333270195
Extra cycle  E= -526.757359897426  delta_E= -1.14e-13  |g|= 3.73e-07  |ddm|= 3.17e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 108518.65053406596
E1 = -728.3095332301282  E_coul = 201.55217333270195
init E= -526.757359897426
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.582874884096318  LUMO = 0.971892745396067
  mo_energy =
[-1.18586355e+02 -1.23115086e+01 -9.56197663e+00 -9.56197663e+00
 -9.56197663e+00 -1.27017519e+00 -5.82874884e-01 -5.82874884e-01
 -5.82874884e-01  9.71892745e-01  1.02428706e+00  1.02428706e+00
  1.02428706e+00  7.44450420e+00  7.44450420e+00  7.44450420e+00
  1.19086783e+01  3.43150898e+01  3.43150898e+01  3.43150898e+01
  9.18959287e+01  1.32424625e+02  1.32424625e+02  1.32424625e+02
  3.82021439e+02  4.87407724e+02  4.87407724e+02  4.87407724e+02
  1.13349852e+03  1.33280528e+03  1.33280528e+03  1.33280528e+03
  3.01754026e+03  3.01754026e+03  3.01754026e+03  3.37988446e+03
  6.63133539e+03  6.63133539e+03  6.63133539e+03  9.80004716e+03
  2.61261317e+04  7.68209521e+04]
E1 = -728.3095336064906  E_coul = 201.55217370906342
cycle= 1 E= -526.757359897427  delta_E= -1.02e-12  |g|= 8.1e-08  |ddm|= 6.05e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.3095336064906  E_coul = 201.55217370906342
  HOMO = -0.582874879749231  LUMO = 0.971892764128124
  mo_energy =
[-1.18586355e+02 -1.23115086e+01 -9.56197661e+00 -9.56197661e+00
 -9.56197661e+00 -1.27017516e+00 -5.82874880e-01 -5.82874880e-01
 -5.82874880e-01  9.71892764e-01  1.02428706e+00  1.02428706e+00
  1.02428706e+00  7.44450422e+00  7.44450422e+00  7.44450422e+00
  1.19086783e+01  3.43150899e+01  3.43150899e+01  3.43150899e+01
  9.18959287e+01  1.32424625e+02  1.32424625e+02  1.32424625e+02
  3.82021439e+02  4.87407724e+02  4.87407724e+02  4.87407724e+02
  1.13349852e+03  1.33280528e+03  1.33280528e+03  1.33280528e+03
  3.01754026e+03  3.01754026e+03  3.01754026e+03  3.37988446e+03
  6.63133540e+03  6.63133540e+03  6.63133540e+03  9.80004716e+03
  2.61261317e+04  7.68209521e+04]
E1 = -728.3095334738094  E_coul = 201.5521735763825
Extra cycle  E= -526.757359897427  delta_E= 3.41e-13  |g|= 1.67e-08  |ddm|= 1.33e-07
    CPU time for scf_cycle      0.91 sec, wall time      0.42 sec
exp = [2.61828945e+04 7.61695349e+03 3.61755307e+03 1.58500240e+03
 4.27388462e+02 1.87058716e+02 9.38311365e+01 3.46185550e+01
 7.90965128e+00 6.57775185e-01 3.12717408e+00 2.39633307e-01
 1.36286205e+03 6.63984973e+02 2.97380318e+02 3.10955761e+02
 6.31503984e+01 7.48942617e+00 2.07341174e+01 7.81768274e-01
 2.86573371e+00 2.23902600e-01]
grad_E = [-1.46016320e-06  2.71564774e-06 -2.17315507e-06  5.67074617e-05
 -2.53005174e-04  7.32885141e-05  2.04776972e-04 -2.03164852e-04
  5.06490434e-05 -9.92423762e-04 -6.74409454e-04  3.31846211e-03
 -6.02376520e-07  3.87643623e-06  1.75571200e-05  1.49525001e-05
  1.03372106e-04 -5.16265453e-04  6.86222243e-05  4.41579368e-04
  7.11988453e-04 -9.24302863e-04]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:00 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8942412        1
[INPUT] 0    0    [1    /1   ]  7616.95403638        1
[INPUT] 0    0    [1    /1   ]  3617.5529172         1
[INPUT] 0    0    [1    /1   ]  1585.0155242         1
[INPUT] 0    0    [1    /1   ]  427.301144715        1
[INPUT] 0    0    [1    /1   ]  187.199584442        1
[INPUT] 0    0    [1    /1   ]  93.5442946497        1
[INPUT] 0    0    [1    /1   ]  34.5530544461        1
[INPUT] 0    0    [1    /1   ]  7.91842460564        1
[INPUT] 0    0    [1    /1   ]  0.65663143114        1
[INPUT] 0    0    [1    /1   ]  3.13778344989        1
[INPUT] 0    0    [1    /1   ]  0.238834411045       1
[INPUT] 1    0    [1    /1   ]  1362.86198619        1
[INPUT] 1    0    [1    /1   ]  663.985672376        1
[INPUT] 1    0    [1    /1   ]  297.383646669        1
[INPUT] 1    0    [1    /1   ]  310.9586272          1
[INPUT] 1    0    [1    /1   ]  63.1348464389        1
[INPUT] 1    0    [1    /1   ]  7.50954326802        1
[INPUT] 1    0    [1    /1   ]  20.7711814695        1
[INPUT] 1    0    [1    /1   ]  0.782209784008       1
[INPUT] 1    0    [1    /1   ]  2.87014539384        1
[INPUT] 1    0    [1    /1   ]  0.224034931659       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.894241246344, 1.0]], [0, [7616.95403637888, 1.0]], [0, [3617.5529171993126, 1.0]], [0, [1585.015524204494, 1.0]], [0, [427.30114471482506, 1.0]], [0, [187.1995844423137, 1.0]], [0, [93.54429464973595, 1.0]], [0, [34.553054446059804, 1.0]], [0, [7.918424605642858, 1.0]], [0, [0.6566314311396231, 1.0]], [0, [3.137783449890824, 1.0]], [0, [0.2388344110450101, 1.0]], [1, [1362.861986188565, 1.0]], [1, [663.9856723756975, 1.0]], [1, [297.3836466694516, 1.0]], [1, [310.9586271996423, 1.0]], [1, [63.13484643894426, 1.0]], [1, [7.509543268018536, 1.0]], [1, [20.771181469473163, 1.0]], [1, [0.782209784007695, 1.0]], [1, [2.870145393844331, 1.0]], [1, [0.22403493165944124, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.89424125]
bas 1, expnt(s) = [7616.95403638]
bas 2, expnt(s) = [3617.5529172]
bas 3, expnt(s) = [1585.0155242]
bas 4, expnt(s) = [427.30114471]
bas 5, expnt(s) = [187.19958444]
bas 6, expnt(s) = [93.54429465]
bas 7, expnt(s) = [34.55305445]
bas 8, expnt(s) = [7.91842461]
bas 9, expnt(s) = [0.65663143]
bas 10, expnt(s) = [3.13778345]
bas 11, expnt(s) = [0.23883441]
bas 12, expnt(s) = [1362.86198619]
bas 13, expnt(s) = [663.98567238]
bas 14, expnt(s) = [297.38364667]
bas 15, expnt(s) = [310.9586272]
bas 16, expnt(s) = [63.13484644]
bas 17, expnt(s) = [7.50954327]
bas 18, expnt(s) = [20.77118147]
bas 19, expnt(s) = [0.78220978]
bas 20, expnt(s) = [2.87014539]
bas 21, expnt(s) = [0.22403493]
CPU time:       575.34
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828942e+04 5.20029838e+03 7.61695404e+03 2.05992318e+03
 3.61755292e+03 1.17849079e+03 1.58501552e+03 6.34658593e+02
 4.27301145e+02 2.37446387e+02 1.87199584e+02 1.27862645e+02
 9.35442946e+01 7.59937722e+01 3.45530544e+01 3.60064129e+01
 7.91842461e+00 1.19259810e+01 6.56631431e-01 1.84291912e+00
 3.13778345e+00 5.95637799e+00 2.38834411e-01 8.63152830e-01
 1.36286199e+03 2.41573471e+04 6.63985672e+02 9.83292616e+03
 2.97383647e+02 3.60272195e+03 3.10958627e+02 3.80945331e+03
 6.31348464e+01 5.19183406e+02 7.50954327e+00 3.62661370e+01
 2.07711815e+01 1.29363242e+02 7.82209784e-01 2.14604314e+00
 2.87014539e+00 1.08984382e+01 2.24034932e-01 4.49654627e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993452315213247
cond(S) = 108557.40072586722
E1 = -729.5475127012495  E_coul = 203.17734966723717
init E= -526.370163034012
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555706472987954  LUMO = 0.989092704896193
  mo_energy =
[-1.18336431e+02 -1.22061515e+01 -9.44704377e+00 -9.44704377e+00
 -9.44704377e+00 -1.24016649e+00 -5.55706473e-01 -5.55706473e-01
 -5.55706473e-01  9.89092705e-01  1.04399381e+00  1.04399381e+00
  1.04399381e+00  7.53145500e+00  7.53145500e+00  7.53145500e+00
  1.20150317e+01  3.45264083e+01  3.45264083e+01  3.45264083e+01
  9.19544862e+01  1.32779313e+02  1.32779313e+02  1.32779313e+02
  3.81703902e+02  4.87813034e+02  4.87813034e+02  4.87813034e+02
  1.13295327e+03  1.33324647e+03  1.33324647e+03  1.33324647e+03
  3.01804144e+03  3.01804144e+03  3.01804144e+03  3.37933227e+03
  6.63194188e+03  6.63194188e+03  6.63194188e+03  9.79960604e+03
  2.61258235e+04  7.68207964e+04]
E1 = -727.86512810536  E_coul = 201.10853223401483
cycle= 1 E= -526.756595871345  delta_E= -0.386  |g|= 0.186  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.586462
diis-c [-0.34393746  1.        ]
  HOMO = -0.590473319237798  LUMO = 0.961557381820412
  mo_energy =
[-1.18643899e+02 -1.23436455e+01 -9.59538538e+00 -9.59538538e+00
 -9.59538538e+00 -1.27940618e+00 -5.90473319e-01 -5.90473319e-01
 -5.90473319e-01  9.61557382e-01  1.01946321e+00  1.01946321e+00
  1.01946321e+00  7.43952854e+00  7.43952854e+00  7.43952854e+00
  1.19081539e+01  3.43707922e+01  3.43707922e+01  3.43707922e+01
  9.17510523e+01  1.32549815e+02  1.32549815e+02  1.32549815e+02
  3.81420581e+02  4.87507603e+02  4.87507603e+02  4.87507603e+02
  1.13258438e+03  1.33288490e+03  1.33288490e+03  1.33288490e+03
  3.01761423e+03  3.01761423e+03  3.01761423e+03  3.37883942e+03
  6.63140203e+03  6.63140203e+03  6.63140203e+03  9.79899663e+03
  2.61251175e+04  7.68199991e+04]
E1 = -728.4374450601316  E_coul = 201.6801309292564
cycle= 2 E= -526.757314130875  delta_E= -0.000718  |g|= 0.0376  |ddm|= 0.0534
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076546
diis-c [-0.00385865  0.07123597  0.92876403]
  HOMO = -0.581286842577401  LUMO = 0.969599332868622
  mo_energy =
[-1.18575518e+02 -1.23052512e+01 -9.55531872e+00 -9.55531872e+00
 -9.55531872e+00 -1.26840755e+00 -5.81286843e-01 -5.81286843e-01
 -5.81286843e-01  9.69599333e-01  1.02632880e+00  1.02632880e+00
  1.02632880e+00  7.46382750e+00  7.46382750e+00  7.46382750e+00
  1.19377789e+01  3.44116294e+01  3.44116294e+01  3.44116294e+01
  9.18042761e+01  1.32606497e+02  1.32606497e+02  1.32606497e+02
  3.81485977e+02  4.87575111e+02  4.87575111e+02  4.87575111e+02
  1.13265570e+03  1.33295649e+03  1.33295649e+03  1.33295649e+03
  3.01768811e+03  3.01768811e+03  3.01768811e+03  3.37891430e+03
  6.63147769e+03  6.63147769e+03  6.63147769e+03  9.79907303e+03
  2.61251945e+04  7.68200765e+04]
E1 = -728.2859945577082  E_coul = 201.52862220930967
cycle= 3 E= -526.757372348399  delta_E= -5.82e-05  |g|= 0.00679  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.014394
diis-c [-7.36150940e-07 -1.20821842e-03  1.54211761e-01  8.46996458e-01]
  HOMO = -0.582888378833606  LUMO = 0.968294432382149
  mo_energy =
[-1.18586270e+02 -1.23114954e+01 -9.56193059e+00 -9.56193059e+00
 -9.56193059e+00 -1.27021916e+00 -5.82888379e-01 -5.82888379e-01
 -5.82888379e-01  9.68294432e-01  1.02515676e+00  1.02515676e+00
  1.02515676e+00  7.45972335e+00  7.45972335e+00  7.45972335e+00
  1.19329259e+01  3.44049354e+01  3.44049354e+01  3.44049354e+01
  9.17957986e+01  1.32597462e+02  1.32597462e+02  1.32597462e+02
  3.81475675e+02  4.87564493e+02  4.87564493e+02  4.87564493e+02
  1.13264446e+03  1.33294524e+03  1.33294524e+03  1.33294524e+03
  3.01767644e+03  3.01767644e+03  3.01767644e+03  3.37890238e+03
  6.63146560e+03  6.63146560e+03  6.63146560e+03  9.79906074e+03
  2.61251820e+04  7.68200638e+04]
E1 = -728.3104621584849  E_coul = 201.55308759608158
cycle= 4 E= -526.757374562403  delta_E= -2.21e-06  |g|= 0.000101  |ddm|= 0.00243
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000110973
diis-c [-4.41489185e-09  7.72303433e-05 -1.14341162e-02 -6.72655279e-02
  1.07862241e+00]
  HOMO = -0.582869581836743  LUMO = 0.968328786536641
  mo_energy =
[-1.18586223e+02 -1.23114273e+01 -9.56187613e+00 -9.56187613e+00
 -9.56187613e+00 -1.27017691e+00 -5.82869582e-01 -5.82869582e-01
 -5.82869582e-01  9.68328787e-01  1.02517319e+00  1.02517319e+00
  1.02517319e+00  7.45976709e+00  7.45976709e+00  7.45976709e+00
  1.19329877e+01  3.44049881e+01  3.44049881e+01  3.44049881e+01
  9.17958572e+01  1.32597515e+02  1.32597515e+02  1.32597515e+02
  3.81475724e+02  4.87564540e+02  4.87564540e+02  4.87564540e+02
  1.13264450e+03  1.33294527e+03  1.33294527e+03  1.33294527e+03
  3.01767647e+03  3.01767647e+03  3.01767647e+03  3.37890240e+03
  6.63146562e+03  6.63146562e+03  6.63146562e+03  9.79906075e+03
  2.61251820e+04  7.68200638e+04]
E1 = -728.3102325637703  E_coul = 201.55285799953856
cycle= 5 E= -526.757374564232  delta_E= -1.83e-09  |g|= 2.07e-05  |ddm|= 0.000164
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.91263e-05
diis-c [-8.27535149e-11  1.26071412e-05 -1.85343043e-03 -1.27826144e-02
  3.51877256e-02  9.79435712e-01]
  HOMO = -0.582877107703786  LUMO = 0.968324949893536
  mo_energy =
[-1.18586254e+02 -1.23114500e+01 -9.56190077e+00 -9.56190077e+00
 -9.56190077e+00 -1.27018285e+00 -5.82877108e-01 -5.82877108e-01
 -5.82877108e-01  9.68324950e-01  1.02516814e+00  1.02516814e+00
  1.02516814e+00  7.45975017e+00  7.45975017e+00  7.45975017e+00
  1.19329696e+01  3.44049640e+01  3.44049640e+01  3.44049640e+01
  9.17958302e+01  1.32597487e+02  1.32597487e+02  1.32597487e+02
  3.81475694e+02  4.87564510e+02  4.87564510e+02  4.87564510e+02
  1.13264447e+03  1.33294524e+03  1.33294524e+03  1.33294524e+03
  3.01767643e+03  3.01767643e+03  3.01767643e+03  3.37890237e+03
  6.63146558e+03  6.63146558e+03  6.63146558e+03  9.79906071e+03
  2.61251820e+04  7.68200638e+04]
E1 = -728.3103138306316  E_coul = 201.55293926633982
cycle= 6 E= -526.757374564292  delta_E= -5.99e-11  |g|= 1.8e-06  |ddm|= 1.92e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.3103138306316  E_coul = 201.55293926633982
  HOMO = -0.582877059586152  LUMO = 0.968325346294271
  mo_energy =
[-1.18586253e+02 -1.23114496e+01 -9.56190046e+00 -9.56190046e+00
 -9.56190046e+00 -1.27018239e+00 -5.82877060e-01 -5.82877060e-01
 -5.82877060e-01  9.68325346e-01  1.02516823e+00  1.02516823e+00
  1.02516823e+00  7.45975039e+00  7.45975039e+00  7.45975039e+00
  1.19329700e+01  3.44049644e+01  3.44049644e+01  3.44049644e+01
  9.17958307e+01  1.32597487e+02  1.32597487e+02  1.32597487e+02
  3.81475695e+02  4.87564510e+02  4.87564510e+02  4.87564510e+02
  1.13264447e+03  1.33294524e+03  1.33294524e+03  1.33294524e+03
  3.01767643e+03  3.01767643e+03  3.01767643e+03  3.37890237e+03
  6.63146558e+03  6.63146558e+03  6.63146558e+03  9.79906071e+03
  2.61251820e+04  7.68200638e+04]
E1 = -728.3103118646907  E_coul = 201.5529373003988
Extra cycle  E= -526.757374564292  delta_E= -2.27e-13  |g|= 3.73e-07  |ddm|= 3.16e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
exp = [2.61828942e+04 7.61695404e+03 3.61755292e+03 1.58501552e+03
 4.27301145e+02 1.87199584e+02 9.35442946e+01 3.45530544e+01
 7.91842461e+00 6.56631431e-01 3.13778345e+00 2.38834411e-01
 1.36286199e+03 6.63985672e+02 2.97383647e+02 3.10958627e+02
 6.31348464e+01 7.50954327e+00 2.07711815e+01 7.82209784e-01
 2.87014539e+00 2.24034932e-01]
E = -526.7573745642919
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:01 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8942412        1
[INPUT] 0    0    [1    /1   ]  7616.95403638        1
[INPUT] 0    0    [1    /1   ]  3617.5529172         1
[INPUT] 0    0    [1    /1   ]  1585.0155242         1
[INPUT] 0    0    [1    /1   ]  427.301144715        1
[INPUT] 0    0    [1    /1   ]  187.199584442        1
[INPUT] 0    0    [1    /1   ]  93.5442946497        1
[INPUT] 0    0    [1    /1   ]  34.5530544461        1
[INPUT] 0    0    [1    /1   ]  7.91842460564        1
[INPUT] 0    0    [1    /1   ]  0.65663143114        1
[INPUT] 0    0    [1    /1   ]  3.13778344989        1
[INPUT] 0    0    [1    /1   ]  0.238834411045       1
[INPUT] 1    0    [1    /1   ]  1362.86198619        1
[INPUT] 1    0    [1    /1   ]  663.985672376        1
[INPUT] 1    0    [1    /1   ]  297.383646669        1
[INPUT] 1    0    [1    /1   ]  310.9586272          1
[INPUT] 1    0    [1    /1   ]  63.1348464389        1
[INPUT] 1    0    [1    /1   ]  7.50954326802        1
[INPUT] 1    0    [1    /1   ]  20.7711814695        1
[INPUT] 1    0    [1    /1   ]  0.782209784008       1
[INPUT] 1    0    [1    /1   ]  2.87014539384        1
[INPUT] 1    0    [1    /1   ]  0.224034931659       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.894241246344, 1.0]], [0, [7616.95403637888, 1.0]], [0, [3617.5529171993126, 1.0]], [0, [1585.015524204494, 1.0]], [0, [427.30114471482506, 1.0]], [0, [187.1995844423137, 1.0]], [0, [93.54429464973595, 1.0]], [0, [34.553054446059804, 1.0]], [0, [7.918424605642858, 1.0]], [0, [0.6566314311396231, 1.0]], [0, [3.137783449890824, 1.0]], [0, [0.2388344110450101, 1.0]], [1, [1362.861986188565, 1.0]], [1, [663.9856723756975, 1.0]], [1, [297.3836466694516, 1.0]], [1, [310.9586271996423, 1.0]], [1, [63.13484643894426, 1.0]], [1, [7.509543268018536, 1.0]], [1, [20.771181469473163, 1.0]], [1, [0.782209784007695, 1.0]], [1, [2.870145393844331, 1.0]], [1, [0.22403493165944124, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.89424125]
bas 1, expnt(s) = [7616.95403638]
bas 2, expnt(s) = [3617.5529172]
bas 3, expnt(s) = [1585.0155242]
bas 4, expnt(s) = [427.30114471]
bas 5, expnt(s) = [187.19958444]
bas 6, expnt(s) = [93.54429465]
bas 7, expnt(s) = [34.55305445]
bas 8, expnt(s) = [7.91842461]
bas 9, expnt(s) = [0.65663143]
bas 10, expnt(s) = [3.13778345]
bas 11, expnt(s) = [0.23883441]
bas 12, expnt(s) = [1362.86198619]
bas 13, expnt(s) = [663.98567238]
bas 14, expnt(s) = [297.38364667]
bas 15, expnt(s) = [310.9586272]
bas 16, expnt(s) = [63.13484644]
bas 17, expnt(s) = [7.50954327]
bas 18, expnt(s) = [20.77118147]
bas 19, expnt(s) = [0.78220978]
bas 20, expnt(s) = [2.87014539]
bas 21, expnt(s) = [0.22403493]
CPU time:       575.90
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828942e+04 5.20029838e+03 7.61695404e+03 2.05992318e+03
 3.61755292e+03 1.17849079e+03 1.58501552e+03 6.34658593e+02
 4.27301145e+02 2.37446387e+02 1.87199584e+02 1.27862645e+02
 9.35442946e+01 7.59937722e+01 3.45530544e+01 3.60064129e+01
 7.91842461e+00 1.19259810e+01 6.56631431e-01 1.84291912e+00
 3.13778345e+00 5.95637799e+00 2.38834411e-01 8.63152830e-01
 1.36286199e+03 2.41573471e+04 6.63985672e+02 9.83292616e+03
 2.97383647e+02 3.60272195e+03 3.10958627e+02 3.80945331e+03
 6.31348464e+01 5.19183406e+02 7.50954327e+00 3.62661370e+01
 2.07711815e+01 1.29363242e+02 7.82209784e-01 2.14604314e+00
 2.87014539e+00 1.08984382e+01 2.24034932e-01 4.49654627e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993452315213247
cond(S) = 108557.40072586722
E1 = -729.5475127012495  E_coul = 203.17734966723717
init E= -526.370163034012
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555706472987954  LUMO = 0.989092704896193
  mo_energy =
[-1.18336431e+02 -1.22061515e+01 -9.44704377e+00 -9.44704377e+00
 -9.44704377e+00 -1.24016649e+00 -5.55706473e-01 -5.55706473e-01
 -5.55706473e-01  9.89092705e-01  1.04399381e+00  1.04399381e+00
  1.04399381e+00  7.53145500e+00  7.53145500e+00  7.53145500e+00
  1.20150317e+01  3.45264083e+01  3.45264083e+01  3.45264083e+01
  9.19544862e+01  1.32779313e+02  1.32779313e+02  1.32779313e+02
  3.81703902e+02  4.87813034e+02  4.87813034e+02  4.87813034e+02
  1.13295327e+03  1.33324647e+03  1.33324647e+03  1.33324647e+03
  3.01804144e+03  3.01804144e+03  3.01804144e+03  3.37933227e+03
  6.63194188e+03  6.63194188e+03  6.63194188e+03  9.79960604e+03
  2.61258235e+04  7.68207964e+04]
E1 = -727.86512810536  E_coul = 201.10853223401483
cycle= 1 E= -526.756595871345  delta_E= -0.386  |g|= 0.186  |ddm|= 0.309
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.586462
diis-c [-0.34393746  1.        ]
  HOMO = -0.590473319237798  LUMO = 0.961557381820412
  mo_energy =
[-1.18643899e+02 -1.23436455e+01 -9.59538538e+00 -9.59538538e+00
 -9.59538538e+00 -1.27940618e+00 -5.90473319e-01 -5.90473319e-01
 -5.90473319e-01  9.61557382e-01  1.01946321e+00  1.01946321e+00
  1.01946321e+00  7.43952854e+00  7.43952854e+00  7.43952854e+00
  1.19081539e+01  3.43707922e+01  3.43707922e+01  3.43707922e+01
  9.17510523e+01  1.32549815e+02  1.32549815e+02  1.32549815e+02
  3.81420581e+02  4.87507603e+02  4.87507603e+02  4.87507603e+02
  1.13258438e+03  1.33288490e+03  1.33288490e+03  1.33288490e+03
  3.01761423e+03  3.01761423e+03  3.01761423e+03  3.37883942e+03
  6.63140203e+03  6.63140203e+03  6.63140203e+03  9.79899663e+03
  2.61251175e+04  7.68199991e+04]
E1 = -728.4374450601316  E_coul = 201.6801309292564
cycle= 2 E= -526.757314130875  delta_E= -0.000718  |g|= 0.0376  |ddm|= 0.0534
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076546
diis-c [-0.00385865  0.07123597  0.92876403]
  HOMO = -0.581286842577401  LUMO = 0.969599332868622
  mo_energy =
[-1.18575518e+02 -1.23052512e+01 -9.55531872e+00 -9.55531872e+00
 -9.55531872e+00 -1.26840755e+00 -5.81286843e-01 -5.81286843e-01
 -5.81286843e-01  9.69599333e-01  1.02632880e+00  1.02632880e+00
  1.02632880e+00  7.46382750e+00  7.46382750e+00  7.46382750e+00
  1.19377789e+01  3.44116294e+01  3.44116294e+01  3.44116294e+01
  9.18042761e+01  1.32606497e+02  1.32606497e+02  1.32606497e+02
  3.81485977e+02  4.87575111e+02  4.87575111e+02  4.87575111e+02
  1.13265570e+03  1.33295649e+03  1.33295649e+03  1.33295649e+03
  3.01768811e+03  3.01768811e+03  3.01768811e+03  3.37891430e+03
  6.63147769e+03  6.63147769e+03  6.63147769e+03  9.79907303e+03
  2.61251945e+04  7.68200765e+04]
E1 = -728.2859945577082  E_coul = 201.52862220930967
cycle= 3 E= -526.757372348399  delta_E= -5.82e-05  |g|= 0.00679  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.014394
diis-c [-7.36150940e-07 -1.20821842e-03  1.54211761e-01  8.46996458e-01]
  HOMO = -0.582888378833606  LUMO = 0.968294432382149
  mo_energy =
[-1.18586270e+02 -1.23114954e+01 -9.56193059e+00 -9.56193059e+00
 -9.56193059e+00 -1.27021916e+00 -5.82888379e-01 -5.82888379e-01
 -5.82888379e-01  9.68294432e-01  1.02515676e+00  1.02515676e+00
  1.02515676e+00  7.45972335e+00  7.45972335e+00  7.45972335e+00
  1.19329259e+01  3.44049354e+01  3.44049354e+01  3.44049354e+01
  9.17957986e+01  1.32597462e+02  1.32597462e+02  1.32597462e+02
  3.81475675e+02  4.87564493e+02  4.87564493e+02  4.87564493e+02
  1.13264446e+03  1.33294524e+03  1.33294524e+03  1.33294524e+03
  3.01767644e+03  3.01767644e+03  3.01767644e+03  3.37890238e+03
  6.63146560e+03  6.63146560e+03  6.63146560e+03  9.79906074e+03
  2.61251820e+04  7.68200638e+04]
E1 = -728.3104621584849  E_coul = 201.55308759608158
cycle= 4 E= -526.757374562403  delta_E= -2.21e-06  |g|= 0.000101  |ddm|= 0.00243
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000110973
diis-c [-4.41489185e-09  7.72303433e-05 -1.14341162e-02 -6.72655279e-02
  1.07862241e+00]
  HOMO = -0.582869581836743  LUMO = 0.968328786536641
  mo_energy =
[-1.18586223e+02 -1.23114273e+01 -9.56187613e+00 -9.56187613e+00
 -9.56187613e+00 -1.27017691e+00 -5.82869582e-01 -5.82869582e-01
 -5.82869582e-01  9.68328787e-01  1.02517319e+00  1.02517319e+00
  1.02517319e+00  7.45976709e+00  7.45976709e+00  7.45976709e+00
  1.19329877e+01  3.44049881e+01  3.44049881e+01  3.44049881e+01
  9.17958572e+01  1.32597515e+02  1.32597515e+02  1.32597515e+02
  3.81475724e+02  4.87564540e+02  4.87564540e+02  4.87564540e+02
  1.13264450e+03  1.33294527e+03  1.33294527e+03  1.33294527e+03
  3.01767647e+03  3.01767647e+03  3.01767647e+03  3.37890240e+03
  6.63146562e+03  6.63146562e+03  6.63146562e+03  9.79906075e+03
  2.61251820e+04  7.68200638e+04]
E1 = -728.3102325637703  E_coul = 201.55285799953856
cycle= 5 E= -526.757374564232  delta_E= -1.83e-09  |g|= 2.07e-05  |ddm|= 0.000164
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.91263e-05
diis-c [-8.27535149e-11  1.26071412e-05 -1.85343043e-03 -1.27826144e-02
  3.51877256e-02  9.79435712e-01]
  HOMO = -0.582877107703786  LUMO = 0.968324949893536
  mo_energy =
[-1.18586254e+02 -1.23114500e+01 -9.56190077e+00 -9.56190077e+00
 -9.56190077e+00 -1.27018285e+00 -5.82877108e-01 -5.82877108e-01
 -5.82877108e-01  9.68324950e-01  1.02516814e+00  1.02516814e+00
  1.02516814e+00  7.45975017e+00  7.45975017e+00  7.45975017e+00
  1.19329696e+01  3.44049640e+01  3.44049640e+01  3.44049640e+01
  9.17958302e+01  1.32597487e+02  1.32597487e+02  1.32597487e+02
  3.81475694e+02  4.87564510e+02  4.87564510e+02  4.87564510e+02
  1.13264447e+03  1.33294524e+03  1.33294524e+03  1.33294524e+03
  3.01767643e+03  3.01767643e+03  3.01767643e+03  3.37890237e+03
  6.63146558e+03  6.63146558e+03  6.63146558e+03  9.79906071e+03
  2.61251820e+04  7.68200638e+04]
E1 = -728.3103138306316  E_coul = 201.55293926633982
cycle= 6 E= -526.757374564292  delta_E= -5.99e-11  |g|= 1.8e-06  |ddm|= 1.92e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.3103138306316  E_coul = 201.55293926633982
  HOMO = -0.582877059586152  LUMO = 0.968325346294271
  mo_energy =
[-1.18586253e+02 -1.23114496e+01 -9.56190046e+00 -9.56190046e+00
 -9.56190046e+00 -1.27018239e+00 -5.82877060e-01 -5.82877060e-01
 -5.82877060e-01  9.68325346e-01  1.02516823e+00  1.02516823e+00
  1.02516823e+00  7.45975039e+00  7.45975039e+00  7.45975039e+00
  1.19329700e+01  3.44049644e+01  3.44049644e+01  3.44049644e+01
  9.17958307e+01  1.32597487e+02  1.32597487e+02  1.32597487e+02
  3.81475695e+02  4.87564510e+02  4.87564510e+02  4.87564510e+02
  1.13264447e+03  1.33294524e+03  1.33294524e+03  1.33294524e+03
  3.01767643e+03  3.01767643e+03  3.01767643e+03  3.37890237e+03
  6.63146558e+03  6.63146558e+03  6.63146558e+03  9.79906071e+03
  2.61251820e+04  7.68200638e+04]
E1 = -728.3103118646907  E_coul = 201.5529373003988
Extra cycle  E= -526.757374564292  delta_E= -2.27e-13  |g|= 3.73e-07  |ddm|= 3.16e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 108557.40072586722
E1 = -728.3103118646907  E_coul = 201.5529373003988
init E= -526.757374564292
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.582877111603269  LUMO = 0.968325375688172
  mo_energy =
[-1.18586253e+02 -1.23114498e+01 -9.56190062e+00 -9.56190062e+00
 -9.56190062e+00 -1.27018237e+00 -5.82877112e-01 -5.82877112e-01
 -5.82877112e-01  9.68325376e-01  1.02516820e+00  1.02516820e+00
  1.02516820e+00  7.45975028e+00  7.45975028e+00  7.45975028e+00
  1.19329699e+01  3.44049642e+01  3.44049642e+01  3.44049642e+01
  9.17958305e+01  1.32597487e+02  1.32597487e+02  1.32597487e+02
  3.81475695e+02  4.87564510e+02  4.87564510e+02  4.87564510e+02
  1.13264447e+03  1.33294524e+03  1.33294524e+03  1.33294524e+03
  3.01767643e+03  3.01767643e+03  3.01767643e+03  3.37890237e+03
  6.63146558e+03  6.63146558e+03  6.63146558e+03  9.79906071e+03
  2.61251820e+04  7.68200638e+04]
E1 = -728.3103122833189  E_coul = 201.5529377190285
cycle= 1 E= -526.75737456429  delta_E= 1.48e-12  |g|= 8.17e-08  |ddm|= 6.01e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.3103122833189  E_coul = 201.5529377190285
  HOMO = -0.582877106475776  LUMO = 0.968325395014049
  mo_energy =
[-1.18586253e+02 -1.23114497e+01 -9.56190060e+00 -9.56190060e+00
 -9.56190060e+00 -1.27018234e+00 -5.82877106e-01 -5.82877106e-01
 -5.82877106e-01  9.68325395e-01  1.02516821e+00  1.02516821e+00
  1.02516821e+00  7.45975030e+00  7.45975030e+00  7.45975030e+00
  1.19329700e+01  3.44049642e+01  3.44049642e+01  3.44049642e+01
  9.17958305e+01  1.32597487e+02  1.32597487e+02  1.32597487e+02
  3.81475695e+02  4.87564510e+02  4.87564510e+02  4.87564510e+02
  1.13264447e+03  1.33294524e+03  1.33294524e+03  1.33294524e+03
  3.01767643e+03  3.01767643e+03  3.01767643e+03  3.37890237e+03
  6.63146558e+03  6.63146558e+03  6.63146558e+03  9.79906071e+03
  2.61251820e+04  7.68200638e+04]
E1 = -728.3103121385427  E_coul = 201.5529375742509
Extra cycle  E= -526.757374564292  delta_E= -1.36e-12  |g|= 1.7e-08  |ddm|= 1.33e-07
    CPU time for scf_cycle      0.91 sec, wall time      0.42 sec
exp = [2.61828942e+04 7.61695404e+03 3.61755292e+03 1.58501552e+03
 4.27301145e+02 1.87199584e+02 9.35442946e+01 3.45530544e+01
 7.91842461e+00 6.56631431e-01 3.13778345e+00 2.38834411e-01
 1.36286199e+03 6.63985672e+02 2.97383647e+02 3.10958627e+02
 6.31348464e+01 7.50954327e+00 2.07711815e+01 7.82209784e-01
 2.87014539e+00 2.24034932e-01]
grad_E = [-1.46179945e-06  2.73126063e-06 -2.16858671e-06  5.72170985e-05
 -2.57429909e-04  7.93807173e-05  1.90366847e-04 -2.02762082e-04
 -2.76992228e-04 -2.16445149e-04  5.99561817e-04  2.25741306e-04
 -5.98961351e-07  3.93646818e-06  1.79104009e-05  1.52534607e-05
  7.88796005e-05 -8.52325059e-05  7.20761382e-05 -2.58038343e-04
  8.45923124e-05  9.37235150e-04]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:05 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8967707        1
[INPUT] 0    0    [1    /1   ]  7616.94797749        1
[INPUT] 0    0    [1    /1   ]  3617.55502829        1
[INPUT] 0    0    [1    /1   ]  1584.87826689        1
[INPUT] 0    0    [1    /1   ]  427.800707193        1
[INPUT] 0    0    [1    /1   ]  188.043646711        1
[INPUT] 0    0    [1    /1   ]  93.8942561718        1
[INPUT] 0    0    [1    /1   ]  34.5980166889        1
[INPUT] 0    0    [1    /1   ]  7.92721860553        1
[INPUT] 0    0    [1    /1   ]  0.657230310845       1
[INPUT] 0    0    [1    /1   ]  3.1411353316         1
[INPUT] 0    0    [1    /1   ]  0.238630171493       1
[INPUT] 1    0    [1    /1   ]  1362.86282202        1
[INPUT] 1    0    [1    /1   ]  663.977633228        1
[INPUT] 1    0    [1    /1   ]  297.345807625        1
[INPUT] 1    0    [1    /1   ]  310.9260206          1
[INPUT] 1    0    [1    /1   ]  63.1476340738        1
[INPUT] 1    0    [1    /1   ]  7.51598760082        1
[INPUT] 1    0    [1    /1   ]  20.7829269877        1
[INPUT] 1    0    [1    /1   ]  0.78225006034        1
[INPUT] 1    0    [1    /1   ]  2.87037590586        1
[INPUT] 1    0    [1    /1   ]  0.224068401417       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.896770674015, 1.0]], [0, [7616.9479774856145, 1.0]], [0, [3617.5550282938607, 1.0]], [0, [1584.8782668856409, 1.0]], [0, [427.80070719344906, 1.0]], [0, [188.0436467111301, 1.0]], [0, [93.89425617182097, 1.0]], [0, [34.59801668891565, 1.0]], [0, [7.927218605529725, 1.0]], [0, [0.6572303108446714, 1.0]], [0, [3.141135331604808, 1.0]], [0, [0.23863017149263682, 1.0]], [1, [1362.8628220227267, 1.0]], [1, [663.9776332280304, 1.0]], [1, [297.34580762495676, 1.0]], [1, [310.926020599946, 1.0]], [1, [63.14763407378717, 1.0]], [1, [7.515987600818632, 1.0]], [1, [20.782926987679172, 1.0]], [1, [0.7822500603404283, 1.0]], [1, [2.8703759058581704, 1.0]], [1, [0.22406840141744155, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.89677067]
bas 1, expnt(s) = [7616.94797749]
bas 2, expnt(s) = [3617.55502829]
bas 3, expnt(s) = [1584.87826689]
bas 4, expnt(s) = [427.80070719]
bas 5, expnt(s) = [188.04364671]
bas 6, expnt(s) = [93.89425617]
bas 7, expnt(s) = [34.59801669]
bas 8, expnt(s) = [7.92721861]
bas 9, expnt(s) = [0.65723031]
bas 10, expnt(s) = [3.14113533]
bas 11, expnt(s) = [0.23863017]
bas 12, expnt(s) = [1362.86282202]
bas 13, expnt(s) = [663.97763323]
bas 14, expnt(s) = [297.34580762]
bas 15, expnt(s) = [310.9260206]
bas 16, expnt(s) = [63.14763407]
bas 17, expnt(s) = [7.5159876]
bas 18, expnt(s) = [20.78292699]
bas 19, expnt(s) = [0.78225006]
bas 20, expnt(s) = [2.87037591]
bas 21, expnt(s) = [0.2240684]
CPU time:       581.55
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828968e+04 5.20029875e+03 7.61694798e+03 2.05992195e+03
 3.61755503e+03 1.17849131e+03 1.58487827e+03 6.34617373e+02
 4.27800707e+02 2.37654558e+02 1.88043647e+02 1.28294791e+02
 9.38942562e+01 7.62068997e+01 3.45980167e+01 3.60415473e+01
 7.92721861e+00 1.19359132e+01 6.57230311e-01 1.84417960e+00
 3.14113533e+00 5.96114945e+00 2.38630171e-01 8.62599177e-01
 1.36286282e+03 2.41573657e+04 6.63977633e+02 9.83277734e+03
 2.97345808e+02 3.60214895e+03 3.10926021e+02 3.80895400e+03
 6.31476341e+01 5.19314857e+02 7.51598760e+00 3.63050435e+01
 2.07829270e+01 1.29454688e+02 7.82250060e-01 2.14618126e+00
 2.87037591e+00 1.08995323e+01 2.24068401e-01 4.49738599e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993446201870007
cond(S) = 108487.29184657476
E1 = -729.5477777893025  E_coul = 203.1776521873734
init E= -526.370125601929
    CPU time for initialize scf      0.07 sec, wall time      0.05 sec
  HOMO = -0.555698154030921  LUMO = 0.98927291592002
  mo_energy =
[-1.18336430e+02 -1.22061092e+01 -9.44702006e+00 -9.44702006e+00
 -9.44702006e+00 -1.24015998e+00 -5.55698154e-01 -5.55698154e-01
 -5.55698154e-01  9.89272916e-01  1.04414593e+00  1.04414593e+00
  1.04414593e+00  7.53399722e+00  7.53399722e+00  7.53399722e+00
  1.20365517e+01  3.45504870e+01  3.45504870e+01  3.45504870e+01
  9.22061462e+01  1.32845801e+02  1.32845801e+02  1.32845801e+02
  3.83041596e+02  4.87882189e+02  4.87882189e+02  4.87882189e+02
  1.13649333e+03  1.33324323e+03  1.33324323e+03  1.33324323e+03
  3.01793543e+03  3.01793543e+03  3.01793543e+03  3.38490734e+03
  6.63176386e+03  6.63176386e+03  6.63176386e+03  9.80563769e+03
  2.61316890e+04  7.68262888e+04]
E1 = -727.865042981833  E_coul = 201.10843741410986
cycle= 1 E= -526.756605567723  delta_E= -0.386  |g|= 0.186  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.586342
diis-c [-0.34379728  1.        ]
  HOMO = -0.590482794647083  LUMO = 0.961718610312482
  mo_energy =
[-1.18643911e+02 -1.23436410e+01 -9.59538980e+00 -9.59538980e+00
 -9.59538980e+00 -1.27940930e+00 -5.90482795e-01 -5.90482795e-01
 -5.90482795e-01  9.61718610e-01  1.01960412e+00  1.01960412e+00
  1.01960412e+00  7.44201052e+00  7.44201052e+00  7.44201052e+00
  1.19295256e+01  3.43947984e+01  3.43947984e+01  3.43947984e+01
  9.20024891e+01  1.32616273e+02  1.32616273e+02  1.32616273e+02
  3.82757963e+02  4.87576745e+02  4.87576745e+02  4.87576745e+02
  1.13612421e+03  1.33288165e+03  1.33288165e+03  1.33288165e+03
  3.01750820e+03  3.01750820e+03  3.01750820e+03  3.38441446e+03
  6.63122400e+03  6.63122400e+03  6.63122400e+03  9.80502830e+03
  2.61309830e+04  7.68254915e+04]
E1 = -728.4373793530523  E_coul = 201.6800554064292
cycle= 2 E= -526.757323946623  delta_E= -0.000718  |g|= 0.0376  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0765396
diis-c [-0.00385711  0.07125884  0.92874116]
  HOMO = -0.581295759892348  LUMO = 0.969767132777127
  mo_energy =
[-1.18575534e+02 -1.23052462e+01 -9.55532282e+00 -9.55532282e+00
 -9.55532282e+00 -1.26840809e+00 -5.81295760e-01 -5.81295760e-01
 -5.81295760e-01  9.69767133e-01  1.02647122e+00  1.02647122e+00
  1.02647122e+00  7.46631673e+00  7.46631673e+00  7.46631673e+00
  1.19591760e+01  3.44356457e+01  3.44356457e+01  3.44356457e+01
  9.20557527e+01  1.32672956e+02  1.32672956e+02  1.32672956e+02
  3.82823389e+02  4.87644249e+02  4.87644249e+02  4.87644249e+02
  1.13619554e+03  1.33295324e+03  1.33295324e+03  1.33295324e+03
  3.01758209e+03  3.01758209e+03  3.01758209e+03  3.38448933e+03
  6.63129966e+03  6.63129966e+03  6.63129966e+03  9.80510470e+03
  2.61310601e+04  7.68255688e+04]
E1 = -728.285917659417  E_coul = 201.52853548098275
cycle= 3 E= -526.757382178434  delta_E= -5.82e-05  |g|= 0.00679  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0143931
diis-c [-7.38675239e-07 -1.20794992e-03  1.54214209e-01  8.46993741e-01]
  HOMO = -0.58289735984636  LUMO = 0.968462078291592
  mo_energy =
[-1.18586284e+02 -1.23114901e+01 -9.56193437e+00 -9.56193437e+00
 -9.56193437e+00 -1.27021903e+00 -5.82897360e-01 -5.82897360e-01
 -5.82897360e-01  9.68462078e-01  1.02529912e+00  1.02529912e+00
  1.02529912e+00  7.46221170e+00  7.46221170e+00  7.46221170e+00
  1.19543193e+01  3.44289505e+01  3.44289505e+01  3.44289505e+01
  9.20472697e+01  1.32663921e+02  1.32663921e+02  1.32663921e+02
  3.82813083e+02  4.87633631e+02  4.87633631e+02  4.87633631e+02
  1.13618430e+03  1.33294199e+03  1.33294199e+03  1.33294199e+03
  3.01757041e+03  3.01757041e+03  3.01757041e+03  3.38447741e+03
  6.63128757e+03  6.63128757e+03  6.63128757e+03  9.80509241e+03
  2.61310476e+04  7.68255562e+04]
E1 = -728.3103827731048  E_coul = 201.55299838046798
cycle= 4 E= -526.757384392637  delta_E= -2.21e-06  |g|= 0.000102  |ddm|= 0.00242
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000111715
diis-c [-4.44037839e-09  7.78108980e-05 -1.15190298e-02 -6.77745970e-02
  1.07921582e+00]
  HOMO = -0.582878676547601  LUMO = 0.96849655638149
  mo_energy =
[-1.18586237e+02 -1.23114223e+01 -9.56188020e+00 -9.56188020e+00
 -9.56188020e+00 -1.27017668e+00 -5.82878677e-01 -5.82878677e-01
 -5.82878677e-01  9.68496556e-01  1.02531549e+00  1.02531549e+00
  1.02531549e+00  7.46225524e+00  7.46225524e+00  7.46225524e+00
  1.19543809e+01  3.44290030e+01  3.44290030e+01  3.44290030e+01
  9.20473279e+01  1.32663974e+02  1.32663974e+02  1.32663974e+02
  3.82813132e+02  4.87633679e+02  4.87633679e+02  4.87633679e+02
  1.13618433e+03  1.33294203e+03  1.33294203e+03  1.33294203e+03
  3.01757044e+03  3.01757044e+03  3.01757044e+03  3.38447743e+03
  6.63128758e+03  6.63128758e+03  6.63128758e+03  9.80509241e+03
  2.61310476e+04  7.68255562e+04]
E1 = -728.3101536777988  E_coul = 201.55276928329675
cycle= 5 E= -526.757384394502  delta_E= -1.87e-09  |g|= 2.08e-05  |ddm|= 0.000165
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.9206e-05
diis-c [-8.36767473e-11  1.26316413e-05 -1.85612675e-03 -1.28010127e-02
  3.42720403e-02  9.80372468e-01]
  HOMO = -0.582886224990492  LUMO = 0.968492722739465
  mo_energy =
[-1.18586268e+02 -1.23114450e+01 -9.56190491e+00 -9.56190491e+00
 -9.56190491e+00 -1.27018261e+00 -5.82886225e-01 -5.82886225e-01
 -5.82886225e-01  9.68492723e-01  1.02531043e+00  1.02531043e+00
  1.02531043e+00  7.46223827e+00  7.46223827e+00  7.46223827e+00
  1.19543628e+01  3.44289788e+01  3.44289788e+01  3.44289788e+01
  9.20473009e+01  1.32663946e+02  1.32663946e+02  1.32663946e+02
  3.82813102e+02  4.87633648e+02  4.87633648e+02  4.87633648e+02
  1.13618430e+03  1.33294199e+03  1.33294199e+03  1.33294199e+03
  3.01757041e+03  3.01757041e+03  3.01757041e+03  3.38447740e+03
  6.63128755e+03  6.63128755e+03  6.63128755e+03  9.80509238e+03
  2.61310475e+04  7.68255561e+04]
E1 = -728.3102351164438  E_coul = 201.55285072188065
cycle= 6 E= -526.757384394563  delta_E= -6.12e-11  |g|= 1.8e-06  |ddm|= 1.93e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3102351164438  E_coul = 201.55285072188065
  HOMO = -0.582886169004607  LUMO = 0.968493125443013
  mo_energy =
[-1.18586268e+02 -1.23114446e+01 -9.56190457e+00 -9.56190457e+00
 -9.56190457e+00 -1.27018215e+00 -5.82886169e-01 -5.82886169e-01
 -5.82886169e-01  9.68493125e-01  1.02531052e+00  1.02531052e+00
  1.02531052e+00  7.46223851e+00  7.46223851e+00  7.46223851e+00
  1.19543633e+01  3.44289792e+01  3.44289792e+01  3.44289792e+01
  9.20473014e+01  1.32663947e+02  1.32663947e+02  1.32663947e+02
  3.82813102e+02  4.87633648e+02  4.87633648e+02  4.87633648e+02
  1.13618430e+03  1.33294199e+03  1.33294199e+03  1.33294199e+03
  3.01757041e+03  3.01757041e+03  3.01757041e+03  3.38447740e+03
  6.63128755e+03  6.63128755e+03  6.63128755e+03  9.80509238e+03
  2.61310475e+04  7.68255561e+04]
E1 = -728.3102330538893  E_coul = 201.5528486593261
Extra cycle  E= -526.757384394563  delta_E= -1.14e-13  |g|= 3.74e-07  |ddm|= 3.16e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.24 sec
exp = [2.61828968e+04 7.61694798e+03 3.61755503e+03 1.58487827e+03
 4.27800707e+02 1.88043647e+02 9.38942562e+01 3.45980167e+01
 7.92721861e+00 6.57230311e-01 3.14113533e+00 2.38630171e-01
 1.36286282e+03 6.63977633e+02 2.97345808e+02 3.10926021e+02
 6.31476341e+01 7.51598760e+00 2.07829270e+01 7.82250060e-01
 2.87037591e+00 2.24068401e-01]
E = -526.7573843945632
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:06 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.8967707        1
[INPUT] 0    0    [1    /1   ]  7616.94797749        1
[INPUT] 0    0    [1    /1   ]  3617.55502829        1
[INPUT] 0    0    [1    /1   ]  1584.87826689        1
[INPUT] 0    0    [1    /1   ]  427.800707193        1
[INPUT] 0    0    [1    /1   ]  188.043646711        1
[INPUT] 0    0    [1    /1   ]  93.8942561718        1
[INPUT] 0    0    [1    /1   ]  34.5980166889        1
[INPUT] 0    0    [1    /1   ]  7.92721860553        1
[INPUT] 0    0    [1    /1   ]  0.657230310845       1
[INPUT] 0    0    [1    /1   ]  3.1411353316         1
[INPUT] 0    0    [1    /1   ]  0.238630171493       1
[INPUT] 1    0    [1    /1   ]  1362.86282202        1
[INPUT] 1    0    [1    /1   ]  663.977633228        1
[INPUT] 1    0    [1    /1   ]  297.345807625        1
[INPUT] 1    0    [1    /1   ]  310.9260206          1
[INPUT] 1    0    [1    /1   ]  63.1476340738        1
[INPUT] 1    0    [1    /1   ]  7.51598760082        1
[INPUT] 1    0    [1    /1   ]  20.7829269877        1
[INPUT] 1    0    [1    /1   ]  0.78225006034        1
[INPUT] 1    0    [1    /1   ]  2.87037590586        1
[INPUT] 1    0    [1    /1   ]  0.224068401417       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.896770674015, 1.0]], [0, [7616.9479774856145, 1.0]], [0, [3617.5550282938607, 1.0]], [0, [1584.8782668856409, 1.0]], [0, [427.80070719344906, 1.0]], [0, [188.0436467111301, 1.0]], [0, [93.89425617182097, 1.0]], [0, [34.59801668891565, 1.0]], [0, [7.927218605529725, 1.0]], [0, [0.6572303108446714, 1.0]], [0, [3.141135331604808, 1.0]], [0, [0.23863017149263682, 1.0]], [1, [1362.8628220227267, 1.0]], [1, [663.9776332280304, 1.0]], [1, [297.34580762495676, 1.0]], [1, [310.926020599946, 1.0]], [1, [63.14763407378717, 1.0]], [1, [7.515987600818632, 1.0]], [1, [20.782926987679172, 1.0]], [1, [0.7822500603404283, 1.0]], [1, [2.8703759058581704, 1.0]], [1, [0.22406840141744155, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.89677067]
bas 1, expnt(s) = [7616.94797749]
bas 2, expnt(s) = [3617.55502829]
bas 3, expnt(s) = [1584.87826689]
bas 4, expnt(s) = [427.80070719]
bas 5, expnt(s) = [188.04364671]
bas 6, expnt(s) = [93.89425617]
bas 7, expnt(s) = [34.59801669]
bas 8, expnt(s) = [7.92721861]
bas 9, expnt(s) = [0.65723031]
bas 10, expnt(s) = [3.14113533]
bas 11, expnt(s) = [0.23863017]
bas 12, expnt(s) = [1362.86282202]
bas 13, expnt(s) = [663.97763323]
bas 14, expnt(s) = [297.34580762]
bas 15, expnt(s) = [310.9260206]
bas 16, expnt(s) = [63.14763407]
bas 17, expnt(s) = [7.5159876]
bas 18, expnt(s) = [20.78292699]
bas 19, expnt(s) = [0.78225006]
bas 20, expnt(s) = [2.87037591]
bas 21, expnt(s) = [0.2240684]
CPU time:       582.10
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61828968e+04 5.20029875e+03 7.61694798e+03 2.05992195e+03
 3.61755503e+03 1.17849131e+03 1.58487827e+03 6.34617373e+02
 4.27800707e+02 2.37654558e+02 1.88043647e+02 1.28294791e+02
 9.38942562e+01 7.62068997e+01 3.45980167e+01 3.60415473e+01
 7.92721861e+00 1.19359132e+01 6.57230311e-01 1.84417960e+00
 3.14113533e+00 5.96114945e+00 2.38630171e-01 8.62599177e-01
 1.36286282e+03 2.41573657e+04 6.63977633e+02 9.83277734e+03
 2.97345808e+02 3.60214895e+03 3.10926021e+02 3.80895400e+03
 6.31476341e+01 5.19314857e+02 7.51598760e+00 3.63050435e+01
 2.07829270e+01 1.29454688e+02 7.82250060e-01 2.14618126e+00
 2.87037591e+00 1.08995323e+01 2.24068401e-01 4.49738599e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993446201870007
cond(S) = 108487.29184657476
E1 = -729.5477777893025  E_coul = 203.1776521873734
init E= -526.370125601929
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555698154030921  LUMO = 0.98927291592002
  mo_energy =
[-1.18336430e+02 -1.22061092e+01 -9.44702006e+00 -9.44702006e+00
 -9.44702006e+00 -1.24015998e+00 -5.55698154e-01 -5.55698154e-01
 -5.55698154e-01  9.89272916e-01  1.04414593e+00  1.04414593e+00
  1.04414593e+00  7.53399722e+00  7.53399722e+00  7.53399722e+00
  1.20365517e+01  3.45504870e+01  3.45504870e+01  3.45504870e+01
  9.22061462e+01  1.32845801e+02  1.32845801e+02  1.32845801e+02
  3.83041596e+02  4.87882189e+02  4.87882189e+02  4.87882189e+02
  1.13649333e+03  1.33324323e+03  1.33324323e+03  1.33324323e+03
  3.01793543e+03  3.01793543e+03  3.01793543e+03  3.38490734e+03
  6.63176386e+03  6.63176386e+03  6.63176386e+03  9.80563769e+03
  2.61316890e+04  7.68262888e+04]
E1 = -727.865042981833  E_coul = 201.10843741410986
cycle= 1 E= -526.756605567723  delta_E= -0.386  |g|= 0.186  |ddm|= 0.31
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.586342
diis-c [-0.34379728  1.        ]
  HOMO = -0.590482794647083  LUMO = 0.961718610312482
  mo_energy =
[-1.18643911e+02 -1.23436410e+01 -9.59538980e+00 -9.59538980e+00
 -9.59538980e+00 -1.27940930e+00 -5.90482795e-01 -5.90482795e-01
 -5.90482795e-01  9.61718610e-01  1.01960412e+00  1.01960412e+00
  1.01960412e+00  7.44201052e+00  7.44201052e+00  7.44201052e+00
  1.19295256e+01  3.43947984e+01  3.43947984e+01  3.43947984e+01
  9.20024891e+01  1.32616273e+02  1.32616273e+02  1.32616273e+02
  3.82757963e+02  4.87576745e+02  4.87576745e+02  4.87576745e+02
  1.13612421e+03  1.33288165e+03  1.33288165e+03  1.33288165e+03
  3.01750820e+03  3.01750820e+03  3.01750820e+03  3.38441446e+03
  6.63122400e+03  6.63122400e+03  6.63122400e+03  9.80502830e+03
  2.61309830e+04  7.68254915e+04]
E1 = -728.4373793530523  E_coul = 201.6800554064292
cycle= 2 E= -526.757323946623  delta_E= -0.000718  |g|= 0.0376  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0765396
diis-c [-0.00385711  0.07125884  0.92874116]
  HOMO = -0.581295759892348  LUMO = 0.969767132777127
  mo_energy =
[-1.18575534e+02 -1.23052462e+01 -9.55532282e+00 -9.55532282e+00
 -9.55532282e+00 -1.26840809e+00 -5.81295760e-01 -5.81295760e-01
 -5.81295760e-01  9.69767133e-01  1.02647122e+00  1.02647122e+00
  1.02647122e+00  7.46631673e+00  7.46631673e+00  7.46631673e+00
  1.19591760e+01  3.44356457e+01  3.44356457e+01  3.44356457e+01
  9.20557527e+01  1.32672956e+02  1.32672956e+02  1.32672956e+02
  3.82823389e+02  4.87644249e+02  4.87644249e+02  4.87644249e+02
  1.13619554e+03  1.33295324e+03  1.33295324e+03  1.33295324e+03
  3.01758209e+03  3.01758209e+03  3.01758209e+03  3.38448933e+03
  6.63129966e+03  6.63129966e+03  6.63129966e+03  9.80510470e+03
  2.61310601e+04  7.68255688e+04]
E1 = -728.285917659417  E_coul = 201.52853548098275
cycle= 3 E= -526.757382178434  delta_E= -5.82e-05  |g|= 0.00679  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0143931
diis-c [-7.38675239e-07 -1.20794992e-03  1.54214209e-01  8.46993741e-01]
  HOMO = -0.58289735984636  LUMO = 0.968462078291592
  mo_energy =
[-1.18586284e+02 -1.23114901e+01 -9.56193437e+00 -9.56193437e+00
 -9.56193437e+00 -1.27021903e+00 -5.82897360e-01 -5.82897360e-01
 -5.82897360e-01  9.68462078e-01  1.02529912e+00  1.02529912e+00
  1.02529912e+00  7.46221170e+00  7.46221170e+00  7.46221170e+00
  1.19543193e+01  3.44289505e+01  3.44289505e+01  3.44289505e+01
  9.20472697e+01  1.32663921e+02  1.32663921e+02  1.32663921e+02
  3.82813083e+02  4.87633631e+02  4.87633631e+02  4.87633631e+02
  1.13618430e+03  1.33294199e+03  1.33294199e+03  1.33294199e+03
  3.01757041e+03  3.01757041e+03  3.01757041e+03  3.38447741e+03
  6.63128757e+03  6.63128757e+03  6.63128757e+03  9.80509241e+03
  2.61310476e+04  7.68255562e+04]
E1 = -728.3103827731048  E_coul = 201.55299838046798
cycle= 4 E= -526.757384392637  delta_E= -2.21e-06  |g|= 0.000102  |ddm|= 0.00242
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000111715
diis-c [-4.44037839e-09  7.78108980e-05 -1.15190298e-02 -6.77745970e-02
  1.07921582e+00]
  HOMO = -0.582878676547601  LUMO = 0.96849655638149
  mo_energy =
[-1.18586237e+02 -1.23114223e+01 -9.56188020e+00 -9.56188020e+00
 -9.56188020e+00 -1.27017668e+00 -5.82878677e-01 -5.82878677e-01
 -5.82878677e-01  9.68496556e-01  1.02531549e+00  1.02531549e+00
  1.02531549e+00  7.46225524e+00  7.46225524e+00  7.46225524e+00
  1.19543809e+01  3.44290030e+01  3.44290030e+01  3.44290030e+01
  9.20473279e+01  1.32663974e+02  1.32663974e+02  1.32663974e+02
  3.82813132e+02  4.87633679e+02  4.87633679e+02  4.87633679e+02
  1.13618433e+03  1.33294203e+03  1.33294203e+03  1.33294203e+03
  3.01757044e+03  3.01757044e+03  3.01757044e+03  3.38447743e+03
  6.63128758e+03  6.63128758e+03  6.63128758e+03  9.80509241e+03
  2.61310476e+04  7.68255562e+04]
E1 = -728.3101536777988  E_coul = 201.55276928329675
cycle= 5 E= -526.757384394502  delta_E= -1.87e-09  |g|= 2.08e-05  |ddm|= 0.000165
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.9206e-05
diis-c [-8.36767473e-11  1.26316413e-05 -1.85612675e-03 -1.28010127e-02
  3.42720403e-02  9.80372468e-01]
  HOMO = -0.582886224990492  LUMO = 0.968492722739465
  mo_energy =
[-1.18586268e+02 -1.23114450e+01 -9.56190491e+00 -9.56190491e+00
 -9.56190491e+00 -1.27018261e+00 -5.82886225e-01 -5.82886225e-01
 -5.82886225e-01  9.68492723e-01  1.02531043e+00  1.02531043e+00
  1.02531043e+00  7.46223827e+00  7.46223827e+00  7.46223827e+00
  1.19543628e+01  3.44289788e+01  3.44289788e+01  3.44289788e+01
  9.20473009e+01  1.32663946e+02  1.32663946e+02  1.32663946e+02
  3.82813102e+02  4.87633648e+02  4.87633648e+02  4.87633648e+02
  1.13618430e+03  1.33294199e+03  1.33294199e+03  1.33294199e+03
  3.01757041e+03  3.01757041e+03  3.01757041e+03  3.38447740e+03
  6.63128755e+03  6.63128755e+03  6.63128755e+03  9.80509238e+03
  2.61310475e+04  7.68255561e+04]
E1 = -728.3102351164438  E_coul = 201.55285072188065
cycle= 6 E= -526.757384394563  delta_E= -6.12e-11  |g|= 1.8e-06  |ddm|= 1.93e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3102351164438  E_coul = 201.55285072188065
  HOMO = -0.582886169004607  LUMO = 0.968493125443013
  mo_energy =
[-1.18586268e+02 -1.23114446e+01 -9.56190457e+00 -9.56190457e+00
 -9.56190457e+00 -1.27018215e+00 -5.82886169e-01 -5.82886169e-01
 -5.82886169e-01  9.68493125e-01  1.02531052e+00  1.02531052e+00
  1.02531052e+00  7.46223851e+00  7.46223851e+00  7.46223851e+00
  1.19543633e+01  3.44289792e+01  3.44289792e+01  3.44289792e+01
  9.20473014e+01  1.32663947e+02  1.32663947e+02  1.32663947e+02
  3.82813102e+02  4.87633648e+02  4.87633648e+02  4.87633648e+02
  1.13618430e+03  1.33294199e+03  1.33294199e+03  1.33294199e+03
  3.01757041e+03  3.01757041e+03  3.01757041e+03  3.38447740e+03
  6.63128755e+03  6.63128755e+03  6.63128755e+03  9.80509238e+03
  2.61310475e+04  7.68255561e+04]
E1 = -728.3102330538893  E_coul = 201.5528486593261
Extra cycle  E= -526.757384394563  delta_E= -1.14e-13  |g|= 3.74e-07  |ddm|= 3.16e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 108487.29184657476
E1 = -728.3102330538893  E_coul = 201.5528486593261
init E= -526.757384394563
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.582886222890311  LUMO = 0.968493153158976
  mo_energy =
[-1.18586268e+02 -1.23114447e+01 -9.56190475e+00 -9.56190475e+00
 -9.56190475e+00 -1.27018213e+00 -5.82886223e-01 -5.82886223e-01
 -5.82886223e-01  9.68493153e-01  1.02531050e+00  1.02531050e+00
  1.02531050e+00  7.46223840e+00  7.46223840e+00  7.46223840e+00
  1.19543632e+01  3.44289790e+01  3.44289790e+01  3.44289790e+01
  9.20473012e+01  1.32663946e+02  1.32663946e+02  1.32663946e+02
  3.82813102e+02  4.87633648e+02  4.87633648e+02  4.87633648e+02
  1.13618430e+03  1.33294199e+03  1.33294199e+03  1.33294199e+03
  3.01757041e+03  3.01757041e+03  3.01757041e+03  3.38447740e+03
  6.63128755e+03  6.63128755e+03  6.63128755e+03  9.80509238e+03
  2.61310475e+04  7.68255561e+04]
E1 = -728.3102334999232  E_coul = 201.5528491053602
cycle= 1 E= -526.757384394563  delta_E= 2.27e-13  |g|= 8.23e-08  |ddm|= 5.98e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.3102334999232  E_coul = 201.5528491053602
  HOMO = -0.58288621724497  LUMO = 0.9684931729134
  mo_energy =
[-1.18586268e+02 -1.23114447e+01 -9.56190471e+00 -9.56190471e+00
 -9.56190471e+00 -1.27018211e+00 -5.82886217e-01 -5.82886217e-01
 -5.82886217e-01  9.68493173e-01  1.02531050e+00  1.02531050e+00
  1.02531050e+00  7.46223842e+00  7.46223842e+00  7.46223842e+00
  1.19543632e+01  3.44289791e+01  3.44289791e+01  3.44289791e+01
  9.20473012e+01  1.32663946e+02  1.32663946e+02  1.32663946e+02
  3.82813102e+02  4.87633648e+02  4.87633648e+02  4.87633648e+02
  1.13618430e+03  1.33294199e+03  1.33294199e+03  1.33294199e+03
  3.01757041e+03  3.01757041e+03  3.01757041e+03  3.38447740e+03
  6.63128755e+03  6.63128755e+03  6.63128755e+03  9.80509238e+03
  2.61310475e+04  7.68255561e+04]
E1 = -728.3102333474908  E_coul = 201.55284895292638
Extra cycle  E= -526.757384394564  delta_E= -1.36e-12  |g|= 1.72e-08  |ddm|= 1.33e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.43 sec
exp = [2.61828968e+04 7.61694798e+03 3.61755503e+03 1.58487827e+03
 4.27800707e+02 1.88043647e+02 9.38942562e+01 3.45980167e+01
 7.92721861e+00 6.57230311e-01 3.14113533e+00 2.38630171e-01
 1.36286282e+03 6.63977633e+02 2.97345808e+02 3.10926021e+02
 6.31476341e+01 7.51598760e+00 2.07829270e+01 7.82250060e-01
 2.87037591e+00 2.24068401e-01]
grad_E = [-1.45993055e-06  2.71345687e-06 -2.17563430e-06  5.66654635e-05
 -2.52720141e-04  7.57709932e-05  2.06371201e-04 -2.57046913e-04
 -2.91568924e-04  4.80958580e-04  7.63047335e-04 -1.63092812e-03
 -5.99637909e-07  3.92754746e-06  1.78603459e-05  1.52091673e-05
  8.29341176e-05  2.83352992e-04 -1.51875476e-06 -6.91543049e-04
 -4.23098986e-04  2.12621100e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:10 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.9011259        1
[INPUT] 0    0    [1    /1   ]  7616.9375562         1
[INPUT] 0    0    [1    /1   ]  3617.55867269        1
[INPUT] 0    0    [1    /1   ]  1584.64235988        1
[INPUT] 0    0    [1    /1   ]  428.648548105        1
[INPUT] 0    0    [1    /1   ]  189.595803659        1
[INPUT] 0    0    [1    /1   ]  94.2703961201        1
[INPUT] 0    0    [1    /1   ]  34.6365544345        1
[INPUT] 0    0    [1    /1   ]  7.93240031307        1
[INPUT] 0    0    [1    /1   ]  0.658715003262       1
[INPUT] 0    0    [1    /1   ]  3.1422784045         1
[INPUT] 0    0    [1    /1   ]  0.238257118365       1
[INPUT] 1    0    [1    /1   ]  1362.86426177        1
[INPUT] 1    0    [1    /1   ]  663.963788183        1
[INPUT] 1    0    [1    /1   ]  297.280639149        1
[INPUT] 1    0    [1    /1   ]  310.86986479         1
[INPUT] 1    0    [1    /1   ]  63.1710905488        1
[INPUT] 1    0    [1    /1   ]  7.52606700906        1
[INPUT] 1    0    [1    /1   ]  20.7978339145        1
[INPUT] 1    0    [1    /1   ]  0.782287197782       1
[INPUT] 1    0    [1    /1   ]  2.87001847728        1
[INPUT] 1    0    [1    /1   ]  0.224097265084       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.90112590513, 1.0]], [0, [7616.937556202541, 1.0]], [0, [3617.5586726891424, 1.0]], [0, [1584.6423598774606, 1.0]], [0, [428.6485481045493, 1.0]], [0, [189.59580365916258, 1.0]], [0, [94.27039612011336, 1.0]], [0, [34.636554434500596, 1.0]], [0, [7.932400313073337, 1.0]], [0, [0.6587150032619103, 1.0]], [0, [3.142278404498615, 1.0]], [0, [0.2382571183646568, 1.0]], [1, [1362.8642617670973, 1.0]], [1, [663.9637881832764, 1.0]], [1, [297.2806391494378, 1.0]], [1, [310.86986478955635, 1.0]], [1, [63.17109054883197, 1.0]], [1, [7.526067009062039, 1.0]], [1, [20.797833914530216, 1.0]], [1, [0.7822871977821966, 1.0]], [1, [2.8700184772785953, 1.0]], [1, [0.22409726508409028, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.90112591]
bas 1, expnt(s) = [7616.9375562]
bas 2, expnt(s) = [3617.55867269]
bas 3, expnt(s) = [1584.64235988]
bas 4, expnt(s) = [428.6485481]
bas 5, expnt(s) = [189.59580366]
bas 6, expnt(s) = [94.27039612]
bas 7, expnt(s) = [34.63655443]
bas 8, expnt(s) = [7.93240031]
bas 9, expnt(s) = [0.658715]
bas 10, expnt(s) = [3.1422784]
bas 11, expnt(s) = [0.23825712]
bas 12, expnt(s) = [1362.86426177]
bas 13, expnt(s) = [663.96378818]
bas 14, expnt(s) = [297.28063915]
bas 15, expnt(s) = [310.86986479]
bas 16, expnt(s) = [63.17109055]
bas 17, expnt(s) = [7.52606701]
bas 18, expnt(s) = [20.79783391]
bas 19, expnt(s) = [0.7822872]
bas 20, expnt(s) = [2.87001848]
bas 21, expnt(s) = [0.22409727]
CPU time:       587.72
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61829011e+04 5.20029940e+03 7.61693756e+03 2.05991984e+03
 3.61755867e+03 1.17849220e+03 1.58464236e+03 6.34546525e+02
 4.28648548e+02 2.38007719e+02 1.89595804e+02 1.29088206e+02
 9.42703961e+01 7.64357486e+01 3.46365544e+01 3.60716523e+01
 7.93240031e+00 1.19417642e+01 6.58715003e-01 1.84730323e+00
 3.14227840e+00 5.96277634e+00 2.38257118e-01 8.61587596e-01
 1.36286426e+03 2.41573976e+04 6.63963788e+02 9.83252106e+03
 2.97280639e+02 3.60116214e+03 3.10869865e+02 3.80809411e+03
 6.31710905e+01 5.19555995e+02 7.52606701e+00 3.63659128e+01
 2.07978339e+01 1.29570766e+02 7.82287198e-01 2.14630863e+00
 2.87001848e+00 1.08978358e+01 2.24097265e-01 4.49811017e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993439246636584
cond(S) = 108344.0700038629
E1 = -729.5483250747999  E_coul = 203.17821747398722
init E= -526.370107600813
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555684777263894  LUMO = 0.989826887998168
  mo_energy =
[-1.18336417e+02 -1.22060483e+01 -9.44697385e+00 -9.44697385e+00
 -9.44697385e+00 -1.24014684e+00 -5.55684777e-01 -5.55684777e-01
 -5.55684777e-01  9.89826888e-01  1.04425555e+00  1.04425555e+00
  1.04425555e+00  7.53661114e+00  7.53661114e+00  7.53661114e+00
  1.20523980e+01  3.45831408e+01  3.45831408e+01  3.45831408e+01
  9.24667535e+01  1.32940924e+02  1.32940924e+02  1.32940924e+02
  3.84836659e+02  4.87982333e+02  4.87982333e+02  4.87982333e+02
  1.14187048e+03  1.33322102e+03  1.33322102e+03  1.33322102e+03
  3.01773762e+03  3.01773762e+03  3.01773762e+03  3.39377192e+03
  6.63144346e+03  6.63144346e+03  6.63144346e+03  9.81532978e+03
  2.61411288e+04  7.68351296e+04]
E1 = -727.8640826313979  E_coul = 201.1074460568856
cycle= 1 E= -526.756636574512  delta_E= -0.387  |g|= 0.186  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.586124
diis-c [-0.34354173  1.        ]
  HOMO = -0.590521499231775  LUMO = 0.962220833686678
  mo_energy =
[-1.18644004e+02 -1.23437056e+01 -9.59546035e+00 -9.59546035e+00
 -9.59546035e+00 -1.27943548e+00 -5.90521499e-01 -5.90521499e-01
 -5.90521499e-01  9.62220834e-01  1.01968181e+00  1.01968181e+00
  1.01968181e+00  7.44448221e+00  7.44448221e+00  7.44448221e+00
  1.19451542e+01  3.44272771e+01  3.44272771e+01  3.44272771e+01
  9.22627523e+01  1.32711263e+02  1.32711263e+02  1.32711263e+02
  3.84552474e+02  4.87676795e+02  4.87676795e+02  4.87676795e+02
  1.14150086e+03  1.33285935e+03  1.33285935e+03  1.33285935e+03
  3.01731029e+03  3.01731029e+03  3.01731029e+03  3.39327890e+03
  6.63090350e+03  6.63090350e+03  6.63090350e+03  9.81472034e+03
  2.61404228e+04  7.68343322e+04]
E1 = -728.4367152757809  E_coul = 201.6793595484485
cycle= 2 E= -526.757355727332  delta_E= -0.000719  |g|= 0.0376  |ddm|= 0.0533
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076554
diis-c [-0.00385647  0.07133065  0.92866935]
  HOMO = -0.581328892187177  LUMO = 0.970285274088299
  mo_energy =
[-1.18575609e+02 -1.23052931e+01 -9.55537543e+00 -9.55537543e+00
 -9.55537543e+00 -1.26842405e+00 -5.81328892e-01 -5.81328892e-01
 -5.81328892e-01  9.70285274e-01  1.02655407e+00  1.02655407e+00
  1.02655407e+00  7.46880913e+00  7.46880913e+00  7.46880913e+00
  1.19748356e+01  3.44681561e+01  3.44681561e+01  3.44681561e+01
  9.23160824e+01  1.32767968e+02  1.32767968e+02  1.32767968e+02
  3.84617966e+02  4.87744316e+02  4.87744316e+02  4.87744316e+02
  1.14157224e+03  1.33293096e+03  1.33293096e+03  1.33293096e+03
  3.01738419e+03  3.01738419e+03  3.01738419e+03  3.39335379e+03
  6.63097918e+03  6.63097918e+03  6.63097918e+03  9.81479676e+03
  2.61404998e+04  7.68344096e+04]
E1 = -728.2851531212211  E_coul = 201.52773907724512
cycle= 3 E= -526.757414043976  delta_E= -5.83e-05  |g|= 0.00679  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0143964
diis-c [-7.44779135e-07 -1.20818256e-03  1.54217262e-01  8.46990920e-01]
  HOMO = -0.582931264183382  LUMO = 0.968979397116243
  mo_energy =
[-1.18586361e+02 -1.23115386e+01 -9.56198885e+00 -9.56198885e+00
 -9.56198885e+00 -1.27023450e+00 -5.82931264e-01 -5.82931264e-01
 -5.82931264e-01  9.68979397e-01  1.02538150e+00  1.02538150e+00
  1.02538150e+00  7.46470149e+00  7.46470149e+00  7.46470149e+00
  1.19699749e+01  3.44614569e+01  3.44614569e+01  3.44614569e+01
  9.23075902e+01  1.32758931e+02  1.32758931e+02  1.32758931e+02
  3.84607651e+02  4.87733697e+02  4.87733697e+02  4.87733697e+02
  1.14156099e+03  1.33291970e+03  1.33291970e+03  1.33291970e+03
  3.01737252e+03  3.01737252e+03  3.01737252e+03  3.39334187e+03
  6.63096709e+03  6.63096709e+03  6.63096709e+03  9.81478447e+03
  2.61404873e+04  7.68343969e+04]
E1 = -728.3096251137091  E_coul = 201.55220885317013
cycle= 4 E= -526.757416260539  delta_E= -2.22e-06  |g|= 0.000103  |ddm|= 0.00242
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000113256
diis-c [-4.49035277e-09  7.89601662e-05 -1.16850196e-02 -6.87753022e-02
  1.08038136e+00]
  HOMO = -0.582912810115558  LUMO = 0.969014093144543
  mo_energy =
[-1.18586315e+02 -1.23114712e+01 -9.56193530e+00 -9.56193530e+00
 -9.56193530e+00 -1.27019199e+00 -5.82912810e-01 -5.82912810e-01
 -5.82912810e-01  9.69014093e-01  1.02539777e+00  1.02539777e+00
  1.02539777e+00  7.46474461e+00  7.46474461e+00  7.46474461e+00
  1.19700361e+01  3.44615087e+01  3.44615087e+01  3.44615087e+01
  9.23076479e+01  1.32758983e+02  1.32758983e+02  1.32758983e+02
  3.84607699e+02  4.87733743e+02  4.87733743e+02  4.87733743e+02
  1.14156103e+03  1.33291974e+03  1.33291974e+03  1.33291974e+03
  3.01737254e+03  3.01737254e+03  3.01737254e+03  3.39334189e+03
  6.63096710e+03  6.63096710e+03  6.63096710e+03  9.81478447e+03
  2.61404873e+04  7.68343969e+04]
E1 = -728.3093971662719  E_coul = 201.5519809037959
cycle= 5 E= -526.757416262476  delta_E= -1.94e-09  |g|= 2.09e-05  |ddm|= 0.000168
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93514e-05
diis-c [-8.53715578e-11  1.26664527e-05 -1.85913799e-03 -1.28234076e-02
  3.26081788e-02  9.82061700e-01]
  HOMO = -0.582920400401793  LUMO = 0.969010263580331
  mo_energy =
[-1.18586346e+02 -1.23114941e+01 -9.56196012e+00 -9.56196012e+00
 -9.56196012e+00 -1.27019792e+00 -5.82920400e-01 -5.82920400e-01
 -5.82920400e-01  9.69010264e-01  1.02539268e+00  1.02539268e+00
  1.02539268e+00  7.46472755e+00  7.46472755e+00  7.46472755e+00
  1.19700180e+01  3.44614845e+01  3.44614845e+01  3.44614845e+01
  9.23076207e+01  1.32758954e+02  1.32758954e+02  1.32758954e+02
  3.84607668e+02  4.87733713e+02  4.87733713e+02  4.87733713e+02
  1.14156099e+03  1.33291970e+03  1.33291970e+03  1.33291970e+03
  3.01737251e+03  3.01737251e+03  3.01737251e+03  3.39334186e+03
  6.63096707e+03  6.63096707e+03  6.63096707e+03  9.81478444e+03
  2.61404873e+04  7.68343969e+04]
E1 = -728.3094789463885  E_coul = 201.55206268385064
cycle= 6 E= -526.757416262538  delta_E= -6.18e-11  |g|= 1.81e-06  |ddm|= 1.96e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.3094789463885  E_coul = 201.55206268385064
  HOMO = -0.582920329137432  LUMO = 0.969010678455741
  mo_energy =
[-1.18586346e+02 -1.23114936e+01 -9.56195973e+00 -9.56195973e+00
 -9.56195973e+00 -1.27019743e+00 -5.82920329e-01 -5.82920329e-01
 -5.82920329e-01  9.69010678e-01  1.02539279e+00  1.02539279e+00
  1.02539279e+00  7.46472783e+00  7.46472783e+00  7.46472783e+00
  1.19700184e+01  3.44614849e+01  3.44614849e+01  3.44614849e+01
  9.23076212e+01  1.32758955e+02  1.32758955e+02  1.32758955e+02
  3.84607669e+02  4.87733713e+02  4.87733713e+02  4.87733713e+02
  1.14156099e+03  1.33291970e+03  1.33291970e+03  1.33291970e+03
  3.01737251e+03  3.01737251e+03  3.01737251e+03  3.39334186e+03
  6.63096707e+03  6.63096707e+03  6.63096707e+03  9.81478444e+03
  2.61404873e+04  7.68343969e+04]
E1 = -728.309476698766  E_coul = 201.55206043622755
Extra cycle  E= -526.757416262539  delta_E= -6.82e-13  |g|= 3.75e-07  |ddm|= 3.15e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
exp = [2.61829011e+04 7.61693756e+03 3.61755867e+03 1.58464236e+03
 4.28648548e+02 1.89595804e+02 9.42703961e+01 3.46365544e+01
 7.93240031e+00 6.58715003e-01 3.14227840e+00 2.38257118e-01
 1.36286426e+03 6.63963788e+02 2.97280639e+02 3.10869865e+02
 6.31710905e+01 7.52606701e+00 2.07978339e+01 7.82287198e-01
 2.87001848e+00 2.24097265e-01]
E = -526.7574162625385
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:11 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.9011259        1
[INPUT] 0    0    [1    /1   ]  7616.9375562         1
[INPUT] 0    0    [1    /1   ]  3617.55867269        1
[INPUT] 0    0    [1    /1   ]  1584.64235988        1
[INPUT] 0    0    [1    /1   ]  428.648548105        1
[INPUT] 0    0    [1    /1   ]  189.595803659        1
[INPUT] 0    0    [1    /1   ]  94.2703961201        1
[INPUT] 0    0    [1    /1   ]  34.6365544345        1
[INPUT] 0    0    [1    /1   ]  7.93240031307        1
[INPUT] 0    0    [1    /1   ]  0.658715003262       1
[INPUT] 0    0    [1    /1   ]  3.1422784045         1
[INPUT] 0    0    [1    /1   ]  0.238257118365       1
[INPUT] 1    0    [1    /1   ]  1362.86426177        1
[INPUT] 1    0    [1    /1   ]  663.963788183        1
[INPUT] 1    0    [1    /1   ]  297.280639149        1
[INPUT] 1    0    [1    /1   ]  310.86986479         1
[INPUT] 1    0    [1    /1   ]  63.1710905488        1
[INPUT] 1    0    [1    /1   ]  7.52606700906        1
[INPUT] 1    0    [1    /1   ]  20.7978339145        1
[INPUT] 1    0    [1    /1   ]  0.782287197782       1
[INPUT] 1    0    [1    /1   ]  2.87001847728        1
[INPUT] 1    0    [1    /1   ]  0.224097265084       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.90112590513, 1.0]], [0, [7616.937556202541, 1.0]], [0, [3617.5586726891424, 1.0]], [0, [1584.6423598774606, 1.0]], [0, [428.6485481045493, 1.0]], [0, [189.59580365916258, 1.0]], [0, [94.27039612011336, 1.0]], [0, [34.636554434500596, 1.0]], [0, [7.932400313073337, 1.0]], [0, [0.6587150032619103, 1.0]], [0, [3.142278404498615, 1.0]], [0, [0.2382571183646568, 1.0]], [1, [1362.8642617670973, 1.0]], [1, [663.9637881832764, 1.0]], [1, [297.2806391494378, 1.0]], [1, [310.86986478955635, 1.0]], [1, [63.17109054883197, 1.0]], [1, [7.526067009062039, 1.0]], [1, [20.797833914530216, 1.0]], [1, [0.7822871977821966, 1.0]], [1, [2.8700184772785953, 1.0]], [1, [0.22409726508409028, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.90112591]
bas 1, expnt(s) = [7616.9375562]
bas 2, expnt(s) = [3617.55867269]
bas 3, expnt(s) = [1584.64235988]
bas 4, expnt(s) = [428.6485481]
bas 5, expnt(s) = [189.59580366]
bas 6, expnt(s) = [94.27039612]
bas 7, expnt(s) = [34.63655443]
bas 8, expnt(s) = [7.93240031]
bas 9, expnt(s) = [0.658715]
bas 10, expnt(s) = [3.1422784]
bas 11, expnt(s) = [0.23825712]
bas 12, expnt(s) = [1362.86426177]
bas 13, expnt(s) = [663.96378818]
bas 14, expnt(s) = [297.28063915]
bas 15, expnt(s) = [310.86986479]
bas 16, expnt(s) = [63.17109055]
bas 17, expnt(s) = [7.52606701]
bas 18, expnt(s) = [20.79783391]
bas 19, expnt(s) = [0.7822872]
bas 20, expnt(s) = [2.87001848]
bas 21, expnt(s) = [0.22409727]
CPU time:       588.24
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61829011e+04 5.20029940e+03 7.61693756e+03 2.05991984e+03
 3.61755867e+03 1.17849220e+03 1.58464236e+03 6.34546525e+02
 4.28648548e+02 2.38007719e+02 1.89595804e+02 1.29088206e+02
 9.42703961e+01 7.64357486e+01 3.46365544e+01 3.60716523e+01
 7.93240031e+00 1.19417642e+01 6.58715003e-01 1.84730323e+00
 3.14227840e+00 5.96277634e+00 2.38257118e-01 8.61587596e-01
 1.36286426e+03 2.41573976e+04 6.63963788e+02 9.83252106e+03
 2.97280639e+02 3.60116214e+03 3.10869865e+02 3.80809411e+03
 6.31710905e+01 5.19555995e+02 7.52606701e+00 3.63659128e+01
 2.07978339e+01 1.29570766e+02 7.82287198e-01 2.14630863e+00
 2.87001848e+00 1.08978358e+01 2.24097265e-01 4.49811017e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993439246636584
cond(S) = 108344.0700038629
E1 = -729.5483250747999  E_coul = 203.17821747398722
init E= -526.370107600813
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555684777263894  LUMO = 0.989826887998168
  mo_energy =
[-1.18336417e+02 -1.22060483e+01 -9.44697385e+00 -9.44697385e+00
 -9.44697385e+00 -1.24014684e+00 -5.55684777e-01 -5.55684777e-01
 -5.55684777e-01  9.89826888e-01  1.04425555e+00  1.04425555e+00
  1.04425555e+00  7.53661114e+00  7.53661114e+00  7.53661114e+00
  1.20523980e+01  3.45831408e+01  3.45831408e+01  3.45831408e+01
  9.24667535e+01  1.32940924e+02  1.32940924e+02  1.32940924e+02
  3.84836659e+02  4.87982333e+02  4.87982333e+02  4.87982333e+02
  1.14187048e+03  1.33322102e+03  1.33322102e+03  1.33322102e+03
  3.01773762e+03  3.01773762e+03  3.01773762e+03  3.39377192e+03
  6.63144346e+03  6.63144346e+03  6.63144346e+03  9.81532978e+03
  2.61411288e+04  7.68351296e+04]
E1 = -727.8640826313979  E_coul = 201.1074460568856
cycle= 1 E= -526.756636574512  delta_E= -0.387  |g|= 0.186  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.586124
diis-c [-0.34354173  1.        ]
  HOMO = -0.590521499231775  LUMO = 0.962220833686678
  mo_energy =
[-1.18644004e+02 -1.23437056e+01 -9.59546035e+00 -9.59546035e+00
 -9.59546035e+00 -1.27943548e+00 -5.90521499e-01 -5.90521499e-01
 -5.90521499e-01  9.62220834e-01  1.01968181e+00  1.01968181e+00
  1.01968181e+00  7.44448221e+00  7.44448221e+00  7.44448221e+00
  1.19451542e+01  3.44272771e+01  3.44272771e+01  3.44272771e+01
  9.22627523e+01  1.32711263e+02  1.32711263e+02  1.32711263e+02
  3.84552474e+02  4.87676795e+02  4.87676795e+02  4.87676795e+02
  1.14150086e+03  1.33285935e+03  1.33285935e+03  1.33285935e+03
  3.01731029e+03  3.01731029e+03  3.01731029e+03  3.39327890e+03
  6.63090350e+03  6.63090350e+03  6.63090350e+03  9.81472034e+03
  2.61404228e+04  7.68343322e+04]
E1 = -728.4367152757809  E_coul = 201.6793595484485
cycle= 2 E= -526.757355727332  delta_E= -0.000719  |g|= 0.0376  |ddm|= 0.0533
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076554
diis-c [-0.00385647  0.07133065  0.92866935]
  HOMO = -0.581328892187177  LUMO = 0.970285274088299
  mo_energy =
[-1.18575609e+02 -1.23052931e+01 -9.55537543e+00 -9.55537543e+00
 -9.55537543e+00 -1.26842405e+00 -5.81328892e-01 -5.81328892e-01
 -5.81328892e-01  9.70285274e-01  1.02655407e+00  1.02655407e+00
  1.02655407e+00  7.46880913e+00  7.46880913e+00  7.46880913e+00
  1.19748356e+01  3.44681561e+01  3.44681561e+01  3.44681561e+01
  9.23160824e+01  1.32767968e+02  1.32767968e+02  1.32767968e+02
  3.84617966e+02  4.87744316e+02  4.87744316e+02  4.87744316e+02
  1.14157224e+03  1.33293096e+03  1.33293096e+03  1.33293096e+03
  3.01738419e+03  3.01738419e+03  3.01738419e+03  3.39335379e+03
  6.63097918e+03  6.63097918e+03  6.63097918e+03  9.81479676e+03
  2.61404998e+04  7.68344096e+04]
E1 = -728.2851531212211  E_coul = 201.52773907724512
cycle= 3 E= -526.757414043976  delta_E= -5.83e-05  |g|= 0.00679  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0143964
diis-c [-7.44779135e-07 -1.20818256e-03  1.54217262e-01  8.46990920e-01]
  HOMO = -0.582931264183382  LUMO = 0.968979397116243
  mo_energy =
[-1.18586361e+02 -1.23115386e+01 -9.56198885e+00 -9.56198885e+00
 -9.56198885e+00 -1.27023450e+00 -5.82931264e-01 -5.82931264e-01
 -5.82931264e-01  9.68979397e-01  1.02538150e+00  1.02538150e+00
  1.02538150e+00  7.46470149e+00  7.46470149e+00  7.46470149e+00
  1.19699749e+01  3.44614569e+01  3.44614569e+01  3.44614569e+01
  9.23075902e+01  1.32758931e+02  1.32758931e+02  1.32758931e+02
  3.84607651e+02  4.87733697e+02  4.87733697e+02  4.87733697e+02
  1.14156099e+03  1.33291970e+03  1.33291970e+03  1.33291970e+03
  3.01737252e+03  3.01737252e+03  3.01737252e+03  3.39334187e+03
  6.63096709e+03  6.63096709e+03  6.63096709e+03  9.81478447e+03
  2.61404873e+04  7.68343969e+04]
E1 = -728.3096251137091  E_coul = 201.55220885317013
cycle= 4 E= -526.757416260539  delta_E= -2.22e-06  |g|= 0.000103  |ddm|= 0.00242
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000113256
diis-c [-4.49035277e-09  7.89601662e-05 -1.16850196e-02 -6.87753022e-02
  1.08038136e+00]
  HOMO = -0.582912810115558  LUMO = 0.969014093144543
  mo_energy =
[-1.18586315e+02 -1.23114712e+01 -9.56193530e+00 -9.56193530e+00
 -9.56193530e+00 -1.27019199e+00 -5.82912810e-01 -5.82912810e-01
 -5.82912810e-01  9.69014093e-01  1.02539777e+00  1.02539777e+00
  1.02539777e+00  7.46474461e+00  7.46474461e+00  7.46474461e+00
  1.19700361e+01  3.44615087e+01  3.44615087e+01  3.44615087e+01
  9.23076479e+01  1.32758983e+02  1.32758983e+02  1.32758983e+02
  3.84607699e+02  4.87733743e+02  4.87733743e+02  4.87733743e+02
  1.14156103e+03  1.33291974e+03  1.33291974e+03  1.33291974e+03
  3.01737254e+03  3.01737254e+03  3.01737254e+03  3.39334189e+03
  6.63096710e+03  6.63096710e+03  6.63096710e+03  9.81478447e+03
  2.61404873e+04  7.68343969e+04]
E1 = -728.3093971662719  E_coul = 201.5519809037959
cycle= 5 E= -526.757416262476  delta_E= -1.94e-09  |g|= 2.09e-05  |ddm|= 0.000168
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.93514e-05
diis-c [-8.53715578e-11  1.26664527e-05 -1.85913799e-03 -1.28234076e-02
  3.26081788e-02  9.82061700e-01]
  HOMO = -0.582920400401793  LUMO = 0.969010263580331
  mo_energy =
[-1.18586346e+02 -1.23114941e+01 -9.56196012e+00 -9.56196012e+00
 -9.56196012e+00 -1.27019792e+00 -5.82920400e-01 -5.82920400e-01
 -5.82920400e-01  9.69010264e-01  1.02539268e+00  1.02539268e+00
  1.02539268e+00  7.46472755e+00  7.46472755e+00  7.46472755e+00
  1.19700180e+01  3.44614845e+01  3.44614845e+01  3.44614845e+01
  9.23076207e+01  1.32758954e+02  1.32758954e+02  1.32758954e+02
  3.84607668e+02  4.87733713e+02  4.87733713e+02  4.87733713e+02
  1.14156099e+03  1.33291970e+03  1.33291970e+03  1.33291970e+03
  3.01737251e+03  3.01737251e+03  3.01737251e+03  3.39334186e+03
  6.63096707e+03  6.63096707e+03  6.63096707e+03  9.81478444e+03
  2.61404873e+04  7.68343969e+04]
E1 = -728.3094789463885  E_coul = 201.55206268385064
cycle= 6 E= -526.757416262538  delta_E= -6.18e-11  |g|= 1.81e-06  |ddm|= 1.96e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.3094789463885  E_coul = 201.55206268385064
  HOMO = -0.582920329137432  LUMO = 0.969010678455741
  mo_energy =
[-1.18586346e+02 -1.23114936e+01 -9.56195973e+00 -9.56195973e+00
 -9.56195973e+00 -1.27019743e+00 -5.82920329e-01 -5.82920329e-01
 -5.82920329e-01  9.69010678e-01  1.02539279e+00  1.02539279e+00
  1.02539279e+00  7.46472783e+00  7.46472783e+00  7.46472783e+00
  1.19700184e+01  3.44614849e+01  3.44614849e+01  3.44614849e+01
  9.23076212e+01  1.32758955e+02  1.32758955e+02  1.32758955e+02
  3.84607669e+02  4.87733713e+02  4.87733713e+02  4.87733713e+02
  1.14156099e+03  1.33291970e+03  1.33291970e+03  1.33291970e+03
  3.01737251e+03  3.01737251e+03  3.01737251e+03  3.39334186e+03
  6.63096707e+03  6.63096707e+03  6.63096707e+03  9.81478444e+03
  2.61404873e+04  7.68343969e+04]
E1 = -728.309476698766  E_coul = 201.55206043622755
Extra cycle  E= -526.757416262539  delta_E= -6.82e-13  |g|= 3.75e-07  |ddm|= 3.15e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 108344.0700038629
E1 = -728.309476698766  E_coul = 201.55206043622755
init E= -526.757416262539
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.582920386591695  LUMO = 0.969010702941239
  mo_energy =
[-1.18586346e+02 -1.23114938e+01 -9.56195992e+00 -9.56195992e+00
 -9.56195992e+00 -1.27019742e+00 -5.82920387e-01 -5.82920387e-01
 -5.82920387e-01  9.69010703e-01  1.02539276e+00  1.02539276e+00
  1.02539276e+00  7.46472771e+00  7.46472771e+00  7.46472771e+00
  1.19700183e+01  3.44614847e+01  3.44614847e+01  3.44614847e+01
  9.23076210e+01  1.32758955e+02  1.32758955e+02  1.32758955e+02
  3.84607669e+02  4.87733713e+02  4.87733713e+02  4.87733713e+02
  1.14156099e+03  1.33291970e+03  1.33291970e+03  1.33291970e+03
  3.01737251e+03  3.01737251e+03  3.01737251e+03  3.39334186e+03
  6.63096707e+03  6.63096707e+03  6.63096707e+03  9.81478444e+03
  2.61404873e+04  7.68343969e+04]
E1 = -728.3094771975957  E_coul = 201.55206093505703
cycle= 1 E= -526.757416262539  delta_E= -1.14e-13  |g|= 8.34e-08  |ddm|= 5.93e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.3094771975957  E_coul = 201.55206093505703
  HOMO = -0.58292037994414  LUMO = 0.969010723519816
  mo_energy =
[-1.18586346e+02 -1.23114937e+01 -9.56195989e+00 -9.56195989e+00
 -9.56195989e+00 -1.27019739e+00 -5.82920380e-01 -5.82920380e-01
 -5.82920380e-01  9.69010724e-01  1.02539277e+00  1.02539277e+00
  1.02539277e+00  7.46472773e+00  7.46472773e+00  7.46472773e+00
  1.19700184e+01  3.44614848e+01  3.44614848e+01  3.44614848e+01
  9.23076211e+01  1.32758955e+02  1.32758955e+02  1.32758955e+02
  3.84607669e+02  4.87733713e+02  4.87733713e+02  4.87733713e+02
  1.14156099e+03  1.33291970e+03  1.33291970e+03  1.33291970e+03
  3.01737251e+03  3.01737251e+03  3.01737251e+03  3.39334186e+03
  6.63096707e+03  6.63096707e+03  6.63096707e+03  9.81478444e+03
  2.61404873e+04  7.68343969e+04]
E1 = -728.3094770304103  E_coul = 201.55206076787098
Extra cycle  E= -526.757416262539  delta_E= -6.82e-13  |g|= 1.75e-08  |ddm|= 1.33e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.43 sec
exp = [2.61829011e+04 7.61693756e+03 3.61755867e+03 1.58464236e+03
 4.28648548e+02 1.89595804e+02 9.42703961e+01 3.46365544e+01
 7.93240031e+00 6.58715003e-01 3.14227840e+00 2.38257118e-01
 1.36286426e+03 6.63963788e+02 2.97280639e+02 3.10869865e+02
 6.31710905e+01 7.52606701e+00 2.07978339e+01 7.82287198e-01
 2.87001848e+00 2.24097265e-01]
grad_E = [-1.45801888e-06  2.69531333e-06 -2.18432927e-06  5.61333678e-05
 -2.48677212e-04  7.57141381e-05  2.12252811e-04 -2.90350800e-04
 -2.88753839e-04  1.82935346e-03  8.43854073e-04 -5.04133815e-03
 -6.01702341e-07  3.89570056e-06  1.76744325e-05  1.50483933e-05
  9.99311197e-05  1.08459183e-03 -1.93218422e-04 -1.29356483e-03
 -1.48675462e-03  3.68384807e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:15 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.9126205        1
[INPUT] 0    0    [1    /1   ]  7616.9100449         1
[INPUT] 0    0    [1    /1   ]  3617.56828728        1
[INPUT] 0    0    [1    /1   ]  1584.01935026        1
[INPUT] 0    0    [1    /1   ]  430.899388681        1
[INPUT] 0    0    [1    /1   ]  193.685004471        1
[INPUT] 0    0    [1    /1   ]  95.125286928         1
[INPUT] 0    0    [1    /1   ]  34.7227565141        1
[INPUT] 0    0    [1    /1   ]  7.94944421665        1
[INPUT] 0    0    [1    /1   ]  0.660801066776       1
[INPUT] 0    0    [1    /1   ]  3.14654085034        1
[INPUT] 0    0    [1    /1   ]  0.237753632828       1
[INPUT] 1    0    [1    /1   ]  1362.86806053        1
[INPUT] 1    0    [1    /1   ]  663.927235015        1
[INPUT] 1    0    [1    /1   ]  297.108558424        1
[INPUT] 1    0    [1    /1   ]  310.721585184        1
[INPUT] 1    0    [1    /1   ]  63.2439621472        1
[INPUT] 1    0    [1    /1   ]  7.53400170709        1
[INPUT] 1    0    [1    /1   ]  20.80732656          1
[INPUT] 1    0    [1    /1   ]  0.782144696742       1
[INPUT] 1    0    [1    /1   ]  2.86738425223        1
[INPUT] 1    0    [1    /1   ]  0.224069526807       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.912620493833, 1.0]], [0, [7616.910044896431, 1.0]], [0, [3617.5682872770285, 1.0]], [0, [1584.019350255209, 1.0]], [0, [430.8993886812723, 1.0]], [0, [193.68500447104296, 1.0]], [0, [95.12528692802553, 1.0]], [0, [34.722756514149715, 1.0]], [0, [7.94944421664813, 1.0]], [0, [0.6608010667760543, 1.0]], [0, [3.146540850338606, 1.0]], [0, [0.2377536328278643, 1.0]], [1, [1362.8680605347172, 1.0]], [1, [663.9272350153128, 1.0]], [1, [297.10855842374673, 1.0]], [1, [310.7215851839371, 1.0]], [1, [63.243962147211015, 1.0]], [1, [7.534001707090272, 1.0]], [1, [20.807326560038938, 1.0]], [1, [0.7821446967419615, 1.0]], [1, [2.8673842522325086, 1.0]], [1, [0.22406952680743095, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.91262049]
bas 1, expnt(s) = [7616.9100449]
bas 2, expnt(s) = [3617.56828728]
bas 3, expnt(s) = [1584.01935026]
bas 4, expnt(s) = [430.89938868]
bas 5, expnt(s) = [193.68500447]
bas 6, expnt(s) = [95.12528693]
bas 7, expnt(s) = [34.72275651]
bas 8, expnt(s) = [7.94944422]
bas 9, expnt(s) = [0.66080107]
bas 10, expnt(s) = [3.14654085]
bas 11, expnt(s) = [0.23775363]
bas 12, expnt(s) = [1362.86806053]
bas 13, expnt(s) = [663.92723502]
bas 14, expnt(s) = [297.10855842]
bas 15, expnt(s) = [310.72158518]
bas 16, expnt(s) = [63.24396215]
bas 17, expnt(s) = [7.53400171]
bas 18, expnt(s) = [20.80732656]
bas 19, expnt(s) = [0.7821447]
bas 20, expnt(s) = [2.86738425]
bas 21, expnt(s) = [0.22406953]
CPU time:       593.91
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61829126e+04 5.20030112e+03 7.61691004e+03 2.05991426e+03
 3.61756829e+03 1.17849455e+03 1.58401935e+03 6.34359410e+02
 4.30899389e+02 2.38944442e+02 1.93685004e+02 1.31170756e+02
 9.51252869e+01 7.69550295e+01 3.47227565e+01 3.61389617e+01
 7.94944422e+00 1.19610030e+01 6.60801067e-01 1.85168912e+00
 3.14654085e+00 5.96884162e+00 2.37753633e-01 8.60221703e-01
 1.36286806e+03 2.41574817e+04 6.63927235e+02 9.83184443e+03
 2.97108558e+02 3.59855666e+03 3.10721585e+02 3.80582375e+03
 6.32439621e+01 5.20305276e+02 7.53400171e+00 3.64138447e+01
 2.08073266e+01 1.29644694e+02 7.82144697e-01 2.14581993e+00
 2.86738425e+00 1.08853341e+01 2.24069527e-01 4.49741422e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993435995730614
cond(S) = 107928.9239736665
E1 = -729.5491225865997  E_coul = 203.17903621920394
init E= -526.370086367396
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555670444418544  LUMO = 0.99079448425877
  mo_energy =
[-1.18336430e+02 -1.22059519e+01 -9.44690125e+00 -9.44690125e+00
 -9.44690125e+00 -1.24012584e+00 -5.55670444e-01 -5.55670444e-01
 -5.55670444e-01  9.90794484e-01  1.04396070e+00  1.04396070e+00
  1.04396070e+00  7.53401043e+00  7.53401043e+00  7.53401043e+00
  1.20937571e+01  3.45980447e+01  3.45980447e+01  3.45980447e+01
  9.31042970e+01  1.33049387e+02  1.33049387e+02  1.33049387e+02
  3.89285018e+02  4.88115346e+02  4.88115346e+02  4.88115346e+02
  1.15553280e+03  1.33304910e+03  1.33304910e+03  1.33304910e+03
  3.01711220e+03  3.01711220e+03  3.01711220e+03  3.41657936e+03
  6.63050432e+03  6.63050432e+03  6.63050432e+03  9.84037632e+03
  2.61655471e+04  7.68580037e+04]
E1 = -727.8621059351724  E_coul = 201.10538562628415
cycle= 1 E= -526.756720308888  delta_E= -0.387  |g|= 0.186  |ddm|= 0.313
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.585628
diis-c [-0.3429601  1.       ]
  HOMO = -0.5906051538071  LUMO = 0.963083037718993
  mo_energy =
[-1.18644223e+02 -1.23438332e+01 -9.59559765e+00 -9.59559765e+00
 -9.59559765e+00 -1.27949951e+00 -5.90605154e-01 -5.90605154e-01
 -5.90605154e-01  9.63083038e-01  1.01933451e+00  1.01933451e+00
  1.01933451e+00  7.44168155e+00  7.44168155e+00  7.44168155e+00
  1.19860718e+01  3.44419268e+01  3.44419268e+01  3.44419268e+01
  9.28995192e+01  1.32819460e+02  1.32819460e+02  1.32819460e+02
  3.88999517e+02  4.87809626e+02  4.87809626e+02  4.87809626e+02
  1.15516200e+03  1.33268725e+03  1.33268725e+03  1.33268725e+03
  3.01668469e+03  3.01668469e+03  3.01668469e+03  3.41608603e+03
  6.62996418e+03  6.62996418e+03  6.62996418e+03  9.83976684e+03
  2.61648410e+04  7.68572062e+04]
E1 = -728.4353909450066  E_coul = 201.67794997154976
cycle= 2 E= -526.757440973457  delta_E= -0.000721  |g|= 0.0376  |ddm|= 0.0532
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.076588
diis-c [-0.00385414  0.07151163  0.92848837]
  HOMO = -0.581400497202561  LUMO = 0.971175731297963
  mo_energy =
[-1.18575786e+02 -1.23053829e+01 -9.55547419e+00 -9.55547419e+00
 -9.55547419e+00 -1.26846875e+00 -5.81400497e-01 -5.81400497e-01
 -5.81400497e-01  9.71175731e-01  1.02621408e+00  1.02621408e+00
  1.02621408e+00  7.46603513e+00  7.46603513e+00  7.46603513e+00
  1.20158320e+01  3.44828541e+01  3.44828541e+01  3.44828541e+01
  9.29530058e+01  1.32876215e+02  1.32876215e+02  1.32876215e+02
  3.89065169e+02  4.87877186e+02  4.87877186e+02  4.87877186e+02
  1.15523347e+03  1.33275890e+03  1.33275890e+03  1.33275890e+03
  3.01675863e+03  3.01675863e+03  3.01675863e+03  3.41616097e+03
  6.63003990e+03  6.63003990e+03  6.63003990e+03  9.83984330e+03
  2.61649181e+04  7.68572836e+04]
E1 = -728.2836191565734  E_coul = 201.52611969354732
cycle= 3 E= -526.757499463026  delta_E= -5.85e-05  |g|= 0.0068  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0143986
diis-c [-7.53885725e-07 -1.20829876e-03  1.54173744e-01  8.47034555e-01]
  HOMO = -0.583004228974556  LUMO = 0.969868033936818
  mo_energy =
[-1.18586540e+02 -1.23116308e+01 -9.56209041e+00 -9.56209041e+00
 -9.56209041e+00 -1.27027887e+00 -5.83004229e-01 -5.83004229e-01
 -5.83004229e-01  9.69868034e-01  1.02504118e+00  1.02504118e+00
  1.02504118e+00  7.46192537e+00  7.46192537e+00  7.46192537e+00
  1.20109614e+01  3.44761504e+01  3.44761504e+01  3.44761504e+01
  9.29444938e+01  1.32867174e+02  1.32867174e+02  1.32867174e+02
  3.89054834e+02  4.87866565e+02  4.87866565e+02  4.87866565e+02
  1.15522221e+03  1.33274764e+03  1.33274764e+03  1.33274764e+03
  3.01674695e+03  3.01674695e+03  3.01674695e+03  3.41614905e+03
  6.63002781e+03  6.63002781e+03  6.63002781e+03  9.83983101e+03
  2.61649056e+04  7.68572710e+04]
E1 = -728.308104690721  E_coul = 201.55060300737998
cycle= 4 E= -526.757501683341  delta_E= -2.22e-06  |g|= 0.000105  |ddm|= 0.00242
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000115384
diis-c [-4.56251915e-09  8.04793365e-05 -1.19070811e-02 -7.01383842e-02
  1.08196499e+00]
  HOMO = -0.582986090222186  LUMO = 0.969903038039529
  mo_energy =
[-1.18586495e+02 -1.23115641e+01 -9.56203769e+00 -9.56203769e+00
 -9.56203769e+00 -1.27023612e+00 -5.82986090e-01 -5.82986090e-01
 -5.82986090e-01  9.69903038e-01  1.02505730e+00  1.02505730e+00
  1.02505730e+00  7.46196791e+00  7.46196791e+00  7.46196791e+00
  1.20110222e+01  3.44762015e+01  3.44762015e+01  3.44762015e+01
  9.29445506e+01  1.32867225e+02  1.32867225e+02  1.32867225e+02
  3.89054880e+02  4.87866610e+02  4.87866610e+02  4.87866610e+02
  1.15522224e+03  1.33274768e+03  1.33274768e+03  1.33274768e+03
  3.01674698e+03  3.01674698e+03  3.01674698e+03  3.41614906e+03
  6.63002782e+03  6.63002782e+03  6.63002782e+03  9.83983101e+03
  2.61649056e+04  7.68572710e+04]
E1 = -728.3078782706556  E_coul = 201.55037658527579
cycle= 5 E= -526.75750168538  delta_E= -2.04e-09  |g|= 2.11e-05  |ddm|= 0.000172
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.95476e-05
diis-c [-8.75994548e-11  1.27025280e-05 -1.86093079e-03 -1.28446649e-02
  3.02762285e-02  9.84416665e-01]
  HOMO = -0.582993737865662  LUMO = 0.969899212389108
  mo_energy =
[-1.18586526e+02 -1.23115871e+01 -9.56206267e+00 -9.56206267e+00
 -9.56206267e+00 -1.27024205e+00 -5.82993738e-01 -5.82993738e-01
 -5.82993738e-01  9.69899212e-01  1.02505218e+00  1.02505218e+00
  1.02505218e+00  7.46195074e+00  7.46195074e+00  7.46195074e+00
  1.20110039e+01  3.44761771e+01  3.44761771e+01  3.44761771e+01
  9.29445232e+01  1.32867197e+02  1.32867197e+02  1.32867197e+02
  3.89054850e+02  4.87866579e+02  4.87866579e+02  4.87866579e+02
  1.15522221e+03  1.33274764e+03  1.33274764e+03  1.33274764e+03
  3.01674694e+03  3.01674694e+03  3.01674694e+03  3.41614903e+03
  6.63002779e+03  6.63002779e+03  6.63002779e+03  9.83983098e+03
  2.61649056e+04  7.68572709e+04]
E1 = -728.3079605437763  E_coul = 201.5504588583343
cycle= 6 E= -526.757501685442  delta_E= -6.22e-11  |g|= 1.81e-06  |ddm|= 2e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3079605437763  E_coul = 201.5504588583343
  HOMO = -0.582993644707288  LUMO = 0.969899644466156
  mo_energy =
[-1.18586526e+02 -1.23115865e+01 -9.56206221e+00 -9.56206221e+00
 -9.56206221e+00 -1.27024154e+00 -5.82993645e-01 -5.82993645e-01
 -5.82993645e-01  9.69899644e-01  1.02505230e+00  1.02505230e+00
  1.02505230e+00  7.46195107e+00  7.46195107e+00  7.46195107e+00
  1.20110044e+01  3.44761776e+01  3.44761776e+01  3.44761776e+01
  9.29445238e+01  1.32867197e+02  1.32867197e+02  1.32867197e+02
  3.89054851e+02  4.87866580e+02  4.87866580e+02  4.87866580e+02
  1.15522221e+03  1.33274764e+03  1.33274764e+03  1.33274764e+03
  3.01674694e+03  3.01674694e+03  3.01674694e+03  3.41614903e+03
  6.63002779e+03  6.63002779e+03  6.63002779e+03  9.83983098e+03
  2.61649056e+04  7.68572709e+04]
E1 = -728.307958035824  E_coul = 201.5504563503822
Extra cycle  E= -526.757501685442  delta_E= 2.27e-13  |g|= 3.77e-07  |ddm|= 3.14e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
exp = [2.61829126e+04 7.61691004e+03 3.61756829e+03 1.58401935e+03
 4.30899389e+02 1.93685004e+02 9.51252869e+01 3.47227565e+01
 7.94944422e+00 6.60801067e-01 3.14654085e+00 2.37753633e-01
 1.36286806e+03 6.63927235e+02 2.97108558e+02 3.10721585e+02
 6.32439621e+01 7.53400171e+00 2.08073266e+01 7.82144697e-01
 2.86738425e+00 2.24069527e-01]
E = -526.7575016854418
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:16 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.9126205        1
[INPUT] 0    0    [1    /1   ]  7616.9100449         1
[INPUT] 0    0    [1    /1   ]  3617.56828728        1
[INPUT] 0    0    [1    /1   ]  1584.01935026        1
[INPUT] 0    0    [1    /1   ]  430.899388681        1
[INPUT] 0    0    [1    /1   ]  193.685004471        1
[INPUT] 0    0    [1    /1   ]  95.125286928         1
[INPUT] 0    0    [1    /1   ]  34.7227565141        1
[INPUT] 0    0    [1    /1   ]  7.94944421665        1
[INPUT] 0    0    [1    /1   ]  0.660801066776       1
[INPUT] 0    0    [1    /1   ]  3.14654085034        1
[INPUT] 0    0    [1    /1   ]  0.237753632828       1
[INPUT] 1    0    [1    /1   ]  1362.86806053        1
[INPUT] 1    0    [1    /1   ]  663.927235015        1
[INPUT] 1    0    [1    /1   ]  297.108558424        1
[INPUT] 1    0    [1    /1   ]  310.721585184        1
[INPUT] 1    0    [1    /1   ]  63.2439621472        1
[INPUT] 1    0    [1    /1   ]  7.53400170709        1
[INPUT] 1    0    [1    /1   ]  20.80732656          1
[INPUT] 1    0    [1    /1   ]  0.782144696742       1
[INPUT] 1    0    [1    /1   ]  2.86738425223        1
[INPUT] 1    0    [1    /1   ]  0.224069526807       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.912620493833, 1.0]], [0, [7616.910044896431, 1.0]], [0, [3617.5682872770285, 1.0]], [0, [1584.019350255209, 1.0]], [0, [430.8993886812723, 1.0]], [0, [193.68500447104296, 1.0]], [0, [95.12528692802553, 1.0]], [0, [34.722756514149715, 1.0]], [0, [7.94944421664813, 1.0]], [0, [0.6608010667760543, 1.0]], [0, [3.146540850338606, 1.0]], [0, [0.2377536328278643, 1.0]], [1, [1362.8680605347172, 1.0]], [1, [663.9272350153128, 1.0]], [1, [297.10855842374673, 1.0]], [1, [310.7215851839371, 1.0]], [1, [63.243962147211015, 1.0]], [1, [7.534001707090272, 1.0]], [1, [20.807326560038938, 1.0]], [1, [0.7821446967419615, 1.0]], [1, [2.8673842522325086, 1.0]], [1, [0.22406952680743095, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.91262049]
bas 1, expnt(s) = [7616.9100449]
bas 2, expnt(s) = [3617.56828728]
bas 3, expnt(s) = [1584.01935026]
bas 4, expnt(s) = [430.89938868]
bas 5, expnt(s) = [193.68500447]
bas 6, expnt(s) = [95.12528693]
bas 7, expnt(s) = [34.72275651]
bas 8, expnt(s) = [7.94944422]
bas 9, expnt(s) = [0.66080107]
bas 10, expnt(s) = [3.14654085]
bas 11, expnt(s) = [0.23775363]
bas 12, expnt(s) = [1362.86806053]
bas 13, expnt(s) = [663.92723502]
bas 14, expnt(s) = [297.10855842]
bas 15, expnt(s) = [310.72158518]
bas 16, expnt(s) = [63.24396215]
bas 17, expnt(s) = [7.53400171]
bas 18, expnt(s) = [20.80732656]
bas 19, expnt(s) = [0.7821447]
bas 20, expnt(s) = [2.86738425]
bas 21, expnt(s) = [0.22406953]
CPU time:       594.46
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61829126e+04 5.20030112e+03 7.61691004e+03 2.05991426e+03
 3.61756829e+03 1.17849455e+03 1.58401935e+03 6.34359410e+02
 4.30899389e+02 2.38944442e+02 1.93685004e+02 1.31170756e+02
 9.51252869e+01 7.69550295e+01 3.47227565e+01 3.61389617e+01
 7.94944422e+00 1.19610030e+01 6.60801067e-01 1.85168912e+00
 3.14654085e+00 5.96884162e+00 2.37753633e-01 8.60221703e-01
 1.36286806e+03 2.41574817e+04 6.63927235e+02 9.83184443e+03
 2.97108558e+02 3.59855666e+03 3.10721585e+02 3.80582375e+03
 6.32439621e+01 5.20305276e+02 7.53400171e+00 3.64138447e+01
 2.08073266e+01 1.29644694e+02 7.82144697e-01 2.14581993e+00
 2.86738425e+00 1.08853341e+01 2.24069527e-01 4.49741422e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993435995730614
cond(S) = 107928.9239736665
E1 = -729.5491225865997  E_coul = 203.17903621920394
init E= -526.370086367396
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555670444418544  LUMO = 0.99079448425877
  mo_energy =
[-1.18336430e+02 -1.22059519e+01 -9.44690125e+00 -9.44690125e+00
 -9.44690125e+00 -1.24012584e+00 -5.55670444e-01 -5.55670444e-01
 -5.55670444e-01  9.90794484e-01  1.04396070e+00  1.04396070e+00
  1.04396070e+00  7.53401043e+00  7.53401043e+00  7.53401043e+00
  1.20937571e+01  3.45980447e+01  3.45980447e+01  3.45980447e+01
  9.31042970e+01  1.33049387e+02  1.33049387e+02  1.33049387e+02
  3.89285018e+02  4.88115346e+02  4.88115346e+02  4.88115346e+02
  1.15553280e+03  1.33304910e+03  1.33304910e+03  1.33304910e+03
  3.01711220e+03  3.01711220e+03  3.01711220e+03  3.41657936e+03
  6.63050432e+03  6.63050432e+03  6.63050432e+03  9.84037632e+03
  2.61655471e+04  7.68580037e+04]
E1 = -727.8621059351724  E_coul = 201.10538562628415
cycle= 1 E= -526.756720308888  delta_E= -0.387  |g|= 0.186  |ddm|= 0.313
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.585628
diis-c [-0.3429601  1.       ]
  HOMO = -0.5906051538071  LUMO = 0.963083037718993
  mo_energy =
[-1.18644223e+02 -1.23438332e+01 -9.59559765e+00 -9.59559765e+00
 -9.59559765e+00 -1.27949951e+00 -5.90605154e-01 -5.90605154e-01
 -5.90605154e-01  9.63083038e-01  1.01933451e+00  1.01933451e+00
  1.01933451e+00  7.44168155e+00  7.44168155e+00  7.44168155e+00
  1.19860718e+01  3.44419268e+01  3.44419268e+01  3.44419268e+01
  9.28995192e+01  1.32819460e+02  1.32819460e+02  1.32819460e+02
  3.88999517e+02  4.87809626e+02  4.87809626e+02  4.87809626e+02
  1.15516200e+03  1.33268725e+03  1.33268725e+03  1.33268725e+03
  3.01668469e+03  3.01668469e+03  3.01668469e+03  3.41608603e+03
  6.62996418e+03  6.62996418e+03  6.62996418e+03  9.83976684e+03
  2.61648410e+04  7.68572062e+04]
E1 = -728.4353909450066  E_coul = 201.67794997154976
cycle= 2 E= -526.757440973457  delta_E= -0.000721  |g|= 0.0376  |ddm|= 0.0532
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.076588
diis-c [-0.00385414  0.07151163  0.92848837]
  HOMO = -0.581400497202561  LUMO = 0.971175731297963
  mo_energy =
[-1.18575786e+02 -1.23053829e+01 -9.55547419e+00 -9.55547419e+00
 -9.55547419e+00 -1.26846875e+00 -5.81400497e-01 -5.81400497e-01
 -5.81400497e-01  9.71175731e-01  1.02621408e+00  1.02621408e+00
  1.02621408e+00  7.46603513e+00  7.46603513e+00  7.46603513e+00
  1.20158320e+01  3.44828541e+01  3.44828541e+01  3.44828541e+01
  9.29530058e+01  1.32876215e+02  1.32876215e+02  1.32876215e+02
  3.89065169e+02  4.87877186e+02  4.87877186e+02  4.87877186e+02
  1.15523347e+03  1.33275890e+03  1.33275890e+03  1.33275890e+03
  3.01675863e+03  3.01675863e+03  3.01675863e+03  3.41616097e+03
  6.63003990e+03  6.63003990e+03  6.63003990e+03  9.83984330e+03
  2.61649181e+04  7.68572836e+04]
E1 = -728.2836191565734  E_coul = 201.52611969354732
cycle= 3 E= -526.757499463026  delta_E= -5.85e-05  |g|= 0.0068  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0143986
diis-c [-7.53885725e-07 -1.20829876e-03  1.54173744e-01  8.47034555e-01]
  HOMO = -0.583004228974556  LUMO = 0.969868033936818
  mo_energy =
[-1.18586540e+02 -1.23116308e+01 -9.56209041e+00 -9.56209041e+00
 -9.56209041e+00 -1.27027887e+00 -5.83004229e-01 -5.83004229e-01
 -5.83004229e-01  9.69868034e-01  1.02504118e+00  1.02504118e+00
  1.02504118e+00  7.46192537e+00  7.46192537e+00  7.46192537e+00
  1.20109614e+01  3.44761504e+01  3.44761504e+01  3.44761504e+01
  9.29444938e+01  1.32867174e+02  1.32867174e+02  1.32867174e+02
  3.89054834e+02  4.87866565e+02  4.87866565e+02  4.87866565e+02
  1.15522221e+03  1.33274764e+03  1.33274764e+03  1.33274764e+03
  3.01674695e+03  3.01674695e+03  3.01674695e+03  3.41614905e+03
  6.63002781e+03  6.63002781e+03  6.63002781e+03  9.83983101e+03
  2.61649056e+04  7.68572710e+04]
E1 = -728.308104690721  E_coul = 201.55060300737998
cycle= 4 E= -526.757501683341  delta_E= -2.22e-06  |g|= 0.000105  |ddm|= 0.00242
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000115384
diis-c [-4.56251915e-09  8.04793365e-05 -1.19070811e-02 -7.01383842e-02
  1.08196499e+00]
  HOMO = -0.582986090222186  LUMO = 0.969903038039529
  mo_energy =
[-1.18586495e+02 -1.23115641e+01 -9.56203769e+00 -9.56203769e+00
 -9.56203769e+00 -1.27023612e+00 -5.82986090e-01 -5.82986090e-01
 -5.82986090e-01  9.69903038e-01  1.02505730e+00  1.02505730e+00
  1.02505730e+00  7.46196791e+00  7.46196791e+00  7.46196791e+00
  1.20110222e+01  3.44762015e+01  3.44762015e+01  3.44762015e+01
  9.29445506e+01  1.32867225e+02  1.32867225e+02  1.32867225e+02
  3.89054880e+02  4.87866610e+02  4.87866610e+02  4.87866610e+02
  1.15522224e+03  1.33274768e+03  1.33274768e+03  1.33274768e+03
  3.01674698e+03  3.01674698e+03  3.01674698e+03  3.41614906e+03
  6.63002782e+03  6.63002782e+03  6.63002782e+03  9.83983101e+03
  2.61649056e+04  7.68572710e+04]
E1 = -728.3078782706556  E_coul = 201.55037658527579
cycle= 5 E= -526.75750168538  delta_E= -2.04e-09  |g|= 2.11e-05  |ddm|= 0.000172
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.95476e-05
diis-c [-8.75994548e-11  1.27025280e-05 -1.86093079e-03 -1.28446649e-02
  3.02762285e-02  9.84416665e-01]
  HOMO = -0.582993737865662  LUMO = 0.969899212389108
  mo_energy =
[-1.18586526e+02 -1.23115871e+01 -9.56206267e+00 -9.56206267e+00
 -9.56206267e+00 -1.27024205e+00 -5.82993738e-01 -5.82993738e-01
 -5.82993738e-01  9.69899212e-01  1.02505218e+00  1.02505218e+00
  1.02505218e+00  7.46195074e+00  7.46195074e+00  7.46195074e+00
  1.20110039e+01  3.44761771e+01  3.44761771e+01  3.44761771e+01
  9.29445232e+01  1.32867197e+02  1.32867197e+02  1.32867197e+02
  3.89054850e+02  4.87866579e+02  4.87866579e+02  4.87866579e+02
  1.15522221e+03  1.33274764e+03  1.33274764e+03  1.33274764e+03
  3.01674694e+03  3.01674694e+03  3.01674694e+03  3.41614903e+03
  6.63002779e+03  6.63002779e+03  6.63002779e+03  9.83983098e+03
  2.61649056e+04  7.68572709e+04]
E1 = -728.3079605437763  E_coul = 201.5504588583343
cycle= 6 E= -526.757501685442  delta_E= -6.22e-11  |g|= 1.81e-06  |ddm|= 2e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3079605437763  E_coul = 201.5504588583343
  HOMO = -0.582993644707288  LUMO = 0.969899644466156
  mo_energy =
[-1.18586526e+02 -1.23115865e+01 -9.56206221e+00 -9.56206221e+00
 -9.56206221e+00 -1.27024154e+00 -5.82993645e-01 -5.82993645e-01
 -5.82993645e-01  9.69899644e-01  1.02505230e+00  1.02505230e+00
  1.02505230e+00  7.46195107e+00  7.46195107e+00  7.46195107e+00
  1.20110044e+01  3.44761776e+01  3.44761776e+01  3.44761776e+01
  9.29445238e+01  1.32867197e+02  1.32867197e+02  1.32867197e+02
  3.89054851e+02  4.87866580e+02  4.87866580e+02  4.87866580e+02
  1.15522221e+03  1.33274764e+03  1.33274764e+03  1.33274764e+03
  3.01674694e+03  3.01674694e+03  3.01674694e+03  3.41614903e+03
  6.63002779e+03  6.63002779e+03  6.63002779e+03  9.83983098e+03
  2.61649056e+04  7.68572709e+04]
E1 = -728.307958035824  E_coul = 201.5504563503822
Extra cycle  E= -526.757501685442  delta_E= 2.27e-13  |g|= 3.77e-07  |ddm|= 3.14e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 107928.9239736665
E1 = -728.307958035824  E_coul = 201.5504563503822
init E= -526.757501685442
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.582993707158157  LUMO = 0.96989966433666
  mo_energy =
[-1.18586526e+02 -1.23115867e+01 -9.56206242e+00 -9.56206242e+00
 -9.56206242e+00 -1.27024153e+00 -5.82993707e-01 -5.82993707e-01
 -5.82993707e-01  9.69899664e-01  1.02505227e+00  1.02505227e+00
  1.02505227e+00  7.46195093e+00  7.46195093e+00  7.46195093e+00
  1.20110043e+01  3.44761774e+01  3.44761774e+01  3.44761774e+01
  9.29445236e+01  1.32867197e+02  1.32867197e+02  1.32867197e+02
  3.89054850e+02  4.87866580e+02  4.87866580e+02  4.87866580e+02
  1.15522221e+03  1.33274764e+03  1.33274764e+03  1.33274764e+03
  3.01674694e+03  3.01674694e+03  3.01674694e+03  3.41614903e+03
  6.63002779e+03  6.63002779e+03  6.63002779e+03  9.83983098e+03
  2.61649056e+04  7.68572709e+04]
E1 = -728.3079586094274  E_coul = 201.55045692398494
cycle= 1 E= -526.757501685442  delta_E= -6.82e-13  |g|= 8.5e-08  |ddm|= 5.86e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.3079586094274  E_coul = 201.55045692398494
  HOMO = -0.582993699081696  LUMO = 0.969899686081396
  mo_energy =
[-1.18586526e+02 -1.23115867e+01 -9.56206238e+00 -9.56206238e+00
 -9.56206238e+00 -1.27024151e+00 -5.82993699e-01 -5.82993699e-01
 -5.82993699e-01  9.69899686e-01  1.02505228e+00  1.02505228e+00
  1.02505228e+00  7.46195096e+00  7.46195096e+00  7.46195096e+00
  1.20110043e+01  3.44761774e+01  3.44761774e+01  3.44761774e+01
  9.29445236e+01  1.32867197e+02  1.32867197e+02  1.32867197e+02
  3.89054850e+02  4.87866580e+02  4.87866580e+02  4.87866580e+02
  1.15522221e+03  1.33274764e+03  1.33274764e+03  1.33274764e+03
  3.01674694e+03  3.01674694e+03  3.01674694e+03  3.41614903e+03
  6.63002779e+03  6.63002779e+03  6.63002779e+03  9.83983098e+03
  2.61649056e+04  7.68572709e+04]
E1 = -728.3079584213958  E_coul = 201.55045673595345
Extra cycle  E= -526.757501685442  delta_E= 1.14e-13  |g|= 1.81e-08  |ddm|= 1.33e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.43 sec
exp = [2.61829126e+04 7.61691004e+03 3.61756829e+03 1.58401935e+03
 4.30899389e+02 1.93685004e+02 9.51252869e+01 3.47227565e+01
 7.94944422e+00 6.60801067e-01 3.14654085e+00 2.37753633e-01
 1.36286806e+03 6.63927235e+02 2.97108558e+02 3.10721585e+02
 6.32439621e+01 7.53400171e+00 2.08073266e+01 7.82144697e-01
 2.86738425e+00 2.24069527e-01]
grad_E = [-1.45352552e-06  2.65298810e-06 -2.20496907e-06  5.49136615e-05
 -2.39832456e-04  7.79155183e-05  2.17904948e-04 -3.49575372e-04
 -2.53991225e-04  3.76258532e-03  9.28982087e-04 -1.00018719e-02
 -6.08615441e-07  3.78387923e-06  1.70250923e-05  1.44888543e-05
  1.49753314e-04  2.31265137e-03 -5.60537306e-04 -1.91084785e-03
 -3.05863505e-03  5.10964680e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:20 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.9299049        1
[INPUT] 0    0    [1    /1   ]  7616.86868099        1
[INPUT] 0    0    [1    /1   ]  3617.58275065        1
[INPUT] 0    0    [1    /1   ]  1583.08260934        1
[INPUT] 0    0    [1    /1   ]  434.283480676        1
[INPUT] 0    0    [1    /1   ]  199.919538175        1
[INPUT] 0    0    [1    /1   ]  96.085133904         1
[INPUT] 0    0    [1    /1   ]  34.8055409905        1
[INPUT] 0    0    [1    /1   ]  7.96717033367        1
[INPUT] 0    0    [1    /1   ]  0.662287708915       1
[INPUT] 0    0    [1    /1   ]  3.15020453697        1
[INPUT] 0    0    [1    /1   ]  0.237640065766       1
[INPUT] 1    0    [1    /1   ]  1362.87377248        1
[INPUT] 1    0    [1    /1   ]  663.872257652        1
[INPUT] 1    0    [1    /1   ]  296.849720617        1
[INPUT] 1    0    [1    /1   ]  310.498551498        1
[INPUT] 1    0    [1    /1   ]  63.3635573995        1
[INPUT] 1    0    [1    /1   ]  7.52433924124        1
[INPUT] 1    0    [1    /1   ]  20.7947591366        1
[INPUT] 1    0    [1    /1   ]  0.781497852146       1
[INPUT] 1    0    [1    /1   ]  2.86033350115        1
[INPUT] 1    0    [1    /1   ]  0.223915222407       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.929904935183, 1.0]], [0, [7616.868680991145, 1.0]], [0, [3617.582750645822, 1.0]], [0, [1583.0826093384287, 1.0]], [0, [434.2834806760371, 1.0]], [0, [199.9195381754377, 1.0]], [0, [96.08513390404931, 1.0]], [0, [34.805540990530126, 1.0]], [0, [7.967170333669199, 1.0]], [0, [0.6622877089148512, 1.0]], [0, [3.150204536974632, 1.0]], [0, [0.2376400657655346, 1.0]], [1, [1362.873772479877, 1.0]], [1, [663.8722576520114, 1.0]], [1, [296.84972061687887, 1.0]], [1, [310.49855149826004, 1.0]], [1, [63.36355739948294, 1.0]], [1, [7.524339241242137, 1.0]], [1, [20.79475913661643, 1.0]], [1, [0.7814978521464877, 1.0]], [1, [2.8603335011453415, 1.0]], [1, [0.22391522240688488, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.92990494]
bas 1, expnt(s) = [7616.86868099]
bas 2, expnt(s) = [3617.58275065]
bas 3, expnt(s) = [1583.08260934]
bas 4, expnt(s) = [434.28348068]
bas 5, expnt(s) = [199.91953818]
bas 6, expnt(s) = [96.0851339]
bas 7, expnt(s) = [34.80554099]
bas 8, expnt(s) = [7.96717033]
bas 9, expnt(s) = [0.66228771]
bas 10, expnt(s) = [3.15020454]
bas 11, expnt(s) = [0.23764007]
bas 12, expnt(s) = [1362.87377248]
bas 13, expnt(s) = [663.87225765]
bas 14, expnt(s) = [296.84972062]
bas 15, expnt(s) = [310.4985515]
bas 16, expnt(s) = [63.3635574]
bas 17, expnt(s) = [7.52433924]
bas 18, expnt(s) = [20.79475914]
bas 19, expnt(s) = [0.78149785]
bas 20, expnt(s) = [2.8603335]
bas 21, expnt(s) = [0.22391522]
CPU time:       600.09
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61829299e+04 5.20030369e+03 7.61686868e+03 2.05990587e+03
 3.61758275e+03 1.17849808e+03 1.58308261e+03 6.34078033e+02
 4.34283481e+02 2.40350487e+02 1.99919538e+02 1.34324878e+02
 9.60851339e+01 7.75366751e+01 3.48055410e+01 3.62035631e+01
 7.96717033e+00 1.19810009e+01 6.62287709e-01 1.85481264e+00
 3.15020454e+00 5.97405324e+00 2.37640066e-01 8.59913510e-01
 1.36287377e+03 2.41576083e+04 6.63872258e+02 9.83082676e+03
 2.96849721e+02 3.59463831e+03 3.10498551e+02 3.80240932e+03
 6.33635574e+01 5.21535448e+02 7.52433924e+00 3.63554774e+01
 2.07947591e+01 1.29546821e+02 7.81497852e-01 2.14360188e+00
 2.86033350e+00 1.08518863e+01 2.23915222e-01 4.49354315e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99345434910509
cond(S) = 107255.03135078713
E1 = -729.5496119841459  E_coul = 203.17947762063065
init E= -526.370134363515
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555670585917671  LUMO = 0.992372075846277
  mo_energy =
[-1.18336489e+02 -1.22058970e+01 -9.44685378e+00 -9.44685378e+00
 -9.44685378e+00 -1.24011146e+00 -5.55670586e-01 -5.55670586e-01
 -5.55670586e-01  9.92372076e-01  1.04273687e+00  1.04273687e+00
  1.04273687e+00  7.51652044e+00  7.51652044e+00  7.51652044e+00
  1.21343832e+01  3.45385123e+01  3.45385123e+01  3.45385123e+01
  9.38533131e+01  1.33061704e+02  1.33061704e+02  1.33061704e+02
  3.95223855e+02  4.88178125e+02  4.88178125e+02  4.88178125e+02
  1.17488686e+03  1.33267186e+03  1.33267186e+03  1.33267186e+03
  3.01606333e+03  3.01606333e+03  3.01606333e+03  3.44963113e+03
  6.62899407e+03  6.62899407e+03  6.62899407e+03  9.87694500e+03
  2.62012606e+04  7.68914740e+04]
E1 = -727.8601699313688  E_coul = 201.10331923884831
cycle= 1 E= -526.75685069252  delta_E= -0.387  |g|= 0.186  |ddm|= 0.314
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.584941
diis-c [-0.34215629  1.        ]
  HOMO = -0.590685955802317  LUMO = 0.96454772706328
  mo_energy =
[-1.18644494e+02 -1.23439608e+01 -9.59572833e+00 -9.59572833e+00
 -9.59572833e+00 -1.27956583e+00 -5.90685956e-01 -5.90685956e-01
 -5.90685956e-01  9.64547727e-01  1.01808881e+00  1.01808881e+00
  1.01808881e+00  7.42414123e+00  7.42414123e+00  7.42414123e+00
  1.20263158e+01  3.43822613e+01  3.43822613e+01  3.43822613e+01
  9.36476274e+01  1.32831481e+02  1.32831481e+02  1.32831481e+02
  3.94936607e+02  4.87872223e+02  4.87872223e+02  4.87872223e+02
  1.17451442e+03  1.33230985e+03  1.33230985e+03  1.33230985e+03
  3.01563563e+03  3.01563563e+03  3.01563563e+03  3.44913740e+03
  6.62845375e+03  6.62845375e+03  6.62845375e+03  9.87633555e+03
  2.62005545e+04  7.68906764e+04]
E1 = -728.4341817745795  E_coul = 201.67660894999534
cycle= 2 E= -526.757572824584  delta_E= -0.000722  |g|= 0.0377  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766296
diis-c [-0.00384926  0.07177569  0.92822431]
  HOMO = -0.581468924644133  LUMO = 0.972667526647344
  mo_energy =
[-1.18576010e+02 -1.23054710e+01 -9.55556472e+00 -9.55556472e+00
 -9.55556472e+00 -1.26851787e+00 -5.81468925e-01 -5.81468925e-01
 -5.81468925e-01  9.72667527e-01  1.02496875e+00  1.02496875e+00
  1.02496875e+00  7.44849308e+00  7.44849308e+00  7.44849308e+00
  1.20561581e+01  3.44232166e+01  3.44232166e+01  3.44232166e+01
  9.37013012e+01  1.32888296e+02  1.32888296e+02  1.32888296e+02
  3.95002465e+02  4.87939830e+02  4.87939830e+02  4.87939830e+02
  1.17458601e+03  1.33238154e+03  1.33238154e+03  1.33238154e+03
  3.01570962e+03  3.01570962e+03  3.01570962e+03  3.44921240e+03
  6.62852953e+03  6.62852953e+03  6.62852953e+03  9.87641206e+03
  2.62006316e+04  7.68907539e+04]
E1 = -728.2821925805189  E_coul = 201.52456108651444
cycle= 3 E= -526.757631494004  delta_E= -5.87e-05  |g|= 0.00679  |ddm|= 0.0165
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.014392
diis-c [-7.60246244e-07 -1.20845281e-03  1.54034061e-01  8.47174392e-01]
  HOMO = -0.583073394978576  LUMO = 0.971357571301723
  mo_energy =
[-1.18586762e+02 -1.23117191e+01 -9.56218119e+00 -9.56218119e+00
 -9.56218119e+00 -1.27032795e+00 -5.83073395e-01 -5.83073395e-01
 -5.83073395e-01  9.71357571e-01  1.02379700e+00  1.02379700e+00
  1.02379700e+00  7.44438737e+00  7.44438737e+00  7.44438737e+00
  1.20512791e+01  3.44165146e+01  3.44165146e+01  3.44165146e+01
  9.36927691e+01  1.32879253e+02  1.32879253e+02  1.32879253e+02
  3.94992109e+02  4.87929211e+02  4.87929211e+02  4.87929211e+02
  1.17457475e+03  1.33237028e+03  1.33237028e+03  1.33237028e+03
  3.01569795e+03  3.01569795e+03  3.01569795e+03  3.44920048e+03
  6.62851744e+03  6.62851744e+03  6.62851744e+03  9.87639977e+03
  2.62006191e+04  7.68907412e+04]
E1 = -728.3066865471009  E_coul = 201.5490528311627
cycle= 4 E= -526.757633715938  delta_E= -2.22e-06  |g|= 0.000106  |ddm|= 0.00242
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116367
diis-c [-4.60475244e-09  8.10406704e-05 -1.19914524e-02 -7.07201946e-02
  1.08263061e+00]
  HOMO = -0.583055369637021  LUMO = 0.971392774430832
  mo_energy =
[-1.18586717e+02 -1.23116526e+01 -9.56212876e+00 -9.56212876e+00
 -9.56212876e+00 -1.27028504e+00 -5.83055370e-01 -5.83055370e-01
 -5.83055370e-01  9.71392774e-01  1.02381305e+00  1.02381305e+00
  1.02381305e+00  7.44442968e+00  7.44442968e+00  7.44442968e+00
  1.20513398e+01  3.44165653e+01  3.44165653e+01  3.44165653e+01
  9.36928255e+01  1.32879304e+02  1.32879304e+02  1.32879304e+02
  3.94992155e+02  4.87929256e+02  4.87929256e+02  4.87929256e+02
  1.17457478e+03  1.33237032e+03  1.33237032e+03  1.33237032e+03
  3.01569797e+03  3.01569797e+03  3.01569797e+03  3.44920050e+03
  6.62851745e+03  6.62851745e+03  6.62851745e+03  9.87639977e+03
  2.62006191e+04  7.68907412e+04]
E1 = -728.3064605455951  E_coul = 201.5488268275723
cycle= 5 E= -526.757633718023  delta_E= -2.08e-09  |g|= 2.11e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96581e-05
diis-c [-8.86275525e-11  1.27096684e-05 -1.85830940e-03 -1.28470128e-02
  2.91386117e-02  9.85554001e-01]
  HOMO = -0.583063045880663  LUMO = 0.971388945023694
  mo_energy =
[-1.18586749e+02 -1.23116757e+01 -9.56215384e+00 -9.56215384e+00
 -9.56215384e+00 -1.27029097e+00 -5.83063046e-01 -5.83063046e-01
 -5.83063046e-01  9.71388945e-01  1.02380792e+00  1.02380792e+00
  1.02380792e+00  7.44441247e+00  7.44441247e+00  7.44441247e+00
  1.20513214e+01  3.44165408e+01  3.44165408e+01  3.44165408e+01
  9.36927980e+01  1.32879275e+02  1.32879275e+02  1.32879275e+02
  3.94992124e+02  4.87929225e+02  4.87929225e+02  4.87929225e+02
  1.17457475e+03  1.33237029e+03  1.33237029e+03  1.33237029e+03
  3.01569794e+03  3.01569794e+03  3.01569794e+03  3.44920046e+03
  6.62851741e+03  6.62851741e+03  6.62851741e+03  9.87639973e+03
  2.62006191e+04  7.68907412e+04]
E1 = -728.3065431361418  E_coul = 201.54890941805454
cycle= 6 E= -526.757633718087  delta_E= -6.45e-11  |g|= 1.81e-06  |ddm|= 2.02e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3065431361418  E_coul = 201.54890941805454
  HOMO = -0.583062941551316  LUMO = 0.971389386253027
  mo_energy =
[-1.18586748e+02 -1.23116751e+01 -9.56215333e+00 -9.56215333e+00
 -9.56215333e+00 -1.27029045e+00 -5.83062942e-01 -5.83062942e-01
 -5.83062942e-01  9.71389386e-01  1.02380805e+00  1.02380805e+00
  1.02380805e+00  7.44441282e+00  7.44441282e+00  7.44441282e+00
  1.20513220e+01  3.44165414e+01  3.44165414e+01  3.44165414e+01
  9.36927986e+01  1.32879276e+02  1.32879276e+02  1.32879276e+02
  3.94992125e+02  4.87929226e+02  4.87929226e+02  4.87929226e+02
  1.17457475e+03  1.33237029e+03  1.33237029e+03  1.33237029e+03
  3.01569794e+03  3.01569794e+03  3.01569794e+03  3.44920046e+03
  6.62851741e+03  6.62851741e+03  6.62851741e+03  9.87639973e+03
  2.62006191e+04  7.68907412e+04]
E1 = -728.3065405038816  E_coul = 201.54890678579324
Extra cycle  E= -526.757633718088  delta_E= -1.02e-12  |g|= 3.78e-07  |ddm|= 3.14e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
exp = [2.61829299e+04 7.61686868e+03 3.61758275e+03 1.58308261e+03
 4.34283481e+02 1.99919538e+02 9.60851339e+01 3.48055410e+01
 7.96717033e+00 6.62287709e-01 3.15020454e+00 2.37640066e-01
 1.36287377e+03 6.63872258e+02 2.96849721e+02 3.10498551e+02
 6.33635574e+01 7.52433924e+00 2.07947591e+01 7.81497852e-01
 2.86033350e+00 2.23915222e-01]
E = -526.7576337180883
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:21 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.9299049        1
[INPUT] 0    0    [1    /1   ]  7616.86868099        1
[INPUT] 0    0    [1    /1   ]  3617.58275065        1
[INPUT] 0    0    [1    /1   ]  1583.08260934        1
[INPUT] 0    0    [1    /1   ]  434.283480676        1
[INPUT] 0    0    [1    /1   ]  199.919538175        1
[INPUT] 0    0    [1    /1   ]  96.085133904         1
[INPUT] 0    0    [1    /1   ]  34.8055409905        1
[INPUT] 0    0    [1    /1   ]  7.96717033367        1
[INPUT] 0    0    [1    /1   ]  0.662287708915       1
[INPUT] 0    0    [1    /1   ]  3.15020453697        1
[INPUT] 0    0    [1    /1   ]  0.237640065766       1
[INPUT] 1    0    [1    /1   ]  1362.87377248        1
[INPUT] 1    0    [1    /1   ]  663.872257652        1
[INPUT] 1    0    [1    /1   ]  296.849720617        1
[INPUT] 1    0    [1    /1   ]  310.498551498        1
[INPUT] 1    0    [1    /1   ]  63.3635573995        1
[INPUT] 1    0    [1    /1   ]  7.52433924124        1
[INPUT] 1    0    [1    /1   ]  20.7947591366        1
[INPUT] 1    0    [1    /1   ]  0.781497852146       1
[INPUT] 1    0    [1    /1   ]  2.86033350115        1
[INPUT] 1    0    [1    /1   ]  0.223915222407       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.929904935183, 1.0]], [0, [7616.868680991145, 1.0]], [0, [3617.582750645822, 1.0]], [0, [1583.0826093384287, 1.0]], [0, [434.2834806760371, 1.0]], [0, [199.9195381754377, 1.0]], [0, [96.08513390404931, 1.0]], [0, [34.805540990530126, 1.0]], [0, [7.967170333669199, 1.0]], [0, [0.6622877089148512, 1.0]], [0, [3.150204536974632, 1.0]], [0, [0.2376400657655346, 1.0]], [1, [1362.873772479877, 1.0]], [1, [663.8722576520114, 1.0]], [1, [296.84972061687887, 1.0]], [1, [310.49855149826004, 1.0]], [1, [63.36355739948294, 1.0]], [1, [7.524339241242137, 1.0]], [1, [20.79475913661643, 1.0]], [1, [0.7814978521464877, 1.0]], [1, [2.8603335011453415, 1.0]], [1, [0.22391522240688488, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.92990494]
bas 1, expnt(s) = [7616.86868099]
bas 2, expnt(s) = [3617.58275065]
bas 3, expnt(s) = [1583.08260934]
bas 4, expnt(s) = [434.28348068]
bas 5, expnt(s) = [199.91953818]
bas 6, expnt(s) = [96.0851339]
bas 7, expnt(s) = [34.80554099]
bas 8, expnt(s) = [7.96717033]
bas 9, expnt(s) = [0.66228771]
bas 10, expnt(s) = [3.15020454]
bas 11, expnt(s) = [0.23764007]
bas 12, expnt(s) = [1362.87377248]
bas 13, expnt(s) = [663.87225765]
bas 14, expnt(s) = [296.84972062]
bas 15, expnt(s) = [310.4985515]
bas 16, expnt(s) = [63.3635574]
bas 17, expnt(s) = [7.52433924]
bas 18, expnt(s) = [20.79475914]
bas 19, expnt(s) = [0.78149785]
bas 20, expnt(s) = [2.8603335]
bas 21, expnt(s) = [0.22391522]
CPU time:       600.64
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61829299e+04 5.20030369e+03 7.61686868e+03 2.05990587e+03
 3.61758275e+03 1.17849808e+03 1.58308261e+03 6.34078033e+02
 4.34283481e+02 2.40350487e+02 1.99919538e+02 1.34324878e+02
 9.60851339e+01 7.75366751e+01 3.48055410e+01 3.62035631e+01
 7.96717033e+00 1.19810009e+01 6.62287709e-01 1.85481264e+00
 3.15020454e+00 5.97405324e+00 2.37640066e-01 8.59913510e-01
 1.36287377e+03 2.41576083e+04 6.63872258e+02 9.83082676e+03
 2.96849721e+02 3.59463831e+03 3.10498551e+02 3.80240932e+03
 6.33635574e+01 5.21535448e+02 7.52433924e+00 3.63554774e+01
 2.07947591e+01 1.29546821e+02 7.81497852e-01 2.14360188e+00
 2.86033350e+00 1.08518863e+01 2.23915222e-01 4.49354315e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99345434910509
cond(S) = 107255.03135078713
E1 = -729.5496119841459  E_coul = 203.17947762063065
init E= -526.370134363515
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555670585917671  LUMO = 0.992372075846277
  mo_energy =
[-1.18336489e+02 -1.22058970e+01 -9.44685378e+00 -9.44685378e+00
 -9.44685378e+00 -1.24011146e+00 -5.55670586e-01 -5.55670586e-01
 -5.55670586e-01  9.92372076e-01  1.04273687e+00  1.04273687e+00
  1.04273687e+00  7.51652044e+00  7.51652044e+00  7.51652044e+00
  1.21343832e+01  3.45385123e+01  3.45385123e+01  3.45385123e+01
  9.38533131e+01  1.33061704e+02  1.33061704e+02  1.33061704e+02
  3.95223855e+02  4.88178125e+02  4.88178125e+02  4.88178125e+02
  1.17488686e+03  1.33267186e+03  1.33267186e+03  1.33267186e+03
  3.01606333e+03  3.01606333e+03  3.01606333e+03  3.44963113e+03
  6.62899407e+03  6.62899407e+03  6.62899407e+03  9.87694500e+03
  2.62012606e+04  7.68914740e+04]
E1 = -727.8601699313688  E_coul = 201.10331923884831
cycle= 1 E= -526.75685069252  delta_E= -0.387  |g|= 0.186  |ddm|= 0.314
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.584941
diis-c [-0.34215629  1.        ]
  HOMO = -0.590685955802317  LUMO = 0.96454772706328
  mo_energy =
[-1.18644494e+02 -1.23439608e+01 -9.59572833e+00 -9.59572833e+00
 -9.59572833e+00 -1.27956583e+00 -5.90685956e-01 -5.90685956e-01
 -5.90685956e-01  9.64547727e-01  1.01808881e+00  1.01808881e+00
  1.01808881e+00  7.42414123e+00  7.42414123e+00  7.42414123e+00
  1.20263158e+01  3.43822613e+01  3.43822613e+01  3.43822613e+01
  9.36476274e+01  1.32831481e+02  1.32831481e+02  1.32831481e+02
  3.94936607e+02  4.87872223e+02  4.87872223e+02  4.87872223e+02
  1.17451442e+03  1.33230985e+03  1.33230985e+03  1.33230985e+03
  3.01563563e+03  3.01563563e+03  3.01563563e+03  3.44913740e+03
  6.62845375e+03  6.62845375e+03  6.62845375e+03  9.87633555e+03
  2.62005545e+04  7.68906764e+04]
E1 = -728.4341817745795  E_coul = 201.67660894999534
cycle= 2 E= -526.757572824584  delta_E= -0.000722  |g|= 0.0377  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766296
diis-c [-0.00384926  0.07177569  0.92822431]
  HOMO = -0.581468924644133  LUMO = 0.972667526647344
  mo_energy =
[-1.18576010e+02 -1.23054710e+01 -9.55556472e+00 -9.55556472e+00
 -9.55556472e+00 -1.26851787e+00 -5.81468925e-01 -5.81468925e-01
 -5.81468925e-01  9.72667527e-01  1.02496875e+00  1.02496875e+00
  1.02496875e+00  7.44849308e+00  7.44849308e+00  7.44849308e+00
  1.20561581e+01  3.44232166e+01  3.44232166e+01  3.44232166e+01
  9.37013012e+01  1.32888296e+02  1.32888296e+02  1.32888296e+02
  3.95002465e+02  4.87939830e+02  4.87939830e+02  4.87939830e+02
  1.17458601e+03  1.33238154e+03  1.33238154e+03  1.33238154e+03
  3.01570962e+03  3.01570962e+03  3.01570962e+03  3.44921240e+03
  6.62852953e+03  6.62852953e+03  6.62852953e+03  9.87641206e+03
  2.62006316e+04  7.68907539e+04]
E1 = -728.2821925805189  E_coul = 201.52456108651444
cycle= 3 E= -526.757631494004  delta_E= -5.87e-05  |g|= 0.00679  |ddm|= 0.0165
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.014392
diis-c [-7.60246244e-07 -1.20845281e-03  1.54034061e-01  8.47174392e-01]
  HOMO = -0.583073394978576  LUMO = 0.971357571301723
  mo_energy =
[-1.18586762e+02 -1.23117191e+01 -9.56218119e+00 -9.56218119e+00
 -9.56218119e+00 -1.27032795e+00 -5.83073395e-01 -5.83073395e-01
 -5.83073395e-01  9.71357571e-01  1.02379700e+00  1.02379700e+00
  1.02379700e+00  7.44438737e+00  7.44438737e+00  7.44438737e+00
  1.20512791e+01  3.44165146e+01  3.44165146e+01  3.44165146e+01
  9.36927691e+01  1.32879253e+02  1.32879253e+02  1.32879253e+02
  3.94992109e+02  4.87929211e+02  4.87929211e+02  4.87929211e+02
  1.17457475e+03  1.33237028e+03  1.33237028e+03  1.33237028e+03
  3.01569795e+03  3.01569795e+03  3.01569795e+03  3.44920048e+03
  6.62851744e+03  6.62851744e+03  6.62851744e+03  9.87639977e+03
  2.62006191e+04  7.68907412e+04]
E1 = -728.3066865471009  E_coul = 201.5490528311627
cycle= 4 E= -526.757633715938  delta_E= -2.22e-06  |g|= 0.000106  |ddm|= 0.00242
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000116367
diis-c [-4.60475244e-09  8.10406704e-05 -1.19914524e-02 -7.07201946e-02
  1.08263061e+00]
  HOMO = -0.583055369637021  LUMO = 0.971392774430832
  mo_energy =
[-1.18586717e+02 -1.23116526e+01 -9.56212876e+00 -9.56212876e+00
 -9.56212876e+00 -1.27028504e+00 -5.83055370e-01 -5.83055370e-01
 -5.83055370e-01  9.71392774e-01  1.02381305e+00  1.02381305e+00
  1.02381305e+00  7.44442968e+00  7.44442968e+00  7.44442968e+00
  1.20513398e+01  3.44165653e+01  3.44165653e+01  3.44165653e+01
  9.36928255e+01  1.32879304e+02  1.32879304e+02  1.32879304e+02
  3.94992155e+02  4.87929256e+02  4.87929256e+02  4.87929256e+02
  1.17457478e+03  1.33237032e+03  1.33237032e+03  1.33237032e+03
  3.01569797e+03  3.01569797e+03  3.01569797e+03  3.44920050e+03
  6.62851745e+03  6.62851745e+03  6.62851745e+03  9.87639977e+03
  2.62006191e+04  7.68907412e+04]
E1 = -728.3064605455951  E_coul = 201.5488268275723
cycle= 5 E= -526.757633718023  delta_E= -2.08e-09  |g|= 2.11e-05  |ddm|= 0.000174
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.96581e-05
diis-c [-8.86275525e-11  1.27096684e-05 -1.85830940e-03 -1.28470128e-02
  2.91386117e-02  9.85554001e-01]
  HOMO = -0.583063045880663  LUMO = 0.971388945023694
  mo_energy =
[-1.18586749e+02 -1.23116757e+01 -9.56215384e+00 -9.56215384e+00
 -9.56215384e+00 -1.27029097e+00 -5.83063046e-01 -5.83063046e-01
 -5.83063046e-01  9.71388945e-01  1.02380792e+00  1.02380792e+00
  1.02380792e+00  7.44441247e+00  7.44441247e+00  7.44441247e+00
  1.20513214e+01  3.44165408e+01  3.44165408e+01  3.44165408e+01
  9.36927980e+01  1.32879275e+02  1.32879275e+02  1.32879275e+02
  3.94992124e+02  4.87929225e+02  4.87929225e+02  4.87929225e+02
  1.17457475e+03  1.33237029e+03  1.33237029e+03  1.33237029e+03
  3.01569794e+03  3.01569794e+03  3.01569794e+03  3.44920046e+03
  6.62851741e+03  6.62851741e+03  6.62851741e+03  9.87639973e+03
  2.62006191e+04  7.68907412e+04]
E1 = -728.3065431361418  E_coul = 201.54890941805454
cycle= 6 E= -526.757633718087  delta_E= -6.45e-11  |g|= 1.81e-06  |ddm|= 2.02e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3065431361418  E_coul = 201.54890941805454
  HOMO = -0.583062941551316  LUMO = 0.971389386253027
  mo_energy =
[-1.18586748e+02 -1.23116751e+01 -9.56215333e+00 -9.56215333e+00
 -9.56215333e+00 -1.27029045e+00 -5.83062942e-01 -5.83062942e-01
 -5.83062942e-01  9.71389386e-01  1.02380805e+00  1.02380805e+00
  1.02380805e+00  7.44441282e+00  7.44441282e+00  7.44441282e+00
  1.20513220e+01  3.44165414e+01  3.44165414e+01  3.44165414e+01
  9.36927986e+01  1.32879276e+02  1.32879276e+02  1.32879276e+02
  3.94992125e+02  4.87929226e+02  4.87929226e+02  4.87929226e+02
  1.17457475e+03  1.33237029e+03  1.33237029e+03  1.33237029e+03
  3.01569794e+03  3.01569794e+03  3.01569794e+03  3.44920046e+03
  6.62851741e+03  6.62851741e+03  6.62851741e+03  9.87639973e+03
  2.62006191e+04  7.68907412e+04]
E1 = -728.3065405038816  E_coul = 201.54890678579324
Extra cycle  E= -526.757633718088  delta_E= -1.02e-12  |g|= 3.78e-07  |ddm|= 3.14e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.23 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 107255.03135078713
E1 = -728.3065405038816  E_coul = 201.54890678579324
init E= -526.757633718088
    CPU time for initialize scf      0.82 sec, wall time      0.33 sec
  HOMO = -0.583063006344426  LUMO = 0.971389403936531
  mo_energy =
[-1.18586748e+02 -1.23116753e+01 -9.56215355e+00 -9.56215355e+00
 -9.56215355e+00 -1.27029045e+00 -5.83063006e-01 -5.83063006e-01
 -5.83063006e-01  9.71389404e-01  1.02380802e+00  1.02380802e+00
  1.02380802e+00  7.44441268e+00  7.44441268e+00  7.44441268e+00
  1.20513219e+01  3.44165412e+01  3.44165412e+01  3.44165412e+01
  9.36927984e+01  1.32879276e+02  1.32879276e+02  1.32879276e+02
  3.94992125e+02  4.87929226e+02  4.87929226e+02  4.87929226e+02
  1.17457475e+03  1.33237029e+03  1.33237029e+03  1.33237029e+03
  3.01569794e+03  3.01569794e+03  3.01569794e+03  3.44920046e+03
  6.62851741e+03  6.62851741e+03  6.62851741e+03  9.87639973e+03
  2.62006191e+04  7.68907412e+04]
E1 = -728.3065411142532  E_coul = 201.5489073961637
cycle= 1 E= -526.757633718089  delta_E= -1.14e-12  |g|= 8.59e-08  |ddm|= 5.82e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.04 sec
E1 = -728.3065411142532  E_coul = 201.5489073961637
  HOMO = -0.583062997551356  LUMO = 0.971389426282321
  mo_energy =
[-1.18586748e+02 -1.23116752e+01 -9.56215351e+00 -9.56215351e+00
 -9.56215351e+00 -1.27029042e+00 -5.83062998e-01 -5.83062998e-01
 -5.83062998e-01  9.71389426e-01  1.02380803e+00  1.02380803e+00
  1.02380803e+00  7.44441271e+00  7.44441271e+00  7.44441271e+00
  1.20513219e+01  3.44165412e+01  3.44165412e+01  3.44165412e+01
  9.36927985e+01  1.32879276e+02  1.32879276e+02  1.32879276e+02
  3.94992125e+02  4.87929226e+02  4.87929226e+02  4.87929226e+02
  1.17457475e+03  1.33237029e+03  1.33237029e+03  1.33237029e+03
  3.01569794e+03  3.01569794e+03  3.01569794e+03  3.44920046e+03
  6.62851741e+03  6.62851741e+03  6.62851741e+03  9.87639973e+03
  2.62006191e+04  7.68907412e+04]
E1 = -728.3065409160802  E_coul = 201.54890719799232
Extra cycle  E= -526.757633718088  delta_E= 1.59e-12  |g|= 1.84e-08  |ddm|= 1.33e-07
    CPU time for scf_cycle      0.93 sec, wall time      0.46 sec
exp = [2.61829299e+04 7.61686868e+03 3.61758275e+03 1.58308261e+03
 4.34283481e+02 1.99919538e+02 9.60851339e+01 3.48055410e+01
 7.96717033e+00 6.62287709e-01 3.15020454e+00 2.37640066e-01
 1.36287377e+03 6.63872258e+02 2.96849721e+02 3.10498551e+02
 6.33635574e+01 7.52433924e+00 2.07947591e+01 7.81497852e-01
 2.86033350e+00 2.23915222e-01]
grad_E = [-1.44843807e-06  2.60561202e-06 -2.23027706e-06  5.36077024e-05
 -2.30992859e-04  8.70393314e-05  2.00186008e-04 -3.70925709e-04
 -1.87030765e-04  4.81573151e-03  8.28386259e-04 -1.25726511e-02
 -6.18906572e-07  3.60991163e-06  1.60230017e-05  1.36261294e-05
  2.16279064e-04  3.02560160e-03 -8.76326055e-04 -2.09589922e-03
 -3.98020242e-03  5.35003171e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:25 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.9508417        1
[INPUT] 0    0    [1    /1   ]  7616.81858113        1
[INPUT] 0    0    [1    /1   ]  3617.60027638        1
[INPUT] 0    0    [1    /1   ]  1581.9480142         1
[INPUT] 0    0    [1    /1   ]  438.383918577        1
[INPUT] 0    0    [1    /1   ]  207.490959595        1
[INPUT] 0    0    [1    /1   ]  97.1374742218        1
[INPUT] 0    0    [1    /1   ]  34.9288553648        1
[INPUT] 0    0    [1    /1   ]  7.98523675875        1
[INPUT] 0    0    [1    /1   ]  0.66154095977        1
[INPUT] 0    0    [1    /1   ]  3.15495837893        1
[INPUT] 0    0    [1    /1   ]  0.238301038545       1
[INPUT] 1    0    [1    /1   ]  1362.880691          1
[INPUT] 1    0    [1    /1   ]  663.805651519        1
[INPUT] 1    0    [1    /1   ]  296.536115711        1
[INPUT] 1    0    [1    /1   ]  310.22832856         1
[INPUT] 1    0    [1    /1   ]  63.516190957         1
[INPUT] 1    0    [1    /1   ]  7.49128134201        1
[INPUT] 1    0    [1    /1   ]  20.7607214668        1
[INPUT] 1    0    [1    /1   ]  0.780451706262       1
[INPUT] 1    0    [1    /1   ]  2.85053093086        1
[INPUT] 1    0    [1    /1   ]  0.223659275324       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.950841681166, 1.0]], [0, [7616.818581133121, 1.0]], [0, [3617.600276381036, 1.0]], [0, [1581.948014204763, 1.0]], [0, [438.38391857665795, 1.0]], [0, [207.49095959515864, 1.0]], [0, [97.13747422179127, 1.0]], [0, [34.92885536480386, 1.0]], [0, [7.985236758753207, 1.0]], [0, [0.6615409597704364, 1.0]], [0, [3.154958378928159, 1.0]], [0, [0.2383010385449303, 1.0]], [1, [1362.880690998747, 1.0]], [1, [663.8056515193682, 1.0]], [1, [296.5361157113804, 1.0]], [1, [310.2283285604343, 1.0]], [1, [63.516190956973105, 1.0]], [1, [7.491281342010835, 1.0]], [1, [20.760721466839655, 1.0]], [1, [0.7804517062622577, 1.0]], [1, [2.850530930856384, 1.0]], [1, [0.22365927532380925, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.95084168]
bas 1, expnt(s) = [7616.81858113]
bas 2, expnt(s) = [3617.60027638]
bas 3, expnt(s) = [1581.9480142]
bas 4, expnt(s) = [438.38391858]
bas 5, expnt(s) = [207.4909596]
bas 6, expnt(s) = [97.13747422]
bas 7, expnt(s) = [34.92885536]
bas 8, expnt(s) = [7.98523676]
bas 9, expnt(s) = [0.66154096]
bas 10, expnt(s) = [3.15495838]
bas 11, expnt(s) = [0.23830104]
bas 12, expnt(s) = [1362.880691]
bas 13, expnt(s) = [663.80565152]
bas 14, expnt(s) = [296.53611571]
bas 15, expnt(s) = [310.22832856]
bas 16, expnt(s) = [63.51619096]
bas 17, expnt(s) = [7.49128134]
bas 18, expnt(s) = [20.76072147]
bas 19, expnt(s) = [0.78045171]
bas 20, expnt(s) = [2.85053093]
bas 21, expnt(s) = [0.22365928]
CPU time:       606.22
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61829508e+04 5.20030681e+03 7.61681858e+03 2.05989571e+03
 3.61760028e+03 1.17850236e+03 1.58194801e+03 6.33737170e+02
 4.38383919e+02 2.42050501e+02 2.07490960e+02 1.38122493e+02
 9.71374742e+01 7.81727031e+01 3.49288554e+01 3.62997212e+01
 7.98523676e+00 1.20013713e+01 6.61540960e-01 1.85324390e+00
 3.15495838e+00 5.98081336e+00 2.38301039e-01 8.61706712e-01
 1.36288069e+03 2.41577616e+04 6.63805652e+02 9.82959387e+03
 2.96536116e+02 3.58989202e+03 3.10228329e+02 3.79827328e+03
 6.35161910e+01 5.23106299e+02 7.49128134e+00 3.61559292e+01
 2.07607215e+01 1.29281816e+02 7.80451706e-01 2.14001558e+00
 2.85053093e+00 1.08054184e+01 2.23659275e-01 4.48712362e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99349659611122
cond(S) = 106418.83533741417
E1 = -729.5493303476209  E_coul = 203.17904222898463
init E= -526.370288118636
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555693711585027  LUMO = 0.994022466418537
  mo_energy =
[-1.18336589e+02 -1.22059360e+01 -9.44687713e+00 -9.44687713e+00
 -9.44687713e+00 -1.24012090e+00 -5.55693712e-01 -5.55693712e-01
 -5.55693712e-01  9.94022466e-01  1.04082276e+00  1.04082276e+00
  1.04082276e+00  7.48570656e+00  7.48570656e+00  7.48570656e+00
  1.21734782e+01  3.43975253e+01  3.43975253e+01  3.43975253e+01
  9.47370147e+01  1.32952906e+02  1.32952906e+02  1.32952906e+02
  4.02215230e+02  4.88143225e+02  4.88143225e+02  4.88143225e+02
  1.19789332e+03  1.33211922e+03  1.33211922e+03  1.33211922e+03
  3.01470550e+03  3.01470550e+03  3.01470550e+03  3.48921691e+03
  6.62708591e+03  6.62708591e+03  6.62708591e+03  9.92096209e+03
  2.62443202e+04  7.69318523e+04]
E1 = -727.8600843007376  E_coul = 201.1030941429302
cycle= 1 E= -526.756990157807  delta_E= -0.387  |g|= 0.186  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.584204
diis-c [-0.34129486  1.        ]
  HOMO = -0.590699891358181  LUMO = 0.966145182209354
  mo_energy =
[-1.18644620e+02 -1.23439646e+01 -9.59572432e+00 -9.59572432e+00
 -9.59572432e+00 -1.27958824e+00 -5.90699891e-01 -5.90699891e-01
 -5.90699891e-01  9.66145182e-01  1.01622254e+00  1.01622254e+00
  1.01622254e+00  7.39358469e+00  7.39358469e+00  7.39358469e+00
  1.20652786e+01  3.42414557e+01  3.42414557e+01  3.42414557e+01
  9.45304645e+01  1.32722552e+02  1.32722552e+02  1.32722552e+02
  4.01926182e+02  4.87837337e+02  4.87837337e+02  4.87837337e+02
  1.19751920e+03  1.33175726e+03  1.33175726e+03  1.33175726e+03
  3.01427784e+03  3.01427784e+03  3.01427784e+03  3.48872297e+03
  6.62654565e+03  6.62654565e+03  6.62654565e+03  9.92035293e+03
  2.62436143e+04  7.69310548e+04]
E1 = -728.434322006366  E_coul = 201.67660968413125
cycle= 2 E= -526.757712322235  delta_E= -0.000722  |g|= 0.0377  |ddm|= 0.0533
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0766376
diis-c [-0.00383984  0.07203502  0.92796498]
  HOMO = -0.581480928709298  LUMO = 0.974271322693683
  mo_energy =
[-1.18576129e+02 -1.23054701e+01 -9.55555591e+00 -9.55555591e+00
 -9.55555591e+00 -1.26854156e+00 -5.81480929e-01 -5.81480929e-01
 -5.81480929e-01  9.74271323e-01  1.02308913e+00  1.02308913e+00
  1.02308913e+00  7.41788109e+00  7.41788109e+00  7.41788109e+00
  1.20951810e+01  3.42823785e+01  3.42823785e+01  3.42823785e+01
  9.45843134e+01  1.32779393e+02  1.32779393e+02  1.32779393e+02
  4.01992232e+02  4.87904952e+02  4.87904952e+02  4.87904952e+02
  1.19759089e+03  1.33182895e+03  1.33182895e+03  1.33182895e+03
  3.01435184e+03  3.01435184e+03  3.01435184e+03  3.48879798e+03
  6.62662143e+03  6.62662143e+03  6.62662143e+03  9.92042945e+03
  2.62436915e+04  7.69311323e+04]
E1 = -728.2822949671606  E_coul = 201.52452393525041
cycle= 3 E= -526.75777103191  delta_E= -5.87e-05  |g|= 0.00679  |ddm|= 0.0165
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0143672
diis-c [-7.55916652e-07 -1.20754650e-03  1.53786612e-01  8.47420935e-01]
  HOMO = -0.583083874281975  LUMO = 0.97296010600446
  mo_energy =
[-1.18586868e+02 -1.23117114e+01 -9.56216497e+00 -9.56216497e+00
 -9.56216497e+00 -1.27035136e+00 -5.83083874e-01 -5.83083874e-01
 -5.83083874e-01  9.72960106e-01  1.02192073e+00  1.02192073e+00
  1.02192073e+00  7.41378904e+00  7.41378904e+00  7.41378904e+00
  1.20902985e+01  3.42756897e+01  3.42756897e+01  3.42756897e+01
  9.45757670e+01  1.32770358e+02  1.32770358e+02  1.32770358e+02
  4.01981861e+02  4.87894347e+02  4.87894347e+02  4.87894347e+02
  1.19757962e+03  1.33181771e+03  1.33181771e+03  1.33181771e+03
  3.01434018e+03  3.01434018e+03  3.01434018e+03  3.48878608e+03
  6.62660935e+03  6.62660935e+03  6.62660935e+03  9.92041717e+03
  2.62436790e+04  7.69311197e+04]
E1 = -728.3067706187929  E_coul = 201.54899737037798
cycle= 4 E= -526.757773248415  delta_E= -2.22e-06  |g|= 0.000105  |ddm|= 0.00242
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000114499
diis-c [-4.56010670e-09  7.94466941e-05 -1.17674190e-02 -6.94887030e-02
  1.08117668e+00]
  HOMO = -0.583065526718914  LUMO = 0.97299518149593
  mo_energy =
[-1.18586822e+02 -1.23116442e+01 -9.56211164e+00 -9.56211164e+00
 -9.56211164e+00 -1.27030857e+00 -5.83065527e-01 -5.83065527e-01
 -5.83065527e-01  9.72995181e-01  1.02193693e+00  1.02193693e+00
  1.02193693e+00  7.41383192e+00  7.41383192e+00  7.41383192e+00
  1.20903598e+01  3.42757413e+01  3.42757413e+01  3.42757413e+01
  9.45758243e+01  1.32770410e+02  1.32770410e+02  1.32770410e+02
  4.01981908e+02  4.87894393e+02  4.87894393e+02  4.87894393e+02
  1.19757966e+03  1.33181775e+03  1.33181775e+03  1.33181775e+03
  3.01434021e+03  3.01434021e+03  3.01434021e+03  3.48878610e+03
  6.62660937e+03  6.62660937e+03  6.62660937e+03  9.92041717e+03
  2.62436790e+04  7.69311197e+04]
E1 = -728.30654265715  E_coul = 201.54876940673066
cycle= 5 E= -526.757773250419  delta_E= -2e-09  |g|= 2.1e-05  |ddm|= 0.000171
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.95424e-05
diis-c [-8.68576409e-11  1.26730345e-05 -1.85177833e-03 -1.28299328e-02
  3.07741514e-02  9.83894887e-01]
  HOMO = -0.583073160725386  LUMO = 0.972991338543934
  mo_energy =
[-1.18586853e+02 -1.23116671e+01 -9.56213661e+00 -9.56213661e+00
 -9.56213661e+00 -1.27031450e+00 -5.83073161e-01 -5.83073161e-01
 -5.83073161e-01  9.72991339e-01  1.02193183e+00  1.02193183e+00
  1.02193183e+00  7.41381482e+00  7.41381482e+00  7.41381482e+00
  1.20903415e+01  3.42757170e+01  3.42757170e+01  3.42757170e+01
  9.45757968e+01  1.32770382e+02  1.32770382e+02  1.32770382e+02
  4.01981877e+02  4.87894362e+02  4.87894362e+02  4.87894362e+02
  1.19757963e+03  1.33181772e+03  1.33181772e+03  1.33181772e+03
  3.01434018e+03  3.01434018e+03  3.01434018e+03  3.48878606e+03
  6.62660933e+03  6.62660933e+03  6.62660933e+03  9.92041714e+03
  2.62436789e+04  7.69311196e+04]
E1 = -728.306625016182  E_coul = 201.54885176570036
cycle= 6 E= -526.757773250482  delta_E= -6.24e-11  |g|= 1.81e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.306625016182  E_coul = 201.54885176570036
  HOMO = -0.583073072008075  LUMO = 0.972991768429835
  mo_energy =
[-1.18586852e+02 -1.23116666e+01 -9.56213616e+00 -9.56213616e+00
 -9.56213616e+00 -1.27031400e+00 -5.83073072e-01 -5.83073072e-01
 -5.83073072e-01  9.72991768e-01  1.02193195e+00  1.02193195e+00
  1.02193195e+00  7.41381513e+00  7.41381513e+00  7.41381513e+00
  1.20903420e+01  3.42757175e+01  3.42757175e+01  3.42757175e+01
  9.45757975e+01  1.32770382e+02  1.32770382e+02  1.32770382e+02
  4.01981878e+02  4.87894362e+02  4.87894362e+02  4.87894362e+02
  1.19757963e+03  1.33181772e+03  1.33181772e+03  1.33181772e+03
  3.01434018e+03  3.01434018e+03  3.01434018e+03  3.48878606e+03
  6.62660933e+03  6.62660933e+03  6.62660933e+03  9.92041714e+03
  2.62436789e+04  7.69311196e+04]
E1 = -728.3066225864407  E_coul = 201.54884933595787
Extra cycle  E= -526.757773250483  delta_E= -1.14e-12  |g|= 3.76e-07  |ddm|= 3.14e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
exp = [2.61829508e+04 7.61681858e+03 3.61760028e+03 1.58194801e+03
 4.38383919e+02 2.07490960e+02 9.71374742e+01 3.49288554e+01
 7.98523676e+00 6.61540960e-01 3.15495838e+00 2.38301039e-01
 1.36288069e+03 6.63805652e+02 2.96536116e+02 3.10228329e+02
 6.35161910e+01 7.49128134e+00 2.07607215e+01 7.80451706e-01
 2.85053093e+00 2.23659275e-01]
E = -526.7577732504828
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:26 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.9508417        1
[INPUT] 0    0    [1    /1   ]  7616.81858113        1
[INPUT] 0    0    [1    /1   ]  3617.60027638        1
[INPUT] 0    0    [1    /1   ]  1581.9480142         1
[INPUT] 0    0    [1    /1   ]  438.383918577        1
[INPUT] 0    0    [1    /1   ]  207.490959595        1
[INPUT] 0    0    [1    /1   ]  97.1374742218        1
[INPUT] 0    0    [1    /1   ]  34.9288553648        1
[INPUT] 0    0    [1    /1   ]  7.98523675875        1
[INPUT] 0    0    [1    /1   ]  0.66154095977        1
[INPUT] 0    0    [1    /1   ]  3.15495837893        1
[INPUT] 0    0    [1    /1   ]  0.238301038545       1
[INPUT] 1    0    [1    /1   ]  1362.880691          1
[INPUT] 1    0    [1    /1   ]  663.805651519        1
[INPUT] 1    0    [1    /1   ]  296.536115711        1
[INPUT] 1    0    [1    /1   ]  310.22832856         1
[INPUT] 1    0    [1    /1   ]  63.516190957         1
[INPUT] 1    0    [1    /1   ]  7.49128134201        1
[INPUT] 1    0    [1    /1   ]  20.7607214668        1
[INPUT] 1    0    [1    /1   ]  0.780451706262       1
[INPUT] 1    0    [1    /1   ]  2.85053093086        1
[INPUT] 1    0    [1    /1   ]  0.223659275324       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.950841681166, 1.0]], [0, [7616.818581133121, 1.0]], [0, [3617.600276381036, 1.0]], [0, [1581.948014204763, 1.0]], [0, [438.38391857665795, 1.0]], [0, [207.49095959515864, 1.0]], [0, [97.13747422179127, 1.0]], [0, [34.92885536480386, 1.0]], [0, [7.985236758753207, 1.0]], [0, [0.6615409597704364, 1.0]], [0, [3.154958378928159, 1.0]], [0, [0.2383010385449303, 1.0]], [1, [1362.880690998747, 1.0]], [1, [663.8056515193682, 1.0]], [1, [296.5361157113804, 1.0]], [1, [310.2283285604343, 1.0]], [1, [63.516190956973105, 1.0]], [1, [7.491281342010835, 1.0]], [1, [20.760721466839655, 1.0]], [1, [0.7804517062622577, 1.0]], [1, [2.850530930856384, 1.0]], [1, [0.22365927532380925, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.95084168]
bas 1, expnt(s) = [7616.81858113]
bas 2, expnt(s) = [3617.60027638]
bas 3, expnt(s) = [1581.9480142]
bas 4, expnt(s) = [438.38391858]
bas 5, expnt(s) = [207.4909596]
bas 6, expnt(s) = [97.13747422]
bas 7, expnt(s) = [34.92885536]
bas 8, expnt(s) = [7.98523676]
bas 9, expnt(s) = [0.66154096]
bas 10, expnt(s) = [3.15495838]
bas 11, expnt(s) = [0.23830104]
bas 12, expnt(s) = [1362.880691]
bas 13, expnt(s) = [663.80565152]
bas 14, expnt(s) = [296.53611571]
bas 15, expnt(s) = [310.22832856]
bas 16, expnt(s) = [63.51619096]
bas 17, expnt(s) = [7.49128134]
bas 18, expnt(s) = [20.76072147]
bas 19, expnt(s) = [0.78045171]
bas 20, expnt(s) = [2.85053093]
bas 21, expnt(s) = [0.22365928]
CPU time:       606.77
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61829508e+04 5.20030681e+03 7.61681858e+03 2.05989571e+03
 3.61760028e+03 1.17850236e+03 1.58194801e+03 6.33737170e+02
 4.38383919e+02 2.42050501e+02 2.07490960e+02 1.38122493e+02
 9.71374742e+01 7.81727031e+01 3.49288554e+01 3.62997212e+01
 7.98523676e+00 1.20013713e+01 6.61540960e-01 1.85324390e+00
 3.15495838e+00 5.98081336e+00 2.38301039e-01 8.61706712e-01
 1.36288069e+03 2.41577616e+04 6.63805652e+02 9.82959387e+03
 2.96536116e+02 3.58989202e+03 3.10228329e+02 3.79827328e+03
 6.35161910e+01 5.23106299e+02 7.49128134e+00 3.61559292e+01
 2.07607215e+01 1.29281816e+02 7.80451706e-01 2.14001558e+00
 2.85053093e+00 1.08054184e+01 2.23659275e-01 4.48712362e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.99349659611122
cond(S) = 106418.83533741417
E1 = -729.5493303476209  E_coul = 203.17904222898463
init E= -526.370288118636
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555693711585027  LUMO = 0.994022466418537
  mo_energy =
[-1.18336589e+02 -1.22059360e+01 -9.44687713e+00 -9.44687713e+00
 -9.44687713e+00 -1.24012090e+00 -5.55693712e-01 -5.55693712e-01
 -5.55693712e-01  9.94022466e-01  1.04082276e+00  1.04082276e+00
  1.04082276e+00  7.48570656e+00  7.48570656e+00  7.48570656e+00
  1.21734782e+01  3.43975253e+01  3.43975253e+01  3.43975253e+01
  9.47370147e+01  1.32952906e+02  1.32952906e+02  1.32952906e+02
  4.02215230e+02  4.88143225e+02  4.88143225e+02  4.88143225e+02
  1.19789332e+03  1.33211922e+03  1.33211922e+03  1.33211922e+03
  3.01470550e+03  3.01470550e+03  3.01470550e+03  3.48921691e+03
  6.62708591e+03  6.62708591e+03  6.62708591e+03  9.92096209e+03
  2.62443202e+04  7.69318523e+04]
E1 = -727.8600843007376  E_coul = 201.1030941429302
cycle= 1 E= -526.756990157807  delta_E= -0.387  |g|= 0.186  |ddm|= 0.311
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.584204
diis-c [-0.34129486  1.        ]
  HOMO = -0.590699891358181  LUMO = 0.966145182209354
  mo_energy =
[-1.18644620e+02 -1.23439646e+01 -9.59572432e+00 -9.59572432e+00
 -9.59572432e+00 -1.27958824e+00 -5.90699891e-01 -5.90699891e-01
 -5.90699891e-01  9.66145182e-01  1.01622254e+00  1.01622254e+00
  1.01622254e+00  7.39358469e+00  7.39358469e+00  7.39358469e+00
  1.20652786e+01  3.42414557e+01  3.42414557e+01  3.42414557e+01
  9.45304645e+01  1.32722552e+02  1.32722552e+02  1.32722552e+02
  4.01926182e+02  4.87837337e+02  4.87837337e+02  4.87837337e+02
  1.19751920e+03  1.33175726e+03  1.33175726e+03  1.33175726e+03
  3.01427784e+03  3.01427784e+03  3.01427784e+03  3.48872297e+03
  6.62654565e+03  6.62654565e+03  6.62654565e+03  9.92035293e+03
  2.62436143e+04  7.69310548e+04]
E1 = -728.434322006366  E_coul = 201.67660968413125
cycle= 2 E= -526.757712322235  delta_E= -0.000722  |g|= 0.0377  |ddm|= 0.0533
    CPU time for cycle= 2      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0766376
diis-c [-0.00383984  0.07203502  0.92796498]
  HOMO = -0.581480928709298  LUMO = 0.974271322693683
  mo_energy =
[-1.18576129e+02 -1.23054701e+01 -9.55555591e+00 -9.55555591e+00
 -9.55555591e+00 -1.26854156e+00 -5.81480929e-01 -5.81480929e-01
 -5.81480929e-01  9.74271323e-01  1.02308913e+00  1.02308913e+00
  1.02308913e+00  7.41788109e+00  7.41788109e+00  7.41788109e+00
  1.20951810e+01  3.42823785e+01  3.42823785e+01  3.42823785e+01
  9.45843134e+01  1.32779393e+02  1.32779393e+02  1.32779393e+02
  4.01992232e+02  4.87904952e+02  4.87904952e+02  4.87904952e+02
  1.19759089e+03  1.33182895e+03  1.33182895e+03  1.33182895e+03
  3.01435184e+03  3.01435184e+03  3.01435184e+03  3.48879798e+03
  6.62662143e+03  6.62662143e+03  6.62662143e+03  9.92042945e+03
  2.62436915e+04  7.69311323e+04]
E1 = -728.2822949671606  E_coul = 201.52452393525041
cycle= 3 E= -526.75777103191  delta_E= -5.87e-05  |g|= 0.00679  |ddm|= 0.0165
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0143672
diis-c [-7.55916652e-07 -1.20754650e-03  1.53786612e-01  8.47420935e-01]
  HOMO = -0.583083874281975  LUMO = 0.97296010600446
  mo_energy =
[-1.18586868e+02 -1.23117114e+01 -9.56216497e+00 -9.56216497e+00
 -9.56216497e+00 -1.27035136e+00 -5.83083874e-01 -5.83083874e-01
 -5.83083874e-01  9.72960106e-01  1.02192073e+00  1.02192073e+00
  1.02192073e+00  7.41378904e+00  7.41378904e+00  7.41378904e+00
  1.20902985e+01  3.42756897e+01  3.42756897e+01  3.42756897e+01
  9.45757670e+01  1.32770358e+02  1.32770358e+02  1.32770358e+02
  4.01981861e+02  4.87894347e+02  4.87894347e+02  4.87894347e+02
  1.19757962e+03  1.33181771e+03  1.33181771e+03  1.33181771e+03
  3.01434018e+03  3.01434018e+03  3.01434018e+03  3.48878608e+03
  6.62660935e+03  6.62660935e+03  6.62660935e+03  9.92041717e+03
  2.62436790e+04  7.69311197e+04]
E1 = -728.3067706187929  E_coul = 201.54899737037798
cycle= 4 E= -526.757773248415  delta_E= -2.22e-06  |g|= 0.000105  |ddm|= 0.00242
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000114499
diis-c [-4.56010670e-09  7.94466941e-05 -1.17674190e-02 -6.94887030e-02
  1.08117668e+00]
  HOMO = -0.583065526718914  LUMO = 0.97299518149593
  mo_energy =
[-1.18586822e+02 -1.23116442e+01 -9.56211164e+00 -9.56211164e+00
 -9.56211164e+00 -1.27030857e+00 -5.83065527e-01 -5.83065527e-01
 -5.83065527e-01  9.72995181e-01  1.02193693e+00  1.02193693e+00
  1.02193693e+00  7.41383192e+00  7.41383192e+00  7.41383192e+00
  1.20903598e+01  3.42757413e+01  3.42757413e+01  3.42757413e+01
  9.45758243e+01  1.32770410e+02  1.32770410e+02  1.32770410e+02
  4.01981908e+02  4.87894393e+02  4.87894393e+02  4.87894393e+02
  1.19757966e+03  1.33181775e+03  1.33181775e+03  1.33181775e+03
  3.01434021e+03  3.01434021e+03  3.01434021e+03  3.48878610e+03
  6.62660937e+03  6.62660937e+03  6.62660937e+03  9.92041717e+03
  2.62436790e+04  7.69311197e+04]
E1 = -728.30654265715  E_coul = 201.54876940673066
cycle= 5 E= -526.757773250419  delta_E= -2e-09  |g|= 2.1e-05  |ddm|= 0.000171
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.95424e-05
diis-c [-8.68576409e-11  1.26730345e-05 -1.85177833e-03 -1.28299328e-02
  3.07741514e-02  9.83894887e-01]
  HOMO = -0.583073160725386  LUMO = 0.972991338543934
  mo_energy =
[-1.18586853e+02 -1.23116671e+01 -9.56213661e+00 -9.56213661e+00
 -9.56213661e+00 -1.27031450e+00 -5.83073161e-01 -5.83073161e-01
 -5.83073161e-01  9.72991339e-01  1.02193183e+00  1.02193183e+00
  1.02193183e+00  7.41381482e+00  7.41381482e+00  7.41381482e+00
  1.20903415e+01  3.42757170e+01  3.42757170e+01  3.42757170e+01
  9.45757968e+01  1.32770382e+02  1.32770382e+02  1.32770382e+02
  4.01981877e+02  4.87894362e+02  4.87894362e+02  4.87894362e+02
  1.19757963e+03  1.33181772e+03  1.33181772e+03  1.33181772e+03
  3.01434018e+03  3.01434018e+03  3.01434018e+03  3.48878606e+03
  6.62660933e+03  6.62660933e+03  6.62660933e+03  9.92041714e+03
  2.62436789e+04  7.69311196e+04]
E1 = -728.306625016182  E_coul = 201.54885176570036
cycle= 6 E= -526.757773250482  delta_E= -6.24e-11  |g|= 1.81e-06  |ddm|= 1.99e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.306625016182  E_coul = 201.54885176570036
  HOMO = -0.583073072008075  LUMO = 0.972991768429835
  mo_energy =
[-1.18586852e+02 -1.23116666e+01 -9.56213616e+00 -9.56213616e+00
 -9.56213616e+00 -1.27031400e+00 -5.83073072e-01 -5.83073072e-01
 -5.83073072e-01  9.72991768e-01  1.02193195e+00  1.02193195e+00
  1.02193195e+00  7.41381513e+00  7.41381513e+00  7.41381513e+00
  1.20903420e+01  3.42757175e+01  3.42757175e+01  3.42757175e+01
  9.45757975e+01  1.32770382e+02  1.32770382e+02  1.32770382e+02
  4.01981878e+02  4.87894362e+02  4.87894362e+02  4.87894362e+02
  1.19757963e+03  1.33181772e+03  1.33181772e+03  1.33181772e+03
  3.01434018e+03  3.01434018e+03  3.01434018e+03  3.48878606e+03
  6.62660933e+03  6.62660933e+03  6.62660933e+03  9.92041714e+03
  2.62436789e+04  7.69311196e+04]
E1 = -728.3066225864407  E_coul = 201.54884933595787
Extra cycle  E= -526.757773250483  delta_E= -1.14e-12  |g|= 3.76e-07  |ddm|= 3.14e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 106418.83533741417
E1 = -728.3066225864407  E_coul = 201.54884933595787
init E= -526.757773250483
    CPU time for initialize scf      0.81 sec, wall time      0.33 sec
  HOMO = -0.583073132827476  LUMO = 0.972991789799225
  mo_energy =
[-1.18586853e+02 -1.23116668e+01 -9.56213636e+00 -9.56213636e+00
 -9.56213636e+00 -1.27031399e+00 -5.83073133e-01 -5.83073133e-01
 -5.83073133e-01  9.72991790e-01  1.02193192e+00  1.02193192e+00
  1.02193192e+00  7.41381501e+00  7.41381501e+00  7.41381501e+00
  1.20903419e+01  3.42757173e+01  3.42757173e+01  3.42757173e+01
  9.45757972e+01  1.32770382e+02  1.32770382e+02  1.32770382e+02
  4.01981878e+02  4.87894362e+02  4.87894362e+02  4.87894362e+02
  1.19757963e+03  1.33181772e+03  1.33181772e+03  1.33181772e+03
  3.01434018e+03  3.01434018e+03  3.01434018e+03  3.48878606e+03
  6.62660933e+03  6.62660933e+03  6.62660933e+03  9.92041714e+03
  2.62436789e+04  7.69311196e+04]
E1 = -728.3066231405915  E_coul = 201.54884989010728
cycle= 1 E= -526.757773250484  delta_E= -1.36e-12  |g|= 8.46e-08  |ddm|= 5.87e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.3066231405915  E_coul = 201.54884989010728
  HOMO = -0.58307312508361  LUMO = 0.972991811328809
  mo_energy =
[-1.18586853e+02 -1.23116667e+01 -9.56213632e+00 -9.56213632e+00
 -9.56213632e+00 -1.27031396e+00 -5.83073125e-01 -5.83073125e-01
 -5.83073125e-01  9.72991811e-01  1.02193193e+00  1.02193193e+00
  1.02193193e+00  7.41381503e+00  7.41381503e+00  7.41381503e+00
  1.20903419e+01  3.42757173e+01  3.42757173e+01  3.42757173e+01
  9.45757973e+01  1.32770382e+02  1.32770382e+02  1.32770382e+02
  4.01981878e+02  4.87894362e+02  4.87894362e+02  4.87894362e+02
  1.19757963e+03  1.33181772e+03  1.33181772e+03  1.33181772e+03
  3.01434018e+03  3.01434018e+03  3.01434018e+03  3.48878606e+03
  6.62660933e+03  6.62660933e+03  6.62660933e+03  9.92041714e+03
  2.62436789e+04  7.69311196e+04]
E1 = -728.3066229583417  E_coul = 201.54884970785798
Extra cycle  E= -526.757773250484  delta_E= 4.55e-13  |g|= 1.8e-08  |ddm|= 1.33e-07
    CPU time for scf_cycle      0.92 sec, wall time      0.44 sec
exp = [2.61829508e+04 7.61681858e+03 3.61760028e+03 1.58194801e+03
 4.38383919e+02 2.07490960e+02 9.71374742e+01 3.49288554e+01
 7.98523676e+00 6.61540960e-01 3.15495838e+00 2.38301039e-01
 1.36288069e+03 6.63805652e+02 2.96536116e+02 3.10228329e+02
 6.35161910e+01 7.49128134e+00 2.07607215e+01 7.80451706e-01
 2.85053093e+00 2.23659275e-01]
grad_E = [-1.44330106e-06  2.55834233e-06 -2.25644123e-06  5.23395692e-05
 -2.22306593e-04  1.00307622e-04  1.51183286e-04 -3.04572691e-04
 -1.06562852e-04  3.60016442e-03  5.09466879e-04 -9.23182174e-03
 -6.29352269e-07  3.42677581e-06  1.49862020e-05  1.27318322e-05
  2.67082447e-04  2.22078420e-03 -8.54716364e-04 -1.35971505e-03
 -3.01545753e-03  3.41119651e-03]
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:30 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.9633827        1
[INPUT] 0    0    [1    /1   ]  7616.78857943        1
[INPUT] 0    0    [1    /1   ]  3617.61078198        1
[INPUT] 0    0    [1    /1   ]  1581.26871999        1
[INPUT] 0    0    [1    /1   ]  440.833935002        1
[INPUT] 0    0    [1    /1   ]  212.003422327        1
[INPUT] 0    0    [1    /1   ]  97.9057015538        1
[INPUT] 0    0    [1    /1   ]  35.0749092978        1
[INPUT] 0    0    [1    /1   ]  7.99458770705        1
[INPUT] 0    0    [1    /1   ]  0.658938925746       1
[INPUT] 0    0    [1    /1   ]  3.15914050319        1
[INPUT] 0    0    [1    /1   ]  0.239136288907       1
[INPUT] 1    0    [1    /1   ]  1362.88483548        1
[INPUT] 1    0    [1    /1   ]  663.765754008        1
[INPUT] 1    0    [1    /1   ]  296.348268689        1
[INPUT] 1    0    [1    /1   ]  310.066466263        1
[INPUT] 1    0    [1    /1   ]  63.6054540729        1
[INPUT] 1    0    [1    /1   ]  7.467574107          1
[INPUT] 1    0    [1    /1   ]  20.7486338967        1
[INPUT] 1    0    [1    /1   ]  0.780019811401       1
[INPUT] 1    0    [1    /1   ]  2.84762797195        1
[INPUT] 1    0    [1    /1   ]  0.223543446705       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.963382658265, 1.0]], [0, [7616.788579429445, 1.0]], [0, [3617.610781981739, 1.0]], [0, [1581.2687199890156, 1.0]], [0, [440.8339350018493, 1.0]], [0, [212.00342232702104, 1.0]], [0, [97.90570155377229, 1.0]], [0, [35.07490929783429, 1.0]], [0, [7.994587707048777, 1.0]], [0, [0.6589389257463615, 1.0]], [0, [3.159140503193893, 1.0]], [0, [0.23913628890664373, 1.0]], [1, [1362.8848354756567, 1.0]], [1, [663.7657540082467, 1.0]], [1, [296.3482686892552, 1.0]], [1, [310.0664662629358, 1.0]], [1, [63.60545407287087, 1.0]], [1, [7.467574107000826, 1.0]], [1, [20.748633896676353, 1.0]], [1, [0.7800198114009042, 1.0]], [1, [2.8476279719515944, 1.0]], [1, [0.22354344670534324, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.96338266]
bas 1, expnt(s) = [7616.78857943]
bas 2, expnt(s) = [3617.61078198]
bas 3, expnt(s) = [1581.26871999]
bas 4, expnt(s) = [440.833935]
bas 5, expnt(s) = [212.00342233]
bas 6, expnt(s) = [97.90570155]
bas 7, expnt(s) = [35.0749093]
bas 8, expnt(s) = [7.99458771]
bas 9, expnt(s) = [0.65893893]
bas 10, expnt(s) = [3.1591405]
bas 11, expnt(s) = [0.23913629]
bas 12, expnt(s) = [1362.88483548]
bas 13, expnt(s) = [663.76575401]
bas 14, expnt(s) = [296.34826869]
bas 15, expnt(s) = [310.06646626]
bas 16, expnt(s) = [63.60545407]
bas 17, expnt(s) = [7.46757411]
bas 18, expnt(s) = [20.7486339]
bas 19, expnt(s) = [0.78001981]
bas 20, expnt(s) = [2.84762797]
bas 21, expnt(s) = [0.22354345]
CPU time:       612.33
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61829634e+04 5.20030868e+03 7.61678858e+03 2.05988962e+03
 3.61761078e+03 1.17850493e+03 1.58126872e+03 6.33533062e+02
 4.40833935e+02 2.43064362e+02 2.12003422e+02 1.40369314e+02
 9.79057016e+01 7.86359272e+01 3.50749093e+01 3.64135014e+01
 7.99458771e+00 1.20119102e+01 6.58938926e-01 1.84777419e+00
 3.15914050e+00 5.98675838e+00 2.39136289e-01 8.63970946e-01
 1.36288484e+03 2.41578534e+04 6.63765754e+02 9.82885538e+03
 2.96348269e+02 3.58704963e+03 3.10066466e+02 3.79579625e+03
 6.36054541e+01 5.24025401e+02 7.46757411e+00 3.60129600e+01
 2.07486339e+01 1.29187733e+02 7.80019811e-01 2.13853535e+00
 2.84762797e+00 1.07916650e+01 2.23543447e-01 4.48421907e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993518459723898
cond(S) = 105940.28666478123
E1 = -729.5484013660852  E_coul = 203.17807889802532
init E= -526.37032246806
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555720407320975  LUMO = 0.993990479490599
  mo_energy =
[-1.18336671e+02 -1.22060330e+01 -9.44695165e+00 -9.44695165e+00
 -9.44695165e+00 -1.24014425e+00 -5.55720407e-01 -5.55720407e-01
 -5.55720407e-01  9.93990479e-01  1.04005203e+00  1.04005203e+00
  1.04005203e+00  7.47189204e+00  7.47189204e+00  7.47189204e+00
  1.21934553e+01  3.43205659e+01  3.43205659e+01  3.43205659e+01
  9.54057454e+01  1.32905129e+02  1.32905129e+02  1.32905129e+02
  4.06821815e+02  4.88140068e+02  4.88140068e+02  4.88140068e+02
  1.21222287e+03  1.33180365e+03  1.33180365e+03  1.33180365e+03
  3.01390627e+03  3.01390627e+03  3.01390627e+03  3.51351772e+03
  6.62595584e+03  6.62595584e+03  6.62595584e+03  9.94797243e+03
  2.62707635e+04  7.69566599e+04]
E1 = -727.8620612021992  E_coul = 201.10501723004316
cycle= 1 E= -526.757043972156  delta_E= -0.387  |g|= 0.186  |ddm|= 0.307
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.583847
diis-c [-0.34087765  1.        ]
  HOMO = -0.590629946069473  LUMO = 0.966175631666861
  mo_energy =
[-1.18644491e+02 -1.23438367e+01 -9.59558414e+00 -9.59558414e+00
 -9.59558414e+00 -1.27954036e+00 -5.90629946e-01 -5.90629946e-01
 -5.90629946e-01  9.66175632e-01  1.01552681e+00  1.01552681e+00
  1.01552681e+00  7.38009036e+00  7.38009036e+00  7.38009036e+00
  1.20854025e+01  3.41648056e+01  3.41648056e+01  3.41648056e+01
  9.51987560e+01  1.32674906e+02  1.32674906e+02  1.32674906e+02
  4.06531897e+02  4.87834425e+02  4.87834425e+02  4.87834425e+02
  1.21184801e+03  1.33144198e+03  1.33144198e+03  1.33144198e+03
  3.01347891e+03  3.01347891e+03  3.01347891e+03  3.51302394e+03
  6.62541590e+03  6.62541590e+03  6.62541590e+03  9.94736373e+03
  2.62700580e+04  7.69558629e+04]
E1 = -728.4357468541033  E_coul = 201.67798228073443
cycle= 2 E= -526.757764573369  delta_E= -0.000721  |g|= 0.0376  |ddm|= 0.0534
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0765966
diis-c [-0.00383068  0.07212285  0.92787715]
  HOMO = -0.581422954041462  LUMO = 0.974279172719668
  mo_energy =
[-1.18576053e+02 -1.23053841e+01 -9.55545874e+00 -9.55545874e+00
 -9.55545874e+00 -1.26851456e+00 -5.81422954e-01 -5.81422954e-01
 -5.81422954e-01  9.74279173e-01  1.02237805e+00  1.02237805e+00
  1.02237805e+00  7.40432835e+00  7.40432835e+00  7.40432835e+00
  1.21153107e+01  3.42056649e+01  3.42056649e+01  3.42056649e+01
  9.52526805e+01  1.32731710e+02  1.32731710e+02  1.32731710e+02
  4.06598007e+02  4.87901988e+02  4.87901988e+02  4.87901988e+02
  1.21191970e+03  1.33151362e+03  1.33151362e+03  1.33151362e+03
  3.01355284e+03  3.01355284e+03  3.01355284e+03  3.51309890e+03
  6.62549162e+03  6.62549162e+03  6.62549162e+03  9.94744019e+03
  2.62701351e+04  7.69559403e+04]
E1 = -728.2839341827213  E_coul = 201.52611105152818
cycle= 3 E= -526.757823131193  delta_E= -5.86e-05  |g|= 0.00677  |ddm|= 0.0164
    CPU time for cycle= 3      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.0143375
diis-c [-7.44473368e-07 -1.20555296e-03  1.53585270e-01  8.47620283e-01]
  HOMO = -0.58302251621899  LUMO = 0.9729697464278
  mo_energy =
[-1.18586772e+02 -1.23116138e+01 -9.56205525e+00 -9.56205525e+00
 -9.56205525e+00 -1.27032301e+00 -5.83022516e-01 -5.83022516e-01
 -5.83022516e-01  9.72969746e-01  1.02121273e+00  1.02121273e+00
  1.02121273e+00  7.40024890e+00  7.40024890e+00  7.40024890e+00
  1.21104316e+01  3.41989921e+01  3.41989921e+01  3.41989921e+01
  9.52441321e+01  1.32722691e+02  1.32722691e+02  1.32722691e+02
  4.06587638e+02  4.87891402e+02  4.87891402e+02  4.87891402e+02
  1.21190845e+03  1.33150240e+03  1.33150240e+03  1.33150240e+03
  3.01354121e+03  3.01354121e+03  3.01354121e+03  3.51308702e+03
  6.62547957e+03  6.62547957e+03  6.62547957e+03  9.94742794e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3083645345109  E_coul = 201.55053919733285
cycle= 4 E= -526.757825337178  delta_E= -2.21e-06  |g|= 0.000102  |ddm|= 0.00242
    CPU time for cycle= 4      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=0.000111408
diis-c [-4.46597350e-09  7.70650715e-05 -1.14297722e-02 -6.75407769e-02
  1.07889348e+00]
  HOMO = -0.583003709596025  LUMO = 0.9730044563762
  mo_energy =
[-1.18586724e+02 -1.23115456e+01 -9.56200066e+00 -9.56200066e+00
 -9.56200066e+00 -1.27028051e+00 -5.83003710e-01 -5.83003710e-01
 -5.83003710e-01  9.73004456e-01  1.02122914e+00  1.02122914e+00
  1.02122914e+00  7.40029261e+00  7.40029261e+00  7.40029261e+00
  1.21104936e+01  3.41990449e+01  3.41990449e+01  3.41990449e+01
  9.52441906e+01  1.32722744e+02  1.32722744e+02  1.32722744e+02
  4.06587686e+02  4.87891450e+02  4.87891450e+02  4.87891450e+02
  1.21190848e+03  1.33150244e+03  1.33150244e+03  1.33150244e+03
  3.01354124e+03  3.01354124e+03  3.01354124e+03  3.51308704e+03
  6.62547958e+03  6.62547958e+03  6.62547958e+03  9.94742794e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3081340714793  E_coul = 201.55030873243322
cycle= 5 E= -526.757825339046  delta_E= -1.87e-09  |g|= 2.08e-05  |ddm|= 0.000165
    CPU time for cycle= 5      0.03 sec, wall time      0.03 sec
diis-norm(errvec)=3.92707e-05
diis-c [-8.36066059e-11  1.26020006e-05 -1.84359924e-03 -1.27929671e-02
  3.37570852e-02  9.80866879e-01]
  HOMO = -0.583011263173827  LUMO = 0.973000603516125
  mo_energy =
[-1.18586755e+02 -1.23115684e+01 -9.56202539e+00 -9.56202539e+00
 -9.56202539e+00 -1.27028644e+00 -5.83011263e-01 -5.83011263e-01
 -5.83011263e-01  9.73000604e-01  1.02122409e+00  1.02122409e+00
  1.02122409e+00  7.40027569e+00  7.40027569e+00  7.40027569e+00
  1.21104754e+01  3.41990208e+01  3.41990208e+01  3.41990208e+01
  9.52441634e+01  1.32722716e+02  1.32722716e+02  1.32722716e+02
  4.06587656e+02  4.87891419e+02  4.87891419e+02  4.87891419e+02
  1.21190845e+03  1.33150241e+03  1.33150241e+03  1.33150241e+03
  3.01354120e+03  3.01354120e+03  3.01354120e+03  3.51308701e+03
  6.62547955e+03  6.62547955e+03  6.62547955e+03  9.94742791e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3082157917469  E_coul = 201.55039045264
cycle= 6 E= -526.757825339107  delta_E= -6.07e-11  |g|= 1.8e-06  |ddm|= 1.93e-05
    CPU time for cycle= 6      0.03 sec, wall time      0.03 sec
E1 = -728.3082157917469  E_coul = 201.55039045264
  HOMO = -0.583011202772175  LUMO = 0.973001010969245
  mo_energy =
[-1.18586755e+02 -1.23115680e+01 -9.56202505e+00 -9.56202505e+00
 -9.56202505e+00 -1.27028597e+00 -5.83011203e-01 -5.83011203e-01
 -5.83011203e-01  9.73001011e-01  1.02122419e+00  1.02122419e+00
  1.02122419e+00  7.40027593e+00  7.40027593e+00  7.40027593e+00
  1.21104758e+01  3.41990212e+01  3.41990212e+01  3.41990212e+01
  9.52441639e+01  1.32722717e+02  1.32722717e+02  1.32722717e+02
  4.06587656e+02  4.87891419e+02  4.87891419e+02  4.87891419e+02
  1.21190845e+03  1.33150241e+03  1.33150241e+03  1.33150241e+03
  3.01354120e+03  3.01354120e+03  3.01354120e+03  3.51308701e+03
  6.62547955e+03  6.62547955e+03  6.62547955e+03  9.94742791e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3082137111253  E_coul = 201.55038837201846
Extra cycle  E= -526.757825339107  delta_E=    0  |g|= 3.73e-07  |ddm|= 3.15e-06
    CPU time for scf_cycle      0.26 sec, wall time      0.23 sec
exp = [2.61829634e+04 7.61678858e+03 3.61761078e+03 1.58126872e+03
 4.40833935e+02 2.12003422e+02 9.79057016e+01 3.50749093e+01
 7.99458771e+00 6.58938926e-01 3.15914050e+00 2.39136289e-01
 1.36288484e+03 6.63765754e+02 2.96348269e+02 3.10066466e+02
 6.36054541e+01 7.46757411e+00 2.07486339e+01 7.80019811e-01
 2.84762797e+00 2.23543447e-01]
E = -526.7578253391068
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:31 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.9633827        1
[INPUT] 0    0    [1    /1   ]  7616.78857943        1
[INPUT] 0    0    [1    /1   ]  3617.61078198        1
[INPUT] 0    0    [1    /1   ]  1581.26871999        1
[INPUT] 0    0    [1    /1   ]  440.833935002        1
[INPUT] 0    0    [1    /1   ]  212.003422327        1
[INPUT] 0    0    [1    /1   ]  97.9057015538        1
[INPUT] 0    0    [1    /1   ]  35.0749092978        1
[INPUT] 0    0    [1    /1   ]  7.99458770705        1
[INPUT] 0    0    [1    /1   ]  0.658938925746       1
[INPUT] 0    0    [1    /1   ]  3.15914050319        1
[INPUT] 0    0    [1    /1   ]  0.239136288907       1
[INPUT] 1    0    [1    /1   ]  1362.88483548        1
[INPUT] 1    0    [1    /1   ]  663.765754008        1
[INPUT] 1    0    [1    /1   ]  296.348268689        1
[INPUT] 1    0    [1    /1   ]  310.066466263        1
[INPUT] 1    0    [1    /1   ]  63.6054540729        1
[INPUT] 1    0    [1    /1   ]  7.467574107          1
[INPUT] 1    0    [1    /1   ]  20.7486338967        1
[INPUT] 1    0    [1    /1   ]  0.780019811401       1
[INPUT] 1    0    [1    /1   ]  2.84762797195        1
[INPUT] 1    0    [1    /1   ]  0.223543446705       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.963382658265, 1.0]], [0, [7616.788579429445, 1.0]], [0, [3617.610781981739, 1.0]], [0, [1581.2687199890156, 1.0]], [0, [440.8339350018493, 1.0]], [0, [212.00342232702104, 1.0]], [0, [97.90570155377229, 1.0]], [0, [35.07490929783429, 1.0]], [0, [7.994587707048777, 1.0]], [0, [0.6589389257463615, 1.0]], [0, [3.159140503193893, 1.0]], [0, [0.23913628890664373, 1.0]], [1, [1362.8848354756567, 1.0]], [1, [663.7657540082467, 1.0]], [1, [296.3482686892552, 1.0]], [1, [310.0664662629358, 1.0]], [1, [63.60545407287087, 1.0]], [1, [7.467574107000826, 1.0]], [1, [20.748633896676353, 1.0]], [1, [0.7800198114009042, 1.0]], [1, [2.8476279719515944, 1.0]], [1, [0.22354344670534324, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.96338266]
bas 1, expnt(s) = [7616.78857943]
bas 2, expnt(s) = [3617.61078198]
bas 3, expnt(s) = [1581.26871999]
bas 4, expnt(s) = [440.833935]
bas 5, expnt(s) = [212.00342233]
bas 6, expnt(s) = [97.90570155]
bas 7, expnt(s) = [35.0749093]
bas 8, expnt(s) = [7.99458771]
bas 9, expnt(s) = [0.65893893]
bas 10, expnt(s) = [3.1591405]
bas 11, expnt(s) = [0.23913629]
bas 12, expnt(s) = [1362.88483548]
bas 13, expnt(s) = [663.76575401]
bas 14, expnt(s) = [296.34826869]
bas 15, expnt(s) = [310.06646626]
bas 16, expnt(s) = [63.60545407]
bas 17, expnt(s) = [7.46757411]
bas 18, expnt(s) = [20.7486339]
bas 19, expnt(s) = [0.78001981]
bas 20, expnt(s) = [2.84762797]
bas 21, expnt(s) = [0.22354345]
CPU time:       612.89
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61829634e+04 5.20030868e+03 7.61678858e+03 2.05988962e+03
 3.61761078e+03 1.17850493e+03 1.58126872e+03 6.33533062e+02
 4.40833935e+02 2.43064362e+02 2.12003422e+02 1.40369314e+02
 9.79057016e+01 7.86359272e+01 3.50749093e+01 3.64135014e+01
 7.99458771e+00 1.20119102e+01 6.58938926e-01 1.84777419e+00
 3.15914050e+00 5.98675838e+00 2.39136289e-01 8.63970946e-01
 1.36288484e+03 2.41578534e+04 6.63765754e+02 9.82885538e+03
 2.96348269e+02 3.58704963e+03 3.10066466e+02 3.79579625e+03
 6.36054541e+01 5.24025401e+02 7.46757411e+00 3.60129600e+01
 2.07486339e+01 1.29187733e+02 7.80019811e-01 2.13853535e+00
 2.84762797e+00 1.07916650e+01 2.23543447e-01 4.48421907e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993518459723898
cond(S) = 105940.28666478123
E1 = -729.5484013660852  E_coul = 203.17807889802532
init E= -526.37032246806
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555720407320975  LUMO = 0.993990479490599
  mo_energy =
[-1.18336671e+02 -1.22060330e+01 -9.44695165e+00 -9.44695165e+00
 -9.44695165e+00 -1.24014425e+00 -5.55720407e-01 -5.55720407e-01
 -5.55720407e-01  9.93990479e-01  1.04005203e+00  1.04005203e+00
  1.04005203e+00  7.47189204e+00  7.47189204e+00  7.47189204e+00
  1.21934553e+01  3.43205659e+01  3.43205659e+01  3.43205659e+01
  9.54057454e+01  1.32905129e+02  1.32905129e+02  1.32905129e+02
  4.06821815e+02  4.88140068e+02  4.88140068e+02  4.88140068e+02
  1.21222287e+03  1.33180365e+03  1.33180365e+03  1.33180365e+03
  3.01390627e+03  3.01390627e+03  3.01390627e+03  3.51351772e+03
  6.62595584e+03  6.62595584e+03  6.62595584e+03  9.94797243e+03
  2.62707635e+04  7.69566599e+04]
E1 = -727.8620612021992  E_coul = 201.10501723004316
cycle= 1 E= -526.757043972156  delta_E= -0.387  |g|= 0.186  |ddm|= 0.307
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.583847
diis-c [-0.34087765  1.        ]
  HOMO = -0.590629946069473  LUMO = 0.966175631666861
  mo_energy =
[-1.18644491e+02 -1.23438367e+01 -9.59558414e+00 -9.59558414e+00
 -9.59558414e+00 -1.27954036e+00 -5.90629946e-01 -5.90629946e-01
 -5.90629946e-01  9.66175632e-01  1.01552681e+00  1.01552681e+00
  1.01552681e+00  7.38009036e+00  7.38009036e+00  7.38009036e+00
  1.20854025e+01  3.41648056e+01  3.41648056e+01  3.41648056e+01
  9.51987560e+01  1.32674906e+02  1.32674906e+02  1.32674906e+02
  4.06531897e+02  4.87834425e+02  4.87834425e+02  4.87834425e+02
  1.21184801e+03  1.33144198e+03  1.33144198e+03  1.33144198e+03
  3.01347891e+03  3.01347891e+03  3.01347891e+03  3.51302394e+03
  6.62541590e+03  6.62541590e+03  6.62541590e+03  9.94736373e+03
  2.62700580e+04  7.69558629e+04]
E1 = -728.4357468541033  E_coul = 201.67798228073443
cycle= 2 E= -526.757764573369  delta_E= -0.000721  |g|= 0.0376  |ddm|= 0.0534
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0765966
diis-c [-0.00383068  0.07212285  0.92787715]
  HOMO = -0.581422954041462  LUMO = 0.974279172719668
  mo_energy =
[-1.18576053e+02 -1.23053841e+01 -9.55545874e+00 -9.55545874e+00
 -9.55545874e+00 -1.26851456e+00 -5.81422954e-01 -5.81422954e-01
 -5.81422954e-01  9.74279173e-01  1.02237805e+00  1.02237805e+00
  1.02237805e+00  7.40432835e+00  7.40432835e+00  7.40432835e+00
  1.21153107e+01  3.42056649e+01  3.42056649e+01  3.42056649e+01
  9.52526805e+01  1.32731710e+02  1.32731710e+02  1.32731710e+02
  4.06598007e+02  4.87901988e+02  4.87901988e+02  4.87901988e+02
  1.21191970e+03  1.33151362e+03  1.33151362e+03  1.33151362e+03
  3.01355284e+03  3.01355284e+03  3.01355284e+03  3.51309890e+03
  6.62549162e+03  6.62549162e+03  6.62549162e+03  9.94744019e+03
  2.62701351e+04  7.69559403e+04]
E1 = -728.2839341827213  E_coul = 201.52611105152818
cycle= 3 E= -526.757823131193  delta_E= -5.86e-05  |g|= 0.00677  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0143375
diis-c [-7.44473368e-07 -1.20555296e-03  1.53585270e-01  8.47620283e-01]
  HOMO = -0.58302251621899  LUMO = 0.9729697464278
  mo_energy =
[-1.18586772e+02 -1.23116138e+01 -9.56205525e+00 -9.56205525e+00
 -9.56205525e+00 -1.27032301e+00 -5.83022516e-01 -5.83022516e-01
 -5.83022516e-01  9.72969746e-01  1.02121273e+00  1.02121273e+00
  1.02121273e+00  7.40024890e+00  7.40024890e+00  7.40024890e+00
  1.21104316e+01  3.41989921e+01  3.41989921e+01  3.41989921e+01
  9.52441321e+01  1.32722691e+02  1.32722691e+02  1.32722691e+02
  4.06587638e+02  4.87891402e+02  4.87891402e+02  4.87891402e+02
  1.21190845e+03  1.33150240e+03  1.33150240e+03  1.33150240e+03
  3.01354121e+03  3.01354121e+03  3.01354121e+03  3.51308702e+03
  6.62547957e+03  6.62547957e+03  6.62547957e+03  9.94742794e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3083645345109  E_coul = 201.55053919733285
cycle= 4 E= -526.757825337178  delta_E= -2.21e-06  |g|= 0.000102  |ddm|= 0.00242
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000111408
diis-c [-4.46597350e-09  7.70650715e-05 -1.14297722e-02 -6.75407769e-02
  1.07889348e+00]
  HOMO = -0.583003709596025  LUMO = 0.9730044563762
  mo_energy =
[-1.18586724e+02 -1.23115456e+01 -9.56200066e+00 -9.56200066e+00
 -9.56200066e+00 -1.27028051e+00 -5.83003710e-01 -5.83003710e-01
 -5.83003710e-01  9.73004456e-01  1.02122914e+00  1.02122914e+00
  1.02122914e+00  7.40029261e+00  7.40029261e+00  7.40029261e+00
  1.21104936e+01  3.41990449e+01  3.41990449e+01  3.41990449e+01
  9.52441906e+01  1.32722744e+02  1.32722744e+02  1.32722744e+02
  4.06587686e+02  4.87891450e+02  4.87891450e+02  4.87891450e+02
  1.21190848e+03  1.33150244e+03  1.33150244e+03  1.33150244e+03
  3.01354124e+03  3.01354124e+03  3.01354124e+03  3.51308704e+03
  6.62547958e+03  6.62547958e+03  6.62547958e+03  9.94742794e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3081340714793  E_coul = 201.55030873243322
cycle= 5 E= -526.757825339046  delta_E= -1.87e-09  |g|= 2.08e-05  |ddm|= 0.000165
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.92707e-05
diis-c [-8.36066059e-11  1.26020006e-05 -1.84359924e-03 -1.27929671e-02
  3.37570852e-02  9.80866879e-01]
  HOMO = -0.583011263173827  LUMO = 0.973000603516125
  mo_energy =
[-1.18586755e+02 -1.23115684e+01 -9.56202539e+00 -9.56202539e+00
 -9.56202539e+00 -1.27028644e+00 -5.83011263e-01 -5.83011263e-01
 -5.83011263e-01  9.73000604e-01  1.02122409e+00  1.02122409e+00
  1.02122409e+00  7.40027569e+00  7.40027569e+00  7.40027569e+00
  1.21104754e+01  3.41990208e+01  3.41990208e+01  3.41990208e+01
  9.52441634e+01  1.32722716e+02  1.32722716e+02  1.32722716e+02
  4.06587656e+02  4.87891419e+02  4.87891419e+02  4.87891419e+02
  1.21190845e+03  1.33150241e+03  1.33150241e+03  1.33150241e+03
  3.01354120e+03  3.01354120e+03  3.01354120e+03  3.51308701e+03
  6.62547955e+03  6.62547955e+03  6.62547955e+03  9.94742791e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3082157917469  E_coul = 201.55039045264
cycle= 6 E= -526.757825339107  delta_E= -6.07e-11  |g|= 1.8e-06  |ddm|= 1.93e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.3082157917469  E_coul = 201.55039045264
  HOMO = -0.583011202772175  LUMO = 0.973001010969245
  mo_energy =
[-1.18586755e+02 -1.23115680e+01 -9.56202505e+00 -9.56202505e+00
 -9.56202505e+00 -1.27028597e+00 -5.83011203e-01 -5.83011203e-01
 -5.83011203e-01  9.73001011e-01  1.02122419e+00  1.02122419e+00
  1.02122419e+00  7.40027593e+00  7.40027593e+00  7.40027593e+00
  1.21104758e+01  3.41990212e+01  3.41990212e+01  3.41990212e+01
  9.52441639e+01  1.32722717e+02  1.32722717e+02  1.32722717e+02
  4.06587656e+02  4.87891419e+02  4.87891419e+02  4.87891419e+02
  1.21190845e+03  1.33150241e+03  1.33150241e+03  1.33150241e+03
  3.01354120e+03  3.01354120e+03  3.01354120e+03  3.51308701e+03
  6.62547955e+03  6.62547955e+03  6.62547955e+03  9.94742791e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3082137111253  E_coul = 201.55038837201846
Extra cycle  E= -526.757825339107  delta_E=    0  |g|= 3.73e-07  |ddm|= 3.15e-06
    CPU time for scf_cycle      0.24 sec, wall time      0.21 sec
Set gradient conv threshold to 3.16228e-05
cond(S) = 105940.28666478123
E1 = -728.3082137111253  E_coul = 201.55038837201846
init E= -526.757825339107
    CPU time for initialize scf      0.81 sec, wall time      0.32 sec
  HOMO = -0.583011256821788  LUMO = 0.973001038468486
  mo_energy =
[-1.18586755e+02 -1.23115681e+01 -9.56202522e+00 -9.56202522e+00
 -9.56202522e+00 -1.27028595e+00 -5.83011257e-01 -5.83011257e-01
 -5.83011257e-01  9.73001038e-01  1.02122416e+00  1.02122416e+00
  1.02122416e+00  7.40027582e+00  7.40027582e+00  7.40027582e+00
  1.21104757e+01  3.41990210e+01  3.41990210e+01  3.41990210e+01
  9.52441637e+01  1.32722716e+02  1.32722716e+02  1.32722716e+02
  4.06587656e+02  4.87891419e+02  4.87891419e+02  4.87891419e+02
  1.21190845e+03  1.33150241e+03  1.33150241e+03  1.33150241e+03
  3.01354120e+03  3.01354120e+03  3.01354120e+03  3.51308701e+03
  6.62547955e+03  6.62547955e+03  6.62547955e+03  9.94742791e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3082141662329  E_coul = 201.55038882712643
cycle= 1 E= -526.757825339106  delta_E= 3.41e-13  |g|= 8.24e-08  |ddm|= 5.97e-07
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
E1 = -728.3082141662329  E_coul = 201.55038882712643
  HOMO = -0.583011250950787  LUMO = 0.973001058461232
  mo_energy =
[-1.18586755e+02 -1.23115681e+01 -9.56202519e+00 -9.56202519e+00
 -9.56202519e+00 -1.27028593e+00 -5.83011251e-01 -5.83011251e-01
 -5.83011251e-01  9.73001058e-01  1.02122417e+00  1.02122417e+00
  1.02122417e+00  7.40027584e+00  7.40027584e+00  7.40027584e+00
  1.21104758e+01  3.41990210e+01  3.41990210e+01  3.41990210e+01
  9.52441638e+01  1.32722716e+02  1.32722716e+02  1.32722716e+02
  4.06587656e+02  4.87891419e+02  4.87891419e+02  4.87891419e+02
  1.21190845e+03  1.33150241e+03  1.33150241e+03  1.33150241e+03
  3.01354120e+03  3.01354120e+03  3.01354120e+03  3.51308701e+03
  6.62547955e+03  6.62547955e+03  6.62547955e+03  9.94742791e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3082140118048  E_coul = 201.55038867269633
Extra cycle  E= -526.757825339108  delta_E= -1.93e-12  |g|= 1.72e-08  |ddm|= 1.33e-07
    CPU time for scf_cycle      0.91 sec, wall time      0.42 sec
exp = [2.61829634e+04 7.61678858e+03 3.61761078e+03 1.58126872e+03
 4.40833935e+02 2.12003422e+02 9.79057016e+01 3.50749093e+01
 7.99458771e+00 6.58938926e-01 3.15914050e+00 2.39136289e-01
 1.36288484e+03 6.63765754e+02 2.96348269e+02 3.10066466e+02
 6.36054541e+01 7.46757411e+00 2.07486339e+01 7.80019811e-01
 2.84762797e+00 2.23543447e-01]
grad_E = [-1.44008068e-06  2.52899167e-06 -2.27108899e-06  5.15390765e-05
 -2.16608215e-04  1.07099557e-04  1.07980831e-04 -1.88151732e-04
 -7.07346169e-05  1.11318004e-03  1.97007194e-04 -2.94748767e-03
 -6.32927220e-07  3.37208074e-06  1.47019064e-05  1.24803021e-05
  2.57464575e-04  5.46976525e-04 -4.87166185e-04 -3.68243984e-04
 -1.01241535e-03  9.65192205e-04]
 message: Iteration limit reached
 success: False
  status: 9
     fun: -526.7578253391068
       x: [ 2.618e+04  7.617e+03 ...  2.848e+00  2.235e-01]
     nit: 100
     jac: [-1.440e-06  2.529e-06 ... -1.012e-03  9.652e-04]
    nfev: 108
    njev: 100
#INFO: **** input file is /project/6004934/nike/basis-set-optimization/018_Ar/input.py ****
#!/usr/bin/env python

import pyscf, re, os, numpy as np
from pyscfad import gto, scf

from scipy import optimize

SOLVER = 'SLSQP'
VERBOSITY = 9

def parse_basis_str(slug):
    numbers_and_letters = re.findall(r'[A-Za-z]+|\d+', slug)
    numbers_with_letters = [
        [int(numbers_and_letters[i]), numbers_and_letters[i+1].capitalize()]
        for i in range(0, len(numbers_and_letters), 2)
    ]
    return numbers_with_letters

def decaying_nums(n):
    return np.array([0.5 * (n - i) for i in range(n)])

def get_basis_substring(exponent, orbital):
    substring = f'''
    Ar  {orbital}
        {exponent}              1.0'''
    return substring

def get_basis_string(basis_str, exponents, exp_array=None):
    basis_set = parse_basis_str(basis_str)
    basis_nums = [num for [num, _] in basis_set]
    basis_cum_nums = np.cumsum(basis_nums)
    if exp_array is None:
        exp_array = np.zeros((exponents.size, 2))

    exp_array[np.where(exp_array[:, 1] == 0), 0] = exponents[np.where(exp_array[:, 1] == 0)]
    basis_string = ''.join([''.join([
        get_basis_substring(exp_array[i, 0], orbital) if j == 0 else
        get_basis_substring(exp_array[i + basis_cum_nums[j-1], 0], orbital)
        for i in range(num)
    ]) for j, [num, orbital] in enumerate(basis_set)])
    return basis_string

def atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    e = mf.kernel()
    print(f"exp = {exponents}")
    print(f"E = {e}")
    return e

def grad_atomic_energy(exponents, basis_str, exp_array=None):
    mol = gto.Mole()
    mol.atom = 'Ar 0 0 0'  # in Angstrom
    basis_string = get_basis_string(basis_str, exponents, exp_array)
    mol.basis = {'Ar': pyscf.gto.basis.parse(basis_string)}
    mol.verbose = VERBOSITY
    mol.build()
    mf = scf.RHF(mol)
    mf.kernel()
    jac = mf.energy_grad()
    print(f"exp = {exponents}")
    print(f"grad_E = {jac.exp}")
    grad_E = np.array(jac.exp)
    return grad_E

def minimize_energy(basis_str, exp_array=None):
    x0 = exp_array[:, 0]
    bnds = ((1e-9, None) for _ in range(exp_array.shape[0])) # Lower and upper bounds
    res = optimize.minimize(
        atomic_energy,
        x0,
        args=(basis_str, exp_array),
        method=SOLVER,
        jac=grad_atomic_energy,
        hess=None,
        hessp=None,
        bounds=bnds,
        tol=1e-10,
        callback=None,
        options={"maxfev": 10000, "ftol": 1e-10},
    )
    print(res)
    print(f"Final energy = {atomic_energy(res.x, basis_str)}")
    print(f"exp = [{','.join(['{:.16e}'.format(x) for x in res.x])}]")
    
number_of_s_exps = 12
number_of_p_exps = 10

exps = np.zeros((number_of_s_exps+number_of_p_exps,2))
#exps[:, 0] = decaying_nums(5)

exps=np.matrix('\
2.6182655855248540e+04 0 ;\
7.6175219156270523e+03 0 ;\
3.6173508674245704e+03 0 ;\
1.5978256930291025e+03 0 ;\
3.8285114947300525e+02 0 ;\
1.0812108340299351e+02 0 ;\
3.4805469069754821e+01 0 ;\
7.5852239053434207e+00 0 ;\
2.5852239053434207e+00 0 ;\
7.9531349055767473e-01 0 ;\
2.9531349055767473e-01 0 ;\
5.9531349055767473e-02 0 ;\
1.3627832062666114e+03 0 ;\
6.6474568098719237e+02 0 ;\
3.0096199157445062e+02 0 ;\
3.1404227399917028e+02 0 ;\
6.1622235863813884e+01 0 ;\
7.3298979484064786e+00 0 ;\
2.0239120129550937e+01 0 ;\
7.7207036457256351e-01 0 ;\
2.8088784348099196e+00 0 ;\
2.2257363203907735e-01 0  \
')
exps=np.array(exps)

basis =  str(number_of_s_exps)+"s"+str(number_of_p_exps)+"p"

minimize_energy(basis, exps)

if np.max(exps[:,1]) ==1:
    name = 'out_'+SOLVER+'-f_'+basis+'.job'
else:    
    name = 'out_'+SOLVER+'_'+basis+'.job'
os.rename("out_and_err."+os.environ["SLURM_JOB_ID"],name+'.'+os.environ["SLURM_JOB_ID"])
#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='cdr541.int.cedar.computecanada.ca', release='3.10.0-1160.80.1.el7.x86_64', version='#1 SMP Tue Nov 8 15:48:59 UTC 2022', machine='x86_64')  Threads 4
Python 3.10.2 (main, Feb  4 2022, 19:10:35) [GCC 9.3.0]
numpy 1.24.2  scipy 1.10.1
Date: Sun Mar 19 09:29:35 2023
PySCF version 2.1.1+ad
PySCF path  /localscratch/nike.62940555.0/ENV/lib/python3.10/site-packages/pyscf

[ENV] PYSCF_MAX_MEMORY 32000
[ENV] PYSCF_CONFIG_FILE /home/nike/.pyscfad_conf.py
[CONFIG] DEBUG = False
[CONFIG] MAX_MEMORY = 32000
[CONFIG] TMPDIR = /tmp
[CONFIG] UNIT = angstrom
[CONFIG] VERBOSE = 3
[CONFIG] conf_file = /home/nike/.pyscfad_conf.py
[CONFIG] pyscf_numpy_backend = jax
[CONFIG] pyscf_scipy_backend = jax
[CONFIG] pyscf_scipy_linalg_backend = pyscfad
[CONFIG] pyscfad = True
[CONFIG] pyscfad_ccsd_implicit_diff = True
[CONFIG] pyscfad_scf_implicit_diff = True
[INPUT] verbose = 9
[INPUT] max_memory = 32000 
[INPUT] num. atoms = 1
[INPUT] num. electrons = 18
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT] Symbol           X                Y                Z      unit          X                Y                Z       unit  Magmom
[INPUT]  1 Ar     0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr   0.0
[INPUT] ---------------- BASIS SET ---------------- 
[INPUT] l, kappa, [nprim/nctr], expnt,             c_1 c_2 ...
[INPUT] Ar
[INPUT] 0    0    [1    /1   ]  26182.9633827        1
[INPUT] 0    0    [1    /1   ]  7616.78857943        1
[INPUT] 0    0    [1    /1   ]  3617.61078198        1
[INPUT] 0    0    [1    /1   ]  1581.26871999        1
[INPUT] 0    0    [1    /1   ]  440.833935002        1
[INPUT] 0    0    [1    /1   ]  212.003422327        1
[INPUT] 0    0    [1    /1   ]  97.9057015538        1
[INPUT] 0    0    [1    /1   ]  35.0749092978        1
[INPUT] 0    0    [1    /1   ]  7.99458770705        1
[INPUT] 0    0    [1    /1   ]  0.658938925746       1
[INPUT] 0    0    [1    /1   ]  3.15914050319        1
[INPUT] 0    0    [1    /1   ]  0.239136288907       1
[INPUT] 1    0    [1    /1   ]  1362.88483548        1
[INPUT] 1    0    [1    /1   ]  663.765754008        1
[INPUT] 1    0    [1    /1   ]  296.348268689        1
[INPUT] 1    0    [1    /1   ]  310.066466263        1
[INPUT] 1    0    [1    /1   ]  63.6054540729        1
[INPUT] 1    0    [1    /1   ]  7.467574107          1
[INPUT] 1    0    [1    /1   ]  20.7486338967        1
[INPUT] 1    0    [1    /1   ]  0.780019811401       1
[INPUT] 1    0    [1    /1   ]  2.84762797195        1
[INPUT] 1    0    [1    /1   ]  0.223543446705       1

nuclear repulsion = 0
number of shells = 22
number of NR pGTOs = 42
number of NR cGTOs = 42
basis = {'Ar': [[0, [26182.963382658265, 1.0]], [0, [7616.788579429445, 1.0]], [0, [3617.610781981739, 1.0]], [0, [1581.2687199890156, 1.0]], [0, [440.8339350018493, 1.0]], [0, [212.00342232702104, 1.0]], [0, [97.90570155377229, 1.0]], [0, [35.07490929783429, 1.0]], [0, [7.994587707048777, 1.0]], [0, [0.6589389257463615, 1.0]], [0, [3.159140503193893, 1.0]], [0, [0.23913628890664373, 1.0]], [1, [1362.8848354756567, 1.0]], [1, [663.7657540082467, 1.0]], [1, [296.3482686892552, 1.0]], [1, [310.0664662629358, 1.0]], [1, [63.60545407287087, 1.0]], [1, [7.467574107000826, 1.0]], [1, [20.748633896676353, 1.0]], [1, [0.7800198114009042, 1.0]], [1, [2.8476279719515944, 1.0]], [1, [0.22354344670534324, 1.0]]]}
ecp = {}
bas 0, expnt(s) = [26182.96338266]
bas 1, expnt(s) = [7616.78857943]
bas 2, expnt(s) = [3617.61078198]
bas 3, expnt(s) = [1581.26871999]
bas 4, expnt(s) = [440.833935]
bas 5, expnt(s) = [212.00342233]
bas 6, expnt(s) = [97.90570155]
bas 7, expnt(s) = [35.0749093]
bas 8, expnt(s) = [7.99458771]
bas 9, expnt(s) = [0.65893893]
bas 10, expnt(s) = [3.1591405]
bas 11, expnt(s) = [0.23913629]
bas 12, expnt(s) = [1362.88483548]
bas 13, expnt(s) = [663.76575401]
bas 14, expnt(s) = [296.34826869]
bas 15, expnt(s) = [310.06646626]
bas 16, expnt(s) = [63.60545407]
bas 17, expnt(s) = [7.46757411]
bas 18, expnt(s) = [20.7486339]
bas 19, expnt(s) = [0.78001981]
bas 20, expnt(s) = [2.84762797]
bas 21, expnt(s) = [0.22354345]
CPU time:       618.44
arg.atm = [[18 20  1 23  0  0]]
arg.bas = [[ 0  0  1  1  0 24 25  0]
 [ 0  0  1  1  0 26 27  0]
 [ 0  0  1  1  0 28 29  0]
 [ 0  0  1  1  0 30 31  0]
 [ 0  0  1  1  0 32 33  0]
 [ 0  0  1  1  0 34 35  0]
 [ 0  0  1  1  0 36 37  0]
 [ 0  0  1  1  0 38 39  0]
 [ 0  0  1  1  0 40 41  0]
 [ 0  0  1  1  0 42 43  0]
 [ 0  0  1  1  0 44 45  0]
 [ 0  0  1  1  0 46 47  0]
 [ 0  1  1  1  0 48 49  0]
 [ 0  1  1  1  0 50 51  0]
 [ 0  1  1  1  0 52 53  0]
 [ 0  1  1  1  0 54 55  0]
 [ 0  1  1  1  0 56 57  0]
 [ 0  1  1  1  0 58 59  0]
 [ 0  1  1  1  0 60 61  0]
 [ 0  1  1  1  0 62 63  0]
 [ 0  1  1  1  0 64 65  0]
 [ 0  1  1  1  0 66 67  0]]
arg.env = [0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00
 2.61829634e+04 5.20030868e+03 7.61678858e+03 2.05988962e+03
 3.61761078e+03 1.17850493e+03 1.58126872e+03 6.33533062e+02
 4.40833935e+02 2.43064362e+02 2.12003422e+02 1.40369314e+02
 9.79057016e+01 7.86359272e+01 3.50749093e+01 3.64135014e+01
 7.99458771e+00 1.20119102e+01 6.58938926e-01 1.84777419e+00
 3.15914050e+00 5.98675838e+00 2.39136289e-01 8.63970946e-01
 1.36288484e+03 2.41578534e+04 6.63765754e+02 9.82885538e+03
 2.96348269e+02 3.58704963e+03 3.10066466e+02 3.79579625e+03
 6.36054541e+01 5.24025401e+02 7.46757411e+00 3.60129600e+01
 2.07486339e+01 1.29187733e+02 7.80019811e-01 2.13853535e+00
 2.84762797e+00 1.07916650e+01 2.23543447e-01 4.48421907e-01]
ecpbas  = []
Set gradient conv threshold to 3.16228e-05
Nelec from initial guess = 17.993518459723898
cond(S) = 105940.28666478123
E1 = -729.5484013660852  E_coul = 203.17807889802532
init E= -526.37032246806
    CPU time for initialize scf      0.07 sec, wall time      0.04 sec
  HOMO = -0.555720407320975  LUMO = 0.993990479490599
  mo_energy =
[-1.18336671e+02 -1.22060330e+01 -9.44695165e+00 -9.44695165e+00
 -9.44695165e+00 -1.24014425e+00 -5.55720407e-01 -5.55720407e-01
 -5.55720407e-01  9.93990479e-01  1.04005203e+00  1.04005203e+00
  1.04005203e+00  7.47189204e+00  7.47189204e+00  7.47189204e+00
  1.21934553e+01  3.43205659e+01  3.43205659e+01  3.43205659e+01
  9.54057454e+01  1.32905129e+02  1.32905129e+02  1.32905129e+02
  4.06821815e+02  4.88140068e+02  4.88140068e+02  4.88140068e+02
  1.21222287e+03  1.33180365e+03  1.33180365e+03  1.33180365e+03
  3.01390627e+03  3.01390627e+03  3.01390627e+03  3.51351772e+03
  6.62595584e+03  6.62595584e+03  6.62595584e+03  9.94797243e+03
  2.62707635e+04  7.69566599e+04]
E1 = -727.8620612021992  E_coul = 201.10501723004316
cycle= 1 E= -526.757043972156  delta_E= -0.387  |g|= 0.186  |ddm|= 0.307
    CPU time for cycle= 1      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.583847
diis-c [-0.34087765  1.        ]
  HOMO = -0.590629946069473  LUMO = 0.966175631666861
  mo_energy =
[-1.18644491e+02 -1.23438367e+01 -9.59558414e+00 -9.59558414e+00
 -9.59558414e+00 -1.27954036e+00 -5.90629946e-01 -5.90629946e-01
 -5.90629946e-01  9.66175632e-01  1.01552681e+00  1.01552681e+00
  1.01552681e+00  7.38009036e+00  7.38009036e+00  7.38009036e+00
  1.20854025e+01  3.41648056e+01  3.41648056e+01  3.41648056e+01
  9.51987560e+01  1.32674906e+02  1.32674906e+02  1.32674906e+02
  4.06531897e+02  4.87834425e+02  4.87834425e+02  4.87834425e+02
  1.21184801e+03  1.33144198e+03  1.33144198e+03  1.33144198e+03
  3.01347891e+03  3.01347891e+03  3.01347891e+03  3.51302394e+03
  6.62541590e+03  6.62541590e+03  6.62541590e+03  9.94736373e+03
  2.62700580e+04  7.69558629e+04]
E1 = -728.4357468541033  E_coul = 201.67798228073443
cycle= 2 E= -526.757764573369  delta_E= -0.000721  |g|= 0.0376  |ddm|= 0.0534
    CPU time for cycle= 2      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0765966
diis-c [-0.00383068  0.07212285  0.92787715]
  HOMO = -0.581422954041462  LUMO = 0.974279172719668
  mo_energy =
[-1.18576053e+02 -1.23053841e+01 -9.55545874e+00 -9.55545874e+00
 -9.55545874e+00 -1.26851456e+00 -5.81422954e-01 -5.81422954e-01
 -5.81422954e-01  9.74279173e-01  1.02237805e+00  1.02237805e+00
  1.02237805e+00  7.40432835e+00  7.40432835e+00  7.40432835e+00
  1.21153107e+01  3.42056649e+01  3.42056649e+01  3.42056649e+01
  9.52526805e+01  1.32731710e+02  1.32731710e+02  1.32731710e+02
  4.06598007e+02  4.87901988e+02  4.87901988e+02  4.87901988e+02
  1.21191970e+03  1.33151362e+03  1.33151362e+03  1.33151362e+03
  3.01355284e+03  3.01355284e+03  3.01355284e+03  3.51309890e+03
  6.62549162e+03  6.62549162e+03  6.62549162e+03  9.94744019e+03
  2.62701351e+04  7.69559403e+04]
E1 = -728.2839341827213  E_coul = 201.52611105152818
cycle= 3 E= -526.757823131193  delta_E= -5.86e-05  |g|= 0.00677  |ddm|= 0.0164
    CPU time for cycle= 3      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.0143375
diis-c [-7.44473368e-07 -1.20555296e-03  1.53585270e-01  8.47620283e-01]
  HOMO = -0.58302251621899  LUMO = 0.9729697464278
  mo_energy =
[-1.18586772e+02 -1.23116138e+01 -9.56205525e+00 -9.56205525e+00
 -9.56205525e+00 -1.27032301e+00 -5.83022516e-01 -5.83022516e-01
 -5.83022516e-01  9.72969746e-01  1.02121273e+00  1.02121273e+00
  1.02121273e+00  7.40024890e+00  7.40024890e+00  7.40024890e+00
  1.21104316e+01  3.41989921e+01  3.41989921e+01  3.41989921e+01
  9.52441321e+01  1.32722691e+02  1.32722691e+02  1.32722691e+02
  4.06587638e+02  4.87891402e+02  4.87891402e+02  4.87891402e+02
  1.21190845e+03  1.33150240e+03  1.33150240e+03  1.33150240e+03
  3.01354121e+03  3.01354121e+03  3.01354121e+03  3.51308702e+03
  6.62547957e+03  6.62547957e+03  6.62547957e+03  9.94742794e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3083645345109  E_coul = 201.55053919733285
cycle= 4 E= -526.757825337178  delta_E= -2.21e-06  |g|= 0.000102  |ddm|= 0.00242
    CPU time for cycle= 4      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=0.000111408
diis-c [-4.46597350e-09  7.70650715e-05 -1.14297722e-02 -6.75407769e-02
  1.07889348e+00]
  HOMO = -0.583003709596025  LUMO = 0.9730044563762
  mo_energy =
[-1.18586724e+02 -1.23115456e+01 -9.56200066e+00 -9.56200066e+00
 -9.56200066e+00 -1.27028051e+00 -5.83003710e-01 -5.83003710e-01
 -5.83003710e-01  9.73004456e-01  1.02122914e+00  1.02122914e+00
  1.02122914e+00  7.40029261e+00  7.40029261e+00  7.40029261e+00
  1.21104936e+01  3.41990449e+01  3.41990449e+01  3.41990449e+01
  9.52441906e+01  1.32722744e+02  1.32722744e+02  1.32722744e+02
  4.06587686e+02  4.87891450e+02  4.87891450e+02  4.87891450e+02
  1.21190848e+03  1.33150244e+03  1.33150244e+03  1.33150244e+03
  3.01354124e+03  3.01354124e+03  3.01354124e+03  3.51308704e+03
  6.62547958e+03  6.62547958e+03  6.62547958e+03  9.94742794e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3081340714793  E_coul = 201.55030873243322
cycle= 5 E= -526.757825339046  delta_E= -1.87e-09  |g|= 2.08e-05  |ddm|= 0.000165
    CPU time for cycle= 5      0.02 sec, wall time      0.02 sec
diis-norm(errvec)=3.92707e-05
diis-c [-8.36066059e-11  1.26020006e-05 -1.84359924e-03 -1.27929671e-02
  3.37570852e-02  9.80866879e-01]
  HOMO = -0.583011263173827  LUMO = 0.973000603516125
  mo_energy =
[-1.18586755e+02 -1.23115684e+01 -9.56202539e+00 -9.56202539e+00
 -9.56202539e+00 -1.27028644e+00 -5.83011263e-01 -5.83011263e-01
 -5.83011263e-01  9.73000604e-01  1.02122409e+00  1.02122409e+00
  1.02122409e+00  7.40027569e+00  7.40027569e+00  7.40027569e+00
  1.21104754e+01  3.41990208e+01  3.41990208e+01  3.41990208e+01
  9.52441634e+01  1.32722716e+02  1.32722716e+02  1.32722716e+02
  4.06587656e+02  4.87891419e+02  4.87891419e+02  4.87891419e+02
  1.21190845e+03  1.33150241e+03  1.33150241e+03  1.33150241e+03
  3.01354120e+03  3.01354120e+03  3.01354120e+03  3.51308701e+03
  6.62547955e+03  6.62547955e+03  6.62547955e+03  9.94742791e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3082157917469  E_coul = 201.55039045264
cycle= 6 E= -526.757825339107  delta_E= -6.07e-11  |g|= 1.8e-06  |ddm|= 1.93e-05
    CPU time for cycle= 6      0.02 sec, wall time      0.02 sec
E1 = -728.3082157917469  E_coul = 201.55039045264
  HOMO = -0.583011202772175  LUMO = 0.973001010969245
  mo_energy =
[-1.18586755e+02 -1.23115680e+01 -9.56202505e+00 -9.56202505e+00
 -9.56202505e+00 -1.27028597e+00 -5.83011203e-01 -5.83011203e-01
 -5.83011203e-01  9.73001011e-01  1.02122419e+00  1.02122419e+00
  1.02122419e+00  7.40027593e+00  7.40027593e+00  7.40027593e+00
  1.21104758e+01  3.41990212e+01  3.41990212e+01  3.41990212e+01
  9.52441639e+01  1.32722717e+02  1.32722717e+02  1.32722717e+02
  4.06587656e+02  4.87891419e+02  4.87891419e+02  4.87891419e+02
  1.21190845e+03  1.33150241e+03  1.33150241e+03  1.33150241e+03
  3.01354120e+03  3.01354120e+03  3.01354120e+03  3.51308701e+03
  6.62547955e+03  6.62547955e+03  6.62547955e+03  9.94742791e+03
  2.62701226e+04  7.69559277e+04]
E1 = -728.3082137111253  E_coul = 201.55038837201846
Extra cycle  E= -526.757825339107  delta_E=    0  |g|= 3.73e-07  |ddm|= 3.15e-06
    CPU time for scf_cycle      0.25 sec, wall time      0.22 sec
exp = [2.61829634e+04 7.61678858e+03 3.61761078e+03 1.58126872e+03
 4.40833935e+02 2.12003422e+02 9.79057016e+01 3.50749093e+01
 7.99458771e+00 6.58938926e-01 3.15914050e+00 2.39136289e-01
 1.36288484e+03 6.63765754e+02 2.96348269e+02 3.10066466e+02
 6.36054541e+01 7.46757411e+00 2.07486339e+01 7.80019811e-01
 2.84762797e+00 2.23543447e-01]
E = -526.7578253391068
Final energy = -526.7578253391068
exp = [2.6182963382658265e+04,7.6167885794294452e+03,3.6176107819817389e+03,1.5812687199890156e+03,4.4083393500184928e+02,2.1200342232702104e+02,9.7905701553772289e+01,3.5074909297834289e+01,7.9945877070487770e+00,6.5893892574636148e-01,3.1591405031938931e+00,2.3913628890664373e-01,1.3628848354756567e+03,6.6376575400824674e+02,2.9634826868925518e+02,3.1006646626293582e+02,6.3605454072870870e+01,7.4675741070008259e+00,2.0748633896676353e+01,7.8001981140090415e-01,2.8476279719515944e+00,2.2354344670534324e-01]

real	8m22.143s
user	8m39.854s
sys	1m40.744s
